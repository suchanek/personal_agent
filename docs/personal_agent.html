<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>personal_agent API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="personal_agent/langchain_main.html">langchain_main</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SimpleMCPClient">SimpleMCPClient</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SimpleMCPClient.__init__">SimpleMCPClient</a>
                        </li>
                        <li>
                                <a class="variable" href="#SimpleMCPClient.server_configs">server_configs</a>
                        </li>
                        <li>
                                <a class="variable" href="#SimpleMCPClient.active_servers">active_servers</a>
                        </li>
                        <li>
                                <a class="function" href="#SimpleMCPClient.start_server_sync">start_server_sync</a>
                        </li>
                        <li>
                                <a class="function" href="#SimpleMCPClient.call_tool_sync">call_tool_sync</a>
                        </li>
                        <li>
                                <a class="function" href="#SimpleMCPClient.list_tools_sync">list_tools_sync</a>
                        </li>
                        <li>
                                <a class="function" href="#SimpleMCPClient.stop_server_sync">stop_server_sync</a>
                        </li>
                        <li>
                                <a class="function" href="#SimpleMCPClient.start_servers">start_servers</a>
                        </li>
                        <li>
                                <a class="function" href="#SimpleMCPClient.stop_all_servers">stop_all_servers</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#create_agent_executor">create_agent_executor</a>
            </li>
            <li>
                    <a class="function" href="#setup_weaviate">setup_weaviate</a>
            </li>
            <li>
                    <a class="function" href="#is_weaviate_connected">is_weaviate_connected</a>
            </li>
            <li>
                    <a class="variable" href="#vector_store">vector_store</a>
            </li>
            <li>
                    <a class="variable" href="#weaviate_client">weaviate_client</a>
            </li>
            <li>
                    <a class="class" href="#AgnoPersonalAgent">AgnoPersonalAgent</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.__init__">AgnoPersonalAgent</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.model_provider">model_provider</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.model_name">model_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.enable_memory">enable_memory</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.enable_mcp">enable_mcp</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.debug">debug</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.ollama_base_url">ollama_base_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.user_id">user_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.recreate">recreate</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.instruction_level">instruction_level</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.seed">seed</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.mcp_servers">mcp_servers</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.model_manager">model_manager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.instruction_manager">instruction_manager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.memory_manager">memory_manager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.knowledge_manager">knowledge_manager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.tool_manager">tool_manager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.agno_storage">agno_storage</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.agno_knowledge">agno_knowledge</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.lightrag_knowledge">lightrag_knowledge</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.lightrag_knowledge_enabled">lightrag_knowledge_enabled</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.agno_memory">agno_memory</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.knowledge_coordinator">knowledge_coordinator</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgnoPersonalAgent.agent">agent</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.run">run</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.store_user_memory">store_user_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.seed_entity_in_graph">seed_entity_in_graph</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.check_entity_exists">check_entity_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.clear_all_memories">clear_all_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.query_lightrag_knowledge_direct">query_lightrag_knowledge_direct</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.get_agent_info">get_agent_info</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.print_agent_info">print_agent_info</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.cleanup">cleanup</a>
                        </li>
                        <li>
                                <a class="function" href="#AgnoPersonalAgent.sync_cleanup">sync_cleanup</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#create_agno_agent">create_agno_agent</a>
            </li>
            <li>
                    <a class="function" href="#create_simple_personal_agent">create_simple_personal_agent</a>
            </li>
            <li>
                    <a class="function" href="#load_agent_knowledge">load_agent_knowledge</a>
            </li>
            <li>
                    <a class="class" href="#SemanticMemoryManager">SemanticMemoryManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SemanticMemoryManager.__init__">SemanticMemoryManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#SemanticMemoryManager.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#SemanticMemoryManager.config">config</a>
                        </li>
                        <li>
                                <a class="variable" href="#SemanticMemoryManager.topic_classifier">topic_classifier</a>
                        </li>
                        <li>
                                <a class="variable" href="#SemanticMemoryManager.duplicate_detector">duplicate_detector</a>
                        </li>
                        <li>
                                <a class="variable" href="#SemanticMemoryManager.memories_updated">memories_updated</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.add_memory">add_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.update_memory">update_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.delete_memory">delete_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.delete_memories_by_topic">delete_memories_by_topic</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.clear_memories">clear_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.search_memories">search_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.get_memories_by_topic">get_memories_by_topic</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.get_all_memories">get_all_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.get_memory_stats">get_memory_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.process_input">process_input</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.create_or_update_memories">create_or_update_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.acreate_or_update_memories">acreate_or_update_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.run_memory_task">run_memory_task</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticMemoryManager.arun_memory_task">arun_memory_task</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MemoryStorageStatus">MemoryStorageStatus</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#MemoryStorageStatus.SUCCESS">SUCCESS</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageStatus.SUCCESS_LOCAL_ONLY">SUCCESS_LOCAL_ONLY</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageStatus.DUPLICATE_EXACT">DUPLICATE_EXACT</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageStatus.DUPLICATE_SEMANTIC">DUPLICATE_SEMANTIC</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageStatus.CONTENT_EMPTY">CONTENT_EMPTY</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageStatus.CONTENT_TOO_LONG">CONTENT_TOO_LONG</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageStatus.STORAGE_ERROR">STORAGE_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageStatus.VALIDATION_ERROR">VALIDATION_ERROR</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MemoryStorageResult">MemoryStorageResult</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MemoryStorageResult.__init__">MemoryStorageResult</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.status">status</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.message">message</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.memory_id">memory_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.topics">topics</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.local_success">local_success</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.graph_success">graph_success</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.similarity_score">similarity_score</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.is_success">is_success</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryStorageResult.is_rejected">is_rejected</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SemanticDuplicateDetector">SemanticDuplicateDetector</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SemanticDuplicateDetector.__init__">SemanticDuplicateDetector</a>
                        </li>
                        <li>
                                <a class="variable" href="#SemanticDuplicateDetector.similarity_threshold">similarity_threshold</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticDuplicateDetector.is_duplicate">is_duplicate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#create_semantic_memory_manager">create_semantic_memory_manager</a>
            </li>
            <li>
                    <a class="class" href="#AgentMemoryManager">AgentMemoryManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AgentMemoryManager.__init__">AgentMemoryManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentMemoryManager.user_id">user_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentMemoryManager.storage_dir">storage_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentMemoryManager.agno_memory">agno_memory</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentMemoryManager.lightrag_url">lightrag_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentMemoryManager.lightrag_memory_url">lightrag_memory_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentMemoryManager.enable_memory">enable_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.direct_search_memories">direct_search_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.get_memory_tools">get_memory_tools</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.store_user_memory">store_user_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.restate_user_fact">restate_user_fact</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.seed_entity_in_graph">seed_entity_in_graph</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.check_entity_exists">check_entity_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.clear_all_memories">clear_all_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.query_memory">query_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.update_memory">update_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.delete_memory">delete_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.get_recent_memories">get_recent_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.get_all_memories">get_all_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.get_memory_stats">get_memory_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.get_memories_by_topic">get_memories_by_topic</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.list_memories">list_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.store_graph_memory">store_graph_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.query_graph_memory">query_graph_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentMemoryManager.get_memory_graph_labels">get_memory_graph_labels</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AgentInstructionManager">AgentInstructionManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AgentInstructionManager.__init__">AgentInstructionManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentInstructionManager.instruction_level">instruction_level</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentInstructionManager.user_id">user_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentInstructionManager.enable_memory">enable_memory</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentInstructionManager.enable_mcp">enable_mcp</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentInstructionManager.mcp_servers">mcp_servers</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.create_instructions">create_instructions</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_header_instructions">get_header_instructions</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_identity_rules">get_identity_rules</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_personality_and_tone">get_personality_and_tone</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_concise_memory_rules">get_concise_memory_rules</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_detailed_memory_rules">get_detailed_memory_rules</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_concise_tool_rules">get_concise_tool_rules</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_detailed_tool_rules">get_detailed_tool_rules</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_anti_hesitation_rules">get_anti_hesitation_rules</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_tool_list">get_tool_list</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentInstructionManager.get_core_principles">get_core_principles</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AgentKnowledgeManager">AgentKnowledgeManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.__init__">AgentKnowledgeManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentKnowledgeManager.user_id">user_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentKnowledgeManager.storage_dir">storage_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentKnowledgeManager.lightrag_url">lightrag_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentKnowledgeManager.lightrag_memory_url">lightrag_memory_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentKnowledgeManager.knowledge_base_file">knowledge_base_file</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentKnowledgeManager.knowledge_base">knowledge_base</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.add_fact">add_fact</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.get_facts">get_facts</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.set_preference">set_preference</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.get_preference">get_preference</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.get_all_preferences">get_all_preferences</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.add_entity">add_entity</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.get_entity">get_entity</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.update_entity">update_entity</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.add_relationship">add_relationship</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.get_relationships">get_relationships</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.clear_knowledge_base">clear_knowledge_base</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.sync_with_graph">sync_with_graph</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentKnowledgeManager.query_graph">query_graph</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AgentToolManager">AgentToolManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AgentToolManager.__init__">AgentToolManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentToolManager.user_id">user_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentToolManager.storage_dir">storage_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentToolManager.tools">tools</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentToolManager.tool_categories">tool_categories</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentToolManager.tool_descriptions">tool_descriptions</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentToolManager.tool_parameters">tool_parameters</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentToolManager.tool_examples">tool_examples</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.register_tool">register_tool</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.unregister_tool">unregister_tool</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.get_tool">get_tool</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.get_tool_info">get_tool_info</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.get_all_tools">get_all_tools</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.get_tool_categories">get_tool_categories</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.execute_tool">execute_tool</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.validate_tool_args">validate_tool_args</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.format_tool_for_llm">format_tool_for_llm</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.format_all_tools_for_llm">format_all_tools_for_llm</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.save_tools_config">save_tools_config</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentToolManager.load_tools_config">load_tools_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AgentModelManager">AgentModelManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AgentModelManager.__init__">AgentModelManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentModelManager.model_provider">model_provider</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentModelManager.model_name">model_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentModelManager.ollama_base_url">ollama_base_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#AgentModelManager.seed">seed</a>
                        </li>
                        <li>
                                <a class="function" href="#AgentModelManager.create_model">create_model</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#USE_MCP">USE_MCP</a>
            </li>
            <li>
                    <a class="variable" href="#USE_WEAVIATE">USE_WEAVIATE</a>
            </li>
            <li>
                    <a class="function" href="#get_mcp_servers">get_mcp_servers</a>
            </li>
            <li>
                    <a class="function" href="#get_all_tools">get_all_tools</a>
            </li>
            <li>
                    <a class="function" href="#cleanup">cleanup</a>
            </li>
            <li>
                    <a class="function" href="#inject_dependencies">inject_dependencies</a>
            </li>
            <li>
                    <a class="function" href="#register_cleanup_handlers">register_cleanup_handlers</a>
            </li>
            <li>
                    <a class="function" href="#configure_all_rich_logging">configure_all_rich_logging</a>
            </li>
            <li>
                    <a class="function" href="#configure_master_logger">configure_master_logger</a>
            </li>
            <li>
                    <a class="function" href="#disable_stream_handlers_for_namespace">disable_stream_handlers_for_namespace</a>
            </li>
            <li>
                    <a class="function" href="#list_all_loggers">list_all_loggers</a>
            </li>
            <li>
                    <a class="function" href="#list_handlers">list_handlers</a>
            </li>
            <li>
                    <a class="function" href="#set_logger_level">set_logger_level</a>
            </li>
            <li>
                    <a class="function" href="#set_logger_level_for_module">set_logger_level_for_module</a>
            </li>
            <li>
                    <a class="function" href="#set_logging_level_for_all_handlers">set_logging_level_for_all_handlers</a>
            </li>
            <li>
                    <a class="function" href="#setup_agno_rich_logging">setup_agno_rich_logging</a>
            </li>
            <li>
                    <a class="function" href="#setup_logging">setup_logging</a>
            </li>
            <li>
                    <a class="function" href="#toggle_stream_handler">toggle_stream_handler</a>
            </li>
            <li>
                    <a class="function" href="#setup_logging_filters">setup_logging_filters</a>
            </li>
            <li>
                    <a class="function" href="#create_app">create_app</a>
            </li>
            <li>
                    <a class="function" href="#register_routes">register_routes</a>
            </li>
            <li>
                    <a class="function" href="#cli_main">cli_main</a>
            </li>
            <li>
                    <a class="function" href="#run_agno_cli">run_agno_cli</a>
            </li>
            <li>
                    <a class="function" href="#langchain_main">langchain_main</a>
            </li>
            <li>
                    <a class="function" href="#langchain_cli_main">langchain_cli_main</a>
            </li>
            <li>
                    <a class="function" href="#run_smolagents_web">run_smolagents_web</a>
            </li>
            <li>
                    <a class="function" href="#run_smolagents_cli">run_smolagents_cli</a>
            </li>
            <li>
                    <a class="function" href="#print_configuration">print_configuration</a>
            </li>
            <li>
                    <a class="variable" href="#__version__">__version__</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
personal_agent    </h1>

                        <div class="docstring"><p>Personal AI Agent package initialization.</p>

<p>This module serves as the main entry point for the Personal AI Agent package,
providing a comprehensive suite of AI-powered tools and capabilities including:</p>

<ul>
<li>Multi-framework support: LangChain, smolagents, and Agno frameworks</li>
<li>Model Context Protocol (MCP) integration with multiple servers</li>
<li>Weaviate vector database for persistent memory</li>
<li>Advanced memory management with semantic deduplication</li>
<li>Comprehensive tool suite for file operations, web research, and system tasks</li>
<li>Multiple interface options: Streamlit, Flask, and CLI</li>
<li>Modular architecture with organized code structure</li>
</ul>

<p>The package supports three main frameworks:</p>

<ol>
<li>LangChain ReAct (legacy support)</li>
<li>Smolagents (multi-agent coordination)</li>
<li>Agno (modern async agent framework) - primary interface</li>
</ol>

<p>Author: Personal Agent Development Team
Last modified: 2025-07-10 15:12:58
Version: 0.8.7.dev</p>
</div>

                        <input id="mod-personal_agent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-personal_agent-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Personal AI Agent package initialization.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">This module serves as the main entry point for the Personal AI Agent package,</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">providing a comprehensive suite of AI-powered tools and capabilities including:</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">- Multi-framework support: LangChain, smolagents, and Agno frameworks</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">- Model Context Protocol (MCP) integration with multiple servers</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">- Weaviate vector database for persistent memory</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">- Advanced memory management with semantic deduplication</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">- Comprehensive tool suite for file operations, web research, and system tasks</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">- Multiple interface options: Streamlit, Flask, and CLI</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">- Modular architecture with organized code structure</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">The package supports three main frameworks:</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">1. LangChain ReAct (legacy support)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">2. Smolagents (multi-agent coordination)</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">3. Agno (modern async agent framework) - primary interface</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">Author: Personal Agent Development Team</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">Last modified: 2025-07-10 15:12:58</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">Version: 0.8.7.dev</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="c1"># pylint: disable=C0413</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="c1"># Set Rust logging to ERROR level to suppress Lance warnings before any imports</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="k">if</span> <span class="s2">&quot;RUST_LOG&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;RUST_LOG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="c1"># Import core components</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">USE_MCP</span><span class="p">,</span> <span class="n">USE_WEAVIATE</span><span class="p">,</span> <span class="n">get_mcp_servers</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleMCPClient</span><span class="p">,</span> <span class="n">create_agent_executor</span><span class="p">,</span> <span class="n">setup_weaviate</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_weaviate_connected</span><span class="p">,</span> <span class="n">vector_store</span><span class="p">,</span> <span class="n">weaviate_client</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="c1"># Import key classes for pdoc documentation</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.agno_agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgnoPersonalAgent</span><span class="p">,</span> <span class="n">create_agno_agent</span><span class="p">,</span> <span class="n">create_simple_personal_agent</span><span class="p">,</span> <span class="n">load_agent_knowledge</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.semantic_memory_manager</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    <span class="n">SemanticMemoryManager</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="n">MemoryStorageStatus</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="n">MemoryStorageResult</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="n">SemanticDuplicateDetector</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="n">create_semantic_memory_manager</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.agent_memory_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentMemoryManager</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.agent_instruction_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentInstructionManager</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.agent_knowledge_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentKnowledgeManager</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.agent_tool_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentToolManager</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.agent_model_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentModelManager</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="c1"># Import tools</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_all_tools</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="c1"># Import utilities</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">cleanup</span><span class="p">,</span> <span class="n">inject_dependencies</span><span class="p">,</span> <span class="n">register_cleanup_handlers</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.utils.pag_logging</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="n">configure_all_rich_logging</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="n">configure_master_logger</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="n">disable_stream_handlers_for_namespace</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="n">list_all_loggers</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="n">list_handlers</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    <span class="n">set_logger_level</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="n">set_logger_level_for_module</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="n">set_logging_level_for_all_handlers</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">setup_agno_rich_logging</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="n">setup_logging</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="n">setup_logging_filters</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">toggle_stream_handler</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="p">)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="c1"># Import web interface</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.web</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_app</span><span class="p">,</span> <span class="n">register_routes</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="c1"># Package version (matches pyproject.toml)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.9.2dev&quot;</span>  <span class="c1"># Defined once to avoid duplication</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="c1"># Setup package and module-level logging</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="c1"># Configure logging for the package</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="c1"># Disable master logger to avoid duplicate logs</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="n">configure_master_logger</span><span class="p">(</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="c1"># Disable annoying warnings</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="n">setup_logging_filters</span><span class="p">()</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="c1"># Package-level logger</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="n">_logger</span> <span class="o">=</span> <span class="n">setup_logging</span><span class="p">()</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="c1"># Export public API</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="c1"># Core components</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="s2">&quot;SimpleMCPClient&quot;</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="s2">&quot;create_agent_executor&quot;</span><span class="p">,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="s2">&quot;setup_weaviate&quot;</span><span class="p">,</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="s2">&quot;is_weaviate_connected&quot;</span><span class="p">,</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="s2">&quot;vector_store&quot;</span><span class="p">,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="s2">&quot;weaviate_client&quot;</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="c1"># Key classes for pdoc documentation</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="s2">&quot;AgnoPersonalAgent&quot;</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>    <span class="s2">&quot;create_agno_agent&quot;</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="s2">&quot;create_simple_personal_agent&quot;</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="s2">&quot;load_agent_knowledge&quot;</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="s2">&quot;SemanticMemoryManager&quot;</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="s2">&quot;MemoryStorageStatus&quot;</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="s2">&quot;MemoryStorageResult&quot;</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="s2">&quot;SemanticDuplicateDetector&quot;</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="s2">&quot;create_semantic_memory_manager&quot;</span><span class="p">,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="s2">&quot;AgentMemoryManager&quot;</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="s2">&quot;AgentInstructionManager&quot;</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="s2">&quot;AgentKnowledgeManager&quot;</span><span class="p">,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>    <span class="s2">&quot;AgentToolManager&quot;</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="s2">&quot;AgentModelManager&quot;</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="c1"># Configuration</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="s2">&quot;USE_MCP&quot;</span><span class="p">,</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="s2">&quot;USE_WEAVIATE&quot;</span><span class="p">,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="s2">&quot;get_mcp_servers&quot;</span><span class="p">,</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="c1"># Tools</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="s2">&quot;get_all_tools&quot;</span><span class="p">,</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="c1"># Utilities</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="s2">&quot;cleanup&quot;</span><span class="p">,</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="s2">&quot;inject_dependencies&quot;</span><span class="p">,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="s2">&quot;register_cleanup_handlers&quot;</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="s2">&quot;configure_all_rich_logging&quot;</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="s2">&quot;configure_master_logger&quot;</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="s2">&quot;disable_stream_handlers_for_namespace&quot;</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="s2">&quot;list_all_loggers&quot;</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="s2">&quot;list_handlers&quot;</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="s2">&quot;set_logger_level&quot;</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="s2">&quot;set_logger_level_for_module&quot;</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="s2">&quot;set_logging_level_for_all_handlers&quot;</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="s2">&quot;setup_agno_rich_logging&quot;</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="s2">&quot;setup_logging&quot;</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="s2">&quot;toggle_stream_handler&quot;</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="s2">&quot;setup_logging_filters&quot;</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="c1"># Web interface</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="s2">&quot;create_app&quot;</span><span class="p">,</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="s2">&quot;register_routes&quot;</span><span class="p">,</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="c1"># Main entry points - Agno (primary)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>    <span class="s2">&quot;cli_main&quot;</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="s2">&quot;run_agno_cli&quot;</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="c1"># Main entry points - LangChain (legacy)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    <span class="s2">&quot;langchain_main&quot;</span><span class="p">,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="s2">&quot;langchain_cli_main&quot;</span><span class="p">,</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="c1"># Main entry points - Smolagents</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    <span class="s2">&quot;run_smolagents_web&quot;</span><span class="p">,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>    <span class="s2">&quot;run_smolagents_cli&quot;</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>    <span class="c1"># Utility functions</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>    <span class="s2">&quot;print_configuration&quot;</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="c1"># Package info</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="s2">&quot;__version__&quot;</span><span class="p">,</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="p">]</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="c1"># Only log initialization message if log level allows it AND root logger allows it</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="c1"># This prevents spam when scripts want to suppress logging</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="k">if</span> <span class="n">_logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span> <span class="ow">and</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">):</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing Personal AI Agent package v</span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">__version__</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="c1"># Debug logging for pdoc class discovery</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;PDOC DEBUG: Listing all imported classes and modules:&quot;</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="n">current_module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">current_module</span><span class="p">):</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismodule</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;PDOC DEBUG: Found </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span> <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>    
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>    <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;PDOC DEBUG: __all__ list contains </span><span class="si">%d</span><span class="s2"> items&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">__all__</span><span class="p">))</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="c1"># Main entry points</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.agno_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">cli_main</span><span class="p">,</span> <span class="n">run_agno_cli</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.langchain_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">cli_main</span> <span class="k">as</span> <span class="n">langchain_cli_main</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.langchain_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span> <span class="k">as</span> <span class="n">langchain_main</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.smol_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_smolagents_cli</span><span class="p">,</span> <span class="n">run_smolagents_web</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="k">def</span><span class="w"> </span><span class="nf">print_configuration</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Print comprehensive configuration information for the Personal AI Agent.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">    Uses the enhanced configuration display method from the module&#39;s tools.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">    :return: Configuration information as formatted string</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="c1"># Import and use the enhanced display function from the module&#39;s tools</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.tools.show_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_config</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="c1"># Call the show_config function with default colored output</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">show_config</span><span class="p">()</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="k">return</span> <span class="s2">&quot;Configuration displayed successfully using module tools.show_config method.&quot;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="c1"># Fallback to the settings.print_config() method if enhanced method fails</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not use module tools.show_config display: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_config</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="n">print_config</span><span class="p">()</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="k">return</span> <span class="s2">&quot;Configuration displayed successfully using settings.print_config() fallback.&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">fallback_error</span><span class="p">:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>                <span class="s2">&quot;Could not import settings.print_config: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fallback_error</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="c1"># Final fallback to basic configuration display</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_mcp_servers</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                <span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">,</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                <span class="n">AGNO_STORAGE_DIR</span><span class="p">,</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                <span class="n">DATA_DIR</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                <span class="n">HOME_DIR</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                <span class="n">LLM_MODEL</span><span class="p">,</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>                <span class="n">LOG_LEVEL_STR</span><span class="p">,</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>                <span class="n">OLLAMA_URL</span><span class="p">,</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>                <span class="n">REPO_DIR</span><span class="p">,</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                <span class="n">ROOT_DIR</span><span class="p">,</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                <span class="n">STORAGE_BACKEND</span><span class="p">,</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                <span class="n">USE_MCP</span><span class="p">,</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>                <span class="n">USE_WEAVIATE</span><span class="p">,</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>                <span class="n">WEAVIATE_URL</span><span class="p">,</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="n">config_lines</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                <span class="s2">&quot;🤖 PERSONAL AI AGENT CONFIGURATION&quot;</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                <span class="s2">&quot;📊 CORE SETTINGS:&quot;</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Package Version: </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>                <span class="sa">f</span><span class="s2">&quot;  • LLM Model: </span><span class="si">{</span><span class="n">LLM_MODEL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Storage Backend: </span><span class="si">{</span><span class="n">STORAGE_BACKEND</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Log Level: </span><span class="si">{</span><span class="n">LOG_LEVEL_STR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>                <span class="s2">&quot;🌐 SERVICE ENDPOINTS:&quot;</span><span class="p">,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Ollama URL: </span><span class="si">{</span><span class="n">OLLAMA_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Weaviate URL: </span><span class="si">{</span><span class="n">WEAVIATE_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>                <span class="s2">&quot;🔧 FEATURE FLAGS:&quot;</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Weaviate Enabled: </span><span class="si">{</span><span class="s1">&#39;✅&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">USE_WEAVIATE</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;❌&#39;</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">USE_WEAVIATE</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>                <span class="sa">f</span><span class="s2">&quot;  • MCP Enabled: </span><span class="si">{</span><span class="s1">&#39;✅&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">USE_MCP</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;❌&#39;</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">USE_MCP</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>                <span class="s2">&quot;📁 DIRECTORY CONFIGURATION:&quot;</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Root Directory: </span><span class="si">{</span><span class="n">ROOT_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Home Directory: </span><span class="si">{</span><span class="n">HOME_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Data Directory: </span><span class="si">{</span><span class="n">DATA_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Repository Directory: </span><span class="si">{</span><span class="n">REPO_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Agno Storage Directory: </span><span class="si">{</span><span class="n">AGNO_STORAGE_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Agno Knowledge Directory: </span><span class="si">{</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">,</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="s2">&quot;🚀 Configuration loaded successfully!&quot;</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">,</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="p">]</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="c1"># Join and print</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">config_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_lines</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">config_text</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="k">return</span> <span class="n">config_text</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="c1"># The __all__ list has been moved above to fix the &quot;using variable before assignment&quot; issue</span>
</span></pre></div>


            </section>
                <section id="SimpleMCPClient">
                            <input id="SimpleMCPClient-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SimpleMCPClient</span>:

                <label class="view-source-button" for="SimpleMCPClient-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimpleMCPClient"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimpleMCPClient-16"><a href="#SimpleMCPClient-16"><span class="linenos"> 16</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SimpleMCPClient</span><span class="p">:</span>
</span><span id="SimpleMCPClient-17"><a href="#SimpleMCPClient-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple MCP client based on the working test_mcp.py implementation.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-18"><a href="#SimpleMCPClient-18"><span class="linenos"> 18</span></a>
</span><span id="SimpleMCPClient-19"><a href="#SimpleMCPClient-19"><span class="linenos"> 19</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_configs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
</span><span id="SimpleMCPClient-20"><a href="#SimpleMCPClient-20"><span class="linenos"> 20</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_configs</span> <span class="o">=</span> <span class="n">server_configs</span>
</span><span id="SimpleMCPClient-21"><a href="#SimpleMCPClient-21"><span class="linenos"> 21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SimpleMCPClient-22"><a href="#SimpleMCPClient-22"><span class="linenos"> 22</span></a>
</span><span id="SimpleMCPClient-23"><a href="#SimpleMCPClient-23"><span class="linenos"> 23</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_server_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SimpleMCPClient-24"><a href="#SimpleMCPClient-24"><span class="linenos"> 24</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start an MCP server process synchronously.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-25"><a href="#SimpleMCPClient-25"><span class="linenos"> 25</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_configs</span><span class="p">:</span>
</span><span id="SimpleMCPClient-26"><a href="#SimpleMCPClient-26"><span class="linenos"> 26</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-27"><a href="#SimpleMCPClient-27"><span class="linenos"> 27</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient-28"><a href="#SimpleMCPClient-28"><span class="linenos"> 28</span></a>
</span><span id="SimpleMCPClient-29"><a href="#SimpleMCPClient-29"><span class="linenos"> 29</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">:</span>
</span><span id="SimpleMCPClient-30"><a href="#SimpleMCPClient-30"><span class="linenos"> 30</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MCP server </span><span class="si">%s</span><span class="s2"> already running&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-31"><a href="#SimpleMCPClient-31"><span class="linenos"> 31</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient-32"><a href="#SimpleMCPClient-32"><span class="linenos"> 32</span></a>
</span><span id="SimpleMCPClient-33"><a href="#SimpleMCPClient-33"><span class="linenos"> 33</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_configs</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span>
</span><span id="SimpleMCPClient-34"><a href="#SimpleMCPClient-34"><span class="linenos"> 34</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient-35"><a href="#SimpleMCPClient-35"><span class="linenos"> 35</span></a>            <span class="c1"># Start the MCP server process</span>
</span><span id="SimpleMCPClient-36"><a href="#SimpleMCPClient-36"><span class="linenos"> 36</span></a>            <span class="c1"># Set working directory based on the server root path</span>
</span><span id="SimpleMCPClient-37"><a href="#SimpleMCPClient-37"><span class="linenos"> 37</span></a>            <span class="n">cwd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SimpleMCPClient-38"><a href="#SimpleMCPClient-38"><span class="linenos"> 38</span></a>            <span class="k">if</span> <span class="n">server_name</span> <span class="o">==</span> <span class="s2">&quot;filesystem-home&quot;</span><span class="p">:</span>
</span><span id="SimpleMCPClient-39"><a href="#SimpleMCPClient-39"><span class="linenos"> 39</span></a>                <span class="n">cwd</span> <span class="o">=</span> <span class="n">ROOT_DIR</span>
</span><span id="SimpleMCPClient-40"><a href="#SimpleMCPClient-40"><span class="linenos"> 40</span></a>            <span class="k">elif</span> <span class="n">server_name</span> <span class="o">==</span> <span class="s2">&quot;filesystem-data&quot;</span><span class="p">:</span>
</span><span id="SimpleMCPClient-41"><a href="#SimpleMCPClient-41"><span class="linenos"> 41</span></a>                <span class="n">cwd</span> <span class="o">=</span> <span class="n">DATA_DIR</span>
</span><span id="SimpleMCPClient-42"><a href="#SimpleMCPClient-42"><span class="linenos"> 42</span></a>
</span><span id="SimpleMCPClient-43"><a href="#SimpleMCPClient-43"><span class="linenos"> 43</span></a>            <span class="c1"># Prepare environment variables</span>
</span><span id="SimpleMCPClient-44"><a href="#SimpleMCPClient-44"><span class="linenos"> 44</span></a>            <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Start with current environment</span>
</span><span id="SimpleMCPClient-45"><a href="#SimpleMCPClient-45"><span class="linenos"> 45</span></a>            <span class="k">if</span> <span class="s2">&quot;env&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
</span><span id="SimpleMCPClient-46"><a href="#SimpleMCPClient-46"><span class="linenos"> 46</span></a>                <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">])</span>  <span class="c1"># Add server-specific env vars</span>
</span><span id="SimpleMCPClient-47"><a href="#SimpleMCPClient-47"><span class="linenos"> 47</span></a>
</span><span id="SimpleMCPClient-48"><a href="#SimpleMCPClient-48"><span class="linenos"> 48</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="SimpleMCPClient-49"><a href="#SimpleMCPClient-49"><span class="linenos"> 49</span></a>                <span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">],</span>
</span><span id="SimpleMCPClient-50"><a href="#SimpleMCPClient-50"><span class="linenos"> 50</span></a>                <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="SimpleMCPClient-51"><a href="#SimpleMCPClient-51"><span class="linenos"> 51</span></a>                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="SimpleMCPClient-52"><a href="#SimpleMCPClient-52"><span class="linenos"> 52</span></a>                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="SimpleMCPClient-53"><a href="#SimpleMCPClient-53"><span class="linenos"> 53</span></a>                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SimpleMCPClient-54"><a href="#SimpleMCPClient-54"><span class="linenos"> 54</span></a>                <span class="n">bufsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="SimpleMCPClient-55"><a href="#SimpleMCPClient-55"><span class="linenos"> 55</span></a>                <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span>
</span><span id="SimpleMCPClient-56"><a href="#SimpleMCPClient-56"><span class="linenos"> 56</span></a>                <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>  <span class="c1"># Pass environment variables</span>
</span><span id="SimpleMCPClient-57"><a href="#SimpleMCPClient-57"><span class="linenos"> 57</span></a>            <span class="p">)</span>
</span><span id="SimpleMCPClient-58"><a href="#SimpleMCPClient-58"><span class="linenos"> 58</span></a>
</span><span id="SimpleMCPClient-59"><a href="#SimpleMCPClient-59"><span class="linenos"> 59</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="n">process</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">}</span>
</span><span id="SimpleMCPClient-60"><a href="#SimpleMCPClient-60"><span class="linenos"> 60</span></a>
</span><span id="SimpleMCPClient-61"><a href="#SimpleMCPClient-61"><span class="linenos"> 61</span></a>            <span class="c1"># Wait a moment for server to start</span>
</span><span id="SimpleMCPClient-62"><a href="#SimpleMCPClient-62"><span class="linenos"> 62</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SimpleMCPClient-63"><a href="#SimpleMCPClient-63"><span class="linenos"> 63</span></a>
</span><span id="SimpleMCPClient-64"><a href="#SimpleMCPClient-64"><span class="linenos"> 64</span></a>            <span class="c1"># Initialize the server</span>
</span><span id="SimpleMCPClient-65"><a href="#SimpleMCPClient-65"><span class="linenos"> 65</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_server_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">):</span>
</span><span id="SimpleMCPClient-66"><a href="#SimpleMCPClient-66"><span class="linenos"> 66</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-67"><a href="#SimpleMCPClient-67"><span class="linenos"> 67</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient-68"><a href="#SimpleMCPClient-68"><span class="linenos"> 68</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SimpleMCPClient-69"><a href="#SimpleMCPClient-69"><span class="linenos"> 69</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to initialize MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-70"><a href="#SimpleMCPClient-70"><span class="linenos"> 70</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient-71"><a href="#SimpleMCPClient-71"><span class="linenos"> 71</span></a>
</span><span id="SimpleMCPClient-72"><a href="#SimpleMCPClient-72"><span class="linenos"> 72</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient-73"><a href="#SimpleMCPClient-73"><span class="linenos"> 73</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to start MCP server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient-74"><a href="#SimpleMCPClient-74"><span class="linenos"> 74</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient-75"><a href="#SimpleMCPClient-75"><span class="linenos"> 75</span></a>
</span><span id="SimpleMCPClient-76"><a href="#SimpleMCPClient-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_server_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SimpleMCPClient-77"><a href="#SimpleMCPClient-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize server synchronously.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-78"><a href="#SimpleMCPClient-78"><span class="linenos"> 78</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient-79"><a href="#SimpleMCPClient-79"><span class="linenos"> 79</span></a>            <span class="c1"># Send initialize request</span>
</span><span id="SimpleMCPClient-80"><a href="#SimpleMCPClient-80"><span class="linenos"> 80</span></a>            <span class="n">init_request</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SimpleMCPClient-81"><a href="#SimpleMCPClient-81"><span class="linenos"> 81</span></a>                <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient-82"><a href="#SimpleMCPClient-82"><span class="linenos"> 82</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SimpleMCPClient-83"><a href="#SimpleMCPClient-83"><span class="linenos"> 83</span></a>                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;initialize&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient-84"><a href="#SimpleMCPClient-84"><span class="linenos"> 84</span></a>                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SimpleMCPClient-85"><a href="#SimpleMCPClient-85"><span class="linenos"> 85</span></a>                    <span class="s2">&quot;protocolVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-11-05&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient-86"><a href="#SimpleMCPClient-86"><span class="linenos"> 86</span></a>                    <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="SimpleMCPClient-87"><a href="#SimpleMCPClient-87"><span class="linenos"> 87</span></a>                    <span class="s2">&quot;clientInfo&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;personal-agent&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">},</span>
</span><span id="SimpleMCPClient-88"><a href="#SimpleMCPClient-88"><span class="linenos"> 88</span></a>                <span class="p">},</span>
</span><span id="SimpleMCPClient-89"><a href="#SimpleMCPClient-89"><span class="linenos"> 89</span></a>            <span class="p">}</span>
</span><span id="SimpleMCPClient-90"><a href="#SimpleMCPClient-90"><span class="linenos"> 90</span></a>
</span><span id="SimpleMCPClient-91"><a href="#SimpleMCPClient-91"><span class="linenos"> 91</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_request_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">,</span> <span class="n">init_request</span><span class="p">)</span>
</span><span id="SimpleMCPClient-92"><a href="#SimpleMCPClient-92"><span class="linenos"> 92</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">):</span>
</span><span id="SimpleMCPClient-93"><a href="#SimpleMCPClient-93"><span class="linenos"> 93</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialized MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-94"><a href="#SimpleMCPClient-94"><span class="linenos"> 94</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient-95"><a href="#SimpleMCPClient-95"><span class="linenos"> 95</span></a>
</span><span id="SimpleMCPClient-96"><a href="#SimpleMCPClient-96"><span class="linenos"> 96</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient-97"><a href="#SimpleMCPClient-97"><span class="linenos"> 97</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to initialize MCP server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient-98"><a href="#SimpleMCPClient-98"><span class="linenos"> 98</span></a>
</span><span id="SimpleMCPClient-99"><a href="#SimpleMCPClient-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient-100"><a href="#SimpleMCPClient-100"><span class="linenos">100</span></a>
</span><span id="SimpleMCPClient-101"><a href="#SimpleMCPClient-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_send_request_sync</span><span class="p">(</span>
</span><span id="SimpleMCPClient-102"><a href="#SimpleMCPClient-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="SimpleMCPClient-103"><a href="#SimpleMCPClient-103"><span class="linenos">103</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="SimpleMCPClient-104"><a href="#SimpleMCPClient-104"><span class="linenos">104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a JSON-RPC request to an MCP server synchronously.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-105"><a href="#SimpleMCPClient-105"><span class="linenos">105</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">:</span>
</span><span id="SimpleMCPClient-106"><a href="#SimpleMCPClient-106"><span class="linenos">106</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SimpleMCPClient-107"><a href="#SimpleMCPClient-107"><span class="linenos">107</span></a>
</span><span id="SimpleMCPClient-108"><a href="#SimpleMCPClient-108"><span class="linenos">108</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient-109"><a href="#SimpleMCPClient-109"><span class="linenos">109</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">][</span><span class="s2">&quot;process&quot;</span><span class="p">]</span>
</span><span id="SimpleMCPClient-110"><a href="#SimpleMCPClient-110"><span class="linenos">110</span></a>            <span class="n">request_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SimpleMCPClient-111"><a href="#SimpleMCPClient-111"><span class="linenos">111</span></a>
</span><span id="SimpleMCPClient-112"><a href="#SimpleMCPClient-112"><span class="linenos">112</span></a>            <span class="c1"># Send request</span>
</span><span id="SimpleMCPClient-113"><a href="#SimpleMCPClient-113"><span class="linenos">113</span></a>            <span class="n">process</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">request_json</span><span class="p">)</span>
</span><span id="SimpleMCPClient-114"><a href="#SimpleMCPClient-114"><span class="linenos">114</span></a>            <span class="n">process</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="SimpleMCPClient-115"><a href="#SimpleMCPClient-115"><span class="linenos">115</span></a>
</span><span id="SimpleMCPClient-116"><a href="#SimpleMCPClient-116"><span class="linenos">116</span></a>            <span class="c1"># Read response</span>
</span><span id="SimpleMCPClient-117"><a href="#SimpleMCPClient-117"><span class="linenos">117</span></a>            <span class="n">response_line</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="SimpleMCPClient-118"><a href="#SimpleMCPClient-118"><span class="linenos">118</span></a>            <span class="k">if</span> <span class="n">response_line</span><span class="p">:</span>
</span><span id="SimpleMCPClient-119"><a href="#SimpleMCPClient-119"><span class="linenos">119</span></a>                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response_line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="SimpleMCPClient-120"><a href="#SimpleMCPClient-120"><span class="linenos">120</span></a>
</span><span id="SimpleMCPClient-121"><a href="#SimpleMCPClient-121"><span class="linenos">121</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient-122"><a href="#SimpleMCPClient-122"><span class="linenos">122</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error sending request to MCP server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient-123"><a href="#SimpleMCPClient-123"><span class="linenos">123</span></a>
</span><span id="SimpleMCPClient-124"><a href="#SimpleMCPClient-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="SimpleMCPClient-125"><a href="#SimpleMCPClient-125"><span class="linenos">125</span></a>
</span><span id="SimpleMCPClient-126"><a href="#SimpleMCPClient-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">call_tool_sync</span><span class="p">(</span>
</span><span id="SimpleMCPClient-127"><a href="#SimpleMCPClient-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="SimpleMCPClient-128"><a href="#SimpleMCPClient-128"><span class="linenos">128</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SimpleMCPClient-129"><a href="#SimpleMCPClient-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Call a tool on an MCP server synchronously.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-130"><a href="#SimpleMCPClient-130"><span class="linenos">130</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient-131"><a href="#SimpleMCPClient-131"><span class="linenos">131</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SimpleMCPClient-132"><a href="#SimpleMCPClient-132"><span class="linenos">132</span></a>                <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient-133"><a href="#SimpleMCPClient-133"><span class="linenos">133</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="SimpleMCPClient-134"><a href="#SimpleMCPClient-134"><span class="linenos">134</span></a>                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;tools/call&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient-135"><a href="#SimpleMCPClient-135"><span class="linenos">135</span></a>                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">arguments</span><span class="p">},</span>
</span><span id="SimpleMCPClient-136"><a href="#SimpleMCPClient-136"><span class="linenos">136</span></a>            <span class="p">}</span>
</span><span id="SimpleMCPClient-137"><a href="#SimpleMCPClient-137"><span class="linenos">137</span></a>
</span><span id="SimpleMCPClient-138"><a href="#SimpleMCPClient-138"><span class="linenos">138</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_request_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</span><span id="SimpleMCPClient-139"><a href="#SimpleMCPClient-139"><span class="linenos">139</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">):</span>
</span><span id="SimpleMCPClient-140"><a href="#SimpleMCPClient-140"><span class="linenos">140</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="SimpleMCPClient-141"><a href="#SimpleMCPClient-141"><span class="linenos">141</span></a>                <span class="k">if</span> <span class="n">content</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SimpleMCPClient-142"><a href="#SimpleMCPClient-142"><span class="linenos">142</span></a>                    <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;No response&quot;</span><span class="p">)</span>
</span><span id="SimpleMCPClient-143"><a href="#SimpleMCPClient-143"><span class="linenos">143</span></a>
</span><span id="SimpleMCPClient-144"><a href="#SimpleMCPClient-144"><span class="linenos">144</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient-145"><a href="#SimpleMCPClient-145"><span class="linenos">145</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="SimpleMCPClient-146"><a href="#SimpleMCPClient-146"><span class="linenos">146</span></a>                <span class="s2">&quot;Error calling tool </span><span class="si">%s</span><span class="s2"> on server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SimpleMCPClient-147"><a href="#SimpleMCPClient-147"><span class="linenos">147</span></a>            <span class="p">)</span>
</span><span id="SimpleMCPClient-148"><a href="#SimpleMCPClient-148"><span class="linenos">148</span></a>
</span><span id="SimpleMCPClient-149"><a href="#SimpleMCPClient-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error calling tool </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SimpleMCPClient-150"><a href="#SimpleMCPClient-150"><span class="linenos">150</span></a>
</span><span id="SimpleMCPClient-151"><a href="#SimpleMCPClient-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_tools_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="SimpleMCPClient-152"><a href="#SimpleMCPClient-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List available tools on an MCP server synchronously.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-153"><a href="#SimpleMCPClient-153"><span class="linenos">153</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient-154"><a href="#SimpleMCPClient-154"><span class="linenos">154</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;tools/list&quot;</span><span class="p">}</span>
</span><span id="SimpleMCPClient-155"><a href="#SimpleMCPClient-155"><span class="linenos">155</span></a>
</span><span id="SimpleMCPClient-156"><a href="#SimpleMCPClient-156"><span class="linenos">156</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_request_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</span><span id="SimpleMCPClient-157"><a href="#SimpleMCPClient-157"><span class="linenos">157</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">):</span>
</span><span id="SimpleMCPClient-158"><a href="#SimpleMCPClient-158"><span class="linenos">158</span></a>                <span class="n">tools</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="SimpleMCPClient-159"><a href="#SimpleMCPClient-159"><span class="linenos">159</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SimpleMCPClient-160"><a href="#SimpleMCPClient-160"><span class="linenos">160</span></a>                    <span class="s2">&quot;Available tools on </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient-161"><a href="#SimpleMCPClient-161"><span class="linenos">161</span></a>                    <span class="n">server_name</span><span class="p">,</span>
</span><span id="SimpleMCPClient-162"><a href="#SimpleMCPClient-162"><span class="linenos">162</span></a>                    <span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">],</span>
</span><span id="SimpleMCPClient-163"><a href="#SimpleMCPClient-163"><span class="linenos">163</span></a>                <span class="p">)</span>
</span><span id="SimpleMCPClient-164"><a href="#SimpleMCPClient-164"><span class="linenos">164</span></a>                <span class="k">return</span> <span class="n">tools</span>
</span><span id="SimpleMCPClient-165"><a href="#SimpleMCPClient-165"><span class="linenos">165</span></a>
</span><span id="SimpleMCPClient-166"><a href="#SimpleMCPClient-166"><span class="linenos">166</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient-167"><a href="#SimpleMCPClient-167"><span class="linenos">167</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error listing tools on server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient-168"><a href="#SimpleMCPClient-168"><span class="linenos">168</span></a>
</span><span id="SimpleMCPClient-169"><a href="#SimpleMCPClient-169"><span class="linenos">169</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span><span id="SimpleMCPClient-170"><a href="#SimpleMCPClient-170"><span class="linenos">170</span></a>
</span><span id="SimpleMCPClient-171"><a href="#SimpleMCPClient-171"><span class="linenos">171</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop_server_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SimpleMCPClient-172"><a href="#SimpleMCPClient-172"><span class="linenos">172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop a specific MCP server.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-173"><a href="#SimpleMCPClient-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">:</span>
</span><span id="SimpleMCPClient-174"><a href="#SimpleMCPClient-174"><span class="linenos">174</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;MCP server </span><span class="si">%s</span><span class="s2"> not running&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-175"><a href="#SimpleMCPClient-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient-176"><a href="#SimpleMCPClient-176"><span class="linenos">176</span></a>
</span><span id="SimpleMCPClient-177"><a href="#SimpleMCPClient-177"><span class="linenos">177</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient-178"><a href="#SimpleMCPClient-178"><span class="linenos">178</span></a>            <span class="n">server_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span>
</span><span id="SimpleMCPClient-179"><a href="#SimpleMCPClient-179"><span class="linenos">179</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span>
</span><span id="SimpleMCPClient-180"><a href="#SimpleMCPClient-180"><span class="linenos">180</span></a>
</span><span id="SimpleMCPClient-181"><a href="#SimpleMCPClient-181"><span class="linenos">181</span></a>            <span class="c1"># Terminate the process</span>
</span><span id="SimpleMCPClient-182"><a href="#SimpleMCPClient-182"><span class="linenos">182</span></a>            <span class="n">process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span id="SimpleMCPClient-183"><a href="#SimpleMCPClient-183"><span class="linenos">183</span></a>
</span><span id="SimpleMCPClient-184"><a href="#SimpleMCPClient-184"><span class="linenos">184</span></a>            <span class="c1"># Wait for it to exit gracefully</span>
</span><span id="SimpleMCPClient-185"><a href="#SimpleMCPClient-185"><span class="linenos">185</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient-186"><a href="#SimpleMCPClient-186"><span class="linenos">186</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SimpleMCPClient-187"><a href="#SimpleMCPClient-187"><span class="linenos">187</span></a>            <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
</span><span id="SimpleMCPClient-188"><a href="#SimpleMCPClient-188"><span class="linenos">188</span></a>                <span class="c1"># Force kill if it doesn&#39;t exit gracefully</span>
</span><span id="SimpleMCPClient-189"><a href="#SimpleMCPClient-189"><span class="linenos">189</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</span><span id="SimpleMCPClient-190"><a href="#SimpleMCPClient-190"><span class="linenos">190</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</span><span id="SimpleMCPClient-191"><a href="#SimpleMCPClient-191"><span class="linenos">191</span></a>
</span><span id="SimpleMCPClient-192"><a href="#SimpleMCPClient-192"><span class="linenos">192</span></a>            <span class="c1"># Remove from active servers</span>
</span><span id="SimpleMCPClient-193"><a href="#SimpleMCPClient-193"><span class="linenos">193</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span>
</span><span id="SimpleMCPClient-194"><a href="#SimpleMCPClient-194"><span class="linenos">194</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopped MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-195"><a href="#SimpleMCPClient-195"><span class="linenos">195</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient-196"><a href="#SimpleMCPClient-196"><span class="linenos">196</span></a>
</span><span id="SimpleMCPClient-197"><a href="#SimpleMCPClient-197"><span class="linenos">197</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient-198"><a href="#SimpleMCPClient-198"><span class="linenos">198</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error stopping MCP server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient-199"><a href="#SimpleMCPClient-199"><span class="linenos">199</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient-200"><a href="#SimpleMCPClient-200"><span class="linenos">200</span></a>
</span><span id="SimpleMCPClient-201"><a href="#SimpleMCPClient-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_servers</span><span class="p">(</span>
</span><span id="SimpleMCPClient-202"><a href="#SimpleMCPClient-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">server_configs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SimpleMCPClient-203"><a href="#SimpleMCPClient-203"><span class="linenos">203</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SimpleMCPClient-204"><a href="#SimpleMCPClient-204"><span class="linenos">204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start all configured MCP servers.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-205"><a href="#SimpleMCPClient-205"><span class="linenos">205</span></a>        <span class="n">configs</span> <span class="o">=</span> <span class="n">server_configs</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_configs</span>
</span><span id="SimpleMCPClient-206"><a href="#SimpleMCPClient-206"><span class="linenos">206</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient-207"><a href="#SimpleMCPClient-207"><span class="linenos">207</span></a>
</span><span id="SimpleMCPClient-208"><a href="#SimpleMCPClient-208"><span class="linenos">208</span></a>        <span class="k">for</span> <span class="n">server_name</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
</span><span id="SimpleMCPClient-209"><a href="#SimpleMCPClient-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_server_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">):</span>
</span><span id="SimpleMCPClient-210"><a href="#SimpleMCPClient-210"><span class="linenos">210</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to start MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-211"><a href="#SimpleMCPClient-211"><span class="linenos">211</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient-212"><a href="#SimpleMCPClient-212"><span class="linenos">212</span></a>
</span><span id="SimpleMCPClient-213"><a href="#SimpleMCPClient-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="n">success</span>
</span><span id="SimpleMCPClient-214"><a href="#SimpleMCPClient-214"><span class="linenos">214</span></a>
</span><span id="SimpleMCPClient-215"><a href="#SimpleMCPClient-215"><span class="linenos">215</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop_all_servers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SimpleMCPClient-216"><a href="#SimpleMCPClient-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop all active MCP servers.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient-217"><a href="#SimpleMCPClient-217"><span class="linenos">217</span></a>        <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">server_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SimpleMCPClient-218"><a href="#SimpleMCPClient-218"><span class="linenos">218</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient-219"><a href="#SimpleMCPClient-219"><span class="linenos">219</span></a>                <span class="n">process</span> <span class="o">=</span> <span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span>
</span><span id="SimpleMCPClient-220"><a href="#SimpleMCPClient-220"><span class="linenos">220</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span id="SimpleMCPClient-221"><a href="#SimpleMCPClient-221"><span class="linenos">221</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Wait up to 5 seconds</span>
</span><span id="SimpleMCPClient-222"><a href="#SimpleMCPClient-222"><span class="linenos">222</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopped MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient-223"><a href="#SimpleMCPClient-223"><span class="linenos">223</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient-224"><a href="#SimpleMCPClient-224"><span class="linenos">224</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error stopping MCP server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient-225"><a href="#SimpleMCPClient-225"><span class="linenos">225</span></a>
</span><span id="SimpleMCPClient-226"><a href="#SimpleMCPClient-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Simple MCP client based on the working test_mcp.py implementation.</p>
</div>


                            <div id="SimpleMCPClient.__init__" class="classattr">
                                        <input id="SimpleMCPClient.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SimpleMCPClient</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">server_configs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></span>)</span>

                <label class="view-source-button" for="SimpleMCPClient.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimpleMCPClient.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimpleMCPClient.__init__-19"><a href="#SimpleMCPClient.__init__-19"><span class="linenos">19</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_configs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
</span><span id="SimpleMCPClient.__init__-20"><a href="#SimpleMCPClient.__init__-20"><span class="linenos">20</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_configs</span> <span class="o">=</span> <span class="n">server_configs</span>
</span><span id="SimpleMCPClient.__init__-21"><a href="#SimpleMCPClient.__init__-21"><span class="linenos">21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="SimpleMCPClient.server_configs" class="classattr">
                                <div class="attr variable">
            <span class="name">server_configs</span>

        
    </div>
    <a class="headerlink" href="#SimpleMCPClient.server_configs"></a>
    
    

                            </div>
                            <div id="SimpleMCPClient.active_servers" class="classattr">
                                <div class="attr variable">
            <span class="name">active_servers</span>

        
    </div>
    <a class="headerlink" href="#SimpleMCPClient.active_servers"></a>
    
    

                            </div>
                            <div id="SimpleMCPClient.start_server_sync" class="classattr">
                                        <input id="SimpleMCPClient.start_server_sync-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_server_sync</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="SimpleMCPClient.start_server_sync-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimpleMCPClient.start_server_sync"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimpleMCPClient.start_server_sync-23"><a href="#SimpleMCPClient.start_server_sync-23"><span class="linenos">23</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_server_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-24"><a href="#SimpleMCPClient.start_server_sync-24"><span class="linenos">24</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start an MCP server process synchronously.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient.start_server_sync-25"><a href="#SimpleMCPClient.start_server_sync-25"><span class="linenos">25</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_configs</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-26"><a href="#SimpleMCPClient.start_server_sync-26"><span class="linenos">26</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient.start_server_sync-27"><a href="#SimpleMCPClient.start_server_sync-27"><span class="linenos">27</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient.start_server_sync-28"><a href="#SimpleMCPClient.start_server_sync-28"><span class="linenos">28</span></a>
</span><span id="SimpleMCPClient.start_server_sync-29"><a href="#SimpleMCPClient.start_server_sync-29"><span class="linenos">29</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-30"><a href="#SimpleMCPClient.start_server_sync-30"><span class="linenos">30</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MCP server </span><span class="si">%s</span><span class="s2"> already running&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient.start_server_sync-31"><a href="#SimpleMCPClient.start_server_sync-31"><span class="linenos">31</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient.start_server_sync-32"><a href="#SimpleMCPClient.start_server_sync-32"><span class="linenos">32</span></a>
</span><span id="SimpleMCPClient.start_server_sync-33"><a href="#SimpleMCPClient.start_server_sync-33"><span class="linenos">33</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_configs</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span>
</span><span id="SimpleMCPClient.start_server_sync-34"><a href="#SimpleMCPClient.start_server_sync-34"><span class="linenos">34</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-35"><a href="#SimpleMCPClient.start_server_sync-35"><span class="linenos">35</span></a>            <span class="c1"># Start the MCP server process</span>
</span><span id="SimpleMCPClient.start_server_sync-36"><a href="#SimpleMCPClient.start_server_sync-36"><span class="linenos">36</span></a>            <span class="c1"># Set working directory based on the server root path</span>
</span><span id="SimpleMCPClient.start_server_sync-37"><a href="#SimpleMCPClient.start_server_sync-37"><span class="linenos">37</span></a>            <span class="n">cwd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SimpleMCPClient.start_server_sync-38"><a href="#SimpleMCPClient.start_server_sync-38"><span class="linenos">38</span></a>            <span class="k">if</span> <span class="n">server_name</span> <span class="o">==</span> <span class="s2">&quot;filesystem-home&quot;</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-39"><a href="#SimpleMCPClient.start_server_sync-39"><span class="linenos">39</span></a>                <span class="n">cwd</span> <span class="o">=</span> <span class="n">ROOT_DIR</span>
</span><span id="SimpleMCPClient.start_server_sync-40"><a href="#SimpleMCPClient.start_server_sync-40"><span class="linenos">40</span></a>            <span class="k">elif</span> <span class="n">server_name</span> <span class="o">==</span> <span class="s2">&quot;filesystem-data&quot;</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-41"><a href="#SimpleMCPClient.start_server_sync-41"><span class="linenos">41</span></a>                <span class="n">cwd</span> <span class="o">=</span> <span class="n">DATA_DIR</span>
</span><span id="SimpleMCPClient.start_server_sync-42"><a href="#SimpleMCPClient.start_server_sync-42"><span class="linenos">42</span></a>
</span><span id="SimpleMCPClient.start_server_sync-43"><a href="#SimpleMCPClient.start_server_sync-43"><span class="linenos">43</span></a>            <span class="c1"># Prepare environment variables</span>
</span><span id="SimpleMCPClient.start_server_sync-44"><a href="#SimpleMCPClient.start_server_sync-44"><span class="linenos">44</span></a>            <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Start with current environment</span>
</span><span id="SimpleMCPClient.start_server_sync-45"><a href="#SimpleMCPClient.start_server_sync-45"><span class="linenos">45</span></a>            <span class="k">if</span> <span class="s2">&quot;env&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-46"><a href="#SimpleMCPClient.start_server_sync-46"><span class="linenos">46</span></a>                <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">])</span>  <span class="c1"># Add server-specific env vars</span>
</span><span id="SimpleMCPClient.start_server_sync-47"><a href="#SimpleMCPClient.start_server_sync-47"><span class="linenos">47</span></a>
</span><span id="SimpleMCPClient.start_server_sync-48"><a href="#SimpleMCPClient.start_server_sync-48"><span class="linenos">48</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="SimpleMCPClient.start_server_sync-49"><a href="#SimpleMCPClient.start_server_sync-49"><span class="linenos">49</span></a>                <span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">],</span>
</span><span id="SimpleMCPClient.start_server_sync-50"><a href="#SimpleMCPClient.start_server_sync-50"><span class="linenos">50</span></a>                <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="SimpleMCPClient.start_server_sync-51"><a href="#SimpleMCPClient.start_server_sync-51"><span class="linenos">51</span></a>                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="SimpleMCPClient.start_server_sync-52"><a href="#SimpleMCPClient.start_server_sync-52"><span class="linenos">52</span></a>                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="SimpleMCPClient.start_server_sync-53"><a href="#SimpleMCPClient.start_server_sync-53"><span class="linenos">53</span></a>                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SimpleMCPClient.start_server_sync-54"><a href="#SimpleMCPClient.start_server_sync-54"><span class="linenos">54</span></a>                <span class="n">bufsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="SimpleMCPClient.start_server_sync-55"><a href="#SimpleMCPClient.start_server_sync-55"><span class="linenos">55</span></a>                <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span>
</span><span id="SimpleMCPClient.start_server_sync-56"><a href="#SimpleMCPClient.start_server_sync-56"><span class="linenos">56</span></a>                <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>  <span class="c1"># Pass environment variables</span>
</span><span id="SimpleMCPClient.start_server_sync-57"><a href="#SimpleMCPClient.start_server_sync-57"><span class="linenos">57</span></a>            <span class="p">)</span>
</span><span id="SimpleMCPClient.start_server_sync-58"><a href="#SimpleMCPClient.start_server_sync-58"><span class="linenos">58</span></a>
</span><span id="SimpleMCPClient.start_server_sync-59"><a href="#SimpleMCPClient.start_server_sync-59"><span class="linenos">59</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="n">process</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">}</span>
</span><span id="SimpleMCPClient.start_server_sync-60"><a href="#SimpleMCPClient.start_server_sync-60"><span class="linenos">60</span></a>
</span><span id="SimpleMCPClient.start_server_sync-61"><a href="#SimpleMCPClient.start_server_sync-61"><span class="linenos">61</span></a>            <span class="c1"># Wait a moment for server to start</span>
</span><span id="SimpleMCPClient.start_server_sync-62"><a href="#SimpleMCPClient.start_server_sync-62"><span class="linenos">62</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SimpleMCPClient.start_server_sync-63"><a href="#SimpleMCPClient.start_server_sync-63"><span class="linenos">63</span></a>
</span><span id="SimpleMCPClient.start_server_sync-64"><a href="#SimpleMCPClient.start_server_sync-64"><span class="linenos">64</span></a>            <span class="c1"># Initialize the server</span>
</span><span id="SimpleMCPClient.start_server_sync-65"><a href="#SimpleMCPClient.start_server_sync-65"><span class="linenos">65</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_server_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">):</span>
</span><span id="SimpleMCPClient.start_server_sync-66"><a href="#SimpleMCPClient.start_server_sync-66"><span class="linenos">66</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient.start_server_sync-67"><a href="#SimpleMCPClient.start_server_sync-67"><span class="linenos">67</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient.start_server_sync-68"><a href="#SimpleMCPClient.start_server_sync-68"><span class="linenos">68</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-69"><a href="#SimpleMCPClient.start_server_sync-69"><span class="linenos">69</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to initialize MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient.start_server_sync-70"><a href="#SimpleMCPClient.start_server_sync-70"><span class="linenos">70</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient.start_server_sync-71"><a href="#SimpleMCPClient.start_server_sync-71"><span class="linenos">71</span></a>
</span><span id="SimpleMCPClient.start_server_sync-72"><a href="#SimpleMCPClient.start_server_sync-72"><span class="linenos">72</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_server_sync-73"><a href="#SimpleMCPClient.start_server_sync-73"><span class="linenos">73</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to start MCP server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient.start_server_sync-74"><a href="#SimpleMCPClient.start_server_sync-74"><span class="linenos">74</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Start an MCP server process synchronously.</p>
</div>


                            </div>
                            <div id="SimpleMCPClient.call_tool_sync" class="classattr">
                                        <input id="SimpleMCPClient.call_tool_sync-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">call_tool_sync</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SimpleMCPClient.call_tool_sync-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimpleMCPClient.call_tool_sync"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimpleMCPClient.call_tool_sync-126"><a href="#SimpleMCPClient.call_tool_sync-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">call_tool_sync</span><span class="p">(</span>
</span><span id="SimpleMCPClient.call_tool_sync-127"><a href="#SimpleMCPClient.call_tool_sync-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="SimpleMCPClient.call_tool_sync-128"><a href="#SimpleMCPClient.call_tool_sync-128"><span class="linenos">128</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SimpleMCPClient.call_tool_sync-129"><a href="#SimpleMCPClient.call_tool_sync-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Call a tool on an MCP server synchronously.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient.call_tool_sync-130"><a href="#SimpleMCPClient.call_tool_sync-130"><span class="linenos">130</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient.call_tool_sync-131"><a href="#SimpleMCPClient.call_tool_sync-131"><span class="linenos">131</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SimpleMCPClient.call_tool_sync-132"><a href="#SimpleMCPClient.call_tool_sync-132"><span class="linenos">132</span></a>                <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient.call_tool_sync-133"><a href="#SimpleMCPClient.call_tool_sync-133"><span class="linenos">133</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="SimpleMCPClient.call_tool_sync-134"><a href="#SimpleMCPClient.call_tool_sync-134"><span class="linenos">134</span></a>                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;tools/call&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient.call_tool_sync-135"><a href="#SimpleMCPClient.call_tool_sync-135"><span class="linenos">135</span></a>                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">arguments</span><span class="p">},</span>
</span><span id="SimpleMCPClient.call_tool_sync-136"><a href="#SimpleMCPClient.call_tool_sync-136"><span class="linenos">136</span></a>            <span class="p">}</span>
</span><span id="SimpleMCPClient.call_tool_sync-137"><a href="#SimpleMCPClient.call_tool_sync-137"><span class="linenos">137</span></a>
</span><span id="SimpleMCPClient.call_tool_sync-138"><a href="#SimpleMCPClient.call_tool_sync-138"><span class="linenos">138</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_request_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</span><span id="SimpleMCPClient.call_tool_sync-139"><a href="#SimpleMCPClient.call_tool_sync-139"><span class="linenos">139</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">):</span>
</span><span id="SimpleMCPClient.call_tool_sync-140"><a href="#SimpleMCPClient.call_tool_sync-140"><span class="linenos">140</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="SimpleMCPClient.call_tool_sync-141"><a href="#SimpleMCPClient.call_tool_sync-141"><span class="linenos">141</span></a>                <span class="k">if</span> <span class="n">content</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SimpleMCPClient.call_tool_sync-142"><a href="#SimpleMCPClient.call_tool_sync-142"><span class="linenos">142</span></a>                    <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;No response&quot;</span><span class="p">)</span>
</span><span id="SimpleMCPClient.call_tool_sync-143"><a href="#SimpleMCPClient.call_tool_sync-143"><span class="linenos">143</span></a>
</span><span id="SimpleMCPClient.call_tool_sync-144"><a href="#SimpleMCPClient.call_tool_sync-144"><span class="linenos">144</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient.call_tool_sync-145"><a href="#SimpleMCPClient.call_tool_sync-145"><span class="linenos">145</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="SimpleMCPClient.call_tool_sync-146"><a href="#SimpleMCPClient.call_tool_sync-146"><span class="linenos">146</span></a>                <span class="s2">&quot;Error calling tool </span><span class="si">%s</span><span class="s2"> on server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SimpleMCPClient.call_tool_sync-147"><a href="#SimpleMCPClient.call_tool_sync-147"><span class="linenos">147</span></a>            <span class="p">)</span>
</span><span id="SimpleMCPClient.call_tool_sync-148"><a href="#SimpleMCPClient.call_tool_sync-148"><span class="linenos">148</span></a>
</span><span id="SimpleMCPClient.call_tool_sync-149"><a href="#SimpleMCPClient.call_tool_sync-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error calling tool </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Call a tool on an MCP server synchronously.</p>
</div>


                            </div>
                            <div id="SimpleMCPClient.list_tools_sync" class="classattr">
                                        <input id="SimpleMCPClient.list_tools_sync-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_tools_sync</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="SimpleMCPClient.list_tools_sync-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimpleMCPClient.list_tools_sync"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimpleMCPClient.list_tools_sync-151"><a href="#SimpleMCPClient.list_tools_sync-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_tools_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="SimpleMCPClient.list_tools_sync-152"><a href="#SimpleMCPClient.list_tools_sync-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List available tools on an MCP server synchronously.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient.list_tools_sync-153"><a href="#SimpleMCPClient.list_tools_sync-153"><span class="linenos">153</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient.list_tools_sync-154"><a href="#SimpleMCPClient.list_tools_sync-154"><span class="linenos">154</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;tools/list&quot;</span><span class="p">}</span>
</span><span id="SimpleMCPClient.list_tools_sync-155"><a href="#SimpleMCPClient.list_tools_sync-155"><span class="linenos">155</span></a>
</span><span id="SimpleMCPClient.list_tools_sync-156"><a href="#SimpleMCPClient.list_tools_sync-156"><span class="linenos">156</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_request_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</span><span id="SimpleMCPClient.list_tools_sync-157"><a href="#SimpleMCPClient.list_tools_sync-157"><span class="linenos">157</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">):</span>
</span><span id="SimpleMCPClient.list_tools_sync-158"><a href="#SimpleMCPClient.list_tools_sync-158"><span class="linenos">158</span></a>                <span class="n">tools</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="SimpleMCPClient.list_tools_sync-159"><a href="#SimpleMCPClient.list_tools_sync-159"><span class="linenos">159</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SimpleMCPClient.list_tools_sync-160"><a href="#SimpleMCPClient.list_tools_sync-160"><span class="linenos">160</span></a>                    <span class="s2">&quot;Available tools on </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SimpleMCPClient.list_tools_sync-161"><a href="#SimpleMCPClient.list_tools_sync-161"><span class="linenos">161</span></a>                    <span class="n">server_name</span><span class="p">,</span>
</span><span id="SimpleMCPClient.list_tools_sync-162"><a href="#SimpleMCPClient.list_tools_sync-162"><span class="linenos">162</span></a>                    <span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">],</span>
</span><span id="SimpleMCPClient.list_tools_sync-163"><a href="#SimpleMCPClient.list_tools_sync-163"><span class="linenos">163</span></a>                <span class="p">)</span>
</span><span id="SimpleMCPClient.list_tools_sync-164"><a href="#SimpleMCPClient.list_tools_sync-164"><span class="linenos">164</span></a>                <span class="k">return</span> <span class="n">tools</span>
</span><span id="SimpleMCPClient.list_tools_sync-165"><a href="#SimpleMCPClient.list_tools_sync-165"><span class="linenos">165</span></a>
</span><span id="SimpleMCPClient.list_tools_sync-166"><a href="#SimpleMCPClient.list_tools_sync-166"><span class="linenos">166</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient.list_tools_sync-167"><a href="#SimpleMCPClient.list_tools_sync-167"><span class="linenos">167</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error listing tools on server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient.list_tools_sync-168"><a href="#SimpleMCPClient.list_tools_sync-168"><span class="linenos">168</span></a>
</span><span id="SimpleMCPClient.list_tools_sync-169"><a href="#SimpleMCPClient.list_tools_sync-169"><span class="linenos">169</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>List available tools on an MCP server synchronously.</p>
</div>


                            </div>
                            <div id="SimpleMCPClient.stop_server_sync" class="classattr">
                                        <input id="SimpleMCPClient.stop_server_sync-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_server_sync</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="SimpleMCPClient.stop_server_sync-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimpleMCPClient.stop_server_sync"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimpleMCPClient.stop_server_sync-171"><a href="#SimpleMCPClient.stop_server_sync-171"><span class="linenos">171</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop_server_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SimpleMCPClient.stop_server_sync-172"><a href="#SimpleMCPClient.stop_server_sync-172"><span class="linenos">172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop a specific MCP server.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient.stop_server_sync-173"><a href="#SimpleMCPClient.stop_server_sync-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">:</span>
</span><span id="SimpleMCPClient.stop_server_sync-174"><a href="#SimpleMCPClient.stop_server_sync-174"><span class="linenos">174</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;MCP server </span><span class="si">%s</span><span class="s2"> not running&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient.stop_server_sync-175"><a href="#SimpleMCPClient.stop_server_sync-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient.stop_server_sync-176"><a href="#SimpleMCPClient.stop_server_sync-176"><span class="linenos">176</span></a>
</span><span id="SimpleMCPClient.stop_server_sync-177"><a href="#SimpleMCPClient.stop_server_sync-177"><span class="linenos">177</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient.stop_server_sync-178"><a href="#SimpleMCPClient.stop_server_sync-178"><span class="linenos">178</span></a>            <span class="n">server_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span>
</span><span id="SimpleMCPClient.stop_server_sync-179"><a href="#SimpleMCPClient.stop_server_sync-179"><span class="linenos">179</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span>
</span><span id="SimpleMCPClient.stop_server_sync-180"><a href="#SimpleMCPClient.stop_server_sync-180"><span class="linenos">180</span></a>
</span><span id="SimpleMCPClient.stop_server_sync-181"><a href="#SimpleMCPClient.stop_server_sync-181"><span class="linenos">181</span></a>            <span class="c1"># Terminate the process</span>
</span><span id="SimpleMCPClient.stop_server_sync-182"><a href="#SimpleMCPClient.stop_server_sync-182"><span class="linenos">182</span></a>            <span class="n">process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span id="SimpleMCPClient.stop_server_sync-183"><a href="#SimpleMCPClient.stop_server_sync-183"><span class="linenos">183</span></a>
</span><span id="SimpleMCPClient.stop_server_sync-184"><a href="#SimpleMCPClient.stop_server_sync-184"><span class="linenos">184</span></a>            <span class="c1"># Wait for it to exit gracefully</span>
</span><span id="SimpleMCPClient.stop_server_sync-185"><a href="#SimpleMCPClient.stop_server_sync-185"><span class="linenos">185</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient.stop_server_sync-186"><a href="#SimpleMCPClient.stop_server_sync-186"><span class="linenos">186</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SimpleMCPClient.stop_server_sync-187"><a href="#SimpleMCPClient.stop_server_sync-187"><span class="linenos">187</span></a>            <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
</span><span id="SimpleMCPClient.stop_server_sync-188"><a href="#SimpleMCPClient.stop_server_sync-188"><span class="linenos">188</span></a>                <span class="c1"># Force kill if it doesn&#39;t exit gracefully</span>
</span><span id="SimpleMCPClient.stop_server_sync-189"><a href="#SimpleMCPClient.stop_server_sync-189"><span class="linenos">189</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</span><span id="SimpleMCPClient.stop_server_sync-190"><a href="#SimpleMCPClient.stop_server_sync-190"><span class="linenos">190</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</span><span id="SimpleMCPClient.stop_server_sync-191"><a href="#SimpleMCPClient.stop_server_sync-191"><span class="linenos">191</span></a>
</span><span id="SimpleMCPClient.stop_server_sync-192"><a href="#SimpleMCPClient.stop_server_sync-192"><span class="linenos">192</span></a>            <span class="c1"># Remove from active servers</span>
</span><span id="SimpleMCPClient.stop_server_sync-193"><a href="#SimpleMCPClient.stop_server_sync-193"><span class="linenos">193</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span>
</span><span id="SimpleMCPClient.stop_server_sync-194"><a href="#SimpleMCPClient.stop_server_sync-194"><span class="linenos">194</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopped MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient.stop_server_sync-195"><a href="#SimpleMCPClient.stop_server_sync-195"><span class="linenos">195</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient.stop_server_sync-196"><a href="#SimpleMCPClient.stop_server_sync-196"><span class="linenos">196</span></a>
</span><span id="SimpleMCPClient.stop_server_sync-197"><a href="#SimpleMCPClient.stop_server_sync-197"><span class="linenos">197</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient.stop_server_sync-198"><a href="#SimpleMCPClient.stop_server_sync-198"><span class="linenos">198</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error stopping MCP server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient.stop_server_sync-199"><a href="#SimpleMCPClient.stop_server_sync-199"><span class="linenos">199</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Stop a specific MCP server.</p>
</div>


                            </div>
                            <div id="SimpleMCPClient.start_servers" class="classattr">
                                        <input id="SimpleMCPClient.start_servers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_servers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">server_configs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="SimpleMCPClient.start_servers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimpleMCPClient.start_servers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimpleMCPClient.start_servers-201"><a href="#SimpleMCPClient.start_servers-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_servers</span><span class="p">(</span>
</span><span id="SimpleMCPClient.start_servers-202"><a href="#SimpleMCPClient.start_servers-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">server_configs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SimpleMCPClient.start_servers-203"><a href="#SimpleMCPClient.start_servers-203"><span class="linenos">203</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_servers-204"><a href="#SimpleMCPClient.start_servers-204"><span class="linenos">204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start all configured MCP servers.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient.start_servers-205"><a href="#SimpleMCPClient.start_servers-205"><span class="linenos">205</span></a>        <span class="n">configs</span> <span class="o">=</span> <span class="n">server_configs</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_configs</span>
</span><span id="SimpleMCPClient.start_servers-206"><a href="#SimpleMCPClient.start_servers-206"><span class="linenos">206</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SimpleMCPClient.start_servers-207"><a href="#SimpleMCPClient.start_servers-207"><span class="linenos">207</span></a>
</span><span id="SimpleMCPClient.start_servers-208"><a href="#SimpleMCPClient.start_servers-208"><span class="linenos">208</span></a>        <span class="k">for</span> <span class="n">server_name</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
</span><span id="SimpleMCPClient.start_servers-209"><a href="#SimpleMCPClient.start_servers-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_server_sync</span><span class="p">(</span><span class="n">server_name</span><span class="p">):</span>
</span><span id="SimpleMCPClient.start_servers-210"><a href="#SimpleMCPClient.start_servers-210"><span class="linenos">210</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to start MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient.start_servers-211"><a href="#SimpleMCPClient.start_servers-211"><span class="linenos">211</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SimpleMCPClient.start_servers-212"><a href="#SimpleMCPClient.start_servers-212"><span class="linenos">212</span></a>
</span><span id="SimpleMCPClient.start_servers-213"><a href="#SimpleMCPClient.start_servers-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="n">success</span>
</span></pre></div>


            <div class="docstring"><p>Start all configured MCP servers.</p>
</div>


                            </div>
                            <div id="SimpleMCPClient.stop_all_servers" class="classattr">
                                        <input id="SimpleMCPClient.stop_all_servers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_all_servers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SimpleMCPClient.stop_all_servers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SimpleMCPClient.stop_all_servers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SimpleMCPClient.stop_all_servers-215"><a href="#SimpleMCPClient.stop_all_servers-215"><span class="linenos">215</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop_all_servers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SimpleMCPClient.stop_all_servers-216"><a href="#SimpleMCPClient.stop_all_servers-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop all active MCP servers.&quot;&quot;&quot;</span>
</span><span id="SimpleMCPClient.stop_all_servers-217"><a href="#SimpleMCPClient.stop_all_servers-217"><span class="linenos">217</span></a>        <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">server_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SimpleMCPClient.stop_all_servers-218"><a href="#SimpleMCPClient.stop_all_servers-218"><span class="linenos">218</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SimpleMCPClient.stop_all_servers-219"><a href="#SimpleMCPClient.stop_all_servers-219"><span class="linenos">219</span></a>                <span class="n">process</span> <span class="o">=</span> <span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span>
</span><span id="SimpleMCPClient.stop_all_servers-220"><a href="#SimpleMCPClient.stop_all_servers-220"><span class="linenos">220</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span id="SimpleMCPClient.stop_all_servers-221"><a href="#SimpleMCPClient.stop_all_servers-221"><span class="linenos">221</span></a>                <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Wait up to 5 seconds</span>
</span><span id="SimpleMCPClient.stop_all_servers-222"><a href="#SimpleMCPClient.stop_all_servers-222"><span class="linenos">222</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopped MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="SimpleMCPClient.stop_all_servers-223"><a href="#SimpleMCPClient.stop_all_servers-223"><span class="linenos">223</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SimpleMCPClient.stop_all_servers-224"><a href="#SimpleMCPClient.stop_all_servers-224"><span class="linenos">224</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error stopping MCP server </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SimpleMCPClient.stop_all_servers-225"><a href="#SimpleMCPClient.stop_all_servers-225"><span class="linenos">225</span></a>
</span><span id="SimpleMCPClient.stop_all_servers-226"><a href="#SimpleMCPClient.stop_all_servers-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_servers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Stop all active MCP servers.</p>
</div>


                            </div>
                </section>
                <section id="create_agent_executor">
                            <input id="create_agent_executor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_agent_executor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">langchain_core</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseTool</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">langchain</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">AgentExecutor</span>:</span></span>

                <label class="view-source-button" for="create_agent_executor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_agent_executor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_agent_executor-17"><a href="#create_agent_executor-17"><span class="linenos">17</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_agent_executor</span><span class="p">(</span><span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseTool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AgentExecutor</span><span class="p">:</span>
</span><span id="create_agent_executor-18"><a href="#create_agent_executor-18"><span class="linenos">18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the ReAct agent executor with the provided tools.&quot;&quot;&quot;</span>
</span><span id="create_agent_executor-19"><a href="#create_agent_executor-19"><span class="linenos">19</span></a>
</span><span id="create_agent_executor-20"><a href="#create_agent_executor-20"><span class="linenos">20</span></a>    <span class="c1"># Initialize Ollama LLM</span>
</span><span id="create_agent_executor-21"><a href="#create_agent_executor-21"><span class="linenos">21</span></a>    <span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOllama</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">LLM_MODEL</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OLLAMA_URL</span><span class="p">)</span>
</span><span id="create_agent_executor-22"><a href="#create_agent_executor-22"><span class="linenos">22</span></a>
</span><span id="create_agent_executor-23"><a href="#create_agent_executor-23"><span class="linenos">23</span></a>    <span class="c1"># System prompt for the agent</span>
</span><span id="create_agent_executor-24"><a href="#create_agent_executor-24"><span class="linenos">24</span></a>    <span class="n">system_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are a helpful personal assistant with access to various tools for file operations, knowledge management, web search, and GitHub integration.</span>
</span><span id="create_agent_executor-25"><a href="#create_agent_executor-25"><span class="linenos">25</span></a>
</span><span id="create_agent_executor-26"><a href="#create_agent_executor-26"><span class="linenos">26</span></a><span class="s2">You have access to the following tools:</span>
</span><span id="create_agent_executor-27"><a href="#create_agent_executor-27"><span class="linenos">27</span></a><span class="si">{tools}</span>
</span><span id="create_agent_executor-28"><a href="#create_agent_executor-28"><span class="linenos">28</span></a>
</span><span id="create_agent_executor-29"><a href="#create_agent_executor-29"><span class="linenos">29</span></a><span class="s2">Use the following format:</span>
</span><span id="create_agent_executor-30"><a href="#create_agent_executor-30"><span class="linenos">30</span></a>
</span><span id="create_agent_executor-31"><a href="#create_agent_executor-31"><span class="linenos">31</span></a><span class="s2">Question: the input question you must answer</span>
</span><span id="create_agent_executor-32"><a href="#create_agent_executor-32"><span class="linenos">32</span></a><span class="s2">Thought: you should always think about what to do</span>
</span><span id="create_agent_executor-33"><a href="#create_agent_executor-33"><span class="linenos">33</span></a><span class="s2">Action: the action to take, should be one of [</span><span class="si">{tool_names}</span><span class="s2">]</span>
</span><span id="create_agent_executor-34"><a href="#create_agent_executor-34"><span class="linenos">34</span></a><span class="s2">Action Input: the input to the action as valid JSON (e.g., {{&quot;param1&quot;: &quot;value1&quot;, &quot;param2&quot;: &quot;value2&quot;}})</span>
</span><span id="create_agent_executor-35"><a href="#create_agent_executor-35"><span class="linenos">35</span></a><span class="s2">Observation: the result of the action</span>
</span><span id="create_agent_executor-36"><a href="#create_agent_executor-36"><span class="linenos">36</span></a><span class="s2">... (this Thought/Action/Action Input/Observation can repeat N times)</span>
</span><span id="create_agent_executor-37"><a href="#create_agent_executor-37"><span class="linenos">37</span></a><span class="s2">Thought: I now know the final answer</span>
</span><span id="create_agent_executor-38"><a href="#create_agent_executor-38"><span class="linenos">38</span></a><span class="s2">Final Answer: the final answer to the original input question</span>
</span><span id="create_agent_executor-39"><a href="#create_agent_executor-39"><span class="linenos">39</span></a>
</span><span id="create_agent_executor-40"><a href="#create_agent_executor-40"><span class="linenos">40</span></a><span class="s2">IMPORTANT: Action Input must be valid JSON format. For example:</span>
</span><span id="create_agent_executor-41"><a href="#create_agent_executor-41"><span class="linenos">41</span></a><span class="s2">- Correct: {{&quot;file_path&quot;: &quot;~/test.txt&quot;, &quot;content&quot;: &quot;Hello world&quot;}}</span>
</span><span id="create_agent_executor-42"><a href="#create_agent_executor-42"><span class="linenos">42</span></a><span class="s2">- Incorrect: file_path = &#39;~/test.txt&#39;, content = &#39;&#39;&#39;Hello world&#39;&#39;&#39;</span>
</span><span id="create_agent_executor-43"><a href="#create_agent_executor-43"><span class="linenos">43</span></a>
</span><span id="create_agent_executor-44"><a href="#create_agent_executor-44"><span class="linenos">44</span></a><span class="s2">When storing information, always use a relevant topic to categorize it for better retrieval.</span>
</span><span id="create_agent_executor-45"><a href="#create_agent_executor-45"><span class="linenos">45</span></a><span class="s2">When working with files, prefer using absolute paths and be careful about file permissions.</span>
</span><span id="create_agent_executor-46"><a href="#create_agent_executor-46"><span class="linenos">46</span></a><span class="s2">Always store important interactions in memory for future reference. When asked about Github</span>
</span><span id="create_agent_executor-47"><a href="#create_agent_executor-47"><span class="linenos">47</span></a><span class="s2">repositories, use the GitHub tool to search for repositories and provide relevant information.</span>
</span><span id="create_agent_executor-48"><a href="#create_agent_executor-48"><span class="linenos">48</span></a><span class="s2">When asked about the weather, use the weather tool to get current conditions. When asked about</span>
</span><span id="create_agent_executor-49"><a href="#create_agent_executor-49"><span class="linenos">49</span></a><span class="s2">the news, use the news tool to get the latest headlines.</span>
</span><span id="create_agent_executor-50"><a href="#create_agent_executor-50"><span class="linenos">50</span></a>
</span><span id="create_agent_executor-51"><a href="#create_agent_executor-51"><span class="linenos">51</span></a><span class="s2">Begin!</span>
</span><span id="create_agent_executor-52"><a href="#create_agent_executor-52"><span class="linenos">52</span></a>
</span><span id="create_agent_executor-53"><a href="#create_agent_executor-53"><span class="linenos">53</span></a><span class="s2">Question: </span><span class="si">{input}</span>
</span><span id="create_agent_executor-54"><a href="#create_agent_executor-54"><span class="linenos">54</span></a><span class="s2">Thought: </span><span class="si">{agent_scratchpad}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="create_agent_executor-55"><a href="#create_agent_executor-55"><span class="linenos">55</span></a>
</span><span id="create_agent_executor-56"><a href="#create_agent_executor-56"><span class="linenos">56</span></a>    <span class="c1"># Create prompt template</span>
</span><span id="create_agent_executor-57"><a href="#create_agent_executor-57"><span class="linenos">57</span></a>    <span class="n">prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">)</span>
</span><span id="create_agent_executor-58"><a href="#create_agent_executor-58"><span class="linenos">58</span></a>
</span><span id="create_agent_executor-59"><a href="#create_agent_executor-59"><span class="linenos">59</span></a>    <span class="c1"># Create the ReAct agent</span>
</span><span id="create_agent_executor-60"><a href="#create_agent_executor-60"><span class="linenos">60</span></a>    <span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
</span><span id="create_agent_executor-61"><a href="#create_agent_executor-61"><span class="linenos">61</span></a>
</span><span id="create_agent_executor-62"><a href="#create_agent_executor-62"><span class="linenos">62</span></a>    <span class="c1"># Create agent executor</span>
</span><span id="create_agent_executor-63"><a href="#create_agent_executor-63"><span class="linenos">63</span></a>    <span class="n">agent_executor</span> <span class="o">=</span> <span class="n">AgentExecutor</span><span class="p">(</span>
</span><span id="create_agent_executor-64"><a href="#create_agent_executor-64"><span class="linenos">64</span></a>        <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span>
</span><span id="create_agent_executor-65"><a href="#create_agent_executor-65"><span class="linenos">65</span></a>        <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span><span id="create_agent_executor-66"><a href="#create_agent_executor-66"><span class="linenos">66</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="create_agent_executor-67"><a href="#create_agent_executor-67"><span class="linenos">67</span></a>        <span class="n">max_iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="create_agent_executor-68"><a href="#create_agent_executor-68"><span class="linenos">68</span></a>        <span class="n">handle_parsing_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="create_agent_executor-69"><a href="#create_agent_executor-69"><span class="linenos">69</span></a>    <span class="p">)</span>
</span><span id="create_agent_executor-70"><a href="#create_agent_executor-70"><span class="linenos">70</span></a>
</span><span id="create_agent_executor-71"><a href="#create_agent_executor-71"><span class="linenos">71</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created agent executor with </span><span class="si">%d</span><span class="s2"> tools&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tools</span><span class="p">))</span>
</span><span id="create_agent_executor-72"><a href="#create_agent_executor-72"><span class="linenos">72</span></a>    <span class="k">return</span> <span class="n">agent_executor</span>
</span></pre></div>


            <div class="docstring"><p>Create the ReAct agent executor with the provided tools.</p>
</div>


                </section>
                <section id="setup_weaviate">
                            <input id="setup_weaviate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup_weaviate</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="setup_weaviate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#setup_weaviate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="setup_weaviate-31"><a href="#setup_weaviate-31"><span class="linenos"> 31</span></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_weaviate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="setup_weaviate-32"><a href="#setup_weaviate-32"><span class="linenos"> 32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="setup_weaviate-33"><a href="#setup_weaviate-33"><span class="linenos"> 33</span></a><span class="sd">    Setup Weaviate client and vector store. Returns True if successful.</span>
</span><span id="setup_weaviate-34"><a href="#setup_weaviate-34"><span class="linenos"> 34</span></a>
</span><span id="setup_weaviate-35"><a href="#setup_weaviate-35"><span class="linenos"> 35</span></a><span class="sd">    :return: True if Weaviate setup succeeded, False otherwise</span>
</span><span id="setup_weaviate-36"><a href="#setup_weaviate-36"><span class="linenos"> 36</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="setup_weaviate-37"><a href="#setup_weaviate-37"><span class="linenos"> 37</span></a>    <span class="k">global</span> <span class="n">vector_store</span><span class="p">,</span> <span class="n">weaviate_client</span>
</span><span id="setup_weaviate-38"><a href="#setup_weaviate-38"><span class="linenos"> 38</span></a>
</span><span id="setup_weaviate-39"><a href="#setup_weaviate-39"><span class="linenos"> 39</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">USE_WEAVIATE</span><span class="p">:</span>
</span><span id="setup_weaviate-40"><a href="#setup_weaviate-40"><span class="linenos"> 40</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Weaviate disabled by configuration&quot;</span><span class="p">)</span>
</span><span id="setup_weaviate-41"><a href="#setup_weaviate-41"><span class="linenos"> 41</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="setup_weaviate-42"><a href="#setup_weaviate-42"><span class="linenos"> 42</span></a>
</span><span id="setup_weaviate-43"><a href="#setup_weaviate-43"><span class="linenos"> 43</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="setup_weaviate-44"><a href="#setup_weaviate-44"><span class="linenos"> 44</span></a>        <span class="c1"># Verify Weaviate is running with retries</span>
</span><span id="setup_weaviate-45"><a href="#setup_weaviate-45"><span class="linenos"> 45</span></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="setup_weaviate-46"><a href="#setup_weaviate-46"><span class="linenos"> 46</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="setup_weaviate-47"><a href="#setup_weaviate-47"><span class="linenos"> 47</span></a>                <span class="s2">&quot;Attempting to connect to Weaviate at </span><span class="si">%s</span><span class="s2"> (attempt </span><span class="si">%d</span><span class="s2">/5)&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-48"><a href="#setup_weaviate-48"><span class="linenos"> 48</span></a>                <span class="n">WEAVIATE_URL</span><span class="p">,</span>
</span><span id="setup_weaviate-49"><a href="#setup_weaviate-49"><span class="linenos"> 49</span></a>                <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="setup_weaviate-50"><a href="#setup_weaviate-50"><span class="linenos"> 50</span></a>            <span class="p">)</span>
</span><span id="setup_weaviate-51"><a href="#setup_weaviate-51"><span class="linenos"> 51</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">WEAVIATE_URL</span><span class="si">}</span><span class="s2">/v1/.well-known/ready&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="setup_weaviate-52"><a href="#setup_weaviate-52"><span class="linenos"> 52</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="setup_weaviate-53"><a href="#setup_weaviate-53"><span class="linenos"> 53</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Weaviate is ready&quot;</span><span class="p">)</span>
</span><span id="setup_weaviate-54"><a href="#setup_weaviate-54"><span class="linenos"> 54</span></a>                <span class="k">break</span>
</span><span id="setup_weaviate-55"><a href="#setup_weaviate-55"><span class="linenos"> 55</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="setup_weaviate-56"><a href="#setup_weaviate-56"><span class="linenos"> 56</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weaviate returned status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="setup_weaviate-57"><a href="#setup_weaviate-57"><span class="linenos"> 57</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="setup_weaviate-58"><a href="#setup_weaviate-58"><span class="linenos"> 58</span></a>            <span class="c1"># If we&#39;ve exhausted all attempts</span>
</span><span id="setup_weaviate-59"><a href="#setup_weaviate-59"><span class="linenos"> 59</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="setup_weaviate-60"><a href="#setup_weaviate-60"><span class="linenos"> 60</span></a>                <span class="s2">&quot;Cannot connect to Weaviate at </span><span class="si">%s</span><span class="s2"> after 5 attempts&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-61"><a href="#setup_weaviate-61"><span class="linenos"> 61</span></a>                <span class="n">WEAVIATE_URL</span><span class="p">,</span>
</span><span id="setup_weaviate-62"><a href="#setup_weaviate-62"><span class="linenos"> 62</span></a>            <span class="p">)</span>
</span><span id="setup_weaviate-63"><a href="#setup_weaviate-63"><span class="linenos"> 63</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="setup_weaviate-64"><a href="#setup_weaviate-64"><span class="linenos"> 64</span></a>
</span><span id="setup_weaviate-65"><a href="#setup_weaviate-65"><span class="linenos"> 65</span></a>    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="setup_weaviate-66"><a href="#setup_weaviate-66"><span class="linenos"> 66</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Attempt </span><span class="si">%d</span><span class="s2">/5: Error connecting to Weaviate: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="setup_weaviate-67"><a href="#setup_weaviate-67"><span class="linenos"> 67</span></a>        <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="setup_weaviate-68"><a href="#setup_weaviate-68"><span class="linenos"> 68</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="setup_weaviate-69"><a href="#setup_weaviate-69"><span class="linenos"> 69</span></a>                <span class="s2">&quot;Cannot connect to Weaviate at </span><span class="si">%s</span><span class="s2">, proceeding without Weaviate&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-70"><a href="#setup_weaviate-70"><span class="linenos"> 70</span></a>                <span class="n">WEAVIATE_URL</span><span class="p">,</span>
</span><span id="setup_weaviate-71"><a href="#setup_weaviate-71"><span class="linenos"> 71</span></a>            <span class="p">)</span>
</span><span id="setup_weaviate-72"><a href="#setup_weaviate-72"><span class="linenos"> 72</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="setup_weaviate-73"><a href="#setup_weaviate-73"><span class="linenos"> 73</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="setup_weaviate-74"><a href="#setup_weaviate-74"><span class="linenos"> 74</span></a>
</span><span id="setup_weaviate-75"><a href="#setup_weaviate-75"><span class="linenos"> 75</span></a>    <span class="c1"># Parse WEAVIATE_URL to create ConnectionParams</span>
</span><span id="setup_weaviate-76"><a href="#setup_weaviate-76"><span class="linenos"> 76</span></a>    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">parse_url</span><span class="p">(</span><span class="n">WEAVIATE_URL</span><span class="p">)</span>
</span><span id="setup_weaviate-77"><a href="#setup_weaviate-77"><span class="linenos"> 77</span></a>    <span class="n">connection_params</span> <span class="o">=</span> <span class="n">ConnectionParams</span><span class="o">.</span><span class="n">from_params</span><span class="p">(</span>
</span><span id="setup_weaviate-78"><a href="#setup_weaviate-78"><span class="linenos"> 78</span></a>        <span class="n">http_host</span><span class="o">=</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">host</span> <span class="ow">or</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-79"><a href="#setup_weaviate-79"><span class="linenos"> 79</span></a>        <span class="n">http_port</span><span class="o">=</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">port</span> <span class="ow">or</span> <span class="mi">8080</span><span class="p">,</span>
</span><span id="setup_weaviate-80"><a href="#setup_weaviate-80"><span class="linenos"> 80</span></a>        <span class="n">http_secure</span><span class="o">=</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-81"><a href="#setup_weaviate-81"><span class="linenos"> 81</span></a>        <span class="n">grpc_host</span><span class="o">=</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">host</span> <span class="ow">or</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-82"><a href="#setup_weaviate-82"><span class="linenos"> 82</span></a>        <span class="n">grpc_port</span><span class="o">=</span><span class="mi">50051</span><span class="p">,</span>  <span class="c1"># Weaviate&#39;s default gRPC port</span>
</span><span id="setup_weaviate-83"><a href="#setup_weaviate-83"><span class="linenos"> 83</span></a>        <span class="n">grpc_secure</span><span class="o">=</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-84"><a href="#setup_weaviate-84"><span class="linenos"> 84</span></a>    <span class="p">)</span>
</span><span id="setup_weaviate-85"><a href="#setup_weaviate-85"><span class="linenos"> 85</span></a>
</span><span id="setup_weaviate-86"><a href="#setup_weaviate-86"><span class="linenos"> 86</span></a>    <span class="c1"># Initialize Weaviate client !!!</span>
</span><span id="setup_weaviate-87"><a href="#setup_weaviate-87"><span class="linenos"> 87</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="setup_weaviate-88"><a href="#setup_weaviate-88"><span class="linenos"> 88</span></a>        <span class="n">weaviate_client</span> <span class="o">=</span> <span class="n">WeaviateClient</span><span class="p">(</span>
</span><span id="setup_weaviate-89"><a href="#setup_weaviate-89"><span class="linenos"> 89</span></a>            <span class="n">connection_params</span><span class="p">,</span>
</span><span id="setup_weaviate-90"><a href="#setup_weaviate-90"><span class="linenos"> 90</span></a>            <span class="n">skip_init_checks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="setup_weaviate-91"><a href="#setup_weaviate-91"><span class="linenos"> 91</span></a>            <span class="n">additional_headers</span><span class="o">=</span><span class="p">{</span>
</span><span id="setup_weaviate-92"><a href="#setup_weaviate-92"><span class="linenos"> 92</span></a>                <span class="s2">&quot;X-OpenAI-Api-Key&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span>
</span><span id="setup_weaviate-93"><a href="#setup_weaviate-93"><span class="linenos"> 93</span></a>                    <span class="s2">&quot;OPENAI_API_KEY&quot;</span>
</span><span id="setup_weaviate-94"><a href="#setup_weaviate-94"><span class="linenos"> 94</span></a>                <span class="p">]</span>  <span class="c1"># Add inference API keys as needed</span>
</span><span id="setup_weaviate-95"><a href="#setup_weaviate-95"><span class="linenos"> 95</span></a>            <span class="p">},</span>
</span><span id="setup_weaviate-96"><a href="#setup_weaviate-96"><span class="linenos"> 96</span></a>        <span class="p">)</span>
</span><span id="setup_weaviate-97"><a href="#setup_weaviate-97"><span class="linenos"> 97</span></a>        <span class="n">weaviate_client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>  <span class="c1"># Explicitly connect</span>
</span><span id="setup_weaviate-98"><a href="#setup_weaviate-98"><span class="linenos"> 98</span></a>        <span class="n">collection_name</span> <span class="o">=</span> <span class="s2">&quot;UserKnowledgeBase&quot;</span>
</span><span id="setup_weaviate-99"><a href="#setup_weaviate-99"><span class="linenos"> 99</span></a>
</span><span id="setup_weaviate-100"><a href="#setup_weaviate-100"><span class="linenos">100</span></a>        <span class="c1"># Create Weaviate collection if it doesn&#39;t exist</span>
</span><span id="setup_weaviate-101"><a href="#setup_weaviate-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">weaviate_client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
</span><span id="setup_weaviate-102"><a href="#setup_weaviate-102"><span class="linenos">102</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Weaviate collection: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">)</span>
</span><span id="setup_weaviate-103"><a href="#setup_weaviate-103"><span class="linenos">103</span></a>            <span class="n">weaviate_client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span id="setup_weaviate-104"><a href="#setup_weaviate-104"><span class="linenos">104</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
</span><span id="setup_weaviate-105"><a href="#setup_weaviate-105"><span class="linenos">105</span></a>                <span class="n">properties</span><span class="o">=</span><span class="p">[</span>
</span><span id="setup_weaviate-106"><a href="#setup_weaviate-106"><span class="linenos">106</span></a>                    <span class="n">wvc</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">wvc</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>
</span><span id="setup_weaviate-107"><a href="#setup_weaviate-107"><span class="linenos">107</span></a>                    <span class="n">wvc</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">wvc</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">DATE</span><span class="p">),</span>
</span><span id="setup_weaviate-108"><a href="#setup_weaviate-108"><span class="linenos">108</span></a>                    <span class="n">wvc</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;topic&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">wvc</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>
</span><span id="setup_weaviate-109"><a href="#setup_weaviate-109"><span class="linenos">109</span></a>                <span class="p">],</span>
</span><span id="setup_weaviate-110"><a href="#setup_weaviate-110"><span class="linenos">110</span></a>                <span class="n">vectorizer_config</span><span class="o">=</span><span class="n">wvc</span><span class="o">.</span><span class="n">Configure</span><span class="o">.</span><span class="n">Vectorizer</span><span class="o">.</span><span class="n">text2vec_ollama</span><span class="p">(</span>
</span><span id="setup_weaviate-111"><a href="#setup_weaviate-111"><span class="linenos">111</span></a>                    <span class="n">api_endpoint</span><span class="o">=</span><span class="s2">&quot;http://host.docker.internal:11434&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-112"><a href="#setup_weaviate-112"><span class="linenos">112</span></a>                    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;nomic-embed-text&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-113"><a href="#setup_weaviate-113"><span class="linenos">113</span></a>                <span class="p">),</span>
</span><span id="setup_weaviate-114"><a href="#setup_weaviate-114"><span class="linenos">114</span></a>            <span class="p">)</span>
</span><span id="setup_weaviate-115"><a href="#setup_weaviate-115"><span class="linenos">115</span></a>    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="setup_weaviate-116"><a href="#setup_weaviate-116"><span class="linenos">116</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Import error initializing Weaviate client or collection: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="setup_weaviate-117"><a href="#setup_weaviate-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="setup_weaviate-118"><a href="#setup_weaviate-118"><span class="linenos">118</span></a>    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="setup_weaviate-119"><a href="#setup_weaviate-119"><span class="linenos">119</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="setup_weaviate-120"><a href="#setup_weaviate-120"><span class="linenos">120</span></a>            <span class="s2">&quot;Attribute error initializing Weaviate client or collection: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="setup_weaviate-121"><a href="#setup_weaviate-121"><span class="linenos">121</span></a>        <span class="p">)</span>
</span><span id="setup_weaviate-122"><a href="#setup_weaviate-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="setup_weaviate-123"><a href="#setup_weaviate-123"><span class="linenos">123</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="setup_weaviate-124"><a href="#setup_weaviate-124"><span class="linenos">124</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="setup_weaviate-125"><a href="#setup_weaviate-125"><span class="linenos">125</span></a>            <span class="s2">&quot;Unexpected error initializing Weaviate client or collection: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="setup_weaviate-126"><a href="#setup_weaviate-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="setup_weaviate-127"><a href="#setup_weaviate-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="setup_weaviate-128"><a href="#setup_weaviate-128"><span class="linenos">128</span></a>
</span><span id="setup_weaviate-129"><a href="#setup_weaviate-129"><span class="linenos">129</span></a>    <span class="c1"># Initialize Weaviate vector store</span>
</span><span id="setup_weaviate-130"><a href="#setup_weaviate-130"><span class="linenos">130</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="setup_weaviate-131"><a href="#setup_weaviate-131"><span class="linenos">131</span></a>        <span class="n">vector_store</span> <span class="o">=</span> <span class="n">WeaviateVectorStore</span><span class="p">(</span>
</span><span id="setup_weaviate-132"><a href="#setup_weaviate-132"><span class="linenos">132</span></a>            <span class="n">client</span><span class="o">=</span><span class="n">weaviate_client</span><span class="p">,</span>
</span><span id="setup_weaviate-133"><a href="#setup_weaviate-133"><span class="linenos">133</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
</span><span id="setup_weaviate-134"><a href="#setup_weaviate-134"><span class="linenos">134</span></a>            <span class="n">text_key</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="setup_weaviate-135"><a href="#setup_weaviate-135"><span class="linenos">135</span></a>            <span class="n">embedding</span><span class="o">=</span><span class="n">OllamaEmbeddings</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;nomic-embed-text&quot;</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OLLAMA_URL</span><span class="p">),</span>
</span><span id="setup_weaviate-136"><a href="#setup_weaviate-136"><span class="linenos">136</span></a>            <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;topic&quot;</span><span class="p">],</span>
</span><span id="setup_weaviate-137"><a href="#setup_weaviate-137"><span class="linenos">137</span></a>        <span class="p">)</span>
</span><span id="setup_weaviate-138"><a href="#setup_weaviate-138"><span class="linenos">138</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully initialized Weaviate vector store&quot;</span><span class="p">)</span>
</span><span id="setup_weaviate-139"><a href="#setup_weaviate-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="setup_weaviate-140"><a href="#setup_weaviate-140"><span class="linenos">140</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="setup_weaviate-141"><a href="#setup_weaviate-141"><span class="linenos">141</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error initializing vector store: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="setup_weaviate-142"><a href="#setup_weaviate-142"><span class="linenos">142</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Setup Weaviate client and vector store. Returns True if successful.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>True if Weaviate setup succeeded, False otherwise</p>
</blockquote>
</div>


                </section>
                <section id="is_weaviate_connected">
                            <input id="is_weaviate_connected-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_weaviate_connected</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="is_weaviate_connected-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#is_weaviate_connected"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="is_weaviate_connected-145"><a href="#is_weaviate_connected-145"><span class="linenos">145</span></a><span class="k">def</span><span class="w"> </span><span class="nf">is_weaviate_connected</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="is_weaviate_connected-146"><a href="#is_weaviate_connected-146"><span class="linenos">146</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="is_weaviate_connected-147"><a href="#is_weaviate_connected-147"><span class="linenos">147</span></a><span class="sd">    Check if Weaviate is available and connected.</span>
</span><span id="is_weaviate_connected-148"><a href="#is_weaviate_connected-148"><span class="linenos">148</span></a>
</span><span id="is_weaviate_connected-149"><a href="#is_weaviate_connected-149"><span class="linenos">149</span></a><span class="sd">    :return: True if Weaviate is connected and ready, False otherwise</span>
</span><span id="is_weaviate_connected-150"><a href="#is_weaviate_connected-150"><span class="linenos">150</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="is_weaviate_connected-151"><a href="#is_weaviate_connected-151"><span class="linenos">151</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">USE_WEAVIATE</span><span class="p">:</span>
</span><span id="is_weaviate_connected-152"><a href="#is_weaviate_connected-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="is_weaviate_connected-153"><a href="#is_weaviate_connected-153"><span class="linenos">153</span></a>
</span><span id="is_weaviate_connected-154"><a href="#is_weaviate_connected-154"><span class="linenos">154</span></a>    <span class="k">if</span> <span class="n">weaviate_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="is_weaviate_connected-155"><a href="#is_weaviate_connected-155"><span class="linenos">155</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="is_weaviate_connected-156"><a href="#is_weaviate_connected-156"><span class="linenos">156</span></a>
</span><span id="is_weaviate_connected-157"><a href="#is_weaviate_connected-157"><span class="linenos">157</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="is_weaviate_connected-158"><a href="#is_weaviate_connected-158"><span class="linenos">158</span></a>        <span class="c1"># Check if Weaviate is ready via HTTP endpoint</span>
</span><span id="is_weaviate_connected-159"><a href="#is_weaviate_connected-159"><span class="linenos">159</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">WEAVIATE_URL</span><span class="si">}</span><span class="s2">/v1/.well-known/ready&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="is_weaviate_connected-160"><a href="#is_weaviate_connected-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="is_weaviate_connected-161"><a href="#is_weaviate_connected-161"><span class="linenos">161</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="is_weaviate_connected-162"><a href="#is_weaviate_connected-162"><span class="linenos">162</span></a>
</span><span id="is_weaviate_connected-163"><a href="#is_weaviate_connected-163"><span class="linenos">163</span></a>        <span class="c1"># Additionally check database health and attempt recovery if needed</span>
</span><span id="is_weaviate_connected-164"><a href="#is_weaviate_connected-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="n">reset_weaviate_if_corrupted</span><span class="p">()</span>
</span><span id="is_weaviate_connected-165"><a href="#is_weaviate_connected-165"><span class="linenos">165</span></a>
</span><span id="is_weaviate_connected-166"><a href="#is_weaviate_connected-166"><span class="linenos">166</span></a>    <span class="k">except</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="is_weaviate_connected-167"><a href="#is_weaviate_connected-167"><span class="linenos">167</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Weaviate connection check failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="is_weaviate_connected-168"><a href="#is_weaviate_connected-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check if Weaviate is available and connected.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>True if Weaviate is connected and ready, False otherwise</p>
</blockquote>
</div>


                </section>
                <section id="vector_store">
                    <div class="attr variable">
            <span class="name">vector_store</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#vector_store"></a>
    
    

                </section>
                <section id="weaviate_client">
                    <div class="attr variable">
            <span class="name">weaviate_client</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#weaviate_client"></a>
    
    

                </section>
                <section id="AgnoPersonalAgent">
                            <input id="AgnoPersonalAgent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AgnoPersonalAgent</span>:

                <label class="view-source-button" for="AgnoPersonalAgent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent-68"><a href="#AgnoPersonalAgent-68"><span class="linenos"> 68</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AgnoPersonalAgent</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-69"><a href="#AgnoPersonalAgent-69"><span class="linenos"> 69</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-70"><a href="#AgnoPersonalAgent-70"><span class="linenos"> 70</span></a><span class="sd">    Refactored Agno-based Personal AI Agent with MCP integration and native storage.</span>
</span><span id="AgnoPersonalAgent-71"><a href="#AgnoPersonalAgent-71"><span class="linenos"> 71</span></a>
</span><span id="AgnoPersonalAgent-72"><a href="#AgnoPersonalAgent-72"><span class="linenos"> 72</span></a><span class="sd">    This class coordinates the different components of the agent system,</span>
</span><span id="AgnoPersonalAgent-73"><a href="#AgnoPersonalAgent-73"><span class="linenos"> 73</span></a><span class="sd">    delegating specific responsibilities to specialized manager classes.</span>
</span><span id="AgnoPersonalAgent-74"><a href="#AgnoPersonalAgent-74"><span class="linenos"> 74</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-75"><a href="#AgnoPersonalAgent-75"><span class="linenos"> 75</span></a>
</span><span id="AgnoPersonalAgent-76"><a href="#AgnoPersonalAgent-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-77"><a href="#AgnoPersonalAgent-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-78"><a href="#AgnoPersonalAgent-78"><span class="linenos"> 78</span></a>        <span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ollama&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-79"><a href="#AgnoPersonalAgent-79"><span class="linenos"> 79</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">LLM_MODEL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-80"><a href="#AgnoPersonalAgent-80"><span class="linenos"> 80</span></a>        <span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-81"><a href="#AgnoPersonalAgent-81"><span class="linenos"> 81</span></a>        <span class="n">enable_mcp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-82"><a href="#AgnoPersonalAgent-82"><span class="linenos"> 82</span></a>        <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AGNO_STORAGE_DIR</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-83"><a href="#AgnoPersonalAgent-83"><span class="linenos"> 83</span></a>        <span class="n">knowledge_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-84"><a href="#AgnoPersonalAgent-84"><span class="linenos"> 84</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-85"><a href="#AgnoPersonalAgent-85"><span class="linenos"> 85</span></a>        <span class="n">ollama_base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OLLAMA_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-86"><a href="#AgnoPersonalAgent-86"><span class="linenos"> 86</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">USER_ID</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-87"><a href="#AgnoPersonalAgent-87"><span class="linenos"> 87</span></a>        <span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-88"><a href="#AgnoPersonalAgent-88"><span class="linenos"> 88</span></a>        <span class="n">instruction_level</span><span class="p">:</span> <span class="n">InstructionLevel</span> <span class="o">=</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-89"><a href="#AgnoPersonalAgent-89"><span class="linenos"> 89</span></a>        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-90"><a href="#AgnoPersonalAgent-90"><span class="linenos"> 90</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-91"><a href="#AgnoPersonalAgent-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Agno Personal Agent.</span>
</span><span id="AgnoPersonalAgent-92"><a href="#AgnoPersonalAgent-92"><span class="linenos"> 92</span></a>
</span><span id="AgnoPersonalAgent-93"><a href="#AgnoPersonalAgent-93"><span class="linenos"> 93</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-94"><a href="#AgnoPersonalAgent-94"><span class="linenos"> 94</span></a><span class="sd">            model_provider: LLM provider (&#39;ollama&#39; or &#39;openai&#39;)</span>
</span><span id="AgnoPersonalAgent-95"><a href="#AgnoPersonalAgent-95"><span class="linenos"> 95</span></a><span class="sd">            model_name: Model name to use</span>
</span><span id="AgnoPersonalAgent-96"><a href="#AgnoPersonalAgent-96"><span class="linenos"> 96</span></a><span class="sd">            enable_memory: Whether to enable memory and knowledge features</span>
</span><span id="AgnoPersonalAgent-97"><a href="#AgnoPersonalAgent-97"><span class="linenos"> 97</span></a><span class="sd">            enable_mcp: Whether to enable MCP tool integration</span>
</span><span id="AgnoPersonalAgent-98"><a href="#AgnoPersonalAgent-98"><span class="linenos"> 98</span></a><span class="sd">            storage_dir: Directory for Agno storage files</span>
</span><span id="AgnoPersonalAgent-99"><a href="#AgnoPersonalAgent-99"><span class="linenos"> 99</span></a><span class="sd">            knowledge_dir: Directory containing knowledge files to load</span>
</span><span id="AgnoPersonalAgent-100"><a href="#AgnoPersonalAgent-100"><span class="linenos">100</span></a><span class="sd">            debug: Enable debug logging and tool call visibility</span>
</span><span id="AgnoPersonalAgent-101"><a href="#AgnoPersonalAgent-101"><span class="linenos">101</span></a><span class="sd">            ollama_base_url: Base URL for Ollama API</span>
</span><span id="AgnoPersonalAgent-102"><a href="#AgnoPersonalAgent-102"><span class="linenos">102</span></a><span class="sd">            user_id: User identifier for memory operations</span>
</span><span id="AgnoPersonalAgent-103"><a href="#AgnoPersonalAgent-103"><span class="linenos">103</span></a><span class="sd">            recreate: Whether to recreate knowledge bases</span>
</span><span id="AgnoPersonalAgent-104"><a href="#AgnoPersonalAgent-104"><span class="linenos">104</span></a><span class="sd">            instruction_level: The sophistication level for agent instructions</span>
</span><span id="AgnoPersonalAgent-105"><a href="#AgnoPersonalAgent-105"><span class="linenos">105</span></a><span class="sd">            seed: Optional seed for model reproducibility</span>
</span><span id="AgnoPersonalAgent-106"><a href="#AgnoPersonalAgent-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-107"><a href="#AgnoPersonalAgent-107"><span class="linenos">107</span></a>        <span class="c1"># Basic configuration</span>
</span><span id="AgnoPersonalAgent-108"><a href="#AgnoPersonalAgent-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span> <span class="o">=</span> <span class="n">model_provider</span>
</span><span id="AgnoPersonalAgent-109"><a href="#AgnoPersonalAgent-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="AgnoPersonalAgent-110"><a href="#AgnoPersonalAgent-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="o">=</span> <span class="n">enable_memory</span>
</span><span id="AgnoPersonalAgent-111"><a href="#AgnoPersonalAgent-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="o">=</span> <span class="n">enable_mcp</span> <span class="ow">and</span> <span class="n">USE_MCP</span>
</span><span id="AgnoPersonalAgent-112"><a href="#AgnoPersonalAgent-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="AgnoPersonalAgent-113"><a href="#AgnoPersonalAgent-113"><span class="linenos">113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ollama_base_url</span> <span class="o">=</span> <span class="n">ollama_base_url</span>
</span><span id="AgnoPersonalAgent-114"><a href="#AgnoPersonalAgent-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgnoPersonalAgent-115"><a href="#AgnoPersonalAgent-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">recreate</span> <span class="o">=</span> <span class="n">recreate</span>
</span><span id="AgnoPersonalAgent-116"><a href="#AgnoPersonalAgent-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instruction_level</span> <span class="o">=</span> <span class="n">instruction_level</span>
</span><span id="AgnoPersonalAgent-117"><a href="#AgnoPersonalAgent-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
</span><span id="AgnoPersonalAgent-118"><a href="#AgnoPersonalAgent-118"><span class="linenos">118</span></a>
</span><span id="AgnoPersonalAgent-119"><a href="#AgnoPersonalAgent-119"><span class="linenos">119</span></a>        <span class="c1"># Set up storage paths</span>
</span><span id="AgnoPersonalAgent-120"><a href="#AgnoPersonalAgent-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_storage_paths</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">knowledge_dir</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-121"><a href="#AgnoPersonalAgent-121"><span class="linenos">121</span></a>
</span><span id="AgnoPersonalAgent-122"><a href="#AgnoPersonalAgent-122"><span class="linenos">122</span></a>        <span class="c1"># MCP configuration</span>
</span><span id="AgnoPersonalAgent-123"><a href="#AgnoPersonalAgent-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span> <span class="o">=</span> <span class="n">get_mcp_servers</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="AgnoPersonalAgent-124"><a href="#AgnoPersonalAgent-124"><span class="linenos">124</span></a>
</span><span id="AgnoPersonalAgent-125"><a href="#AgnoPersonalAgent-125"><span class="linenos">125</span></a>        <span class="c1"># Initialize component managers</span>
</span><span id="AgnoPersonalAgent-126"><a href="#AgnoPersonalAgent-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span> <span class="n">AgentModelManager</span> <span class="o">=</span> <span class="n">AgentModelManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-127"><a href="#AgnoPersonalAgent-127"><span class="linenos">127</span></a>            <span class="n">model_provider</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">ollama_base_url</span><span class="p">,</span> <span class="n">seed</span>
</span><span id="AgnoPersonalAgent-128"><a href="#AgnoPersonalAgent-128"><span class="linenos">128</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-129"><a href="#AgnoPersonalAgent-129"><span class="linenos">129</span></a>
</span><span id="AgnoPersonalAgent-130"><a href="#AgnoPersonalAgent-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span><span class="p">:</span> <span class="n">AgentInstructionManager</span> <span class="o">=</span> <span class="n">AgentInstructionManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-131"><a href="#AgnoPersonalAgent-131"><span class="linenos">131</span></a>            <span class="n">instruction_level</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">enable_memory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span>
</span><span id="AgnoPersonalAgent-132"><a href="#AgnoPersonalAgent-132"><span class="linenos">132</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-133"><a href="#AgnoPersonalAgent-133"><span class="linenos">133</span></a>
</span><span id="AgnoPersonalAgent-134"><a href="#AgnoPersonalAgent-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="p">:</span> <span class="n">AgentMemoryManager</span> <span class="o">=</span> <span class="n">AgentMemoryManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-135"><a href="#AgnoPersonalAgent-135"><span class="linenos">135</span></a>            <span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-136"><a href="#AgnoPersonalAgent-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-137"><a href="#AgnoPersonalAgent-137"><span class="linenos">137</span></a>            <span class="kc">None</span><span class="p">,</span>  <span class="c1"># agno_memory will be set during initialization</span>
</span><span id="AgnoPersonalAgent-138"><a href="#AgnoPersonalAgent-138"><span class="linenos">138</span></a>            <span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-139"><a href="#AgnoPersonalAgent-139"><span class="linenos">139</span></a>            <span class="n">LIGHTRAG_MEMORY_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-140"><a href="#AgnoPersonalAgent-140"><span class="linenos">140</span></a>            <span class="n">enable_memory</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-141"><a href="#AgnoPersonalAgent-141"><span class="linenos">141</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-142"><a href="#AgnoPersonalAgent-142"><span class="linenos">142</span></a>
</span><span id="AgnoPersonalAgent-143"><a href="#AgnoPersonalAgent-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span><span class="p">:</span> <span class="n">AgentKnowledgeManager</span> <span class="o">=</span> <span class="n">AgentKnowledgeManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-144"><a href="#AgnoPersonalAgent-144"><span class="linenos">144</span></a>            <span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">LIGHTRAG_URL</span><span class="p">,</span> <span class="n">LIGHTRAG_MEMORY_URL</span>
</span><span id="AgnoPersonalAgent-145"><a href="#AgnoPersonalAgent-145"><span class="linenos">145</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-146"><a href="#AgnoPersonalAgent-146"><span class="linenos">146</span></a>
</span><span id="AgnoPersonalAgent-147"><a href="#AgnoPersonalAgent-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_manager</span><span class="p">:</span> <span class="n">AgentToolManager</span> <span class="o">=</span> <span class="n">AgentToolManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-148"><a href="#AgnoPersonalAgent-148"><span class="linenos">148</span></a>            <span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span>
</span><span id="AgnoPersonalAgent-149"><a href="#AgnoPersonalAgent-149"><span class="linenos">149</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-150"><a href="#AgnoPersonalAgent-150"><span class="linenos">150</span></a>
</span><span id="AgnoPersonalAgent-151"><a href="#AgnoPersonalAgent-151"><span class="linenos">151</span></a>        <span class="c1"># Storage components</span>
</span><span id="AgnoPersonalAgent-152"><a href="#AgnoPersonalAgent-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-153"><a href="#AgnoPersonalAgent-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-154"><a href="#AgnoPersonalAgent-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-155"><a href="#AgnoPersonalAgent-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AgnoPersonalAgent-156"><a href="#AgnoPersonalAgent-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-157"><a href="#AgnoPersonalAgent-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-158"><a href="#AgnoPersonalAgent-158"><span class="linenos">158</span></a>
</span><span id="AgnoPersonalAgent-159"><a href="#AgnoPersonalAgent-159"><span class="linenos">159</span></a>        <span class="c1"># Agent instance</span>
</span><span id="AgnoPersonalAgent-160"><a href="#AgnoPersonalAgent-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-161"><a href="#AgnoPersonalAgent-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-162"><a href="#AgnoPersonalAgent-162"><span class="linenos">162</span></a>
</span><span id="AgnoPersonalAgent-163"><a href="#AgnoPersonalAgent-163"><span class="linenos">163</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-164"><a href="#AgnoPersonalAgent-164"><span class="linenos">164</span></a>            <span class="s2">&quot;Initialized AgnoPersonalAgent with model=</span><span class="si">%s</span><span class="s2">, memory=</span><span class="si">%s</span><span class="s2">, mcp=</span><span class="si">%s</span><span class="s2">, user_id=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-165"><a href="#AgnoPersonalAgent-165"><span class="linenos">165</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_provider</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-166"><a href="#AgnoPersonalAgent-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-167"><a href="#AgnoPersonalAgent-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-168"><a href="#AgnoPersonalAgent-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-169"><a href="#AgnoPersonalAgent-169"><span class="linenos">169</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-170"><a href="#AgnoPersonalAgent-170"><span class="linenos">170</span></a>
</span><span id="AgnoPersonalAgent-171"><a href="#AgnoPersonalAgent-171"><span class="linenos">171</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_storage_paths</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-172"><a href="#AgnoPersonalAgent-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">knowledge_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="AgnoPersonalAgent-173"><a href="#AgnoPersonalAgent-173"><span class="linenos">173</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-174"><a href="#AgnoPersonalAgent-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up storage paths based on user ID.</span>
</span><span id="AgnoPersonalAgent-175"><a href="#AgnoPersonalAgent-175"><span class="linenos">175</span></a>
</span><span id="AgnoPersonalAgent-176"><a href="#AgnoPersonalAgent-176"><span class="linenos">176</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-177"><a href="#AgnoPersonalAgent-177"><span class="linenos">177</span></a><span class="sd">            storage_dir: Default storage directory</span>
</span><span id="AgnoPersonalAgent-178"><a href="#AgnoPersonalAgent-178"><span class="linenos">178</span></a><span class="sd">            knowledge_dir: Default knowledge directory</span>
</span><span id="AgnoPersonalAgent-179"><a href="#AgnoPersonalAgent-179"><span class="linenos">179</span></a><span class="sd">            user_id: User identifier</span>
</span><span id="AgnoPersonalAgent-180"><a href="#AgnoPersonalAgent-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-181"><a href="#AgnoPersonalAgent-181"><span class="linenos">181</span></a>        <span class="c1"># If user_id differs from default, create user-specific paths</span>
</span><span id="AgnoPersonalAgent-182"><a href="#AgnoPersonalAgent-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="o">!=</span> <span class="n">USER_ID</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-183"><a href="#AgnoPersonalAgent-183"><span class="linenos">183</span></a>            <span class="c1"># Replace the default user ID in the paths with the custom user ID</span>
</span><span id="AgnoPersonalAgent-184"><a href="#AgnoPersonalAgent-184"><span class="linenos">184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-185"><a href="#AgnoPersonalAgent-185"><span class="linenos">185</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DATA_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">STORAGE_BACKEND</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgnoPersonalAgent-186"><a href="#AgnoPersonalAgent-186"><span class="linenos">186</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-187"><a href="#AgnoPersonalAgent-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-188"><a href="#AgnoPersonalAgent-188"><span class="linenos">188</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DATA_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">STORAGE_BACKEND</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/knowledge&quot;</span>
</span><span id="AgnoPersonalAgent-189"><a href="#AgnoPersonalAgent-189"><span class="linenos">189</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-190"><a href="#AgnoPersonalAgent-190"><span class="linenos">190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-191"><a href="#AgnoPersonalAgent-191"><span class="linenos">191</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">storage_dir</span>
</span><span id="AgnoPersonalAgent-192"><a href="#AgnoPersonalAgent-192"><span class="linenos">192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">knowledge_dir</span>
</span><span id="AgnoPersonalAgent-193"><a href="#AgnoPersonalAgent-193"><span class="linenos">193</span></a>
</span><span id="AgnoPersonalAgent-194"><a href="#AgnoPersonalAgent-194"><span class="linenos">194</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-195"><a href="#AgnoPersonalAgent-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the agno agent with all components.</span>
</span><span id="AgnoPersonalAgent-196"><a href="#AgnoPersonalAgent-196"><span class="linenos">196</span></a>
</span><span id="AgnoPersonalAgent-197"><a href="#AgnoPersonalAgent-197"><span class="linenos">197</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-198"><a href="#AgnoPersonalAgent-198"><span class="linenos">198</span></a><span class="sd">            recreate: Whether to recreate the agent knowledge bases</span>
</span><span id="AgnoPersonalAgent-199"><a href="#AgnoPersonalAgent-199"><span class="linenos">199</span></a>
</span><span id="AgnoPersonalAgent-200"><a href="#AgnoPersonalAgent-200"><span class="linenos">200</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-201"><a href="#AgnoPersonalAgent-201"><span class="linenos">201</span></a><span class="sd">            True if initialization successful, False otherwise</span>
</span><span id="AgnoPersonalAgent-202"><a href="#AgnoPersonalAgent-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-203"><a href="#AgnoPersonalAgent-203"><span class="linenos">203</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-204"><a href="#AgnoPersonalAgent-204"><span class="linenos">204</span></a>            <span class="s2">&quot;🚀 AgnoPersonalAgent.initialize() called with recreate=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">recreate</span>
</span><span id="AgnoPersonalAgent-205"><a href="#AgnoPersonalAgent-205"><span class="linenos">205</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-206"><a href="#AgnoPersonalAgent-206"><span class="linenos">206</span></a>
</span><span id="AgnoPersonalAgent-207"><a href="#AgnoPersonalAgent-207"><span class="linenos">207</span></a>        <span class="c1"># CRITICAL: Synchronize the agent&#39;s user_id with the persistent user setting</span>
</span><span id="AgnoPersonalAgent-208"><a href="#AgnoPersonalAgent-208"><span class="linenos">208</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-209"><a href="#AgnoPersonalAgent-209"><span class="linenos">209</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">..config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_current_user_id</span>
</span><span id="AgnoPersonalAgent-210"><a href="#AgnoPersonalAgent-210"><span class="linenos">210</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.user_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserManager</span>
</span><span id="AgnoPersonalAgent-211"><a href="#AgnoPersonalAgent-211"><span class="linenos">211</span></a>
</span><span id="AgnoPersonalAgent-212"><a href="#AgnoPersonalAgent-212"><span class="linenos">212</span></a>            <span class="n">user_manager</span> <span class="o">=</span> <span class="n">UserManager</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-213"><a href="#AgnoPersonalAgent-213"><span class="linenos">213</span></a>            <span class="n">persistent_user_id</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgnoPersonalAgent-214"><a href="#AgnoPersonalAgent-214"><span class="linenos">214</span></a>                <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-215"><a href="#AgnoPersonalAgent-215"><span class="linenos">215</span></a>            <span class="p">)</span>  <span class="c1"># This is loaded from env.userid at startup</span>
</span><span id="AgnoPersonalAgent-216"><a href="#AgnoPersonalAgent-216"><span class="linenos">216</span></a>
</span><span id="AgnoPersonalAgent-217"><a href="#AgnoPersonalAgent-217"><span class="linenos">217</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">!=</span> <span class="n">persistent_user_id</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-218"><a href="#AgnoPersonalAgent-218"><span class="linenos">218</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-219"><a href="#AgnoPersonalAgent-219"><span class="linenos">219</span></a>                    <span class="s2">&quot;Agent initialized with user &#39;</span><span class="si">%s</span><span class="s2">&#39;, but persistent user is &#39;</span><span class="si">%s</span><span class="s2">&#39;. Switching context...&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-220"><a href="#AgnoPersonalAgent-220"><span class="linenos">220</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-221"><a href="#AgnoPersonalAgent-221"><span class="linenos">221</span></a>                    <span class="n">persistent_user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-222"><a href="#AgnoPersonalAgent-222"><span class="linenos">222</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-223"><a href="#AgnoPersonalAgent-223"><span class="linenos">223</span></a>                <span class="c1"># This is a formal user switch. Update the persistent user file.</span>
</span><span id="AgnoPersonalAgent-224"><a href="#AgnoPersonalAgent-224"><span class="linenos">224</span></a>                <span class="n">switch_result</span> <span class="o">=</span> <span class="n">user_manager</span><span class="o">.</span><span class="n">switch_user</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-225"><a href="#AgnoPersonalAgent-225"><span class="linenos">225</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">restart_lightrag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">update_global_config</span><span class="o">=</span><span class="kc">True</span>
</span><span id="AgnoPersonalAgent-226"><a href="#AgnoPersonalAgent-226"><span class="linenos">226</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-227"><a href="#AgnoPersonalAgent-227"><span class="linenos">227</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">switch_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-228"><a href="#AgnoPersonalAgent-228"><span class="linenos">228</span></a>                    <span class="s2">&quot;success&quot;</span>
</span><span id="AgnoPersonalAgent-229"><a href="#AgnoPersonalAgent-229"><span class="linenos">229</span></a>                <span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;Already logged in&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">switch_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="AgnoPersonalAgent-230"><a href="#AgnoPersonalAgent-230"><span class="linenos">230</span></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-231"><a href="#AgnoPersonalAgent-231"><span class="linenos">231</span></a>                        <span class="sa">f</span><span class="s2">&quot;Failed to switch user context to &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">switch_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgnoPersonalAgent-232"><a href="#AgnoPersonalAgent-232"><span class="linenos">232</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent-233"><a href="#AgnoPersonalAgent-233"><span class="linenos">233</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-234"><a href="#AgnoPersonalAgent-234"><span class="linenos">234</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-235"><a href="#AgnoPersonalAgent-235"><span class="linenos">235</span></a>                        <span class="s2">&quot;Successfully switched user context to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgnoPersonalAgent-236"><a href="#AgnoPersonalAgent-236"><span class="linenos">236</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent-237"><a href="#AgnoPersonalAgent-237"><span class="linenos">237</span></a>
</span><span id="AgnoPersonalAgent-238"><a href="#AgnoPersonalAgent-238"><span class="linenos">238</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-239"><a href="#AgnoPersonalAgent-239"><span class="linenos">239</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;🚨 Critical error during user context synchronization: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-240"><a href="#AgnoPersonalAgent-240"><span class="linenos">240</span></a>            <span class="c1"># This is a critical step, so we raise an exception if it fails.</span>
</span><span id="AgnoPersonalAgent-241"><a href="#AgnoPersonalAgent-241"><span class="linenos">241</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User context synchronization failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="AgnoPersonalAgent-242"><a href="#AgnoPersonalAgent-242"><span class="linenos">242</span></a>
</span><span id="AgnoPersonalAgent-243"><a href="#AgnoPersonalAgent-243"><span class="linenos">243</span></a>        <span class="c1"># CRITICAL: Ensure user is registered in the user registry</span>
</span><span id="AgnoPersonalAgent-244"><a href="#AgnoPersonalAgent-244"><span class="linenos">244</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;📝 Ensuring user </span><span class="si">%s</span><span class="s2"> is registered in user registry&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-245"><a href="#AgnoPersonalAgent-245"><span class="linenos">245</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-246"><a href="#AgnoPersonalAgent-246"><span class="linenos">246</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.user_registry</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRegistry</span>
</span><span id="AgnoPersonalAgent-247"><a href="#AgnoPersonalAgent-247"><span class="linenos">247</span></a>
</span><span id="AgnoPersonalAgent-248"><a href="#AgnoPersonalAgent-248"><span class="linenos">248</span></a>            <span class="n">user_registry</span> <span class="o">=</span> <span class="n">UserRegistry</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-249"><a href="#AgnoPersonalAgent-249"><span class="linenos">249</span></a>            <span class="n">user_registry</span><span class="o">.</span><span class="n">ensure_current_user_registered</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-250"><a href="#AgnoPersonalAgent-250"><span class="linenos">250</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;✅ User registration check completed&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-251"><a href="#AgnoPersonalAgent-251"><span class="linenos">251</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-252"><a href="#AgnoPersonalAgent-252"><span class="linenos">252</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;⚠️ User registry check failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-253"><a href="#AgnoPersonalAgent-253"><span class="linenos">253</span></a>            <span class="c1"># Don&#39;t fail initialization for user registry issues</span>
</span><span id="AgnoPersonalAgent-254"><a href="#AgnoPersonalAgent-254"><span class="linenos">254</span></a>
</span><span id="AgnoPersonalAgent-255"><a href="#AgnoPersonalAgent-255"><span class="linenos">255</span></a>        <span class="c1"># CRITICAL: Ensure Docker USER_ID consistency with smart restart capability</span>
</span><span id="AgnoPersonalAgent-256"><a href="#AgnoPersonalAgent-256"><span class="linenos">256</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;🔍 Checking Docker USER_ID consistency for user: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-257"><a href="#AgnoPersonalAgent-257"><span class="linenos">257</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-258"><a href="#AgnoPersonalAgent-258"><span class="linenos">258</span></a>            <span class="n">ready_to_proceed</span><span class="p">,</span> <span class="n">consistency_message</span> <span class="o">=</span> <span class="n">ensure_docker_user_consistency</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-259"><a href="#AgnoPersonalAgent-259"><span class="linenos">259</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">auto_fix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Only restart if actually needed</span>
</span><span id="AgnoPersonalAgent-260"><a href="#AgnoPersonalAgent-260"><span class="linenos">260</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-261"><a href="#AgnoPersonalAgent-261"><span class="linenos">261</span></a>
</span><span id="AgnoPersonalAgent-262"><a href="#AgnoPersonalAgent-262"><span class="linenos">262</span></a>            <span class="k">if</span> <span class="n">ready_to_proceed</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-263"><a href="#AgnoPersonalAgent-263"><span class="linenos">263</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-264"><a href="#AgnoPersonalAgent-264"><span class="linenos">264</span></a>                    <span class="s2">&quot;✅ Docker consistency check passed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">consistency_message</span>
</span><span id="AgnoPersonalAgent-265"><a href="#AgnoPersonalAgent-265"><span class="linenos">265</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-266"><a href="#AgnoPersonalAgent-266"><span class="linenos">266</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-267"><a href="#AgnoPersonalAgent-267"><span class="linenos">267</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-268"><a href="#AgnoPersonalAgent-268"><span class="linenos">268</span></a>                    <span class="s2">&quot;❌ Docker consistency check failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">consistency_message</span>
</span><span id="AgnoPersonalAgent-269"><a href="#AgnoPersonalAgent-269"><span class="linenos">269</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-270"><a href="#AgnoPersonalAgent-270"><span class="linenos">270</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-271"><a href="#AgnoPersonalAgent-271"><span class="linenos">271</span></a>                    <span class="sa">f</span><span class="s2">&quot;Docker USER_ID consistency check failed: </span><span class="si">{</span><span class="n">consistency_message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgnoPersonalAgent-272"><a href="#AgnoPersonalAgent-272"><span class="linenos">272</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-273"><a href="#AgnoPersonalAgent-273"><span class="linenos">273</span></a>
</span><span id="AgnoPersonalAgent-274"><a href="#AgnoPersonalAgent-274"><span class="linenos">274</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-275"><a href="#AgnoPersonalAgent-275"><span class="linenos">275</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;🚨 Critical error during Docker consistency check: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-276"><a href="#AgnoPersonalAgent-276"><span class="linenos">276</span></a>            <span class="c1"># Don&#39;t fail initialization for Docker consistency issues in case Docker is not available</span>
</span><span id="AgnoPersonalAgent-277"><a href="#AgnoPersonalAgent-277"><span class="linenos">277</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-278"><a href="#AgnoPersonalAgent-278"><span class="linenos">278</span></a>                <span class="s2">&quot;⚠️ Continuing initialization despite Docker consistency check failure&quot;</span>
</span><span id="AgnoPersonalAgent-279"><a href="#AgnoPersonalAgent-279"><span class="linenos">279</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-280"><a href="#AgnoPersonalAgent-280"><span class="linenos">280</span></a>
</span><span id="AgnoPersonalAgent-281"><a href="#AgnoPersonalAgent-281"><span class="linenos">281</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-282"><a href="#AgnoPersonalAgent-282"><span class="linenos">282</span></a>            <span class="c1"># Create model using the model manager</span>
</span><span id="AgnoPersonalAgent-283"><a href="#AgnoPersonalAgent-283"><span class="linenos">283</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-284"><a href="#AgnoPersonalAgent-284"><span class="linenos">284</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created model: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-285"><a href="#AgnoPersonalAgent-285"><span class="linenos">285</span></a>
</span><span id="AgnoPersonalAgent-286"><a href="#AgnoPersonalAgent-286"><span class="linenos">286</span></a>            <span class="c1"># Prepare tools list</span>
</span><span id="AgnoPersonalAgent-287"><a href="#AgnoPersonalAgent-287"><span class="linenos">287</span></a>            <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgnoPersonalAgent-288"><a href="#AgnoPersonalAgent-288"><span class="linenos">288</span></a>                <span class="c1"># Add GoogleSearch tools directly for web search functionality</span>
</span><span id="AgnoPersonalAgent-289"><a href="#AgnoPersonalAgent-289"><span class="linenos">289</span></a>                <span class="n">GoogleSearchTools</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent-290"><a href="#AgnoPersonalAgent-290"><span class="linenos">290</span></a>                <span class="n">YFinanceTools</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-291"><a href="#AgnoPersonalAgent-291"><span class="linenos">291</span></a>                    <span class="n">stock_price</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-292"><a href="#AgnoPersonalAgent-292"><span class="linenos">292</span></a>                    <span class="n">company_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-293"><a href="#AgnoPersonalAgent-293"><span class="linenos">293</span></a>                    <span class="n">stock_fundamentals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-294"><a href="#AgnoPersonalAgent-294"><span class="linenos">294</span></a>                    <span class="n">key_financial_ratios</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-295"><a href="#AgnoPersonalAgent-295"><span class="linenos">295</span></a>                    <span class="n">analyst_recommendations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-296"><a href="#AgnoPersonalAgent-296"><span class="linenos">296</span></a>                <span class="p">),</span>
</span><span id="AgnoPersonalAgent-297"><a href="#AgnoPersonalAgent-297"><span class="linenos">297</span></a>                <span class="n">PythonTools</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent-298"><a href="#AgnoPersonalAgent-298"><span class="linenos">298</span></a>                <span class="n">ShellTools</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-299"><a href="#AgnoPersonalAgent-299"><span class="linenos">299</span></a>                    <span class="n">base_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
</span><span id="AgnoPersonalAgent-300"><a href="#AgnoPersonalAgent-300"><span class="linenos">300</span></a>                <span class="p">),</span>  <span class="c1"># Match Streamlit configuration for consistency</span>
</span><span id="AgnoPersonalAgent-301"><a href="#AgnoPersonalAgent-301"><span class="linenos">301</span></a>                <span class="n">PersonalAgentFilesystemTools</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent-302"><a href="#AgnoPersonalAgent-302"><span class="linenos">302</span></a>                <span class="c1"># Removed PersonalAgentWebTools as it was causing confusion with MCP references</span>
</span><span id="AgnoPersonalAgent-303"><a href="#AgnoPersonalAgent-303"><span class="linenos">303</span></a>            <span class="p">]</span>
</span><span id="AgnoPersonalAgent-304"><a href="#AgnoPersonalAgent-304"><span class="linenos">304</span></a>
</span><span id="AgnoPersonalAgent-305"><a href="#AgnoPersonalAgent-305"><span class="linenos">305</span></a>            <span class="c1"># Initialize Agno native storage and knowledge following the working example pattern</span>
</span><span id="AgnoPersonalAgent-306"><a href="#AgnoPersonalAgent-306"><span class="linenos">306</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-307"><a href="#AgnoPersonalAgent-307"><span class="linenos">307</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="o">=</span> <span class="n">create_agno_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-308"><a href="#AgnoPersonalAgent-308"><span class="linenos">308</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created Agno storage at: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-309"><a href="#AgnoPersonalAgent-309"><span class="linenos">309</span></a>
</span><span id="AgnoPersonalAgent-310"><a href="#AgnoPersonalAgent-310"><span class="linenos">310</span></a>                <span class="c1"># Create knowledge base (sync creation)</span>
</span><span id="AgnoPersonalAgent-311"><a href="#AgnoPersonalAgent-311"><span class="linenos">311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="n">create_combined_knowledge_base</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-312"><a href="#AgnoPersonalAgent-312"><span class="linenos">312</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span>
</span><span id="AgnoPersonalAgent-313"><a href="#AgnoPersonalAgent-313"><span class="linenos">313</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-314"><a href="#AgnoPersonalAgent-314"><span class="linenos">314</span></a>
</span><span id="AgnoPersonalAgent-315"><a href="#AgnoPersonalAgent-315"><span class="linenos">315</span></a>                <span class="c1"># Load knowledge base content (async loading) - matches working example</span>
</span><span id="AgnoPersonalAgent-316"><a href="#AgnoPersonalAgent-316"><span class="linenos">316</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-317"><a href="#AgnoPersonalAgent-317"><span class="linenos">317</span></a>                    <span class="k">await</span> <span class="n">load_combined_knowledge_base</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-318"><a href="#AgnoPersonalAgent-318"><span class="linenos">318</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="n">recreate</span>
</span><span id="AgnoPersonalAgent-319"><a href="#AgnoPersonalAgent-319"><span class="linenos">319</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent-320"><a href="#AgnoPersonalAgent-320"><span class="linenos">320</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loaded Agno combined knowledge base content&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-321"><a href="#AgnoPersonalAgent-321"><span class="linenos">321</span></a>
</span><span id="AgnoPersonalAgent-322"><a href="#AgnoPersonalAgent-322"><span class="linenos">322</span></a>                <span class="c1"># Create memory with SemanticMemoryManager (debug mode passed through)</span>
</span><span id="AgnoPersonalAgent-323"><a href="#AgnoPersonalAgent-323"><span class="linenos">323</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="n">create_agno_memory</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-324"><a href="#AgnoPersonalAgent-324"><span class="linenos">324</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
</span><span id="AgnoPersonalAgent-325"><a href="#AgnoPersonalAgent-325"><span class="linenos">325</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-326"><a href="#AgnoPersonalAgent-326"><span class="linenos">326</span></a>
</span><span id="AgnoPersonalAgent-327"><a href="#AgnoPersonalAgent-327"><span class="linenos">327</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-328"><a href="#AgnoPersonalAgent-328"><span class="linenos">328</span></a>                    <span class="c1"># Initialize the memory manager with the created agno_memory</span>
</span><span id="AgnoPersonalAgent-329"><a href="#AgnoPersonalAgent-329"><span class="linenos">329</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-330"><a href="#AgnoPersonalAgent-330"><span class="linenos">330</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-331"><a href="#AgnoPersonalAgent-331"><span class="linenos">331</span></a>                        <span class="s2">&quot;Created Agno memory with SemanticMemoryManager at: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-332"><a href="#AgnoPersonalAgent-332"><span class="linenos">332</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-333"><a href="#AgnoPersonalAgent-333"><span class="linenos">333</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent-334"><a href="#AgnoPersonalAgent-334"><span class="linenos">334</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-335"><a href="#AgnoPersonalAgent-335"><span class="linenos">335</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to create memory system&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-336"><a href="#AgnoPersonalAgent-336"><span class="linenos">336</span></a>
</span><span id="AgnoPersonalAgent-337"><a href="#AgnoPersonalAgent-337"><span class="linenos">337</span></a>                <span class="c1"># Add Lightrag knowledge if enabled</span>
</span><span id="AgnoPersonalAgent-338"><a href="#AgnoPersonalAgent-338"><span class="linenos">338</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-339"><a href="#AgnoPersonalAgent-339"><span class="linenos">339</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-340"><a href="#AgnoPersonalAgent-340"><span class="linenos">340</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_lightrag_knowledge_base</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-341"><a href="#AgnoPersonalAgent-341"><span class="linenos">341</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge_enabled</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgnoPersonalAgent-342"><a href="#AgnoPersonalAgent-342"><span class="linenos">342</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-343"><a href="#AgnoPersonalAgent-343"><span class="linenos">343</span></a>                        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-344"><a href="#AgnoPersonalAgent-344"><span class="linenos">344</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loaded Lightrag knowledge base metadata&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-345"><a href="#AgnoPersonalAgent-345"><span class="linenos">345</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-346"><a href="#AgnoPersonalAgent-346"><span class="linenos">346</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to load Lightrag knowledge base: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-347"><a href="#AgnoPersonalAgent-347"><span class="linenos">347</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-348"><a href="#AgnoPersonalAgent-348"><span class="linenos">348</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AgnoPersonalAgent-349"><a href="#AgnoPersonalAgent-349"><span class="linenos">349</span></a>
</span><span id="AgnoPersonalAgent-350"><a href="#AgnoPersonalAgent-350"><span class="linenos">350</span></a>                <span class="c1"># Create Knowledge Coordinator</span>
</span><span id="AgnoPersonalAgent-351"><a href="#AgnoPersonalAgent-351"><span class="linenos">351</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="n">create_knowledge_coordinator</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-352"><a href="#AgnoPersonalAgent-352"><span class="linenos">352</span></a>                    <span class="n">agno_knowledge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-353"><a href="#AgnoPersonalAgent-353"><span class="linenos">353</span></a>                    <span class="n">lightrag_url</span><span class="o">=</span><span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-354"><a href="#AgnoPersonalAgent-354"><span class="linenos">354</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-355"><a href="#AgnoPersonalAgent-355"><span class="linenos">355</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-356"><a href="#AgnoPersonalAgent-356"><span class="linenos">356</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-357"><a href="#AgnoPersonalAgent-357"><span class="linenos">357</span></a>                    <span class="s2">&quot;Created Knowledge Coordinator for unified knowledge queries&quot;</span>
</span><span id="AgnoPersonalAgent-358"><a href="#AgnoPersonalAgent-358"><span class="linenos">358</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-359"><a href="#AgnoPersonalAgent-359"><span class="linenos">359</span></a>
</span><span id="AgnoPersonalAgent-360"><a href="#AgnoPersonalAgent-360"><span class="linenos">360</span></a>                <span class="c1"># If recreate is True, clear all memories AFTER memory system is initialized</span>
</span><span id="AgnoPersonalAgent-361"><a href="#AgnoPersonalAgent-361"><span class="linenos">361</span></a>                <span class="k">if</span> <span class="n">recreate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-362"><a href="#AgnoPersonalAgent-362"><span class="linenos">362</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-363"><a href="#AgnoPersonalAgent-363"><span class="linenos">363</span></a>                        <span class="s2">&quot;Recreate flag is True, clearing all memories after memory system initialization&quot;</span>
</span><span id="AgnoPersonalAgent-364"><a href="#AgnoPersonalAgent-364"><span class="linenos">364</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent-365"><a href="#AgnoPersonalAgent-365"><span class="linenos">365</span></a>                    <span class="n">clear_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">clear_all_memories</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-366"><a href="#AgnoPersonalAgent-366"><span class="linenos">366</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Memory clear result: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">clear_result</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-367"><a href="#AgnoPersonalAgent-367"><span class="linenos">367</span></a>
</span><span id="AgnoPersonalAgent-368"><a href="#AgnoPersonalAgent-368"><span class="linenos">368</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialized Agno storage and knowledge backend&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-369"><a href="#AgnoPersonalAgent-369"><span class="linenos">369</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-370"><a href="#AgnoPersonalAgent-370"><span class="linenos">370</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-371"><a href="#AgnoPersonalAgent-371"><span class="linenos">371</span></a>                    <span class="s2">&quot;Memory disabled, skipping storage and knowledge initialization&quot;</span>
</span><span id="AgnoPersonalAgent-372"><a href="#AgnoPersonalAgent-372"><span class="linenos">372</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-373"><a href="#AgnoPersonalAgent-373"><span class="linenos">373</span></a>
</span><span id="AgnoPersonalAgent-374"><a href="#AgnoPersonalAgent-374"><span class="linenos">374</span></a>            <span class="c1"># Get MCP tools as function wrappers (no pre-initialization)</span>
</span><span id="AgnoPersonalAgent-375"><a href="#AgnoPersonalAgent-375"><span class="linenos">375</span></a>            <span class="n">mcp_tool_functions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent-376"><a href="#AgnoPersonalAgent-376"><span class="linenos">376</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-377"><a href="#AgnoPersonalAgent-377"><span class="linenos">377</span></a>                <span class="n">mcp_tool_functions</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mcp_tools</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-378"><a href="#AgnoPersonalAgent-378"><span class="linenos">378</span></a>                <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mcp_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-379"><a href="#AgnoPersonalAgent-379"><span class="linenos">379</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Added </span><span class="si">%d</span><span class="s2"> MCP tools to agent&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tool_functions</span><span class="p">))</span>
</span><span id="AgnoPersonalAgent-380"><a href="#AgnoPersonalAgent-380"><span class="linenos">380</span></a>
</span><span id="AgnoPersonalAgent-381"><a href="#AgnoPersonalAgent-381"><span class="linenos">381</span></a>            <span class="c1"># Get memory tools from the memory manager</span>
</span><span id="AgnoPersonalAgent-382"><a href="#AgnoPersonalAgent-382"><span class="linenos">382</span></a>            <span class="n">memory_tool_functions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent-383"><a href="#AgnoPersonalAgent-383"><span class="linenos">383</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-384"><a href="#AgnoPersonalAgent-384"><span class="linenos">384</span></a>                <span class="n">memory_tool_functions</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_memory_tools</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-385"><a href="#AgnoPersonalAgent-385"><span class="linenos">385</span></a>                <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">memory_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-386"><a href="#AgnoPersonalAgent-386"><span class="linenos">386</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-387"><a href="#AgnoPersonalAgent-387"><span class="linenos">387</span></a>                    <span class="s2">&quot;Added </span><span class="si">%d</span><span class="s2"> memory tools to agent&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-388"><a href="#AgnoPersonalAgent-388"><span class="linenos">388</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-389"><a href="#AgnoPersonalAgent-389"><span class="linenos">389</span></a>
</span><span id="AgnoPersonalAgent-390"><a href="#AgnoPersonalAgent-390"><span class="linenos">390</span></a>            <span class="c1"># Create the agno agent with direct parameter passing for visibility</span>
</span><span id="AgnoPersonalAgent-391"><a href="#AgnoPersonalAgent-391"><span class="linenos">391</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-392"><a href="#AgnoPersonalAgent-392"><span class="linenos">392</span></a>                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-393"><a href="#AgnoPersonalAgent-393"><span class="linenos">393</span></a>                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-394"><a href="#AgnoPersonalAgent-394"><span class="linenos">394</span></a>                <span class="n">instructions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span><span class="o">.</span><span class="n">create_instructions</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent-395"><a href="#AgnoPersonalAgent-395"><span class="linenos">395</span></a>                <span class="n">markdown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-396"><a href="#AgnoPersonalAgent-396"><span class="linenos">396</span></a>                <span class="n">show_tool_calls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-397"><a href="#AgnoPersonalAgent-397"><span class="linenos">397</span></a>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Personal AI Agent&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-398"><a href="#AgnoPersonalAgent-398"><span class="linenos">398</span></a>                <span class="n">agent_id</span><span class="o">=</span><span class="s2">&quot;personal_agent&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-399"><a href="#AgnoPersonalAgent-399"><span class="linenos">399</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-400"><a href="#AgnoPersonalAgent-400"><span class="linenos">400</span></a>                <span class="n">enable_agentic_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Disable agno&#39;s native memory to use our custom memory system</span>
</span><span id="AgnoPersonalAgent-401"><a href="#AgnoPersonalAgent-401"><span class="linenos">401</span></a>                <span class="n">enable_user_memories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Re-enable agno&#39;s native memory to allow user retrieval</span>
</span><span id="AgnoPersonalAgent-402"><a href="#AgnoPersonalAgent-402"><span class="linenos">402</span></a>                <span class="n">add_history_to_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Add conversation history to context</span>
</span><span id="AgnoPersonalAgent-403"><a href="#AgnoPersonalAgent-403"><span class="linenos">403</span></a>                <span class="n">num_history_responses</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-404"><a href="#AgnoPersonalAgent-404"><span class="linenos">404</span></a>                <span class="n">knowledge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-405"><a href="#AgnoPersonalAgent-405"><span class="linenos">405</span></a>                <span class="n">search_knowledge</span><span class="o">=</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-406"><a href="#AgnoPersonalAgent-406"><span class="linenos">406</span></a>                    <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="AgnoPersonalAgent-407"><a href="#AgnoPersonalAgent-407"><span class="linenos">407</span></a>                <span class="p">),</span>  <span class="c1"># Enable automatic knowledge search</span>
</span><span id="AgnoPersonalAgent-408"><a href="#AgnoPersonalAgent-408"><span class="linenos">408</span></a>                <span class="n">storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-409"><a href="#AgnoPersonalAgent-409"><span class="linenos">409</span></a>                <span class="n">memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Pass our custom memory system to prevent &quot;MemoryDb not provided&quot; warnings</span>
</span><span id="AgnoPersonalAgent-410"><a href="#AgnoPersonalAgent-410"><span class="linenos">410</span></a>                <span class="c1"># Enable telemetry and verbose logging</span>
</span><span id="AgnoPersonalAgent-411"><a href="#AgnoPersonalAgent-411"><span class="linenos">411</span></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-412"><a href="#AgnoPersonalAgent-412"><span class="linenos">412</span></a>                <span class="c1"># Enable streaming for intermediate steps</span>
</span><span id="AgnoPersonalAgent-413"><a href="#AgnoPersonalAgent-413"><span class="linenos">413</span></a>                <span class="n">stream_intermediate_steps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Required for aprint_response to work correctly</span>
</span><span id="AgnoPersonalAgent-414"><a href="#AgnoPersonalAgent-414"><span class="linenos">414</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-415"><a href="#AgnoPersonalAgent-415"><span class="linenos">415</span></a>
</span><span id="AgnoPersonalAgent-416"><a href="#AgnoPersonalAgent-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-417"><a href="#AgnoPersonalAgent-417"><span class="linenos">417</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Agent configured with knowledge base search&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-418"><a href="#AgnoPersonalAgent-418"><span class="linenos">418</span></a>
</span><span id="AgnoPersonalAgent-419"><a href="#AgnoPersonalAgent-419"><span class="linenos">419</span></a>            <span class="c1"># Calculate tool counts for logging using already-created tool lists</span>
</span><span id="AgnoPersonalAgent-420"><a href="#AgnoPersonalAgent-420"><span class="linenos">420</span></a>            <span class="n">mcp_tool_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-421"><a href="#AgnoPersonalAgent-421"><span class="linenos">421</span></a>            <span class="n">memory_tool_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-422"><a href="#AgnoPersonalAgent-422"><span class="linenos">422</span></a>
</span><span id="AgnoPersonalAgent-423"><a href="#AgnoPersonalAgent-423"><span class="linenos">423</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-424"><a href="#AgnoPersonalAgent-424"><span class="linenos">424</span></a>                <span class="s2">&quot;Successfully initialized agno agent with native storage: </span><span class="si">%d</span><span class="s2"> total tools (</span><span class="si">%d</span><span class="s2"> MCP, </span><span class="si">%d</span><span class="s2"> memory)&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-425"><a href="#AgnoPersonalAgent-425"><span class="linenos">425</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">tools</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent-426"><a href="#AgnoPersonalAgent-426"><span class="linenos">426</span></a>                <span class="n">mcp_tool_count</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-427"><a href="#AgnoPersonalAgent-427"><span class="linenos">427</span></a>                <span class="n">memory_tool_count</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-428"><a href="#AgnoPersonalAgent-428"><span class="linenos">428</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-429"><a href="#AgnoPersonalAgent-429"><span class="linenos">429</span></a>
</span><span id="AgnoPersonalAgent-430"><a href="#AgnoPersonalAgent-430"><span class="linenos">430</span></a>            <span class="c1"># Display splash screen if enabled</span>
</span><span id="AgnoPersonalAgent-431"><a href="#AgnoPersonalAgent-431"><span class="linenos">431</span></a>            <span class="k">if</span> <span class="n">SHOW_SPLASH_SCREEN</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-432"><a href="#AgnoPersonalAgent-432"><span class="linenos">432</span></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">importlib.metadata</span>
</span><span id="AgnoPersonalAgent-433"><a href="#AgnoPersonalAgent-433"><span class="linenos">433</span></a>
</span><span id="AgnoPersonalAgent-434"><a href="#AgnoPersonalAgent-434"><span class="linenos">434</span></a>                <span class="n">agent_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_info</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-435"><a href="#AgnoPersonalAgent-435"><span class="linenos">435</span></a>                <span class="n">agent_version</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="s2">&quot;personal-agent&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-436"><a href="#AgnoPersonalAgent-436"><span class="linenos">436</span></a>                <span class="n">display_splash_screen</span><span class="p">(</span><span class="n">agent_info</span><span class="p">,</span> <span class="n">agent_version</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-437"><a href="#AgnoPersonalAgent-437"><span class="linenos">437</span></a>
</span><span id="AgnoPersonalAgent-438"><a href="#AgnoPersonalAgent-438"><span class="linenos">438</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgnoPersonalAgent-439"><a href="#AgnoPersonalAgent-439"><span class="linenos">439</span></a>
</span><span id="AgnoPersonalAgent-440"><a href="#AgnoPersonalAgent-440"><span class="linenos">440</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-441"><a href="#AgnoPersonalAgent-441"><span class="linenos">441</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to initialize agno agent: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-442"><a href="#AgnoPersonalAgent-442"><span class="linenos">442</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgnoPersonalAgent-443"><a href="#AgnoPersonalAgent-443"><span class="linenos">443</span></a>
</span><span id="AgnoPersonalAgent-444"><a href="#AgnoPersonalAgent-444"><span class="linenos">444</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-445"><a href="#AgnoPersonalAgent-445"><span class="linenos">445</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">add_thought_callback</span><span class="o">=</span><span class="kc">None</span>
</span><span id="AgnoPersonalAgent-446"><a href="#AgnoPersonalAgent-446"><span class="linenos">446</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="AgnoPersonalAgent-447"><a href="#AgnoPersonalAgent-447"><span class="linenos">447</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a query through the agno agent, allowing for native tool execution.</span>
</span><span id="AgnoPersonalAgent-448"><a href="#AgnoPersonalAgent-448"><span class="linenos">448</span></a>
</span><span id="AgnoPersonalAgent-449"><a href="#AgnoPersonalAgent-449"><span class="linenos">449</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-450"><a href="#AgnoPersonalAgent-450"><span class="linenos">450</span></a><span class="sd">            query: User query to process</span>
</span><span id="AgnoPersonalAgent-451"><a href="#AgnoPersonalAgent-451"><span class="linenos">451</span></a><span class="sd">            stream: Whether to stream the response</span>
</span><span id="AgnoPersonalAgent-452"><a href="#AgnoPersonalAgent-452"><span class="linenos">452</span></a><span class="sd">            add_thought_callback: Optional callback for adding thoughts during processing</span>
</span><span id="AgnoPersonalAgent-453"><a href="#AgnoPersonalAgent-453"><span class="linenos">453</span></a>
</span><span id="AgnoPersonalAgent-454"><a href="#AgnoPersonalAgent-454"><span class="linenos">454</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-455"><a href="#AgnoPersonalAgent-455"><span class="linenos">455</span></a><span class="sd">            Agent&#39;s final string response or response dictionary</span>
</span><span id="AgnoPersonalAgent-456"><a href="#AgnoPersonalAgent-456"><span class="linenos">456</span></a>
</span><span id="AgnoPersonalAgent-457"><a href="#AgnoPersonalAgent-457"><span class="linenos">457</span></a><span class="sd">        Raises:</span>
</span><span id="AgnoPersonalAgent-458"><a href="#AgnoPersonalAgent-458"><span class="linenos">458</span></a><span class="sd">            RuntimeError: If agent is not initialized</span>
</span><span id="AgnoPersonalAgent-459"><a href="#AgnoPersonalAgent-459"><span class="linenos">459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-460"><a href="#AgnoPersonalAgent-460"><span class="linenos">460</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-461"><a href="#AgnoPersonalAgent-461"><span class="linenos">461</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Agent not initialized. Call initialize() first.&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-462"><a href="#AgnoPersonalAgent-462"><span class="linenos">462</span></a>
</span><span id="AgnoPersonalAgent-463"><a href="#AgnoPersonalAgent-463"><span class="linenos">463</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-464"><a href="#AgnoPersonalAgent-464"><span class="linenos">464</span></a>            <span class="k">if</span> <span class="n">add_thought_callback</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-465"><a href="#AgnoPersonalAgent-465"><span class="linenos">465</span></a>                <span class="n">add_thought_callback</span><span class="p">(</span><span class="s2">&quot;🚀 Executing agno agent...&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-466"><a href="#AgnoPersonalAgent-466"><span class="linenos">466</span></a>
</span><span id="AgnoPersonalAgent-467"><a href="#AgnoPersonalAgent-467"><span class="linenos">467</span></a>            <span class="c1"># The agent will handle the full tool-use loop internally</span>
</span><span id="AgnoPersonalAgent-468"><a href="#AgnoPersonalAgent-468"><span class="linenos">468</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-469"><a href="#AgnoPersonalAgent-469"><span class="linenos">469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_last_response</span> <span class="o">=</span> <span class="n">response</span>  <span class="c1"># Store for tool call inspection</span>
</span><span id="AgnoPersonalAgent-470"><a href="#AgnoPersonalAgent-470"><span class="linenos">470</span></a>
</span><span id="AgnoPersonalAgent-471"><a href="#AgnoPersonalAgent-471"><span class="linenos">471</span></a>            <span class="c1"># Use tool_manager to analyze tool calls if needed</span>
</span><span id="AgnoPersonalAgent-472"><a href="#AgnoPersonalAgent-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;tool_calls&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-473"><a href="#AgnoPersonalAgent-473"><span class="linenos">473</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-474"><a href="#AgnoPersonalAgent-474"><span class="linenos">474</span></a>                    <span class="sa">f</span><span class="s2">&quot;Agent used </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">)</span><span class="si">}</span><span class="s2"> tools in this response&quot;</span>
</span><span id="AgnoPersonalAgent-475"><a href="#AgnoPersonalAgent-475"><span class="linenos">475</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-476"><a href="#AgnoPersonalAgent-476"><span class="linenos">476</span></a>                <span class="c1"># We could use tool_manager here for additional tool analysis if needed</span>
</span><span id="AgnoPersonalAgent-477"><a href="#AgnoPersonalAgent-477"><span class="linenos">477</span></a>
</span><span id="AgnoPersonalAgent-478"><a href="#AgnoPersonalAgent-478"><span class="linenos">478</span></a>            <span class="k">if</span> <span class="n">add_thought_callback</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-479"><a href="#AgnoPersonalAgent-479"><span class="linenos">479</span></a>                <span class="n">add_thought_callback</span><span class="p">(</span><span class="s2">&quot;✅ Agent execution complete.&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-480"><a href="#AgnoPersonalAgent-480"><span class="linenos">480</span></a>
</span><span id="AgnoPersonalAgent-481"><a href="#AgnoPersonalAgent-481"><span class="linenos">481</span></a>            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
</span><span id="AgnoPersonalAgent-482"><a href="#AgnoPersonalAgent-482"><span class="linenos">482</span></a>
</span><span id="AgnoPersonalAgent-483"><a href="#AgnoPersonalAgent-483"><span class="linenos">483</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-484"><a href="#AgnoPersonalAgent-484"><span class="linenos">484</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error running agno agent: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-485"><a href="#AgnoPersonalAgent-485"><span class="linenos">485</span></a>            <span class="k">if</span> <span class="n">add_thought_callback</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-486"><a href="#AgnoPersonalAgent-486"><span class="linenos">486</span></a>                <span class="n">add_thought_callback</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-487"><a href="#AgnoPersonalAgent-487"><span class="linenos">487</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error processing request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgnoPersonalAgent-488"><a href="#AgnoPersonalAgent-488"><span class="linenos">488</span></a>
</span><span id="AgnoPersonalAgent-489"><a href="#AgnoPersonalAgent-489"><span class="linenos">489</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_user_memory</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-490"><a href="#AgnoPersonalAgent-490"><span class="linenos">490</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-491"><a href="#AgnoPersonalAgent-491"><span class="linenos">491</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryStorageResult</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-492"><a href="#AgnoPersonalAgent-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store information as a user memory in both local SQLite and LightRAG graph systems.</span>
</span><span id="AgnoPersonalAgent-493"><a href="#AgnoPersonalAgent-493"><span class="linenos">493</span></a>
</span><span id="AgnoPersonalAgent-494"><a href="#AgnoPersonalAgent-494"><span class="linenos">494</span></a><span class="sd">        This is a public method that delegates to the memory_manager.</span>
</span><span id="AgnoPersonalAgent-495"><a href="#AgnoPersonalAgent-495"><span class="linenos">495</span></a>
</span><span id="AgnoPersonalAgent-496"><a href="#AgnoPersonalAgent-496"><span class="linenos">496</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-497"><a href="#AgnoPersonalAgent-497"><span class="linenos">497</span></a><span class="sd">            content: The information to store as a memory</span>
</span><span id="AgnoPersonalAgent-498"><a href="#AgnoPersonalAgent-498"><span class="linenos">498</span></a><span class="sd">            topics: Optional list of topics/categories for the memory (None = auto-classify)</span>
</span><span id="AgnoPersonalAgent-499"><a href="#AgnoPersonalAgent-499"><span class="linenos">499</span></a>
</span><span id="AgnoPersonalAgent-500"><a href="#AgnoPersonalAgent-500"><span class="linenos">500</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-501"><a href="#AgnoPersonalAgent-501"><span class="linenos">501</span></a><span class="sd">            MemoryStorageResult: Structured result with detailed status information</span>
</span><span id="AgnoPersonalAgent-502"><a href="#AgnoPersonalAgent-502"><span class="linenos">502</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-503"><a href="#AgnoPersonalAgent-503"><span class="linenos">503</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">store_user_memory</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-504"><a href="#AgnoPersonalAgent-504"><span class="linenos">504</span></a>
</span><span id="AgnoPersonalAgent-505"><a href="#AgnoPersonalAgent-505"><span class="linenos">505</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_restate_user_fact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-506"><a href="#AgnoPersonalAgent-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Restate a user fact from first-person to third-person.</span>
</span><span id="AgnoPersonalAgent-507"><a href="#AgnoPersonalAgent-507"><span class="linenos">507</span></a>
</span><span id="AgnoPersonalAgent-508"><a href="#AgnoPersonalAgent-508"><span class="linenos">508</span></a><span class="sd">        Delegates to the memory_manager for processing.</span>
</span><span id="AgnoPersonalAgent-509"><a href="#AgnoPersonalAgent-509"><span class="linenos">509</span></a>
</span><span id="AgnoPersonalAgent-510"><a href="#AgnoPersonalAgent-510"><span class="linenos">510</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-511"><a href="#AgnoPersonalAgent-511"><span class="linenos">511</span></a><span class="sd">            content: The original fact from the user</span>
</span><span id="AgnoPersonalAgent-512"><a href="#AgnoPersonalAgent-512"><span class="linenos">512</span></a>
</span><span id="AgnoPersonalAgent-513"><a href="#AgnoPersonalAgent-513"><span class="linenos">513</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-514"><a href="#AgnoPersonalAgent-514"><span class="linenos">514</span></a><span class="sd">            The restated fact</span>
</span><span id="AgnoPersonalAgent-515"><a href="#AgnoPersonalAgent-515"><span class="linenos">515</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-516"><a href="#AgnoPersonalAgent-516"><span class="linenos">516</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">restate_user_fact</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-517"><a href="#AgnoPersonalAgent-517"><span class="linenos">517</span></a>
</span><span id="AgnoPersonalAgent-518"><a href="#AgnoPersonalAgent-518"><span class="linenos">518</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">seed_entity_in_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-519"><a href="#AgnoPersonalAgent-519"><span class="linenos">519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Seed an entity into the graph by creating and uploading a physical file.</span>
</span><span id="AgnoPersonalAgent-520"><a href="#AgnoPersonalAgent-520"><span class="linenos">520</span></a>
</span><span id="AgnoPersonalAgent-521"><a href="#AgnoPersonalAgent-521"><span class="linenos">521</span></a><span class="sd">        Delegates to the memory_manager for processing.</span>
</span><span id="AgnoPersonalAgent-522"><a href="#AgnoPersonalAgent-522"><span class="linenos">522</span></a>
</span><span id="AgnoPersonalAgent-523"><a href="#AgnoPersonalAgent-523"><span class="linenos">523</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-524"><a href="#AgnoPersonalAgent-524"><span class="linenos">524</span></a><span class="sd">            entity_name: Name of the entity to create</span>
</span><span id="AgnoPersonalAgent-525"><a href="#AgnoPersonalAgent-525"><span class="linenos">525</span></a><span class="sd">            entity_type: Type of the entity</span>
</span><span id="AgnoPersonalAgent-526"><a href="#AgnoPersonalAgent-526"><span class="linenos">526</span></a>
</span><span id="AgnoPersonalAgent-527"><a href="#AgnoPersonalAgent-527"><span class="linenos">527</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-528"><a href="#AgnoPersonalAgent-528"><span class="linenos">528</span></a><span class="sd">            True if entity was successfully seeded</span>
</span><span id="AgnoPersonalAgent-529"><a href="#AgnoPersonalAgent-529"><span class="linenos">529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-530"><a href="#AgnoPersonalAgent-530"><span class="linenos">530</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">seed_entity_in_graph</span><span class="p">(</span><span class="n">entity_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-531"><a href="#AgnoPersonalAgent-531"><span class="linenos">531</span></a>
</span><span id="AgnoPersonalAgent-532"><a href="#AgnoPersonalAgent-532"><span class="linenos">532</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_entity_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-533"><a href="#AgnoPersonalAgent-533"><span class="linenos">533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if entity exists in the graph.</span>
</span><span id="AgnoPersonalAgent-534"><a href="#AgnoPersonalAgent-534"><span class="linenos">534</span></a>
</span><span id="AgnoPersonalAgent-535"><a href="#AgnoPersonalAgent-535"><span class="linenos">535</span></a><span class="sd">        Delegates to the memory_manager for processing.</span>
</span><span id="AgnoPersonalAgent-536"><a href="#AgnoPersonalAgent-536"><span class="linenos">536</span></a>
</span><span id="AgnoPersonalAgent-537"><a href="#AgnoPersonalAgent-537"><span class="linenos">537</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-538"><a href="#AgnoPersonalAgent-538"><span class="linenos">538</span></a><span class="sd">            entity_name: Name of the entity to check</span>
</span><span id="AgnoPersonalAgent-539"><a href="#AgnoPersonalAgent-539"><span class="linenos">539</span></a>
</span><span id="AgnoPersonalAgent-540"><a href="#AgnoPersonalAgent-540"><span class="linenos">540</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-541"><a href="#AgnoPersonalAgent-541"><span class="linenos">541</span></a><span class="sd">            True if entity exists</span>
</span><span id="AgnoPersonalAgent-542"><a href="#AgnoPersonalAgent-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-543"><a href="#AgnoPersonalAgent-543"><span class="linenos">543</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">check_entity_exists</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-544"><a href="#AgnoPersonalAgent-544"><span class="linenos">544</span></a>
</span><span id="AgnoPersonalAgent-545"><a href="#AgnoPersonalAgent-545"><span class="linenos">545</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_all_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-546"><a href="#AgnoPersonalAgent-546"><span class="linenos">546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all memories from both SQLite and LightRAG systems.</span>
</span><span id="AgnoPersonalAgent-547"><a href="#AgnoPersonalAgent-547"><span class="linenos">547</span></a>
</span><span id="AgnoPersonalAgent-548"><a href="#AgnoPersonalAgent-548"><span class="linenos">548</span></a><span class="sd">        Delegates to the memory_manager for processing.</span>
</span><span id="AgnoPersonalAgent-549"><a href="#AgnoPersonalAgent-549"><span class="linenos">549</span></a>
</span><span id="AgnoPersonalAgent-550"><a href="#AgnoPersonalAgent-550"><span class="linenos">550</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-551"><a href="#AgnoPersonalAgent-551"><span class="linenos">551</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgnoPersonalAgent-552"><a href="#AgnoPersonalAgent-552"><span class="linenos">552</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-553"><a href="#AgnoPersonalAgent-553"><span class="linenos">553</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">clear_all_memories</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-554"><a href="#AgnoPersonalAgent-554"><span class="linenos">554</span></a>
</span><span id="AgnoPersonalAgent-555"><a href="#AgnoPersonalAgent-555"><span class="linenos">555</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_lightrag_knowledge_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-556"><a href="#AgnoPersonalAgent-556"><span class="linenos">556</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Directly query the LightRAG knowledge base and return the raw response.</span>
</span><span id="AgnoPersonalAgent-557"><a href="#AgnoPersonalAgent-557"><span class="linenos">557</span></a>
</span><span id="AgnoPersonalAgent-558"><a href="#AgnoPersonalAgent-558"><span class="linenos">558</span></a><span class="sd">        Delegates to the knowledge_manager for processing.</span>
</span><span id="AgnoPersonalAgent-559"><a href="#AgnoPersonalAgent-559"><span class="linenos">559</span></a>
</span><span id="AgnoPersonalAgent-560"><a href="#AgnoPersonalAgent-560"><span class="linenos">560</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-561"><a href="#AgnoPersonalAgent-561"><span class="linenos">561</span></a><span class="sd">            query: The query string to search in the knowledge base</span>
</span><span id="AgnoPersonalAgent-562"><a href="#AgnoPersonalAgent-562"><span class="linenos">562</span></a><span class="sd">            params: A dictionary of query parameters</span>
</span><span id="AgnoPersonalAgent-563"><a href="#AgnoPersonalAgent-563"><span class="linenos">563</span></a>
</span><span id="AgnoPersonalAgent-564"><a href="#AgnoPersonalAgent-564"><span class="linenos">564</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-565"><a href="#AgnoPersonalAgent-565"><span class="linenos">565</span></a><span class="sd">            String with query results exactly as LightRAG returns them</span>
</span><span id="AgnoPersonalAgent-566"><a href="#AgnoPersonalAgent-566"><span class="linenos">566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-567"><a href="#AgnoPersonalAgent-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span><span class="o">.</span><span class="n">query_graph</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-568"><a href="#AgnoPersonalAgent-568"><span class="linenos">568</span></a>
</span><span id="AgnoPersonalAgent-569"><a href="#AgnoPersonalAgent-569"><span class="linenos">569</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_mcp_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-570"><a href="#AgnoPersonalAgent-570"><span class="linenos">570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create MCP tools as native async functions compatible with Agno.</span>
</span><span id="AgnoPersonalAgent-571"><a href="#AgnoPersonalAgent-571"><span class="linenos">571</span></a>
</span><span id="AgnoPersonalAgent-572"><a href="#AgnoPersonalAgent-572"><span class="linenos">572</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-573"><a href="#AgnoPersonalAgent-573"><span class="linenos">573</span></a><span class="sd">            List of MCP tool functions</span>
</span><span id="AgnoPersonalAgent-574"><a href="#AgnoPersonalAgent-574"><span class="linenos">574</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-575"><a href="#AgnoPersonalAgent-575"><span class="linenos">575</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-576"><a href="#AgnoPersonalAgent-576"><span class="linenos">576</span></a>            <span class="s2">&quot;_get_mcp_tools called - enable_mcp: </span><span class="si">%s</span><span class="s2">, mcp_servers: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-577"><a href="#AgnoPersonalAgent-577"><span class="linenos">577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-578"><a href="#AgnoPersonalAgent-578"><span class="linenos">578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-579"><a href="#AgnoPersonalAgent-579"><span class="linenos">579</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-580"><a href="#AgnoPersonalAgent-580"><span class="linenos">580</span></a>
</span><span id="AgnoPersonalAgent-581"><a href="#AgnoPersonalAgent-581"><span class="linenos">581</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-582"><a href="#AgnoPersonalAgent-582"><span class="linenos">582</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MCP disabled - enable_mcp is False&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-583"><a href="#AgnoPersonalAgent-583"><span class="linenos">583</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent-584"><a href="#AgnoPersonalAgent-584"><span class="linenos">584</span></a>
</span><span id="AgnoPersonalAgent-585"><a href="#AgnoPersonalAgent-585"><span class="linenos">585</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-586"><a href="#AgnoPersonalAgent-586"><span class="linenos">586</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-587"><a href="#AgnoPersonalAgent-587"><span class="linenos">587</span></a>                <span class="s2">&quot;No MCP servers configured - mcp_servers is empty: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span>
</span><span id="AgnoPersonalAgent-588"><a href="#AgnoPersonalAgent-588"><span class="linenos">588</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-589"><a href="#AgnoPersonalAgent-589"><span class="linenos">589</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent-590"><a href="#AgnoPersonalAgent-590"><span class="linenos">590</span></a>
</span><span id="AgnoPersonalAgent-591"><a href="#AgnoPersonalAgent-591"><span class="linenos">591</span></a>        <span class="c1"># This method is complex and specific to MCP integration</span>
</span><span id="AgnoPersonalAgent-592"><a href="#AgnoPersonalAgent-592"><span class="linenos">592</span></a>        <span class="c1"># For now, we&#39;ll keep the original implementation</span>
</span><span id="AgnoPersonalAgent-593"><a href="#AgnoPersonalAgent-593"><span class="linenos">593</span></a>        <span class="c1"># In the future, this could be moved to the tool_manager</span>
</span><span id="AgnoPersonalAgent-594"><a href="#AgnoPersonalAgent-594"><span class="linenos">594</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent-595"><a href="#AgnoPersonalAgent-595"><span class="linenos">595</span></a>
</span><span id="AgnoPersonalAgent-596"><a href="#AgnoPersonalAgent-596"><span class="linenos">596</span></a>        <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgnoPersonalAgent-597"><a href="#AgnoPersonalAgent-597"><span class="linenos">597</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting up MCP tool for server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-598"><a href="#AgnoPersonalAgent-598"><span class="linenos">598</span></a>
</span><span id="AgnoPersonalAgent-599"><a href="#AgnoPersonalAgent-599"><span class="linenos">599</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="s2">&quot;npx&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-600"><a href="#AgnoPersonalAgent-600"><span class="linenos">600</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="AgnoPersonalAgent-601"><a href="#AgnoPersonalAgent-601"><span class="linenos">601</span></a>            <span class="n">env</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="AgnoPersonalAgent-602"><a href="#AgnoPersonalAgent-602"><span class="linenos">602</span></a>            <span class="n">description</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-603"><a href="#AgnoPersonalAgent-603"><span class="linenos">603</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Access to </span><span class="si">{</span><span class="n">server_name</span><span class="si">}</span><span class="s2"> MCP server&quot;</span>
</span><span id="AgnoPersonalAgent-604"><a href="#AgnoPersonalAgent-604"><span class="linenos">604</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-605"><a href="#AgnoPersonalAgent-605"><span class="linenos">605</span></a>
</span><span id="AgnoPersonalAgent-606"><a href="#AgnoPersonalAgent-606"><span class="linenos">606</span></a>            <span class="c1"># Create the actual tool function with closure</span>
</span><span id="AgnoPersonalAgent-607"><a href="#AgnoPersonalAgent-607"><span class="linenos">607</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">make_mcp_tool</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-608"><a href="#AgnoPersonalAgent-608"><span class="linenos">608</span></a>                <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-609"><a href="#AgnoPersonalAgent-609"><span class="linenos">609</span></a>                <span class="n">cmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-610"><a href="#AgnoPersonalAgent-610"><span class="linenos">610</span></a>                <span class="n">tool_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="AgnoPersonalAgent-611"><a href="#AgnoPersonalAgent-611"><span class="linenos">611</span></a>                <span class="n">tool_env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="AgnoPersonalAgent-612"><a href="#AgnoPersonalAgent-612"><span class="linenos">612</span></a>                <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-613"><a href="#AgnoPersonalAgent-613"><span class="linenos">613</span></a>            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-614"><a href="#AgnoPersonalAgent-614"><span class="linenos">614</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;Create MCP tool function with proper closure.&quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-615"><a href="#AgnoPersonalAgent-615"><span class="linenos">615</span></a>
</span><span id="AgnoPersonalAgent-616"><a href="#AgnoPersonalAgent-616"><span class="linenos">616</span></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">textwrap</span><span class="w"> </span><span class="kn">import</span> <span class="n">dedent</span>
</span><span id="AgnoPersonalAgent-617"><a href="#AgnoPersonalAgent-617"><span class="linenos">617</span></a>
</span><span id="AgnoPersonalAgent-618"><a href="#AgnoPersonalAgent-618"><span class="linenos">618</span></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">agno.tools.mcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCPTools</span>
</span><span id="AgnoPersonalAgent-619"><a href="#AgnoPersonalAgent-619"><span class="linenos">619</span></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">mcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientSession</span><span class="p">,</span> <span class="n">StdioServerParameters</span>
</span><span id="AgnoPersonalAgent-620"><a href="#AgnoPersonalAgent-620"><span class="linenos">620</span></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">mcp.client.stdio</span><span class="w"> </span><span class="kn">import</span> <span class="n">stdio_client</span>
</span><span id="AgnoPersonalAgent-621"><a href="#AgnoPersonalAgent-621"><span class="linenos">621</span></a>
</span><span id="AgnoPersonalAgent-622"><a href="#AgnoPersonalAgent-622"><span class="linenos">622</span></a>                <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_tool</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-623"><a href="#AgnoPersonalAgent-623"><span class="linenos">623</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;MCP tool function that creates session on-demand.&quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-624"><a href="#AgnoPersonalAgent-624"><span class="linenos">624</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-625"><a href="#AgnoPersonalAgent-625"><span class="linenos">625</span></a>                        <span class="c1"># Prepare environment - convert GITHUB_PERSONAL_ACCESS_TOKEN to GITHUB_TOKEN if needed</span>
</span><span id="AgnoPersonalAgent-626"><a href="#AgnoPersonalAgent-626"><span class="linenos">626</span></a>                        <span class="n">server_env</span> <span class="o">=</span> <span class="n">tool_env</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">tool_env</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="AgnoPersonalAgent-627"><a href="#AgnoPersonalAgent-627"><span class="linenos">627</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="AgnoPersonalAgent-628"><a href="#AgnoPersonalAgent-628"><span class="linenos">628</span></a>                            <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;github&quot;</span>
</span><span id="AgnoPersonalAgent-629"><a href="#AgnoPersonalAgent-629"><span class="linenos">629</span></a>                            <span class="ow">and</span> <span class="s2">&quot;GITHUB_PERSONAL_ACCESS_TOKEN&quot;</span> <span class="ow">in</span> <span class="n">server_env</span>
</span><span id="AgnoPersonalAgent-630"><a href="#AgnoPersonalAgent-630"><span class="linenos">630</span></a>                        <span class="p">):</span>
</span><span id="AgnoPersonalAgent-631"><a href="#AgnoPersonalAgent-631"><span class="linenos">631</span></a>                            <span class="c1"># The GitHub MCP server expects GITHUB_TOKEN</span>
</span><span id="AgnoPersonalAgent-632"><a href="#AgnoPersonalAgent-632"><span class="linenos">632</span></a>                            <span class="n">server_env</span><span class="p">[</span><span class="s2">&quot;GITHUB_TOKEN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server_env</span><span class="p">[</span>
</span><span id="AgnoPersonalAgent-633"><a href="#AgnoPersonalAgent-633"><span class="linenos">633</span></a>                                <span class="s2">&quot;GITHUB_PERSONAL_ACCESS_TOKEN&quot;</span>
</span><span id="AgnoPersonalAgent-634"><a href="#AgnoPersonalAgent-634"><span class="linenos">634</span></a>                            <span class="p">]</span>
</span><span id="AgnoPersonalAgent-635"><a href="#AgnoPersonalAgent-635"><span class="linenos">635</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-636"><a href="#AgnoPersonalAgent-636"><span class="linenos">636</span></a>                                <span class="s2">&quot;Converted GITHUB_PERSONAL_ACCESS_TOKEN to GITHUB_TOKEN for GitHub MCP server&quot;</span>
</span><span id="AgnoPersonalAgent-637"><a href="#AgnoPersonalAgent-637"><span class="linenos">637</span></a>                            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-638"><a href="#AgnoPersonalAgent-638"><span class="linenos">638</span></a>
</span><span id="AgnoPersonalAgent-639"><a href="#AgnoPersonalAgent-639"><span class="linenos">639</span></a>                        <span class="n">server_params</span> <span class="o">=</span> <span class="n">StdioServerParameters</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-640"><a href="#AgnoPersonalAgent-640"><span class="linenos">640</span></a>                            <span class="n">command</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-641"><a href="#AgnoPersonalAgent-641"><span class="linenos">641</span></a>                            <span class="n">args</span><span class="o">=</span><span class="n">tool_args</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-642"><a href="#AgnoPersonalAgent-642"><span class="linenos">642</span></a>                            <span class="n">env</span><span class="o">=</span><span class="n">server_env</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-643"><a href="#AgnoPersonalAgent-643"><span class="linenos">643</span></a>                        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-644"><a href="#AgnoPersonalAgent-644"><span class="linenos">644</span></a>
</span><span id="AgnoPersonalAgent-645"><a href="#AgnoPersonalAgent-645"><span class="linenos">645</span></a>                        <span class="c1"># Create client session using async context manager</span>
</span><span id="AgnoPersonalAgent-646"><a href="#AgnoPersonalAgent-646"><span class="linenos">646</span></a>                        <span class="k">async</span> <span class="k">with</span> <span class="n">stdio_client</span><span class="p">(</span><span class="n">server_params</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
</span><span id="AgnoPersonalAgent-647"><a href="#AgnoPersonalAgent-647"><span class="linenos">647</span></a>                            <span class="k">async</span> <span class="k">with</span> <span class="n">ClientSession</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">write</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-648"><a href="#AgnoPersonalAgent-648"><span class="linenos">648</span></a>                                <span class="c1"># Initialize MCP toolkit with session</span>
</span><span id="AgnoPersonalAgent-649"><a href="#AgnoPersonalAgent-649"><span class="linenos">649</span></a>                                <span class="n">mcp_tools</span> <span class="o">=</span> <span class="n">MCPTools</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-650"><a href="#AgnoPersonalAgent-650"><span class="linenos">650</span></a>                                <span class="k">await</span> <span class="n">mcp_tools</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-651"><a href="#AgnoPersonalAgent-651"><span class="linenos">651</span></a>
</span><span id="AgnoPersonalAgent-652"><a href="#AgnoPersonalAgent-652"><span class="linenos">652</span></a>                                <span class="c1"># Create specialized instructions based on server type</span>
</span><span id="AgnoPersonalAgent-653"><a href="#AgnoPersonalAgent-653"><span class="linenos">653</span></a>                                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;github&quot;</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-654"><a href="#AgnoPersonalAgent-654"><span class="linenos">654</span></a>                                    <span class="n">instructions</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-655"><a href="#AgnoPersonalAgent-655"><span class="linenos">655</span></a><span class="w">                                        </span><span class="sd">&quot;&quot;&quot;\</span>
</span><span id="AgnoPersonalAgent-656"><a href="#AgnoPersonalAgent-656"><span class="linenos">656</span></a><span class="sd">                                        You are a GitHub assistant. Help users explore repositories and their activity.</span>
</span><span id="AgnoPersonalAgent-657"><a href="#AgnoPersonalAgent-657"><span class="linenos">657</span></a><span class="sd">                                        - Provide organized, concise insights about the repository</span>
</span><span id="AgnoPersonalAgent-658"><a href="#AgnoPersonalAgent-658"><span class="linenos">658</span></a><span class="sd">                                        - Focus on facts and data from the GitHub API</span>
</span><span id="AgnoPersonalAgent-659"><a href="#AgnoPersonalAgent-659"><span class="linenos">659</span></a><span class="sd">                                        - Use markdown formatting for better readability</span>
</span><span id="AgnoPersonalAgent-660"><a href="#AgnoPersonalAgent-660"><span class="linenos">660</span></a><span class="sd">                                        - Present numerical data in tables when appropriate</span>
</span><span id="AgnoPersonalAgent-661"><a href="#AgnoPersonalAgent-661"><span class="linenos">661</span></a><span class="sd">                                        - Include links to relevant GitHub pages when helpful</span>
</span><span id="AgnoPersonalAgent-662"><a href="#AgnoPersonalAgent-662"><span class="linenos">662</span></a><span class="sd">                                    &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-663"><a href="#AgnoPersonalAgent-663"><span class="linenos">663</span></a>                                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent-664"><a href="#AgnoPersonalAgent-664"><span class="linenos">664</span></a>                                <span class="k">elif</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;filesystem&quot;</span><span class="p">):</span>
</span><span id="AgnoPersonalAgent-665"><a href="#AgnoPersonalAgent-665"><span class="linenos">665</span></a>                                    <span class="n">instructions</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;You are a filesystem assistant for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. Help with file and directory operations.&quot;</span>
</span><span id="AgnoPersonalAgent-666"><a href="#AgnoPersonalAgent-666"><span class="linenos">666</span></a>                                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;brave-search&quot;</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-667"><a href="#AgnoPersonalAgent-667"><span class="linenos">667</span></a>                                    <span class="n">instructions</span> <span class="o">=</span> <span class="s2">&quot;You are a web search assistant. Help users find information on the web.&quot;</span>
</span><span id="AgnoPersonalAgent-668"><a href="#AgnoPersonalAgent-668"><span class="linenos">668</span></a>                                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;puppeteer&quot;</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-669"><a href="#AgnoPersonalAgent-669"><span class="linenos">669</span></a>                                    <span class="n">instructions</span> <span class="o">=</span> <span class="s2">&quot;You are a browser automation assistant. Help with web scraping and automation tasks.&quot;</span>
</span><span id="AgnoPersonalAgent-670"><a href="#AgnoPersonalAgent-670"><span class="linenos">670</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-671"><a href="#AgnoPersonalAgent-671"><span class="linenos">671</span></a>                                    <span class="n">instructions</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;You are an assistant using </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> MCP server. Help with the user&#39;s request.&quot;</span>
</span><span id="AgnoPersonalAgent-672"><a href="#AgnoPersonalAgent-672"><span class="linenos">672</span></a>
</span><span id="AgnoPersonalAgent-673"><a href="#AgnoPersonalAgent-673"><span class="linenos">673</span></a>                                <span class="c1"># Create a temporary agent for this MCP server</span>
</span><span id="AgnoPersonalAgent-674"><a href="#AgnoPersonalAgent-674"><span class="linenos">674</span></a>                                <span class="n">temp_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-675"><a href="#AgnoPersonalAgent-675"><span class="linenos">675</span></a>                                    <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">create_model</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent-676"><a href="#AgnoPersonalAgent-676"><span class="linenos">676</span></a>                                    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">mcp_tools</span><span class="p">],</span>
</span><span id="AgnoPersonalAgent-677"><a href="#AgnoPersonalAgent-677"><span class="linenos">677</span></a>                                    <span class="n">instructions</span><span class="o">=</span><span class="n">instructions</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-678"><a href="#AgnoPersonalAgent-678"><span class="linenos">678</span></a>                                    <span class="n">markdown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-679"><a href="#AgnoPersonalAgent-679"><span class="linenos">679</span></a>                                    <span class="n">show_tool_calls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-680"><a href="#AgnoPersonalAgent-680"><span class="linenos">680</span></a>                                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-681"><a href="#AgnoPersonalAgent-681"><span class="linenos">681</span></a>
</span><span id="AgnoPersonalAgent-682"><a href="#AgnoPersonalAgent-682"><span class="linenos">682</span></a>                                <span class="c1"># Run the query</span>
</span><span id="AgnoPersonalAgent-683"><a href="#AgnoPersonalAgent-683"><span class="linenos">683</span></a>                                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">temp_agent</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-684"><a href="#AgnoPersonalAgent-684"><span class="linenos">684</span></a>                                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
</span><span id="AgnoPersonalAgent-685"><a href="#AgnoPersonalAgent-685"><span class="linenos">685</span></a>
</span><span id="AgnoPersonalAgent-686"><a href="#AgnoPersonalAgent-686"><span class="linenos">686</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-687"><a href="#AgnoPersonalAgent-687"><span class="linenos">687</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error running </span><span class="si">%s</span><span class="s2"> MCP server: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-688"><a href="#AgnoPersonalAgent-688"><span class="linenos">688</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error using </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgnoPersonalAgent-689"><a href="#AgnoPersonalAgent-689"><span class="linenos">689</span></a>
</span><span id="AgnoPersonalAgent-690"><a href="#AgnoPersonalAgent-690"><span class="linenos">690</span></a>                <span class="c1"># Set function metadata</span>
</span><span id="AgnoPersonalAgent-691"><a href="#AgnoPersonalAgent-691"><span class="linenos">691</span></a>                <span class="n">mcp_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;use_</span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_server&quot;</span>
</span><span id="AgnoPersonalAgent-692"><a href="#AgnoPersonalAgent-692"><span class="linenos">692</span></a>                <span class="n">mcp_tool</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Use </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> MCP server for: </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span>
</span><span id="AgnoPersonalAgent-693"><a href="#AgnoPersonalAgent-693"><span class="linenos">693</span></a>
</span><span id="AgnoPersonalAgent-694"><a href="#AgnoPersonalAgent-694"><span class="linenos">694</span></a><span class="s2">Args:</span>
</span><span id="AgnoPersonalAgent-695"><a href="#AgnoPersonalAgent-695"><span class="linenos">695</span></a><span class="s2">    query: The query or task to execute using </span><span class="si">{</span><span class="n">name</span><span class="si">}</span>
</span><span id="AgnoPersonalAgent-696"><a href="#AgnoPersonalAgent-696"><span class="linenos">696</span></a>
</span><span id="AgnoPersonalAgent-697"><a href="#AgnoPersonalAgent-697"><span class="linenos">697</span></a><span class="s2">Returns:</span>
</span><span id="AgnoPersonalAgent-698"><a href="#AgnoPersonalAgent-698"><span class="linenos">698</span></a><span class="s2">    str: Result from the MCP server</span>
</span><span id="AgnoPersonalAgent-699"><a href="#AgnoPersonalAgent-699"><span class="linenos">699</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-700"><a href="#AgnoPersonalAgent-700"><span class="linenos">700</span></a>
</span><span id="AgnoPersonalAgent-701"><a href="#AgnoPersonalAgent-701"><span class="linenos">701</span></a>                <span class="k">return</span> <span class="n">mcp_tool</span>
</span><span id="AgnoPersonalAgent-702"><a href="#AgnoPersonalAgent-702"><span class="linenos">702</span></a>
</span><span id="AgnoPersonalAgent-703"><a href="#AgnoPersonalAgent-703"><span class="linenos">703</span></a>            <span class="n">tool_func</span> <span class="o">=</span> <span class="n">make_mcp_tool</span><span class="p">(</span><span class="n">server_name</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-704"><a href="#AgnoPersonalAgent-704"><span class="linenos">704</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-705"><a href="#AgnoPersonalAgent-705"><span class="linenos">705</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created MCP tool function for: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-706"><a href="#AgnoPersonalAgent-706"><span class="linenos">706</span></a>
</span><span id="AgnoPersonalAgent-707"><a href="#AgnoPersonalAgent-707"><span class="linenos">707</span></a>        <span class="k">return</span> <span class="n">tools</span>
</span><span id="AgnoPersonalAgent-708"><a href="#AgnoPersonalAgent-708"><span class="linenos">708</span></a>
</span><span id="AgnoPersonalAgent-709"><a href="#AgnoPersonalAgent-709"><span class="linenos">709</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_agent_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AgnoPersonalAgent-710"><a href="#AgnoPersonalAgent-710"><span class="linenos">710</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive information about the agent configuration and tools.</span>
</span><span id="AgnoPersonalAgent-711"><a href="#AgnoPersonalAgent-711"><span class="linenos">711</span></a>
</span><span id="AgnoPersonalAgent-712"><a href="#AgnoPersonalAgent-712"><span class="linenos">712</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent-713"><a href="#AgnoPersonalAgent-713"><span class="linenos">713</span></a><span class="sd">            Dictionary containing detailed agent configuration and tool information</span>
</span><span id="AgnoPersonalAgent-714"><a href="#AgnoPersonalAgent-714"><span class="linenos">714</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-715"><a href="#AgnoPersonalAgent-715"><span class="linenos">715</span></a>        <span class="c1"># Get basic tool info</span>
</span><span id="AgnoPersonalAgent-716"><a href="#AgnoPersonalAgent-716"><span class="linenos">716</span></a>        <span class="n">built_in_tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent-717"><a href="#AgnoPersonalAgent-717"><span class="linenos">717</span></a>        <span class="n">mcp_tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent-718"><a href="#AgnoPersonalAgent-718"><span class="linenos">718</span></a>
</span><span id="AgnoPersonalAgent-719"><a href="#AgnoPersonalAgent-719"><span class="linenos">719</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">):</span>
</span><span id="AgnoPersonalAgent-720"><a href="#AgnoPersonalAgent-720"><span class="linenos">720</span></a>            <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-721"><a href="#AgnoPersonalAgent-721"><span class="linenos">721</span></a>                <span class="n">tool_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
</span><span id="AgnoPersonalAgent-722"><a href="#AgnoPersonalAgent-722"><span class="linenos">722</span></a>                <span class="n">tool_doc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;__doc__&quot;</span><span class="p">,</span> <span class="s2">&quot;No description available&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-723"><a href="#AgnoPersonalAgent-723"><span class="linenos">723</span></a>
</span><span id="AgnoPersonalAgent-724"><a href="#AgnoPersonalAgent-724"><span class="linenos">724</span></a>                <span class="c1"># Clean up docstring for display</span>
</span><span id="AgnoPersonalAgent-725"><a href="#AgnoPersonalAgent-725"><span class="linenos">725</span></a>                <span class="k">if</span> <span class="n">tool_doc</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-726"><a href="#AgnoPersonalAgent-726"><span class="linenos">726</span></a>                    <span class="n">tool_doc</span> <span class="o">=</span> <span class="n">tool_doc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># First line only</span>
</span><span id="AgnoPersonalAgent-727"><a href="#AgnoPersonalAgent-727"><span class="linenos">727</span></a>
</span><span id="AgnoPersonalAgent-728"><a href="#AgnoPersonalAgent-728"><span class="linenos">728</span></a>                <span class="k">if</span> <span class="n">tool_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;use_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;_server&quot;</span> <span class="ow">in</span> <span class="n">tool_name</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-729"><a href="#AgnoPersonalAgent-729"><span class="linenos">729</span></a>                    <span class="n">mcp_tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-730"><a href="#AgnoPersonalAgent-730"><span class="linenos">730</span></a>                        <span class="p">{</span>
</span><span id="AgnoPersonalAgent-731"><a href="#AgnoPersonalAgent-731"><span class="linenos">731</span></a>                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-732"><a href="#AgnoPersonalAgent-732"><span class="linenos">732</span></a>                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">tool_doc</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-733"><a href="#AgnoPersonalAgent-733"><span class="linenos">733</span></a>                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MCP Server&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-734"><a href="#AgnoPersonalAgent-734"><span class="linenos">734</span></a>                        <span class="p">}</span>
</span><span id="AgnoPersonalAgent-735"><a href="#AgnoPersonalAgent-735"><span class="linenos">735</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent-736"><a href="#AgnoPersonalAgent-736"><span class="linenos">736</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-737"><a href="#AgnoPersonalAgent-737"><span class="linenos">737</span></a>                    <span class="n">built_in_tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-738"><a href="#AgnoPersonalAgent-738"><span class="linenos">738</span></a>                        <span class="p">{</span>
</span><span id="AgnoPersonalAgent-739"><a href="#AgnoPersonalAgent-739"><span class="linenos">739</span></a>                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-740"><a href="#AgnoPersonalAgent-740"><span class="linenos">740</span></a>                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">tool_doc</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-741"><a href="#AgnoPersonalAgent-741"><span class="linenos">741</span></a>                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Built-in Tool&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-742"><a href="#AgnoPersonalAgent-742"><span class="linenos">742</span></a>                        <span class="p">}</span>
</span><span id="AgnoPersonalAgent-743"><a href="#AgnoPersonalAgent-743"><span class="linenos">743</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent-744"><a href="#AgnoPersonalAgent-744"><span class="linenos">744</span></a>
</span><span id="AgnoPersonalAgent-745"><a href="#AgnoPersonalAgent-745"><span class="linenos">745</span></a>        <span class="c1"># MCP server details</span>
</span><span id="AgnoPersonalAgent-746"><a href="#AgnoPersonalAgent-746"><span class="linenos">746</span></a>        <span class="n">mcp_server_details</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgnoPersonalAgent-747"><a href="#AgnoPersonalAgent-747"><span class="linenos">747</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-748"><a href="#AgnoPersonalAgent-748"><span class="linenos">748</span></a>            <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgnoPersonalAgent-749"><a href="#AgnoPersonalAgent-749"><span class="linenos">749</span></a>                <span class="n">mcp_server_details</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgnoPersonalAgent-750"><a href="#AgnoPersonalAgent-750"><span class="linenos">750</span></a>                    <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent-751"><a href="#AgnoPersonalAgent-751"><span class="linenos">751</span></a>                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-752"><a href="#AgnoPersonalAgent-752"><span class="linenos">752</span></a>                        <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Access to </span><span class="si">{</span><span class="n">server_name</span><span class="si">}</span><span class="s2"> MCP server&quot;</span>
</span><span id="AgnoPersonalAgent-753"><a href="#AgnoPersonalAgent-753"><span class="linenos">753</span></a>                    <span class="p">),</span>
</span><span id="AgnoPersonalAgent-754"><a href="#AgnoPersonalAgent-754"><span class="linenos">754</span></a>                    <span class="s2">&quot;args_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">,</span> <span class="p">[])),</span>
</span><span id="AgnoPersonalAgent-755"><a href="#AgnoPersonalAgent-755"><span class="linenos">755</span></a>                    <span class="s2">&quot;env_vars&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">,</span> <span class="p">{})),</span>
</span><span id="AgnoPersonalAgent-756"><a href="#AgnoPersonalAgent-756"><span class="linenos">756</span></a>                <span class="p">}</span>
</span><span id="AgnoPersonalAgent-757"><a href="#AgnoPersonalAgent-757"><span class="linenos">757</span></a>
</span><span id="AgnoPersonalAgent-758"><a href="#AgnoPersonalAgent-758"><span class="linenos">758</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="AgnoPersonalAgent-759"><a href="#AgnoPersonalAgent-759"><span class="linenos">759</span></a>            <span class="s2">&quot;framework&quot;</span><span class="p">:</span> <span class="s2">&quot;agno&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-760"><a href="#AgnoPersonalAgent-760"><span class="linenos">760</span></a>            <span class="s2">&quot;model_provider&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-761"><a href="#AgnoPersonalAgent-761"><span class="linenos">761</span></a>            <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-762"><a href="#AgnoPersonalAgent-762"><span class="linenos">762</span></a>            <span class="s2">&quot;memory_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-763"><a href="#AgnoPersonalAgent-763"><span class="linenos">763</span></a>            <span class="s2">&quot;knowledge_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-764"><a href="#AgnoPersonalAgent-764"><span class="linenos">764</span></a>            <span class="s2">&quot;lightrag_knowledge_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge_enabled</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-765"><a href="#AgnoPersonalAgent-765"><span class="linenos">765</span></a>            <span class="s2">&quot;mcp_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-766"><a href="#AgnoPersonalAgent-766"><span class="linenos">766</span></a>            <span class="s2">&quot;debug_mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-767"><a href="#AgnoPersonalAgent-767"><span class="linenos">767</span></a>            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-768"><a href="#AgnoPersonalAgent-768"><span class="linenos">768</span></a>            <span class="s2">&quot;initialized&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-769"><a href="#AgnoPersonalAgent-769"><span class="linenos">769</span></a>            <span class="s2">&quot;storage_dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-770"><a href="#AgnoPersonalAgent-770"><span class="linenos">770</span></a>            <span class="s2">&quot;knowledge_dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_dir</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-771"><a href="#AgnoPersonalAgent-771"><span class="linenos">771</span></a>            <span class="s2">&quot;lightrag_url&quot;</span><span class="p">:</span> <span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-772"><a href="#AgnoPersonalAgent-772"><span class="linenos">772</span></a>            <span class="s2">&quot;lightrag_memory_url&quot;</span><span class="p">:</span> <span class="n">LIGHTRAG_MEMORY_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-773"><a href="#AgnoPersonalAgent-773"><span class="linenos">773</span></a>            <span class="s2">&quot;tool_counts&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AgnoPersonalAgent-774"><a href="#AgnoPersonalAgent-774"><span class="linenos">774</span></a>                <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">built_in_tools</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tools</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent-775"><a href="#AgnoPersonalAgent-775"><span class="linenos">775</span></a>                <span class="s2">&quot;built_in&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">built_in_tools</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent-776"><a href="#AgnoPersonalAgent-776"><span class="linenos">776</span></a>                <span class="s2">&quot;mcp&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tools</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent-777"><a href="#AgnoPersonalAgent-777"><span class="linenos">777</span></a>                <span class="s2">&quot;mcp_servers&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-778"><a href="#AgnoPersonalAgent-778"><span class="linenos">778</span></a>            <span class="p">},</span>
</span><span id="AgnoPersonalAgent-779"><a href="#AgnoPersonalAgent-779"><span class="linenos">779</span></a>            <span class="s2">&quot;built_in_tools&quot;</span><span class="p">:</span> <span class="n">built_in_tools</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-780"><a href="#AgnoPersonalAgent-780"><span class="linenos">780</span></a>            <span class="s2">&quot;mcp_tools&quot;</span><span class="p">:</span> <span class="n">mcp_tools</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-781"><a href="#AgnoPersonalAgent-781"><span class="linenos">781</span></a>            <span class="s2">&quot;mcp_servers&quot;</span><span class="p">:</span> <span class="n">mcp_server_details</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-782"><a href="#AgnoPersonalAgent-782"><span class="linenos">782</span></a>        <span class="p">}</span>
</span><span id="AgnoPersonalAgent-783"><a href="#AgnoPersonalAgent-783"><span class="linenos">783</span></a>
</span><span id="AgnoPersonalAgent-784"><a href="#AgnoPersonalAgent-784"><span class="linenos">784</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_agent_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Console</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-785"><a href="#AgnoPersonalAgent-785"><span class="linenos">785</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty print comprehensive agent information using Rich.</span>
</span><span id="AgnoPersonalAgent-786"><a href="#AgnoPersonalAgent-786"><span class="linenos">786</span></a>
</span><span id="AgnoPersonalAgent-787"><a href="#AgnoPersonalAgent-787"><span class="linenos">787</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent-788"><a href="#AgnoPersonalAgent-788"><span class="linenos">788</span></a><span class="sd">            console: Optional Rich Console instance. If None, creates a new one.</span>
</span><span id="AgnoPersonalAgent-789"><a href="#AgnoPersonalAgent-789"><span class="linenos">789</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-790"><a href="#AgnoPersonalAgent-790"><span class="linenos">790</span></a>        <span class="k">if</span> <span class="n">console</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-791"><a href="#AgnoPersonalAgent-791"><span class="linenos">791</span></a>            <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-792"><a href="#AgnoPersonalAgent-792"><span class="linenos">792</span></a>
</span><span id="AgnoPersonalAgent-793"><a href="#AgnoPersonalAgent-793"><span class="linenos">793</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_info</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent-794"><a href="#AgnoPersonalAgent-794"><span class="linenos">794</span></a>
</span><span id="AgnoPersonalAgent-795"><a href="#AgnoPersonalAgent-795"><span class="linenos">795</span></a>        <span class="c1"># Main agent info table</span>
</span><span id="AgnoPersonalAgent-796"><a href="#AgnoPersonalAgent-796"><span class="linenos">796</span></a>        <span class="n">main_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-797"><a href="#AgnoPersonalAgent-797"><span class="linenos">797</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;🤖 Personal AI Agent Configuration&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-798"><a href="#AgnoPersonalAgent-798"><span class="linenos">798</span></a>            <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-799"><a href="#AgnoPersonalAgent-799"><span class="linenos">799</span></a>            <span class="n">header_style</span><span class="o">=</span><span class="s2">&quot;bold magenta&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-800"><a href="#AgnoPersonalAgent-800"><span class="linenos">800</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-801"><a href="#AgnoPersonalAgent-801"><span class="linenos">801</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Setting&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-802"><a href="#AgnoPersonalAgent-802"><span class="linenos">802</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-803"><a href="#AgnoPersonalAgent-803"><span class="linenos">803</span></a>
</span><span id="AgnoPersonalAgent-804"><a href="#AgnoPersonalAgent-804"><span class="linenos">804</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Framework&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;framework&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent-805"><a href="#AgnoPersonalAgent-805"><span class="linenos">805</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Model Provider&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;model_provider&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-806"><a href="#AgnoPersonalAgent-806"><span class="linenos">806</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Model Name&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent-807"><a href="#AgnoPersonalAgent-807"><span class="linenos">807</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Memory Enabled&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;memory_enabled&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent-808"><a href="#AgnoPersonalAgent-808"><span class="linenos">808</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Knowledge Enabled&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;knowledge_enabled&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent-809"><a href="#AgnoPersonalAgent-809"><span class="linenos">809</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-810"><a href="#AgnoPersonalAgent-810"><span class="linenos">810</span></a>            <span class="s2">&quot;LightRAG Knowledge&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;lightrag_knowledge_enabled&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent-811"><a href="#AgnoPersonalAgent-811"><span class="linenos">811</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-812"><a href="#AgnoPersonalAgent-812"><span class="linenos">812</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;MCP Enabled&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_enabled&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent-813"><a href="#AgnoPersonalAgent-813"><span class="linenos">813</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Debug Mode&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;debug_mode&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent-814"><a href="#AgnoPersonalAgent-814"><span class="linenos">814</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;User ID&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent-815"><a href="#AgnoPersonalAgent-815"><span class="linenos">815</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Storage Directory&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;storage_dir&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent-816"><a href="#AgnoPersonalAgent-816"><span class="linenos">816</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Knowledge Directory&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;knowledge_dir&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent-817"><a href="#AgnoPersonalAgent-817"><span class="linenos">817</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Total Tools&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;tool_counts&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent-818"><a href="#AgnoPersonalAgent-818"><span class="linenos">818</span></a>
</span><span id="AgnoPersonalAgent-819"><a href="#AgnoPersonalAgent-819"><span class="linenos">819</span></a>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">main_table</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-820"><a href="#AgnoPersonalAgent-820"><span class="linenos">820</span></a>
</span><span id="AgnoPersonalAgent-821"><a href="#AgnoPersonalAgent-821"><span class="linenos">821</span></a>        <span class="c1"># Tools table</span>
</span><span id="AgnoPersonalAgent-822"><a href="#AgnoPersonalAgent-822"><span class="linenos">822</span></a>        <span class="n">tools_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-823"><a href="#AgnoPersonalAgent-823"><span class="linenos">823</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;🛠️ Available Tools&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-824"><a href="#AgnoPersonalAgent-824"><span class="linenos">824</span></a>            <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-825"><a href="#AgnoPersonalAgent-825"><span class="linenos">825</span></a>            <span class="n">header_style</span><span class="o">=</span><span class="s2">&quot;bold magenta&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-826"><a href="#AgnoPersonalAgent-826"><span class="linenos">826</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent-827"><a href="#AgnoPersonalAgent-827"><span class="linenos">827</span></a>        <span class="n">tools_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-828"><a href="#AgnoPersonalAgent-828"><span class="linenos">828</span></a>        <span class="n">tools_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-829"><a href="#AgnoPersonalAgent-829"><span class="linenos">829</span></a>        <span class="n">tools_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-830"><a href="#AgnoPersonalAgent-830"><span class="linenos">830</span></a>
</span><span id="AgnoPersonalAgent-831"><a href="#AgnoPersonalAgent-831"><span class="linenos">831</span></a>        <span class="c1"># Add built-in tools</span>
</span><span id="AgnoPersonalAgent-832"><a href="#AgnoPersonalAgent-832"><span class="linenos">832</span></a>        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;built_in_tools&quot;</span><span class="p">]:</span>
</span><span id="AgnoPersonalAgent-833"><a href="#AgnoPersonalAgent-833"><span class="linenos">833</span></a>            <span class="n">tools_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-834"><a href="#AgnoPersonalAgent-834"><span class="linenos">834</span></a>                <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">tool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-835"><a href="#AgnoPersonalAgent-835"><span class="linenos">835</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-836"><a href="#AgnoPersonalAgent-836"><span class="linenos">836</span></a>
</span><span id="AgnoPersonalAgent-837"><a href="#AgnoPersonalAgent-837"><span class="linenos">837</span></a>        <span class="c1"># Add MCP tools</span>
</span><span id="AgnoPersonalAgent-838"><a href="#AgnoPersonalAgent-838"><span class="linenos">838</span></a>        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_tools&quot;</span><span class="p">]:</span>
</span><span id="AgnoPersonalAgent-839"><a href="#AgnoPersonalAgent-839"><span class="linenos">839</span></a>            <span class="n">tools_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-840"><a href="#AgnoPersonalAgent-840"><span class="linenos">840</span></a>                <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">tool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-841"><a href="#AgnoPersonalAgent-841"><span class="linenos">841</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-842"><a href="#AgnoPersonalAgent-842"><span class="linenos">842</span></a>
</span><span id="AgnoPersonalAgent-843"><a href="#AgnoPersonalAgent-843"><span class="linenos">843</span></a>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">tools_table</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-844"><a href="#AgnoPersonalAgent-844"><span class="linenos">844</span></a>
</span><span id="AgnoPersonalAgent-845"><a href="#AgnoPersonalAgent-845"><span class="linenos">845</span></a>        <span class="c1"># MCP servers table if enabled</span>
</span><span id="AgnoPersonalAgent-846"><a href="#AgnoPersonalAgent-846"><span class="linenos">846</span></a>        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_enabled&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_servers&quot;</span><span class="p">]:</span>
</span><span id="AgnoPersonalAgent-847"><a href="#AgnoPersonalAgent-847"><span class="linenos">847</span></a>            <span class="n">mcp_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-848"><a href="#AgnoPersonalAgent-848"><span class="linenos">848</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;🔌 MCP Servers&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-849"><a href="#AgnoPersonalAgent-849"><span class="linenos">849</span></a>                <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-850"><a href="#AgnoPersonalAgent-850"><span class="linenos">850</span></a>                <span class="n">header_style</span><span class="o">=</span><span class="s2">&quot;bold magenta&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-851"><a href="#AgnoPersonalAgent-851"><span class="linenos">851</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent-852"><a href="#AgnoPersonalAgent-852"><span class="linenos">852</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Server Name&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-853"><a href="#AgnoPersonalAgent-853"><span class="linenos">853</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Command&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-854"><a href="#AgnoPersonalAgent-854"><span class="linenos">854</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-855"><a href="#AgnoPersonalAgent-855"><span class="linenos">855</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Args Count&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-856"><a href="#AgnoPersonalAgent-856"><span class="linenos">856</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Env Vars&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-857"><a href="#AgnoPersonalAgent-857"><span class="linenos">857</span></a>
</span><span id="AgnoPersonalAgent-858"><a href="#AgnoPersonalAgent-858"><span class="linenos">858</span></a>            <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">server_info</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_servers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgnoPersonalAgent-859"><a href="#AgnoPersonalAgent-859"><span class="linenos">859</span></a>                <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent-860"><a href="#AgnoPersonalAgent-860"><span class="linenos">860</span></a>                    <span class="n">server_name</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent-861"><a href="#AgnoPersonalAgent-861"><span class="linenos">861</span></a>                    <span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">],</span>
</span><span id="AgnoPersonalAgent-862"><a href="#AgnoPersonalAgent-862"><span class="linenos">862</span></a>                    <span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
</span><span id="AgnoPersonalAgent-863"><a href="#AgnoPersonalAgent-863"><span class="linenos">863</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;args_count&quot;</span><span class="p">]),</span>
</span><span id="AgnoPersonalAgent-864"><a href="#AgnoPersonalAgent-864"><span class="linenos">864</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;env_vars&quot;</span><span class="p">]),</span>
</span><span id="AgnoPersonalAgent-865"><a href="#AgnoPersonalAgent-865"><span class="linenos">865</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent-866"><a href="#AgnoPersonalAgent-866"><span class="linenos">866</span></a>
</span><span id="AgnoPersonalAgent-867"><a href="#AgnoPersonalAgent-867"><span class="linenos">867</span></a>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">mcp_table</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-868"><a href="#AgnoPersonalAgent-868"><span class="linenos">868</span></a>
</span><span id="AgnoPersonalAgent-869"><a href="#AgnoPersonalAgent-869"><span class="linenos">869</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-870"><a href="#AgnoPersonalAgent-870"><span class="linenos">870</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up resources when the agent is being shut down.</span>
</span><span id="AgnoPersonalAgent-871"><a href="#AgnoPersonalAgent-871"><span class="linenos">871</span></a><span class="sd">        </span>
</span><span id="AgnoPersonalAgent-872"><a href="#AgnoPersonalAgent-872"><span class="linenos">872</span></a><span class="sd">        This method is called during application shutdown to properly</span>
</span><span id="AgnoPersonalAgent-873"><a href="#AgnoPersonalAgent-873"><span class="linenos">873</span></a><span class="sd">        clean up any resources, connections, or background tasks.</span>
</span><span id="AgnoPersonalAgent-874"><a href="#AgnoPersonalAgent-874"><span class="linenos">874</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-875"><a href="#AgnoPersonalAgent-875"><span class="linenos">875</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-876"><a href="#AgnoPersonalAgent-876"><span class="linenos">876</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up AgnoPersonalAgent resources...&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-877"><a href="#AgnoPersonalAgent-877"><span class="linenos">877</span></a>            
</span><span id="AgnoPersonalAgent-878"><a href="#AgnoPersonalAgent-878"><span class="linenos">878</span></a>            <span class="c1"># Clean up agent resources</span>
</span><span id="AgnoPersonalAgent-879"><a href="#AgnoPersonalAgent-879"><span class="linenos">879</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-880"><a href="#AgnoPersonalAgent-880"><span class="linenos">880</span></a>                <span class="c1"># Clear the agent reference</span>
</span><span id="AgnoPersonalAgent-881"><a href="#AgnoPersonalAgent-881"><span class="linenos">881</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-882"><a href="#AgnoPersonalAgent-882"><span class="linenos">882</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared agent reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-883"><a href="#AgnoPersonalAgent-883"><span class="linenos">883</span></a>            
</span><span id="AgnoPersonalAgent-884"><a href="#AgnoPersonalAgent-884"><span class="linenos">884</span></a>            <span class="c1"># Clean up storage references</span>
</span><span id="AgnoPersonalAgent-885"><a href="#AgnoPersonalAgent-885"><span class="linenos">885</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-886"><a href="#AgnoPersonalAgent-886"><span class="linenos">886</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-887"><a href="#AgnoPersonalAgent-887"><span class="linenos">887</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared storage reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-888"><a href="#AgnoPersonalAgent-888"><span class="linenos">888</span></a>                
</span><span id="AgnoPersonalAgent-889"><a href="#AgnoPersonalAgent-889"><span class="linenos">889</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-890"><a href="#AgnoPersonalAgent-890"><span class="linenos">890</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-891"><a href="#AgnoPersonalAgent-891"><span class="linenos">891</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-892"><a href="#AgnoPersonalAgent-892"><span class="linenos">892</span></a>                
</span><span id="AgnoPersonalAgent-893"><a href="#AgnoPersonalAgent-893"><span class="linenos">893</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-894"><a href="#AgnoPersonalAgent-894"><span class="linenos">894</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-895"><a href="#AgnoPersonalAgent-895"><span class="linenos">895</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared memory reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-896"><a href="#AgnoPersonalAgent-896"><span class="linenos">896</span></a>                
</span><span id="AgnoPersonalAgent-897"><a href="#AgnoPersonalAgent-897"><span class="linenos">897</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-898"><a href="#AgnoPersonalAgent-898"><span class="linenos">898</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-899"><a href="#AgnoPersonalAgent-899"><span class="linenos">899</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge coordinator reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-900"><a href="#AgnoPersonalAgent-900"><span class="linenos">900</span></a>            
</span><span id="AgnoPersonalAgent-901"><a href="#AgnoPersonalAgent-901"><span class="linenos">901</span></a>            <span class="c1"># Clean up manager references safely</span>
</span><span id="AgnoPersonalAgent-902"><a href="#AgnoPersonalAgent-902"><span class="linenos">902</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-903"><a href="#AgnoPersonalAgent-903"><span class="linenos">903</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-904"><a href="#AgnoPersonalAgent-904"><span class="linenos">904</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared model manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-905"><a href="#AgnoPersonalAgent-905"><span class="linenos">905</span></a>                
</span><span id="AgnoPersonalAgent-906"><a href="#AgnoPersonalAgent-906"><span class="linenos">906</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-907"><a href="#AgnoPersonalAgent-907"><span class="linenos">907</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-908"><a href="#AgnoPersonalAgent-908"><span class="linenos">908</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared instruction manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-909"><a href="#AgnoPersonalAgent-909"><span class="linenos">909</span></a>                
</span><span id="AgnoPersonalAgent-910"><a href="#AgnoPersonalAgent-910"><span class="linenos">910</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-911"><a href="#AgnoPersonalAgent-911"><span class="linenos">911</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-912"><a href="#AgnoPersonalAgent-912"><span class="linenos">912</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared memory manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-913"><a href="#AgnoPersonalAgent-913"><span class="linenos">913</span></a>                
</span><span id="AgnoPersonalAgent-914"><a href="#AgnoPersonalAgent-914"><span class="linenos">914</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-915"><a href="#AgnoPersonalAgent-915"><span class="linenos">915</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-916"><a href="#AgnoPersonalAgent-916"><span class="linenos">916</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-917"><a href="#AgnoPersonalAgent-917"><span class="linenos">917</span></a>                
</span><span id="AgnoPersonalAgent-918"><a href="#AgnoPersonalAgent-918"><span class="linenos">918</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-919"><a href="#AgnoPersonalAgent-919"><span class="linenos">919</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-920"><a href="#AgnoPersonalAgent-920"><span class="linenos">920</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared tool manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-921"><a href="#AgnoPersonalAgent-921"><span class="linenos">921</span></a>            
</span><span id="AgnoPersonalAgent-922"><a href="#AgnoPersonalAgent-922"><span class="linenos">922</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;AgnoPersonalAgent cleanup completed successfully&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-923"><a href="#AgnoPersonalAgent-923"><span class="linenos">923</span></a>            
</span><span id="AgnoPersonalAgent-924"><a href="#AgnoPersonalAgent-924"><span class="linenos">924</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-925"><a href="#AgnoPersonalAgent-925"><span class="linenos">925</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error during AgnoPersonalAgent cleanup: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-926"><a href="#AgnoPersonalAgent-926"><span class="linenos">926</span></a>    
</span><span id="AgnoPersonalAgent-927"><a href="#AgnoPersonalAgent-927"><span class="linenos">927</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sync_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-928"><a href="#AgnoPersonalAgent-928"><span class="linenos">928</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Synchronous cleanup method for compatibility.</span>
</span><span id="AgnoPersonalAgent-929"><a href="#AgnoPersonalAgent-929"><span class="linenos">929</span></a><span class="sd">        </span>
</span><span id="AgnoPersonalAgent-930"><a href="#AgnoPersonalAgent-930"><span class="linenos">930</span></a><span class="sd">        This method provides a synchronous interface to cleanup for cases</span>
</span><span id="AgnoPersonalAgent-931"><a href="#AgnoPersonalAgent-931"><span class="linenos">931</span></a><span class="sd">        where async cleanup cannot be used.</span>
</span><span id="AgnoPersonalAgent-932"><a href="#AgnoPersonalAgent-932"><span class="linenos">932</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent-933"><a href="#AgnoPersonalAgent-933"><span class="linenos">933</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-934"><a href="#AgnoPersonalAgent-934"><span class="linenos">934</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running synchronous cleanup...&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-935"><a href="#AgnoPersonalAgent-935"><span class="linenos">935</span></a>            
</span><span id="AgnoPersonalAgent-936"><a href="#AgnoPersonalAgent-936"><span class="linenos">936</span></a>            <span class="c1"># Clean up agent resources without async calls</span>
</span><span id="AgnoPersonalAgent-937"><a href="#AgnoPersonalAgent-937"><span class="linenos">937</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-938"><a href="#AgnoPersonalAgent-938"><span class="linenos">938</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-939"><a href="#AgnoPersonalAgent-939"><span class="linenos">939</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared agent reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-940"><a href="#AgnoPersonalAgent-940"><span class="linenos">940</span></a>            
</span><span id="AgnoPersonalAgent-941"><a href="#AgnoPersonalAgent-941"><span class="linenos">941</span></a>            <span class="c1"># Clean up storage references</span>
</span><span id="AgnoPersonalAgent-942"><a href="#AgnoPersonalAgent-942"><span class="linenos">942</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-943"><a href="#AgnoPersonalAgent-943"><span class="linenos">943</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-944"><a href="#AgnoPersonalAgent-944"><span class="linenos">944</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared storage reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-945"><a href="#AgnoPersonalAgent-945"><span class="linenos">945</span></a>                
</span><span id="AgnoPersonalAgent-946"><a href="#AgnoPersonalAgent-946"><span class="linenos">946</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-947"><a href="#AgnoPersonalAgent-947"><span class="linenos">947</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-948"><a href="#AgnoPersonalAgent-948"><span class="linenos">948</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-949"><a href="#AgnoPersonalAgent-949"><span class="linenos">949</span></a>                
</span><span id="AgnoPersonalAgent-950"><a href="#AgnoPersonalAgent-950"><span class="linenos">950</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-951"><a href="#AgnoPersonalAgent-951"><span class="linenos">951</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-952"><a href="#AgnoPersonalAgent-952"><span class="linenos">952</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared memory reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-953"><a href="#AgnoPersonalAgent-953"><span class="linenos">953</span></a>                
</span><span id="AgnoPersonalAgent-954"><a href="#AgnoPersonalAgent-954"><span class="linenos">954</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-955"><a href="#AgnoPersonalAgent-955"><span class="linenos">955</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-956"><a href="#AgnoPersonalAgent-956"><span class="linenos">956</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge coordinator reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-957"><a href="#AgnoPersonalAgent-957"><span class="linenos">957</span></a>            
</span><span id="AgnoPersonalAgent-958"><a href="#AgnoPersonalAgent-958"><span class="linenos">958</span></a>            <span class="c1"># Clean up manager references</span>
</span><span id="AgnoPersonalAgent-959"><a href="#AgnoPersonalAgent-959"><span class="linenos">959</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-960"><a href="#AgnoPersonalAgent-960"><span class="linenos">960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-961"><a href="#AgnoPersonalAgent-961"><span class="linenos">961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-962"><a href="#AgnoPersonalAgent-962"><span class="linenos">962</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-963"><a href="#AgnoPersonalAgent-963"><span class="linenos">963</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tool_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent-964"><a href="#AgnoPersonalAgent-964"><span class="linenos">964</span></a>            
</span><span id="AgnoPersonalAgent-965"><a href="#AgnoPersonalAgent-965"><span class="linenos">965</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Synchronous cleanup completed successfully&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent-966"><a href="#AgnoPersonalAgent-966"><span class="linenos">966</span></a>            
</span><span id="AgnoPersonalAgent-967"><a href="#AgnoPersonalAgent-967"><span class="linenos">967</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent-968"><a href="#AgnoPersonalAgent-968"><span class="linenos">968</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error during synchronous cleanup: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Refactored Agno-based Personal AI Agent with MCP integration and native storage.</p>

<p>This class coordinates the different components of the agent system,
delegating specific responsibilities to specialized manager classes.</p>
</div>


                            <div id="AgnoPersonalAgent.__init__" class="classattr">
                                        <input id="AgnoPersonalAgent.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AgnoPersonalAgent</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ollama&#39;</span>,</span><span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;qwen3:1.7b&#39;</span>,</span><span class="param">	<span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">enable_mcp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/Shared/personal_agent_data/agno/Eric&#39;</span>,</span><span class="param">	<span class="n">knowledge_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/Shared/personal_agent_data/agno/Eric/knowledge&#39;</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">ollama_base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;http://tesla.local:11434&#39;</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Eric&#39;</span>,</span><span class="param">	<span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">instruction_level</span><span class="p">:</span> <span class="n">personal_agent</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">agent_instruction_manager</span><span class="o">.</span><span class="n">InstructionLevel</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">InstructionLevel</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="AgnoPersonalAgent.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.__init__-76"><a href="#AgnoPersonalAgent.__init__-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.__init__-77"><a href="#AgnoPersonalAgent.__init__-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-78"><a href="#AgnoPersonalAgent.__init__-78"><span class="linenos"> 78</span></a>        <span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ollama&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-79"><a href="#AgnoPersonalAgent.__init__-79"><span class="linenos"> 79</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">LLM_MODEL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-80"><a href="#AgnoPersonalAgent.__init__-80"><span class="linenos"> 80</span></a>        <span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-81"><a href="#AgnoPersonalAgent.__init__-81"><span class="linenos"> 81</span></a>        <span class="n">enable_mcp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-82"><a href="#AgnoPersonalAgent.__init__-82"><span class="linenos"> 82</span></a>        <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AGNO_STORAGE_DIR</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-83"><a href="#AgnoPersonalAgent.__init__-83"><span class="linenos"> 83</span></a>        <span class="n">knowledge_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-84"><a href="#AgnoPersonalAgent.__init__-84"><span class="linenos"> 84</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-85"><a href="#AgnoPersonalAgent.__init__-85"><span class="linenos"> 85</span></a>        <span class="n">ollama_base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OLLAMA_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-86"><a href="#AgnoPersonalAgent.__init__-86"><span class="linenos"> 86</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">USER_ID</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-87"><a href="#AgnoPersonalAgent.__init__-87"><span class="linenos"> 87</span></a>        <span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-88"><a href="#AgnoPersonalAgent.__init__-88"><span class="linenos"> 88</span></a>        <span class="n">instruction_level</span><span class="p">:</span> <span class="n">InstructionLevel</span> <span class="o">=</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-89"><a href="#AgnoPersonalAgent.__init__-89"><span class="linenos"> 89</span></a>        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-90"><a href="#AgnoPersonalAgent.__init__-90"><span class="linenos"> 90</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.__init__-91"><a href="#AgnoPersonalAgent.__init__-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Agno Personal Agent.</span>
</span><span id="AgnoPersonalAgent.__init__-92"><a href="#AgnoPersonalAgent.__init__-92"><span class="linenos"> 92</span></a>
</span><span id="AgnoPersonalAgent.__init__-93"><a href="#AgnoPersonalAgent.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent.__init__-94"><a href="#AgnoPersonalAgent.__init__-94"><span class="linenos"> 94</span></a><span class="sd">            model_provider: LLM provider (&#39;ollama&#39; or &#39;openai&#39;)</span>
</span><span id="AgnoPersonalAgent.__init__-95"><a href="#AgnoPersonalAgent.__init__-95"><span class="linenos"> 95</span></a><span class="sd">            model_name: Model name to use</span>
</span><span id="AgnoPersonalAgent.__init__-96"><a href="#AgnoPersonalAgent.__init__-96"><span class="linenos"> 96</span></a><span class="sd">            enable_memory: Whether to enable memory and knowledge features</span>
</span><span id="AgnoPersonalAgent.__init__-97"><a href="#AgnoPersonalAgent.__init__-97"><span class="linenos"> 97</span></a><span class="sd">            enable_mcp: Whether to enable MCP tool integration</span>
</span><span id="AgnoPersonalAgent.__init__-98"><a href="#AgnoPersonalAgent.__init__-98"><span class="linenos"> 98</span></a><span class="sd">            storage_dir: Directory for Agno storage files</span>
</span><span id="AgnoPersonalAgent.__init__-99"><a href="#AgnoPersonalAgent.__init__-99"><span class="linenos"> 99</span></a><span class="sd">            knowledge_dir: Directory containing knowledge files to load</span>
</span><span id="AgnoPersonalAgent.__init__-100"><a href="#AgnoPersonalAgent.__init__-100"><span class="linenos">100</span></a><span class="sd">            debug: Enable debug logging and tool call visibility</span>
</span><span id="AgnoPersonalAgent.__init__-101"><a href="#AgnoPersonalAgent.__init__-101"><span class="linenos">101</span></a><span class="sd">            ollama_base_url: Base URL for Ollama API</span>
</span><span id="AgnoPersonalAgent.__init__-102"><a href="#AgnoPersonalAgent.__init__-102"><span class="linenos">102</span></a><span class="sd">            user_id: User identifier for memory operations</span>
</span><span id="AgnoPersonalAgent.__init__-103"><a href="#AgnoPersonalAgent.__init__-103"><span class="linenos">103</span></a><span class="sd">            recreate: Whether to recreate knowledge bases</span>
</span><span id="AgnoPersonalAgent.__init__-104"><a href="#AgnoPersonalAgent.__init__-104"><span class="linenos">104</span></a><span class="sd">            instruction_level: The sophistication level for agent instructions</span>
</span><span id="AgnoPersonalAgent.__init__-105"><a href="#AgnoPersonalAgent.__init__-105"><span class="linenos">105</span></a><span class="sd">            seed: Optional seed for model reproducibility</span>
</span><span id="AgnoPersonalAgent.__init__-106"><a href="#AgnoPersonalAgent.__init__-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.__init__-107"><a href="#AgnoPersonalAgent.__init__-107"><span class="linenos">107</span></a>        <span class="c1"># Basic configuration</span>
</span><span id="AgnoPersonalAgent.__init__-108"><a href="#AgnoPersonalAgent.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span> <span class="o">=</span> <span class="n">model_provider</span>
</span><span id="AgnoPersonalAgent.__init__-109"><a href="#AgnoPersonalAgent.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="AgnoPersonalAgent.__init__-110"><a href="#AgnoPersonalAgent.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="o">=</span> <span class="n">enable_memory</span>
</span><span id="AgnoPersonalAgent.__init__-111"><a href="#AgnoPersonalAgent.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="o">=</span> <span class="n">enable_mcp</span> <span class="ow">and</span> <span class="n">USE_MCP</span>
</span><span id="AgnoPersonalAgent.__init__-112"><a href="#AgnoPersonalAgent.__init__-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="AgnoPersonalAgent.__init__-113"><a href="#AgnoPersonalAgent.__init__-113"><span class="linenos">113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ollama_base_url</span> <span class="o">=</span> <span class="n">ollama_base_url</span>
</span><span id="AgnoPersonalAgent.__init__-114"><a href="#AgnoPersonalAgent.__init__-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgnoPersonalAgent.__init__-115"><a href="#AgnoPersonalAgent.__init__-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">recreate</span> <span class="o">=</span> <span class="n">recreate</span>
</span><span id="AgnoPersonalAgent.__init__-116"><a href="#AgnoPersonalAgent.__init__-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instruction_level</span> <span class="o">=</span> <span class="n">instruction_level</span>
</span><span id="AgnoPersonalAgent.__init__-117"><a href="#AgnoPersonalAgent.__init__-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
</span><span id="AgnoPersonalAgent.__init__-118"><a href="#AgnoPersonalAgent.__init__-118"><span class="linenos">118</span></a>
</span><span id="AgnoPersonalAgent.__init__-119"><a href="#AgnoPersonalAgent.__init__-119"><span class="linenos">119</span></a>        <span class="c1"># Set up storage paths</span>
</span><span id="AgnoPersonalAgent.__init__-120"><a href="#AgnoPersonalAgent.__init__-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_storage_paths</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">knowledge_dir</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.__init__-121"><a href="#AgnoPersonalAgent.__init__-121"><span class="linenos">121</span></a>
</span><span id="AgnoPersonalAgent.__init__-122"><a href="#AgnoPersonalAgent.__init__-122"><span class="linenos">122</span></a>        <span class="c1"># MCP configuration</span>
</span><span id="AgnoPersonalAgent.__init__-123"><a href="#AgnoPersonalAgent.__init__-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span> <span class="o">=</span> <span class="n">get_mcp_servers</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="AgnoPersonalAgent.__init__-124"><a href="#AgnoPersonalAgent.__init__-124"><span class="linenos">124</span></a>
</span><span id="AgnoPersonalAgent.__init__-125"><a href="#AgnoPersonalAgent.__init__-125"><span class="linenos">125</span></a>        <span class="c1"># Initialize component managers</span>
</span><span id="AgnoPersonalAgent.__init__-126"><a href="#AgnoPersonalAgent.__init__-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span> <span class="n">AgentModelManager</span> <span class="o">=</span> <span class="n">AgentModelManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.__init__-127"><a href="#AgnoPersonalAgent.__init__-127"><span class="linenos">127</span></a>            <span class="n">model_provider</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">ollama_base_url</span><span class="p">,</span> <span class="n">seed</span>
</span><span id="AgnoPersonalAgent.__init__-128"><a href="#AgnoPersonalAgent.__init__-128"><span class="linenos">128</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.__init__-129"><a href="#AgnoPersonalAgent.__init__-129"><span class="linenos">129</span></a>
</span><span id="AgnoPersonalAgent.__init__-130"><a href="#AgnoPersonalAgent.__init__-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span><span class="p">:</span> <span class="n">AgentInstructionManager</span> <span class="o">=</span> <span class="n">AgentInstructionManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.__init__-131"><a href="#AgnoPersonalAgent.__init__-131"><span class="linenos">131</span></a>            <span class="n">instruction_level</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">enable_memory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span>
</span><span id="AgnoPersonalAgent.__init__-132"><a href="#AgnoPersonalAgent.__init__-132"><span class="linenos">132</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.__init__-133"><a href="#AgnoPersonalAgent.__init__-133"><span class="linenos">133</span></a>
</span><span id="AgnoPersonalAgent.__init__-134"><a href="#AgnoPersonalAgent.__init__-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="p">:</span> <span class="n">AgentMemoryManager</span> <span class="o">=</span> <span class="n">AgentMemoryManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.__init__-135"><a href="#AgnoPersonalAgent.__init__-135"><span class="linenos">135</span></a>            <span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-136"><a href="#AgnoPersonalAgent.__init__-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-137"><a href="#AgnoPersonalAgent.__init__-137"><span class="linenos">137</span></a>            <span class="kc">None</span><span class="p">,</span>  <span class="c1"># agno_memory will be set during initialization</span>
</span><span id="AgnoPersonalAgent.__init__-138"><a href="#AgnoPersonalAgent.__init__-138"><span class="linenos">138</span></a>            <span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-139"><a href="#AgnoPersonalAgent.__init__-139"><span class="linenos">139</span></a>            <span class="n">LIGHTRAG_MEMORY_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-140"><a href="#AgnoPersonalAgent.__init__-140"><span class="linenos">140</span></a>            <span class="n">enable_memory</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-141"><a href="#AgnoPersonalAgent.__init__-141"><span class="linenos">141</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.__init__-142"><a href="#AgnoPersonalAgent.__init__-142"><span class="linenos">142</span></a>
</span><span id="AgnoPersonalAgent.__init__-143"><a href="#AgnoPersonalAgent.__init__-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span><span class="p">:</span> <span class="n">AgentKnowledgeManager</span> <span class="o">=</span> <span class="n">AgentKnowledgeManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.__init__-144"><a href="#AgnoPersonalAgent.__init__-144"><span class="linenos">144</span></a>            <span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">LIGHTRAG_URL</span><span class="p">,</span> <span class="n">LIGHTRAG_MEMORY_URL</span>
</span><span id="AgnoPersonalAgent.__init__-145"><a href="#AgnoPersonalAgent.__init__-145"><span class="linenos">145</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.__init__-146"><a href="#AgnoPersonalAgent.__init__-146"><span class="linenos">146</span></a>
</span><span id="AgnoPersonalAgent.__init__-147"><a href="#AgnoPersonalAgent.__init__-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_manager</span><span class="p">:</span> <span class="n">AgentToolManager</span> <span class="o">=</span> <span class="n">AgentToolManager</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.__init__-148"><a href="#AgnoPersonalAgent.__init__-148"><span class="linenos">148</span></a>            <span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span>
</span><span id="AgnoPersonalAgent.__init__-149"><a href="#AgnoPersonalAgent.__init__-149"><span class="linenos">149</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.__init__-150"><a href="#AgnoPersonalAgent.__init__-150"><span class="linenos">150</span></a>
</span><span id="AgnoPersonalAgent.__init__-151"><a href="#AgnoPersonalAgent.__init__-151"><span class="linenos">151</span></a>        <span class="c1"># Storage components</span>
</span><span id="AgnoPersonalAgent.__init__-152"><a href="#AgnoPersonalAgent.__init__-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.__init__-153"><a href="#AgnoPersonalAgent.__init__-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.__init__-154"><a href="#AgnoPersonalAgent.__init__-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.__init__-155"><a href="#AgnoPersonalAgent.__init__-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AgnoPersonalAgent.__init__-156"><a href="#AgnoPersonalAgent.__init__-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.__init__-157"><a href="#AgnoPersonalAgent.__init__-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.__init__-158"><a href="#AgnoPersonalAgent.__init__-158"><span class="linenos">158</span></a>
</span><span id="AgnoPersonalAgent.__init__-159"><a href="#AgnoPersonalAgent.__init__-159"><span class="linenos">159</span></a>        <span class="c1"># Agent instance</span>
</span><span id="AgnoPersonalAgent.__init__-160"><a href="#AgnoPersonalAgent.__init__-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.__init__-161"><a href="#AgnoPersonalAgent.__init__-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.__init__-162"><a href="#AgnoPersonalAgent.__init__-162"><span class="linenos">162</span></a>
</span><span id="AgnoPersonalAgent.__init__-163"><a href="#AgnoPersonalAgent.__init__-163"><span class="linenos">163</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.__init__-164"><a href="#AgnoPersonalAgent.__init__-164"><span class="linenos">164</span></a>            <span class="s2">&quot;Initialized AgnoPersonalAgent with model=</span><span class="si">%s</span><span class="s2">, memory=</span><span class="si">%s</span><span class="s2">, mcp=</span><span class="si">%s</span><span class="s2">, user_id=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-165"><a href="#AgnoPersonalAgent.__init__-165"><span class="linenos">165</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_provider</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-166"><a href="#AgnoPersonalAgent.__init__-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-167"><a href="#AgnoPersonalAgent.__init__-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-168"><a href="#AgnoPersonalAgent.__init__-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.__init__-169"><a href="#AgnoPersonalAgent.__init__-169"><span class="linenos">169</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the Agno Personal Agent.</p>

<p>Args:
    model_provider: LLM provider ('ollama' or 'openai')
    model_name: Model name to use
    enable_memory: Whether to enable memory and knowledge features
    enable_mcp: Whether to enable MCP tool integration
    storage_dir: Directory for Agno storage files
    knowledge_dir: Directory containing knowledge files to load
    debug: Enable debug logging and tool call visibility
    ollama_base_url: Base URL for Ollama API
    user_id: User identifier for memory operations
    recreate: Whether to recreate knowledge bases
    instruction_level: The sophistication level for agent instructions
    seed: Optional seed for model reproducibility</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.model_provider" class="classattr">
                                <div class="attr variable">
            <span class="name">model_provider</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.model_provider"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.model_name" class="classattr">
                                <div class="attr variable">
            <span class="name">model_name</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.model_name"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.enable_memory" class="classattr">
                                <div class="attr variable">
            <span class="name">enable_memory</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.enable_memory"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.enable_mcp" class="classattr">
                                <div class="attr variable">
            <span class="name">enable_mcp</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.enable_mcp"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.debug" class="classattr">
                                <div class="attr variable">
            <span class="name">debug</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.debug"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.ollama_base_url" class="classattr">
                                <div class="attr variable">
            <span class="name">ollama_base_url</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.ollama_base_url"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.user_id" class="classattr">
                                <div class="attr variable">
            <span class="name">user_id</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.user_id"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.recreate" class="classattr">
                                <div class="attr variable">
            <span class="name">recreate</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.recreate"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.instruction_level" class="classattr">
                                <div class="attr variable">
            <span class="name">instruction_level</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.instruction_level"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.seed" class="classattr">
                                <div class="attr variable">
            <span class="name">seed</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.seed"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.mcp_servers" class="classattr">
                                <div class="attr variable">
            <span class="name">mcp_servers</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.mcp_servers"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.model_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">model_manager</span><span class="annotation">: <a href="#AgentModelManager">AgentModelManager</a></span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.model_manager"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.instruction_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">instruction_manager</span><span class="annotation">: <a href="#AgentInstructionManager">AgentInstructionManager</a></span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.instruction_manager"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.memory_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">memory_manager</span><span class="annotation">: <a href="#AgentMemoryManager">AgentMemoryManager</a></span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.memory_manager"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.knowledge_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">knowledge_manager</span><span class="annotation">: <a href="#AgentKnowledgeManager">AgentKnowledgeManager</a></span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.knowledge_manager"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.tool_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">tool_manager</span><span class="annotation">: <a href="#AgentToolManager">AgentToolManager</a></span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.tool_manager"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.agno_storage" class="classattr">
                                <div class="attr variable">
            <span class="name">agno_storage</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.agno_storage"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.agno_knowledge" class="classattr">
                                <div class="attr variable">
            <span class="name">agno_knowledge</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.agno_knowledge"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.lightrag_knowledge" class="classattr">
                                <div class="attr variable">
            <span class="name">lightrag_knowledge</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.lightrag_knowledge"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.lightrag_knowledge_enabled" class="classattr">
                                <div class="attr variable">
            <span class="name">lightrag_knowledge_enabled</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.lightrag_knowledge_enabled"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.agno_memory" class="classattr">
                                <div class="attr variable">
            <span class="name">agno_memory</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.agno_memory"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.knowledge_coordinator" class="classattr">
                                <div class="attr variable">
            <span class="name">knowledge_coordinator</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.knowledge_coordinator"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.agent" class="classattr">
                                <div class="attr variable">
            <span class="name">agent</span>

        
    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.agent"></a>
    
    

                            </div>
                            <div id="AgnoPersonalAgent.initialize" class="classattr">
                                        <input id="AgnoPersonalAgent.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.initialize-194"><a href="#AgnoPersonalAgent.initialize-194"><span class="linenos">194</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-195"><a href="#AgnoPersonalAgent.initialize-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the agno agent with all components.</span>
</span><span id="AgnoPersonalAgent.initialize-196"><a href="#AgnoPersonalAgent.initialize-196"><span class="linenos">196</span></a>
</span><span id="AgnoPersonalAgent.initialize-197"><a href="#AgnoPersonalAgent.initialize-197"><span class="linenos">197</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent.initialize-198"><a href="#AgnoPersonalAgent.initialize-198"><span class="linenos">198</span></a><span class="sd">            recreate: Whether to recreate the agent knowledge bases</span>
</span><span id="AgnoPersonalAgent.initialize-199"><a href="#AgnoPersonalAgent.initialize-199"><span class="linenos">199</span></a>
</span><span id="AgnoPersonalAgent.initialize-200"><a href="#AgnoPersonalAgent.initialize-200"><span class="linenos">200</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent.initialize-201"><a href="#AgnoPersonalAgent.initialize-201"><span class="linenos">201</span></a><span class="sd">            True if initialization successful, False otherwise</span>
</span><span id="AgnoPersonalAgent.initialize-202"><a href="#AgnoPersonalAgent.initialize-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-203"><a href="#AgnoPersonalAgent.initialize-203"><span class="linenos">203</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-204"><a href="#AgnoPersonalAgent.initialize-204"><span class="linenos">204</span></a>            <span class="s2">&quot;🚀 AgnoPersonalAgent.initialize() called with recreate=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">recreate</span>
</span><span id="AgnoPersonalAgent.initialize-205"><a href="#AgnoPersonalAgent.initialize-205"><span class="linenos">205</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-206"><a href="#AgnoPersonalAgent.initialize-206"><span class="linenos">206</span></a>
</span><span id="AgnoPersonalAgent.initialize-207"><a href="#AgnoPersonalAgent.initialize-207"><span class="linenos">207</span></a>        <span class="c1"># CRITICAL: Synchronize the agent&#39;s user_id with the persistent user setting</span>
</span><span id="AgnoPersonalAgent.initialize-208"><a href="#AgnoPersonalAgent.initialize-208"><span class="linenos">208</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-209"><a href="#AgnoPersonalAgent.initialize-209"><span class="linenos">209</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">..config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_current_user_id</span>
</span><span id="AgnoPersonalAgent.initialize-210"><a href="#AgnoPersonalAgent.initialize-210"><span class="linenos">210</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.user_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserManager</span>
</span><span id="AgnoPersonalAgent.initialize-211"><a href="#AgnoPersonalAgent.initialize-211"><span class="linenos">211</span></a>
</span><span id="AgnoPersonalAgent.initialize-212"><a href="#AgnoPersonalAgent.initialize-212"><span class="linenos">212</span></a>            <span class="n">user_manager</span> <span class="o">=</span> <span class="n">UserManager</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-213"><a href="#AgnoPersonalAgent.initialize-213"><span class="linenos">213</span></a>            <span class="n">persistent_user_id</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-214"><a href="#AgnoPersonalAgent.initialize-214"><span class="linenos">214</span></a>                <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-215"><a href="#AgnoPersonalAgent.initialize-215"><span class="linenos">215</span></a>            <span class="p">)</span>  <span class="c1"># This is loaded from env.userid at startup</span>
</span><span id="AgnoPersonalAgent.initialize-216"><a href="#AgnoPersonalAgent.initialize-216"><span class="linenos">216</span></a>
</span><span id="AgnoPersonalAgent.initialize-217"><a href="#AgnoPersonalAgent.initialize-217"><span class="linenos">217</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">!=</span> <span class="n">persistent_user_id</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-218"><a href="#AgnoPersonalAgent.initialize-218"><span class="linenos">218</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-219"><a href="#AgnoPersonalAgent.initialize-219"><span class="linenos">219</span></a>                    <span class="s2">&quot;Agent initialized with user &#39;</span><span class="si">%s</span><span class="s2">&#39;, but persistent user is &#39;</span><span class="si">%s</span><span class="s2">&#39;. Switching context...&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-220"><a href="#AgnoPersonalAgent.initialize-220"><span class="linenos">220</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-221"><a href="#AgnoPersonalAgent.initialize-221"><span class="linenos">221</span></a>                    <span class="n">persistent_user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-222"><a href="#AgnoPersonalAgent.initialize-222"><span class="linenos">222</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-223"><a href="#AgnoPersonalAgent.initialize-223"><span class="linenos">223</span></a>                <span class="c1"># This is a formal user switch. Update the persistent user file.</span>
</span><span id="AgnoPersonalAgent.initialize-224"><a href="#AgnoPersonalAgent.initialize-224"><span class="linenos">224</span></a>                <span class="n">switch_result</span> <span class="o">=</span> <span class="n">user_manager</span><span class="o">.</span><span class="n">switch_user</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-225"><a href="#AgnoPersonalAgent.initialize-225"><span class="linenos">225</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">restart_lightrag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">update_global_config</span><span class="o">=</span><span class="kc">True</span>
</span><span id="AgnoPersonalAgent.initialize-226"><a href="#AgnoPersonalAgent.initialize-226"><span class="linenos">226</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-227"><a href="#AgnoPersonalAgent.initialize-227"><span class="linenos">227</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">switch_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-228"><a href="#AgnoPersonalAgent.initialize-228"><span class="linenos">228</span></a>                    <span class="s2">&quot;success&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-229"><a href="#AgnoPersonalAgent.initialize-229"><span class="linenos">229</span></a>                <span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;Already logged in&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">switch_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="AgnoPersonalAgent.initialize-230"><a href="#AgnoPersonalAgent.initialize-230"><span class="linenos">230</span></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-231"><a href="#AgnoPersonalAgent.initialize-231"><span class="linenos">231</span></a>                        <span class="sa">f</span><span class="s2">&quot;Failed to switch user context to &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">switch_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-232"><a href="#AgnoPersonalAgent.initialize-232"><span class="linenos">232</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-233"><a href="#AgnoPersonalAgent.initialize-233"><span class="linenos">233</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-234"><a href="#AgnoPersonalAgent.initialize-234"><span class="linenos">234</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-235"><a href="#AgnoPersonalAgent.initialize-235"><span class="linenos">235</span></a>                        <span class="s2">&quot;Successfully switched user context to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgnoPersonalAgent.initialize-236"><a href="#AgnoPersonalAgent.initialize-236"><span class="linenos">236</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-237"><a href="#AgnoPersonalAgent.initialize-237"><span class="linenos">237</span></a>
</span><span id="AgnoPersonalAgent.initialize-238"><a href="#AgnoPersonalAgent.initialize-238"><span class="linenos">238</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-239"><a href="#AgnoPersonalAgent.initialize-239"><span class="linenos">239</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;🚨 Critical error during user context synchronization: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-240"><a href="#AgnoPersonalAgent.initialize-240"><span class="linenos">240</span></a>            <span class="c1"># This is a critical step, so we raise an exception if it fails.</span>
</span><span id="AgnoPersonalAgent.initialize-241"><a href="#AgnoPersonalAgent.initialize-241"><span class="linenos">241</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User context synchronization failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="AgnoPersonalAgent.initialize-242"><a href="#AgnoPersonalAgent.initialize-242"><span class="linenos">242</span></a>
</span><span id="AgnoPersonalAgent.initialize-243"><a href="#AgnoPersonalAgent.initialize-243"><span class="linenos">243</span></a>        <span class="c1"># CRITICAL: Ensure user is registered in the user registry</span>
</span><span id="AgnoPersonalAgent.initialize-244"><a href="#AgnoPersonalAgent.initialize-244"><span class="linenos">244</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;📝 Ensuring user </span><span class="si">%s</span><span class="s2"> is registered in user registry&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-245"><a href="#AgnoPersonalAgent.initialize-245"><span class="linenos">245</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-246"><a href="#AgnoPersonalAgent.initialize-246"><span class="linenos">246</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.user_registry</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRegistry</span>
</span><span id="AgnoPersonalAgent.initialize-247"><a href="#AgnoPersonalAgent.initialize-247"><span class="linenos">247</span></a>
</span><span id="AgnoPersonalAgent.initialize-248"><a href="#AgnoPersonalAgent.initialize-248"><span class="linenos">248</span></a>            <span class="n">user_registry</span> <span class="o">=</span> <span class="n">UserRegistry</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-249"><a href="#AgnoPersonalAgent.initialize-249"><span class="linenos">249</span></a>            <span class="n">user_registry</span><span class="o">.</span><span class="n">ensure_current_user_registered</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-250"><a href="#AgnoPersonalAgent.initialize-250"><span class="linenos">250</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;✅ User registration check completed&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-251"><a href="#AgnoPersonalAgent.initialize-251"><span class="linenos">251</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-252"><a href="#AgnoPersonalAgent.initialize-252"><span class="linenos">252</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;⚠️ User registry check failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-253"><a href="#AgnoPersonalAgent.initialize-253"><span class="linenos">253</span></a>            <span class="c1"># Don&#39;t fail initialization for user registry issues</span>
</span><span id="AgnoPersonalAgent.initialize-254"><a href="#AgnoPersonalAgent.initialize-254"><span class="linenos">254</span></a>
</span><span id="AgnoPersonalAgent.initialize-255"><a href="#AgnoPersonalAgent.initialize-255"><span class="linenos">255</span></a>        <span class="c1"># CRITICAL: Ensure Docker USER_ID consistency with smart restart capability</span>
</span><span id="AgnoPersonalAgent.initialize-256"><a href="#AgnoPersonalAgent.initialize-256"><span class="linenos">256</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;🔍 Checking Docker USER_ID consistency for user: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-257"><a href="#AgnoPersonalAgent.initialize-257"><span class="linenos">257</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-258"><a href="#AgnoPersonalAgent.initialize-258"><span class="linenos">258</span></a>            <span class="n">ready_to_proceed</span><span class="p">,</span> <span class="n">consistency_message</span> <span class="o">=</span> <span class="n">ensure_docker_user_consistency</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-259"><a href="#AgnoPersonalAgent.initialize-259"><span class="linenos">259</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">auto_fix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Only restart if actually needed</span>
</span><span id="AgnoPersonalAgent.initialize-260"><a href="#AgnoPersonalAgent.initialize-260"><span class="linenos">260</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-261"><a href="#AgnoPersonalAgent.initialize-261"><span class="linenos">261</span></a>
</span><span id="AgnoPersonalAgent.initialize-262"><a href="#AgnoPersonalAgent.initialize-262"><span class="linenos">262</span></a>            <span class="k">if</span> <span class="n">ready_to_proceed</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-263"><a href="#AgnoPersonalAgent.initialize-263"><span class="linenos">263</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-264"><a href="#AgnoPersonalAgent.initialize-264"><span class="linenos">264</span></a>                    <span class="s2">&quot;✅ Docker consistency check passed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">consistency_message</span>
</span><span id="AgnoPersonalAgent.initialize-265"><a href="#AgnoPersonalAgent.initialize-265"><span class="linenos">265</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-266"><a href="#AgnoPersonalAgent.initialize-266"><span class="linenos">266</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-267"><a href="#AgnoPersonalAgent.initialize-267"><span class="linenos">267</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-268"><a href="#AgnoPersonalAgent.initialize-268"><span class="linenos">268</span></a>                    <span class="s2">&quot;❌ Docker consistency check failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">consistency_message</span>
</span><span id="AgnoPersonalAgent.initialize-269"><a href="#AgnoPersonalAgent.initialize-269"><span class="linenos">269</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-270"><a href="#AgnoPersonalAgent.initialize-270"><span class="linenos">270</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-271"><a href="#AgnoPersonalAgent.initialize-271"><span class="linenos">271</span></a>                    <span class="sa">f</span><span class="s2">&quot;Docker USER_ID consistency check failed: </span><span class="si">{</span><span class="n">consistency_message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-272"><a href="#AgnoPersonalAgent.initialize-272"><span class="linenos">272</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-273"><a href="#AgnoPersonalAgent.initialize-273"><span class="linenos">273</span></a>
</span><span id="AgnoPersonalAgent.initialize-274"><a href="#AgnoPersonalAgent.initialize-274"><span class="linenos">274</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-275"><a href="#AgnoPersonalAgent.initialize-275"><span class="linenos">275</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;🚨 Critical error during Docker consistency check: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-276"><a href="#AgnoPersonalAgent.initialize-276"><span class="linenos">276</span></a>            <span class="c1"># Don&#39;t fail initialization for Docker consistency issues in case Docker is not available</span>
</span><span id="AgnoPersonalAgent.initialize-277"><a href="#AgnoPersonalAgent.initialize-277"><span class="linenos">277</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-278"><a href="#AgnoPersonalAgent.initialize-278"><span class="linenos">278</span></a>                <span class="s2">&quot;⚠️ Continuing initialization despite Docker consistency check failure&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-279"><a href="#AgnoPersonalAgent.initialize-279"><span class="linenos">279</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-280"><a href="#AgnoPersonalAgent.initialize-280"><span class="linenos">280</span></a>
</span><span id="AgnoPersonalAgent.initialize-281"><a href="#AgnoPersonalAgent.initialize-281"><span class="linenos">281</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-282"><a href="#AgnoPersonalAgent.initialize-282"><span class="linenos">282</span></a>            <span class="c1"># Create model using the model manager</span>
</span><span id="AgnoPersonalAgent.initialize-283"><a href="#AgnoPersonalAgent.initialize-283"><span class="linenos">283</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-284"><a href="#AgnoPersonalAgent.initialize-284"><span class="linenos">284</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created model: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-285"><a href="#AgnoPersonalAgent.initialize-285"><span class="linenos">285</span></a>
</span><span id="AgnoPersonalAgent.initialize-286"><a href="#AgnoPersonalAgent.initialize-286"><span class="linenos">286</span></a>            <span class="c1"># Prepare tools list</span>
</span><span id="AgnoPersonalAgent.initialize-287"><a href="#AgnoPersonalAgent.initialize-287"><span class="linenos">287</span></a>            <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgnoPersonalAgent.initialize-288"><a href="#AgnoPersonalAgent.initialize-288"><span class="linenos">288</span></a>                <span class="c1"># Add GoogleSearch tools directly for web search functionality</span>
</span><span id="AgnoPersonalAgent.initialize-289"><a href="#AgnoPersonalAgent.initialize-289"><span class="linenos">289</span></a>                <span class="n">GoogleSearchTools</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent.initialize-290"><a href="#AgnoPersonalAgent.initialize-290"><span class="linenos">290</span></a>                <span class="n">YFinanceTools</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-291"><a href="#AgnoPersonalAgent.initialize-291"><span class="linenos">291</span></a>                    <span class="n">stock_price</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-292"><a href="#AgnoPersonalAgent.initialize-292"><span class="linenos">292</span></a>                    <span class="n">company_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-293"><a href="#AgnoPersonalAgent.initialize-293"><span class="linenos">293</span></a>                    <span class="n">stock_fundamentals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-294"><a href="#AgnoPersonalAgent.initialize-294"><span class="linenos">294</span></a>                    <span class="n">key_financial_ratios</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-295"><a href="#AgnoPersonalAgent.initialize-295"><span class="linenos">295</span></a>                    <span class="n">analyst_recommendations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-296"><a href="#AgnoPersonalAgent.initialize-296"><span class="linenos">296</span></a>                <span class="p">),</span>
</span><span id="AgnoPersonalAgent.initialize-297"><a href="#AgnoPersonalAgent.initialize-297"><span class="linenos">297</span></a>                <span class="n">PythonTools</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent.initialize-298"><a href="#AgnoPersonalAgent.initialize-298"><span class="linenos">298</span></a>                <span class="n">ShellTools</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-299"><a href="#AgnoPersonalAgent.initialize-299"><span class="linenos">299</span></a>                    <span class="n">base_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-300"><a href="#AgnoPersonalAgent.initialize-300"><span class="linenos">300</span></a>                <span class="p">),</span>  <span class="c1"># Match Streamlit configuration for consistency</span>
</span><span id="AgnoPersonalAgent.initialize-301"><a href="#AgnoPersonalAgent.initialize-301"><span class="linenos">301</span></a>                <span class="n">PersonalAgentFilesystemTools</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent.initialize-302"><a href="#AgnoPersonalAgent.initialize-302"><span class="linenos">302</span></a>                <span class="c1"># Removed PersonalAgentWebTools as it was causing confusion with MCP references</span>
</span><span id="AgnoPersonalAgent.initialize-303"><a href="#AgnoPersonalAgent.initialize-303"><span class="linenos">303</span></a>            <span class="p">]</span>
</span><span id="AgnoPersonalAgent.initialize-304"><a href="#AgnoPersonalAgent.initialize-304"><span class="linenos">304</span></a>
</span><span id="AgnoPersonalAgent.initialize-305"><a href="#AgnoPersonalAgent.initialize-305"><span class="linenos">305</span></a>            <span class="c1"># Initialize Agno native storage and knowledge following the working example pattern</span>
</span><span id="AgnoPersonalAgent.initialize-306"><a href="#AgnoPersonalAgent.initialize-306"><span class="linenos">306</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-307"><a href="#AgnoPersonalAgent.initialize-307"><span class="linenos">307</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="o">=</span> <span class="n">create_agno_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-308"><a href="#AgnoPersonalAgent.initialize-308"><span class="linenos">308</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created Agno storage at: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-309"><a href="#AgnoPersonalAgent.initialize-309"><span class="linenos">309</span></a>
</span><span id="AgnoPersonalAgent.initialize-310"><a href="#AgnoPersonalAgent.initialize-310"><span class="linenos">310</span></a>                <span class="c1"># Create knowledge base (sync creation)</span>
</span><span id="AgnoPersonalAgent.initialize-311"><a href="#AgnoPersonalAgent.initialize-311"><span class="linenos">311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="n">create_combined_knowledge_base</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-312"><a href="#AgnoPersonalAgent.initialize-312"><span class="linenos">312</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span>
</span><span id="AgnoPersonalAgent.initialize-313"><a href="#AgnoPersonalAgent.initialize-313"><span class="linenos">313</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-314"><a href="#AgnoPersonalAgent.initialize-314"><span class="linenos">314</span></a>
</span><span id="AgnoPersonalAgent.initialize-315"><a href="#AgnoPersonalAgent.initialize-315"><span class="linenos">315</span></a>                <span class="c1"># Load knowledge base content (async loading) - matches working example</span>
</span><span id="AgnoPersonalAgent.initialize-316"><a href="#AgnoPersonalAgent.initialize-316"><span class="linenos">316</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-317"><a href="#AgnoPersonalAgent.initialize-317"><span class="linenos">317</span></a>                    <span class="k">await</span> <span class="n">load_combined_knowledge_base</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-318"><a href="#AgnoPersonalAgent.initialize-318"><span class="linenos">318</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="n">recreate</span>
</span><span id="AgnoPersonalAgent.initialize-319"><a href="#AgnoPersonalAgent.initialize-319"><span class="linenos">319</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-320"><a href="#AgnoPersonalAgent.initialize-320"><span class="linenos">320</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loaded Agno combined knowledge base content&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-321"><a href="#AgnoPersonalAgent.initialize-321"><span class="linenos">321</span></a>
</span><span id="AgnoPersonalAgent.initialize-322"><a href="#AgnoPersonalAgent.initialize-322"><span class="linenos">322</span></a>                <span class="c1"># Create memory with SemanticMemoryManager (debug mode passed through)</span>
</span><span id="AgnoPersonalAgent.initialize-323"><a href="#AgnoPersonalAgent.initialize-323"><span class="linenos">323</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="n">create_agno_memory</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-324"><a href="#AgnoPersonalAgent.initialize-324"><span class="linenos">324</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
</span><span id="AgnoPersonalAgent.initialize-325"><a href="#AgnoPersonalAgent.initialize-325"><span class="linenos">325</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-326"><a href="#AgnoPersonalAgent.initialize-326"><span class="linenos">326</span></a>
</span><span id="AgnoPersonalAgent.initialize-327"><a href="#AgnoPersonalAgent.initialize-327"><span class="linenos">327</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-328"><a href="#AgnoPersonalAgent.initialize-328"><span class="linenos">328</span></a>                    <span class="c1"># Initialize the memory manager with the created agno_memory</span>
</span><span id="AgnoPersonalAgent.initialize-329"><a href="#AgnoPersonalAgent.initialize-329"><span class="linenos">329</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-330"><a href="#AgnoPersonalAgent.initialize-330"><span class="linenos">330</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-331"><a href="#AgnoPersonalAgent.initialize-331"><span class="linenos">331</span></a>                        <span class="s2">&quot;Created Agno memory with SemanticMemoryManager at: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-332"><a href="#AgnoPersonalAgent.initialize-332"><span class="linenos">332</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-333"><a href="#AgnoPersonalAgent.initialize-333"><span class="linenos">333</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-334"><a href="#AgnoPersonalAgent.initialize-334"><span class="linenos">334</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-335"><a href="#AgnoPersonalAgent.initialize-335"><span class="linenos">335</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to create memory system&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-336"><a href="#AgnoPersonalAgent.initialize-336"><span class="linenos">336</span></a>
</span><span id="AgnoPersonalAgent.initialize-337"><a href="#AgnoPersonalAgent.initialize-337"><span class="linenos">337</span></a>                <span class="c1"># Add Lightrag knowledge if enabled</span>
</span><span id="AgnoPersonalAgent.initialize-338"><a href="#AgnoPersonalAgent.initialize-338"><span class="linenos">338</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-339"><a href="#AgnoPersonalAgent.initialize-339"><span class="linenos">339</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-340"><a href="#AgnoPersonalAgent.initialize-340"><span class="linenos">340</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_lightrag_knowledge_base</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-341"><a href="#AgnoPersonalAgent.initialize-341"><span class="linenos">341</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge_enabled</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-342"><a href="#AgnoPersonalAgent.initialize-342"><span class="linenos">342</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.initialize-343"><a href="#AgnoPersonalAgent.initialize-343"><span class="linenos">343</span></a>                        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-344"><a href="#AgnoPersonalAgent.initialize-344"><span class="linenos">344</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loaded Lightrag knowledge base metadata&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-345"><a href="#AgnoPersonalAgent.initialize-345"><span class="linenos">345</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-346"><a href="#AgnoPersonalAgent.initialize-346"><span class="linenos">346</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to load Lightrag knowledge base: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-347"><a href="#AgnoPersonalAgent.initialize-347"><span class="linenos">347</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.initialize-348"><a href="#AgnoPersonalAgent.initialize-348"><span class="linenos">348</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AgnoPersonalAgent.initialize-349"><a href="#AgnoPersonalAgent.initialize-349"><span class="linenos">349</span></a>
</span><span id="AgnoPersonalAgent.initialize-350"><a href="#AgnoPersonalAgent.initialize-350"><span class="linenos">350</span></a>                <span class="c1"># Create Knowledge Coordinator</span>
</span><span id="AgnoPersonalAgent.initialize-351"><a href="#AgnoPersonalAgent.initialize-351"><span class="linenos">351</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="n">create_knowledge_coordinator</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-352"><a href="#AgnoPersonalAgent.initialize-352"><span class="linenos">352</span></a>                    <span class="n">agno_knowledge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-353"><a href="#AgnoPersonalAgent.initialize-353"><span class="linenos">353</span></a>                    <span class="n">lightrag_url</span><span class="o">=</span><span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-354"><a href="#AgnoPersonalAgent.initialize-354"><span class="linenos">354</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-355"><a href="#AgnoPersonalAgent.initialize-355"><span class="linenos">355</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-356"><a href="#AgnoPersonalAgent.initialize-356"><span class="linenos">356</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-357"><a href="#AgnoPersonalAgent.initialize-357"><span class="linenos">357</span></a>                    <span class="s2">&quot;Created Knowledge Coordinator for unified knowledge queries&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-358"><a href="#AgnoPersonalAgent.initialize-358"><span class="linenos">358</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-359"><a href="#AgnoPersonalAgent.initialize-359"><span class="linenos">359</span></a>
</span><span id="AgnoPersonalAgent.initialize-360"><a href="#AgnoPersonalAgent.initialize-360"><span class="linenos">360</span></a>                <span class="c1"># If recreate is True, clear all memories AFTER memory system is initialized</span>
</span><span id="AgnoPersonalAgent.initialize-361"><a href="#AgnoPersonalAgent.initialize-361"><span class="linenos">361</span></a>                <span class="k">if</span> <span class="n">recreate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-362"><a href="#AgnoPersonalAgent.initialize-362"><span class="linenos">362</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-363"><a href="#AgnoPersonalAgent.initialize-363"><span class="linenos">363</span></a>                        <span class="s2">&quot;Recreate flag is True, clearing all memories after memory system initialization&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-364"><a href="#AgnoPersonalAgent.initialize-364"><span class="linenos">364</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-365"><a href="#AgnoPersonalAgent.initialize-365"><span class="linenos">365</span></a>                    <span class="n">clear_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">clear_all_memories</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-366"><a href="#AgnoPersonalAgent.initialize-366"><span class="linenos">366</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Memory clear result: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">clear_result</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-367"><a href="#AgnoPersonalAgent.initialize-367"><span class="linenos">367</span></a>
</span><span id="AgnoPersonalAgent.initialize-368"><a href="#AgnoPersonalAgent.initialize-368"><span class="linenos">368</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialized Agno storage and knowledge backend&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-369"><a href="#AgnoPersonalAgent.initialize-369"><span class="linenos">369</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-370"><a href="#AgnoPersonalAgent.initialize-370"><span class="linenos">370</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-371"><a href="#AgnoPersonalAgent.initialize-371"><span class="linenos">371</span></a>                    <span class="s2">&quot;Memory disabled, skipping storage and knowledge initialization&quot;</span>
</span><span id="AgnoPersonalAgent.initialize-372"><a href="#AgnoPersonalAgent.initialize-372"><span class="linenos">372</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-373"><a href="#AgnoPersonalAgent.initialize-373"><span class="linenos">373</span></a>
</span><span id="AgnoPersonalAgent.initialize-374"><a href="#AgnoPersonalAgent.initialize-374"><span class="linenos">374</span></a>            <span class="c1"># Get MCP tools as function wrappers (no pre-initialization)</span>
</span><span id="AgnoPersonalAgent.initialize-375"><a href="#AgnoPersonalAgent.initialize-375"><span class="linenos">375</span></a>            <span class="n">mcp_tool_functions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent.initialize-376"><a href="#AgnoPersonalAgent.initialize-376"><span class="linenos">376</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-377"><a href="#AgnoPersonalAgent.initialize-377"><span class="linenos">377</span></a>                <span class="n">mcp_tool_functions</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mcp_tools</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-378"><a href="#AgnoPersonalAgent.initialize-378"><span class="linenos">378</span></a>                <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mcp_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-379"><a href="#AgnoPersonalAgent.initialize-379"><span class="linenos">379</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Added </span><span class="si">%d</span><span class="s2"> MCP tools to agent&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tool_functions</span><span class="p">))</span>
</span><span id="AgnoPersonalAgent.initialize-380"><a href="#AgnoPersonalAgent.initialize-380"><span class="linenos">380</span></a>
</span><span id="AgnoPersonalAgent.initialize-381"><a href="#AgnoPersonalAgent.initialize-381"><span class="linenos">381</span></a>            <span class="c1"># Get memory tools from the memory manager</span>
</span><span id="AgnoPersonalAgent.initialize-382"><a href="#AgnoPersonalAgent.initialize-382"><span class="linenos">382</span></a>            <span class="n">memory_tool_functions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent.initialize-383"><a href="#AgnoPersonalAgent.initialize-383"><span class="linenos">383</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-384"><a href="#AgnoPersonalAgent.initialize-384"><span class="linenos">384</span></a>                <span class="n">memory_tool_functions</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_memory_tools</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-385"><a href="#AgnoPersonalAgent.initialize-385"><span class="linenos">385</span></a>                <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">memory_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-386"><a href="#AgnoPersonalAgent.initialize-386"><span class="linenos">386</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-387"><a href="#AgnoPersonalAgent.initialize-387"><span class="linenos">387</span></a>                    <span class="s2">&quot;Added </span><span class="si">%d</span><span class="s2"> memory tools to agent&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-388"><a href="#AgnoPersonalAgent.initialize-388"><span class="linenos">388</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-389"><a href="#AgnoPersonalAgent.initialize-389"><span class="linenos">389</span></a>
</span><span id="AgnoPersonalAgent.initialize-390"><a href="#AgnoPersonalAgent.initialize-390"><span class="linenos">390</span></a>            <span class="c1"># Create the agno agent with direct parameter passing for visibility</span>
</span><span id="AgnoPersonalAgent.initialize-391"><a href="#AgnoPersonalAgent.initialize-391"><span class="linenos">391</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-392"><a href="#AgnoPersonalAgent.initialize-392"><span class="linenos">392</span></a>                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-393"><a href="#AgnoPersonalAgent.initialize-393"><span class="linenos">393</span></a>                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-394"><a href="#AgnoPersonalAgent.initialize-394"><span class="linenos">394</span></a>                <span class="n">instructions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span><span class="o">.</span><span class="n">create_instructions</span><span class="p">(),</span>
</span><span id="AgnoPersonalAgent.initialize-395"><a href="#AgnoPersonalAgent.initialize-395"><span class="linenos">395</span></a>                <span class="n">markdown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-396"><a href="#AgnoPersonalAgent.initialize-396"><span class="linenos">396</span></a>                <span class="n">show_tool_calls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-397"><a href="#AgnoPersonalAgent.initialize-397"><span class="linenos">397</span></a>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Personal AI Agent&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-398"><a href="#AgnoPersonalAgent.initialize-398"><span class="linenos">398</span></a>                <span class="n">agent_id</span><span class="o">=</span><span class="s2">&quot;personal_agent&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-399"><a href="#AgnoPersonalAgent.initialize-399"><span class="linenos">399</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-400"><a href="#AgnoPersonalAgent.initialize-400"><span class="linenos">400</span></a>                <span class="n">enable_agentic_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Disable agno&#39;s native memory to use our custom memory system</span>
</span><span id="AgnoPersonalAgent.initialize-401"><a href="#AgnoPersonalAgent.initialize-401"><span class="linenos">401</span></a>                <span class="n">enable_user_memories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Re-enable agno&#39;s native memory to allow user retrieval</span>
</span><span id="AgnoPersonalAgent.initialize-402"><a href="#AgnoPersonalAgent.initialize-402"><span class="linenos">402</span></a>                <span class="n">add_history_to_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Add conversation history to context</span>
</span><span id="AgnoPersonalAgent.initialize-403"><a href="#AgnoPersonalAgent.initialize-403"><span class="linenos">403</span></a>                <span class="n">num_history_responses</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-404"><a href="#AgnoPersonalAgent.initialize-404"><span class="linenos">404</span></a>                <span class="n">knowledge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-405"><a href="#AgnoPersonalAgent.initialize-405"><span class="linenos">405</span></a>                <span class="n">search_knowledge</span><span class="o">=</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-406"><a href="#AgnoPersonalAgent.initialize-406"><span class="linenos">406</span></a>                    <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="AgnoPersonalAgent.initialize-407"><a href="#AgnoPersonalAgent.initialize-407"><span class="linenos">407</span></a>                <span class="p">),</span>  <span class="c1"># Enable automatic knowledge search</span>
</span><span id="AgnoPersonalAgent.initialize-408"><a href="#AgnoPersonalAgent.initialize-408"><span class="linenos">408</span></a>                <span class="n">storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-409"><a href="#AgnoPersonalAgent.initialize-409"><span class="linenos">409</span></a>                <span class="n">memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Pass our custom memory system to prevent &quot;MemoryDb not provided&quot; warnings</span>
</span><span id="AgnoPersonalAgent.initialize-410"><a href="#AgnoPersonalAgent.initialize-410"><span class="linenos">410</span></a>                <span class="c1"># Enable telemetry and verbose logging</span>
</span><span id="AgnoPersonalAgent.initialize-411"><a href="#AgnoPersonalAgent.initialize-411"><span class="linenos">411</span></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-412"><a href="#AgnoPersonalAgent.initialize-412"><span class="linenos">412</span></a>                <span class="c1"># Enable streaming for intermediate steps</span>
</span><span id="AgnoPersonalAgent.initialize-413"><a href="#AgnoPersonalAgent.initialize-413"><span class="linenos">413</span></a>                <span class="n">stream_intermediate_steps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Required for aprint_response to work correctly</span>
</span><span id="AgnoPersonalAgent.initialize-414"><a href="#AgnoPersonalAgent.initialize-414"><span class="linenos">414</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-415"><a href="#AgnoPersonalAgent.initialize-415"><span class="linenos">415</span></a>
</span><span id="AgnoPersonalAgent.initialize-416"><a href="#AgnoPersonalAgent.initialize-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-417"><a href="#AgnoPersonalAgent.initialize-417"><span class="linenos">417</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Agent configured with knowledge base search&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-418"><a href="#AgnoPersonalAgent.initialize-418"><span class="linenos">418</span></a>
</span><span id="AgnoPersonalAgent.initialize-419"><a href="#AgnoPersonalAgent.initialize-419"><span class="linenos">419</span></a>            <span class="c1"># Calculate tool counts for logging using already-created tool lists</span>
</span><span id="AgnoPersonalAgent.initialize-420"><a href="#AgnoPersonalAgent.initialize-420"><span class="linenos">420</span></a>            <span class="n">mcp_tool_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-421"><a href="#AgnoPersonalAgent.initialize-421"><span class="linenos">421</span></a>            <span class="n">memory_tool_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_tool_functions</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-422"><a href="#AgnoPersonalAgent.initialize-422"><span class="linenos">422</span></a>
</span><span id="AgnoPersonalAgent.initialize-423"><a href="#AgnoPersonalAgent.initialize-423"><span class="linenos">423</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.initialize-424"><a href="#AgnoPersonalAgent.initialize-424"><span class="linenos">424</span></a>                <span class="s2">&quot;Successfully initialized agno agent with native storage: </span><span class="si">%d</span><span class="s2"> total tools (</span><span class="si">%d</span><span class="s2"> MCP, </span><span class="si">%d</span><span class="s2"> memory)&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-425"><a href="#AgnoPersonalAgent.initialize-425"><span class="linenos">425</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">tools</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent.initialize-426"><a href="#AgnoPersonalAgent.initialize-426"><span class="linenos">426</span></a>                <span class="n">mcp_tool_count</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-427"><a href="#AgnoPersonalAgent.initialize-427"><span class="linenos">427</span></a>                <span class="n">memory_tool_count</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.initialize-428"><a href="#AgnoPersonalAgent.initialize-428"><span class="linenos">428</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-429"><a href="#AgnoPersonalAgent.initialize-429"><span class="linenos">429</span></a>
</span><span id="AgnoPersonalAgent.initialize-430"><a href="#AgnoPersonalAgent.initialize-430"><span class="linenos">430</span></a>            <span class="c1"># Display splash screen if enabled</span>
</span><span id="AgnoPersonalAgent.initialize-431"><a href="#AgnoPersonalAgent.initialize-431"><span class="linenos">431</span></a>            <span class="k">if</span> <span class="n">SHOW_SPLASH_SCREEN</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-432"><a href="#AgnoPersonalAgent.initialize-432"><span class="linenos">432</span></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">importlib.metadata</span>
</span><span id="AgnoPersonalAgent.initialize-433"><a href="#AgnoPersonalAgent.initialize-433"><span class="linenos">433</span></a>
</span><span id="AgnoPersonalAgent.initialize-434"><a href="#AgnoPersonalAgent.initialize-434"><span class="linenos">434</span></a>                <span class="n">agent_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_info</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.initialize-435"><a href="#AgnoPersonalAgent.initialize-435"><span class="linenos">435</span></a>                <span class="n">agent_version</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="s2">&quot;personal-agent&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-436"><a href="#AgnoPersonalAgent.initialize-436"><span class="linenos">436</span></a>                <span class="n">display_splash_screen</span><span class="p">(</span><span class="n">agent_info</span><span class="p">,</span> <span class="n">agent_version</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-437"><a href="#AgnoPersonalAgent.initialize-437"><span class="linenos">437</span></a>
</span><span id="AgnoPersonalAgent.initialize-438"><a href="#AgnoPersonalAgent.initialize-438"><span class="linenos">438</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgnoPersonalAgent.initialize-439"><a href="#AgnoPersonalAgent.initialize-439"><span class="linenos">439</span></a>
</span><span id="AgnoPersonalAgent.initialize-440"><a href="#AgnoPersonalAgent.initialize-440"><span class="linenos">440</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.initialize-441"><a href="#AgnoPersonalAgent.initialize-441"><span class="linenos">441</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to initialize agno agent: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.initialize-442"><a href="#AgnoPersonalAgent.initialize-442"><span class="linenos">442</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the agno agent with all components.</p>

<p>Args:
    recreate: Whether to recreate the agent knowledge bases</p>

<p>Returns:
    True if initialization successful, False otherwise</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.run" class="classattr">
                                        <input id="AgnoPersonalAgent.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">add_thought_callback</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.run-444"><a href="#AgnoPersonalAgent.run-444"><span class="linenos">444</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.run-445"><a href="#AgnoPersonalAgent.run-445"><span class="linenos">445</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">add_thought_callback</span><span class="o">=</span><span class="kc">None</span>
</span><span id="AgnoPersonalAgent.run-446"><a href="#AgnoPersonalAgent.run-446"><span class="linenos">446</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="AgnoPersonalAgent.run-447"><a href="#AgnoPersonalAgent.run-447"><span class="linenos">447</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a query through the agno agent, allowing for native tool execution.</span>
</span><span id="AgnoPersonalAgent.run-448"><a href="#AgnoPersonalAgent.run-448"><span class="linenos">448</span></a>
</span><span id="AgnoPersonalAgent.run-449"><a href="#AgnoPersonalAgent.run-449"><span class="linenos">449</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent.run-450"><a href="#AgnoPersonalAgent.run-450"><span class="linenos">450</span></a><span class="sd">            query: User query to process</span>
</span><span id="AgnoPersonalAgent.run-451"><a href="#AgnoPersonalAgent.run-451"><span class="linenos">451</span></a><span class="sd">            stream: Whether to stream the response</span>
</span><span id="AgnoPersonalAgent.run-452"><a href="#AgnoPersonalAgent.run-452"><span class="linenos">452</span></a><span class="sd">            add_thought_callback: Optional callback for adding thoughts during processing</span>
</span><span id="AgnoPersonalAgent.run-453"><a href="#AgnoPersonalAgent.run-453"><span class="linenos">453</span></a>
</span><span id="AgnoPersonalAgent.run-454"><a href="#AgnoPersonalAgent.run-454"><span class="linenos">454</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent.run-455"><a href="#AgnoPersonalAgent.run-455"><span class="linenos">455</span></a><span class="sd">            Agent&#39;s final string response or response dictionary</span>
</span><span id="AgnoPersonalAgent.run-456"><a href="#AgnoPersonalAgent.run-456"><span class="linenos">456</span></a>
</span><span id="AgnoPersonalAgent.run-457"><a href="#AgnoPersonalAgent.run-457"><span class="linenos">457</span></a><span class="sd">        Raises:</span>
</span><span id="AgnoPersonalAgent.run-458"><a href="#AgnoPersonalAgent.run-458"><span class="linenos">458</span></a><span class="sd">            RuntimeError: If agent is not initialized</span>
</span><span id="AgnoPersonalAgent.run-459"><a href="#AgnoPersonalAgent.run-459"><span class="linenos">459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.run-460"><a href="#AgnoPersonalAgent.run-460"><span class="linenos">460</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.run-461"><a href="#AgnoPersonalAgent.run-461"><span class="linenos">461</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Agent not initialized. Call initialize() first.&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.run-462"><a href="#AgnoPersonalAgent.run-462"><span class="linenos">462</span></a>
</span><span id="AgnoPersonalAgent.run-463"><a href="#AgnoPersonalAgent.run-463"><span class="linenos">463</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.run-464"><a href="#AgnoPersonalAgent.run-464"><span class="linenos">464</span></a>            <span class="k">if</span> <span class="n">add_thought_callback</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.run-465"><a href="#AgnoPersonalAgent.run-465"><span class="linenos">465</span></a>                <span class="n">add_thought_callback</span><span class="p">(</span><span class="s2">&quot;🚀 Executing agno agent...&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.run-466"><a href="#AgnoPersonalAgent.run-466"><span class="linenos">466</span></a>
</span><span id="AgnoPersonalAgent.run-467"><a href="#AgnoPersonalAgent.run-467"><span class="linenos">467</span></a>            <span class="c1"># The agent will handle the full tool-use loop internally</span>
</span><span id="AgnoPersonalAgent.run-468"><a href="#AgnoPersonalAgent.run-468"><span class="linenos">468</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.run-469"><a href="#AgnoPersonalAgent.run-469"><span class="linenos">469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_last_response</span> <span class="o">=</span> <span class="n">response</span>  <span class="c1"># Store for tool call inspection</span>
</span><span id="AgnoPersonalAgent.run-470"><a href="#AgnoPersonalAgent.run-470"><span class="linenos">470</span></a>
</span><span id="AgnoPersonalAgent.run-471"><a href="#AgnoPersonalAgent.run-471"><span class="linenos">471</span></a>            <span class="c1"># Use tool_manager to analyze tool calls if needed</span>
</span><span id="AgnoPersonalAgent.run-472"><a href="#AgnoPersonalAgent.run-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;tool_calls&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.run-473"><a href="#AgnoPersonalAgent.run-473"><span class="linenos">473</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.run-474"><a href="#AgnoPersonalAgent.run-474"><span class="linenos">474</span></a>                    <span class="sa">f</span><span class="s2">&quot;Agent used </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">)</span><span class="si">}</span><span class="s2"> tools in this response&quot;</span>
</span><span id="AgnoPersonalAgent.run-475"><a href="#AgnoPersonalAgent.run-475"><span class="linenos">475</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.run-476"><a href="#AgnoPersonalAgent.run-476"><span class="linenos">476</span></a>                <span class="c1"># We could use tool_manager here for additional tool analysis if needed</span>
</span><span id="AgnoPersonalAgent.run-477"><a href="#AgnoPersonalAgent.run-477"><span class="linenos">477</span></a>
</span><span id="AgnoPersonalAgent.run-478"><a href="#AgnoPersonalAgent.run-478"><span class="linenos">478</span></a>            <span class="k">if</span> <span class="n">add_thought_callback</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.run-479"><a href="#AgnoPersonalAgent.run-479"><span class="linenos">479</span></a>                <span class="n">add_thought_callback</span><span class="p">(</span><span class="s2">&quot;✅ Agent execution complete.&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.run-480"><a href="#AgnoPersonalAgent.run-480"><span class="linenos">480</span></a>
</span><span id="AgnoPersonalAgent.run-481"><a href="#AgnoPersonalAgent.run-481"><span class="linenos">481</span></a>            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
</span><span id="AgnoPersonalAgent.run-482"><a href="#AgnoPersonalAgent.run-482"><span class="linenos">482</span></a>
</span><span id="AgnoPersonalAgent.run-483"><a href="#AgnoPersonalAgent.run-483"><span class="linenos">483</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.run-484"><a href="#AgnoPersonalAgent.run-484"><span class="linenos">484</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error running agno agent: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.run-485"><a href="#AgnoPersonalAgent.run-485"><span class="linenos">485</span></a>            <span class="k">if</span> <span class="n">add_thought_callback</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.run-486"><a href="#AgnoPersonalAgent.run-486"><span class="linenos">486</span></a>                <span class="n">add_thought_callback</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.run-487"><a href="#AgnoPersonalAgent.run-487"><span class="linenos">487</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error processing request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Run a query through the agno agent, allowing for native tool execution.</p>

<p>Args:
    query: User query to process
    stream: Whether to stream the response
    add_thought_callback: Optional callback for adding thoughts during processing</p>

<p>Returns:
    Agent's final string response or response dictionary</p>

<p>Raises:
    RuntimeError: If agent is not initialized</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.store_user_memory" class="classattr">
                                        <input id="AgnoPersonalAgent.store_user_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">store_user_memory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#MemoryStorageResult">MemoryStorageResult</a></span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.store_user_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.store_user_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.store_user_memory-489"><a href="#AgnoPersonalAgent.store_user_memory-489"><span class="linenos">489</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_user_memory</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.store_user_memory-490"><a href="#AgnoPersonalAgent.store_user_memory-490"><span class="linenos">490</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.store_user_memory-491"><a href="#AgnoPersonalAgent.store_user_memory-491"><span class="linenos">491</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryStorageResult</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.store_user_memory-492"><a href="#AgnoPersonalAgent.store_user_memory-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store information as a user memory in both local SQLite and LightRAG graph systems.</span>
</span><span id="AgnoPersonalAgent.store_user_memory-493"><a href="#AgnoPersonalAgent.store_user_memory-493"><span class="linenos">493</span></a>
</span><span id="AgnoPersonalAgent.store_user_memory-494"><a href="#AgnoPersonalAgent.store_user_memory-494"><span class="linenos">494</span></a><span class="sd">        This is a public method that delegates to the memory_manager.</span>
</span><span id="AgnoPersonalAgent.store_user_memory-495"><a href="#AgnoPersonalAgent.store_user_memory-495"><span class="linenos">495</span></a>
</span><span id="AgnoPersonalAgent.store_user_memory-496"><a href="#AgnoPersonalAgent.store_user_memory-496"><span class="linenos">496</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent.store_user_memory-497"><a href="#AgnoPersonalAgent.store_user_memory-497"><span class="linenos">497</span></a><span class="sd">            content: The information to store as a memory</span>
</span><span id="AgnoPersonalAgent.store_user_memory-498"><a href="#AgnoPersonalAgent.store_user_memory-498"><span class="linenos">498</span></a><span class="sd">            topics: Optional list of topics/categories for the memory (None = auto-classify)</span>
</span><span id="AgnoPersonalAgent.store_user_memory-499"><a href="#AgnoPersonalAgent.store_user_memory-499"><span class="linenos">499</span></a>
</span><span id="AgnoPersonalAgent.store_user_memory-500"><a href="#AgnoPersonalAgent.store_user_memory-500"><span class="linenos">500</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent.store_user_memory-501"><a href="#AgnoPersonalAgent.store_user_memory-501"><span class="linenos">501</span></a><span class="sd">            MemoryStorageResult: Structured result with detailed status information</span>
</span><span id="AgnoPersonalAgent.store_user_memory-502"><a href="#AgnoPersonalAgent.store_user_memory-502"><span class="linenos">502</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.store_user_memory-503"><a href="#AgnoPersonalAgent.store_user_memory-503"><span class="linenos">503</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">store_user_memory</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Store information as a user memory in both local SQLite and LightRAG graph systems.</p>

<p>This is a public method that delegates to the memory_manager.</p>

<p>Args:
    content: The information to store as a memory
    topics: Optional list of topics/categories for the memory (None = auto-classify)</p>

<p>Returns:
    MemoryStorageResult: Structured result with detailed status information</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.seed_entity_in_graph" class="classattr">
                                        <input id="AgnoPersonalAgent.seed_entity_in_graph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">seed_entity_in_graph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.seed_entity_in_graph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.seed_entity_in_graph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.seed_entity_in_graph-518"><a href="#AgnoPersonalAgent.seed_entity_in_graph-518"><span class="linenos">518</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">seed_entity_in_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-519"><a href="#AgnoPersonalAgent.seed_entity_in_graph-519"><span class="linenos">519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Seed an entity into the graph by creating and uploading a physical file.</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-520"><a href="#AgnoPersonalAgent.seed_entity_in_graph-520"><span class="linenos">520</span></a>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-521"><a href="#AgnoPersonalAgent.seed_entity_in_graph-521"><span class="linenos">521</span></a><span class="sd">        Delegates to the memory_manager for processing.</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-522"><a href="#AgnoPersonalAgent.seed_entity_in_graph-522"><span class="linenos">522</span></a>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-523"><a href="#AgnoPersonalAgent.seed_entity_in_graph-523"><span class="linenos">523</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-524"><a href="#AgnoPersonalAgent.seed_entity_in_graph-524"><span class="linenos">524</span></a><span class="sd">            entity_name: Name of the entity to create</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-525"><a href="#AgnoPersonalAgent.seed_entity_in_graph-525"><span class="linenos">525</span></a><span class="sd">            entity_type: Type of the entity</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-526"><a href="#AgnoPersonalAgent.seed_entity_in_graph-526"><span class="linenos">526</span></a>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-527"><a href="#AgnoPersonalAgent.seed_entity_in_graph-527"><span class="linenos">527</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-528"><a href="#AgnoPersonalAgent.seed_entity_in_graph-528"><span class="linenos">528</span></a><span class="sd">            True if entity was successfully seeded</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-529"><a href="#AgnoPersonalAgent.seed_entity_in_graph-529"><span class="linenos">529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.seed_entity_in_graph-530"><a href="#AgnoPersonalAgent.seed_entity_in_graph-530"><span class="linenos">530</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">seed_entity_in_graph</span><span class="p">(</span><span class="n">entity_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Seed an entity into the graph by creating and uploading a physical file.</p>

<p>Delegates to the memory_manager for processing.</p>

<p>Args:
    entity_name: Name of the entity to create
    entity_type: Type of the entity</p>

<p>Returns:
    True if entity was successfully seeded</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.check_entity_exists" class="classattr">
                                        <input id="AgnoPersonalAgent.check_entity_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">check_entity_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.check_entity_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.check_entity_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.check_entity_exists-532"><a href="#AgnoPersonalAgent.check_entity_exists-532"><span class="linenos">532</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_entity_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.check_entity_exists-533"><a href="#AgnoPersonalAgent.check_entity_exists-533"><span class="linenos">533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if entity exists in the graph.</span>
</span><span id="AgnoPersonalAgent.check_entity_exists-534"><a href="#AgnoPersonalAgent.check_entity_exists-534"><span class="linenos">534</span></a>
</span><span id="AgnoPersonalAgent.check_entity_exists-535"><a href="#AgnoPersonalAgent.check_entity_exists-535"><span class="linenos">535</span></a><span class="sd">        Delegates to the memory_manager for processing.</span>
</span><span id="AgnoPersonalAgent.check_entity_exists-536"><a href="#AgnoPersonalAgent.check_entity_exists-536"><span class="linenos">536</span></a>
</span><span id="AgnoPersonalAgent.check_entity_exists-537"><a href="#AgnoPersonalAgent.check_entity_exists-537"><span class="linenos">537</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent.check_entity_exists-538"><a href="#AgnoPersonalAgent.check_entity_exists-538"><span class="linenos">538</span></a><span class="sd">            entity_name: Name of the entity to check</span>
</span><span id="AgnoPersonalAgent.check_entity_exists-539"><a href="#AgnoPersonalAgent.check_entity_exists-539"><span class="linenos">539</span></a>
</span><span id="AgnoPersonalAgent.check_entity_exists-540"><a href="#AgnoPersonalAgent.check_entity_exists-540"><span class="linenos">540</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent.check_entity_exists-541"><a href="#AgnoPersonalAgent.check_entity_exists-541"><span class="linenos">541</span></a><span class="sd">            True if entity exists</span>
</span><span id="AgnoPersonalAgent.check_entity_exists-542"><a href="#AgnoPersonalAgent.check_entity_exists-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.check_entity_exists-543"><a href="#AgnoPersonalAgent.check_entity_exists-543"><span class="linenos">543</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">check_entity_exists</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check if entity exists in the graph.</p>

<p>Delegates to the memory_manager for processing.</p>

<p>Args:
    entity_name: Name of the entity to check</p>

<p>Returns:
    True if entity exists</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.clear_all_memories" class="classattr">
                                        <input id="AgnoPersonalAgent.clear_all_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">clear_all_memories</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.clear_all_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.clear_all_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.clear_all_memories-545"><a href="#AgnoPersonalAgent.clear_all_memories-545"><span class="linenos">545</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_all_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.clear_all_memories-546"><a href="#AgnoPersonalAgent.clear_all_memories-546"><span class="linenos">546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all memories from both SQLite and LightRAG systems.</span>
</span><span id="AgnoPersonalAgent.clear_all_memories-547"><a href="#AgnoPersonalAgent.clear_all_memories-547"><span class="linenos">547</span></a>
</span><span id="AgnoPersonalAgent.clear_all_memories-548"><a href="#AgnoPersonalAgent.clear_all_memories-548"><span class="linenos">548</span></a><span class="sd">        Delegates to the memory_manager for processing.</span>
</span><span id="AgnoPersonalAgent.clear_all_memories-549"><a href="#AgnoPersonalAgent.clear_all_memories-549"><span class="linenos">549</span></a>
</span><span id="AgnoPersonalAgent.clear_all_memories-550"><a href="#AgnoPersonalAgent.clear_all_memories-550"><span class="linenos">550</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent.clear_all_memories-551"><a href="#AgnoPersonalAgent.clear_all_memories-551"><span class="linenos">551</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgnoPersonalAgent.clear_all_memories-552"><a href="#AgnoPersonalAgent.clear_all_memories-552"><span class="linenos">552</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.clear_all_memories-553"><a href="#AgnoPersonalAgent.clear_all_memories-553"><span class="linenos">553</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">clear_all_memories</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Clear all memories from both SQLite and LightRAG systems.</p>

<p>Delegates to the memory_manager for processing.</p>

<p>Returns:
    str: Success or error message</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.query_lightrag_knowledge_direct" class="classattr">
                                        <input id="AgnoPersonalAgent.query_lightrag_knowledge_direct-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">query_lightrag_knowledge_direct</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.query_lightrag_knowledge_direct-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.query_lightrag_knowledge_direct"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-555"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-555"><span class="linenos">555</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_lightrag_knowledge_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-556"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-556"><span class="linenos">556</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Directly query the LightRAG knowledge base and return the raw response.</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-557"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-557"><span class="linenos">557</span></a>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-558"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-558"><span class="linenos">558</span></a><span class="sd">        Delegates to the knowledge_manager for processing.</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-559"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-559"><span class="linenos">559</span></a>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-560"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-560"><span class="linenos">560</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-561"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-561"><span class="linenos">561</span></a><span class="sd">            query: The query string to search in the knowledge base</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-562"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-562"><span class="linenos">562</span></a><span class="sd">            params: A dictionary of query parameters</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-563"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-563"><span class="linenos">563</span></a>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-564"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-564"><span class="linenos">564</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-565"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-565"><span class="linenos">565</span></a><span class="sd">            String with query results exactly as LightRAG returns them</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-566"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-566"><span class="linenos">566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.query_lightrag_knowledge_direct-567"><a href="#AgnoPersonalAgent.query_lightrag_knowledge_direct-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span><span class="o">.</span><span class="n">query_graph</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Directly query the LightRAG knowledge base and return the raw response.</p>

<p>Delegates to the knowledge_manager for processing.</p>

<p>Args:
    query: The query string to search in the knowledge base
    params: A dictionary of query parameters</p>

<p>Returns:
    String with query results exactly as LightRAG returns them</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.get_agent_info" class="classattr">
                                        <input id="AgnoPersonalAgent.get_agent_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_agent_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.get_agent_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.get_agent_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.get_agent_info-709"><a href="#AgnoPersonalAgent.get_agent_info-709"><span class="linenos">709</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_agent_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AgnoPersonalAgent.get_agent_info-710"><a href="#AgnoPersonalAgent.get_agent_info-710"><span class="linenos">710</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive information about the agent configuration and tools.</span>
</span><span id="AgnoPersonalAgent.get_agent_info-711"><a href="#AgnoPersonalAgent.get_agent_info-711"><span class="linenos">711</span></a>
</span><span id="AgnoPersonalAgent.get_agent_info-712"><a href="#AgnoPersonalAgent.get_agent_info-712"><span class="linenos">712</span></a><span class="sd">        Returns:</span>
</span><span id="AgnoPersonalAgent.get_agent_info-713"><a href="#AgnoPersonalAgent.get_agent_info-713"><span class="linenos">713</span></a><span class="sd">            Dictionary containing detailed agent configuration and tool information</span>
</span><span id="AgnoPersonalAgent.get_agent_info-714"><a href="#AgnoPersonalAgent.get_agent_info-714"><span class="linenos">714</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.get_agent_info-715"><a href="#AgnoPersonalAgent.get_agent_info-715"><span class="linenos">715</span></a>        <span class="c1"># Get basic tool info</span>
</span><span id="AgnoPersonalAgent.get_agent_info-716"><a href="#AgnoPersonalAgent.get_agent_info-716"><span class="linenos">716</span></a>        <span class="n">built_in_tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent.get_agent_info-717"><a href="#AgnoPersonalAgent.get_agent_info-717"><span class="linenos">717</span></a>        <span class="n">mcp_tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgnoPersonalAgent.get_agent_info-718"><a href="#AgnoPersonalAgent.get_agent_info-718"><span class="linenos">718</span></a>
</span><span id="AgnoPersonalAgent.get_agent_info-719"><a href="#AgnoPersonalAgent.get_agent_info-719"><span class="linenos">719</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">):</span>
</span><span id="AgnoPersonalAgent.get_agent_info-720"><a href="#AgnoPersonalAgent.get_agent_info-720"><span class="linenos">720</span></a>            <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.get_agent_info-721"><a href="#AgnoPersonalAgent.get_agent_info-721"><span class="linenos">721</span></a>                <span class="n">tool_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
</span><span id="AgnoPersonalAgent.get_agent_info-722"><a href="#AgnoPersonalAgent.get_agent_info-722"><span class="linenos">722</span></a>                <span class="n">tool_doc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;__doc__&quot;</span><span class="p">,</span> <span class="s2">&quot;No description available&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.get_agent_info-723"><a href="#AgnoPersonalAgent.get_agent_info-723"><span class="linenos">723</span></a>
</span><span id="AgnoPersonalAgent.get_agent_info-724"><a href="#AgnoPersonalAgent.get_agent_info-724"><span class="linenos">724</span></a>                <span class="c1"># Clean up docstring for display</span>
</span><span id="AgnoPersonalAgent.get_agent_info-725"><a href="#AgnoPersonalAgent.get_agent_info-725"><span class="linenos">725</span></a>                <span class="k">if</span> <span class="n">tool_doc</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.get_agent_info-726"><a href="#AgnoPersonalAgent.get_agent_info-726"><span class="linenos">726</span></a>                    <span class="n">tool_doc</span> <span class="o">=</span> <span class="n">tool_doc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># First line only</span>
</span><span id="AgnoPersonalAgent.get_agent_info-727"><a href="#AgnoPersonalAgent.get_agent_info-727"><span class="linenos">727</span></a>
</span><span id="AgnoPersonalAgent.get_agent_info-728"><a href="#AgnoPersonalAgent.get_agent_info-728"><span class="linenos">728</span></a>                <span class="k">if</span> <span class="n">tool_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;use_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;_server&quot;</span> <span class="ow">in</span> <span class="n">tool_name</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.get_agent_info-729"><a href="#AgnoPersonalAgent.get_agent_info-729"><span class="linenos">729</span></a>                    <span class="n">mcp_tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.get_agent_info-730"><a href="#AgnoPersonalAgent.get_agent_info-730"><span class="linenos">730</span></a>                        <span class="p">{</span>
</span><span id="AgnoPersonalAgent.get_agent_info-731"><a href="#AgnoPersonalAgent.get_agent_info-731"><span class="linenos">731</span></a>                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-732"><a href="#AgnoPersonalAgent.get_agent_info-732"><span class="linenos">732</span></a>                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">tool_doc</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-733"><a href="#AgnoPersonalAgent.get_agent_info-733"><span class="linenos">733</span></a>                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MCP Server&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-734"><a href="#AgnoPersonalAgent.get_agent_info-734"><span class="linenos">734</span></a>                        <span class="p">}</span>
</span><span id="AgnoPersonalAgent.get_agent_info-735"><a href="#AgnoPersonalAgent.get_agent_info-735"><span class="linenos">735</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent.get_agent_info-736"><a href="#AgnoPersonalAgent.get_agent_info-736"><span class="linenos">736</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.get_agent_info-737"><a href="#AgnoPersonalAgent.get_agent_info-737"><span class="linenos">737</span></a>                    <span class="n">built_in_tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.get_agent_info-738"><a href="#AgnoPersonalAgent.get_agent_info-738"><span class="linenos">738</span></a>                        <span class="p">{</span>
</span><span id="AgnoPersonalAgent.get_agent_info-739"><a href="#AgnoPersonalAgent.get_agent_info-739"><span class="linenos">739</span></a>                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-740"><a href="#AgnoPersonalAgent.get_agent_info-740"><span class="linenos">740</span></a>                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">tool_doc</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-741"><a href="#AgnoPersonalAgent.get_agent_info-741"><span class="linenos">741</span></a>                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Built-in Tool&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-742"><a href="#AgnoPersonalAgent.get_agent_info-742"><span class="linenos">742</span></a>                        <span class="p">}</span>
</span><span id="AgnoPersonalAgent.get_agent_info-743"><a href="#AgnoPersonalAgent.get_agent_info-743"><span class="linenos">743</span></a>                    <span class="p">)</span>
</span><span id="AgnoPersonalAgent.get_agent_info-744"><a href="#AgnoPersonalAgent.get_agent_info-744"><span class="linenos">744</span></a>
</span><span id="AgnoPersonalAgent.get_agent_info-745"><a href="#AgnoPersonalAgent.get_agent_info-745"><span class="linenos">745</span></a>        <span class="c1"># MCP server details</span>
</span><span id="AgnoPersonalAgent.get_agent_info-746"><a href="#AgnoPersonalAgent.get_agent_info-746"><span class="linenos">746</span></a>        <span class="n">mcp_server_details</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgnoPersonalAgent.get_agent_info-747"><a href="#AgnoPersonalAgent.get_agent_info-747"><span class="linenos">747</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.get_agent_info-748"><a href="#AgnoPersonalAgent.get_agent_info-748"><span class="linenos">748</span></a>            <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgnoPersonalAgent.get_agent_info-749"><a href="#AgnoPersonalAgent.get_agent_info-749"><span class="linenos">749</span></a>                <span class="n">mcp_server_details</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgnoPersonalAgent.get_agent_info-750"><a href="#AgnoPersonalAgent.get_agent_info-750"><span class="linenos">750</span></a>                    <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent.get_agent_info-751"><a href="#AgnoPersonalAgent.get_agent_info-751"><span class="linenos">751</span></a>                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.get_agent_info-752"><a href="#AgnoPersonalAgent.get_agent_info-752"><span class="linenos">752</span></a>                        <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Access to </span><span class="si">{</span><span class="n">server_name</span><span class="si">}</span><span class="s2"> MCP server&quot;</span>
</span><span id="AgnoPersonalAgent.get_agent_info-753"><a href="#AgnoPersonalAgent.get_agent_info-753"><span class="linenos">753</span></a>                    <span class="p">),</span>
</span><span id="AgnoPersonalAgent.get_agent_info-754"><a href="#AgnoPersonalAgent.get_agent_info-754"><span class="linenos">754</span></a>                    <span class="s2">&quot;args_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">,</span> <span class="p">[])),</span>
</span><span id="AgnoPersonalAgent.get_agent_info-755"><a href="#AgnoPersonalAgent.get_agent_info-755"><span class="linenos">755</span></a>                    <span class="s2">&quot;env_vars&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">,</span> <span class="p">{})),</span>
</span><span id="AgnoPersonalAgent.get_agent_info-756"><a href="#AgnoPersonalAgent.get_agent_info-756"><span class="linenos">756</span></a>                <span class="p">}</span>
</span><span id="AgnoPersonalAgent.get_agent_info-757"><a href="#AgnoPersonalAgent.get_agent_info-757"><span class="linenos">757</span></a>
</span><span id="AgnoPersonalAgent.get_agent_info-758"><a href="#AgnoPersonalAgent.get_agent_info-758"><span class="linenos">758</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="AgnoPersonalAgent.get_agent_info-759"><a href="#AgnoPersonalAgent.get_agent_info-759"><span class="linenos">759</span></a>            <span class="s2">&quot;framework&quot;</span><span class="p">:</span> <span class="s2">&quot;agno&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-760"><a href="#AgnoPersonalAgent.get_agent_info-760"><span class="linenos">760</span></a>            <span class="s2">&quot;model_provider&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-761"><a href="#AgnoPersonalAgent.get_agent_info-761"><span class="linenos">761</span></a>            <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-762"><a href="#AgnoPersonalAgent.get_agent_info-762"><span class="linenos">762</span></a>            <span class="s2">&quot;memory_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-763"><a href="#AgnoPersonalAgent.get_agent_info-763"><span class="linenos">763</span></a>            <span class="s2">&quot;knowledge_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-764"><a href="#AgnoPersonalAgent.get_agent_info-764"><span class="linenos">764</span></a>            <span class="s2">&quot;lightrag_knowledge_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_knowledge_enabled</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-765"><a href="#AgnoPersonalAgent.get_agent_info-765"><span class="linenos">765</span></a>            <span class="s2">&quot;mcp_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-766"><a href="#AgnoPersonalAgent.get_agent_info-766"><span class="linenos">766</span></a>            <span class="s2">&quot;debug_mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-767"><a href="#AgnoPersonalAgent.get_agent_info-767"><span class="linenos">767</span></a>            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-768"><a href="#AgnoPersonalAgent.get_agent_info-768"><span class="linenos">768</span></a>            <span class="s2">&quot;initialized&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-769"><a href="#AgnoPersonalAgent.get_agent_info-769"><span class="linenos">769</span></a>            <span class="s2">&quot;storage_dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-770"><a href="#AgnoPersonalAgent.get_agent_info-770"><span class="linenos">770</span></a>            <span class="s2">&quot;knowledge_dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_dir</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-771"><a href="#AgnoPersonalAgent.get_agent_info-771"><span class="linenos">771</span></a>            <span class="s2">&quot;lightrag_url&quot;</span><span class="p">:</span> <span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-772"><a href="#AgnoPersonalAgent.get_agent_info-772"><span class="linenos">772</span></a>            <span class="s2">&quot;lightrag_memory_url&quot;</span><span class="p">:</span> <span class="n">LIGHTRAG_MEMORY_URL</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-773"><a href="#AgnoPersonalAgent.get_agent_info-773"><span class="linenos">773</span></a>            <span class="s2">&quot;tool_counts&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AgnoPersonalAgent.get_agent_info-774"><a href="#AgnoPersonalAgent.get_agent_info-774"><span class="linenos">774</span></a>                <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">built_in_tools</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tools</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent.get_agent_info-775"><a href="#AgnoPersonalAgent.get_agent_info-775"><span class="linenos">775</span></a>                <span class="s2">&quot;built_in&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">built_in_tools</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent.get_agent_info-776"><a href="#AgnoPersonalAgent.get_agent_info-776"><span class="linenos">776</span></a>                <span class="s2">&quot;mcp&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tools</span><span class="p">),</span>
</span><span id="AgnoPersonalAgent.get_agent_info-777"><a href="#AgnoPersonalAgent.get_agent_info-777"><span class="linenos">777</span></a>                <span class="s2">&quot;mcp_servers&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-778"><a href="#AgnoPersonalAgent.get_agent_info-778"><span class="linenos">778</span></a>            <span class="p">},</span>
</span><span id="AgnoPersonalAgent.get_agent_info-779"><a href="#AgnoPersonalAgent.get_agent_info-779"><span class="linenos">779</span></a>            <span class="s2">&quot;built_in_tools&quot;</span><span class="p">:</span> <span class="n">built_in_tools</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-780"><a href="#AgnoPersonalAgent.get_agent_info-780"><span class="linenos">780</span></a>            <span class="s2">&quot;mcp_tools&quot;</span><span class="p">:</span> <span class="n">mcp_tools</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-781"><a href="#AgnoPersonalAgent.get_agent_info-781"><span class="linenos">781</span></a>            <span class="s2">&quot;mcp_servers&quot;</span><span class="p">:</span> <span class="n">mcp_server_details</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.get_agent_info-782"><a href="#AgnoPersonalAgent.get_agent_info-782"><span class="linenos">782</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get comprehensive information about the agent configuration and tools.</p>

<p>Returns:
    Dictionary containing detailed agent configuration and tool information</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.print_agent_info" class="classattr">
                                        <input id="AgnoPersonalAgent.print_agent_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_agent_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">console</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rich</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">Console</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.print_agent_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.print_agent_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.print_agent_info-784"><a href="#AgnoPersonalAgent.print_agent_info-784"><span class="linenos">784</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_agent_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Console</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.print_agent_info-785"><a href="#AgnoPersonalAgent.print_agent_info-785"><span class="linenos">785</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty print comprehensive agent information using Rich.</span>
</span><span id="AgnoPersonalAgent.print_agent_info-786"><a href="#AgnoPersonalAgent.print_agent_info-786"><span class="linenos">786</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-787"><a href="#AgnoPersonalAgent.print_agent_info-787"><span class="linenos">787</span></a><span class="sd">        Args:</span>
</span><span id="AgnoPersonalAgent.print_agent_info-788"><a href="#AgnoPersonalAgent.print_agent_info-788"><span class="linenos">788</span></a><span class="sd">            console: Optional Rich Console instance. If None, creates a new one.</span>
</span><span id="AgnoPersonalAgent.print_agent_info-789"><a href="#AgnoPersonalAgent.print_agent_info-789"><span class="linenos">789</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.print_agent_info-790"><a href="#AgnoPersonalAgent.print_agent_info-790"><span class="linenos">790</span></a>        <span class="k">if</span> <span class="n">console</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.print_agent_info-791"><a href="#AgnoPersonalAgent.print_agent_info-791"><span class="linenos">791</span></a>            <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.print_agent_info-792"><a href="#AgnoPersonalAgent.print_agent_info-792"><span class="linenos">792</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-793"><a href="#AgnoPersonalAgent.print_agent_info-793"><span class="linenos">793</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_info</span><span class="p">()</span>
</span><span id="AgnoPersonalAgent.print_agent_info-794"><a href="#AgnoPersonalAgent.print_agent_info-794"><span class="linenos">794</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-795"><a href="#AgnoPersonalAgent.print_agent_info-795"><span class="linenos">795</span></a>        <span class="c1"># Main agent info table</span>
</span><span id="AgnoPersonalAgent.print_agent_info-796"><a href="#AgnoPersonalAgent.print_agent_info-796"><span class="linenos">796</span></a>        <span class="n">main_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.print_agent_info-797"><a href="#AgnoPersonalAgent.print_agent_info-797"><span class="linenos">797</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;🤖 Personal AI Agent Configuration&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-798"><a href="#AgnoPersonalAgent.print_agent_info-798"><span class="linenos">798</span></a>            <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-799"><a href="#AgnoPersonalAgent.print_agent_info-799"><span class="linenos">799</span></a>            <span class="n">header_style</span><span class="o">=</span><span class="s2">&quot;bold magenta&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-800"><a href="#AgnoPersonalAgent.print_agent_info-800"><span class="linenos">800</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-801"><a href="#AgnoPersonalAgent.print_agent_info-801"><span class="linenos">801</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Setting&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-802"><a href="#AgnoPersonalAgent.print_agent_info-802"><span class="linenos">802</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-803"><a href="#AgnoPersonalAgent.print_agent_info-803"><span class="linenos">803</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-804"><a href="#AgnoPersonalAgent.print_agent_info-804"><span class="linenos">804</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Framework&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;framework&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent.print_agent_info-805"><a href="#AgnoPersonalAgent.print_agent_info-805"><span class="linenos">805</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Model Provider&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;model_provider&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-806"><a href="#AgnoPersonalAgent.print_agent_info-806"><span class="linenos">806</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Model Name&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent.print_agent_info-807"><a href="#AgnoPersonalAgent.print_agent_info-807"><span class="linenos">807</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Memory Enabled&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;memory_enabled&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent.print_agent_info-808"><a href="#AgnoPersonalAgent.print_agent_info-808"><span class="linenos">808</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Knowledge Enabled&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;knowledge_enabled&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent.print_agent_info-809"><a href="#AgnoPersonalAgent.print_agent_info-809"><span class="linenos">809</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.print_agent_info-810"><a href="#AgnoPersonalAgent.print_agent_info-810"><span class="linenos">810</span></a>            <span class="s2">&quot;LightRAG Knowledge&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;lightrag_knowledge_enabled&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent.print_agent_info-811"><a href="#AgnoPersonalAgent.print_agent_info-811"><span class="linenos">811</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-812"><a href="#AgnoPersonalAgent.print_agent_info-812"><span class="linenos">812</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;MCP Enabled&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_enabled&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent.print_agent_info-813"><a href="#AgnoPersonalAgent.print_agent_info-813"><span class="linenos">813</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Debug Mode&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;debug_mode&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent.print_agent_info-814"><a href="#AgnoPersonalAgent.print_agent_info-814"><span class="linenos">814</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;User ID&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent.print_agent_info-815"><a href="#AgnoPersonalAgent.print_agent_info-815"><span class="linenos">815</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Storage Directory&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;storage_dir&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent.print_agent_info-816"><a href="#AgnoPersonalAgent.print_agent_info-816"><span class="linenos">816</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Knowledge Directory&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;knowledge_dir&quot;</span><span class="p">])</span>
</span><span id="AgnoPersonalAgent.print_agent_info-817"><a href="#AgnoPersonalAgent.print_agent_info-817"><span class="linenos">817</span></a>        <span class="n">main_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Total Tools&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;tool_counts&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]))</span>
</span><span id="AgnoPersonalAgent.print_agent_info-818"><a href="#AgnoPersonalAgent.print_agent_info-818"><span class="linenos">818</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-819"><a href="#AgnoPersonalAgent.print_agent_info-819"><span class="linenos">819</span></a>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">main_table</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-820"><a href="#AgnoPersonalAgent.print_agent_info-820"><span class="linenos">820</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-821"><a href="#AgnoPersonalAgent.print_agent_info-821"><span class="linenos">821</span></a>        <span class="c1"># Tools table</span>
</span><span id="AgnoPersonalAgent.print_agent_info-822"><a href="#AgnoPersonalAgent.print_agent_info-822"><span class="linenos">822</span></a>        <span class="n">tools_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.print_agent_info-823"><a href="#AgnoPersonalAgent.print_agent_info-823"><span class="linenos">823</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;🛠️ Available Tools&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-824"><a href="#AgnoPersonalAgent.print_agent_info-824"><span class="linenos">824</span></a>            <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-825"><a href="#AgnoPersonalAgent.print_agent_info-825"><span class="linenos">825</span></a>            <span class="n">header_style</span><span class="o">=</span><span class="s2">&quot;bold magenta&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-826"><a href="#AgnoPersonalAgent.print_agent_info-826"><span class="linenos">826</span></a>        <span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-827"><a href="#AgnoPersonalAgent.print_agent_info-827"><span class="linenos">827</span></a>        <span class="n">tools_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-828"><a href="#AgnoPersonalAgent.print_agent_info-828"><span class="linenos">828</span></a>        <span class="n">tools_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-829"><a href="#AgnoPersonalAgent.print_agent_info-829"><span class="linenos">829</span></a>        <span class="n">tools_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-830"><a href="#AgnoPersonalAgent.print_agent_info-830"><span class="linenos">830</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-831"><a href="#AgnoPersonalAgent.print_agent_info-831"><span class="linenos">831</span></a>        <span class="c1"># Add built-in tools</span>
</span><span id="AgnoPersonalAgent.print_agent_info-832"><a href="#AgnoPersonalAgent.print_agent_info-832"><span class="linenos">832</span></a>        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;built_in_tools&quot;</span><span class="p">]:</span>
</span><span id="AgnoPersonalAgent.print_agent_info-833"><a href="#AgnoPersonalAgent.print_agent_info-833"><span class="linenos">833</span></a>            <span class="n">tools_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.print_agent_info-834"><a href="#AgnoPersonalAgent.print_agent_info-834"><span class="linenos">834</span></a>                <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">tool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-835"><a href="#AgnoPersonalAgent.print_agent_info-835"><span class="linenos">835</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-836"><a href="#AgnoPersonalAgent.print_agent_info-836"><span class="linenos">836</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-837"><a href="#AgnoPersonalAgent.print_agent_info-837"><span class="linenos">837</span></a>        <span class="c1"># Add MCP tools</span>
</span><span id="AgnoPersonalAgent.print_agent_info-838"><a href="#AgnoPersonalAgent.print_agent_info-838"><span class="linenos">838</span></a>        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_tools&quot;</span><span class="p">]:</span>
</span><span id="AgnoPersonalAgent.print_agent_info-839"><a href="#AgnoPersonalAgent.print_agent_info-839"><span class="linenos">839</span></a>            <span class="n">tools_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.print_agent_info-840"><a href="#AgnoPersonalAgent.print_agent_info-840"><span class="linenos">840</span></a>                <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">tool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-841"><a href="#AgnoPersonalAgent.print_agent_info-841"><span class="linenos">841</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-842"><a href="#AgnoPersonalAgent.print_agent_info-842"><span class="linenos">842</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-843"><a href="#AgnoPersonalAgent.print_agent_info-843"><span class="linenos">843</span></a>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">tools_table</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-844"><a href="#AgnoPersonalAgent.print_agent_info-844"><span class="linenos">844</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-845"><a href="#AgnoPersonalAgent.print_agent_info-845"><span class="linenos">845</span></a>        <span class="c1"># MCP servers table if enabled</span>
</span><span id="AgnoPersonalAgent.print_agent_info-846"><a href="#AgnoPersonalAgent.print_agent_info-846"><span class="linenos">846</span></a>        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_enabled&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_servers&quot;</span><span class="p">]:</span>
</span><span id="AgnoPersonalAgent.print_agent_info-847"><a href="#AgnoPersonalAgent.print_agent_info-847"><span class="linenos">847</span></a>            <span class="n">mcp_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.print_agent_info-848"><a href="#AgnoPersonalAgent.print_agent_info-848"><span class="linenos">848</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;🔌 MCP Servers&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-849"><a href="#AgnoPersonalAgent.print_agent_info-849"><span class="linenos">849</span></a>                <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-850"><a href="#AgnoPersonalAgent.print_agent_info-850"><span class="linenos">850</span></a>                <span class="n">header_style</span><span class="o">=</span><span class="s2">&quot;bold magenta&quot;</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-851"><a href="#AgnoPersonalAgent.print_agent_info-851"><span class="linenos">851</span></a>            <span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-852"><a href="#AgnoPersonalAgent.print_agent_info-852"><span class="linenos">852</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Server Name&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-853"><a href="#AgnoPersonalAgent.print_agent_info-853"><span class="linenos">853</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Command&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-854"><a href="#AgnoPersonalAgent.print_agent_info-854"><span class="linenos">854</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-855"><a href="#AgnoPersonalAgent.print_agent_info-855"><span class="linenos">855</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Args Count&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-856"><a href="#AgnoPersonalAgent.print_agent_info-856"><span class="linenos">856</span></a>            <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Env Vars&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-857"><a href="#AgnoPersonalAgent.print_agent_info-857"><span class="linenos">857</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-858"><a href="#AgnoPersonalAgent.print_agent_info-858"><span class="linenos">858</span></a>            <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">server_info</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mcp_servers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgnoPersonalAgent.print_agent_info-859"><a href="#AgnoPersonalAgent.print_agent_info-859"><span class="linenos">859</span></a>                <span class="n">mcp_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="AgnoPersonalAgent.print_agent_info-860"><a href="#AgnoPersonalAgent.print_agent_info-860"><span class="linenos">860</span></a>                    <span class="n">server_name</span><span class="p">,</span>
</span><span id="AgnoPersonalAgent.print_agent_info-861"><a href="#AgnoPersonalAgent.print_agent_info-861"><span class="linenos">861</span></a>                    <span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">],</span>
</span><span id="AgnoPersonalAgent.print_agent_info-862"><a href="#AgnoPersonalAgent.print_agent_info-862"><span class="linenos">862</span></a>                    <span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
</span><span id="AgnoPersonalAgent.print_agent_info-863"><a href="#AgnoPersonalAgent.print_agent_info-863"><span class="linenos">863</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;args_count&quot;</span><span class="p">]),</span>
</span><span id="AgnoPersonalAgent.print_agent_info-864"><a href="#AgnoPersonalAgent.print_agent_info-864"><span class="linenos">864</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">server_info</span><span class="p">[</span><span class="s2">&quot;env_vars&quot;</span><span class="p">]),</span>
</span><span id="AgnoPersonalAgent.print_agent_info-865"><a href="#AgnoPersonalAgent.print_agent_info-865"><span class="linenos">865</span></a>                <span class="p">)</span>
</span><span id="AgnoPersonalAgent.print_agent_info-866"><a href="#AgnoPersonalAgent.print_agent_info-866"><span class="linenos">866</span></a>
</span><span id="AgnoPersonalAgent.print_agent_info-867"><a href="#AgnoPersonalAgent.print_agent_info-867"><span class="linenos">867</span></a>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">mcp_table</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pretty print comprehensive agent information using Rich.</p>

<p>Args:
    console: Optional Rich Console instance. If None, creates a new one.</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.cleanup" class="classattr">
                                        <input id="AgnoPersonalAgent.cleanup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">cleanup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.cleanup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.cleanup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.cleanup-869"><a href="#AgnoPersonalAgent.cleanup-869"><span class="linenos">869</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-870"><a href="#AgnoPersonalAgent.cleanup-870"><span class="linenos">870</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up resources when the agent is being shut down.</span>
</span><span id="AgnoPersonalAgent.cleanup-871"><a href="#AgnoPersonalAgent.cleanup-871"><span class="linenos">871</span></a><span class="sd">        </span>
</span><span id="AgnoPersonalAgent.cleanup-872"><a href="#AgnoPersonalAgent.cleanup-872"><span class="linenos">872</span></a><span class="sd">        This method is called during application shutdown to properly</span>
</span><span id="AgnoPersonalAgent.cleanup-873"><a href="#AgnoPersonalAgent.cleanup-873"><span class="linenos">873</span></a><span class="sd">        clean up any resources, connections, or background tasks.</span>
</span><span id="AgnoPersonalAgent.cleanup-874"><a href="#AgnoPersonalAgent.cleanup-874"><span class="linenos">874</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.cleanup-875"><a href="#AgnoPersonalAgent.cleanup-875"><span class="linenos">875</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-876"><a href="#AgnoPersonalAgent.cleanup-876"><span class="linenos">876</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up AgnoPersonalAgent resources...&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-877"><a href="#AgnoPersonalAgent.cleanup-877"><span class="linenos">877</span></a>            
</span><span id="AgnoPersonalAgent.cleanup-878"><a href="#AgnoPersonalAgent.cleanup-878"><span class="linenos">878</span></a>            <span class="c1"># Clean up agent resources</span>
</span><span id="AgnoPersonalAgent.cleanup-879"><a href="#AgnoPersonalAgent.cleanup-879"><span class="linenos">879</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-880"><a href="#AgnoPersonalAgent.cleanup-880"><span class="linenos">880</span></a>                <span class="c1"># Clear the agent reference</span>
</span><span id="AgnoPersonalAgent.cleanup-881"><a href="#AgnoPersonalAgent.cleanup-881"><span class="linenos">881</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-882"><a href="#AgnoPersonalAgent.cleanup-882"><span class="linenos">882</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared agent reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-883"><a href="#AgnoPersonalAgent.cleanup-883"><span class="linenos">883</span></a>            
</span><span id="AgnoPersonalAgent.cleanup-884"><a href="#AgnoPersonalAgent.cleanup-884"><span class="linenos">884</span></a>            <span class="c1"># Clean up storage references</span>
</span><span id="AgnoPersonalAgent.cleanup-885"><a href="#AgnoPersonalAgent.cleanup-885"><span class="linenos">885</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-886"><a href="#AgnoPersonalAgent.cleanup-886"><span class="linenos">886</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-887"><a href="#AgnoPersonalAgent.cleanup-887"><span class="linenos">887</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared storage reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-888"><a href="#AgnoPersonalAgent.cleanup-888"><span class="linenos">888</span></a>                
</span><span id="AgnoPersonalAgent.cleanup-889"><a href="#AgnoPersonalAgent.cleanup-889"><span class="linenos">889</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-890"><a href="#AgnoPersonalAgent.cleanup-890"><span class="linenos">890</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-891"><a href="#AgnoPersonalAgent.cleanup-891"><span class="linenos">891</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-892"><a href="#AgnoPersonalAgent.cleanup-892"><span class="linenos">892</span></a>                
</span><span id="AgnoPersonalAgent.cleanup-893"><a href="#AgnoPersonalAgent.cleanup-893"><span class="linenos">893</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-894"><a href="#AgnoPersonalAgent.cleanup-894"><span class="linenos">894</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-895"><a href="#AgnoPersonalAgent.cleanup-895"><span class="linenos">895</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared memory reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-896"><a href="#AgnoPersonalAgent.cleanup-896"><span class="linenos">896</span></a>                
</span><span id="AgnoPersonalAgent.cleanup-897"><a href="#AgnoPersonalAgent.cleanup-897"><span class="linenos">897</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-898"><a href="#AgnoPersonalAgent.cleanup-898"><span class="linenos">898</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-899"><a href="#AgnoPersonalAgent.cleanup-899"><span class="linenos">899</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge coordinator reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-900"><a href="#AgnoPersonalAgent.cleanup-900"><span class="linenos">900</span></a>            
</span><span id="AgnoPersonalAgent.cleanup-901"><a href="#AgnoPersonalAgent.cleanup-901"><span class="linenos">901</span></a>            <span class="c1"># Clean up manager references safely</span>
</span><span id="AgnoPersonalAgent.cleanup-902"><a href="#AgnoPersonalAgent.cleanup-902"><span class="linenos">902</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-903"><a href="#AgnoPersonalAgent.cleanup-903"><span class="linenos">903</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-904"><a href="#AgnoPersonalAgent.cleanup-904"><span class="linenos">904</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared model manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-905"><a href="#AgnoPersonalAgent.cleanup-905"><span class="linenos">905</span></a>                
</span><span id="AgnoPersonalAgent.cleanup-906"><a href="#AgnoPersonalAgent.cleanup-906"><span class="linenos">906</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-907"><a href="#AgnoPersonalAgent.cleanup-907"><span class="linenos">907</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-908"><a href="#AgnoPersonalAgent.cleanup-908"><span class="linenos">908</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared instruction manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-909"><a href="#AgnoPersonalAgent.cleanup-909"><span class="linenos">909</span></a>                
</span><span id="AgnoPersonalAgent.cleanup-910"><a href="#AgnoPersonalAgent.cleanup-910"><span class="linenos">910</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-911"><a href="#AgnoPersonalAgent.cleanup-911"><span class="linenos">911</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-912"><a href="#AgnoPersonalAgent.cleanup-912"><span class="linenos">912</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared memory manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-913"><a href="#AgnoPersonalAgent.cleanup-913"><span class="linenos">913</span></a>                
</span><span id="AgnoPersonalAgent.cleanup-914"><a href="#AgnoPersonalAgent.cleanup-914"><span class="linenos">914</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-915"><a href="#AgnoPersonalAgent.cleanup-915"><span class="linenos">915</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-916"><a href="#AgnoPersonalAgent.cleanup-916"><span class="linenos">916</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-917"><a href="#AgnoPersonalAgent.cleanup-917"><span class="linenos">917</span></a>                
</span><span id="AgnoPersonalAgent.cleanup-918"><a href="#AgnoPersonalAgent.cleanup-918"><span class="linenos">918</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_manager</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-919"><a href="#AgnoPersonalAgent.cleanup-919"><span class="linenos">919</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.cleanup-920"><a href="#AgnoPersonalAgent.cleanup-920"><span class="linenos">920</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared tool manager reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-921"><a href="#AgnoPersonalAgent.cleanup-921"><span class="linenos">921</span></a>            
</span><span id="AgnoPersonalAgent.cleanup-922"><a href="#AgnoPersonalAgent.cleanup-922"><span class="linenos">922</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;AgnoPersonalAgent cleanup completed successfully&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.cleanup-923"><a href="#AgnoPersonalAgent.cleanup-923"><span class="linenos">923</span></a>            
</span><span id="AgnoPersonalAgent.cleanup-924"><a href="#AgnoPersonalAgent.cleanup-924"><span class="linenos">924</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.cleanup-925"><a href="#AgnoPersonalAgent.cleanup-925"><span class="linenos">925</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error during AgnoPersonalAgent cleanup: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Clean up resources when the agent is being shut down.</p>

<p>This method is called during application shutdown to properly
clean up any resources, connections, or background tasks.</p>
</div>


                            </div>
                            <div id="AgnoPersonalAgent.sync_cleanup" class="classattr">
                                        <input id="AgnoPersonalAgent.sync_cleanup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sync_cleanup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="AgnoPersonalAgent.sync_cleanup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgnoPersonalAgent.sync_cleanup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgnoPersonalAgent.sync_cleanup-927"><a href="#AgnoPersonalAgent.sync_cleanup-927"><span class="linenos">927</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sync_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-928"><a href="#AgnoPersonalAgent.sync_cleanup-928"><span class="linenos">928</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Synchronous cleanup method for compatibility.</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-929"><a href="#AgnoPersonalAgent.sync_cleanup-929"><span class="linenos">929</span></a><span class="sd">        </span>
</span><span id="AgnoPersonalAgent.sync_cleanup-930"><a href="#AgnoPersonalAgent.sync_cleanup-930"><span class="linenos">930</span></a><span class="sd">        This method provides a synchronous interface to cleanup for cases</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-931"><a href="#AgnoPersonalAgent.sync_cleanup-931"><span class="linenos">931</span></a><span class="sd">        where async cleanup cannot be used.</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-932"><a href="#AgnoPersonalAgent.sync_cleanup-932"><span class="linenos">932</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-933"><a href="#AgnoPersonalAgent.sync_cleanup-933"><span class="linenos">933</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-934"><a href="#AgnoPersonalAgent.sync_cleanup-934"><span class="linenos">934</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running synchronous cleanup...&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-935"><a href="#AgnoPersonalAgent.sync_cleanup-935"><span class="linenos">935</span></a>            
</span><span id="AgnoPersonalAgent.sync_cleanup-936"><a href="#AgnoPersonalAgent.sync_cleanup-936"><span class="linenos">936</span></a>            <span class="c1"># Clean up agent resources without async calls</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-937"><a href="#AgnoPersonalAgent.sync_cleanup-937"><span class="linenos">937</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-938"><a href="#AgnoPersonalAgent.sync_cleanup-938"><span class="linenos">938</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-939"><a href="#AgnoPersonalAgent.sync_cleanup-939"><span class="linenos">939</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared agent reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-940"><a href="#AgnoPersonalAgent.sync_cleanup-940"><span class="linenos">940</span></a>            
</span><span id="AgnoPersonalAgent.sync_cleanup-941"><a href="#AgnoPersonalAgent.sync_cleanup-941"><span class="linenos">941</span></a>            <span class="c1"># Clean up storage references</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-942"><a href="#AgnoPersonalAgent.sync_cleanup-942"><span class="linenos">942</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-943"><a href="#AgnoPersonalAgent.sync_cleanup-943"><span class="linenos">943</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_storage</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-944"><a href="#AgnoPersonalAgent.sync_cleanup-944"><span class="linenos">944</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared storage reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-945"><a href="#AgnoPersonalAgent.sync_cleanup-945"><span class="linenos">945</span></a>                
</span><span id="AgnoPersonalAgent.sync_cleanup-946"><a href="#AgnoPersonalAgent.sync_cleanup-946"><span class="linenos">946</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-947"><a href="#AgnoPersonalAgent.sync_cleanup-947"><span class="linenos">947</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-948"><a href="#AgnoPersonalAgent.sync_cleanup-948"><span class="linenos">948</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-949"><a href="#AgnoPersonalAgent.sync_cleanup-949"><span class="linenos">949</span></a>                
</span><span id="AgnoPersonalAgent.sync_cleanup-950"><a href="#AgnoPersonalAgent.sync_cleanup-950"><span class="linenos">950</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-951"><a href="#AgnoPersonalAgent.sync_cleanup-951"><span class="linenos">951</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-952"><a href="#AgnoPersonalAgent.sync_cleanup-952"><span class="linenos">952</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared memory reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-953"><a href="#AgnoPersonalAgent.sync_cleanup-953"><span class="linenos">953</span></a>                
</span><span id="AgnoPersonalAgent.sync_cleanup-954"><a href="#AgnoPersonalAgent.sync_cleanup-954"><span class="linenos">954</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-955"><a href="#AgnoPersonalAgent.sync_cleanup-955"><span class="linenos">955</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-956"><a href="#AgnoPersonalAgent.sync_cleanup-956"><span class="linenos">956</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleared knowledge coordinator reference&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-957"><a href="#AgnoPersonalAgent.sync_cleanup-957"><span class="linenos">957</span></a>            
</span><span id="AgnoPersonalAgent.sync_cleanup-958"><a href="#AgnoPersonalAgent.sync_cleanup-958"><span class="linenos">958</span></a>            <span class="c1"># Clean up manager references</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-959"><a href="#AgnoPersonalAgent.sync_cleanup-959"><span class="linenos">959</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-960"><a href="#AgnoPersonalAgent.sync_cleanup-960"><span class="linenos">960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">instruction_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-961"><a href="#AgnoPersonalAgent.sync_cleanup-961"><span class="linenos">961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-962"><a href="#AgnoPersonalAgent.sync_cleanup-962"><span class="linenos">962</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-963"><a href="#AgnoPersonalAgent.sync_cleanup-963"><span class="linenos">963</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tool_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-964"><a href="#AgnoPersonalAgent.sync_cleanup-964"><span class="linenos">964</span></a>            
</span><span id="AgnoPersonalAgent.sync_cleanup-965"><a href="#AgnoPersonalAgent.sync_cleanup-965"><span class="linenos">965</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Synchronous cleanup completed successfully&quot;</span><span class="p">)</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-966"><a href="#AgnoPersonalAgent.sync_cleanup-966"><span class="linenos">966</span></a>            
</span><span id="AgnoPersonalAgent.sync_cleanup-967"><a href="#AgnoPersonalAgent.sync_cleanup-967"><span class="linenos">967</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgnoPersonalAgent.sync_cleanup-968"><a href="#AgnoPersonalAgent.sync_cleanup-968"><span class="linenos">968</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error during synchronous cleanup: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Synchronous cleanup method for compatibility.</p>

<p>This method provides a synchronous interface to cleanup for cases
where async cleanup cannot be used.</p>
</div>


                            </div>
                </section>
                <section id="create_agno_agent">
                            <input id="create_agno_agent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">create_agno_agent</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ollama&#39;</span>,</span><span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;qwen3:1.7b&#39;</span>,</span><span class="param">	<span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">enable_mcp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/Shared/personal_agent_data/agno/Eric&#39;</span>,</span><span class="param">	<span class="n">knowledge_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/Shared/personal_agent_data/agno/Eric/knowledge&#39;</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">ollama_base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;http://tesla.local:11434&#39;</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Eric&#39;</span>,</span><span class="param">	<span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">instruction_level</span><span class="p">:</span> <span class="n">personal_agent</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">agent_instruction_manager</span><span class="o">.</span><span class="n">InstructionLevel</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">InstructionLevel</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span></span><span class="return-annotation">) -> <span class="n"><a href="#AgnoPersonalAgent">AgnoPersonalAgent</a></span>:</span></span>

                <label class="view-source-button" for="create_agno_agent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_agno_agent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_agno_agent-1050"><a href="#create_agno_agent-1050"><span class="linenos">1050</span></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_agno_agent</span><span class="p">(</span>
</span><span id="create_agno_agent-1051"><a href="#create_agno_agent-1051"><span class="linenos">1051</span></a>    <span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ollama&quot;</span><span class="p">,</span>
</span><span id="create_agno_agent-1052"><a href="#create_agno_agent-1052"><span class="linenos">1052</span></a>    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">LLM_MODEL</span><span class="p">,</span>
</span><span id="create_agno_agent-1053"><a href="#create_agno_agent-1053"><span class="linenos">1053</span></a>    <span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="create_agno_agent-1054"><a href="#create_agno_agent-1054"><span class="linenos">1054</span></a>    <span class="n">enable_mcp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="create_agno_agent-1055"><a href="#create_agno_agent-1055"><span class="linenos">1055</span></a>    <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AGNO_STORAGE_DIR</span><span class="p">,</span>
</span><span id="create_agno_agent-1056"><a href="#create_agno_agent-1056"><span class="linenos">1056</span></a>    <span class="n">knowledge_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">,</span>
</span><span id="create_agno_agent-1057"><a href="#create_agno_agent-1057"><span class="linenos">1057</span></a>    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="create_agno_agent-1058"><a href="#create_agno_agent-1058"><span class="linenos">1058</span></a>    <span class="n">ollama_base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OLLAMA_URL</span><span class="p">,</span>
</span><span id="create_agno_agent-1059"><a href="#create_agno_agent-1059"><span class="linenos">1059</span></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">USER_ID</span><span class="p">,</span>
</span><span id="create_agno_agent-1060"><a href="#create_agno_agent-1060"><span class="linenos">1060</span></a>    <span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="create_agno_agent-1061"><a href="#create_agno_agent-1061"><span class="linenos">1061</span></a>    <span class="n">instruction_level</span><span class="p">:</span> <span class="n">InstructionLevel</span> <span class="o">=</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">,</span>
</span><span id="create_agno_agent-1062"><a href="#create_agno_agent-1062"><span class="linenos">1062</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgnoPersonalAgent</span><span class="p">:</span>
</span><span id="create_agno_agent-1063"><a href="#create_agno_agent-1063"><span class="linenos">1063</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and initialize an agno-based personal agent.</span>
</span><span id="create_agno_agent-1064"><a href="#create_agno_agent-1064"><span class="linenos">1064</span></a>
</span><span id="create_agno_agent-1065"><a href="#create_agno_agent-1065"><span class="linenos">1065</span></a><span class="sd">    Args:</span>
</span><span id="create_agno_agent-1066"><a href="#create_agno_agent-1066"><span class="linenos">1066</span></a><span class="sd">        model_provider: LLM provider (&#39;ollama&#39; or &#39;openai&#39;)</span>
</span><span id="create_agno_agent-1067"><a href="#create_agno_agent-1067"><span class="linenos">1067</span></a><span class="sd">        model_name: Model name to use</span>
</span><span id="create_agno_agent-1068"><a href="#create_agno_agent-1068"><span class="linenos">1068</span></a><span class="sd">        enable_memory: Whether to enable memory and knowledge features</span>
</span><span id="create_agno_agent-1069"><a href="#create_agno_agent-1069"><span class="linenos">1069</span></a><span class="sd">        enable_mcp: Whether to enable MCP tool integration</span>
</span><span id="create_agno_agent-1070"><a href="#create_agno_agent-1070"><span class="linenos">1070</span></a><span class="sd">        storage_dir: Directory for Agno storage files</span>
</span><span id="create_agno_agent-1071"><a href="#create_agno_agent-1071"><span class="linenos">1071</span></a><span class="sd">        knowledge_dir: Directory containing knowledge files to load</span>
</span><span id="create_agno_agent-1072"><a href="#create_agno_agent-1072"><span class="linenos">1072</span></a><span class="sd">        debug: Enable debug mode</span>
</span><span id="create_agno_agent-1073"><a href="#create_agno_agent-1073"><span class="linenos">1073</span></a><span class="sd">        ollama_base_url: Base URL for Ollama API</span>
</span><span id="create_agno_agent-1074"><a href="#create_agno_agent-1074"><span class="linenos">1074</span></a><span class="sd">        user_id: User identifier for memory operations</span>
</span><span id="create_agno_agent-1075"><a href="#create_agno_agent-1075"><span class="linenos">1075</span></a><span class="sd">        recreate: Whether to recreate knowledge bases</span>
</span><span id="create_agno_agent-1076"><a href="#create_agno_agent-1076"><span class="linenos">1076</span></a><span class="sd">        instruction_level: The sophistication level for agent instructions</span>
</span><span id="create_agno_agent-1077"><a href="#create_agno_agent-1077"><span class="linenos">1077</span></a><span class="sd">        </span>
</span><span id="create_agno_agent-1078"><a href="#create_agno_agent-1078"><span class="linenos">1078</span></a><span class="sd">    Returns:</span>
</span><span id="create_agno_agent-1079"><a href="#create_agno_agent-1079"><span class="linenos">1079</span></a><span class="sd">        Initialized agent instance</span>
</span><span id="create_agno_agent-1080"><a href="#create_agno_agent-1080"><span class="linenos">1080</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_agno_agent-1081"><a href="#create_agno_agent-1081"><span class="linenos">1081</span></a>    <span class="n">agent</span> <span class="o">=</span> <span class="n">AgnoPersonalAgent</span><span class="p">(</span>
</span><span id="create_agno_agent-1082"><a href="#create_agno_agent-1082"><span class="linenos">1082</span></a>        <span class="n">model_provider</span><span class="o">=</span><span class="n">model_provider</span><span class="p">,</span>
</span><span id="create_agno_agent-1083"><a href="#create_agno_agent-1083"><span class="linenos">1083</span></a>        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
</span><span id="create_agno_agent-1084"><a href="#create_agno_agent-1084"><span class="linenos">1084</span></a>        <span class="n">enable_memory</span><span class="o">=</span><span class="n">enable_memory</span><span class="p">,</span>
</span><span id="create_agno_agent-1085"><a href="#create_agno_agent-1085"><span class="linenos">1085</span></a>        <span class="n">enable_mcp</span><span class="o">=</span><span class="n">enable_mcp</span><span class="p">,</span>
</span><span id="create_agno_agent-1086"><a href="#create_agno_agent-1086"><span class="linenos">1086</span></a>        <span class="n">storage_dir</span><span class="o">=</span><span class="n">storage_dir</span><span class="p">,</span>
</span><span id="create_agno_agent-1087"><a href="#create_agno_agent-1087"><span class="linenos">1087</span></a>        <span class="n">knowledge_dir</span><span class="o">=</span><span class="n">knowledge_dir</span><span class="p">,</span>
</span><span id="create_agno_agent-1088"><a href="#create_agno_agent-1088"><span class="linenos">1088</span></a>        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="create_agno_agent-1089"><a href="#create_agno_agent-1089"><span class="linenos">1089</span></a>        <span class="n">ollama_base_url</span><span class="o">=</span><span class="n">ollama_base_url</span><span class="p">,</span>
</span><span id="create_agno_agent-1090"><a href="#create_agno_agent-1090"><span class="linenos">1090</span></a>        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="create_agno_agent-1091"><a href="#create_agno_agent-1091"><span class="linenos">1091</span></a>        <span class="n">recreate</span><span class="o">=</span><span class="n">recreate</span><span class="p">,</span>
</span><span id="create_agno_agent-1092"><a href="#create_agno_agent-1092"><span class="linenos">1092</span></a>        <span class="n">instruction_level</span><span class="o">=</span><span class="n">instruction_level</span><span class="p">,</span>
</span><span id="create_agno_agent-1093"><a href="#create_agno_agent-1093"><span class="linenos">1093</span></a>    <span class="p">)</span>
</span><span id="create_agno_agent-1094"><a href="#create_agno_agent-1094"><span class="linenos">1094</span></a>
</span><span id="create_agno_agent-1095"><a href="#create_agno_agent-1095"><span class="linenos">1095</span></a>    <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">recreate</span><span class="o">=</span><span class="n">recreate</span><span class="p">)</span>
</span><span id="create_agno_agent-1096"><a href="#create_agno_agent-1096"><span class="linenos">1096</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
</span><span id="create_agno_agent-1097"><a href="#create_agno_agent-1097"><span class="linenos">1097</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to initialize agno agent&quot;</span><span class="p">)</span>
</span><span id="create_agno_agent-1098"><a href="#create_agno_agent-1098"><span class="linenos">1098</span></a>
</span><span id="create_agno_agent-1099"><a href="#create_agno_agent-1099"><span class="linenos">1099</span></a>    <span class="k">return</span> <span class="n">agent</span>
</span></pre></div>


            <div class="docstring"><p>Create and initialize an agno-based personal agent.</p>

<p>Args:
    model_provider: LLM provider ('ollama' or 'openai')
    model_name: Model name to use
    enable_memory: Whether to enable memory and knowledge features
    enable_mcp: Whether to enable MCP tool integration
    storage_dir: Directory for Agno storage files
    knowledge_dir: Directory containing knowledge files to load
    debug: Enable debug mode
    ollama_base_url: Base URL for Ollama API
    user_id: User identifier for memory operations
    recreate: Whether to recreate knowledge bases
    instruction_level: The sophistication level for agent instructions</p>

<p>Returns:
    Initialized agent instance</p>
</div>


                </section>
                <section id="create_simple_personal_agent">
                            <input id="create_simple_personal_agent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_simple_personal_agent</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">knowledge_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ollama&#39;</span>,</span><span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;qwen3:1.7b&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="create_simple_personal_agent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_simple_personal_agent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_simple_personal_agent-971"><a href="#create_simple_personal_agent-971"><span class="linenos"> 971</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_simple_personal_agent</span><span class="p">(</span>
</span><span id="create_simple_personal_agent-972"><a href="#create_simple_personal_agent-972"><span class="linenos"> 972</span></a>    <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-973"><a href="#create_simple_personal_agent-973"><span class="linenos"> 973</span></a>    <span class="n">knowledge_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-974"><a href="#create_simple_personal_agent-974"><span class="linenos"> 974</span></a>    <span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ollama&quot;</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-975"><a href="#create_simple_personal_agent-975"><span class="linenos"> 975</span></a>    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">LLM_MODEL</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-976"><a href="#create_simple_personal_agent-976"><span class="linenos"> 976</span></a><span class="p">):</span>
</span><span id="create_simple_personal_agent-977"><a href="#create_simple_personal_agent-977"><span class="linenos"> 977</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a simple personal agent following the working pattern from knowledge_agent_example.py</span>
</span><span id="create_simple_personal_agent-978"><a href="#create_simple_personal_agent-978"><span class="linenos"> 978</span></a>
</span><span id="create_simple_personal_agent-979"><a href="#create_simple_personal_agent-979"><span class="linenos"> 979</span></a><span class="sd">    This function creates an agent with knowledge base integration using the simple</span>
</span><span id="create_simple_personal_agent-980"><a href="#create_simple_personal_agent-980"><span class="linenos"> 980</span></a><span class="sd">    pattern that avoids async initialization complexity.</span>
</span><span id="create_simple_personal_agent-981"><a href="#create_simple_personal_agent-981"><span class="linenos"> 981</span></a>
</span><span id="create_simple_personal_agent-982"><a href="#create_simple_personal_agent-982"><span class="linenos"> 982</span></a><span class="sd">    Args:</span>
</span><span id="create_simple_personal_agent-983"><a href="#create_simple_personal_agent-983"><span class="linenos"> 983</span></a><span class="sd">        storage_dir: Directory for storage files (defaults to DATA_DIR/agno)</span>
</span><span id="create_simple_personal_agent-984"><a href="#create_simple_personal_agent-984"><span class="linenos"> 984</span></a><span class="sd">        knowledge_dir: Directory containing knowledge files (defaults to DATA_DIR/knowledge)</span>
</span><span id="create_simple_personal_agent-985"><a href="#create_simple_personal_agent-985"><span class="linenos"> 985</span></a><span class="sd">        model_provider: LLM provider (&#39;ollama&#39; or &#39;openai&#39;)</span>
</span><span id="create_simple_personal_agent-986"><a href="#create_simple_personal_agent-986"><span class="linenos"> 986</span></a><span class="sd">        model_name: Model name to use</span>
</span><span id="create_simple_personal_agent-987"><a href="#create_simple_personal_agent-987"><span class="linenos"> 987</span></a><span class="sd">        </span>
</span><span id="create_simple_personal_agent-988"><a href="#create_simple_personal_agent-988"><span class="linenos"> 988</span></a><span class="sd">    Returns:</span>
</span><span id="create_simple_personal_agent-989"><a href="#create_simple_personal_agent-989"><span class="linenos"> 989</span></a><span class="sd">        Tuple of (Agent instance, knowledge_base) or (Agent, None) if no knowledge</span>
</span><span id="create_simple_personal_agent-990"><a href="#create_simple_personal_agent-990"><span class="linenos"> 990</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_simple_personal_agent-991"><a href="#create_simple_personal_agent-991"><span class="linenos"> 991</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">agno.knowledge.combined</span><span class="w"> </span><span class="kn">import</span> <span class="n">CombinedKnowledgeBase</span>
</span><span id="create_simple_personal_agent-992"><a href="#create_simple_personal_agent-992"><span class="linenos"> 992</span></a>    
</span><span id="create_simple_personal_agent-993"><a href="#create_simple_personal_agent-993"><span class="linenos"> 993</span></a>    <span class="c1"># Create knowledge base (synchronous creation)</span>
</span><span id="create_simple_personal_agent-994"><a href="#create_simple_personal_agent-994"><span class="linenos"> 994</span></a>    <span class="n">knowledge_base</span> <span class="o">=</span> <span class="n">create_combined_knowledge_base</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">knowledge_dir</span><span class="p">)</span>
</span><span id="create_simple_personal_agent-995"><a href="#create_simple_personal_agent-995"><span class="linenos"> 995</span></a>
</span><span id="create_simple_personal_agent-996"><a href="#create_simple_personal_agent-996"><span class="linenos"> 996</span></a>    <span class="c1"># Create the model</span>
</span><span id="create_simple_personal_agent-997"><a href="#create_simple_personal_agent-997"><span class="linenos"> 997</span></a>    <span class="k">if</span> <span class="n">model_provider</span> <span class="o">==</span> <span class="s2">&quot;openai&quot;</span><span class="p">:</span>
</span><span id="create_simple_personal_agent-998"><a href="#create_simple_personal_agent-998"><span class="linenos"> 998</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">OpenAIChat</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="create_simple_personal_agent-999"><a href="#create_simple_personal_agent-999"><span class="linenos"> 999</span></a>    <span class="k">elif</span> <span class="n">model_provider</span> <span class="o">==</span> <span class="s2">&quot;ollama&quot;</span><span class="p">:</span>
</span><span id="create_simple_personal_agent-1000"><a href="#create_simple_personal_agent-1000"><span class="linenos">1000</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">Ollama</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="create_simple_personal_agent-1001"><a href="#create_simple_personal_agent-1001"><span class="linenos">1001</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="create_simple_personal_agent-1002"><a href="#create_simple_personal_agent-1002"><span class="linenos">1002</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported model provider: </span><span class="si">{</span><span class="n">model_provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="create_simple_personal_agent-1003"><a href="#create_simple_personal_agent-1003"><span class="linenos">1003</span></a>
</span><span id="create_simple_personal_agent-1004"><a href="#create_simple_personal_agent-1004"><span class="linenos">1004</span></a>    <span class="c1"># Create agent with simple pattern</span>
</span><span id="create_simple_personal_agent-1005"><a href="#create_simple_personal_agent-1005"><span class="linenos">1005</span></a>    <span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
</span><span id="create_simple_personal_agent-1006"><a href="#create_simple_personal_agent-1006"><span class="linenos">1006</span></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Personal AI Agent&quot;</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-1007"><a href="#create_simple_personal_agent-1007"><span class="linenos">1007</span></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-1008"><a href="#create_simple_personal_agent-1008"><span class="linenos">1008</span></a>        <span class="n">knowledge</span><span class="o">=</span><span class="n">knowledge_base</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-1009"><a href="#create_simple_personal_agent-1009"><span class="linenos">1009</span></a>        <span class="n">search_knowledge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Enable automatic knowledge search</span>
</span><span id="create_simple_personal_agent-1010"><a href="#create_simple_personal_agent-1010"><span class="linenos">1010</span></a>        <span class="n">show_tool_calls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Show what tools the agent uses</span>
</span><span id="create_simple_personal_agent-1011"><a href="#create_simple_personal_agent-1011"><span class="linenos">1011</span></a>        <span class="n">markdown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Format responses in markdown</span>
</span><span id="create_simple_personal_agent-1012"><a href="#create_simple_personal_agent-1012"><span class="linenos">1012</span></a>        <span class="n">instructions</span><span class="o">=</span><span class="p">[</span>
</span><span id="create_simple_personal_agent-1013"><a href="#create_simple_personal_agent-1013"><span class="linenos">1013</span></a>            <span class="s2">&quot;You are a personal AI assistant with access to the user&#39;s knowledge base.&quot;</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-1014"><a href="#create_simple_personal_agent-1014"><span class="linenos">1014</span></a>            <span class="s2">&quot;Always search your knowledge base when asked about personal information.&quot;</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-1015"><a href="#create_simple_personal_agent-1015"><span class="linenos">1015</span></a>            <span class="s2">&quot;Provide detailed responses based on the information you find.&quot;</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-1016"><a href="#create_simple_personal_agent-1016"><span class="linenos">1016</span></a>            <span class="s2">&quot;If you can&#39;t find specific information, say so clearly.&quot;</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-1017"><a href="#create_simple_personal_agent-1017"><span class="linenos">1017</span></a>            <span class="s2">&quot;Include relevant details from the knowledge base in your responses.&quot;</span><span class="p">,</span>
</span><span id="create_simple_personal_agent-1018"><a href="#create_simple_personal_agent-1018"><span class="linenos">1018</span></a>        <span class="p">],</span>
</span><span id="create_simple_personal_agent-1019"><a href="#create_simple_personal_agent-1019"><span class="linenos">1019</span></a>    <span class="p">)</span>
</span><span id="create_simple_personal_agent-1020"><a href="#create_simple_personal_agent-1020"><span class="linenos">1020</span></a>
</span><span id="create_simple_personal_agent-1021"><a href="#create_simple_personal_agent-1021"><span class="linenos">1021</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;✅ Created simple personal agent&quot;</span><span class="p">)</span>
</span><span id="create_simple_personal_agent-1022"><a href="#create_simple_personal_agent-1022"><span class="linenos">1022</span></a>    <span class="k">if</span> <span class="n">knowledge_base</span><span class="p">:</span>
</span><span id="create_simple_personal_agent-1023"><a href="#create_simple_personal_agent-1023"><span class="linenos">1023</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Knowledge base: Enabled&quot;</span><span class="p">)</span>
</span><span id="create_simple_personal_agent-1024"><a href="#create_simple_personal_agent-1024"><span class="linenos">1024</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Search enabled: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">search_knowledge</span><span class="p">)</span>
</span><span id="create_simple_personal_agent-1025"><a href="#create_simple_personal_agent-1025"><span class="linenos">1025</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="create_simple_personal_agent-1026"><a href="#create_simple_personal_agent-1026"><span class="linenos">1026</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Knowledge base: None (no knowledge files found)&quot;</span><span class="p">)</span>
</span><span id="create_simple_personal_agent-1027"><a href="#create_simple_personal_agent-1027"><span class="linenos">1027</span></a>
</span><span id="create_simple_personal_agent-1028"><a href="#create_simple_personal_agent-1028"><span class="linenos">1028</span></a>    <span class="k">return</span> <span class="n">agent</span><span class="p">,</span> <span class="n">knowledge_base</span>
</span></pre></div>


            <div class="docstring"><p>Create a simple personal agent following the working pattern from knowledge_agent_example.py</p>

<p>This function creates an agent with knowledge base integration using the simple
pattern that avoids async initialization complexity.</p>

<p>Args:
    storage_dir: Directory for storage files (defaults to DATA_DIR/agno)
    knowledge_dir: Directory containing knowledge files (defaults to DATA_DIR/knowledge)
    model_provider: LLM provider ('ollama' or 'openai')
    model_name: Model name to use</p>

<p>Returns:
    Tuple of (Agent instance, knowledge_base) or (Agent, None) if no knowledge</p>
</div>


                </section>
                <section id="load_agent_knowledge">
                            <input id="load_agent_knowledge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">load_agent_knowledge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">knowledge_base</span>, </span><span class="param"><span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="load_agent_knowledge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#load_agent_knowledge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="load_agent_knowledge-1031"><a href="#load_agent_knowledge-1031"><span class="linenos">1031</span></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">load_agent_knowledge</span><span class="p">(</span><span class="n">knowledge_base</span><span class="p">,</span> <span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="load_agent_knowledge-1032"><a href="#load_agent_knowledge-1032"><span class="linenos">1032</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load knowledge base content asynchronously.</span>
</span><span id="load_agent_knowledge-1033"><a href="#load_agent_knowledge-1033"><span class="linenos">1033</span></a>
</span><span id="load_agent_knowledge-1034"><a href="#load_agent_knowledge-1034"><span class="linenos">1034</span></a><span class="sd">    This should be called after creating the agent to load the knowledge content.</span>
</span><span id="load_agent_knowledge-1035"><a href="#load_agent_knowledge-1035"><span class="linenos">1035</span></a>
</span><span id="load_agent_knowledge-1036"><a href="#load_agent_knowledge-1036"><span class="linenos">1036</span></a><span class="sd">    Args:</span>
</span><span id="load_agent_knowledge-1037"><a href="#load_agent_knowledge-1037"><span class="linenos">1037</span></a><span class="sd">        knowledge_base: Knowledge base instance to load</span>
</span><span id="load_agent_knowledge-1038"><a href="#load_agent_knowledge-1038"><span class="linenos">1038</span></a><span class="sd">        recreate: Whether to recreate the knowledge base from scratch</span>
</span><span id="load_agent_knowledge-1039"><a href="#load_agent_knowledge-1039"><span class="linenos">1039</span></a><span class="sd">        </span>
</span><span id="load_agent_knowledge-1040"><a href="#load_agent_knowledge-1040"><span class="linenos">1040</span></a><span class="sd">    Returns:</span>
</span><span id="load_agent_knowledge-1041"><a href="#load_agent_knowledge-1041"><span class="linenos">1041</span></a><span class="sd">        None</span>
</span><span id="load_agent_knowledge-1042"><a href="#load_agent_knowledge-1042"><span class="linenos">1042</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="load_agent_knowledge-1043"><a href="#load_agent_knowledge-1043"><span class="linenos">1043</span></a>    <span class="k">if</span> <span class="n">knowledge_base</span><span class="p">:</span>
</span><span id="load_agent_knowledge-1044"><a href="#load_agent_knowledge-1044"><span class="linenos">1044</span></a>        <span class="k">await</span> <span class="n">load_combined_knowledge_base</span><span class="p">(</span><span class="n">knowledge_base</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="n">recreate</span><span class="p">)</span>
</span><span id="load_agent_knowledge-1045"><a href="#load_agent_knowledge-1045"><span class="linenos">1045</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;✅ Knowledge base loaded successfully&quot;</span><span class="p">)</span>
</span><span id="load_agent_knowledge-1046"><a href="#load_agent_knowledge-1046"><span class="linenos">1046</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="load_agent_knowledge-1047"><a href="#load_agent_knowledge-1047"><span class="linenos">1047</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No knowledge base to load&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load knowledge base content asynchronously.</p>

<p>This should be called after creating the agent to load the knowledge content.</p>

<p>Args:
    knowledge_base: Knowledge base instance to load
    recreate: Whether to recreate the knowledge base from scratch</p>

<p>Returns:
    None</p>
</div>


                </section>
                <section id="SemanticMemoryManager">
                            <input id="SemanticMemoryManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">SemanticMemoryManager</span>:

                <label class="view-source-button" for="SemanticMemoryManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager-299"><a href="#SemanticMemoryManager-299"><span class="linenos"> 299</span></a><span class="nd">@dataclass</span>
</span><span id="SemanticMemoryManager-300"><a href="#SemanticMemoryManager-300"><span class="linenos"> 300</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SemanticMemoryManager</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-301"><a href="#SemanticMemoryManager-301"><span class="linenos"> 301</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-302"><a href="#SemanticMemoryManager-302"><span class="linenos"> 302</span></a><span class="sd">    Semantic Memory Manager that provides LLM-free memory management.</span>
</span><span id="SemanticMemoryManager-303"><a href="#SemanticMemoryManager-303"><span class="linenos"> 303</span></a>
</span><span id="SemanticMemoryManager-304"><a href="#SemanticMemoryManager-304"><span class="linenos"> 304</span></a><span class="sd">    This manager combines the structure of Agno&#39;s MemoryManager with semantic search</span>
</span><span id="SemanticMemoryManager-305"><a href="#SemanticMemoryManager-305"><span class="linenos"> 305</span></a><span class="sd">    and duplicate detection capabilities, without requiring LLM invocation.</span>
</span><span id="SemanticMemoryManager-306"><a href="#SemanticMemoryManager-306"><span class="linenos"> 306</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-307"><a href="#SemanticMemoryManager-307"><span class="linenos"> 307</span></a>
</span><span id="SemanticMemoryManager-308"><a href="#SemanticMemoryManager-308"><span class="linenos"> 308</span></a>    <span class="c1"># Required by Agno Memory class - model attribute</span>
</span><span id="SemanticMemoryManager-309"><a href="#SemanticMemoryManager-309"><span class="linenos"> 309</span></a>    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-310"><a href="#SemanticMemoryManager-310"><span class="linenos"> 310</span></a>
</span><span id="SemanticMemoryManager-311"><a href="#SemanticMemoryManager-311"><span class="linenos"> 311</span></a>    <span class="c1"># Configuration</span>
</span><span id="SemanticMemoryManager-312"><a href="#SemanticMemoryManager-312"><span class="linenos"> 312</span></a>    <span class="n">config</span><span class="p">:</span> <span class="n">SemanticMemoryManagerConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-313"><a href="#SemanticMemoryManager-313"><span class="linenos"> 313</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">SemanticMemoryManagerConfig</span>
</span><span id="SemanticMemoryManager-314"><a href="#SemanticMemoryManager-314"><span class="linenos"> 314</span></a>    <span class="p">)</span>
</span><span id="SemanticMemoryManager-315"><a href="#SemanticMemoryManager-315"><span class="linenos"> 315</span></a>
</span><span id="SemanticMemoryManager-316"><a href="#SemanticMemoryManager-316"><span class="linenos"> 316</span></a>    <span class="c1"># Components</span>
</span><span id="SemanticMemoryManager-317"><a href="#SemanticMemoryManager-317"><span class="linenos"> 317</span></a>    <span class="n">topic_classifier</span><span class="p">:</span> <span class="n">TopicClassifier</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">TopicClassifier</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-318"><a href="#SemanticMemoryManager-318"><span class="linenos"> 318</span></a>    <span class="n">duplicate_detector</span><span class="p">:</span> <span class="n">SemanticDuplicateDetector</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-319"><a href="#SemanticMemoryManager-319"><span class="linenos"> 319</span></a>
</span><span id="SemanticMemoryManager-320"><a href="#SemanticMemoryManager-320"><span class="linenos"> 320</span></a>    <span class="c1"># State tracking</span>
</span><span id="SemanticMemoryManager-321"><a href="#SemanticMemoryManager-321"><span class="linenos"> 321</span></a>    <span class="n">memories_updated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-322"><a href="#SemanticMemoryManager-322"><span class="linenos"> 322</span></a>
</span><span id="SemanticMemoryManager-323"><a href="#SemanticMemoryManager-323"><span class="linenos"> 323</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-324"><a href="#SemanticMemoryManager-324"><span class="linenos"> 324</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-325"><a href="#SemanticMemoryManager-325"><span class="linenos"> 325</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-326"><a href="#SemanticMemoryManager-326"><span class="linenos"> 326</span></a>        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SemanticMemoryManagerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-327"><a href="#SemanticMemoryManager-327"><span class="linenos"> 327</span></a>        <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-328"><a href="#SemanticMemoryManager-328"><span class="linenos"> 328</span></a>        <span class="n">enable_semantic_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-329"><a href="#SemanticMemoryManager-329"><span class="linenos"> 329</span></a>        <span class="n">enable_exact_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-330"><a href="#SemanticMemoryManager-330"><span class="linenos"> 330</span></a>        <span class="n">enable_topic_classification</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-331"><a href="#SemanticMemoryManager-331"><span class="linenos"> 331</span></a>        <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-332"><a href="#SemanticMemoryManager-332"><span class="linenos"> 332</span></a>    <span class="p">):</span>
</span><span id="SemanticMemoryManager-333"><a href="#SemanticMemoryManager-333"><span class="linenos"> 333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Semantic Memory Manager.&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-334"><a href="#SemanticMemoryManager-334"><span class="linenos"> 334</span></a>        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-335"><a href="#SemanticMemoryManager-335"><span class="linenos"> 335</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">SemanticMemoryManagerConfig</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-336"><a href="#SemanticMemoryManager-336"><span class="linenos"> 336</span></a>                <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">similarity_threshold</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-337"><a href="#SemanticMemoryManager-337"><span class="linenos"> 337</span></a>                <span class="n">enable_semantic_dedup</span><span class="o">=</span><span class="n">enable_semantic_dedup</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-338"><a href="#SemanticMemoryManager-338"><span class="linenos"> 338</span></a>                <span class="n">enable_exact_dedup</span><span class="o">=</span><span class="n">enable_exact_dedup</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-339"><a href="#SemanticMemoryManager-339"><span class="linenos"> 339</span></a>                <span class="n">enable_topic_classification</span><span class="o">=</span><span class="n">enable_topic_classification</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-340"><a href="#SemanticMemoryManager-340"><span class="linenos"> 340</span></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-341"><a href="#SemanticMemoryManager-341"><span class="linenos"> 341</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-342"><a href="#SemanticMemoryManager-342"><span class="linenos"> 342</span></a>
</span><span id="SemanticMemoryManager-343"><a href="#SemanticMemoryManager-343"><span class="linenos"> 343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>  <span class="c1"># Required by Agno Memory class</span>
</span><span id="SemanticMemoryManager-344"><a href="#SemanticMemoryManager-344"><span class="linenos"> 344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span><span id="SemanticMemoryManager-345"><a href="#SemanticMemoryManager-345"><span class="linenos"> 345</span></a>
</span><span id="SemanticMemoryManager-346"><a href="#SemanticMemoryManager-346"><span class="linenos"> 346</span></a>        <span class="c1"># Get the correct path to topics.yaml</span>
</span><span id="SemanticMemoryManager-347"><a href="#SemanticMemoryManager-347"><span class="linenos"> 347</span></a>        <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="SemanticMemoryManager-348"><a href="#SemanticMemoryManager-348"><span class="linenos"> 348</span></a>        <span class="n">topics_yaml_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;topics.yaml&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-349"><a href="#SemanticMemoryManager-349"><span class="linenos"> 349</span></a>
</span><span id="SemanticMemoryManager-350"><a href="#SemanticMemoryManager-350"><span class="linenos"> 350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span> <span class="o">=</span> <span class="n">TopicClassifier</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">topics_yaml_path</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-351"><a href="#SemanticMemoryManager-351"><span class="linenos"> 351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_detector</span> <span class="o">=</span> <span class="n">SemanticDuplicateDetector</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-352"><a href="#SemanticMemoryManager-352"><span class="linenos"> 352</span></a>            <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">similarity_threshold</span>
</span><span id="SemanticMemoryManager-353"><a href="#SemanticMemoryManager-353"><span class="linenos"> 353</span></a>        <span class="p">)</span>
</span><span id="SemanticMemoryManager-354"><a href="#SemanticMemoryManager-354"><span class="linenos"> 354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SemanticMemoryManager-355"><a href="#SemanticMemoryManager-355"><span class="linenos"> 355</span></a>
</span><span id="SemanticMemoryManager-356"><a href="#SemanticMemoryManager-356"><span class="linenos"> 356</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-357"><a href="#SemanticMemoryManager-357"><span class="linenos"> 357</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-358"><a href="#SemanticMemoryManager-358"><span class="linenos"> 358</span></a>
</span><span id="SemanticMemoryManager-359"><a href="#SemanticMemoryManager-359"><span class="linenos"> 359</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-360"><a href="#SemanticMemoryManager-360"><span class="linenos"> 360</span></a>            <span class="s2">&quot;Initialized SemanticMemoryManager with similarity_threshold=</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-361"><a href="#SemanticMemoryManager-361"><span class="linenos"> 361</span></a>            <span class="n">config</span><span class="o">.</span><span class="n">similarity_threshold</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-362"><a href="#SemanticMemoryManager-362"><span class="linenos"> 362</span></a>        <span class="p">)</span>
</span><span id="SemanticMemoryManager-363"><a href="#SemanticMemoryManager-363"><span class="linenos"> 363</span></a>
</span><span id="SemanticMemoryManager-364"><a href="#SemanticMemoryManager-364"><span class="linenos"> 364</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_is_exact_duplicate</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-365"><a href="#SemanticMemoryManager-365"><span class="linenos"> 365</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">new_memory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-366"><a href="#SemanticMemoryManager-366"><span class="linenos"> 366</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-367"><a href="#SemanticMemoryManager-367"><span class="linenos"> 367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for exact duplicate memories.&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-368"><a href="#SemanticMemoryManager-368"><span class="linenos"> 368</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_exact_dedup</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-369"><a href="#SemanticMemoryManager-369"><span class="linenos"> 369</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager-370"><a href="#SemanticMemoryManager-370"><span class="linenos"> 370</span></a>
</span><span id="SemanticMemoryManager-371"><a href="#SemanticMemoryManager-371"><span class="linenos"> 371</span></a>        <span class="n">new_memory_clean</span> <span class="o">=</span> <span class="n">new_memory</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-372"><a href="#SemanticMemoryManager-372"><span class="linenos"> 372</span></a>
</span><span id="SemanticMemoryManager-373"><a href="#SemanticMemoryManager-373"><span class="linenos"> 373</span></a>        <span class="k">for</span> <span class="n">existing</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-374"><a href="#SemanticMemoryManager-374"><span class="linenos"> 374</span></a>            <span class="n">existing_clean</span> <span class="o">=</span> <span class="n">existing</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-375"><a href="#SemanticMemoryManager-375"><span class="linenos"> 375</span></a>            <span class="k">if</span> <span class="n">new_memory_clean</span> <span class="o">==</span> <span class="n">existing_clean</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-376"><a href="#SemanticMemoryManager-376"><span class="linenos"> 376</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Exact duplicate found: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">new_memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-377"><a href="#SemanticMemoryManager-377"><span class="linenos"> 377</span></a>                <span class="k">return</span> <span class="n">existing</span>
</span><span id="SemanticMemoryManager-378"><a href="#SemanticMemoryManager-378"><span class="linenos"> 378</span></a>
</span><span id="SemanticMemoryManager-379"><a href="#SemanticMemoryManager-379"><span class="linenos"> 379</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager-380"><a href="#SemanticMemoryManager-380"><span class="linenos"> 380</span></a>
</span><span id="SemanticMemoryManager-381"><a href="#SemanticMemoryManager-381"><span class="linenos"> 381</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_is_semantic_duplicate</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-382"><a href="#SemanticMemoryManager-382"><span class="linenos"> 382</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">new_memory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-383"><a href="#SemanticMemoryManager-383"><span class="linenos"> 383</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-384"><a href="#SemanticMemoryManager-384"><span class="linenos"> 384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for semantic duplicate memories.&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-385"><a href="#SemanticMemoryManager-385"><span class="linenos"> 385</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_semantic_dedup</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-386"><a href="#SemanticMemoryManager-386"><span class="linenos"> 386</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager-387"><a href="#SemanticMemoryManager-387"><span class="linenos"> 387</span></a>
</span><span id="SemanticMemoryManager-388"><a href="#SemanticMemoryManager-388"><span class="linenos"> 388</span></a>        <span class="n">existing_texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">mem</span><span class="o">.</span><span class="n">memory</span> <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-389"><a href="#SemanticMemoryManager-389"><span class="linenos"> 389</span></a>        <span class="n">is_dup</span><span class="p">,</span> <span class="n">best_match</span><span class="p">,</span> <span class="n">similarity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_detector</span><span class="o">.</span><span class="n">is_duplicate</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-390"><a href="#SemanticMemoryManager-390"><span class="linenos"> 390</span></a>            <span class="n">new_memory</span><span class="p">,</span> <span class="n">existing_texts</span>
</span><span id="SemanticMemoryManager-391"><a href="#SemanticMemoryManager-391"><span class="linenos"> 391</span></a>        <span class="p">)</span>
</span><span id="SemanticMemoryManager-392"><a href="#SemanticMemoryManager-392"><span class="linenos"> 392</span></a>
</span><span id="SemanticMemoryManager-393"><a href="#SemanticMemoryManager-393"><span class="linenos"> 393</span></a>        <span class="k">if</span> <span class="n">is_dup</span> <span class="ow">and</span> <span class="n">best_match</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-394"><a href="#SemanticMemoryManager-394"><span class="linenos"> 394</span></a>            <span class="c1"># Find the matching memory object</span>
</span><span id="SemanticMemoryManager-395"><a href="#SemanticMemoryManager-395"><span class="linenos"> 395</span></a>            <span class="k">for</span> <span class="n">existing</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-396"><a href="#SemanticMemoryManager-396"><span class="linenos"> 396</span></a>                <span class="k">if</span> <span class="n">existing</span><span class="o">.</span><span class="n">memory</span> <span class="o">==</span> <span class="n">best_match</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-397"><a href="#SemanticMemoryManager-397"><span class="linenos"> 397</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-398"><a href="#SemanticMemoryManager-398"><span class="linenos"> 398</span></a>                        <span class="s2">&quot;Semantic duplicate found (similarity: </span><span class="si">%.2f</span><span class="s2">): &#39;</span><span class="si">%s</span><span class="s2">&#39; ~ &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-399"><a href="#SemanticMemoryManager-399"><span class="linenos"> 399</span></a>                        <span class="n">similarity</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-400"><a href="#SemanticMemoryManager-400"><span class="linenos"> 400</span></a>                        <span class="n">new_memory</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-401"><a href="#SemanticMemoryManager-401"><span class="linenos"> 401</span></a>                        <span class="n">existing</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-402"><a href="#SemanticMemoryManager-402"><span class="linenos"> 402</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager-403"><a href="#SemanticMemoryManager-403"><span class="linenos"> 403</span></a>                    <span class="k">return</span> <span class="n">existing</span>
</span><span id="SemanticMemoryManager-404"><a href="#SemanticMemoryManager-404"><span class="linenos"> 404</span></a>
</span><span id="SemanticMemoryManager-405"><a href="#SemanticMemoryManager-405"><span class="linenos"> 405</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager-406"><a href="#SemanticMemoryManager-406"><span class="linenos"> 406</span></a>
</span><span id="SemanticMemoryManager-407"><a href="#SemanticMemoryManager-407"><span class="linenos"> 407</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_should_reject_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-408"><a href="#SemanticMemoryManager-408"><span class="linenos"> 408</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">new_memory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-409"><a href="#SemanticMemoryManager-409"><span class="linenos"> 409</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-410"><a href="#SemanticMemoryManager-410"><span class="linenos"> 410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if a memory should be rejected.&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-411"><a href="#SemanticMemoryManager-411"><span class="linenos"> 411</span></a>        <span class="c1"># Check memory length</span>
</span><span id="SemanticMemoryManager-412"><a href="#SemanticMemoryManager-412"><span class="linenos"> 412</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_memory</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_memory_length</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-413"><a href="#SemanticMemoryManager-413"><span class="linenos"> 413</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-414"><a href="#SemanticMemoryManager-414"><span class="linenos"> 414</span></a>                <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-415"><a href="#SemanticMemoryManager-415"><span class="linenos"> 415</span></a>                <span class="sa">f</span><span class="s2">&quot;Memory too long (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_memory</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_memory_length</span><span class="si">}</span><span class="s2"> chars)&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-416"><a href="#SemanticMemoryManager-416"><span class="linenos"> 416</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-417"><a href="#SemanticMemoryManager-417"><span class="linenos"> 417</span></a>
</span><span id="SemanticMemoryManager-418"><a href="#SemanticMemoryManager-418"><span class="linenos"> 418</span></a>        <span class="c1"># Check for exact duplicates</span>
</span><span id="SemanticMemoryManager-419"><a href="#SemanticMemoryManager-419"><span class="linenos"> 419</span></a>        <span class="n">exact_duplicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_exact_duplicate</span><span class="p">(</span><span class="n">new_memory</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-420"><a href="#SemanticMemoryManager-420"><span class="linenos"> 420</span></a>        <span class="k">if</span> <span class="n">exact_duplicate</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-421"><a href="#SemanticMemoryManager-421"><span class="linenos"> 421</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Exact duplicate of: &#39;</span><span class="si">{</span><span class="n">exact_duplicate</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="SemanticMemoryManager-422"><a href="#SemanticMemoryManager-422"><span class="linenos"> 422</span></a>
</span><span id="SemanticMemoryManager-423"><a href="#SemanticMemoryManager-423"><span class="linenos"> 423</span></a>        <span class="c1"># Check for semantic duplicates</span>
</span><span id="SemanticMemoryManager-424"><a href="#SemanticMemoryManager-424"><span class="linenos"> 424</span></a>        <span class="n">semantic_duplicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_semantic_duplicate</span><span class="p">(</span><span class="n">new_memory</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-425"><a href="#SemanticMemoryManager-425"><span class="linenos"> 425</span></a>        <span class="k">if</span> <span class="n">semantic_duplicate</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-426"><a href="#SemanticMemoryManager-426"><span class="linenos"> 426</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Semantic duplicate of: &#39;</span><span class="si">{</span><span class="n">semantic_duplicate</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="SemanticMemoryManager-427"><a href="#SemanticMemoryManager-427"><span class="linenos"> 427</span></a>
</span><span id="SemanticMemoryManager-428"><a href="#SemanticMemoryManager-428"><span class="linenos"> 428</span></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
</span><span id="SemanticMemoryManager-429"><a href="#SemanticMemoryManager-429"><span class="linenos"> 429</span></a>
</span><span id="SemanticMemoryManager-430"><a href="#SemanticMemoryManager-430"><span class="linenos"> 430</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_recent_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-431"><a href="#SemanticMemoryManager-431"><span class="linenos"> 431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get recent memories for duplicate checking.&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-432"><a href="#SemanticMemoryManager-432"><span class="linenos"> 432</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-433"><a href="#SemanticMemoryManager-433"><span class="linenos"> 433</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-434"><a href="#SemanticMemoryManager-434"><span class="linenos"> 434</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">recent_memory_limit</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;desc&quot;</span>
</span><span id="SemanticMemoryManager-435"><a href="#SemanticMemoryManager-435"><span class="linenos"> 435</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-436"><a href="#SemanticMemoryManager-436"><span class="linenos"> 436</span></a>
</span><span id="SemanticMemoryManager-437"><a href="#SemanticMemoryManager-437"><span class="linenos"> 437</span></a>            <span class="n">user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-438"><a href="#SemanticMemoryManager-438"><span class="linenos"> 438</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-439"><a href="#SemanticMemoryManager-439"><span class="linenos"> 439</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-440"><a href="#SemanticMemoryManager-440"><span class="linenos"> 440</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-441"><a href="#SemanticMemoryManager-441"><span class="linenos"> 441</span></a>                        <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-442"><a href="#SemanticMemoryManager-442"><span class="linenos"> 442</span></a>                        <span class="n">user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-443"><a href="#SemanticMemoryManager-443"><span class="linenos"> 443</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-444"><a href="#SemanticMemoryManager-444"><span class="linenos"> 444</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-445"><a href="#SemanticMemoryManager-445"><span class="linenos"> 445</span></a>                            <span class="s2">&quot;Failed to convert memory row to UserMemory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SemanticMemoryManager-446"><a href="#SemanticMemoryManager-446"><span class="linenos"> 446</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager-447"><a href="#SemanticMemoryManager-447"><span class="linenos"> 447</span></a>
</span><span id="SemanticMemoryManager-448"><a href="#SemanticMemoryManager-448"><span class="linenos"> 448</span></a>            <span class="k">return</span> <span class="n">user_memories</span>
</span><span id="SemanticMemoryManager-449"><a href="#SemanticMemoryManager-449"><span class="linenos"> 449</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-450"><a href="#SemanticMemoryManager-450"><span class="linenos"> 450</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving recent memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-451"><a href="#SemanticMemoryManager-451"><span class="linenos"> 451</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-452"><a href="#SemanticMemoryManager-452"><span class="linenos"> 452</span></a>
</span><span id="SemanticMemoryManager-453"><a href="#SemanticMemoryManager-453"><span class="linenos"> 453</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-454"><a href="#SemanticMemoryManager-454"><span class="linenos"> 454</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-455"><a href="#SemanticMemoryManager-455"><span class="linenos"> 455</span></a>        <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-456"><a href="#SemanticMemoryManager-456"><span class="linenos"> 456</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-457"><a href="#SemanticMemoryManager-457"><span class="linenos"> 457</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-458"><a href="#SemanticMemoryManager-458"><span class="linenos"> 458</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-459"><a href="#SemanticMemoryManager-459"><span class="linenos"> 459</span></a>        <span class="n">input_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-460"><a href="#SemanticMemoryManager-460"><span class="linenos"> 460</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryStorageResult</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-461"><a href="#SemanticMemoryManager-461"><span class="linenos"> 461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-462"><a href="#SemanticMemoryManager-462"><span class="linenos"> 462</span></a><span class="sd">        Add a memory with duplicate detection and topic classification.</span>
</span><span id="SemanticMemoryManager-463"><a href="#SemanticMemoryManager-463"><span class="linenos"> 463</span></a>
</span><span id="SemanticMemoryManager-464"><a href="#SemanticMemoryManager-464"><span class="linenos"> 464</span></a><span class="sd">        :param memory_text: The memory text to add</span>
</span><span id="SemanticMemoryManager-465"><a href="#SemanticMemoryManager-465"><span class="linenos"> 465</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-466"><a href="#SemanticMemoryManager-466"><span class="linenos"> 466</span></a><span class="sd">        :param user_id: User ID for the memory</span>
</span><span id="SemanticMemoryManager-467"><a href="#SemanticMemoryManager-467"><span class="linenos"> 467</span></a><span class="sd">        :param topics: Optional list of topics (will be auto-classified if not provided)</span>
</span><span id="SemanticMemoryManager-468"><a href="#SemanticMemoryManager-468"><span class="linenos"> 468</span></a><span class="sd">        :param input_text: Optional input text that generated this memory</span>
</span><span id="SemanticMemoryManager-469"><a href="#SemanticMemoryManager-469"><span class="linenos"> 469</span></a><span class="sd">        :return: MemoryStorageResult with detailed status information</span>
</span><span id="SemanticMemoryManager-470"><a href="#SemanticMemoryManager-470"><span class="linenos"> 470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-471"><a href="#SemanticMemoryManager-471"><span class="linenos"> 471</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager-472"><a href="#SemanticMemoryManager-472"><span class="linenos"> 472</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-473"><a href="#SemanticMemoryManager-473"><span class="linenos"> 473</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-474"><a href="#SemanticMemoryManager-474"><span class="linenos"> 474</span></a>            
</span><span id="SemanticMemoryManager-475"><a href="#SemanticMemoryManager-475"><span class="linenos"> 475</span></a>        <span class="c1"># Validate input</span>
</span><span id="SemanticMemoryManager-476"><a href="#SemanticMemoryManager-476"><span class="linenos"> 476</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">memory_text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">memory_text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="SemanticMemoryManager-477"><a href="#SemanticMemoryManager-477"><span class="linenos"> 477</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-478"><a href="#SemanticMemoryManager-478"><span class="linenos"> 478</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_EMPTY</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-479"><a href="#SemanticMemoryManager-479"><span class="linenos"> 479</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Memory content cannot be empty&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-480"><a href="#SemanticMemoryManager-480"><span class="linenos"> 480</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-481"><a href="#SemanticMemoryManager-481"><span class="linenos"> 481</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SemanticMemoryManager-482"><a href="#SemanticMemoryManager-482"><span class="linenos"> 482</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-483"><a href="#SemanticMemoryManager-483"><span class="linenos"> 483</span></a>
</span><span id="SemanticMemoryManager-484"><a href="#SemanticMemoryManager-484"><span class="linenos"> 484</span></a>        <span class="c1"># Get recent memories for duplicate checking</span>
</span><span id="SemanticMemoryManager-485"><a href="#SemanticMemoryManager-485"><span class="linenos"> 485</span></a>        <span class="n">existing_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_memories</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-486"><a href="#SemanticMemoryManager-486"><span class="linenos"> 486</span></a>
</span><span id="SemanticMemoryManager-487"><a href="#SemanticMemoryManager-487"><span class="linenos"> 487</span></a>        <span class="c1"># Check memory length</span>
</span><span id="SemanticMemoryManager-488"><a href="#SemanticMemoryManager-488"><span class="linenos"> 488</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_memory_length</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-489"><a href="#SemanticMemoryManager-489"><span class="linenos"> 489</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-490"><a href="#SemanticMemoryManager-490"><span class="linenos"> 490</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_TOO_LONG</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-491"><a href="#SemanticMemoryManager-491"><span class="linenos"> 491</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Memory too long (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memory_text</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_memory_length</span><span class="si">}</span><span class="s2"> chars)&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-492"><a href="#SemanticMemoryManager-492"><span class="linenos"> 492</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-493"><a href="#SemanticMemoryManager-493"><span class="linenos"> 493</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SemanticMemoryManager-494"><a href="#SemanticMemoryManager-494"><span class="linenos"> 494</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-495"><a href="#SemanticMemoryManager-495"><span class="linenos"> 495</span></a>
</span><span id="SemanticMemoryManager-496"><a href="#SemanticMemoryManager-496"><span class="linenos"> 496</span></a>        <span class="c1"># Check for exact duplicates</span>
</span><span id="SemanticMemoryManager-497"><a href="#SemanticMemoryManager-497"><span class="linenos"> 497</span></a>        <span class="n">exact_duplicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_exact_duplicate</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-498"><a href="#SemanticMemoryManager-498"><span class="linenos"> 498</span></a>        <span class="k">if</span> <span class="n">exact_duplicate</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-499"><a href="#SemanticMemoryManager-499"><span class="linenos"> 499</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-500"><a href="#SemanticMemoryManager-500"><span class="linenos"> 500</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_EXACT</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-501"><a href="#SemanticMemoryManager-501"><span class="linenos"> 501</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Exact duplicate of: &#39;</span><span class="si">{</span><span class="n">exact_duplicate</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-502"><a href="#SemanticMemoryManager-502"><span class="linenos"> 502</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-503"><a href="#SemanticMemoryManager-503"><span class="linenos"> 503</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-504"><a href="#SemanticMemoryManager-504"><span class="linenos"> 504</span></a>                <span class="n">similarity_score</span><span class="o">=</span><span class="mf">1.0</span>
</span><span id="SemanticMemoryManager-505"><a href="#SemanticMemoryManager-505"><span class="linenos"> 505</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-506"><a href="#SemanticMemoryManager-506"><span class="linenos"> 506</span></a>
</span><span id="SemanticMemoryManager-507"><a href="#SemanticMemoryManager-507"><span class="linenos"> 507</span></a>        <span class="c1"># Check for semantic duplicates</span>
</span><span id="SemanticMemoryManager-508"><a href="#SemanticMemoryManager-508"><span class="linenos"> 508</span></a>        <span class="n">semantic_duplicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_semantic_duplicate</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-509"><a href="#SemanticMemoryManager-509"><span class="linenos"> 509</span></a>        <span class="k">if</span> <span class="n">semantic_duplicate</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-510"><a href="#SemanticMemoryManager-510"><span class="linenos"> 510</span></a>            <span class="c1"># Get similarity score for the duplicate</span>
</span><span id="SemanticMemoryManager-511"><a href="#SemanticMemoryManager-511"><span class="linenos"> 511</span></a>            <span class="n">existing_texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">mem</span><span class="o">.</span><span class="n">memory</span> <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-512"><a href="#SemanticMemoryManager-512"><span class="linenos"> 512</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">similarity_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_detector</span><span class="o">.</span><span class="n">is_duplicate</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">existing_texts</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-513"><a href="#SemanticMemoryManager-513"><span class="linenos"> 513</span></a>            
</span><span id="SemanticMemoryManager-514"><a href="#SemanticMemoryManager-514"><span class="linenos"> 514</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-515"><a href="#SemanticMemoryManager-515"><span class="linenos"> 515</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_SEMANTIC</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-516"><a href="#SemanticMemoryManager-516"><span class="linenos"> 516</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Semantic duplicate of: &#39;</span><span class="si">{</span><span class="n">semantic_duplicate</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-517"><a href="#SemanticMemoryManager-517"><span class="linenos"> 517</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-518"><a href="#SemanticMemoryManager-518"><span class="linenos"> 518</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-519"><a href="#SemanticMemoryManager-519"><span class="linenos"> 519</span></a>                <span class="n">similarity_score</span><span class="o">=</span><span class="n">similarity_score</span>
</span><span id="SemanticMemoryManager-520"><a href="#SemanticMemoryManager-520"><span class="linenos"> 520</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-521"><a href="#SemanticMemoryManager-521"><span class="linenos"> 521</span></a>
</span><span id="SemanticMemoryManager-522"><a href="#SemanticMemoryManager-522"><span class="linenos"> 522</span></a>        <span class="c1"># Auto-classify topics if not provided</span>
</span><span id="SemanticMemoryManager-523"><a href="#SemanticMemoryManager-523"><span class="linenos"> 523</span></a>        <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_topic_classification</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-524"><a href="#SemanticMemoryManager-524"><span class="linenos"> 524</span></a>            <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">memory_text</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-525"><a href="#SemanticMemoryManager-525"><span class="linenos"> 525</span></a>
</span><span id="SemanticMemoryManager-526"><a href="#SemanticMemoryManager-526"><span class="linenos"> 526</span></a>        <span class="c1"># Create the memory</span>
</span><span id="SemanticMemoryManager-527"><a href="#SemanticMemoryManager-527"><span class="linenos"> 527</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-528"><a href="#SemanticMemoryManager-528"><span class="linenos"> 528</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>
</span><span id="SemanticMemoryManager-529"><a href="#SemanticMemoryManager-529"><span class="linenos"> 529</span></a>
</span><span id="SemanticMemoryManager-530"><a href="#SemanticMemoryManager-530"><span class="linenos"> 530</span></a>            <span class="n">memory_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="SemanticMemoryManager-531"><a href="#SemanticMemoryManager-531"><span class="linenos"> 531</span></a>            <span class="n">last_updated</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-532"><a href="#SemanticMemoryManager-532"><span class="linenos"> 532</span></a>
</span><span id="SemanticMemoryManager-533"><a href="#SemanticMemoryManager-533"><span class="linenos"> 533</span></a>            <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-534"><a href="#SemanticMemoryManager-534"><span class="linenos"> 534</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-535"><a href="#SemanticMemoryManager-535"><span class="linenos"> 535</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">memory_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-536"><a href="#SemanticMemoryManager-536"><span class="linenos"> 536</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-537"><a href="#SemanticMemoryManager-537"><span class="linenos"> 537</span></a>                <span class="n">last_updated</span><span class="o">=</span><span class="n">last_updated</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-538"><a href="#SemanticMemoryManager-538"><span class="linenos"> 538</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">input_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-539"><a href="#SemanticMemoryManager-539"><span class="linenos"> 539</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-540"><a href="#SemanticMemoryManager-540"><span class="linenos"> 540</span></a>
</span><span id="SemanticMemoryManager-541"><a href="#SemanticMemoryManager-541"><span class="linenos"> 541</span></a>            <span class="n">memory_row</span> <span class="o">=</span> <span class="n">MemoryRow</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-542"><a href="#SemanticMemoryManager-542"><span class="linenos"> 542</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-543"><a href="#SemanticMemoryManager-543"><span class="linenos"> 543</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-544"><a href="#SemanticMemoryManager-544"><span class="linenos"> 544</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">user_memory</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="SemanticMemoryManager-545"><a href="#SemanticMemoryManager-545"><span class="linenos"> 545</span></a>                <span class="n">last_updated</span><span class="o">=</span><span class="n">last_updated</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-546"><a href="#SemanticMemoryManager-546"><span class="linenos"> 546</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-547"><a href="#SemanticMemoryManager-547"><span class="linenos"> 547</span></a>
</span><span id="SemanticMemoryManager-548"><a href="#SemanticMemoryManager-548"><span class="linenos"> 548</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">upsert_memory</span><span class="p">(</span><span class="n">memory_row</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-549"><a href="#SemanticMemoryManager-549"><span class="linenos"> 549</span></a>
</span><span id="SemanticMemoryManager-550"><a href="#SemanticMemoryManager-550"><span class="linenos"> 550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager-551"><a href="#SemanticMemoryManager-551"><span class="linenos"> 551</span></a>
</span><span id="SemanticMemoryManager-552"><a href="#SemanticMemoryManager-552"><span class="linenos"> 552</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-553"><a href="#SemanticMemoryManager-553"><span class="linenos"> 553</span></a>                <span class="s2">&quot;Added memory for user </span><span class="si">%s</span><span class="s2">: &#39;</span><span class="si">%s</span><span class="s2">&#39; (topics: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-554"><a href="#SemanticMemoryManager-554"><span class="linenos"> 554</span></a>                <span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-555"><a href="#SemanticMemoryManager-555"><span class="linenos"> 555</span></a>                <span class="n">memory_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-556"><a href="#SemanticMemoryManager-556"><span class="linenos"> 556</span></a>                <span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-557"><a href="#SemanticMemoryManager-557"><span class="linenos"> 557</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-558"><a href="#SemanticMemoryManager-558"><span class="linenos"> 558</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-559"><a href="#SemanticMemoryManager-559"><span class="linenos"> 559</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ ACCEPTED: &#39;</span><span class="si">{</span><span class="n">memory_text</span><span class="si">}</span><span class="s2">&#39; (topics: </span><span class="si">{</span><span class="n">topics</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-560"><a href="#SemanticMemoryManager-560"><span class="linenos"> 560</span></a>
</span><span id="SemanticMemoryManager-561"><a href="#SemanticMemoryManager-561"><span class="linenos"> 561</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-562"><a href="#SemanticMemoryManager-562"><span class="linenos"> 562</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-563"><a href="#SemanticMemoryManager-563"><span class="linenos"> 563</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Memory added successfully&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-564"><a href="#SemanticMemoryManager-564"><span class="linenos"> 564</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-565"><a href="#SemanticMemoryManager-565"><span class="linenos"> 565</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-566"><a href="#SemanticMemoryManager-566"><span class="linenos"> 566</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-567"><a href="#SemanticMemoryManager-567"><span class="linenos"> 567</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Will be updated by the caller for dual storage</span>
</span><span id="SemanticMemoryManager-568"><a href="#SemanticMemoryManager-568"><span class="linenos"> 568</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-569"><a href="#SemanticMemoryManager-569"><span class="linenos"> 569</span></a>
</span><span id="SemanticMemoryManager-570"><a href="#SemanticMemoryManager-570"><span class="linenos"> 570</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-571"><a href="#SemanticMemoryManager-571"><span class="linenos"> 571</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error adding memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-572"><a href="#SemanticMemoryManager-572"><span class="linenos"> 572</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-573"><a href="#SemanticMemoryManager-573"><span class="linenos"> 573</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-574"><a href="#SemanticMemoryManager-574"><span class="linenos"> 574</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">STORAGE_ERROR</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-575"><a href="#SemanticMemoryManager-575"><span class="linenos"> 575</span></a>                <span class="n">message</span><span class="o">=</span><span class="n">error_msg</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-576"><a href="#SemanticMemoryManager-576"><span class="linenos"> 576</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-577"><a href="#SemanticMemoryManager-577"><span class="linenos"> 577</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SemanticMemoryManager-578"><a href="#SemanticMemoryManager-578"><span class="linenos"> 578</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-579"><a href="#SemanticMemoryManager-579"><span class="linenos"> 579</span></a>
</span><span id="SemanticMemoryManager-580"><a href="#SemanticMemoryManager-580"><span class="linenos"> 580</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-581"><a href="#SemanticMemoryManager-581"><span class="linenos"> 581</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-582"><a href="#SemanticMemoryManager-582"><span class="linenos"> 582</span></a>        <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-583"><a href="#SemanticMemoryManager-583"><span class="linenos"> 583</span></a>        <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-584"><a href="#SemanticMemoryManager-584"><span class="linenos"> 584</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-585"><a href="#SemanticMemoryManager-585"><span class="linenos"> 585</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-586"><a href="#SemanticMemoryManager-586"><span class="linenos"> 586</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-587"><a href="#SemanticMemoryManager-587"><span class="linenos"> 587</span></a>        <span class="n">input_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-588"><a href="#SemanticMemoryManager-588"><span class="linenos"> 588</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-589"><a href="#SemanticMemoryManager-589"><span class="linenos"> 589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-590"><a href="#SemanticMemoryManager-590"><span class="linenos"> 590</span></a><span class="sd">        Update an existing memory.</span>
</span><span id="SemanticMemoryManager-591"><a href="#SemanticMemoryManager-591"><span class="linenos"> 591</span></a>
</span><span id="SemanticMemoryManager-592"><a href="#SemanticMemoryManager-592"><span class="linenos"> 592</span></a><span class="sd">        :param memory_id: ID of the memory to update</span>
</span><span id="SemanticMemoryManager-593"><a href="#SemanticMemoryManager-593"><span class="linenos"> 593</span></a><span class="sd">        :param memory_text: New memory text</span>
</span><span id="SemanticMemoryManager-594"><a href="#SemanticMemoryManager-594"><span class="linenos"> 594</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-595"><a href="#SemanticMemoryManager-595"><span class="linenos"> 595</span></a><span class="sd">        :param user_id: User ID for the memory</span>
</span><span id="SemanticMemoryManager-596"><a href="#SemanticMemoryManager-596"><span class="linenos"> 596</span></a><span class="sd">        :param topics: Optional list of topics (will be auto-classified if not provided)</span>
</span><span id="SemanticMemoryManager-597"><a href="#SemanticMemoryManager-597"><span class="linenos"> 597</span></a><span class="sd">        :param input_text: Optional input text that generated this memory</span>
</span><span id="SemanticMemoryManager-598"><a href="#SemanticMemoryManager-598"><span class="linenos"> 598</span></a><span class="sd">        :return: Tuple of (success, message)</span>
</span><span id="SemanticMemoryManager-599"><a href="#SemanticMemoryManager-599"><span class="linenos"> 599</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-600"><a href="#SemanticMemoryManager-600"><span class="linenos"> 600</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager-601"><a href="#SemanticMemoryManager-601"><span class="linenos"> 601</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-602"><a href="#SemanticMemoryManager-602"><span class="linenos"> 602</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-603"><a href="#SemanticMemoryManager-603"><span class="linenos"> 603</span></a>            
</span><span id="SemanticMemoryManager-604"><a href="#SemanticMemoryManager-604"><span class="linenos"> 604</span></a>        <span class="c1"># Auto-classify topics if not provided</span>
</span><span id="SemanticMemoryManager-605"><a href="#SemanticMemoryManager-605"><span class="linenos"> 605</span></a>        <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_topic_classification</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-606"><a href="#SemanticMemoryManager-606"><span class="linenos"> 606</span></a>            <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">memory_text</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-607"><a href="#SemanticMemoryManager-607"><span class="linenos"> 607</span></a>
</span><span id="SemanticMemoryManager-608"><a href="#SemanticMemoryManager-608"><span class="linenos"> 608</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-609"><a href="#SemanticMemoryManager-609"><span class="linenos"> 609</span></a>            <span class="n">last_updated</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-610"><a href="#SemanticMemoryManager-610"><span class="linenos"> 610</span></a>
</span><span id="SemanticMemoryManager-611"><a href="#SemanticMemoryManager-611"><span class="linenos"> 611</span></a>            <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-612"><a href="#SemanticMemoryManager-612"><span class="linenos"> 612</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-613"><a href="#SemanticMemoryManager-613"><span class="linenos"> 613</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">memory_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-614"><a href="#SemanticMemoryManager-614"><span class="linenos"> 614</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-615"><a href="#SemanticMemoryManager-615"><span class="linenos"> 615</span></a>                <span class="n">last_updated</span><span class="o">=</span><span class="n">last_updated</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-616"><a href="#SemanticMemoryManager-616"><span class="linenos"> 616</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">input_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-617"><a href="#SemanticMemoryManager-617"><span class="linenos"> 617</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-618"><a href="#SemanticMemoryManager-618"><span class="linenos"> 618</span></a>
</span><span id="SemanticMemoryManager-619"><a href="#SemanticMemoryManager-619"><span class="linenos"> 619</span></a>            <span class="n">memory_row</span> <span class="o">=</span> <span class="n">MemoryRow</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-620"><a href="#SemanticMemoryManager-620"><span class="linenos"> 620</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-621"><a href="#SemanticMemoryManager-621"><span class="linenos"> 621</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-622"><a href="#SemanticMemoryManager-622"><span class="linenos"> 622</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">user_memory</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="SemanticMemoryManager-623"><a href="#SemanticMemoryManager-623"><span class="linenos"> 623</span></a>                <span class="n">last_updated</span><span class="o">=</span><span class="n">last_updated</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-624"><a href="#SemanticMemoryManager-624"><span class="linenos"> 624</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-625"><a href="#SemanticMemoryManager-625"><span class="linenos"> 625</span></a>
</span><span id="SemanticMemoryManager-626"><a href="#SemanticMemoryManager-626"><span class="linenos"> 626</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">upsert_memory</span><span class="p">(</span><span class="n">memory_row</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-627"><a href="#SemanticMemoryManager-627"><span class="linenos"> 627</span></a>
</span><span id="SemanticMemoryManager-628"><a href="#SemanticMemoryManager-628"><span class="linenos"> 628</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager-629"><a href="#SemanticMemoryManager-629"><span class="linenos"> 629</span></a>
</span><span id="SemanticMemoryManager-630"><a href="#SemanticMemoryManager-630"><span class="linenos"> 630</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-631"><a href="#SemanticMemoryManager-631"><span class="linenos"> 631</span></a>                <span class="s2">&quot;Updated memory </span><span class="si">%s</span><span class="s2"> for user </span><span class="si">%s</span><span class="s2">: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_text</span>
</span><span id="SemanticMemoryManager-632"><a href="#SemanticMemoryManager-632"><span class="linenos"> 632</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-633"><a href="#SemanticMemoryManager-633"><span class="linenos"> 633</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-634"><a href="#SemanticMemoryManager-634"><span class="linenos"> 634</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔄 UPDATED: &#39;</span><span class="si">{</span><span class="n">memory_text</span><span class="si">}</span><span class="s2">&#39; (topics: </span><span class="si">{</span><span class="n">topics</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-635"><a href="#SemanticMemoryManager-635"><span class="linenos"> 635</span></a>
</span><span id="SemanticMemoryManager-636"><a href="#SemanticMemoryManager-636"><span class="linenos"> 636</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Memory updated successfully&quot;</span>
</span><span id="SemanticMemoryManager-637"><a href="#SemanticMemoryManager-637"><span class="linenos"> 637</span></a>
</span><span id="SemanticMemoryManager-638"><a href="#SemanticMemoryManager-638"><span class="linenos"> 638</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-639"><a href="#SemanticMemoryManager-639"><span class="linenos"> 639</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error updating memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-640"><a href="#SemanticMemoryManager-640"><span class="linenos"> 640</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-641"><a href="#SemanticMemoryManager-641"><span class="linenos"> 641</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span>
</span><span id="SemanticMemoryManager-642"><a href="#SemanticMemoryManager-642"><span class="linenos"> 642</span></a>
</span><span id="SemanticMemoryManager-643"><a href="#SemanticMemoryManager-643"><span class="linenos"> 643</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-644"><a href="#SemanticMemoryManager-644"><span class="linenos"> 644</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager-645"><a href="#SemanticMemoryManager-645"><span class="linenos"> 645</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-646"><a href="#SemanticMemoryManager-646"><span class="linenos"> 646</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-647"><a href="#SemanticMemoryManager-647"><span class="linenos"> 647</span></a><span class="sd">        Delete a memory.</span>
</span><span id="SemanticMemoryManager-648"><a href="#SemanticMemoryManager-648"><span class="linenos"> 648</span></a>
</span><span id="SemanticMemoryManager-649"><a href="#SemanticMemoryManager-649"><span class="linenos"> 649</span></a><span class="sd">        :param memory_id: ID of the memory to delete</span>
</span><span id="SemanticMemoryManager-650"><a href="#SemanticMemoryManager-650"><span class="linenos"> 650</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-651"><a href="#SemanticMemoryManager-651"><span class="linenos"> 651</span></a><span class="sd">        :param user_id: User ID for the memory</span>
</span><span id="SemanticMemoryManager-652"><a href="#SemanticMemoryManager-652"><span class="linenos"> 652</span></a><span class="sd">        :return: Tuple of (success, message)</span>
</span><span id="SemanticMemoryManager-653"><a href="#SemanticMemoryManager-653"><span class="linenos"> 653</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-654"><a href="#SemanticMemoryManager-654"><span class="linenos"> 654</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-655"><a href="#SemanticMemoryManager-655"><span class="linenos"> 655</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">memory_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-656"><a href="#SemanticMemoryManager-656"><span class="linenos"> 656</span></a>
</span><span id="SemanticMemoryManager-657"><a href="#SemanticMemoryManager-657"><span class="linenos"> 657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager-658"><a href="#SemanticMemoryManager-658"><span class="linenos"> 658</span></a>
</span><span id="SemanticMemoryManager-659"><a href="#SemanticMemoryManager-659"><span class="linenos"> 659</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted memory </span><span class="si">%s</span><span class="s2"> for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-660"><a href="#SemanticMemoryManager-660"><span class="linenos"> 660</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-661"><a href="#SemanticMemoryManager-661"><span class="linenos"> 661</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🗑️ DELETED: </span><span class="si">{</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-662"><a href="#SemanticMemoryManager-662"><span class="linenos"> 662</span></a>
</span><span id="SemanticMemoryManager-663"><a href="#SemanticMemoryManager-663"><span class="linenos"> 663</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Memory deleted successfully&quot;</span>
</span><span id="SemanticMemoryManager-664"><a href="#SemanticMemoryManager-664"><span class="linenos"> 664</span></a>
</span><span id="SemanticMemoryManager-665"><a href="#SemanticMemoryManager-665"><span class="linenos"> 665</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-666"><a href="#SemanticMemoryManager-666"><span class="linenos"> 666</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error deleting memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-667"><a href="#SemanticMemoryManager-667"><span class="linenos"> 667</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-668"><a href="#SemanticMemoryManager-668"><span class="linenos"> 668</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span>
</span><span id="SemanticMemoryManager-669"><a href="#SemanticMemoryManager-669"><span class="linenos"> 669</span></a>
</span><span id="SemanticMemoryManager-670"><a href="#SemanticMemoryManager-670"><span class="linenos"> 670</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_memories_by_topic</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-671"><a href="#SemanticMemoryManager-671"><span class="linenos"> 671</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager-672"><a href="#SemanticMemoryManager-672"><span class="linenos"> 672</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-673"><a href="#SemanticMemoryManager-673"><span class="linenos"> 673</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-674"><a href="#SemanticMemoryManager-674"><span class="linenos"> 674</span></a><span class="sd">        Delete all memories associated with a specific topic or list of topics.</span>
</span><span id="SemanticMemoryManager-675"><a href="#SemanticMemoryManager-675"><span class="linenos"> 675</span></a>
</span><span id="SemanticMemoryManager-676"><a href="#SemanticMemoryManager-676"><span class="linenos"> 676</span></a><span class="sd">        :param topics: A list of topics to delete memories for.</span>
</span><span id="SemanticMemoryManager-677"><a href="#SemanticMemoryManager-677"><span class="linenos"> 677</span></a><span class="sd">        :param db: Memory database instance.</span>
</span><span id="SemanticMemoryManager-678"><a href="#SemanticMemoryManager-678"><span class="linenos"> 678</span></a><span class="sd">        :param user_id: User ID for the memories.</span>
</span><span id="SemanticMemoryManager-679"><a href="#SemanticMemoryManager-679"><span class="linenos"> 679</span></a><span class="sd">        :return: Tuple of (success, message).</span>
</span><span id="SemanticMemoryManager-680"><a href="#SemanticMemoryManager-680"><span class="linenos"> 680</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-681"><a href="#SemanticMemoryManager-681"><span class="linenos"> 681</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager-682"><a href="#SemanticMemoryManager-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-683"><a href="#SemanticMemoryManager-683"><span class="linenos"> 683</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-684"><a href="#SemanticMemoryManager-684"><span class="linenos"> 684</span></a>            
</span><span id="SemanticMemoryManager-685"><a href="#SemanticMemoryManager-685"><span class="linenos"> 685</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-686"><a href="#SemanticMemoryManager-686"><span class="linenos"> 686</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No topics provided for deletion.&quot;</span>
</span><span id="SemanticMemoryManager-687"><a href="#SemanticMemoryManager-687"><span class="linenos"> 687</span></a>
</span><span id="SemanticMemoryManager-688"><a href="#SemanticMemoryManager-688"><span class="linenos"> 688</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-689"><a href="#SemanticMemoryManager-689"><span class="linenos"> 689</span></a>            <span class="c1"># Get all memories for the specified topics</span>
</span><span id="SemanticMemoryManager-690"><a href="#SemanticMemoryManager-690"><span class="linenos"> 690</span></a>            <span class="n">memories_to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memories_by_topic</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-691"><a href="#SemanticMemoryManager-691"><span class="linenos"> 691</span></a>                <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="n">topics</span>
</span><span id="SemanticMemoryManager-692"><a href="#SemanticMemoryManager-692"><span class="linenos"> 692</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-693"><a href="#SemanticMemoryManager-693"><span class="linenos"> 693</span></a>
</span><span id="SemanticMemoryManager-694"><a href="#SemanticMemoryManager-694"><span class="linenos"> 694</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories_to_delete</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-695"><a href="#SemanticMemoryManager-695"><span class="linenos"> 695</span></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-696"><a href="#SemanticMemoryManager-696"><span class="linenos"> 696</span></a>                    <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-697"><a href="#SemanticMemoryManager-697"><span class="linenos"> 697</span></a>                    <span class="sa">f</span><span class="s2">&quot;No memories found for topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-698"><a href="#SemanticMemoryManager-698"><span class="linenos"> 698</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-699"><a href="#SemanticMemoryManager-699"><span class="linenos"> 699</span></a>
</span><span id="SemanticMemoryManager-700"><a href="#SemanticMemoryManager-700"><span class="linenos"> 700</span></a>            <span class="n">deleted_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager-701"><a href="#SemanticMemoryManager-701"><span class="linenos"> 701</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories_to_delete</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-702"><a href="#SemanticMemoryManager-702"><span class="linenos"> 702</span></a>                <span class="n">success</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-703"><a href="#SemanticMemoryManager-703"><span class="linenos"> 703</span></a>                    <span class="n">memory_id</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">memory_id</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span>
</span><span id="SemanticMemoryManager-704"><a href="#SemanticMemoryManager-704"><span class="linenos"> 704</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-705"><a href="#SemanticMemoryManager-705"><span class="linenos"> 705</span></a>                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-706"><a href="#SemanticMemoryManager-706"><span class="linenos"> 706</span></a>                    <span class="n">deleted_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-707"><a href="#SemanticMemoryManager-707"><span class="linenos"> 707</span></a>
</span><span id="SemanticMemoryManager-708"><a href="#SemanticMemoryManager-708"><span class="linenos"> 708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager-709"><a href="#SemanticMemoryManager-709"><span class="linenos"> 709</span></a>
</span><span id="SemanticMemoryManager-710"><a href="#SemanticMemoryManager-710"><span class="linenos"> 710</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-711"><a href="#SemanticMemoryManager-711"><span class="linenos"> 711</span></a>                <span class="s2">&quot;Deleted </span><span class="si">%d</span><span class="s2"> memories for topics &#39;</span><span class="si">%s</span><span class="s2">&#39; for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-712"><a href="#SemanticMemoryManager-712"><span class="linenos"> 712</span></a>                <span class="n">deleted_count</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-713"><a href="#SemanticMemoryManager-713"><span class="linenos"> 713</span></a>                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">),</span>
</span><span id="SemanticMemoryManager-714"><a href="#SemanticMemoryManager-714"><span class="linenos"> 714</span></a>                <span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-715"><a href="#SemanticMemoryManager-715"><span class="linenos"> 715</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-716"><a href="#SemanticMemoryManager-716"><span class="linenos"> 716</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-717"><a href="#SemanticMemoryManager-717"><span class="linenos"> 717</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-718"><a href="#SemanticMemoryManager-718"><span class="linenos"> 718</span></a>                    <span class="sa">f</span><span class="s2">&quot;🗑️ DELETED BY TOPIC: </span><span class="si">{</span><span class="n">deleted_count</span><span class="si">}</span><span class="s2"> memories for topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-719"><a href="#SemanticMemoryManager-719"><span class="linenos"> 719</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-720"><a href="#SemanticMemoryManager-720"><span class="linenos"> 720</span></a>
</span><span id="SemanticMemoryManager-721"><a href="#SemanticMemoryManager-721"><span class="linenos"> 721</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-722"><a href="#SemanticMemoryManager-722"><span class="linenos"> 722</span></a>                <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-723"><a href="#SemanticMemoryManager-723"><span class="linenos"> 723</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully deleted </span><span class="si">{</span><span class="n">deleted_count</span><span class="si">}</span><span class="s2"> memories for topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-724"><a href="#SemanticMemoryManager-724"><span class="linenos"> 724</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-725"><a href="#SemanticMemoryManager-725"><span class="linenos"> 725</span></a>
</span><span id="SemanticMemoryManager-726"><a href="#SemanticMemoryManager-726"><span class="linenos"> 726</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-727"><a href="#SemanticMemoryManager-727"><span class="linenos"> 727</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error deleting memories by topic: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-728"><a href="#SemanticMemoryManager-728"><span class="linenos"> 728</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-729"><a href="#SemanticMemoryManager-729"><span class="linenos"> 729</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span>
</span><span id="SemanticMemoryManager-730"><a href="#SemanticMemoryManager-730"><span class="linenos"> 730</span></a>
</span><span id="SemanticMemoryManager-731"><a href="#SemanticMemoryManager-731"><span class="linenos"> 731</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-732"><a href="#SemanticMemoryManager-732"><span class="linenos"> 732</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-733"><a href="#SemanticMemoryManager-733"><span class="linenos"> 733</span></a><span class="sd">        Clear all memories for a user.</span>
</span><span id="SemanticMemoryManager-734"><a href="#SemanticMemoryManager-734"><span class="linenos"> 734</span></a>
</span><span id="SemanticMemoryManager-735"><a href="#SemanticMemoryManager-735"><span class="linenos"> 735</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-736"><a href="#SemanticMemoryManager-736"><span class="linenos"> 736</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager-737"><a href="#SemanticMemoryManager-737"><span class="linenos"> 737</span></a><span class="sd">        :return: Tuple of (success, message)</span>
</span><span id="SemanticMemoryManager-738"><a href="#SemanticMemoryManager-738"><span class="linenos"> 738</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-739"><a href="#SemanticMemoryManager-739"><span class="linenos"> 739</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager-740"><a href="#SemanticMemoryManager-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-741"><a href="#SemanticMemoryManager-741"><span class="linenos"> 741</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-742"><a href="#SemanticMemoryManager-742"><span class="linenos"> 742</span></a>            
</span><span id="SemanticMemoryManager-743"><a href="#SemanticMemoryManager-743"><span class="linenos"> 743</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-744"><a href="#SemanticMemoryManager-744"><span class="linenos"> 744</span></a>            <span class="c1"># Get all memories for the user first</span>
</span><span id="SemanticMemoryManager-745"><a href="#SemanticMemoryManager-745"><span class="linenos"> 745</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-746"><a href="#SemanticMemoryManager-746"><span class="linenos"> 746</span></a>
</span><span id="SemanticMemoryManager-747"><a href="#SemanticMemoryManager-747"><span class="linenos"> 747</span></a>            <span class="c1"># Delete each memory</span>
</span><span id="SemanticMemoryManager-748"><a href="#SemanticMemoryManager-748"><span class="linenos"> 748</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-749"><a href="#SemanticMemoryManager-749"><span class="linenos"> 749</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-750"><a href="#SemanticMemoryManager-750"><span class="linenos"> 750</span></a>                    <span class="n">db</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-751"><a href="#SemanticMemoryManager-751"><span class="linenos"> 751</span></a>
</span><span id="SemanticMemoryManager-752"><a href="#SemanticMemoryManager-752"><span class="linenos"> 752</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager-753"><a href="#SemanticMemoryManager-753"><span class="linenos"> 753</span></a>
</span><span id="SemanticMemoryManager-754"><a href="#SemanticMemoryManager-754"><span class="linenos"> 754</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-755"><a href="#SemanticMemoryManager-755"><span class="linenos"> 755</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-756"><a href="#SemanticMemoryManager-756"><span class="linenos"> 756</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🧹 CLEARED: All memories for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-757"><a href="#SemanticMemoryManager-757"><span class="linenos"> 757</span></a>
</span><span id="SemanticMemoryManager-758"><a href="#SemanticMemoryManager-758"><span class="linenos"> 758</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cleared </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memory_rows</span><span class="p">)</span><span class="si">}</span><span class="s2"> memories successfully&quot;</span>
</span><span id="SemanticMemoryManager-759"><a href="#SemanticMemoryManager-759"><span class="linenos"> 759</span></a>
</span><span id="SemanticMemoryManager-760"><a href="#SemanticMemoryManager-760"><span class="linenos"> 760</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-761"><a href="#SemanticMemoryManager-761"><span class="linenos"> 761</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error clearing memories: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-762"><a href="#SemanticMemoryManager-762"><span class="linenos"> 762</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-763"><a href="#SemanticMemoryManager-763"><span class="linenos"> 763</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span>
</span><span id="SemanticMemoryManager-764"><a href="#SemanticMemoryManager-764"><span class="linenos"> 764</span></a>
</span><span id="SemanticMemoryManager-765"><a href="#SemanticMemoryManager-765"><span class="linenos"> 765</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-766"><a href="#SemanticMemoryManager-766"><span class="linenos"> 766</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-767"><a href="#SemanticMemoryManager-767"><span class="linenos"> 767</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-768"><a href="#SemanticMemoryManager-768"><span class="linenos"> 768</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-769"><a href="#SemanticMemoryManager-769"><span class="linenos"> 769</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-770"><a href="#SemanticMemoryManager-770"><span class="linenos"> 770</span></a>        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-771"><a href="#SemanticMemoryManager-771"><span class="linenos"> 771</span></a>        <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-772"><a href="#SemanticMemoryManager-772"><span class="linenos"> 772</span></a>        <span class="n">search_topics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-773"><a href="#SemanticMemoryManager-773"><span class="linenos"> 773</span></a>        <span class="n">topic_boost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-774"><a href="#SemanticMemoryManager-774"><span class="linenos"> 774</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
</span><span id="SemanticMemoryManager-775"><a href="#SemanticMemoryManager-775"><span class="linenos"> 775</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-776"><a href="#SemanticMemoryManager-776"><span class="linenos"> 776</span></a><span class="sd">        Search memories using semantic similarity and topic matching with enhanced query expansion.</span>
</span><span id="SemanticMemoryManager-777"><a href="#SemanticMemoryManager-777"><span class="linenos"> 777</span></a>
</span><span id="SemanticMemoryManager-778"><a href="#SemanticMemoryManager-778"><span class="linenos"> 778</span></a><span class="sd">        :param query: Search query</span>
</span><span id="SemanticMemoryManager-779"><a href="#SemanticMemoryManager-779"><span class="linenos"> 779</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-780"><a href="#SemanticMemoryManager-780"><span class="linenos"> 780</span></a><span class="sd">        :param user_id: User ID to search within</span>
</span><span id="SemanticMemoryManager-781"><a href="#SemanticMemoryManager-781"><span class="linenos"> 781</span></a><span class="sd">        :param limit: Maximum number of results</span>
</span><span id="SemanticMemoryManager-782"><a href="#SemanticMemoryManager-782"><span class="linenos"> 782</span></a><span class="sd">        :param similarity_threshold: Minimum similarity threshold for content</span>
</span><span id="SemanticMemoryManager-783"><a href="#SemanticMemoryManager-783"><span class="linenos"> 783</span></a><span class="sd">        :param search_topics: Whether to include topic search (default: True)</span>
</span><span id="SemanticMemoryManager-784"><a href="#SemanticMemoryManager-784"><span class="linenos"> 784</span></a><span class="sd">        :param topic_boost: Score boost for topic matches (default: 0.5)</span>
</span><span id="SemanticMemoryManager-785"><a href="#SemanticMemoryManager-785"><span class="linenos"> 785</span></a><span class="sd">        :return: List of (UserMemory, combined_score) tuples</span>
</span><span id="SemanticMemoryManager-786"><a href="#SemanticMemoryManager-786"><span class="linenos"> 786</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-787"><a href="#SemanticMemoryManager-787"><span class="linenos"> 787</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager-788"><a href="#SemanticMemoryManager-788"><span class="linenos"> 788</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-789"><a href="#SemanticMemoryManager-789"><span class="linenos"> 789</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-790"><a href="#SemanticMemoryManager-790"><span class="linenos"> 790</span></a>            
</span><span id="SemanticMemoryManager-791"><a href="#SemanticMemoryManager-791"><span class="linenos"> 791</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-792"><a href="#SemanticMemoryManager-792"><span class="linenos"> 792</span></a>            <span class="c1"># Enhanced query expansion for better semantic matching</span>
</span><span id="SemanticMemoryManager-793"><a href="#SemanticMemoryManager-793"><span class="linenos"> 793</span></a>            <span class="n">expanded_queries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-794"><a href="#SemanticMemoryManager-794"><span class="linenos"> 794</span></a>
</span><span id="SemanticMemoryManager-795"><a href="#SemanticMemoryManager-795"><span class="linenos"> 795</span></a>            <span class="c1"># Get all memories for the user</span>
</span><span id="SemanticMemoryManager-796"><a href="#SemanticMemoryManager-796"><span class="linenos"> 796</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-797"><a href="#SemanticMemoryManager-797"><span class="linenos"> 797</span></a>
</span><span id="SemanticMemoryManager-798"><a href="#SemanticMemoryManager-798"><span class="linenos"> 798</span></a>            <span class="n">user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-799"><a href="#SemanticMemoryManager-799"><span class="linenos"> 799</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-800"><a href="#SemanticMemoryManager-800"><span class="linenos"> 800</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-801"><a href="#SemanticMemoryManager-801"><span class="linenos"> 801</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-802"><a href="#SemanticMemoryManager-802"><span class="linenos"> 802</span></a>                        <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-803"><a href="#SemanticMemoryManager-803"><span class="linenos"> 803</span></a>                        <span class="n">user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-804"><a href="#SemanticMemoryManager-804"><span class="linenos"> 804</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-805"><a href="#SemanticMemoryManager-805"><span class="linenos"> 805</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-806"><a href="#SemanticMemoryManager-806"><span class="linenos"> 806</span></a>                            <span class="s2">&quot;Failed to convert memory row to UserMemory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SemanticMemoryManager-807"><a href="#SemanticMemoryManager-807"><span class="linenos"> 807</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager-808"><a href="#SemanticMemoryManager-808"><span class="linenos"> 808</span></a>
</span><span id="SemanticMemoryManager-809"><a href="#SemanticMemoryManager-809"><span class="linenos"> 809</span></a>            <span class="c1"># Calculate similarities and topic matches</span>
</span><span id="SemanticMemoryManager-810"><a href="#SemanticMemoryManager-810"><span class="linenos"> 810</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-811"><a href="#SemanticMemoryManager-811"><span class="linenos"> 811</span></a>            <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-812"><a href="#SemanticMemoryManager-812"><span class="linenos"> 812</span></a>
</span><span id="SemanticMemoryManager-813"><a href="#SemanticMemoryManager-813"><span class="linenos"> 813</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">user_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-814"><a href="#SemanticMemoryManager-814"><span class="linenos"> 814</span></a>                <span class="n">max_similarity</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticMemoryManager-815"><a href="#SemanticMemoryManager-815"><span class="linenos"> 815</span></a>                <span class="n">best_query</span> <span class="o">=</span> <span class="n">query</span>
</span><span id="SemanticMemoryManager-816"><a href="#SemanticMemoryManager-816"><span class="linenos"> 816</span></a>
</span><span id="SemanticMemoryManager-817"><a href="#SemanticMemoryManager-817"><span class="linenos"> 817</span></a>                <span class="c1"># Test original query and all expanded queries</span>
</span><span id="SemanticMemoryManager-818"><a href="#SemanticMemoryManager-818"><span class="linenos"> 818</span></a>                <span class="k">for</span> <span class="n">test_query</span> <span class="ow">in</span> <span class="n">expanded_queries</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-819"><a href="#SemanticMemoryManager-819"><span class="linenos"> 819</span></a>                    <span class="n">content_similarity</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-820"><a href="#SemanticMemoryManager-820"><span class="linenos"> 820</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_detector</span><span class="o">.</span><span class="n">_calculate_semantic_similarity</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-821"><a href="#SemanticMemoryManager-821"><span class="linenos"> 821</span></a>                            <span class="n">test_query</span><span class="p">,</span> <span class="n">memory</span><span class="o">.</span><span class="n">memory</span>
</span><span id="SemanticMemoryManager-822"><a href="#SemanticMemoryManager-822"><span class="linenos"> 822</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager-823"><a href="#SemanticMemoryManager-823"><span class="linenos"> 823</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager-824"><a href="#SemanticMemoryManager-824"><span class="linenos"> 824</span></a>                    <span class="k">if</span> <span class="n">content_similarity</span> <span class="o">&gt;</span> <span class="n">max_similarity</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-825"><a href="#SemanticMemoryManager-825"><span class="linenos"> 825</span></a>                        <span class="n">max_similarity</span> <span class="o">=</span> <span class="n">content_similarity</span>
</span><span id="SemanticMemoryManager-826"><a href="#SemanticMemoryManager-826"><span class="linenos"> 826</span></a>                        <span class="n">best_query</span> <span class="o">=</span> <span class="n">test_query</span>
</span><span id="SemanticMemoryManager-827"><a href="#SemanticMemoryManager-827"><span class="linenos"> 827</span></a>
</span><span id="SemanticMemoryManager-828"><a href="#SemanticMemoryManager-828"><span class="linenos"> 828</span></a>                <span class="c1"># Topic matching with enhanced search</span>
</span><span id="SemanticMemoryManager-829"><a href="#SemanticMemoryManager-829"><span class="linenos"> 829</span></a>                <span class="n">topic_score</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticMemoryManager-830"><a href="#SemanticMemoryManager-830"><span class="linenos"> 830</span></a>                <span class="n">topic_matches</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-831"><a href="#SemanticMemoryManager-831"><span class="linenos"> 831</span></a>
</span><span id="SemanticMemoryManager-832"><a href="#SemanticMemoryManager-832"><span class="linenos"> 832</span></a>                <span class="k">if</span> <span class="n">search_topics</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-833"><a href="#SemanticMemoryManager-833"><span class="linenos"> 833</span></a>                    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-834"><a href="#SemanticMemoryManager-834"><span class="linenos"> 834</span></a>                        <span class="c1"># Check original query and expanded queries against topics</span>
</span><span id="SemanticMemoryManager-835"><a href="#SemanticMemoryManager-835"><span class="linenos"> 835</span></a>                        <span class="k">for</span> <span class="n">test_query</span> <span class="ow">in</span> <span class="n">expanded_queries</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-836"><a href="#SemanticMemoryManager-836"><span class="linenos"> 836</span></a>                            <span class="n">test_query_lower</span> <span class="o">=</span> <span class="n">test_query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-837"><a href="#SemanticMemoryManager-837"><span class="linenos"> 837</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-838"><a href="#SemanticMemoryManager-838"><span class="linenos"> 838</span></a>                                <span class="n">test_query_lower</span> <span class="ow">in</span> <span class="n">topic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-839"><a href="#SemanticMemoryManager-839"><span class="linenos"> 839</span></a>                                <span class="ow">or</span> <span class="n">topic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">test_query_lower</span>
</span><span id="SemanticMemoryManager-840"><a href="#SemanticMemoryManager-840"><span class="linenos"> 840</span></a>                            <span class="p">):</span>
</span><span id="SemanticMemoryManager-841"><a href="#SemanticMemoryManager-841"><span class="linenos"> 841</span></a>                                <span class="k">if</span> <span class="n">test_query_lower</span> <span class="o">==</span> <span class="n">topic</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="SemanticMemoryManager-842"><a href="#SemanticMemoryManager-842"><span class="linenos"> 842</span></a>                                    <span class="n">topic_score</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Exact topic match</span>
</span><span id="SemanticMemoryManager-843"><a href="#SemanticMemoryManager-843"><span class="linenos"> 843</span></a>                                    <span class="n">topic_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-844"><a href="#SemanticMemoryManager-844"><span class="linenos"> 844</span></a>                                    <span class="k">break</span>
</span><span id="SemanticMemoryManager-845"><a href="#SemanticMemoryManager-845"><span class="linenos"> 845</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-846"><a href="#SemanticMemoryManager-846"><span class="linenos"> 846</span></a>                                    <span class="n">topic_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-847"><a href="#SemanticMemoryManager-847"><span class="linenos"> 847</span></a>                                        <span class="n">topic_score</span><span class="p">,</span> <span class="mf">0.8</span>
</span><span id="SemanticMemoryManager-848"><a href="#SemanticMemoryManager-848"><span class="linenos"> 848</span></a>                                    <span class="p">)</span>  <span class="c1"># Partial topic match</span>
</span><span id="SemanticMemoryManager-849"><a href="#SemanticMemoryManager-849"><span class="linenos"> 849</span></a>                                    <span class="n">topic_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-850"><a href="#SemanticMemoryManager-850"><span class="linenos"> 850</span></a>
</span><span id="SemanticMemoryManager-851"><a href="#SemanticMemoryManager-851"><span class="linenos"> 851</span></a>                <span class="c1"># Enhanced keyword matching for work-related queries</span>
</span><span id="SemanticMemoryManager-852"><a href="#SemanticMemoryManager-852"><span class="linenos"> 852</span></a>                <span class="n">keyword_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_keyword_score</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-853"><a href="#SemanticMemoryManager-853"><span class="linenos"> 853</span></a>                    <span class="n">expanded_queries</span><span class="p">,</span> <span class="n">memory</span><span class="o">.</span><span class="n">memory</span>
</span><span id="SemanticMemoryManager-854"><a href="#SemanticMemoryManager-854"><span class="linenos"> 854</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-855"><a href="#SemanticMemoryManager-855"><span class="linenos"> 855</span></a>
</span><span id="SemanticMemoryManager-856"><a href="#SemanticMemoryManager-856"><span class="linenos"> 856</span></a>                <span class="c1"># Combined scoring: use the best of content similarity, topic match, or keyword match</span>
</span><span id="SemanticMemoryManager-857"><a href="#SemanticMemoryManager-857"><span class="linenos"> 857</span></a>                <span class="n">final_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-858"><a href="#SemanticMemoryManager-858"><span class="linenos"> 858</span></a>                    <span class="n">max_similarity</span><span class="p">,</span> <span class="n">topic_score</span> <span class="o">*</span> <span class="n">topic_boost</span><span class="p">,</span> <span class="n">keyword_score</span>
</span><span id="SemanticMemoryManager-859"><a href="#SemanticMemoryManager-859"><span class="linenos"> 859</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-860"><a href="#SemanticMemoryManager-860"><span class="linenos"> 860</span></a>
</span><span id="SemanticMemoryManager-861"><a href="#SemanticMemoryManager-861"><span class="linenos"> 861</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-862"><a href="#SemanticMemoryManager-862"><span class="linenos"> 862</span></a>                    <span class="n">final_score</span> <span class="o">&gt;=</span> <span class="n">similarity_threshold</span>
</span><span id="SemanticMemoryManager-863"><a href="#SemanticMemoryManager-863"><span class="linenos"> 863</span></a>                    <span class="ow">or</span> <span class="n">topic_score</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager-864"><a href="#SemanticMemoryManager-864"><span class="linenos"> 864</span></a>                    <span class="ow">or</span> <span class="n">keyword_score</span> <span class="o">&gt;</span> <span class="mf">0.4</span>
</span><span id="SemanticMemoryManager-865"><a href="#SemanticMemoryManager-865"><span class="linenos"> 865</span></a>                <span class="p">):</span>
</span><span id="SemanticMemoryManager-866"><a href="#SemanticMemoryManager-866"><span class="linenos"> 866</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">memory</span><span class="p">,</span> <span class="n">final_score</span><span class="p">))</span>
</span><span id="SemanticMemoryManager-867"><a href="#SemanticMemoryManager-867"><span class="linenos"> 867</span></a>
</span><span id="SemanticMemoryManager-868"><a href="#SemanticMemoryManager-868"><span class="linenos"> 868</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-869"><a href="#SemanticMemoryManager-869"><span class="linenos"> 869</span></a>                        <span class="n">topic_matches</span> <span class="ow">or</span> <span class="n">keyword_score</span> <span class="o">&gt;</span> <span class="mf">0.4</span>
</span><span id="SemanticMemoryManager-870"><a href="#SemanticMemoryManager-870"><span class="linenos"> 870</span></a>                    <span class="p">):</span>
</span><span id="SemanticMemoryManager-871"><a href="#SemanticMemoryManager-871"><span class="linenos"> 871</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-872"><a href="#SemanticMemoryManager-872"><span class="linenos"> 872</span></a>                            <span class="s2">&quot;Enhanced match for query &#39;</span><span class="si">%s</span><span class="s2">&#39;: memory=&#39;</span><span class="si">%s</span><span class="s2">&#39;, topics=</span><span class="si">%s</span><span class="s2">, final_score=</span><span class="si">%.3f</span><span class="s2"> (content=</span><span class="si">%.3f</span><span class="s2">, topic=</span><span class="si">%.3f</span><span class="s2">, keyword=</span><span class="si">%.3f</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-873"><a href="#SemanticMemoryManager-873"><span class="linenos"> 873</span></a>                            <span class="n">query</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-874"><a href="#SemanticMemoryManager-874"><span class="linenos"> 874</span></a>                            <span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-875"><a href="#SemanticMemoryManager-875"><span class="linenos"> 875</span></a>                            <span class="n">topic_matches</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-876"><a href="#SemanticMemoryManager-876"><span class="linenos"> 876</span></a>                            <span class="n">final_score</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-877"><a href="#SemanticMemoryManager-877"><span class="linenos"> 877</span></a>                            <span class="n">max_similarity</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-878"><a href="#SemanticMemoryManager-878"><span class="linenos"> 878</span></a>                            <span class="n">topic_score</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-879"><a href="#SemanticMemoryManager-879"><span class="linenos"> 879</span></a>                            <span class="n">keyword_score</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-880"><a href="#SemanticMemoryManager-880"><span class="linenos"> 880</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager-881"><a href="#SemanticMemoryManager-881"><span class="linenos"> 881</span></a>
</span><span id="SemanticMemoryManager-882"><a href="#SemanticMemoryManager-882"><span class="linenos"> 882</span></a>            <span class="c1"># Sort by combined score (descending) and limit</span>
</span><span id="SemanticMemoryManager-883"><a href="#SemanticMemoryManager-883"><span class="linenos"> 883</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-884"><a href="#SemanticMemoryManager-884"><span class="linenos"> 884</span></a>            <span class="k">return</span> <span class="n">results</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-885"><a href="#SemanticMemoryManager-885"><span class="linenos"> 885</span></a>
</span><span id="SemanticMemoryManager-886"><a href="#SemanticMemoryManager-886"><span class="linenos"> 886</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-887"><a href="#SemanticMemoryManager-887"><span class="linenos"> 887</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error searching memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-888"><a href="#SemanticMemoryManager-888"><span class="linenos"> 888</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-889"><a href="#SemanticMemoryManager-889"><span class="linenos"> 889</span></a>
</span><span id="SemanticMemoryManager-890"><a href="#SemanticMemoryManager-890"><span class="linenos"> 890</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_memories_by_topic</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-891"><a href="#SemanticMemoryManager-891"><span class="linenos"> 891</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-892"><a href="#SemanticMemoryManager-892"><span class="linenos"> 892</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-893"><a href="#SemanticMemoryManager-893"><span class="linenos"> 893</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-894"><a href="#SemanticMemoryManager-894"><span class="linenos"> 894</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-895"><a href="#SemanticMemoryManager-895"><span class="linenos"> 895</span></a>        <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-896"><a href="#SemanticMemoryManager-896"><span class="linenos"> 896</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-897"><a href="#SemanticMemoryManager-897"><span class="linenos"> 897</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-898"><a href="#SemanticMemoryManager-898"><span class="linenos"> 898</span></a><span class="sd">        Get memories filtered by a list of topics, with enhanced topic expansion using the topic classifier.</span>
</span><span id="SemanticMemoryManager-899"><a href="#SemanticMemoryManager-899"><span class="linenos"> 899</span></a>
</span><span id="SemanticMemoryManager-900"><a href="#SemanticMemoryManager-900"><span class="linenos"> 900</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-901"><a href="#SemanticMemoryManager-901"><span class="linenos"> 901</span></a><span class="sd">        :param user_id: User ID to search within</span>
</span><span id="SemanticMemoryManager-902"><a href="#SemanticMemoryManager-902"><span class="linenos"> 902</span></a><span class="sd">        :param topics: Optional list of topics to filter by. If None, returns all memories.</span>
</span><span id="SemanticMemoryManager-903"><a href="#SemanticMemoryManager-903"><span class="linenos"> 903</span></a><span class="sd">        :param limit: Maximum number of results to return</span>
</span><span id="SemanticMemoryManager-904"><a href="#SemanticMemoryManager-904"><span class="linenos"> 904</span></a><span class="sd">        :return: List of UserMemory objects matching the topics.</span>
</span><span id="SemanticMemoryManager-905"><a href="#SemanticMemoryManager-905"><span class="linenos"> 905</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-906"><a href="#SemanticMemoryManager-906"><span class="linenos"> 906</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager-907"><a href="#SemanticMemoryManager-907"><span class="linenos"> 907</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-908"><a href="#SemanticMemoryManager-908"><span class="linenos"> 908</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-909"><a href="#SemanticMemoryManager-909"><span class="linenos"> 909</span></a>            
</span><span id="SemanticMemoryManager-910"><a href="#SemanticMemoryManager-910"><span class="linenos"> 910</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-911"><a href="#SemanticMemoryManager-911"><span class="linenos"> 911</span></a>            <span class="c1"># Get all memories for the user</span>
</span><span id="SemanticMemoryManager-912"><a href="#SemanticMemoryManager-912"><span class="linenos"> 912</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;desc&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-913"><a href="#SemanticMemoryManager-913"><span class="linenos"> 913</span></a>
</span><span id="SemanticMemoryManager-914"><a href="#SemanticMemoryManager-914"><span class="linenos"> 914</span></a>            <span class="n">user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-915"><a href="#SemanticMemoryManager-915"><span class="linenos"> 915</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-916"><a href="#SemanticMemoryManager-916"><span class="linenos"> 916</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-917"><a href="#SemanticMemoryManager-917"><span class="linenos"> 917</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-918"><a href="#SemanticMemoryManager-918"><span class="linenos"> 918</span></a>                        <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-919"><a href="#SemanticMemoryManager-919"><span class="linenos"> 919</span></a>                        <span class="n">user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-920"><a href="#SemanticMemoryManager-920"><span class="linenos"> 920</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-921"><a href="#SemanticMemoryManager-921"><span class="linenos"> 921</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-922"><a href="#SemanticMemoryManager-922"><span class="linenos"> 922</span></a>                            <span class="s2">&quot;Failed to convert memory row to UserMemory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SemanticMemoryManager-923"><a href="#SemanticMemoryManager-923"><span class="linenos"> 923</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager-924"><a href="#SemanticMemoryManager-924"><span class="linenos"> 924</span></a>
</span><span id="SemanticMemoryManager-925"><a href="#SemanticMemoryManager-925"><span class="linenos"> 925</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-926"><a href="#SemanticMemoryManager-926"><span class="linenos"> 926</span></a>                <span class="c1"># If no topics are specified, return all memories up to the limit</span>
</span><span id="SemanticMemoryManager-927"><a href="#SemanticMemoryManager-927"><span class="linenos"> 927</span></a>                <span class="k">return</span> <span class="n">user_memories</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-928"><a href="#SemanticMemoryManager-928"><span class="linenos"> 928</span></a>
</span><span id="SemanticMemoryManager-929"><a href="#SemanticMemoryManager-929"><span class="linenos"> 929</span></a>            <span class="c1"># ENHANCED: Expand topics using the topic classifier</span>
</span><span id="SemanticMemoryManager-930"><a href="#SemanticMemoryManager-930"><span class="linenos"> 930</span></a>            <span class="c1"># This solves the issue where searching for &quot;education&quot; doesn&#39;t find &quot;academic&quot; memories</span>
</span><span id="SemanticMemoryManager-931"><a href="#SemanticMemoryManager-931"><span class="linenos"> 931</span></a>            <span class="n">expanded_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-932"><a href="#SemanticMemoryManager-932"><span class="linenos"> 932</span></a>            
</span><span id="SemanticMemoryManager-933"><a href="#SemanticMemoryManager-933"><span class="linenos"> 933</span></a>            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-934"><a href="#SemanticMemoryManager-934"><span class="linenos"> 934</span></a>                <span class="n">topic_lower</span> <span class="o">=</span> <span class="n">topic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-935"><a href="#SemanticMemoryManager-935"><span class="linenos"> 935</span></a>                <span class="n">expanded_topics</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">topic_lower</span><span class="p">)</span>  <span class="c1"># Add the original topic</span>
</span><span id="SemanticMemoryManager-936"><a href="#SemanticMemoryManager-936"><span class="linenos"> 936</span></a>                
</span><span id="SemanticMemoryManager-937"><a href="#SemanticMemoryManager-937"><span class="linenos"> 937</span></a>                <span class="c1"># Check if this topic appears as a keyword in any category</span>
</span><span id="SemanticMemoryManager-938"><a href="#SemanticMemoryManager-938"><span class="linenos"> 938</span></a>                <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SemanticMemoryManager-939"><a href="#SemanticMemoryManager-939"><span class="linenos"> 939</span></a>                    <span class="k">if</span> <span class="n">topic_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">kw</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-940"><a href="#SemanticMemoryManager-940"><span class="linenos"> 940</span></a>                        <span class="c1"># Add the category name</span>
</span><span id="SemanticMemoryManager-941"><a href="#SemanticMemoryManager-941"><span class="linenos"> 941</span></a>                        <span class="n">expanded_topics</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="SemanticMemoryManager-942"><a href="#SemanticMemoryManager-942"><span class="linenos"> 942</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expanded topic &#39;</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">&#39; to include category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-943"><a href="#SemanticMemoryManager-943"><span class="linenos"> 943</span></a>                        <span class="k">break</span>
</span><span id="SemanticMemoryManager-944"><a href="#SemanticMemoryManager-944"><span class="linenos"> 944</span></a>                
</span><span id="SemanticMemoryManager-945"><a href="#SemanticMemoryManager-945"><span class="linenos"> 945</span></a>                <span class="c1"># Also check if this topic is a category name, and if so, add all its keywords</span>
</span><span id="SemanticMemoryManager-946"><a href="#SemanticMemoryManager-946"><span class="linenos"> 946</span></a>                <span class="k">if</span> <span class="n">topic_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">keys</span><span class="p">()]:</span>
</span><span id="SemanticMemoryManager-947"><a href="#SemanticMemoryManager-947"><span class="linenos"> 947</span></a>                    <span class="c1"># Find the actual category name (with correct case)</span>
</span><span id="SemanticMemoryManager-948"><a href="#SemanticMemoryManager-948"><span class="linenos"> 948</span></a>                    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SemanticMemoryManager-949"><a href="#SemanticMemoryManager-949"><span class="linenos"> 949</span></a>                        <span class="k">if</span> <span class="n">category</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">topic_lower</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-950"><a href="#SemanticMemoryManager-950"><span class="linenos"> 950</span></a>                            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-951"><a href="#SemanticMemoryManager-951"><span class="linenos"> 951</span></a>                                <span class="n">expanded_topics</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="SemanticMemoryManager-952"><a href="#SemanticMemoryManager-952"><span class="linenos"> 952</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expanded category &#39;</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">&#39; to include keywords: </span><span class="si">{</span><span class="n">keywords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-953"><a href="#SemanticMemoryManager-953"><span class="linenos"> 953</span></a>                            <span class="k">break</span>
</span><span id="SemanticMemoryManager-954"><a href="#SemanticMemoryManager-954"><span class="linenos"> 954</span></a>
</span><span id="SemanticMemoryManager-955"><a href="#SemanticMemoryManager-955"><span class="linenos"> 955</span></a>            <span class="c1"># Filter memories by the expanded topics</span>
</span><span id="SemanticMemoryManager-956"><a href="#SemanticMemoryManager-956"><span class="linenos"> 956</span></a>            <span class="n">filtered_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-957"><a href="#SemanticMemoryManager-957"><span class="linenos"> 957</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">user_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-958"><a href="#SemanticMemoryManager-958"><span class="linenos"> 958</span></a>                <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-959"><a href="#SemanticMemoryManager-959"><span class="linenos"> 959</span></a>                    <span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">expanded_topics</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span>
</span><span id="SemanticMemoryManager-960"><a href="#SemanticMemoryManager-960"><span class="linenos"> 960</span></a>                <span class="p">):</span>
</span><span id="SemanticMemoryManager-961"><a href="#SemanticMemoryManager-961"><span class="linenos"> 961</span></a>                    <span class="n">filtered_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-962"><a href="#SemanticMemoryManager-962"><span class="linenos"> 962</span></a>
</span><span id="SemanticMemoryManager-963"><a href="#SemanticMemoryManager-963"><span class="linenos"> 963</span></a>            <span class="c1"># Sort by date (already sorted by read_memories) and limit</span>
</span><span id="SemanticMemoryManager-964"><a href="#SemanticMemoryManager-964"><span class="linenos"> 964</span></a>            <span class="k">return</span> <span class="n">filtered_memories</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-965"><a href="#SemanticMemoryManager-965"><span class="linenos"> 965</span></a>
</span><span id="SemanticMemoryManager-966"><a href="#SemanticMemoryManager-966"><span class="linenos"> 966</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-967"><a href="#SemanticMemoryManager-967"><span class="linenos"> 967</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error getting memories by topic: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-968"><a href="#SemanticMemoryManager-968"><span class="linenos"> 968</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-969"><a href="#SemanticMemoryManager-969"><span class="linenos"> 969</span></a>
</span><span id="SemanticMemoryManager-970"><a href="#SemanticMemoryManager-970"><span class="linenos"> 970</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_expand_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-971"><a href="#SemanticMemoryManager-971"><span class="linenos"> 971</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-972"><a href="#SemanticMemoryManager-972"><span class="linenos"> 972</span></a><span class="sd">        Expand query with synonyms, related terms, and topic classifier mappings for better semantic matching.</span>
</span><span id="SemanticMemoryManager-973"><a href="#SemanticMemoryManager-973"><span class="linenos"> 973</span></a>
</span><span id="SemanticMemoryManager-974"><a href="#SemanticMemoryManager-974"><span class="linenos"> 974</span></a><span class="sd">        :param query: Original search query</span>
</span><span id="SemanticMemoryManager-975"><a href="#SemanticMemoryManager-975"><span class="linenos"> 975</span></a><span class="sd">        :return: List of expanded queries including the original</span>
</span><span id="SemanticMemoryManager-976"><a href="#SemanticMemoryManager-976"><span class="linenos"> 976</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-977"><a href="#SemanticMemoryManager-977"><span class="linenos"> 977</span></a>        <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-978"><a href="#SemanticMemoryManager-978"><span class="linenos"> 978</span></a>        <span class="n">expanded</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="p">]</span>  <span class="c1"># Always include original query</span>
</span><span id="SemanticMemoryManager-979"><a href="#SemanticMemoryManager-979"><span class="linenos"> 979</span></a>
</span><span id="SemanticMemoryManager-980"><a href="#SemanticMemoryManager-980"><span class="linenos"> 980</span></a>        <span class="c1"># NEW: Use topic classifier to find which categories the query keywords belong to</span>
</span><span id="SemanticMemoryManager-981"><a href="#SemanticMemoryManager-981"><span class="linenos"> 981</span></a>        <span class="c1"># This solves the issue where searching for &quot;education&quot; doesn&#39;t find &quot;academic&quot; memories</span>
</span><span id="SemanticMemoryManager-982"><a href="#SemanticMemoryManager-982"><span class="linenos"> 982</span></a>        <span class="n">query_words</span> <span class="o">=</span> <span class="n">query_lower</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-983"><a href="#SemanticMemoryManager-983"><span class="linenos"> 983</span></a>        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">query_words</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-984"><a href="#SemanticMemoryManager-984"><span class="linenos"> 984</span></a>            <span class="c1"># Check if this word appears in any category&#39;s keywords</span>
</span><span id="SemanticMemoryManager-985"><a href="#SemanticMemoryManager-985"><span class="linenos"> 985</span></a>            <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SemanticMemoryManager-986"><a href="#SemanticMemoryManager-986"><span class="linenos"> 986</span></a>                <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="n">kw</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-987"><a href="#SemanticMemoryManager-987"><span class="linenos"> 987</span></a>                    <span class="c1"># Add the category name as an expanded query</span>
</span><span id="SemanticMemoryManager-988"><a href="#SemanticMemoryManager-988"><span class="linenos"> 988</span></a>                    <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expanded</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-989"><a href="#SemanticMemoryManager-989"><span class="linenos"> 989</span></a>                        <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-990"><a href="#SemanticMemoryManager-990"><span class="linenos"> 990</span></a>                    
</span><span id="SemanticMemoryManager-991"><a href="#SemanticMemoryManager-991"><span class="linenos"> 991</span></a>                    <span class="c1"># Also add other keywords from the same category</span>
</span><span id="SemanticMemoryManager-992"><a href="#SemanticMemoryManager-992"><span class="linenos"> 992</span></a>                    <span class="k">for</span> <span class="n">related_keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-993"><a href="#SemanticMemoryManager-993"><span class="linenos"> 993</span></a>                        <span class="n">related_lower</span> <span class="o">=</span> <span class="n">related_keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-994"><a href="#SemanticMemoryManager-994"><span class="linenos"> 994</span></a>                        <span class="k">if</span> <span class="n">related_lower</span> <span class="o">!=</span> <span class="n">word</span> <span class="ow">and</span> <span class="n">related_lower</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expanded</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-995"><a href="#SemanticMemoryManager-995"><span class="linenos"> 995</span></a>                            <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">related_lower</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-996"><a href="#SemanticMemoryManager-996"><span class="linenos"> 996</span></a>                    
</span><span id="SemanticMemoryManager-997"><a href="#SemanticMemoryManager-997"><span class="linenos"> 997</span></a>                    <span class="c1"># Stop after finding the first matching category for this word</span>
</span><span id="SemanticMemoryManager-998"><a href="#SemanticMemoryManager-998"><span class="linenos"> 998</span></a>                    <span class="c1"># (though a word could theoretically be in multiple categories)</span>
</span><span id="SemanticMemoryManager-999"><a href="#SemanticMemoryManager-999"><span class="linenos"> 999</span></a>                    <span class="k">break</span>
</span><span id="SemanticMemoryManager-1000"><a href="#SemanticMemoryManager-1000"><span class="linenos">1000</span></a>            
</span><span id="SemanticMemoryManager-1001"><a href="#SemanticMemoryManager-1001"><span class="linenos">1001</span></a>            <span class="c1"># Also check phrases for more comprehensive matching</span>
</span><span id="SemanticMemoryManager-1002"><a href="#SemanticMemoryManager-1002"><span class="linenos">1002</span></a>            <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">phrases</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">phrases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SemanticMemoryManager-1003"><a href="#SemanticMemoryManager-1003"><span class="linenos">1003</span></a>                <span class="k">for</span> <span class="n">phrase</span> <span class="ow">in</span> <span class="n">phrases</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1004"><a href="#SemanticMemoryManager-1004"><span class="linenos">1004</span></a>                    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">phrase</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="SemanticMemoryManager-1005"><a href="#SemanticMemoryManager-1005"><span class="linenos">1005</span></a>                        <span class="c1"># Add the category name</span>
</span><span id="SemanticMemoryManager-1006"><a href="#SemanticMemoryManager-1006"><span class="linenos">1006</span></a>                        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expanded</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1007"><a href="#SemanticMemoryManager-1007"><span class="linenos">1007</span></a>                            <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1008"><a href="#SemanticMemoryManager-1008"><span class="linenos">1008</span></a>                        <span class="c1"># Add the full phrase</span>
</span><span id="SemanticMemoryManager-1009"><a href="#SemanticMemoryManager-1009"><span class="linenos">1009</span></a>                        <span class="k">if</span> <span class="n">phrase</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expanded</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1010"><a href="#SemanticMemoryManager-1010"><span class="linenos">1010</span></a>                            <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phrase</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="SemanticMemoryManager-1011"><a href="#SemanticMemoryManager-1011"><span class="linenos">1011</span></a>
</span><span id="SemanticMemoryManager-1012"><a href="#SemanticMemoryManager-1012"><span class="linenos">1012</span></a>        <span class="c1"># Work-related expansions (keeping existing hardcoded synonyms for backward compatibility)</span>
</span><span id="SemanticMemoryManager-1013"><a href="#SemanticMemoryManager-1013"><span class="linenos">1013</span></a>        <span class="n">work_synonyms</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SemanticMemoryManager-1014"><a href="#SemanticMemoryManager-1014"><span class="linenos">1014</span></a>            <span class="s2">&quot;work&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="SemanticMemoryManager-1015"><a href="#SemanticMemoryManager-1015"><span class="linenos">1015</span></a>                <span class="s2">&quot;job&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1016"><a href="#SemanticMemoryManager-1016"><span class="linenos">1016</span></a>                <span class="s2">&quot;employment&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1017"><a href="#SemanticMemoryManager-1017"><span class="linenos">1017</span></a>                <span class="s2">&quot;career&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1018"><a href="#SemanticMemoryManager-1018"><span class="linenos">1018</span></a>                <span class="s2">&quot;occupation&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1019"><a href="#SemanticMemoryManager-1019"><span class="linenos">1019</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1020"><a href="#SemanticMemoryManager-1020"><span class="linenos">1020</span></a>                <span class="s2">&quot;company&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1021"><a href="#SemanticMemoryManager-1021"><span class="linenos">1021</span></a>                <span class="s2">&quot;employer&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1022"><a href="#SemanticMemoryManager-1022"><span class="linenos">1022</span></a>                <span class="s2">&quot;workplace&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1023"><a href="#SemanticMemoryManager-1023"><span class="linenos">1023</span></a>            <span class="p">],</span>
</span><span id="SemanticMemoryManager-1024"><a href="#SemanticMemoryManager-1024"><span class="linenos">1024</span></a>            <span class="s2">&quot;workplace&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;work&quot;</span><span class="p">,</span> <span class="s2">&quot;job&quot;</span><span class="p">,</span> <span class="s2">&quot;office&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;employer&quot;</span><span class="p">,</span> <span class="s2">&quot;business&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1025"><a href="#SemanticMemoryManager-1025"><span class="linenos">1025</span></a>            <span class="s2">&quot;job&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;work&quot;</span><span class="p">,</span> <span class="s2">&quot;employment&quot;</span><span class="p">,</span> <span class="s2">&quot;career&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;occupation&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1026"><a href="#SemanticMemoryManager-1026"><span class="linenos">1026</span></a>            <span class="s2">&quot;company&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;employer&quot;</span><span class="p">,</span> <span class="s2">&quot;business&quot;</span><span class="p">,</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;workplace&quot;</span><span class="p">,</span> <span class="s2">&quot;firm&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1027"><a href="#SemanticMemoryManager-1027"><span class="linenos">1027</span></a>            <span class="s2">&quot;career&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;job&quot;</span><span class="p">,</span> <span class="s2">&quot;work&quot;</span><span class="p">,</span> <span class="s2">&quot;profession&quot;</span><span class="p">,</span> <span class="s2">&quot;occupation&quot;</span><span class="p">,</span> <span class="s2">&quot;employment&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1028"><a href="#SemanticMemoryManager-1028"><span class="linenos">1028</span></a>        <span class="p">}</span>
</span><span id="SemanticMemoryManager-1029"><a href="#SemanticMemoryManager-1029"><span class="linenos">1029</span></a>
</span><span id="SemanticMemoryManager-1030"><a href="#SemanticMemoryManager-1030"><span class="linenos">1030</span></a>        <span class="c1"># Education-related expansions</span>
</span><span id="SemanticMemoryManager-1031"><a href="#SemanticMemoryManager-1031"><span class="linenos">1031</span></a>        <span class="n">education_synonyms</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SemanticMemoryManager-1032"><a href="#SemanticMemoryManager-1032"><span class="linenos">1032</span></a>            <span class="s2">&quot;school&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;university&quot;</span><span class="p">,</span> <span class="s2">&quot;college&quot;</span><span class="p">,</span> <span class="s2">&quot;education&quot;</span><span class="p">,</span> <span class="s2">&quot;academic&quot;</span><span class="p">,</span> <span class="s2">&quot;institution&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1033"><a href="#SemanticMemoryManager-1033"><span class="linenos">1033</span></a>            <span class="s2">&quot;university&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;college&quot;</span><span class="p">,</span> <span class="s2">&quot;school&quot;</span><span class="p">,</span> <span class="s2">&quot;education&quot;</span><span class="p">,</span> <span class="s2">&quot;academic&quot;</span><span class="p">,</span> <span class="s2">&quot;institution&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1034"><a href="#SemanticMemoryManager-1034"><span class="linenos">1034</span></a>            <span class="s2">&quot;degree&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">,</span> <span class="s2">&quot;qualification&quot;</span><span class="p">,</span> <span class="s2">&quot;diploma&quot;</span><span class="p">,</span> <span class="s2">&quot;certification&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1035"><a href="#SemanticMemoryManager-1035"><span class="linenos">1035</span></a>            <span class="s2">&quot;study&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">,</span> <span class="s2">&quot;learning&quot;</span><span class="p">,</span> <span class="s2">&quot;academic&quot;</span><span class="p">,</span> <span class="s2">&quot;school&quot;</span><span class="p">,</span> <span class="s2">&quot;university&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1036"><a href="#SemanticMemoryManager-1036"><span class="linenos">1036</span></a>        <span class="p">}</span>
</span><span id="SemanticMemoryManager-1037"><a href="#SemanticMemoryManager-1037"><span class="linenos">1037</span></a>
</span><span id="SemanticMemoryManager-1038"><a href="#SemanticMemoryManager-1038"><span class="linenos">1038</span></a>        <span class="c1"># Personal-related expansions</span>
</span><span id="SemanticMemoryManager-1039"><a href="#SemanticMemoryManager-1039"><span class="linenos">1039</span></a>        <span class="n">personal_synonyms</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SemanticMemoryManager-1040"><a href="#SemanticMemoryManager-1040"><span class="linenos">1040</span></a>            <span class="s2">&quot;hobby&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;interest&quot;</span><span class="p">,</span> <span class="s2">&quot;activity&quot;</span><span class="p">,</span> <span class="s2">&quot;pastime&quot;</span><span class="p">,</span> <span class="s2">&quot;recreation&quot;</span><span class="p">,</span> <span class="s2">&quot;leisure&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1041"><a href="#SemanticMemoryManager-1041"><span class="linenos">1041</span></a>            <span class="s2">&quot;interest&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hobby&quot;</span><span class="p">,</span> <span class="s2">&quot;passion&quot;</span><span class="p">,</span> <span class="s2">&quot;activity&quot;</span><span class="p">,</span> <span class="s2">&quot;like&quot;</span><span class="p">,</span> <span class="s2">&quot;enjoy&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1042"><a href="#SemanticMemoryManager-1042"><span class="linenos">1042</span></a>            <span class="s2">&quot;like&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;enjoy&quot;</span><span class="p">,</span> <span class="s2">&quot;prefer&quot;</span><span class="p">,</span> <span class="s2">&quot;love&quot;</span><span class="p">,</span> <span class="s2">&quot;interest&quot;</span><span class="p">,</span> <span class="s2">&quot;hobby&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1043"><a href="#SemanticMemoryManager-1043"><span class="linenos">1043</span></a>            <span class="s2">&quot;preference&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;like&quot;</span><span class="p">,</span> <span class="s2">&quot;prefer&quot;</span><span class="p">,</span> <span class="s2">&quot;choice&quot;</span><span class="p">,</span> <span class="s2">&quot;favorite&quot;</span><span class="p">],</span>
</span><span id="SemanticMemoryManager-1044"><a href="#SemanticMemoryManager-1044"><span class="linenos">1044</span></a>        <span class="p">}</span>
</span><span id="SemanticMemoryManager-1045"><a href="#SemanticMemoryManager-1045"><span class="linenos">1045</span></a>
</span><span id="SemanticMemoryManager-1046"><a href="#SemanticMemoryManager-1046"><span class="linenos">1046</span></a>        <span class="c1"># Combine all synonym dictionaries</span>
</span><span id="SemanticMemoryManager-1047"><a href="#SemanticMemoryManager-1047"><span class="linenos">1047</span></a>        <span class="n">all_synonyms</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">work_synonyms</span><span class="p">,</span> <span class="o">**</span><span class="n">education_synonyms</span><span class="p">,</span> <span class="o">**</span><span class="n">personal_synonyms</span><span class="p">}</span>
</span><span id="SemanticMemoryManager-1048"><a href="#SemanticMemoryManager-1048"><span class="linenos">1048</span></a>
</span><span id="SemanticMemoryManager-1049"><a href="#SemanticMemoryManager-1049"><span class="linenos">1049</span></a>        <span class="c1"># Add synonyms for words in the query</span>
</span><span id="SemanticMemoryManager-1050"><a href="#SemanticMemoryManager-1050"><span class="linenos">1050</span></a>        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">query_words</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1051"><a href="#SemanticMemoryManager-1051"><span class="linenos">1051</span></a>            <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">all_synonyms</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1052"><a href="#SemanticMemoryManager-1052"><span class="linenos">1052</span></a>                <span class="k">for</span> <span class="n">synonym</span> <span class="ow">in</span> <span class="n">all_synonyms</span><span class="p">[</span><span class="n">word</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-1053"><a href="#SemanticMemoryManager-1053"><span class="linenos">1053</span></a>                    <span class="c1"># Create expanded queries by replacing the word with synonyms</span>
</span><span id="SemanticMemoryManager-1054"><a href="#SemanticMemoryManager-1054"><span class="linenos">1054</span></a>                    <span class="n">expanded_query</span> <span class="o">=</span> <span class="n">query_lower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">synonym</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1055"><a href="#SemanticMemoryManager-1055"><span class="linenos">1055</span></a>                    <span class="k">if</span> <span class="n">expanded_query</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expanded</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1056"><a href="#SemanticMemoryManager-1056"><span class="linenos">1056</span></a>                        <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expanded_query</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1057"><a href="#SemanticMemoryManager-1057"><span class="linenos">1057</span></a>
</span><span id="SemanticMemoryManager-1058"><a href="#SemanticMemoryManager-1058"><span class="linenos">1058</span></a>                    <span class="c1"># Also add just the synonym</span>
</span><span id="SemanticMemoryManager-1059"><a href="#SemanticMemoryManager-1059"><span class="linenos">1059</span></a>                    <span class="k">if</span> <span class="n">synonym</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expanded</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1060"><a href="#SemanticMemoryManager-1060"><span class="linenos">1060</span></a>                        <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">synonym</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1061"><a href="#SemanticMemoryManager-1061"><span class="linenos">1061</span></a>
</span><span id="SemanticMemoryManager-1062"><a href="#SemanticMemoryManager-1062"><span class="linenos">1062</span></a>        <span class="k">return</span> <span class="n">expanded</span>
</span><span id="SemanticMemoryManager-1063"><a href="#SemanticMemoryManager-1063"><span class="linenos">1063</span></a>
</span><span id="SemanticMemoryManager-1064"><a href="#SemanticMemoryManager-1064"><span class="linenos">1064</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_keyword_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1065"><a href="#SemanticMemoryManager-1065"><span class="linenos">1065</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1066"><a href="#SemanticMemoryManager-1066"><span class="linenos">1066</span></a><span class="sd">        Calculate keyword-based similarity score for enhanced matching.</span>
</span><span id="SemanticMemoryManager-1067"><a href="#SemanticMemoryManager-1067"><span class="linenos">1067</span></a>
</span><span id="SemanticMemoryManager-1068"><a href="#SemanticMemoryManager-1068"><span class="linenos">1068</span></a><span class="sd">        :param queries: List of query variations to test</span>
</span><span id="SemanticMemoryManager-1069"><a href="#SemanticMemoryManager-1069"><span class="linenos">1069</span></a><span class="sd">        :param memory_text: Memory text to search in</span>
</span><span id="SemanticMemoryManager-1070"><a href="#SemanticMemoryManager-1070"><span class="linenos">1070</span></a><span class="sd">        :return: Keyword similarity score (0.0 to 1.0)</span>
</span><span id="SemanticMemoryManager-1071"><a href="#SemanticMemoryManager-1071"><span class="linenos">1071</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1072"><a href="#SemanticMemoryManager-1072"><span class="linenos">1072</span></a>        <span class="n">memory_lower</span> <span class="o">=</span> <span class="n">memory_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-1073"><a href="#SemanticMemoryManager-1073"><span class="linenos">1073</span></a>        <span class="n">max_score</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticMemoryManager-1074"><a href="#SemanticMemoryManager-1074"><span class="linenos">1074</span></a>
</span><span id="SemanticMemoryManager-1075"><a href="#SemanticMemoryManager-1075"><span class="linenos">1075</span></a>        <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1076"><a href="#SemanticMemoryManager-1076"><span class="linenos">1076</span></a>            <span class="n">query_words</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-1077"><a href="#SemanticMemoryManager-1077"><span class="linenos">1077</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query_words</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1078"><a href="#SemanticMemoryManager-1078"><span class="linenos">1078</span></a>                <span class="k">continue</span>
</span><span id="SemanticMemoryManager-1079"><a href="#SemanticMemoryManager-1079"><span class="linenos">1079</span></a>
</span><span id="SemanticMemoryManager-1080"><a href="#SemanticMemoryManager-1080"><span class="linenos">1080</span></a>            <span class="n">matches</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager-1081"><a href="#SemanticMemoryManager-1081"><span class="linenos">1081</span></a>            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">query_words</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1082"><a href="#SemanticMemoryManager-1082"><span class="linenos">1082</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-1083"><a href="#SemanticMemoryManager-1083"><span class="linenos">1083</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">memory_lower</span>
</span><span id="SemanticMemoryManager-1084"><a href="#SemanticMemoryManager-1084"><span class="linenos">1084</span></a>                <span class="p">):</span>  <span class="c1"># Only count words longer than 2 chars</span>
</span><span id="SemanticMemoryManager-1085"><a href="#SemanticMemoryManager-1085"><span class="linenos">1085</span></a>                    <span class="n">matches</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1086"><a href="#SemanticMemoryManager-1086"><span class="linenos">1086</span></a>
</span><span id="SemanticMemoryManager-1087"><a href="#SemanticMemoryManager-1087"><span class="linenos">1087</span></a>            <span class="k">if</span> <span class="n">query_words</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1088"><a href="#SemanticMemoryManager-1088"><span class="linenos">1088</span></a>                <span class="n">score</span> <span class="o">=</span> <span class="n">matches</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_words</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1089"><a href="#SemanticMemoryManager-1089"><span class="linenos">1089</span></a>                <span class="n">max_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_score</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1090"><a href="#SemanticMemoryManager-1090"><span class="linenos">1090</span></a>
</span><span id="SemanticMemoryManager-1091"><a href="#SemanticMemoryManager-1091"><span class="linenos">1091</span></a>        <span class="k">return</span> <span class="n">max_score</span>
</span><span id="SemanticMemoryManager-1092"><a href="#SemanticMemoryManager-1092"><span class="linenos">1092</span></a>
</span><span id="SemanticMemoryManager-1093"><a href="#SemanticMemoryManager-1093"><span class="linenos">1093</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-1094"><a href="#SemanticMemoryManager-1094"><span class="linenos">1094</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1095"><a href="#SemanticMemoryManager-1095"><span class="linenos">1095</span></a><span class="sd">        Get all memories for a user.</span>
</span><span id="SemanticMemoryManager-1096"><a href="#SemanticMemoryManager-1096"><span class="linenos">1096</span></a>
</span><span id="SemanticMemoryManager-1097"><a href="#SemanticMemoryManager-1097"><span class="linenos">1097</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-1098"><a href="#SemanticMemoryManager-1098"><span class="linenos">1098</span></a><span class="sd">        :param user_id: User ID to retrieve memories for</span>
</span><span id="SemanticMemoryManager-1099"><a href="#SemanticMemoryManager-1099"><span class="linenos">1099</span></a><span class="sd">        :return: List of UserMemory objects</span>
</span><span id="SemanticMemoryManager-1100"><a href="#SemanticMemoryManager-1100"><span class="linenos">1100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1101"><a href="#SemanticMemoryManager-1101"><span class="linenos">1101</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager-1102"><a href="#SemanticMemoryManager-1102"><span class="linenos">1102</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1103"><a href="#SemanticMemoryManager-1103"><span class="linenos">1103</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-1104"><a href="#SemanticMemoryManager-1104"><span class="linenos">1104</span></a>            
</span><span id="SemanticMemoryManager-1105"><a href="#SemanticMemoryManager-1105"><span class="linenos">1105</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1106"><a href="#SemanticMemoryManager-1106"><span class="linenos">1106</span></a>            <span class="c1"># Get all memories for the user</span>
</span><span id="SemanticMemoryManager-1107"><a href="#SemanticMemoryManager-1107"><span class="linenos">1107</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;desc&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1108"><a href="#SemanticMemoryManager-1108"><span class="linenos">1108</span></a>
</span><span id="SemanticMemoryManager-1109"><a href="#SemanticMemoryManager-1109"><span class="linenos">1109</span></a>            <span class="n">user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-1110"><a href="#SemanticMemoryManager-1110"><span class="linenos">1110</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1111"><a href="#SemanticMemoryManager-1111"><span class="linenos">1111</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1112"><a href="#SemanticMemoryManager-1112"><span class="linenos">1112</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1113"><a href="#SemanticMemoryManager-1113"><span class="linenos">1113</span></a>                        <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1114"><a href="#SemanticMemoryManager-1114"><span class="linenos">1114</span></a>                        <span class="n">user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1115"><a href="#SemanticMemoryManager-1115"><span class="linenos">1115</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1116"><a href="#SemanticMemoryManager-1116"><span class="linenos">1116</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1117"><a href="#SemanticMemoryManager-1117"><span class="linenos">1117</span></a>                            <span class="s2">&quot;Failed to convert memory row to UserMemory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SemanticMemoryManager-1118"><a href="#SemanticMemoryManager-1118"><span class="linenos">1118</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager-1119"><a href="#SemanticMemoryManager-1119"><span class="linenos">1119</span></a>
</span><span id="SemanticMemoryManager-1120"><a href="#SemanticMemoryManager-1120"><span class="linenos">1120</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieved </span><span class="si">%d</span><span class="s2"> memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_memories</span><span class="p">),</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1121"><a href="#SemanticMemoryManager-1121"><span class="linenos">1121</span></a>            <span class="k">return</span> <span class="n">user_memories</span>
</span><span id="SemanticMemoryManager-1122"><a href="#SemanticMemoryManager-1122"><span class="linenos">1122</span></a>
</span><span id="SemanticMemoryManager-1123"><a href="#SemanticMemoryManager-1123"><span class="linenos">1123</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1124"><a href="#SemanticMemoryManager-1124"><span class="linenos">1124</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving all memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1125"><a href="#SemanticMemoryManager-1125"><span class="linenos">1125</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-1126"><a href="#SemanticMemoryManager-1126"><span class="linenos">1126</span></a>
</span><span id="SemanticMemoryManager-1127"><a href="#SemanticMemoryManager-1127"><span class="linenos">1127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-1128"><a href="#SemanticMemoryManager-1128"><span class="linenos">1128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1129"><a href="#SemanticMemoryManager-1129"><span class="linenos">1129</span></a><span class="sd">        Get statistics about memories for a user.</span>
</span><span id="SemanticMemoryManager-1130"><a href="#SemanticMemoryManager-1130"><span class="linenos">1130</span></a>
</span><span id="SemanticMemoryManager-1131"><a href="#SemanticMemoryManager-1131"><span class="linenos">1131</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-1132"><a href="#SemanticMemoryManager-1132"><span class="linenos">1132</span></a><span class="sd">        :param user_id: User ID to analyze</span>
</span><span id="SemanticMemoryManager-1133"><a href="#SemanticMemoryManager-1133"><span class="linenos">1133</span></a><span class="sd">        :return: Dictionary with memory statistics</span>
</span><span id="SemanticMemoryManager-1134"><a href="#SemanticMemoryManager-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1135"><a href="#SemanticMemoryManager-1135"><span class="linenos">1135</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager-1136"><a href="#SemanticMemoryManager-1136"><span class="linenos">1136</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1137"><a href="#SemanticMemoryManager-1137"><span class="linenos">1137</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-1138"><a href="#SemanticMemoryManager-1138"><span class="linenos">1138</span></a>            
</span><span id="SemanticMemoryManager-1139"><a href="#SemanticMemoryManager-1139"><span class="linenos">1139</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1140"><a href="#SemanticMemoryManager-1140"><span class="linenos">1140</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_memories</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1141"><a href="#SemanticMemoryManager-1141"><span class="linenos">1141</span></a>
</span><span id="SemanticMemoryManager-1142"><a href="#SemanticMemoryManager-1142"><span class="linenos">1142</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1143"><a href="#SemanticMemoryManager-1143"><span class="linenos">1143</span></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;total_memories&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="SemanticMemoryManager-1144"><a href="#SemanticMemoryManager-1144"><span class="linenos">1144</span></a>
</span><span id="SemanticMemoryManager-1145"><a href="#SemanticMemoryManager-1145"><span class="linenos">1145</span></a>            <span class="c1"># Topic distribution</span>
</span><span id="SemanticMemoryManager-1146"><a href="#SemanticMemoryManager-1146"><span class="linenos">1146</span></a>            <span class="n">topic_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SemanticMemoryManager-1147"><a href="#SemanticMemoryManager-1147"><span class="linenos">1147</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1148"><a href="#SemanticMemoryManager-1148"><span class="linenos">1148</span></a>                <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1149"><a href="#SemanticMemoryManager-1149"><span class="linenos">1149</span></a>                    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1150"><a href="#SemanticMemoryManager-1150"><span class="linenos">1150</span></a>                        <span class="n">topic_counts</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1151"><a href="#SemanticMemoryManager-1151"><span class="linenos">1151</span></a>
</span><span id="SemanticMemoryManager-1152"><a href="#SemanticMemoryManager-1152"><span class="linenos">1152</span></a>            <span class="c1"># Average memory length</span>
</span><span id="SemanticMemoryManager-1153"><a href="#SemanticMemoryManager-1153"><span class="linenos">1153</span></a>            <span class="n">avg_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1154"><a href="#SemanticMemoryManager-1154"><span class="linenos">1154</span></a>
</span><span id="SemanticMemoryManager-1155"><a href="#SemanticMemoryManager-1155"><span class="linenos">1155</span></a>            <span class="c1"># Recent activity (memories in last 24 hours)</span>
</span><span id="SemanticMemoryManager-1156"><a href="#SemanticMemoryManager-1156"><span class="linenos">1156</span></a>            <span class="n">recent_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager-1157"><a href="#SemanticMemoryManager-1157"><span class="linenos">1157</span></a>            <span class="k">if</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1158"><a href="#SemanticMemoryManager-1158"><span class="linenos">1158</span></a>                <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1159"><a href="#SemanticMemoryManager-1159"><span class="linenos">1159</span></a>                    <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span>
</span><span id="SemanticMemoryManager-1160"><a href="#SemanticMemoryManager-1160"><span class="linenos">1160</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-1161"><a href="#SemanticMemoryManager-1161"><span class="linenos">1161</span></a>                <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1162"><a href="#SemanticMemoryManager-1162"><span class="linenos">1162</span></a>                    <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">last_updated</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">last_updated</span> <span class="o">&gt;=</span> <span class="n">cutoff</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1163"><a href="#SemanticMemoryManager-1163"><span class="linenos">1163</span></a>                        <span class="n">recent_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1164"><a href="#SemanticMemoryManager-1164"><span class="linenos">1164</span></a>
</span><span id="SemanticMemoryManager-1165"><a href="#SemanticMemoryManager-1165"><span class="linenos">1165</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="SemanticMemoryManager-1166"><a href="#SemanticMemoryManager-1166"><span class="linenos">1166</span></a>                <span class="s2">&quot;total_memories&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">),</span>
</span><span id="SemanticMemoryManager-1167"><a href="#SemanticMemoryManager-1167"><span class="linenos">1167</span></a>                <span class="s2">&quot;topic_distribution&quot;</span><span class="p">:</span> <span class="n">topic_counts</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1168"><a href="#SemanticMemoryManager-1168"><span class="linenos">1168</span></a>                <span class="s2">&quot;average_memory_length&quot;</span><span class="p">:</span> <span class="n">avg_length</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1169"><a href="#SemanticMemoryManager-1169"><span class="linenos">1169</span></a>                <span class="s2">&quot;recent_memories_24h&quot;</span><span class="p">:</span> <span class="n">recent_count</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1170"><a href="#SemanticMemoryManager-1170"><span class="linenos">1170</span></a>                <span class="s2">&quot;most_common_topic&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager-1171"><a href="#SemanticMemoryManager-1171"><span class="linenos">1171</span></a>                    <span class="nb">max</span><span class="p">(</span><span class="n">topic_counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SemanticMemoryManager-1172"><a href="#SemanticMemoryManager-1172"><span class="linenos">1172</span></a>                    <span class="k">if</span> <span class="n">topic_counts</span>
</span><span id="SemanticMemoryManager-1173"><a href="#SemanticMemoryManager-1173"><span class="linenos">1173</span></a>                    <span class="k">else</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager-1174"><a href="#SemanticMemoryManager-1174"><span class="linenos">1174</span></a>                <span class="p">),</span>
</span><span id="SemanticMemoryManager-1175"><a href="#SemanticMemoryManager-1175"><span class="linenos">1175</span></a>            <span class="p">}</span>
</span><span id="SemanticMemoryManager-1176"><a href="#SemanticMemoryManager-1176"><span class="linenos">1176</span></a>
</span><span id="SemanticMemoryManager-1177"><a href="#SemanticMemoryManager-1177"><span class="linenos">1177</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1178"><a href="#SemanticMemoryManager-1178"><span class="linenos">1178</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error getting memory stats: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1179"><a href="#SemanticMemoryManager-1179"><span class="linenos">1179</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span><span id="SemanticMemoryManager-1180"><a href="#SemanticMemoryManager-1180"><span class="linenos">1180</span></a>
</span><span id="SemanticMemoryManager-1181"><a href="#SemanticMemoryManager-1181"><span class="linenos">1181</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_input</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1182"><a href="#SemanticMemoryManager-1182"><span class="linenos">1182</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1183"><a href="#SemanticMemoryManager-1183"><span class="linenos">1183</span></a>        <span class="n">input_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1184"><a href="#SemanticMemoryManager-1184"><span class="linenos">1184</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1185"><a href="#SemanticMemoryManager-1185"><span class="linenos">1185</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1186"><a href="#SemanticMemoryManager-1186"><span class="linenos">1186</span></a>        <span class="n">extract_multiple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1187"><a href="#SemanticMemoryManager-1187"><span class="linenos">1187</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-1188"><a href="#SemanticMemoryManager-1188"><span class="linenos">1188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1189"><a href="#SemanticMemoryManager-1189"><span class="linenos">1189</span></a><span class="sd">        Process input text and extract memories without using LLM.</span>
</span><span id="SemanticMemoryManager-1190"><a href="#SemanticMemoryManager-1190"><span class="linenos">1190</span></a>
</span><span id="SemanticMemoryManager-1191"><a href="#SemanticMemoryManager-1191"><span class="linenos">1191</span></a><span class="sd">        This method uses simple heuristics to determine if the input contains</span>
</span><span id="SemanticMemoryManager-1192"><a href="#SemanticMemoryManager-1192"><span class="linenos">1192</span></a><span class="sd">        memorable information and extracts it accordingly.</span>
</span><span id="SemanticMemoryManager-1193"><a href="#SemanticMemoryManager-1193"><span class="linenos">1193</span></a>
</span><span id="SemanticMemoryManager-1194"><a href="#SemanticMemoryManager-1194"><span class="linenos">1194</span></a><span class="sd">        :param input_text: Input text to process</span>
</span><span id="SemanticMemoryManager-1195"><a href="#SemanticMemoryManager-1195"><span class="linenos">1195</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-1196"><a href="#SemanticMemoryManager-1196"><span class="linenos">1196</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager-1197"><a href="#SemanticMemoryManager-1197"><span class="linenos">1197</span></a><span class="sd">        :param extract_multiple: Whether to try extracting multiple memories from input</span>
</span><span id="SemanticMemoryManager-1198"><a href="#SemanticMemoryManager-1198"><span class="linenos">1198</span></a><span class="sd">        :return: Dictionary with processing results</span>
</span><span id="SemanticMemoryManager-1199"><a href="#SemanticMemoryManager-1199"><span class="linenos">1199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1200"><a href="#SemanticMemoryManager-1200"><span class="linenos">1200</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SemanticMemoryManager-1201"><a href="#SemanticMemoryManager-1201"><span class="linenos">1201</span></a>            <span class="s2">&quot;memories_added&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="SemanticMemoryManager-1202"><a href="#SemanticMemoryManager-1202"><span class="linenos">1202</span></a>            <span class="s2">&quot;memories_rejected&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="SemanticMemoryManager-1203"><a href="#SemanticMemoryManager-1203"><span class="linenos">1203</span></a>            <span class="s2">&quot;total_processed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1204"><a href="#SemanticMemoryManager-1204"><span class="linenos">1204</span></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1205"><a href="#SemanticMemoryManager-1205"><span class="linenos">1205</span></a>            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Processing completed&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1206"><a href="#SemanticMemoryManager-1206"><span class="linenos">1206</span></a>        <span class="p">}</span>
</span><span id="SemanticMemoryManager-1207"><a href="#SemanticMemoryManager-1207"><span class="linenos">1207</span></a>
</span><span id="SemanticMemoryManager-1208"><a href="#SemanticMemoryManager-1208"><span class="linenos">1208</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1209"><a href="#SemanticMemoryManager-1209"><span class="linenos">1209</span></a>            <span class="c1"># Simple heuristics to extract memorable statements</span>
</span><span id="SemanticMemoryManager-1210"><a href="#SemanticMemoryManager-1210"><span class="linenos">1210</span></a>            <span class="n">memorable_statements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_memorable_statements</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1211"><a href="#SemanticMemoryManager-1211"><span class="linenos">1211</span></a>
</span><span id="SemanticMemoryManager-1212"><a href="#SemanticMemoryManager-1212"><span class="linenos">1212</span></a>            <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1213"><a href="#SemanticMemoryManager-1213"><span class="linenos">1213</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1214"><a href="#SemanticMemoryManager-1214"><span class="linenos">1214</span></a>                    <span class="n">memory_text</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1215"><a href="#SemanticMemoryManager-1215"><span class="linenos">1215</span></a>                    <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1216"><a href="#SemanticMemoryManager-1216"><span class="linenos">1216</span></a>                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1217"><a href="#SemanticMemoryManager-1217"><span class="linenos">1217</span></a>                    <span class="n">input_text</span><span class="o">=</span><span class="n">input_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1218"><a href="#SemanticMemoryManager-1218"><span class="linenos">1218</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-1219"><a href="#SemanticMemoryManager-1219"><span class="linenos">1219</span></a>
</span><span id="SemanticMemoryManager-1220"><a href="#SemanticMemoryManager-1220"><span class="linenos">1220</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;total_processed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1221"><a href="#SemanticMemoryManager-1221"><span class="linenos">1221</span></a>
</span><span id="SemanticMemoryManager-1222"><a href="#SemanticMemoryManager-1222"><span class="linenos">1222</span></a>                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1223"><a href="#SemanticMemoryManager-1223"><span class="linenos">1223</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;memories_added&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1224"><a href="#SemanticMemoryManager-1224"><span class="linenos">1224</span></a>                        <span class="p">{</span>
</span><span id="SemanticMemoryManager-1225"><a href="#SemanticMemoryManager-1225"><span class="linenos">1225</span></a>                            <span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1226"><a href="#SemanticMemoryManager-1226"><span class="linenos">1226</span></a>                            <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="n">statement</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1227"><a href="#SemanticMemoryManager-1227"><span class="linenos">1227</span></a>                            <span class="s2">&quot;topics&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1228"><a href="#SemanticMemoryManager-1228"><span class="linenos">1228</span></a>                        <span class="p">}</span>
</span><span id="SemanticMemoryManager-1229"><a href="#SemanticMemoryManager-1229"><span class="linenos">1229</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager-1230"><a href="#SemanticMemoryManager-1230"><span class="linenos">1230</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1231"><a href="#SemanticMemoryManager-1231"><span class="linenos">1231</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;memories_rejected&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1232"><a href="#SemanticMemoryManager-1232"><span class="linenos">1232</span></a>                        <span class="p">{</span><span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="n">statement</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">}</span>
</span><span id="SemanticMemoryManager-1233"><a href="#SemanticMemoryManager-1233"><span class="linenos">1233</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager-1234"><a href="#SemanticMemoryManager-1234"><span class="linenos">1234</span></a>
</span><span id="SemanticMemoryManager-1235"><a href="#SemanticMemoryManager-1235"><span class="linenos">1235</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;memories_added&quot;</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-1236"><a href="#SemanticMemoryManager-1236"><span class="linenos">1236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager-1237"><a href="#SemanticMemoryManager-1237"><span class="linenos">1237</span></a>
</span><span id="SemanticMemoryManager-1238"><a href="#SemanticMemoryManager-1238"><span class="linenos">1238</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1239"><a href="#SemanticMemoryManager-1239"><span class="linenos">1239</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SemanticMemoryManager-1240"><a href="#SemanticMemoryManager-1240"><span class="linenos">1240</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error processing input: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-1241"><a href="#SemanticMemoryManager-1241"><span class="linenos">1241</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error processing input: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1242"><a href="#SemanticMemoryManager-1242"><span class="linenos">1242</span></a>
</span><span id="SemanticMemoryManager-1243"><a href="#SemanticMemoryManager-1243"><span class="linenos">1243</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="SemanticMemoryManager-1244"><a href="#SemanticMemoryManager-1244"><span class="linenos">1244</span></a>
</span><span id="SemanticMemoryManager-1245"><a href="#SemanticMemoryManager-1245"><span class="linenos">1245</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_or_update_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1246"><a href="#SemanticMemoryManager-1246"><span class="linenos">1246</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1247"><a href="#SemanticMemoryManager-1247"><span class="linenos">1247</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>  <span class="c1"># List[Message] from agno.models.message</span>
</span><span id="SemanticMemoryManager-1248"><a href="#SemanticMemoryManager-1248"><span class="linenos">1248</span></a>        <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SemanticMemoryManager-1249"><a href="#SemanticMemoryManager-1249"><span class="linenos">1249</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1250"><a href="#SemanticMemoryManager-1250"><span class="linenos">1250</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1251"><a href="#SemanticMemoryManager-1251"><span class="linenos">1251</span></a>        <span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1252"><a href="#SemanticMemoryManager-1252"><span class="linenos">1252</span></a>        <span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1253"><a href="#SemanticMemoryManager-1253"><span class="linenos">1253</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1254"><a href="#SemanticMemoryManager-1254"><span class="linenos">1254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1255"><a href="#SemanticMemoryManager-1255"><span class="linenos">1255</span></a><span class="sd">        Create or update memories based on messages - LLM-free implementation.</span>
</span><span id="SemanticMemoryManager-1256"><a href="#SemanticMemoryManager-1256"><span class="linenos">1256</span></a>
</span><span id="SemanticMemoryManager-1257"><a href="#SemanticMemoryManager-1257"><span class="linenos">1257</span></a><span class="sd">        This method provides the same interface as Agno&#39;s MemoryManager but uses</span>
</span><span id="SemanticMemoryManager-1258"><a href="#SemanticMemoryManager-1258"><span class="linenos">1258</span></a><span class="sd">        semantic analysis instead of LLM calls for better performance and reliability.</span>
</span><span id="SemanticMemoryManager-1259"><a href="#SemanticMemoryManager-1259"><span class="linenos">1259</span></a>
</span><span id="SemanticMemoryManager-1260"><a href="#SemanticMemoryManager-1260"><span class="linenos">1260</span></a><span class="sd">        :param messages: List of Message objects to process</span>
</span><span id="SemanticMemoryManager-1261"><a href="#SemanticMemoryManager-1261"><span class="linenos">1261</span></a><span class="sd">        :param existing_memories: List of existing memory dictionaries</span>
</span><span id="SemanticMemoryManager-1262"><a href="#SemanticMemoryManager-1262"><span class="linenos">1262</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager-1263"><a href="#SemanticMemoryManager-1263"><span class="linenos">1263</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-1264"><a href="#SemanticMemoryManager-1264"><span class="linenos">1264</span></a><span class="sd">        :param delete_memories: Whether deletion is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager-1265"><a href="#SemanticMemoryManager-1265"><span class="linenos">1265</span></a><span class="sd">        :param clear_memories: Whether clearing is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager-1266"><a href="#SemanticMemoryManager-1266"><span class="linenos">1266</span></a><span class="sd">        :return: String describing the actions taken</span>
</span><span id="SemanticMemoryManager-1267"><a href="#SemanticMemoryManager-1267"><span class="linenos">1267</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1268"><a href="#SemanticMemoryManager-1268"><span class="linenos">1268</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SemanticMemoryManager.create_or_update_memories Start&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1269"><a href="#SemanticMemoryManager-1269"><span class="linenos">1269</span></a>
</span><span id="SemanticMemoryManager-1270"><a href="#SemanticMemoryManager-1270"><span class="linenos">1270</span></a>        <span class="c1"># Create a simple memory class for duplicate checking</span>
</span><span id="SemanticMemoryManager-1271"><a href="#SemanticMemoryManager-1271"><span class="linenos">1271</span></a>        <span class="k">class</span><span class="w"> </span><span class="nc">SimpleMemory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1272"><a href="#SemanticMemoryManager-1272"><span class="linenos">1272</span></a>            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="SemanticMemoryManager-1273"><a href="#SemanticMemoryManager-1273"><span class="linenos">1273</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">memory_text</span>
</span><span id="SemanticMemoryManager-1274"><a href="#SemanticMemoryManager-1274"><span class="linenos">1274</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memory_id</span> <span class="o">=</span> <span class="n">memory_id</span>
</span><span id="SemanticMemoryManager-1275"><a href="#SemanticMemoryManager-1275"><span class="linenos">1275</span></a>
</span><span id="SemanticMemoryManager-1276"><a href="#SemanticMemoryManager-1276"><span class="linenos">1276</span></a>        <span class="c1"># Convert existing memories to UserMemory objects for our processing</span>
</span><span id="SemanticMemoryManager-1277"><a href="#SemanticMemoryManager-1277"><span class="linenos">1277</span></a>        <span class="n">existing_user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-1278"><a href="#SemanticMemoryManager-1278"><span class="linenos">1278</span></a>        <span class="k">for</span> <span class="n">mem_dict</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1279"><a href="#SemanticMemoryManager-1279"><span class="linenos">1279</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1280"><a href="#SemanticMemoryManager-1280"><span class="linenos">1280</span></a>                <span class="c1"># Create a UserMemory-like object for our duplicate detection</span>
</span><span id="SemanticMemoryManager-1281"><a href="#SemanticMemoryManager-1281"><span class="linenos">1281</span></a>                <span class="n">memory_text</span> <span class="o">=</span> <span class="n">mem_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1282"><a href="#SemanticMemoryManager-1282"><span class="linenos">1282</span></a>                <span class="k">if</span> <span class="n">memory_text</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1283"><a href="#SemanticMemoryManager-1283"><span class="linenos">1283</span></a>                    <span class="n">existing_user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1284"><a href="#SemanticMemoryManager-1284"><span class="linenos">1284</span></a>                        <span class="n">SimpleMemory</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">mem_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="SemanticMemoryManager-1285"><a href="#SemanticMemoryManager-1285"><span class="linenos">1285</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager-1286"><a href="#SemanticMemoryManager-1286"><span class="linenos">1286</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1287"><a href="#SemanticMemoryManager-1287"><span class="linenos">1287</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process existing memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1288"><a href="#SemanticMemoryManager-1288"><span class="linenos">1288</span></a>
</span><span id="SemanticMemoryManager-1289"><a href="#SemanticMemoryManager-1289"><span class="linenos">1289</span></a>        <span class="c1"># Extract text content from messages</span>
</span><span id="SemanticMemoryManager-1290"><a href="#SemanticMemoryManager-1290"><span class="linenos">1290</span></a>        <span class="n">message_texts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-1291"><a href="#SemanticMemoryManager-1291"><span class="linenos">1291</span></a>        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1292"><a href="#SemanticMemoryManager-1292"><span class="linenos">1292</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1293"><a href="#SemanticMemoryManager-1293"><span class="linenos">1293</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1294"><a href="#SemanticMemoryManager-1294"><span class="linenos">1294</span></a>                    <span class="c1"># Only process user messages for memory extraction</span>
</span><span id="SemanticMemoryManager-1295"><a href="#SemanticMemoryManager-1295"><span class="linenos">1295</span></a>                    <span class="n">message_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
</span><span id="SemanticMemoryManager-1296"><a href="#SemanticMemoryManager-1296"><span class="linenos">1296</span></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;get_content_string&quot;</span><span class="p">):</span>
</span><span id="SemanticMemoryManager-1297"><a href="#SemanticMemoryManager-1297"><span class="linenos">1297</span></a>                <span class="c1"># Use agno&#39;s method to get content</span>
</span><span id="SemanticMemoryManager-1298"><a href="#SemanticMemoryManager-1298"><span class="linenos">1298</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">get_content_string</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-1299"><a href="#SemanticMemoryManager-1299"><span class="linenos">1299</span></a>                <span class="k">if</span> <span class="n">content</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1300"><a href="#SemanticMemoryManager-1300"><span class="linenos">1300</span></a>                    <span class="n">message_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1301"><a href="#SemanticMemoryManager-1301"><span class="linenos">1301</span></a>
</span><span id="SemanticMemoryManager-1302"><a href="#SemanticMemoryManager-1302"><span class="linenos">1302</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">message_texts</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1303"><a href="#SemanticMemoryManager-1303"><span class="linenos">1303</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No user messages found to process&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1304"><a href="#SemanticMemoryManager-1304"><span class="linenos">1304</span></a>            <span class="k">return</span> <span class="s2">&quot;No user messages to process for memory creation&quot;</span>
</span><span id="SemanticMemoryManager-1305"><a href="#SemanticMemoryManager-1305"><span class="linenos">1305</span></a>
</span><span id="SemanticMemoryManager-1306"><a href="#SemanticMemoryManager-1306"><span class="linenos">1306</span></a>        <span class="c1"># Combine all message texts</span>
</span><span id="SemanticMemoryManager-1307"><a href="#SemanticMemoryManager-1307"><span class="linenos">1307</span></a>        <span class="n">combined_input</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">message_texts</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1308"><a href="#SemanticMemoryManager-1308"><span class="linenos">1308</span></a>
</span><span id="SemanticMemoryManager-1309"><a href="#SemanticMemoryManager-1309"><span class="linenos">1309</span></a>        <span class="c1"># Extract memorable statements</span>
</span><span id="SemanticMemoryManager-1310"><a href="#SemanticMemoryManager-1310"><span class="linenos">1310</span></a>        <span class="n">memorable_statements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_memorable_statements</span><span class="p">(</span><span class="n">combined_input</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1311"><a href="#SemanticMemoryManager-1311"><span class="linenos">1311</span></a>
</span><span id="SemanticMemoryManager-1312"><a href="#SemanticMemoryManager-1312"><span class="linenos">1312</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1313"><a href="#SemanticMemoryManager-1313"><span class="linenos">1313</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No memorable statements found in messages&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1314"><a href="#SemanticMemoryManager-1314"><span class="linenos">1314</span></a>            <span class="k">return</span> <span class="s2">&quot;No memorable information found in the messages&quot;</span>
</span><span id="SemanticMemoryManager-1315"><a href="#SemanticMemoryManager-1315"><span class="linenos">1315</span></a>
</span><span id="SemanticMemoryManager-1316"><a href="#SemanticMemoryManager-1316"><span class="linenos">1316</span></a>        <span class="c1"># Process each memorable statement</span>
</span><span id="SemanticMemoryManager-1317"><a href="#SemanticMemoryManager-1317"><span class="linenos">1317</span></a>        <span class="n">actions_taken</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-1318"><a href="#SemanticMemoryManager-1318"><span class="linenos">1318</span></a>        <span class="n">memories_added</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager-1319"><a href="#SemanticMemoryManager-1319"><span class="linenos">1319</span></a>        <span class="n">memories_rejected</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager-1320"><a href="#SemanticMemoryManager-1320"><span class="linenos">1320</span></a>
</span><span id="SemanticMemoryManager-1321"><a href="#SemanticMemoryManager-1321"><span class="linenos">1321</span></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1322"><a href="#SemanticMemoryManager-1322"><span class="linenos">1322</span></a>            <span class="c1"># Check for duplicates against existing memories</span>
</span><span id="SemanticMemoryManager-1323"><a href="#SemanticMemoryManager-1323"><span class="linenos">1323</span></a>            <span class="n">should_reject</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_reject_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1324"><a href="#SemanticMemoryManager-1324"><span class="linenos">1324</span></a>                <span class="n">statement</span><span class="p">,</span> <span class="n">existing_user_memories</span>
</span><span id="SemanticMemoryManager-1325"><a href="#SemanticMemoryManager-1325"><span class="linenos">1325</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-1326"><a href="#SemanticMemoryManager-1326"><span class="linenos">1326</span></a>
</span><span id="SemanticMemoryManager-1327"><a href="#SemanticMemoryManager-1327"><span class="linenos">1327</span></a>            <span class="k">if</span> <span class="n">should_reject</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1328"><a href="#SemanticMemoryManager-1328"><span class="linenos">1328</span></a>                <span class="n">memories_rejected</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1329"><a href="#SemanticMemoryManager-1329"><span class="linenos">1329</span></a>                <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1330"><a href="#SemanticMemoryManager-1330"><span class="linenos">1330</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected memory: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1331"><a href="#SemanticMemoryManager-1331"><span class="linenos">1331</span></a>                <span class="k">continue</span>
</span><span id="SemanticMemoryManager-1332"><a href="#SemanticMemoryManager-1332"><span class="linenos">1332</span></a>
</span><span id="SemanticMemoryManager-1333"><a href="#SemanticMemoryManager-1333"><span class="linenos">1333</span></a>            <span class="c1"># Add the memory</span>
</span><span id="SemanticMemoryManager-1334"><a href="#SemanticMemoryManager-1334"><span class="linenos">1334</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1335"><a href="#SemanticMemoryManager-1335"><span class="linenos">1335</span></a>                <span class="n">memory_text</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1336"><a href="#SemanticMemoryManager-1336"><span class="linenos">1336</span></a>                <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1337"><a href="#SemanticMemoryManager-1337"><span class="linenos">1337</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1338"><a href="#SemanticMemoryManager-1338"><span class="linenos">1338</span></a>                <span class="n">input_text</span><span class="o">=</span><span class="n">combined_input</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1339"><a href="#SemanticMemoryManager-1339"><span class="linenos">1339</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager-1340"><a href="#SemanticMemoryManager-1340"><span class="linenos">1340</span></a>
</span><span id="SemanticMemoryManager-1341"><a href="#SemanticMemoryManager-1341"><span class="linenos">1341</span></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1342"><a href="#SemanticMemoryManager-1342"><span class="linenos">1342</span></a>                <span class="n">memories_added</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1343"><a href="#SemanticMemoryManager-1343"><span class="linenos">1343</span></a>                <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1344"><a href="#SemanticMemoryManager-1344"><span class="linenos">1344</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added memory: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1345"><a href="#SemanticMemoryManager-1345"><span class="linenos">1345</span></a>
</span><span id="SemanticMemoryManager-1346"><a href="#SemanticMemoryManager-1346"><span class="linenos">1346</span></a>                <span class="c1"># Add to existing memories list for subsequent duplicate checking</span>
</span><span id="SemanticMemoryManager-1347"><a href="#SemanticMemoryManager-1347"><span class="linenos">1347</span></a>                <span class="n">existing_user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SimpleMemory</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">memory_id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="SemanticMemoryManager-1348"><a href="#SemanticMemoryManager-1348"><span class="linenos">1348</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1349"><a href="#SemanticMemoryManager-1349"><span class="linenos">1349</span></a>                <span class="n">memories_rejected</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1350"><a href="#SemanticMemoryManager-1350"><span class="linenos">1350</span></a>                <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1351"><a href="#SemanticMemoryManager-1351"><span class="linenos">1351</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to add: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; - </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-1352"><a href="#SemanticMemoryManager-1352"><span class="linenos">1352</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-1353"><a href="#SemanticMemoryManager-1353"><span class="linenos">1353</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to add memory: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1354"><a href="#SemanticMemoryManager-1354"><span class="linenos">1354</span></a>
</span><span id="SemanticMemoryManager-1355"><a href="#SemanticMemoryManager-1355"><span class="linenos">1355</span></a>        <span class="c1"># Set memories_updated flag if any memories were added</span>
</span><span id="SemanticMemoryManager-1356"><a href="#SemanticMemoryManager-1356"><span class="linenos">1356</span></a>        <span class="k">if</span> <span class="n">memories_added</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1357"><a href="#SemanticMemoryManager-1357"><span class="linenos">1357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager-1358"><a href="#SemanticMemoryManager-1358"><span class="linenos">1358</span></a>
</span><span id="SemanticMemoryManager-1359"><a href="#SemanticMemoryManager-1359"><span class="linenos">1359</span></a>        <span class="c1"># Create response summary</span>
</span><span id="SemanticMemoryManager-1360"><a href="#SemanticMemoryManager-1360"><span class="linenos">1360</span></a>        <span class="n">response_parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticMemoryManager-1361"><a href="#SemanticMemoryManager-1361"><span class="linenos">1361</span></a>            <span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memorable_statements</span><span class="p">)</span><span class="si">}</span><span class="s2"> memorable statements&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1362"><a href="#SemanticMemoryManager-1362"><span class="linenos">1362</span></a>            <span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">memories_added</span><span class="si">}</span><span class="s2"> new memories&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1363"><a href="#SemanticMemoryManager-1363"><span class="linenos">1363</span></a>            <span class="sa">f</span><span class="s2">&quot;Rejected </span><span class="si">{</span><span class="n">memories_rejected</span><span class="si">}</span><span class="s2"> duplicates/invalid memories&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1364"><a href="#SemanticMemoryManager-1364"><span class="linenos">1364</span></a>        <span class="p">]</span>
</span><span id="SemanticMemoryManager-1365"><a href="#SemanticMemoryManager-1365"><span class="linenos">1365</span></a>
</span><span id="SemanticMemoryManager-1366"><a href="#SemanticMemoryManager-1366"><span class="linenos">1366</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span> <span class="ow">and</span> <span class="n">actions_taken</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1367"><a href="#SemanticMemoryManager-1367"><span class="linenos">1367</span></a>            <span class="n">response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Actions taken:&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1368"><a href="#SemanticMemoryManager-1368"><span class="linenos">1368</span></a>            <span class="n">response_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Limit to first 5 actions</span>
</span><span id="SemanticMemoryManager-1369"><a href="#SemanticMemoryManager-1369"><span class="linenos">1369</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1370"><a href="#SemanticMemoryManager-1370"><span class="linenos">1370</span></a>                <span class="n">response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="si">}</span><span class="s2"> more actions&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1371"><a href="#SemanticMemoryManager-1371"><span class="linenos">1371</span></a>
</span><span id="SemanticMemoryManager-1372"><a href="#SemanticMemoryManager-1372"><span class="linenos">1372</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;. &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response_parts</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1373"><a href="#SemanticMemoryManager-1373"><span class="linenos">1373</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SemanticMemoryManager.create_or_update_memories End&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1374"><a href="#SemanticMemoryManager-1374"><span class="linenos">1374</span></a>
</span><span id="SemanticMemoryManager-1375"><a href="#SemanticMemoryManager-1375"><span class="linenos">1375</span></a>        <span class="k">return</span> <span class="n">response</span>
</span><span id="SemanticMemoryManager-1376"><a href="#SemanticMemoryManager-1376"><span class="linenos">1376</span></a>
</span><span id="SemanticMemoryManager-1377"><a href="#SemanticMemoryManager-1377"><span class="linenos">1377</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">acreate_or_update_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1378"><a href="#SemanticMemoryManager-1378"><span class="linenos">1378</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1379"><a href="#SemanticMemoryManager-1379"><span class="linenos">1379</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>  <span class="c1"># List[Message] from agno.models.message</span>
</span><span id="SemanticMemoryManager-1380"><a href="#SemanticMemoryManager-1380"><span class="linenos">1380</span></a>        <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SemanticMemoryManager-1381"><a href="#SemanticMemoryManager-1381"><span class="linenos">1381</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1382"><a href="#SemanticMemoryManager-1382"><span class="linenos">1382</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1383"><a href="#SemanticMemoryManager-1383"><span class="linenos">1383</span></a>        <span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1384"><a href="#SemanticMemoryManager-1384"><span class="linenos">1384</span></a>        <span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1385"><a href="#SemanticMemoryManager-1385"><span class="linenos">1385</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1386"><a href="#SemanticMemoryManager-1386"><span class="linenos">1386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1387"><a href="#SemanticMemoryManager-1387"><span class="linenos">1387</span></a><span class="sd">        Async version of create_or_update_memories.</span>
</span><span id="SemanticMemoryManager-1388"><a href="#SemanticMemoryManager-1388"><span class="linenos">1388</span></a>
</span><span id="SemanticMemoryManager-1389"><a href="#SemanticMemoryManager-1389"><span class="linenos">1389</span></a><span class="sd">        Since our implementation doesn&#39;t use async operations, this just calls</span>
</span><span id="SemanticMemoryManager-1390"><a href="#SemanticMemoryManager-1390"><span class="linenos">1390</span></a><span class="sd">        the sync version. This maintains compatibility with Agno&#39;s async interface.</span>
</span><span id="SemanticMemoryManager-1391"><a href="#SemanticMemoryManager-1391"><span class="linenos">1391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1392"><a href="#SemanticMemoryManager-1392"><span class="linenos">1392</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_or_update_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1393"><a href="#SemanticMemoryManager-1393"><span class="linenos">1393</span></a>            <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1394"><a href="#SemanticMemoryManager-1394"><span class="linenos">1394</span></a>            <span class="n">existing_memories</span><span class="o">=</span><span class="n">existing_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1395"><a href="#SemanticMemoryManager-1395"><span class="linenos">1395</span></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1396"><a href="#SemanticMemoryManager-1396"><span class="linenos">1396</span></a>            <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1397"><a href="#SemanticMemoryManager-1397"><span class="linenos">1397</span></a>            <span class="n">delete_memories</span><span class="o">=</span><span class="n">delete_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1398"><a href="#SemanticMemoryManager-1398"><span class="linenos">1398</span></a>            <span class="n">clear_memories</span><span class="o">=</span><span class="n">clear_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1399"><a href="#SemanticMemoryManager-1399"><span class="linenos">1399</span></a>        <span class="p">)</span>
</span><span id="SemanticMemoryManager-1400"><a href="#SemanticMemoryManager-1400"><span class="linenos">1400</span></a>
</span><span id="SemanticMemoryManager-1401"><a href="#SemanticMemoryManager-1401"><span class="linenos">1401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_memory_task</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1402"><a href="#SemanticMemoryManager-1402"><span class="linenos">1402</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1403"><a href="#SemanticMemoryManager-1403"><span class="linenos">1403</span></a>        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1404"><a href="#SemanticMemoryManager-1404"><span class="linenos">1404</span></a>        <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SemanticMemoryManager-1405"><a href="#SemanticMemoryManager-1405"><span class="linenos">1405</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1406"><a href="#SemanticMemoryManager-1406"><span class="linenos">1406</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1407"><a href="#SemanticMemoryManager-1407"><span class="linenos">1407</span></a>        <span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1408"><a href="#SemanticMemoryManager-1408"><span class="linenos">1408</span></a>        <span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1409"><a href="#SemanticMemoryManager-1409"><span class="linenos">1409</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1410"><a href="#SemanticMemoryManager-1410"><span class="linenos">1410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1411"><a href="#SemanticMemoryManager-1411"><span class="linenos">1411</span></a><span class="sd">        Process a memory task without using LLM.</span>
</span><span id="SemanticMemoryManager-1412"><a href="#SemanticMemoryManager-1412"><span class="linenos">1412</span></a>
</span><span id="SemanticMemoryManager-1413"><a href="#SemanticMemoryManager-1413"><span class="linenos">1413</span></a><span class="sd">        This method provides the same interface as Agno&#39;s MemoryManager.run_memory_task</span>
</span><span id="SemanticMemoryManager-1414"><a href="#SemanticMemoryManager-1414"><span class="linenos">1414</span></a><span class="sd">        but uses semantic analysis instead of LLM calls for better performance and reliability.</span>
</span><span id="SemanticMemoryManager-1415"><a href="#SemanticMemoryManager-1415"><span class="linenos">1415</span></a>
</span><span id="SemanticMemoryManager-1416"><a href="#SemanticMemoryManager-1416"><span class="linenos">1416</span></a><span class="sd">        :param task: The task/input text to process for memory extraction</span>
</span><span id="SemanticMemoryManager-1417"><a href="#SemanticMemoryManager-1417"><span class="linenos">1417</span></a><span class="sd">        :param existing_memories: List of existing memory dictionaries</span>
</span><span id="SemanticMemoryManager-1418"><a href="#SemanticMemoryManager-1418"><span class="linenos">1418</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager-1419"><a href="#SemanticMemoryManager-1419"><span class="linenos">1419</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-1420"><a href="#SemanticMemoryManager-1420"><span class="linenos">1420</span></a><span class="sd">        :param delete_memories: Whether deletion is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager-1421"><a href="#SemanticMemoryManager-1421"><span class="linenos">1421</span></a><span class="sd">        :param clear_memories: Whether clearing is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager-1422"><a href="#SemanticMemoryManager-1422"><span class="linenos">1422</span></a><span class="sd">        :return: String describing the actions taken</span>
</span><span id="SemanticMemoryManager-1423"><a href="#SemanticMemoryManager-1423"><span class="linenos">1423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1424"><a href="#SemanticMemoryManager-1424"><span class="linenos">1424</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SemanticMemoryManager.run_memory_task Start&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1425"><a href="#SemanticMemoryManager-1425"><span class="linenos">1425</span></a>
</span><span id="SemanticMemoryManager-1426"><a href="#SemanticMemoryManager-1426"><span class="linenos">1426</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1427"><a href="#SemanticMemoryManager-1427"><span class="linenos">1427</span></a>            <span class="c1"># Extract memorable statements from the task</span>
</span><span id="SemanticMemoryManager-1428"><a href="#SemanticMemoryManager-1428"><span class="linenos">1428</span></a>            <span class="n">memorable_statements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_memorable_statements</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1429"><a href="#SemanticMemoryManager-1429"><span class="linenos">1429</span></a>
</span><span id="SemanticMemoryManager-1430"><a href="#SemanticMemoryManager-1430"><span class="linenos">1430</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1431"><a href="#SemanticMemoryManager-1431"><span class="linenos">1431</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No memorable statements found in task&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1432"><a href="#SemanticMemoryManager-1432"><span class="linenos">1432</span></a>                <span class="k">return</span> <span class="s2">&quot;No memorable information found in the task&quot;</span>
</span><span id="SemanticMemoryManager-1433"><a href="#SemanticMemoryManager-1433"><span class="linenos">1433</span></a>
</span><span id="SemanticMemoryManager-1434"><a href="#SemanticMemoryManager-1434"><span class="linenos">1434</span></a>            <span class="c1"># Convert existing memories to UserMemory-like objects for duplicate checking</span>
</span><span id="SemanticMemoryManager-1435"><a href="#SemanticMemoryManager-1435"><span class="linenos">1435</span></a>            <span class="k">class</span><span class="w"> </span><span class="nc">SimpleMemory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1436"><a href="#SemanticMemoryManager-1436"><span class="linenos">1436</span></a>                <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="SemanticMemoryManager-1437"><a href="#SemanticMemoryManager-1437"><span class="linenos">1437</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">memory_text</span>
</span><span id="SemanticMemoryManager-1438"><a href="#SemanticMemoryManager-1438"><span class="linenos">1438</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">memory_id</span> <span class="o">=</span> <span class="n">memory_id</span>
</span><span id="SemanticMemoryManager-1439"><a href="#SemanticMemoryManager-1439"><span class="linenos">1439</span></a>
</span><span id="SemanticMemoryManager-1440"><a href="#SemanticMemoryManager-1440"><span class="linenos">1440</span></a>            <span class="n">existing_user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-1441"><a href="#SemanticMemoryManager-1441"><span class="linenos">1441</span></a>            <span class="k">for</span> <span class="n">mem_dict</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1442"><a href="#SemanticMemoryManager-1442"><span class="linenos">1442</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1443"><a href="#SemanticMemoryManager-1443"><span class="linenos">1443</span></a>                    <span class="n">memory_text</span> <span class="o">=</span> <span class="n">mem_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1444"><a href="#SemanticMemoryManager-1444"><span class="linenos">1444</span></a>                    <span class="k">if</span> <span class="n">memory_text</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1445"><a href="#SemanticMemoryManager-1445"><span class="linenos">1445</span></a>                        <span class="n">existing_user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1446"><a href="#SemanticMemoryManager-1446"><span class="linenos">1446</span></a>                            <span class="n">SimpleMemory</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">mem_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="SemanticMemoryManager-1447"><a href="#SemanticMemoryManager-1447"><span class="linenos">1447</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager-1448"><a href="#SemanticMemoryManager-1448"><span class="linenos">1448</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1449"><a href="#SemanticMemoryManager-1449"><span class="linenos">1449</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process existing memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1450"><a href="#SemanticMemoryManager-1450"><span class="linenos">1450</span></a>
</span><span id="SemanticMemoryManager-1451"><a href="#SemanticMemoryManager-1451"><span class="linenos">1451</span></a>            <span class="c1"># Process each memorable statement</span>
</span><span id="SemanticMemoryManager-1452"><a href="#SemanticMemoryManager-1452"><span class="linenos">1452</span></a>            <span class="n">actions_taken</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-1453"><a href="#SemanticMemoryManager-1453"><span class="linenos">1453</span></a>            <span class="n">memories_added</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager-1454"><a href="#SemanticMemoryManager-1454"><span class="linenos">1454</span></a>            <span class="n">memories_rejected</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager-1455"><a href="#SemanticMemoryManager-1455"><span class="linenos">1455</span></a>
</span><span id="SemanticMemoryManager-1456"><a href="#SemanticMemoryManager-1456"><span class="linenos">1456</span></a>            <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1457"><a href="#SemanticMemoryManager-1457"><span class="linenos">1457</span></a>                <span class="c1"># Check for duplicates against existing memories</span>
</span><span id="SemanticMemoryManager-1458"><a href="#SemanticMemoryManager-1458"><span class="linenos">1458</span></a>                <span class="n">should_reject</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_reject_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1459"><a href="#SemanticMemoryManager-1459"><span class="linenos">1459</span></a>                    <span class="n">statement</span><span class="p">,</span> <span class="n">existing_user_memories</span>
</span><span id="SemanticMemoryManager-1460"><a href="#SemanticMemoryManager-1460"><span class="linenos">1460</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-1461"><a href="#SemanticMemoryManager-1461"><span class="linenos">1461</span></a>
</span><span id="SemanticMemoryManager-1462"><a href="#SemanticMemoryManager-1462"><span class="linenos">1462</span></a>                <span class="k">if</span> <span class="n">should_reject</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1463"><a href="#SemanticMemoryManager-1463"><span class="linenos">1463</span></a>                    <span class="n">memories_rejected</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1464"><a href="#SemanticMemoryManager-1464"><span class="linenos">1464</span></a>                    <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1465"><a href="#SemanticMemoryManager-1465"><span class="linenos">1465</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected memory: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1466"><a href="#SemanticMemoryManager-1466"><span class="linenos">1466</span></a>                    <span class="k">continue</span>
</span><span id="SemanticMemoryManager-1467"><a href="#SemanticMemoryManager-1467"><span class="linenos">1467</span></a>
</span><span id="SemanticMemoryManager-1468"><a href="#SemanticMemoryManager-1468"><span class="linenos">1468</span></a>                <span class="c1"># Add the memory</span>
</span><span id="SemanticMemoryManager-1469"><a href="#SemanticMemoryManager-1469"><span class="linenos">1469</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1470"><a href="#SemanticMemoryManager-1470"><span class="linenos">1470</span></a>                    <span class="n">memory_text</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1471"><a href="#SemanticMemoryManager-1471"><span class="linenos">1471</span></a>                    <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1472"><a href="#SemanticMemoryManager-1472"><span class="linenos">1472</span></a>                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1473"><a href="#SemanticMemoryManager-1473"><span class="linenos">1473</span></a>                    <span class="n">input_text</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1474"><a href="#SemanticMemoryManager-1474"><span class="linenos">1474</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager-1475"><a href="#SemanticMemoryManager-1475"><span class="linenos">1475</span></a>
</span><span id="SemanticMemoryManager-1476"><a href="#SemanticMemoryManager-1476"><span class="linenos">1476</span></a>                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1477"><a href="#SemanticMemoryManager-1477"><span class="linenos">1477</span></a>                    <span class="n">memories_added</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1478"><a href="#SemanticMemoryManager-1478"><span class="linenos">1478</span></a>                    <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1479"><a href="#SemanticMemoryManager-1479"><span class="linenos">1479</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added memory: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1480"><a href="#SemanticMemoryManager-1480"><span class="linenos">1480</span></a>
</span><span id="SemanticMemoryManager-1481"><a href="#SemanticMemoryManager-1481"><span class="linenos">1481</span></a>                    <span class="c1"># Add to existing memories list for subsequent duplicate checking</span>
</span><span id="SemanticMemoryManager-1482"><a href="#SemanticMemoryManager-1482"><span class="linenos">1482</span></a>                    <span class="n">existing_user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1483"><a href="#SemanticMemoryManager-1483"><span class="linenos">1483</span></a>                        <span class="n">SimpleMemory</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">memory_id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1484"><a href="#SemanticMemoryManager-1484"><span class="linenos">1484</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager-1485"><a href="#SemanticMemoryManager-1485"><span class="linenos">1485</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1486"><a href="#SemanticMemoryManager-1486"><span class="linenos">1486</span></a>                    <span class="n">memories_rejected</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager-1487"><a href="#SemanticMemoryManager-1487"><span class="linenos">1487</span></a>                    <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1488"><a href="#SemanticMemoryManager-1488"><span class="linenos">1488</span></a>                        <span class="sa">f</span><span class="s2">&quot;Failed to add: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; - </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-1489"><a href="#SemanticMemoryManager-1489"><span class="linenos">1489</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager-1490"><a href="#SemanticMemoryManager-1490"><span class="linenos">1490</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to add memory: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1491"><a href="#SemanticMemoryManager-1491"><span class="linenos">1491</span></a>
</span><span id="SemanticMemoryManager-1492"><a href="#SemanticMemoryManager-1492"><span class="linenos">1492</span></a>            <span class="c1"># Set memories_updated flag if any memories were added</span>
</span><span id="SemanticMemoryManager-1493"><a href="#SemanticMemoryManager-1493"><span class="linenos">1493</span></a>            <span class="k">if</span> <span class="n">memories_added</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1494"><a href="#SemanticMemoryManager-1494"><span class="linenos">1494</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager-1495"><a href="#SemanticMemoryManager-1495"><span class="linenos">1495</span></a>
</span><span id="SemanticMemoryManager-1496"><a href="#SemanticMemoryManager-1496"><span class="linenos">1496</span></a>            <span class="c1"># Create response summary</span>
</span><span id="SemanticMemoryManager-1497"><a href="#SemanticMemoryManager-1497"><span class="linenos">1497</span></a>            <span class="n">response_parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticMemoryManager-1498"><a href="#SemanticMemoryManager-1498"><span class="linenos">1498</span></a>                <span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memorable_statements</span><span class="p">)</span><span class="si">}</span><span class="s2"> memorable statements&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1499"><a href="#SemanticMemoryManager-1499"><span class="linenos">1499</span></a>                <span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">memories_added</span><span class="si">}</span><span class="s2"> new memories&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1500"><a href="#SemanticMemoryManager-1500"><span class="linenos">1500</span></a>                <span class="sa">f</span><span class="s2">&quot;Rejected </span><span class="si">{</span><span class="n">memories_rejected</span><span class="si">}</span><span class="s2"> duplicates/invalid memories&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1501"><a href="#SemanticMemoryManager-1501"><span class="linenos">1501</span></a>            <span class="p">]</span>
</span><span id="SemanticMemoryManager-1502"><a href="#SemanticMemoryManager-1502"><span class="linenos">1502</span></a>
</span><span id="SemanticMemoryManager-1503"><a href="#SemanticMemoryManager-1503"><span class="linenos">1503</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span> <span class="ow">and</span> <span class="n">actions_taken</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1504"><a href="#SemanticMemoryManager-1504"><span class="linenos">1504</span></a>                <span class="n">response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Actions taken:&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1505"><a href="#SemanticMemoryManager-1505"><span class="linenos">1505</span></a>                <span class="n">response_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Limit to first 5 actions</span>
</span><span id="SemanticMemoryManager-1506"><a href="#SemanticMemoryManager-1506"><span class="linenos">1506</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1507"><a href="#SemanticMemoryManager-1507"><span class="linenos">1507</span></a>                    <span class="n">response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1508"><a href="#SemanticMemoryManager-1508"><span class="linenos">1508</span></a>                        <span class="sa">f</span><span class="s2">&quot;... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="si">}</span><span class="s2"> more actions&quot;</span>
</span><span id="SemanticMemoryManager-1509"><a href="#SemanticMemoryManager-1509"><span class="linenos">1509</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager-1510"><a href="#SemanticMemoryManager-1510"><span class="linenos">1510</span></a>
</span><span id="SemanticMemoryManager-1511"><a href="#SemanticMemoryManager-1511"><span class="linenos">1511</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;. &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response_parts</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1512"><a href="#SemanticMemoryManager-1512"><span class="linenos">1512</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SemanticMemoryManager.run_memory_task End&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1513"><a href="#SemanticMemoryManager-1513"><span class="linenos">1513</span></a>
</span><span id="SemanticMemoryManager-1514"><a href="#SemanticMemoryManager-1514"><span class="linenos">1514</span></a>            <span class="k">return</span> <span class="n">response</span>
</span><span id="SemanticMemoryManager-1515"><a href="#SemanticMemoryManager-1515"><span class="linenos">1515</span></a>
</span><span id="SemanticMemoryManager-1516"><a href="#SemanticMemoryManager-1516"><span class="linenos">1516</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1517"><a href="#SemanticMemoryManager-1517"><span class="linenos">1517</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error in run_memory_task: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager-1518"><a href="#SemanticMemoryManager-1518"><span class="linenos">1518</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1519"><a href="#SemanticMemoryManager-1519"><span class="linenos">1519</span></a>            <span class="k">return</span> <span class="n">error_msg</span>
</span><span id="SemanticMemoryManager-1520"><a href="#SemanticMemoryManager-1520"><span class="linenos">1520</span></a>
</span><span id="SemanticMemoryManager-1521"><a href="#SemanticMemoryManager-1521"><span class="linenos">1521</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">arun_memory_task</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1522"><a href="#SemanticMemoryManager-1522"><span class="linenos">1522</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1523"><a href="#SemanticMemoryManager-1523"><span class="linenos">1523</span></a>        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1524"><a href="#SemanticMemoryManager-1524"><span class="linenos">1524</span></a>        <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SemanticMemoryManager-1525"><a href="#SemanticMemoryManager-1525"><span class="linenos">1525</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1526"><a href="#SemanticMemoryManager-1526"><span class="linenos">1526</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1527"><a href="#SemanticMemoryManager-1527"><span class="linenos">1527</span></a>        <span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1528"><a href="#SemanticMemoryManager-1528"><span class="linenos">1528</span></a>        <span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1529"><a href="#SemanticMemoryManager-1529"><span class="linenos">1529</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1530"><a href="#SemanticMemoryManager-1530"><span class="linenos">1530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1531"><a href="#SemanticMemoryManager-1531"><span class="linenos">1531</span></a><span class="sd">        Async version of run_memory_task.</span>
</span><span id="SemanticMemoryManager-1532"><a href="#SemanticMemoryManager-1532"><span class="linenos">1532</span></a>
</span><span id="SemanticMemoryManager-1533"><a href="#SemanticMemoryManager-1533"><span class="linenos">1533</span></a><span class="sd">        Since our implementation doesn&#39;t use async operations, this just calls</span>
</span><span id="SemanticMemoryManager-1534"><a href="#SemanticMemoryManager-1534"><span class="linenos">1534</span></a><span class="sd">        the sync version. This maintains compatibility with Agno&#39;s async interface.</span>
</span><span id="SemanticMemoryManager-1535"><a href="#SemanticMemoryManager-1535"><span class="linenos">1535</span></a>
</span><span id="SemanticMemoryManager-1536"><a href="#SemanticMemoryManager-1536"><span class="linenos">1536</span></a><span class="sd">        :param task: The task/input text to process for memory extraction</span>
</span><span id="SemanticMemoryManager-1537"><a href="#SemanticMemoryManager-1537"><span class="linenos">1537</span></a><span class="sd">        :param existing_memories: List of existing memory dictionaries</span>
</span><span id="SemanticMemoryManager-1538"><a href="#SemanticMemoryManager-1538"><span class="linenos">1538</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager-1539"><a href="#SemanticMemoryManager-1539"><span class="linenos">1539</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager-1540"><a href="#SemanticMemoryManager-1540"><span class="linenos">1540</span></a><span class="sd">        :param delete_memories: Whether deletion is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager-1541"><a href="#SemanticMemoryManager-1541"><span class="linenos">1541</span></a><span class="sd">        :param clear_memories: Whether clearing is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager-1542"><a href="#SemanticMemoryManager-1542"><span class="linenos">1542</span></a><span class="sd">        :return: String describing the actions taken</span>
</span><span id="SemanticMemoryManager-1543"><a href="#SemanticMemoryManager-1543"><span class="linenos">1543</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1544"><a href="#SemanticMemoryManager-1544"><span class="linenos">1544</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_memory_task</span><span class="p">(</span>
</span><span id="SemanticMemoryManager-1545"><a href="#SemanticMemoryManager-1545"><span class="linenos">1545</span></a>            <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1546"><a href="#SemanticMemoryManager-1546"><span class="linenos">1546</span></a>            <span class="n">existing_memories</span><span class="o">=</span><span class="n">existing_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1547"><a href="#SemanticMemoryManager-1547"><span class="linenos">1547</span></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1548"><a href="#SemanticMemoryManager-1548"><span class="linenos">1548</span></a>            <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1549"><a href="#SemanticMemoryManager-1549"><span class="linenos">1549</span></a>            <span class="n">delete_memories</span><span class="o">=</span><span class="n">delete_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1550"><a href="#SemanticMemoryManager-1550"><span class="linenos">1550</span></a>            <span class="n">clear_memories</span><span class="o">=</span><span class="n">clear_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1551"><a href="#SemanticMemoryManager-1551"><span class="linenos">1551</span></a>        <span class="p">)</span>
</span><span id="SemanticMemoryManager-1552"><a href="#SemanticMemoryManager-1552"><span class="linenos">1552</span></a>
</span><span id="SemanticMemoryManager-1553"><a href="#SemanticMemoryManager-1553"><span class="linenos">1553</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_memorable_statements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager-1554"><a href="#SemanticMemoryManager-1554"><span class="linenos">1554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1555"><a href="#SemanticMemoryManager-1555"><span class="linenos">1555</span></a><span class="sd">        Extract memorable statements from text using simple heuristics.</span>
</span><span id="SemanticMemoryManager-1556"><a href="#SemanticMemoryManager-1556"><span class="linenos">1556</span></a>
</span><span id="SemanticMemoryManager-1557"><a href="#SemanticMemoryManager-1557"><span class="linenos">1557</span></a><span class="sd">        :param text: Input text</span>
</span><span id="SemanticMemoryManager-1558"><a href="#SemanticMemoryManager-1558"><span class="linenos">1558</span></a><span class="sd">        :return: List of memorable statements</span>
</span><span id="SemanticMemoryManager-1559"><a href="#SemanticMemoryManager-1559"><span class="linenos">1559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager-1560"><a href="#SemanticMemoryManager-1560"><span class="linenos">1560</span></a>        <span class="n">statements</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager-1561"><a href="#SemanticMemoryManager-1561"><span class="linenos">1561</span></a>
</span><span id="SemanticMemoryManager-1562"><a href="#SemanticMemoryManager-1562"><span class="linenos">1562</span></a>        <span class="c1"># Split by sentences</span>
</span><span id="SemanticMemoryManager-1563"><a href="#SemanticMemoryManager-1563"><span class="linenos">1563</span></a>        <span class="n">sentences</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[.!?]+&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1564"><a href="#SemanticMemoryManager-1564"><span class="linenos">1564</span></a>
</span><span id="SemanticMemoryManager-1565"><a href="#SemanticMemoryManager-1565"><span class="linenos">1565</span></a>        <span class="c1"># Patterns that indicate memorable information</span>
</span><span id="SemanticMemoryManager-1566"><a href="#SemanticMemoryManager-1566"><span class="linenos">1566</span></a>        <span class="n">memorable_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticMemoryManager-1567"><a href="#SemanticMemoryManager-1567"><span class="linenos">1567</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi am\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1568"><a href="#SemanticMemoryManager-1568"><span class="linenos">1568</span></a>            <span class="sa">r</span><span class="s2">&quot;\bmy name is\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1569"><a href="#SemanticMemoryManager-1569"><span class="linenos">1569</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi work\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1570"><a href="#SemanticMemoryManager-1570"><span class="linenos">1570</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi live\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1571"><a href="#SemanticMemoryManager-1571"><span class="linenos">1571</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi like\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1572"><a href="#SemanticMemoryManager-1572"><span class="linenos">1572</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi love\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1573"><a href="#SemanticMemoryManager-1573"><span class="linenos">1573</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi hate\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1574"><a href="#SemanticMemoryManager-1574"><span class="linenos">1574</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi prefer\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1575"><a href="#SemanticMemoryManager-1575"><span class="linenos">1575</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi have\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1576"><a href="#SemanticMemoryManager-1576"><span class="linenos">1576</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi study\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1577"><a href="#SemanticMemoryManager-1577"><span class="linenos">1577</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi graduated\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1578"><a href="#SemanticMemoryManager-1578"><span class="linenos">1578</span></a>            <span class="sa">r</span><span class="s2">&quot;\bmy favorite\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1579"><a href="#SemanticMemoryManager-1579"><span class="linenos">1579</span></a>            <span class="sa">r</span><span class="s2">&quot;\bmy goal\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1580"><a href="#SemanticMemoryManager-1580"><span class="linenos">1580</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi want to\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1581"><a href="#SemanticMemoryManager-1581"><span class="linenos">1581</span></a>            <span class="sa">r</span><span class="s2">&quot;\bi plan to\b&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager-1582"><a href="#SemanticMemoryManager-1582"><span class="linenos">1582</span></a>        <span class="p">]</span>
</span><span id="SemanticMemoryManager-1583"><a href="#SemanticMemoryManager-1583"><span class="linenos">1583</span></a>
</span><span id="SemanticMemoryManager-1584"><a href="#SemanticMemoryManager-1584"><span class="linenos">1584</span></a>        <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1585"><a href="#SemanticMemoryManager-1585"><span class="linenos">1585</span></a>            <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticMemoryManager-1586"><a href="#SemanticMemoryManager-1586"><span class="linenos">1586</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># Skip very short sentences</span>
</span><span id="SemanticMemoryManager-1587"><a href="#SemanticMemoryManager-1587"><span class="linenos">1587</span></a>                <span class="k">continue</span>
</span><span id="SemanticMemoryManager-1588"><a href="#SemanticMemoryManager-1588"><span class="linenos">1588</span></a>
</span><span id="SemanticMemoryManager-1589"><a href="#SemanticMemoryManager-1589"><span class="linenos">1589</span></a>            <span class="c1"># Check if sentence contains memorable patterns</span>
</span><span id="SemanticMemoryManager-1590"><a href="#SemanticMemoryManager-1590"><span class="linenos">1590</span></a>            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">memorable_patterns</span><span class="p">:</span>
</span><span id="SemanticMemoryManager-1591"><a href="#SemanticMemoryManager-1591"><span class="linenos">1591</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">sentence</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
</span><span id="SemanticMemoryManager-1592"><a href="#SemanticMemoryManager-1592"><span class="linenos">1592</span></a>                    <span class="n">statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
</span><span id="SemanticMemoryManager-1593"><a href="#SemanticMemoryManager-1593"><span class="linenos">1593</span></a>                    <span class="k">break</span>
</span><span id="SemanticMemoryManager-1594"><a href="#SemanticMemoryManager-1594"><span class="linenos">1594</span></a>
</span><span id="SemanticMemoryManager-1595"><a href="#SemanticMemoryManager-1595"><span class="linenos">1595</span></a>        <span class="k">return</span> <span class="n">statements</span>
</span></pre></div>


            <div class="docstring"><p>Semantic Memory Manager that provides LLM-free memory management.</p>

<p>This manager combines the structure of Agno's MemoryManager with semantic search
and duplicate detection capabilities, without requiring LLM invocation.</p>
</div>


                            <div id="SemanticMemoryManager.__init__" class="classattr">
                                        <input id="SemanticMemoryManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SemanticMemoryManager</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">agno</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">personal_agent</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">semantic_memory_manager</span><span class="o">.</span><span class="n">SemanticMemoryManagerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span>,</span><span class="param">	<span class="n">enable_semantic_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">enable_exact_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">enable_topic_classification</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="SemanticMemoryManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.__init__-323"><a href="#SemanticMemoryManager.__init__-323"><span class="linenos">323</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.__init__-324"><a href="#SemanticMemoryManager.__init__-324"><span class="linenos">324</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-325"><a href="#SemanticMemoryManager.__init__-325"><span class="linenos">325</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-326"><a href="#SemanticMemoryManager.__init__-326"><span class="linenos">326</span></a>        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SemanticMemoryManagerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-327"><a href="#SemanticMemoryManager.__init__-327"><span class="linenos">327</span></a>        <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-328"><a href="#SemanticMemoryManager.__init__-328"><span class="linenos">328</span></a>        <span class="n">enable_semantic_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-329"><a href="#SemanticMemoryManager.__init__-329"><span class="linenos">329</span></a>        <span class="n">enable_exact_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-330"><a href="#SemanticMemoryManager.__init__-330"><span class="linenos">330</span></a>        <span class="n">enable_topic_classification</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-331"><a href="#SemanticMemoryManager.__init__-331"><span class="linenos">331</span></a>        <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-332"><a href="#SemanticMemoryManager.__init__-332"><span class="linenos">332</span></a>    <span class="p">):</span>
</span><span id="SemanticMemoryManager.__init__-333"><a href="#SemanticMemoryManager.__init__-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Semantic Memory Manager.&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.__init__-334"><a href="#SemanticMemoryManager.__init__-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.__init__-335"><a href="#SemanticMemoryManager.__init__-335"><span class="linenos">335</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">SemanticMemoryManagerConfig</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.__init__-336"><a href="#SemanticMemoryManager.__init__-336"><span class="linenos">336</span></a>                <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">similarity_threshold</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-337"><a href="#SemanticMemoryManager.__init__-337"><span class="linenos">337</span></a>                <span class="n">enable_semantic_dedup</span><span class="o">=</span><span class="n">enable_semantic_dedup</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-338"><a href="#SemanticMemoryManager.__init__-338"><span class="linenos">338</span></a>                <span class="n">enable_exact_dedup</span><span class="o">=</span><span class="n">enable_exact_dedup</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-339"><a href="#SemanticMemoryManager.__init__-339"><span class="linenos">339</span></a>                <span class="n">enable_topic_classification</span><span class="o">=</span><span class="n">enable_topic_classification</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-340"><a href="#SemanticMemoryManager.__init__-340"><span class="linenos">340</span></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-341"><a href="#SemanticMemoryManager.__init__-341"><span class="linenos">341</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.__init__-342"><a href="#SemanticMemoryManager.__init__-342"><span class="linenos">342</span></a>
</span><span id="SemanticMemoryManager.__init__-343"><a href="#SemanticMemoryManager.__init__-343"><span class="linenos">343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>  <span class="c1"># Required by Agno Memory class</span>
</span><span id="SemanticMemoryManager.__init__-344"><a href="#SemanticMemoryManager.__init__-344"><span class="linenos">344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span><span id="SemanticMemoryManager.__init__-345"><a href="#SemanticMemoryManager.__init__-345"><span class="linenos">345</span></a>
</span><span id="SemanticMemoryManager.__init__-346"><a href="#SemanticMemoryManager.__init__-346"><span class="linenos">346</span></a>        <span class="c1"># Get the correct path to topics.yaml</span>
</span><span id="SemanticMemoryManager.__init__-347"><a href="#SemanticMemoryManager.__init__-347"><span class="linenos">347</span></a>        <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="SemanticMemoryManager.__init__-348"><a href="#SemanticMemoryManager.__init__-348"><span class="linenos">348</span></a>        <span class="n">topics_yaml_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;topics.yaml&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.__init__-349"><a href="#SemanticMemoryManager.__init__-349"><span class="linenos">349</span></a>
</span><span id="SemanticMemoryManager.__init__-350"><a href="#SemanticMemoryManager.__init__-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span> <span class="o">=</span> <span class="n">TopicClassifier</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">topics_yaml_path</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.__init__-351"><a href="#SemanticMemoryManager.__init__-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_detector</span> <span class="o">=</span> <span class="n">SemanticDuplicateDetector</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.__init__-352"><a href="#SemanticMemoryManager.__init__-352"><span class="linenos">352</span></a>            <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">similarity_threshold</span>
</span><span id="SemanticMemoryManager.__init__-353"><a href="#SemanticMemoryManager.__init__-353"><span class="linenos">353</span></a>        <span class="p">)</span>
</span><span id="SemanticMemoryManager.__init__-354"><a href="#SemanticMemoryManager.__init__-354"><span class="linenos">354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SemanticMemoryManager.__init__-355"><a href="#SemanticMemoryManager.__init__-355"><span class="linenos">355</span></a>
</span><span id="SemanticMemoryManager.__init__-356"><a href="#SemanticMemoryManager.__init__-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.__init__-357"><a href="#SemanticMemoryManager.__init__-357"><span class="linenos">357</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.__init__-358"><a href="#SemanticMemoryManager.__init__-358"><span class="linenos">358</span></a>
</span><span id="SemanticMemoryManager.__init__-359"><a href="#SemanticMemoryManager.__init__-359"><span class="linenos">359</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.__init__-360"><a href="#SemanticMemoryManager.__init__-360"><span class="linenos">360</span></a>            <span class="s2">&quot;Initialized SemanticMemoryManager with similarity_threshold=</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-361"><a href="#SemanticMemoryManager.__init__-361"><span class="linenos">361</span></a>            <span class="n">config</span><span class="o">.</span><span class="n">similarity_threshold</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.__init__-362"><a href="#SemanticMemoryManager.__init__-362"><span class="linenos">362</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the Semantic Memory Manager.</p>
</div>


                            </div>
                            <div id="SemanticMemoryManager.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span><span class="annotation">: Optional[agno.models.base.Model]</span>        =
<span class="default_value">FieldInfo(annotation=NoneType, required=False, default=None)</span>

        
    </div>
    <a class="headerlink" href="#SemanticMemoryManager.model"></a>
    
    

                            </div>
                            <div id="SemanticMemoryManager.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span><span class="annotation">: personal_agent.core.semantic_memory_manager.SemanticMemoryManagerConfig</span>        =
<span class="default_value">FieldInfo(annotation=NoneType, required=False, default_factory=SemanticMemoryManagerConfig)</span>

        
    </div>
    <a class="headerlink" href="#SemanticMemoryManager.config"></a>
    
    

                            </div>
                            <div id="SemanticMemoryManager.topic_classifier" class="classattr">
                                <div class="attr variable">
            <span class="name">topic_classifier</span><span class="annotation">: personal_agent.core.topic_classifier.TopicClassifier</span>        =
<span class="default_value">FieldInfo(annotation=NoneType, required=False, default_factory=TopicClassifier)</span>

        
    </div>
    <a class="headerlink" href="#SemanticMemoryManager.topic_classifier"></a>
    
    

                            </div>
                            <div id="SemanticMemoryManager.duplicate_detector" class="classattr">
                                <div class="attr variable">
            <span class="name">duplicate_detector</span><span class="annotation">: <a href="#SemanticDuplicateDetector">SemanticDuplicateDetector</a></span>        =
<span class="default_value">FieldInfo(annotation=NoneType, required=False, default=None)</span>

        
    </div>
    <a class="headerlink" href="#SemanticMemoryManager.duplicate_detector"></a>
    
    

                            </div>
                            <div id="SemanticMemoryManager.memories_updated" class="classattr">
                                <div class="attr variable">
            <span class="name">memories_updated</span><span class="annotation">: bool</span>        =
<span class="default_value">FieldInfo(annotation=NoneType, required=False, default=False)</span>

        
    </div>
    <a class="headerlink" href="#SemanticMemoryManager.memories_updated"></a>
    
    

                            </div>
                            <div id="SemanticMemoryManager.add_memory" class="classattr">
                                        <input id="SemanticMemoryManager.add_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_memory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">input_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#MemoryStorageResult">MemoryStorageResult</a></span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.add_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.add_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.add_memory-453"><a href="#SemanticMemoryManager.add_memory-453"><span class="linenos">453</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-454"><a href="#SemanticMemoryManager.add_memory-454"><span class="linenos">454</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-455"><a href="#SemanticMemoryManager.add_memory-455"><span class="linenos">455</span></a>        <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-456"><a href="#SemanticMemoryManager.add_memory-456"><span class="linenos">456</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-457"><a href="#SemanticMemoryManager.add_memory-457"><span class="linenos">457</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-458"><a href="#SemanticMemoryManager.add_memory-458"><span class="linenos">458</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-459"><a href="#SemanticMemoryManager.add_memory-459"><span class="linenos">459</span></a>        <span class="n">input_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-460"><a href="#SemanticMemoryManager.add_memory-460"><span class="linenos">460</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryStorageResult</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-461"><a href="#SemanticMemoryManager.add_memory-461"><span class="linenos">461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.add_memory-462"><a href="#SemanticMemoryManager.add_memory-462"><span class="linenos">462</span></a><span class="sd">        Add a memory with duplicate detection and topic classification.</span>
</span><span id="SemanticMemoryManager.add_memory-463"><a href="#SemanticMemoryManager.add_memory-463"><span class="linenos">463</span></a>
</span><span id="SemanticMemoryManager.add_memory-464"><a href="#SemanticMemoryManager.add_memory-464"><span class="linenos">464</span></a><span class="sd">        :param memory_text: The memory text to add</span>
</span><span id="SemanticMemoryManager.add_memory-465"><a href="#SemanticMemoryManager.add_memory-465"><span class="linenos">465</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.add_memory-466"><a href="#SemanticMemoryManager.add_memory-466"><span class="linenos">466</span></a><span class="sd">        :param user_id: User ID for the memory</span>
</span><span id="SemanticMemoryManager.add_memory-467"><a href="#SemanticMemoryManager.add_memory-467"><span class="linenos">467</span></a><span class="sd">        :param topics: Optional list of topics (will be auto-classified if not provided)</span>
</span><span id="SemanticMemoryManager.add_memory-468"><a href="#SemanticMemoryManager.add_memory-468"><span class="linenos">468</span></a><span class="sd">        :param input_text: Optional input text that generated this memory</span>
</span><span id="SemanticMemoryManager.add_memory-469"><a href="#SemanticMemoryManager.add_memory-469"><span class="linenos">469</span></a><span class="sd">        :return: MemoryStorageResult with detailed status information</span>
</span><span id="SemanticMemoryManager.add_memory-470"><a href="#SemanticMemoryManager.add_memory-470"><span class="linenos">470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.add_memory-471"><a href="#SemanticMemoryManager.add_memory-471"><span class="linenos">471</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager.add_memory-472"><a href="#SemanticMemoryManager.add_memory-472"><span class="linenos">472</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-473"><a href="#SemanticMemoryManager.add_memory-473"><span class="linenos">473</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.add_memory-474"><a href="#SemanticMemoryManager.add_memory-474"><span class="linenos">474</span></a>            
</span><span id="SemanticMemoryManager.add_memory-475"><a href="#SemanticMemoryManager.add_memory-475"><span class="linenos">475</span></a>        <span class="c1"># Validate input</span>
</span><span id="SemanticMemoryManager.add_memory-476"><a href="#SemanticMemoryManager.add_memory-476"><span class="linenos">476</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">memory_text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">memory_text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="SemanticMemoryManager.add_memory-477"><a href="#SemanticMemoryManager.add_memory-477"><span class="linenos">477</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-478"><a href="#SemanticMemoryManager.add_memory-478"><span class="linenos">478</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_EMPTY</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-479"><a href="#SemanticMemoryManager.add_memory-479"><span class="linenos">479</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Memory content cannot be empty&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-480"><a href="#SemanticMemoryManager.add_memory-480"><span class="linenos">480</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-481"><a href="#SemanticMemoryManager.add_memory-481"><span class="linenos">481</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SemanticMemoryManager.add_memory-482"><a href="#SemanticMemoryManager.add_memory-482"><span class="linenos">482</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-483"><a href="#SemanticMemoryManager.add_memory-483"><span class="linenos">483</span></a>
</span><span id="SemanticMemoryManager.add_memory-484"><a href="#SemanticMemoryManager.add_memory-484"><span class="linenos">484</span></a>        <span class="c1"># Get recent memories for duplicate checking</span>
</span><span id="SemanticMemoryManager.add_memory-485"><a href="#SemanticMemoryManager.add_memory-485"><span class="linenos">485</span></a>        <span class="n">existing_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_memories</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-486"><a href="#SemanticMemoryManager.add_memory-486"><span class="linenos">486</span></a>
</span><span id="SemanticMemoryManager.add_memory-487"><a href="#SemanticMemoryManager.add_memory-487"><span class="linenos">487</span></a>        <span class="c1"># Check memory length</span>
</span><span id="SemanticMemoryManager.add_memory-488"><a href="#SemanticMemoryManager.add_memory-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_memory_length</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-489"><a href="#SemanticMemoryManager.add_memory-489"><span class="linenos">489</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-490"><a href="#SemanticMemoryManager.add_memory-490"><span class="linenos">490</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_TOO_LONG</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-491"><a href="#SemanticMemoryManager.add_memory-491"><span class="linenos">491</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Memory too long (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memory_text</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_memory_length</span><span class="si">}</span><span class="s2"> chars)&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-492"><a href="#SemanticMemoryManager.add_memory-492"><span class="linenos">492</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-493"><a href="#SemanticMemoryManager.add_memory-493"><span class="linenos">493</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SemanticMemoryManager.add_memory-494"><a href="#SemanticMemoryManager.add_memory-494"><span class="linenos">494</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-495"><a href="#SemanticMemoryManager.add_memory-495"><span class="linenos">495</span></a>
</span><span id="SemanticMemoryManager.add_memory-496"><a href="#SemanticMemoryManager.add_memory-496"><span class="linenos">496</span></a>        <span class="c1"># Check for exact duplicates</span>
</span><span id="SemanticMemoryManager.add_memory-497"><a href="#SemanticMemoryManager.add_memory-497"><span class="linenos">497</span></a>        <span class="n">exact_duplicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_exact_duplicate</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-498"><a href="#SemanticMemoryManager.add_memory-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="n">exact_duplicate</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-499"><a href="#SemanticMemoryManager.add_memory-499"><span class="linenos">499</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-500"><a href="#SemanticMemoryManager.add_memory-500"><span class="linenos">500</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_EXACT</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-501"><a href="#SemanticMemoryManager.add_memory-501"><span class="linenos">501</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Exact duplicate of: &#39;</span><span class="si">{</span><span class="n">exact_duplicate</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-502"><a href="#SemanticMemoryManager.add_memory-502"><span class="linenos">502</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-503"><a href="#SemanticMemoryManager.add_memory-503"><span class="linenos">503</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-504"><a href="#SemanticMemoryManager.add_memory-504"><span class="linenos">504</span></a>                <span class="n">similarity_score</span><span class="o">=</span><span class="mf">1.0</span>
</span><span id="SemanticMemoryManager.add_memory-505"><a href="#SemanticMemoryManager.add_memory-505"><span class="linenos">505</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-506"><a href="#SemanticMemoryManager.add_memory-506"><span class="linenos">506</span></a>
</span><span id="SemanticMemoryManager.add_memory-507"><a href="#SemanticMemoryManager.add_memory-507"><span class="linenos">507</span></a>        <span class="c1"># Check for semantic duplicates</span>
</span><span id="SemanticMemoryManager.add_memory-508"><a href="#SemanticMemoryManager.add_memory-508"><span class="linenos">508</span></a>        <span class="n">semantic_duplicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_semantic_duplicate</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">existing_memories</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-509"><a href="#SemanticMemoryManager.add_memory-509"><span class="linenos">509</span></a>        <span class="k">if</span> <span class="n">semantic_duplicate</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-510"><a href="#SemanticMemoryManager.add_memory-510"><span class="linenos">510</span></a>            <span class="c1"># Get similarity score for the duplicate</span>
</span><span id="SemanticMemoryManager.add_memory-511"><a href="#SemanticMemoryManager.add_memory-511"><span class="linenos">511</span></a>            <span class="n">existing_texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">mem</span><span class="o">.</span><span class="n">memory</span> <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">]</span>
</span><span id="SemanticMemoryManager.add_memory-512"><a href="#SemanticMemoryManager.add_memory-512"><span class="linenos">512</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">similarity_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_detector</span><span class="o">.</span><span class="n">is_duplicate</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">existing_texts</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-513"><a href="#SemanticMemoryManager.add_memory-513"><span class="linenos">513</span></a>            
</span><span id="SemanticMemoryManager.add_memory-514"><a href="#SemanticMemoryManager.add_memory-514"><span class="linenos">514</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-515"><a href="#SemanticMemoryManager.add_memory-515"><span class="linenos">515</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_SEMANTIC</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-516"><a href="#SemanticMemoryManager.add_memory-516"><span class="linenos">516</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Semantic duplicate of: &#39;</span><span class="si">{</span><span class="n">semantic_duplicate</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-517"><a href="#SemanticMemoryManager.add_memory-517"><span class="linenos">517</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-518"><a href="#SemanticMemoryManager.add_memory-518"><span class="linenos">518</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-519"><a href="#SemanticMemoryManager.add_memory-519"><span class="linenos">519</span></a>                <span class="n">similarity_score</span><span class="o">=</span><span class="n">similarity_score</span>
</span><span id="SemanticMemoryManager.add_memory-520"><a href="#SemanticMemoryManager.add_memory-520"><span class="linenos">520</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-521"><a href="#SemanticMemoryManager.add_memory-521"><span class="linenos">521</span></a>
</span><span id="SemanticMemoryManager.add_memory-522"><a href="#SemanticMemoryManager.add_memory-522"><span class="linenos">522</span></a>        <span class="c1"># Auto-classify topics if not provided</span>
</span><span id="SemanticMemoryManager.add_memory-523"><a href="#SemanticMemoryManager.add_memory-523"><span class="linenos">523</span></a>        <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_topic_classification</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-524"><a href="#SemanticMemoryManager.add_memory-524"><span class="linenos">524</span></a>            <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">memory_text</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-525"><a href="#SemanticMemoryManager.add_memory-525"><span class="linenos">525</span></a>
</span><span id="SemanticMemoryManager.add_memory-526"><a href="#SemanticMemoryManager.add_memory-526"><span class="linenos">526</span></a>        <span class="c1"># Create the memory</span>
</span><span id="SemanticMemoryManager.add_memory-527"><a href="#SemanticMemoryManager.add_memory-527"><span class="linenos">527</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-528"><a href="#SemanticMemoryManager.add_memory-528"><span class="linenos">528</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>
</span><span id="SemanticMemoryManager.add_memory-529"><a href="#SemanticMemoryManager.add_memory-529"><span class="linenos">529</span></a>
</span><span id="SemanticMemoryManager.add_memory-530"><a href="#SemanticMemoryManager.add_memory-530"><span class="linenos">530</span></a>            <span class="n">memory_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="SemanticMemoryManager.add_memory-531"><a href="#SemanticMemoryManager.add_memory-531"><span class="linenos">531</span></a>            <span class="n">last_updated</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.add_memory-532"><a href="#SemanticMemoryManager.add_memory-532"><span class="linenos">532</span></a>
</span><span id="SemanticMemoryManager.add_memory-533"><a href="#SemanticMemoryManager.add_memory-533"><span class="linenos">533</span></a>            <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-534"><a href="#SemanticMemoryManager.add_memory-534"><span class="linenos">534</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-535"><a href="#SemanticMemoryManager.add_memory-535"><span class="linenos">535</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">memory_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-536"><a href="#SemanticMemoryManager.add_memory-536"><span class="linenos">536</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-537"><a href="#SemanticMemoryManager.add_memory-537"><span class="linenos">537</span></a>                <span class="n">last_updated</span><span class="o">=</span><span class="n">last_updated</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-538"><a href="#SemanticMemoryManager.add_memory-538"><span class="linenos">538</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">input_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-539"><a href="#SemanticMemoryManager.add_memory-539"><span class="linenos">539</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-540"><a href="#SemanticMemoryManager.add_memory-540"><span class="linenos">540</span></a>
</span><span id="SemanticMemoryManager.add_memory-541"><a href="#SemanticMemoryManager.add_memory-541"><span class="linenos">541</span></a>            <span class="n">memory_row</span> <span class="o">=</span> <span class="n">MemoryRow</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-542"><a href="#SemanticMemoryManager.add_memory-542"><span class="linenos">542</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-543"><a href="#SemanticMemoryManager.add_memory-543"><span class="linenos">543</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-544"><a href="#SemanticMemoryManager.add_memory-544"><span class="linenos">544</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">user_memory</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="SemanticMemoryManager.add_memory-545"><a href="#SemanticMemoryManager.add_memory-545"><span class="linenos">545</span></a>                <span class="n">last_updated</span><span class="o">=</span><span class="n">last_updated</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-546"><a href="#SemanticMemoryManager.add_memory-546"><span class="linenos">546</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-547"><a href="#SemanticMemoryManager.add_memory-547"><span class="linenos">547</span></a>
</span><span id="SemanticMemoryManager.add_memory-548"><a href="#SemanticMemoryManager.add_memory-548"><span class="linenos">548</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">upsert_memory</span><span class="p">(</span><span class="n">memory_row</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-549"><a href="#SemanticMemoryManager.add_memory-549"><span class="linenos">549</span></a>
</span><span id="SemanticMemoryManager.add_memory-550"><a href="#SemanticMemoryManager.add_memory-550"><span class="linenos">550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager.add_memory-551"><a href="#SemanticMemoryManager.add_memory-551"><span class="linenos">551</span></a>
</span><span id="SemanticMemoryManager.add_memory-552"><a href="#SemanticMemoryManager.add_memory-552"><span class="linenos">552</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-553"><a href="#SemanticMemoryManager.add_memory-553"><span class="linenos">553</span></a>                <span class="s2">&quot;Added memory for user </span><span class="si">%s</span><span class="s2">: &#39;</span><span class="si">%s</span><span class="s2">&#39; (topics: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-554"><a href="#SemanticMemoryManager.add_memory-554"><span class="linenos">554</span></a>                <span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-555"><a href="#SemanticMemoryManager.add_memory-555"><span class="linenos">555</span></a>                <span class="n">memory_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-556"><a href="#SemanticMemoryManager.add_memory-556"><span class="linenos">556</span></a>                <span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-557"><a href="#SemanticMemoryManager.add_memory-557"><span class="linenos">557</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-558"><a href="#SemanticMemoryManager.add_memory-558"><span class="linenos">558</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-559"><a href="#SemanticMemoryManager.add_memory-559"><span class="linenos">559</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ ACCEPTED: &#39;</span><span class="si">{</span><span class="n">memory_text</span><span class="si">}</span><span class="s2">&#39; (topics: </span><span class="si">{</span><span class="n">topics</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-560"><a href="#SemanticMemoryManager.add_memory-560"><span class="linenos">560</span></a>
</span><span id="SemanticMemoryManager.add_memory-561"><a href="#SemanticMemoryManager.add_memory-561"><span class="linenos">561</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-562"><a href="#SemanticMemoryManager.add_memory-562"><span class="linenos">562</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-563"><a href="#SemanticMemoryManager.add_memory-563"><span class="linenos">563</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Memory added successfully&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-564"><a href="#SemanticMemoryManager.add_memory-564"><span class="linenos">564</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-565"><a href="#SemanticMemoryManager.add_memory-565"><span class="linenos">565</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-566"><a href="#SemanticMemoryManager.add_memory-566"><span class="linenos">566</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-567"><a href="#SemanticMemoryManager.add_memory-567"><span class="linenos">567</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Will be updated by the caller for dual storage</span>
</span><span id="SemanticMemoryManager.add_memory-568"><a href="#SemanticMemoryManager.add_memory-568"><span class="linenos">568</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-569"><a href="#SemanticMemoryManager.add_memory-569"><span class="linenos">569</span></a>
</span><span id="SemanticMemoryManager.add_memory-570"><a href="#SemanticMemoryManager.add_memory-570"><span class="linenos">570</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.add_memory-571"><a href="#SemanticMemoryManager.add_memory-571"><span class="linenos">571</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error adding memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.add_memory-572"><a href="#SemanticMemoryManager.add_memory-572"><span class="linenos">572</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.add_memory-573"><a href="#SemanticMemoryManager.add_memory-573"><span class="linenos">573</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.add_memory-574"><a href="#SemanticMemoryManager.add_memory-574"><span class="linenos">574</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">STORAGE_ERROR</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-575"><a href="#SemanticMemoryManager.add_memory-575"><span class="linenos">575</span></a>                <span class="n">message</span><span class="o">=</span><span class="n">error_msg</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-576"><a href="#SemanticMemoryManager.add_memory-576"><span class="linenos">576</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.add_memory-577"><a href="#SemanticMemoryManager.add_memory-577"><span class="linenos">577</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SemanticMemoryManager.add_memory-578"><a href="#SemanticMemoryManager.add_memory-578"><span class="linenos">578</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add a memory with duplicate detection and topic classification.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>memory_text</strong>:  The memory text to add</li>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID for the memory</li>
<li><strong>topics</strong>:  Optional list of topics (will be auto-classified if not provided)</li>
<li><strong>input_text</strong>:  Optional input text that generated this memory</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>MemoryStorageResult with detailed status information</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.update_memory" class="classattr">
                                        <input id="SemanticMemoryManager.update_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_memory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">input_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.update_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.update_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.update_memory-580"><a href="#SemanticMemoryManager.update_memory-580"><span class="linenos">580</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.update_memory-581"><a href="#SemanticMemoryManager.update_memory-581"><span class="linenos">581</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-582"><a href="#SemanticMemoryManager.update_memory-582"><span class="linenos">582</span></a>        <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-583"><a href="#SemanticMemoryManager.update_memory-583"><span class="linenos">583</span></a>        <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-584"><a href="#SemanticMemoryManager.update_memory-584"><span class="linenos">584</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-585"><a href="#SemanticMemoryManager.update_memory-585"><span class="linenos">585</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-586"><a href="#SemanticMemoryManager.update_memory-586"><span class="linenos">586</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-587"><a href="#SemanticMemoryManager.update_memory-587"><span class="linenos">587</span></a>        <span class="n">input_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-588"><a href="#SemanticMemoryManager.update_memory-588"><span class="linenos">588</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.update_memory-589"><a href="#SemanticMemoryManager.update_memory-589"><span class="linenos">589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.update_memory-590"><a href="#SemanticMemoryManager.update_memory-590"><span class="linenos">590</span></a><span class="sd">        Update an existing memory.</span>
</span><span id="SemanticMemoryManager.update_memory-591"><a href="#SemanticMemoryManager.update_memory-591"><span class="linenos">591</span></a>
</span><span id="SemanticMemoryManager.update_memory-592"><a href="#SemanticMemoryManager.update_memory-592"><span class="linenos">592</span></a><span class="sd">        :param memory_id: ID of the memory to update</span>
</span><span id="SemanticMemoryManager.update_memory-593"><a href="#SemanticMemoryManager.update_memory-593"><span class="linenos">593</span></a><span class="sd">        :param memory_text: New memory text</span>
</span><span id="SemanticMemoryManager.update_memory-594"><a href="#SemanticMemoryManager.update_memory-594"><span class="linenos">594</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.update_memory-595"><a href="#SemanticMemoryManager.update_memory-595"><span class="linenos">595</span></a><span class="sd">        :param user_id: User ID for the memory</span>
</span><span id="SemanticMemoryManager.update_memory-596"><a href="#SemanticMemoryManager.update_memory-596"><span class="linenos">596</span></a><span class="sd">        :param topics: Optional list of topics (will be auto-classified if not provided)</span>
</span><span id="SemanticMemoryManager.update_memory-597"><a href="#SemanticMemoryManager.update_memory-597"><span class="linenos">597</span></a><span class="sd">        :param input_text: Optional input text that generated this memory</span>
</span><span id="SemanticMemoryManager.update_memory-598"><a href="#SemanticMemoryManager.update_memory-598"><span class="linenos">598</span></a><span class="sd">        :return: Tuple of (success, message)</span>
</span><span id="SemanticMemoryManager.update_memory-599"><a href="#SemanticMemoryManager.update_memory-599"><span class="linenos">599</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.update_memory-600"><a href="#SemanticMemoryManager.update_memory-600"><span class="linenos">600</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager.update_memory-601"><a href="#SemanticMemoryManager.update_memory-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.update_memory-602"><a href="#SemanticMemoryManager.update_memory-602"><span class="linenos">602</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.update_memory-603"><a href="#SemanticMemoryManager.update_memory-603"><span class="linenos">603</span></a>            
</span><span id="SemanticMemoryManager.update_memory-604"><a href="#SemanticMemoryManager.update_memory-604"><span class="linenos">604</span></a>        <span class="c1"># Auto-classify topics if not provided</span>
</span><span id="SemanticMemoryManager.update_memory-605"><a href="#SemanticMemoryManager.update_memory-605"><span class="linenos">605</span></a>        <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_topic_classification</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.update_memory-606"><a href="#SemanticMemoryManager.update_memory-606"><span class="linenos">606</span></a>            <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">memory_text</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.update_memory-607"><a href="#SemanticMemoryManager.update_memory-607"><span class="linenos">607</span></a>
</span><span id="SemanticMemoryManager.update_memory-608"><a href="#SemanticMemoryManager.update_memory-608"><span class="linenos">608</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.update_memory-609"><a href="#SemanticMemoryManager.update_memory-609"><span class="linenos">609</span></a>            <span class="n">last_updated</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.update_memory-610"><a href="#SemanticMemoryManager.update_memory-610"><span class="linenos">610</span></a>
</span><span id="SemanticMemoryManager.update_memory-611"><a href="#SemanticMemoryManager.update_memory-611"><span class="linenos">611</span></a>            <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.update_memory-612"><a href="#SemanticMemoryManager.update_memory-612"><span class="linenos">612</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-613"><a href="#SemanticMemoryManager.update_memory-613"><span class="linenos">613</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">memory_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-614"><a href="#SemanticMemoryManager.update_memory-614"><span class="linenos">614</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-615"><a href="#SemanticMemoryManager.update_memory-615"><span class="linenos">615</span></a>                <span class="n">last_updated</span><span class="o">=</span><span class="n">last_updated</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-616"><a href="#SemanticMemoryManager.update_memory-616"><span class="linenos">616</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">input_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-617"><a href="#SemanticMemoryManager.update_memory-617"><span class="linenos">617</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.update_memory-618"><a href="#SemanticMemoryManager.update_memory-618"><span class="linenos">618</span></a>
</span><span id="SemanticMemoryManager.update_memory-619"><a href="#SemanticMemoryManager.update_memory-619"><span class="linenos">619</span></a>            <span class="n">memory_row</span> <span class="o">=</span> <span class="n">MemoryRow</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.update_memory-620"><a href="#SemanticMemoryManager.update_memory-620"><span class="linenos">620</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-621"><a href="#SemanticMemoryManager.update_memory-621"><span class="linenos">621</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-622"><a href="#SemanticMemoryManager.update_memory-622"><span class="linenos">622</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">user_memory</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="SemanticMemoryManager.update_memory-623"><a href="#SemanticMemoryManager.update_memory-623"><span class="linenos">623</span></a>                <span class="n">last_updated</span><span class="o">=</span><span class="n">last_updated</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.update_memory-624"><a href="#SemanticMemoryManager.update_memory-624"><span class="linenos">624</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.update_memory-625"><a href="#SemanticMemoryManager.update_memory-625"><span class="linenos">625</span></a>
</span><span id="SemanticMemoryManager.update_memory-626"><a href="#SemanticMemoryManager.update_memory-626"><span class="linenos">626</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">upsert_memory</span><span class="p">(</span><span class="n">memory_row</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.update_memory-627"><a href="#SemanticMemoryManager.update_memory-627"><span class="linenos">627</span></a>
</span><span id="SemanticMemoryManager.update_memory-628"><a href="#SemanticMemoryManager.update_memory-628"><span class="linenos">628</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager.update_memory-629"><a href="#SemanticMemoryManager.update_memory-629"><span class="linenos">629</span></a>
</span><span id="SemanticMemoryManager.update_memory-630"><a href="#SemanticMemoryManager.update_memory-630"><span class="linenos">630</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.update_memory-631"><a href="#SemanticMemoryManager.update_memory-631"><span class="linenos">631</span></a>                <span class="s2">&quot;Updated memory </span><span class="si">%s</span><span class="s2"> for user </span><span class="si">%s</span><span class="s2">: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_text</span>
</span><span id="SemanticMemoryManager.update_memory-632"><a href="#SemanticMemoryManager.update_memory-632"><span class="linenos">632</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.update_memory-633"><a href="#SemanticMemoryManager.update_memory-633"><span class="linenos">633</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.update_memory-634"><a href="#SemanticMemoryManager.update_memory-634"><span class="linenos">634</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔄 UPDATED: &#39;</span><span class="si">{</span><span class="n">memory_text</span><span class="si">}</span><span class="s2">&#39; (topics: </span><span class="si">{</span><span class="n">topics</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.update_memory-635"><a href="#SemanticMemoryManager.update_memory-635"><span class="linenos">635</span></a>
</span><span id="SemanticMemoryManager.update_memory-636"><a href="#SemanticMemoryManager.update_memory-636"><span class="linenos">636</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Memory updated successfully&quot;</span>
</span><span id="SemanticMemoryManager.update_memory-637"><a href="#SemanticMemoryManager.update_memory-637"><span class="linenos">637</span></a>
</span><span id="SemanticMemoryManager.update_memory-638"><a href="#SemanticMemoryManager.update_memory-638"><span class="linenos">638</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.update_memory-639"><a href="#SemanticMemoryManager.update_memory-639"><span class="linenos">639</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error updating memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.update_memory-640"><a href="#SemanticMemoryManager.update_memory-640"><span class="linenos">640</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.update_memory-641"><a href="#SemanticMemoryManager.update_memory-641"><span class="linenos">641</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span>
</span></pre></div>


            <div class="docstring"><p>Update an existing memory.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>memory_id</strong>:  ID of the memory to update</li>
<li><strong>memory_text</strong>:  New memory text</li>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID for the memory</li>
<li><strong>topics</strong>:  Optional list of topics (will be auto-classified if not provided)</li>
<li><strong>input_text</strong>:  Optional input text that generated this memory</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Tuple of (success, message)</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.delete_memory" class="classattr">
                                        <input id="SemanticMemoryManager.delete_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete_memory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.delete_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.delete_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.delete_memory-643"><a href="#SemanticMemoryManager.delete_memory-643"><span class="linenos">643</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.delete_memory-644"><a href="#SemanticMemoryManager.delete_memory-644"><span class="linenos">644</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager.delete_memory-645"><a href="#SemanticMemoryManager.delete_memory-645"><span class="linenos">645</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.delete_memory-646"><a href="#SemanticMemoryManager.delete_memory-646"><span class="linenos">646</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.delete_memory-647"><a href="#SemanticMemoryManager.delete_memory-647"><span class="linenos">647</span></a><span class="sd">        Delete a memory.</span>
</span><span id="SemanticMemoryManager.delete_memory-648"><a href="#SemanticMemoryManager.delete_memory-648"><span class="linenos">648</span></a>
</span><span id="SemanticMemoryManager.delete_memory-649"><a href="#SemanticMemoryManager.delete_memory-649"><span class="linenos">649</span></a><span class="sd">        :param memory_id: ID of the memory to delete</span>
</span><span id="SemanticMemoryManager.delete_memory-650"><a href="#SemanticMemoryManager.delete_memory-650"><span class="linenos">650</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.delete_memory-651"><a href="#SemanticMemoryManager.delete_memory-651"><span class="linenos">651</span></a><span class="sd">        :param user_id: User ID for the memory</span>
</span><span id="SemanticMemoryManager.delete_memory-652"><a href="#SemanticMemoryManager.delete_memory-652"><span class="linenos">652</span></a><span class="sd">        :return: Tuple of (success, message)</span>
</span><span id="SemanticMemoryManager.delete_memory-653"><a href="#SemanticMemoryManager.delete_memory-653"><span class="linenos">653</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.delete_memory-654"><a href="#SemanticMemoryManager.delete_memory-654"><span class="linenos">654</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memory-655"><a href="#SemanticMemoryManager.delete_memory-655"><span class="linenos">655</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">memory_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memory-656"><a href="#SemanticMemoryManager.delete_memory-656"><span class="linenos">656</span></a>
</span><span id="SemanticMemoryManager.delete_memory-657"><a href="#SemanticMemoryManager.delete_memory-657"><span class="linenos">657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager.delete_memory-658"><a href="#SemanticMemoryManager.delete_memory-658"><span class="linenos">658</span></a>
</span><span id="SemanticMemoryManager.delete_memory-659"><a href="#SemanticMemoryManager.delete_memory-659"><span class="linenos">659</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted memory </span><span class="si">%s</span><span class="s2"> for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memory-660"><a href="#SemanticMemoryManager.delete_memory-660"><span class="linenos">660</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memory-661"><a href="#SemanticMemoryManager.delete_memory-661"><span class="linenos">661</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🗑️ DELETED: </span><span class="si">{</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memory-662"><a href="#SemanticMemoryManager.delete_memory-662"><span class="linenos">662</span></a>
</span><span id="SemanticMemoryManager.delete_memory-663"><a href="#SemanticMemoryManager.delete_memory-663"><span class="linenos">663</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Memory deleted successfully&quot;</span>
</span><span id="SemanticMemoryManager.delete_memory-664"><a href="#SemanticMemoryManager.delete_memory-664"><span class="linenos">664</span></a>
</span><span id="SemanticMemoryManager.delete_memory-665"><a href="#SemanticMemoryManager.delete_memory-665"><span class="linenos">665</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memory-666"><a href="#SemanticMemoryManager.delete_memory-666"><span class="linenos">666</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error deleting memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.delete_memory-667"><a href="#SemanticMemoryManager.delete_memory-667"><span class="linenos">667</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memory-668"><a href="#SemanticMemoryManager.delete_memory-668"><span class="linenos">668</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span>
</span></pre></div>


            <div class="docstring"><p>Delete a memory.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>memory_id</strong>:  ID of the memory to delete</li>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID for the memory</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Tuple of (success, message)</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.delete_memories_by_topic" class="classattr">
                                        <input id="SemanticMemoryManager.delete_memories_by_topic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete_memories_by_topic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.delete_memories_by_topic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.delete_memories_by_topic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.delete_memories_by_topic-670"><a href="#SemanticMemoryManager.delete_memories_by_topic-670"><span class="linenos">670</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_memories_by_topic</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-671"><a href="#SemanticMemoryManager.delete_memories_by_topic-671"><span class="linenos">671</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-672"><a href="#SemanticMemoryManager.delete_memories_by_topic-672"><span class="linenos">672</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-673"><a href="#SemanticMemoryManager.delete_memories_by_topic-673"><span class="linenos">673</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-674"><a href="#SemanticMemoryManager.delete_memories_by_topic-674"><span class="linenos">674</span></a><span class="sd">        Delete all memories associated with a specific topic or list of topics.</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-675"><a href="#SemanticMemoryManager.delete_memories_by_topic-675"><span class="linenos">675</span></a>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-676"><a href="#SemanticMemoryManager.delete_memories_by_topic-676"><span class="linenos">676</span></a><span class="sd">        :param topics: A list of topics to delete memories for.</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-677"><a href="#SemanticMemoryManager.delete_memories_by_topic-677"><span class="linenos">677</span></a><span class="sd">        :param db: Memory database instance.</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-678"><a href="#SemanticMemoryManager.delete_memories_by_topic-678"><span class="linenos">678</span></a><span class="sd">        :param user_id: User ID for the memories.</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-679"><a href="#SemanticMemoryManager.delete_memories_by_topic-679"><span class="linenos">679</span></a><span class="sd">        :return: Tuple of (success, message).</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-680"><a href="#SemanticMemoryManager.delete_memories_by_topic-680"><span class="linenos">680</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-681"><a href="#SemanticMemoryManager.delete_memories_by_topic-681"><span class="linenos">681</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-682"><a href="#SemanticMemoryManager.delete_memories_by_topic-682"><span class="linenos">682</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-683"><a href="#SemanticMemoryManager.delete_memories_by_topic-683"><span class="linenos">683</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-684"><a href="#SemanticMemoryManager.delete_memories_by_topic-684"><span class="linenos">684</span></a>            
</span><span id="SemanticMemoryManager.delete_memories_by_topic-685"><a href="#SemanticMemoryManager.delete_memories_by_topic-685"><span class="linenos">685</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-686"><a href="#SemanticMemoryManager.delete_memories_by_topic-686"><span class="linenos">686</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No topics provided for deletion.&quot;</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-687"><a href="#SemanticMemoryManager.delete_memories_by_topic-687"><span class="linenos">687</span></a>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-688"><a href="#SemanticMemoryManager.delete_memories_by_topic-688"><span class="linenos">688</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-689"><a href="#SemanticMemoryManager.delete_memories_by_topic-689"><span class="linenos">689</span></a>            <span class="c1"># Get all memories for the specified topics</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-690"><a href="#SemanticMemoryManager.delete_memories_by_topic-690"><span class="linenos">690</span></a>            <span class="n">memories_to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memories_by_topic</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-691"><a href="#SemanticMemoryManager.delete_memories_by_topic-691"><span class="linenos">691</span></a>                <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="n">topics</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-692"><a href="#SemanticMemoryManager.delete_memories_by_topic-692"><span class="linenos">692</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-693"><a href="#SemanticMemoryManager.delete_memories_by_topic-693"><span class="linenos">693</span></a>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-694"><a href="#SemanticMemoryManager.delete_memories_by_topic-694"><span class="linenos">694</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories_to_delete</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-695"><a href="#SemanticMemoryManager.delete_memories_by_topic-695"><span class="linenos">695</span></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-696"><a href="#SemanticMemoryManager.delete_memories_by_topic-696"><span class="linenos">696</span></a>                    <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-697"><a href="#SemanticMemoryManager.delete_memories_by_topic-697"><span class="linenos">697</span></a>                    <span class="sa">f</span><span class="s2">&quot;No memories found for topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-698"><a href="#SemanticMemoryManager.delete_memories_by_topic-698"><span class="linenos">698</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-699"><a href="#SemanticMemoryManager.delete_memories_by_topic-699"><span class="linenos">699</span></a>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-700"><a href="#SemanticMemoryManager.delete_memories_by_topic-700"><span class="linenos">700</span></a>            <span class="n">deleted_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-701"><a href="#SemanticMemoryManager.delete_memories_by_topic-701"><span class="linenos">701</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories_to_delete</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-702"><a href="#SemanticMemoryManager.delete_memories_by_topic-702"><span class="linenos">702</span></a>                <span class="n">success</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-703"><a href="#SemanticMemoryManager.delete_memories_by_topic-703"><span class="linenos">703</span></a>                    <span class="n">memory_id</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">memory_id</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-704"><a href="#SemanticMemoryManager.delete_memories_by_topic-704"><span class="linenos">704</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-705"><a href="#SemanticMemoryManager.delete_memories_by_topic-705"><span class="linenos">705</span></a>                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-706"><a href="#SemanticMemoryManager.delete_memories_by_topic-706"><span class="linenos">706</span></a>                    <span class="n">deleted_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-707"><a href="#SemanticMemoryManager.delete_memories_by_topic-707"><span class="linenos">707</span></a>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-708"><a href="#SemanticMemoryManager.delete_memories_by_topic-708"><span class="linenos">708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-709"><a href="#SemanticMemoryManager.delete_memories_by_topic-709"><span class="linenos">709</span></a>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-710"><a href="#SemanticMemoryManager.delete_memories_by_topic-710"><span class="linenos">710</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-711"><a href="#SemanticMemoryManager.delete_memories_by_topic-711"><span class="linenos">711</span></a>                <span class="s2">&quot;Deleted </span><span class="si">%d</span><span class="s2"> memories for topics &#39;</span><span class="si">%s</span><span class="s2">&#39; for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-712"><a href="#SemanticMemoryManager.delete_memories_by_topic-712"><span class="linenos">712</span></a>                <span class="n">deleted_count</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-713"><a href="#SemanticMemoryManager.delete_memories_by_topic-713"><span class="linenos">713</span></a>                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">),</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-714"><a href="#SemanticMemoryManager.delete_memories_by_topic-714"><span class="linenos">714</span></a>                <span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-715"><a href="#SemanticMemoryManager.delete_memories_by_topic-715"><span class="linenos">715</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-716"><a href="#SemanticMemoryManager.delete_memories_by_topic-716"><span class="linenos">716</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-717"><a href="#SemanticMemoryManager.delete_memories_by_topic-717"><span class="linenos">717</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-718"><a href="#SemanticMemoryManager.delete_memories_by_topic-718"><span class="linenos">718</span></a>                    <span class="sa">f</span><span class="s2">&quot;🗑️ DELETED BY TOPIC: </span><span class="si">{</span><span class="n">deleted_count</span><span class="si">}</span><span class="s2"> memories for topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-719"><a href="#SemanticMemoryManager.delete_memories_by_topic-719"><span class="linenos">719</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-720"><a href="#SemanticMemoryManager.delete_memories_by_topic-720"><span class="linenos">720</span></a>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-721"><a href="#SemanticMemoryManager.delete_memories_by_topic-721"><span class="linenos">721</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-722"><a href="#SemanticMemoryManager.delete_memories_by_topic-722"><span class="linenos">722</span></a>                <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-723"><a href="#SemanticMemoryManager.delete_memories_by_topic-723"><span class="linenos">723</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully deleted </span><span class="si">{</span><span class="n">deleted_count</span><span class="si">}</span><span class="s2"> memories for topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-724"><a href="#SemanticMemoryManager.delete_memories_by_topic-724"><span class="linenos">724</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-725"><a href="#SemanticMemoryManager.delete_memories_by_topic-725"><span class="linenos">725</span></a>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-726"><a href="#SemanticMemoryManager.delete_memories_by_topic-726"><span class="linenos">726</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-727"><a href="#SemanticMemoryManager.delete_memories_by_topic-727"><span class="linenos">727</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error deleting memories by topic: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-728"><a href="#SemanticMemoryManager.delete_memories_by_topic-728"><span class="linenos">728</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.delete_memories_by_topic-729"><a href="#SemanticMemoryManager.delete_memories_by_topic-729"><span class="linenos">729</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span>
</span></pre></div>


            <div class="docstring"><p>Delete all memories associated with a specific topic or list of topics.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>topics</strong>:  A list of topics to delete memories for.</li>
<li><strong>db</strong>:  Memory database instance.</li>
<li><strong>user_id</strong>:  User ID for the memories.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Tuple of (success, message).</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.clear_memories" class="classattr">
                                        <input id="SemanticMemoryManager.clear_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clear_memories</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.clear_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.clear_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.clear_memories-731"><a href="#SemanticMemoryManager.clear_memories-731"><span class="linenos">731</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.clear_memories-732"><a href="#SemanticMemoryManager.clear_memories-732"><span class="linenos">732</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.clear_memories-733"><a href="#SemanticMemoryManager.clear_memories-733"><span class="linenos">733</span></a><span class="sd">        Clear all memories for a user.</span>
</span><span id="SemanticMemoryManager.clear_memories-734"><a href="#SemanticMemoryManager.clear_memories-734"><span class="linenos">734</span></a>
</span><span id="SemanticMemoryManager.clear_memories-735"><a href="#SemanticMemoryManager.clear_memories-735"><span class="linenos">735</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.clear_memories-736"><a href="#SemanticMemoryManager.clear_memories-736"><span class="linenos">736</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager.clear_memories-737"><a href="#SemanticMemoryManager.clear_memories-737"><span class="linenos">737</span></a><span class="sd">        :return: Tuple of (success, message)</span>
</span><span id="SemanticMemoryManager.clear_memories-738"><a href="#SemanticMemoryManager.clear_memories-738"><span class="linenos">738</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.clear_memories-739"><a href="#SemanticMemoryManager.clear_memories-739"><span class="linenos">739</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager.clear_memories-740"><a href="#SemanticMemoryManager.clear_memories-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.clear_memories-741"><a href="#SemanticMemoryManager.clear_memories-741"><span class="linenos">741</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.clear_memories-742"><a href="#SemanticMemoryManager.clear_memories-742"><span class="linenos">742</span></a>            
</span><span id="SemanticMemoryManager.clear_memories-743"><a href="#SemanticMemoryManager.clear_memories-743"><span class="linenos">743</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.clear_memories-744"><a href="#SemanticMemoryManager.clear_memories-744"><span class="linenos">744</span></a>            <span class="c1"># Get all memories for the user first</span>
</span><span id="SemanticMemoryManager.clear_memories-745"><a href="#SemanticMemoryManager.clear_memories-745"><span class="linenos">745</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.clear_memories-746"><a href="#SemanticMemoryManager.clear_memories-746"><span class="linenos">746</span></a>
</span><span id="SemanticMemoryManager.clear_memories-747"><a href="#SemanticMemoryManager.clear_memories-747"><span class="linenos">747</span></a>            <span class="c1"># Delete each memory</span>
</span><span id="SemanticMemoryManager.clear_memories-748"><a href="#SemanticMemoryManager.clear_memories-748"><span class="linenos">748</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.clear_memories-749"><a href="#SemanticMemoryManager.clear_memories-749"><span class="linenos">749</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.clear_memories-750"><a href="#SemanticMemoryManager.clear_memories-750"><span class="linenos">750</span></a>                    <span class="n">db</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.clear_memories-751"><a href="#SemanticMemoryManager.clear_memories-751"><span class="linenos">751</span></a>
</span><span id="SemanticMemoryManager.clear_memories-752"><a href="#SemanticMemoryManager.clear_memories-752"><span class="linenos">752</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager.clear_memories-753"><a href="#SemanticMemoryManager.clear_memories-753"><span class="linenos">753</span></a>
</span><span id="SemanticMemoryManager.clear_memories-754"><a href="#SemanticMemoryManager.clear_memories-754"><span class="linenos">754</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.clear_memories-755"><a href="#SemanticMemoryManager.clear_memories-755"><span class="linenos">755</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.clear_memories-756"><a href="#SemanticMemoryManager.clear_memories-756"><span class="linenos">756</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🧹 CLEARED: All memories for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.clear_memories-757"><a href="#SemanticMemoryManager.clear_memories-757"><span class="linenos">757</span></a>
</span><span id="SemanticMemoryManager.clear_memories-758"><a href="#SemanticMemoryManager.clear_memories-758"><span class="linenos">758</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cleared </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memory_rows</span><span class="p">)</span><span class="si">}</span><span class="s2"> memories successfully&quot;</span>
</span><span id="SemanticMemoryManager.clear_memories-759"><a href="#SemanticMemoryManager.clear_memories-759"><span class="linenos">759</span></a>
</span><span id="SemanticMemoryManager.clear_memories-760"><a href="#SemanticMemoryManager.clear_memories-760"><span class="linenos">760</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.clear_memories-761"><a href="#SemanticMemoryManager.clear_memories-761"><span class="linenos">761</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error clearing memories: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.clear_memories-762"><a href="#SemanticMemoryManager.clear_memories-762"><span class="linenos">762</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.clear_memories-763"><a href="#SemanticMemoryManager.clear_memories-763"><span class="linenos">763</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span>
</span></pre></div>


            <div class="docstring"><p>Clear all memories for a user.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID for the memories</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Tuple of (success, message)</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.search_memories" class="classattr">
                                        <input id="SemanticMemoryManager.search_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">search_memories</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span>,</span><span class="param">	<span class="n">search_topics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">topic_boost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">UserMemory</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.search_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.search_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.search_memories-765"><a href="#SemanticMemoryManager.search_memories-765"><span class="linenos">765</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-766"><a href="#SemanticMemoryManager.search_memories-766"><span class="linenos">766</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-767"><a href="#SemanticMemoryManager.search_memories-767"><span class="linenos">767</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-768"><a href="#SemanticMemoryManager.search_memories-768"><span class="linenos">768</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-769"><a href="#SemanticMemoryManager.search_memories-769"><span class="linenos">769</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-770"><a href="#SemanticMemoryManager.search_memories-770"><span class="linenos">770</span></a>        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-771"><a href="#SemanticMemoryManager.search_memories-771"><span class="linenos">771</span></a>        <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-772"><a href="#SemanticMemoryManager.search_memories-772"><span class="linenos">772</span></a>        <span class="n">search_topics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-773"><a href="#SemanticMemoryManager.search_memories-773"><span class="linenos">773</span></a>        <span class="n">topic_boost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-774"><a href="#SemanticMemoryManager.search_memories-774"><span class="linenos">774</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
</span><span id="SemanticMemoryManager.search_memories-775"><a href="#SemanticMemoryManager.search_memories-775"><span class="linenos">775</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.search_memories-776"><a href="#SemanticMemoryManager.search_memories-776"><span class="linenos">776</span></a><span class="sd">        Search memories using semantic similarity and topic matching with enhanced query expansion.</span>
</span><span id="SemanticMemoryManager.search_memories-777"><a href="#SemanticMemoryManager.search_memories-777"><span class="linenos">777</span></a>
</span><span id="SemanticMemoryManager.search_memories-778"><a href="#SemanticMemoryManager.search_memories-778"><span class="linenos">778</span></a><span class="sd">        :param query: Search query</span>
</span><span id="SemanticMemoryManager.search_memories-779"><a href="#SemanticMemoryManager.search_memories-779"><span class="linenos">779</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.search_memories-780"><a href="#SemanticMemoryManager.search_memories-780"><span class="linenos">780</span></a><span class="sd">        :param user_id: User ID to search within</span>
</span><span id="SemanticMemoryManager.search_memories-781"><a href="#SemanticMemoryManager.search_memories-781"><span class="linenos">781</span></a><span class="sd">        :param limit: Maximum number of results</span>
</span><span id="SemanticMemoryManager.search_memories-782"><a href="#SemanticMemoryManager.search_memories-782"><span class="linenos">782</span></a><span class="sd">        :param similarity_threshold: Minimum similarity threshold for content</span>
</span><span id="SemanticMemoryManager.search_memories-783"><a href="#SemanticMemoryManager.search_memories-783"><span class="linenos">783</span></a><span class="sd">        :param search_topics: Whether to include topic search (default: True)</span>
</span><span id="SemanticMemoryManager.search_memories-784"><a href="#SemanticMemoryManager.search_memories-784"><span class="linenos">784</span></a><span class="sd">        :param topic_boost: Score boost for topic matches (default: 0.5)</span>
</span><span id="SemanticMemoryManager.search_memories-785"><a href="#SemanticMemoryManager.search_memories-785"><span class="linenos">785</span></a><span class="sd">        :return: List of (UserMemory, combined_score) tuples</span>
</span><span id="SemanticMemoryManager.search_memories-786"><a href="#SemanticMemoryManager.search_memories-786"><span class="linenos">786</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.search_memories-787"><a href="#SemanticMemoryManager.search_memories-787"><span class="linenos">787</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager.search_memories-788"><a href="#SemanticMemoryManager.search_memories-788"><span class="linenos">788</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-789"><a href="#SemanticMemoryManager.search_memories-789"><span class="linenos">789</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.search_memories-790"><a href="#SemanticMemoryManager.search_memories-790"><span class="linenos">790</span></a>            
</span><span id="SemanticMemoryManager.search_memories-791"><a href="#SemanticMemoryManager.search_memories-791"><span class="linenos">791</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-792"><a href="#SemanticMemoryManager.search_memories-792"><span class="linenos">792</span></a>            <span class="c1"># Enhanced query expansion for better semantic matching</span>
</span><span id="SemanticMemoryManager.search_memories-793"><a href="#SemanticMemoryManager.search_memories-793"><span class="linenos">793</span></a>            <span class="n">expanded_queries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-794"><a href="#SemanticMemoryManager.search_memories-794"><span class="linenos">794</span></a>
</span><span id="SemanticMemoryManager.search_memories-795"><a href="#SemanticMemoryManager.search_memories-795"><span class="linenos">795</span></a>            <span class="c1"># Get all memories for the user</span>
</span><span id="SemanticMemoryManager.search_memories-796"><a href="#SemanticMemoryManager.search_memories-796"><span class="linenos">796</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-797"><a href="#SemanticMemoryManager.search_memories-797"><span class="linenos">797</span></a>
</span><span id="SemanticMemoryManager.search_memories-798"><a href="#SemanticMemoryManager.search_memories-798"><span class="linenos">798</span></a>            <span class="n">user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.search_memories-799"><a href="#SemanticMemoryManager.search_memories-799"><span class="linenos">799</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-800"><a href="#SemanticMemoryManager.search_memories-800"><span class="linenos">800</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-801"><a href="#SemanticMemoryManager.search_memories-801"><span class="linenos">801</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-802"><a href="#SemanticMemoryManager.search_memories-802"><span class="linenos">802</span></a>                        <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-803"><a href="#SemanticMemoryManager.search_memories-803"><span class="linenos">803</span></a>                        <span class="n">user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-804"><a href="#SemanticMemoryManager.search_memories-804"><span class="linenos">804</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-805"><a href="#SemanticMemoryManager.search_memories-805"><span class="linenos">805</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-806"><a href="#SemanticMemoryManager.search_memories-806"><span class="linenos">806</span></a>                            <span class="s2">&quot;Failed to convert memory row to UserMemory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SemanticMemoryManager.search_memories-807"><a href="#SemanticMemoryManager.search_memories-807"><span class="linenos">807</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-808"><a href="#SemanticMemoryManager.search_memories-808"><span class="linenos">808</span></a>
</span><span id="SemanticMemoryManager.search_memories-809"><a href="#SemanticMemoryManager.search_memories-809"><span class="linenos">809</span></a>            <span class="c1"># Calculate similarities and topic matches</span>
</span><span id="SemanticMemoryManager.search_memories-810"><a href="#SemanticMemoryManager.search_memories-810"><span class="linenos">810</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.search_memories-811"><a href="#SemanticMemoryManager.search_memories-811"><span class="linenos">811</span></a>            <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.search_memories-812"><a href="#SemanticMemoryManager.search_memories-812"><span class="linenos">812</span></a>
</span><span id="SemanticMemoryManager.search_memories-813"><a href="#SemanticMemoryManager.search_memories-813"><span class="linenos">813</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">user_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-814"><a href="#SemanticMemoryManager.search_memories-814"><span class="linenos">814</span></a>                <span class="n">max_similarity</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticMemoryManager.search_memories-815"><a href="#SemanticMemoryManager.search_memories-815"><span class="linenos">815</span></a>                <span class="n">best_query</span> <span class="o">=</span> <span class="n">query</span>
</span><span id="SemanticMemoryManager.search_memories-816"><a href="#SemanticMemoryManager.search_memories-816"><span class="linenos">816</span></a>
</span><span id="SemanticMemoryManager.search_memories-817"><a href="#SemanticMemoryManager.search_memories-817"><span class="linenos">817</span></a>                <span class="c1"># Test original query and all expanded queries</span>
</span><span id="SemanticMemoryManager.search_memories-818"><a href="#SemanticMemoryManager.search_memories-818"><span class="linenos">818</span></a>                <span class="k">for</span> <span class="n">test_query</span> <span class="ow">in</span> <span class="n">expanded_queries</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-819"><a href="#SemanticMemoryManager.search_memories-819"><span class="linenos">819</span></a>                    <span class="n">content_similarity</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-820"><a href="#SemanticMemoryManager.search_memories-820"><span class="linenos">820</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_detector</span><span class="o">.</span><span class="n">_calculate_semantic_similarity</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-821"><a href="#SemanticMemoryManager.search_memories-821"><span class="linenos">821</span></a>                            <span class="n">test_query</span><span class="p">,</span> <span class="n">memory</span><span class="o">.</span><span class="n">memory</span>
</span><span id="SemanticMemoryManager.search_memories-822"><a href="#SemanticMemoryManager.search_memories-822"><span class="linenos">822</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-823"><a href="#SemanticMemoryManager.search_memories-823"><span class="linenos">823</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-824"><a href="#SemanticMemoryManager.search_memories-824"><span class="linenos">824</span></a>                    <span class="k">if</span> <span class="n">content_similarity</span> <span class="o">&gt;</span> <span class="n">max_similarity</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-825"><a href="#SemanticMemoryManager.search_memories-825"><span class="linenos">825</span></a>                        <span class="n">max_similarity</span> <span class="o">=</span> <span class="n">content_similarity</span>
</span><span id="SemanticMemoryManager.search_memories-826"><a href="#SemanticMemoryManager.search_memories-826"><span class="linenos">826</span></a>                        <span class="n">best_query</span> <span class="o">=</span> <span class="n">test_query</span>
</span><span id="SemanticMemoryManager.search_memories-827"><a href="#SemanticMemoryManager.search_memories-827"><span class="linenos">827</span></a>
</span><span id="SemanticMemoryManager.search_memories-828"><a href="#SemanticMemoryManager.search_memories-828"><span class="linenos">828</span></a>                <span class="c1"># Topic matching with enhanced search</span>
</span><span id="SemanticMemoryManager.search_memories-829"><a href="#SemanticMemoryManager.search_memories-829"><span class="linenos">829</span></a>                <span class="n">topic_score</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticMemoryManager.search_memories-830"><a href="#SemanticMemoryManager.search_memories-830"><span class="linenos">830</span></a>                <span class="n">topic_matches</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.search_memories-831"><a href="#SemanticMemoryManager.search_memories-831"><span class="linenos">831</span></a>
</span><span id="SemanticMemoryManager.search_memories-832"><a href="#SemanticMemoryManager.search_memories-832"><span class="linenos">832</span></a>                <span class="k">if</span> <span class="n">search_topics</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-833"><a href="#SemanticMemoryManager.search_memories-833"><span class="linenos">833</span></a>                    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-834"><a href="#SemanticMemoryManager.search_memories-834"><span class="linenos">834</span></a>                        <span class="c1"># Check original query and expanded queries against topics</span>
</span><span id="SemanticMemoryManager.search_memories-835"><a href="#SemanticMemoryManager.search_memories-835"><span class="linenos">835</span></a>                        <span class="k">for</span> <span class="n">test_query</span> <span class="ow">in</span> <span class="n">expanded_queries</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-836"><a href="#SemanticMemoryManager.search_memories-836"><span class="linenos">836</span></a>                            <span class="n">test_query_lower</span> <span class="o">=</span> <span class="n">test_query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.search_memories-837"><a href="#SemanticMemoryManager.search_memories-837"><span class="linenos">837</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-838"><a href="#SemanticMemoryManager.search_memories-838"><span class="linenos">838</span></a>                                <span class="n">test_query_lower</span> <span class="ow">in</span> <span class="n">topic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.search_memories-839"><a href="#SemanticMemoryManager.search_memories-839"><span class="linenos">839</span></a>                                <span class="ow">or</span> <span class="n">topic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">test_query_lower</span>
</span><span id="SemanticMemoryManager.search_memories-840"><a href="#SemanticMemoryManager.search_memories-840"><span class="linenos">840</span></a>                            <span class="p">):</span>
</span><span id="SemanticMemoryManager.search_memories-841"><a href="#SemanticMemoryManager.search_memories-841"><span class="linenos">841</span></a>                                <span class="k">if</span> <span class="n">test_query_lower</span> <span class="o">==</span> <span class="n">topic</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="SemanticMemoryManager.search_memories-842"><a href="#SemanticMemoryManager.search_memories-842"><span class="linenos">842</span></a>                                    <span class="n">topic_score</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Exact topic match</span>
</span><span id="SemanticMemoryManager.search_memories-843"><a href="#SemanticMemoryManager.search_memories-843"><span class="linenos">843</span></a>                                    <span class="n">topic_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-844"><a href="#SemanticMemoryManager.search_memories-844"><span class="linenos">844</span></a>                                    <span class="k">break</span>
</span><span id="SemanticMemoryManager.search_memories-845"><a href="#SemanticMemoryManager.search_memories-845"><span class="linenos">845</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-846"><a href="#SemanticMemoryManager.search_memories-846"><span class="linenos">846</span></a>                                    <span class="n">topic_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-847"><a href="#SemanticMemoryManager.search_memories-847"><span class="linenos">847</span></a>                                        <span class="n">topic_score</span><span class="p">,</span> <span class="mf">0.8</span>
</span><span id="SemanticMemoryManager.search_memories-848"><a href="#SemanticMemoryManager.search_memories-848"><span class="linenos">848</span></a>                                    <span class="p">)</span>  <span class="c1"># Partial topic match</span>
</span><span id="SemanticMemoryManager.search_memories-849"><a href="#SemanticMemoryManager.search_memories-849"><span class="linenos">849</span></a>                                    <span class="n">topic_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-850"><a href="#SemanticMemoryManager.search_memories-850"><span class="linenos">850</span></a>
</span><span id="SemanticMemoryManager.search_memories-851"><a href="#SemanticMemoryManager.search_memories-851"><span class="linenos">851</span></a>                <span class="c1"># Enhanced keyword matching for work-related queries</span>
</span><span id="SemanticMemoryManager.search_memories-852"><a href="#SemanticMemoryManager.search_memories-852"><span class="linenos">852</span></a>                <span class="n">keyword_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_keyword_score</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-853"><a href="#SemanticMemoryManager.search_memories-853"><span class="linenos">853</span></a>                    <span class="n">expanded_queries</span><span class="p">,</span> <span class="n">memory</span><span class="o">.</span><span class="n">memory</span>
</span><span id="SemanticMemoryManager.search_memories-854"><a href="#SemanticMemoryManager.search_memories-854"><span class="linenos">854</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-855"><a href="#SemanticMemoryManager.search_memories-855"><span class="linenos">855</span></a>
</span><span id="SemanticMemoryManager.search_memories-856"><a href="#SemanticMemoryManager.search_memories-856"><span class="linenos">856</span></a>                <span class="c1"># Combined scoring: use the best of content similarity, topic match, or keyword match</span>
</span><span id="SemanticMemoryManager.search_memories-857"><a href="#SemanticMemoryManager.search_memories-857"><span class="linenos">857</span></a>                <span class="n">final_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-858"><a href="#SemanticMemoryManager.search_memories-858"><span class="linenos">858</span></a>                    <span class="n">max_similarity</span><span class="p">,</span> <span class="n">topic_score</span> <span class="o">*</span> <span class="n">topic_boost</span><span class="p">,</span> <span class="n">keyword_score</span>
</span><span id="SemanticMemoryManager.search_memories-859"><a href="#SemanticMemoryManager.search_memories-859"><span class="linenos">859</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-860"><a href="#SemanticMemoryManager.search_memories-860"><span class="linenos">860</span></a>
</span><span id="SemanticMemoryManager.search_memories-861"><a href="#SemanticMemoryManager.search_memories-861"><span class="linenos">861</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-862"><a href="#SemanticMemoryManager.search_memories-862"><span class="linenos">862</span></a>                    <span class="n">final_score</span> <span class="o">&gt;=</span> <span class="n">similarity_threshold</span>
</span><span id="SemanticMemoryManager.search_memories-863"><a href="#SemanticMemoryManager.search_memories-863"><span class="linenos">863</span></a>                    <span class="ow">or</span> <span class="n">topic_score</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager.search_memories-864"><a href="#SemanticMemoryManager.search_memories-864"><span class="linenos">864</span></a>                    <span class="ow">or</span> <span class="n">keyword_score</span> <span class="o">&gt;</span> <span class="mf">0.4</span>
</span><span id="SemanticMemoryManager.search_memories-865"><a href="#SemanticMemoryManager.search_memories-865"><span class="linenos">865</span></a>                <span class="p">):</span>
</span><span id="SemanticMemoryManager.search_memories-866"><a href="#SemanticMemoryManager.search_memories-866"><span class="linenos">866</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">memory</span><span class="p">,</span> <span class="n">final_score</span><span class="p">))</span>
</span><span id="SemanticMemoryManager.search_memories-867"><a href="#SemanticMemoryManager.search_memories-867"><span class="linenos">867</span></a>
</span><span id="SemanticMemoryManager.search_memories-868"><a href="#SemanticMemoryManager.search_memories-868"><span class="linenos">868</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-869"><a href="#SemanticMemoryManager.search_memories-869"><span class="linenos">869</span></a>                        <span class="n">topic_matches</span> <span class="ow">or</span> <span class="n">keyword_score</span> <span class="o">&gt;</span> <span class="mf">0.4</span>
</span><span id="SemanticMemoryManager.search_memories-870"><a href="#SemanticMemoryManager.search_memories-870"><span class="linenos">870</span></a>                    <span class="p">):</span>
</span><span id="SemanticMemoryManager.search_memories-871"><a href="#SemanticMemoryManager.search_memories-871"><span class="linenos">871</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.search_memories-872"><a href="#SemanticMemoryManager.search_memories-872"><span class="linenos">872</span></a>                            <span class="s2">&quot;Enhanced match for query &#39;</span><span class="si">%s</span><span class="s2">&#39;: memory=&#39;</span><span class="si">%s</span><span class="s2">&#39;, topics=</span><span class="si">%s</span><span class="s2">, final_score=</span><span class="si">%.3f</span><span class="s2"> (content=</span><span class="si">%.3f</span><span class="s2">, topic=</span><span class="si">%.3f</span><span class="s2">, keyword=</span><span class="si">%.3f</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-873"><a href="#SemanticMemoryManager.search_memories-873"><span class="linenos">873</span></a>                            <span class="n">query</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-874"><a href="#SemanticMemoryManager.search_memories-874"><span class="linenos">874</span></a>                            <span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span>
</span><span id="SemanticMemoryManager.search_memories-875"><a href="#SemanticMemoryManager.search_memories-875"><span class="linenos">875</span></a>                            <span class="n">topic_matches</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-876"><a href="#SemanticMemoryManager.search_memories-876"><span class="linenos">876</span></a>                            <span class="n">final_score</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-877"><a href="#SemanticMemoryManager.search_memories-877"><span class="linenos">877</span></a>                            <span class="n">max_similarity</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-878"><a href="#SemanticMemoryManager.search_memories-878"><span class="linenos">878</span></a>                            <span class="n">topic_score</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-879"><a href="#SemanticMemoryManager.search_memories-879"><span class="linenos">879</span></a>                            <span class="n">keyword_score</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.search_memories-880"><a href="#SemanticMemoryManager.search_memories-880"><span class="linenos">880</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-881"><a href="#SemanticMemoryManager.search_memories-881"><span class="linenos">881</span></a>
</span><span id="SemanticMemoryManager.search_memories-882"><a href="#SemanticMemoryManager.search_memories-882"><span class="linenos">882</span></a>            <span class="c1"># Sort by combined score (descending) and limit</span>
</span><span id="SemanticMemoryManager.search_memories-883"><a href="#SemanticMemoryManager.search_memories-883"><span class="linenos">883</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-884"><a href="#SemanticMemoryManager.search_memories-884"><span class="linenos">884</span></a>            <span class="k">return</span> <span class="n">results</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
</span><span id="SemanticMemoryManager.search_memories-885"><a href="#SemanticMemoryManager.search_memories-885"><span class="linenos">885</span></a>
</span><span id="SemanticMemoryManager.search_memories-886"><a href="#SemanticMemoryManager.search_memories-886"><span class="linenos">886</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.search_memories-887"><a href="#SemanticMemoryManager.search_memories-887"><span class="linenos">887</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error searching memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.search_memories-888"><a href="#SemanticMemoryManager.search_memories-888"><span class="linenos">888</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Search memories using semantic similarity and topic matching with enhanced query expansion.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong>:  Search query</li>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID to search within</li>
<li><strong>limit</strong>:  Maximum number of results</li>
<li><strong>similarity_threshold</strong>:  Minimum similarity threshold for content</li>
<li><strong>search_topics: Whether to include topic search (default</strong>:  True)</li>
<li><strong>topic_boost: Score boost for topic matches (default</strong>:  0.5)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>List of (UserMemory, combined_score) tuples</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.get_memories_by_topic" class="classattr">
                                        <input id="SemanticMemoryManager.get_memories_by_topic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_memories_by_topic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">UserMemory</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.get_memories_by_topic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.get_memories_by_topic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.get_memories_by_topic-890"><a href="#SemanticMemoryManager.get_memories_by_topic-890"><span class="linenos">890</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_memories_by_topic</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-891"><a href="#SemanticMemoryManager.get_memories_by_topic-891"><span class="linenos">891</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-892"><a href="#SemanticMemoryManager.get_memories_by_topic-892"><span class="linenos">892</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-893"><a href="#SemanticMemoryManager.get_memories_by_topic-893"><span class="linenos">893</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-894"><a href="#SemanticMemoryManager.get_memories_by_topic-894"><span class="linenos">894</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-895"><a href="#SemanticMemoryManager.get_memories_by_topic-895"><span class="linenos">895</span></a>        <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-896"><a href="#SemanticMemoryManager.get_memories_by_topic-896"><span class="linenos">896</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-897"><a href="#SemanticMemoryManager.get_memories_by_topic-897"><span class="linenos">897</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-898"><a href="#SemanticMemoryManager.get_memories_by_topic-898"><span class="linenos">898</span></a><span class="sd">        Get memories filtered by a list of topics, with enhanced topic expansion using the topic classifier.</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-899"><a href="#SemanticMemoryManager.get_memories_by_topic-899"><span class="linenos">899</span></a>
</span><span id="SemanticMemoryManager.get_memories_by_topic-900"><a href="#SemanticMemoryManager.get_memories_by_topic-900"><span class="linenos">900</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-901"><a href="#SemanticMemoryManager.get_memories_by_topic-901"><span class="linenos">901</span></a><span class="sd">        :param user_id: User ID to search within</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-902"><a href="#SemanticMemoryManager.get_memories_by_topic-902"><span class="linenos">902</span></a><span class="sd">        :param topics: Optional list of topics to filter by. If None, returns all memories.</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-903"><a href="#SemanticMemoryManager.get_memories_by_topic-903"><span class="linenos">903</span></a><span class="sd">        :param limit: Maximum number of results to return</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-904"><a href="#SemanticMemoryManager.get_memories_by_topic-904"><span class="linenos">904</span></a><span class="sd">        :return: List of UserMemory objects matching the topics.</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-905"><a href="#SemanticMemoryManager.get_memories_by_topic-905"><span class="linenos">905</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-906"><a href="#SemanticMemoryManager.get_memories_by_topic-906"><span class="linenos">906</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-907"><a href="#SemanticMemoryManager.get_memories_by_topic-907"><span class="linenos">907</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-908"><a href="#SemanticMemoryManager.get_memories_by_topic-908"><span class="linenos">908</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-909"><a href="#SemanticMemoryManager.get_memories_by_topic-909"><span class="linenos">909</span></a>            
</span><span id="SemanticMemoryManager.get_memories_by_topic-910"><a href="#SemanticMemoryManager.get_memories_by_topic-910"><span class="linenos">910</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-911"><a href="#SemanticMemoryManager.get_memories_by_topic-911"><span class="linenos">911</span></a>            <span class="c1"># Get all memories for the user</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-912"><a href="#SemanticMemoryManager.get_memories_by_topic-912"><span class="linenos">912</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;desc&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-913"><a href="#SemanticMemoryManager.get_memories_by_topic-913"><span class="linenos">913</span></a>
</span><span id="SemanticMemoryManager.get_memories_by_topic-914"><a href="#SemanticMemoryManager.get_memories_by_topic-914"><span class="linenos">914</span></a>            <span class="n">user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-915"><a href="#SemanticMemoryManager.get_memories_by_topic-915"><span class="linenos">915</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-916"><a href="#SemanticMemoryManager.get_memories_by_topic-916"><span class="linenos">916</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-917"><a href="#SemanticMemoryManager.get_memories_by_topic-917"><span class="linenos">917</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-918"><a href="#SemanticMemoryManager.get_memories_by_topic-918"><span class="linenos">918</span></a>                        <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-919"><a href="#SemanticMemoryManager.get_memories_by_topic-919"><span class="linenos">919</span></a>                        <span class="n">user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-920"><a href="#SemanticMemoryManager.get_memories_by_topic-920"><span class="linenos">920</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-921"><a href="#SemanticMemoryManager.get_memories_by_topic-921"><span class="linenos">921</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-922"><a href="#SemanticMemoryManager.get_memories_by_topic-922"><span class="linenos">922</span></a>                            <span class="s2">&quot;Failed to convert memory row to UserMemory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-923"><a href="#SemanticMemoryManager.get_memories_by_topic-923"><span class="linenos">923</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-924"><a href="#SemanticMemoryManager.get_memories_by_topic-924"><span class="linenos">924</span></a>
</span><span id="SemanticMemoryManager.get_memories_by_topic-925"><a href="#SemanticMemoryManager.get_memories_by_topic-925"><span class="linenos">925</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-926"><a href="#SemanticMemoryManager.get_memories_by_topic-926"><span class="linenos">926</span></a>                <span class="c1"># If no topics are specified, return all memories up to the limit</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-927"><a href="#SemanticMemoryManager.get_memories_by_topic-927"><span class="linenos">927</span></a>                <span class="k">return</span> <span class="n">user_memories</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-928"><a href="#SemanticMemoryManager.get_memories_by_topic-928"><span class="linenos">928</span></a>
</span><span id="SemanticMemoryManager.get_memories_by_topic-929"><a href="#SemanticMemoryManager.get_memories_by_topic-929"><span class="linenos">929</span></a>            <span class="c1"># ENHANCED: Expand topics using the topic classifier</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-930"><a href="#SemanticMemoryManager.get_memories_by_topic-930"><span class="linenos">930</span></a>            <span class="c1"># This solves the issue where searching for &quot;education&quot; doesn&#39;t find &quot;academic&quot; memories</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-931"><a href="#SemanticMemoryManager.get_memories_by_topic-931"><span class="linenos">931</span></a>            <span class="n">expanded_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-932"><a href="#SemanticMemoryManager.get_memories_by_topic-932"><span class="linenos">932</span></a>            
</span><span id="SemanticMemoryManager.get_memories_by_topic-933"><a href="#SemanticMemoryManager.get_memories_by_topic-933"><span class="linenos">933</span></a>            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-934"><a href="#SemanticMemoryManager.get_memories_by_topic-934"><span class="linenos">934</span></a>                <span class="n">topic_lower</span> <span class="o">=</span> <span class="n">topic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-935"><a href="#SemanticMemoryManager.get_memories_by_topic-935"><span class="linenos">935</span></a>                <span class="n">expanded_topics</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">topic_lower</span><span class="p">)</span>  <span class="c1"># Add the original topic</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-936"><a href="#SemanticMemoryManager.get_memories_by_topic-936"><span class="linenos">936</span></a>                
</span><span id="SemanticMemoryManager.get_memories_by_topic-937"><a href="#SemanticMemoryManager.get_memories_by_topic-937"><span class="linenos">937</span></a>                <span class="c1"># Check if this topic appears as a keyword in any category</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-938"><a href="#SemanticMemoryManager.get_memories_by_topic-938"><span class="linenos">938</span></a>                <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-939"><a href="#SemanticMemoryManager.get_memories_by_topic-939"><span class="linenos">939</span></a>                    <span class="k">if</span> <span class="n">topic_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">kw</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-940"><a href="#SemanticMemoryManager.get_memories_by_topic-940"><span class="linenos">940</span></a>                        <span class="c1"># Add the category name</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-941"><a href="#SemanticMemoryManager.get_memories_by_topic-941"><span class="linenos">941</span></a>                        <span class="n">expanded_topics</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-942"><a href="#SemanticMemoryManager.get_memories_by_topic-942"><span class="linenos">942</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expanded topic &#39;</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">&#39; to include category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-943"><a href="#SemanticMemoryManager.get_memories_by_topic-943"><span class="linenos">943</span></a>                        <span class="k">break</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-944"><a href="#SemanticMemoryManager.get_memories_by_topic-944"><span class="linenos">944</span></a>                
</span><span id="SemanticMemoryManager.get_memories_by_topic-945"><a href="#SemanticMemoryManager.get_memories_by_topic-945"><span class="linenos">945</span></a>                <span class="c1"># Also check if this topic is a category name, and if so, add all its keywords</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-946"><a href="#SemanticMemoryManager.get_memories_by_topic-946"><span class="linenos">946</span></a>                <span class="k">if</span> <span class="n">topic_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">keys</span><span class="p">()]:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-947"><a href="#SemanticMemoryManager.get_memories_by_topic-947"><span class="linenos">947</span></a>                    <span class="c1"># Find the actual category name (with correct case)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-948"><a href="#SemanticMemoryManager.get_memories_by_topic-948"><span class="linenos">948</span></a>                    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_classifier</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-949"><a href="#SemanticMemoryManager.get_memories_by_topic-949"><span class="linenos">949</span></a>                        <span class="k">if</span> <span class="n">category</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">topic_lower</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-950"><a href="#SemanticMemoryManager.get_memories_by_topic-950"><span class="linenos">950</span></a>                            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-951"><a href="#SemanticMemoryManager.get_memories_by_topic-951"><span class="linenos">951</span></a>                                <span class="n">expanded_topics</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-952"><a href="#SemanticMemoryManager.get_memories_by_topic-952"><span class="linenos">952</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expanded category &#39;</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">&#39; to include keywords: </span><span class="si">{</span><span class="n">keywords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-953"><a href="#SemanticMemoryManager.get_memories_by_topic-953"><span class="linenos">953</span></a>                            <span class="k">break</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-954"><a href="#SemanticMemoryManager.get_memories_by_topic-954"><span class="linenos">954</span></a>
</span><span id="SemanticMemoryManager.get_memories_by_topic-955"><a href="#SemanticMemoryManager.get_memories_by_topic-955"><span class="linenos">955</span></a>            <span class="c1"># Filter memories by the expanded topics</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-956"><a href="#SemanticMemoryManager.get_memories_by_topic-956"><span class="linenos">956</span></a>            <span class="n">filtered_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-957"><a href="#SemanticMemoryManager.get_memories_by_topic-957"><span class="linenos">957</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">user_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-958"><a href="#SemanticMemoryManager.get_memories_by_topic-958"><span class="linenos">958</span></a>                <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-959"><a href="#SemanticMemoryManager.get_memories_by_topic-959"><span class="linenos">959</span></a>                    <span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">expanded_topics</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-960"><a href="#SemanticMemoryManager.get_memories_by_topic-960"><span class="linenos">960</span></a>                <span class="p">):</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-961"><a href="#SemanticMemoryManager.get_memories_by_topic-961"><span class="linenos">961</span></a>                    <span class="n">filtered_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-962"><a href="#SemanticMemoryManager.get_memories_by_topic-962"><span class="linenos">962</span></a>
</span><span id="SemanticMemoryManager.get_memories_by_topic-963"><a href="#SemanticMemoryManager.get_memories_by_topic-963"><span class="linenos">963</span></a>            <span class="c1"># Sort by date (already sorted by read_memories) and limit</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-964"><a href="#SemanticMemoryManager.get_memories_by_topic-964"><span class="linenos">964</span></a>            <span class="k">return</span> <span class="n">filtered_memories</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-965"><a href="#SemanticMemoryManager.get_memories_by_topic-965"><span class="linenos">965</span></a>
</span><span id="SemanticMemoryManager.get_memories_by_topic-966"><a href="#SemanticMemoryManager.get_memories_by_topic-966"><span class="linenos">966</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-967"><a href="#SemanticMemoryManager.get_memories_by_topic-967"><span class="linenos">967</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error getting memories by topic: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memories_by_topic-968"><a href="#SemanticMemoryManager.get_memories_by_topic-968"><span class="linenos">968</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Get memories filtered by a list of topics, with enhanced topic expansion using the topic classifier.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID to search within</li>
<li><strong>topics</strong>:  Optional list of topics to filter by. If None, returns all memories.</li>
<li><strong>limit</strong>:  Maximum number of results to return</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>List of UserMemory objects matching the topics.</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.get_all_memories" class="classattr">
                                        <input id="SemanticMemoryManager.get_all_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_memories</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">UserMemory</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.get_all_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.get_all_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.get_all_memories-1093"><a href="#SemanticMemoryManager.get_all_memories-1093"><span class="linenos">1093</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMemory</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.get_all_memories-1094"><a href="#SemanticMemoryManager.get_all_memories-1094"><span class="linenos">1094</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.get_all_memories-1095"><a href="#SemanticMemoryManager.get_all_memories-1095"><span class="linenos">1095</span></a><span class="sd">        Get all memories for a user.</span>
</span><span id="SemanticMemoryManager.get_all_memories-1096"><a href="#SemanticMemoryManager.get_all_memories-1096"><span class="linenos">1096</span></a>
</span><span id="SemanticMemoryManager.get_all_memories-1097"><a href="#SemanticMemoryManager.get_all_memories-1097"><span class="linenos">1097</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.get_all_memories-1098"><a href="#SemanticMemoryManager.get_all_memories-1098"><span class="linenos">1098</span></a><span class="sd">        :param user_id: User ID to retrieve memories for</span>
</span><span id="SemanticMemoryManager.get_all_memories-1099"><a href="#SemanticMemoryManager.get_all_memories-1099"><span class="linenos">1099</span></a><span class="sd">        :return: List of UserMemory objects</span>
</span><span id="SemanticMemoryManager.get_all_memories-1100"><a href="#SemanticMemoryManager.get_all_memories-1100"><span class="linenos">1100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.get_all_memories-1101"><a href="#SemanticMemoryManager.get_all_memories-1101"><span class="linenos">1101</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager.get_all_memories-1102"><a href="#SemanticMemoryManager.get_all_memories-1102"><span class="linenos">1102</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_all_memories-1103"><a href="#SemanticMemoryManager.get_all_memories-1103"><span class="linenos">1103</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.get_all_memories-1104"><a href="#SemanticMemoryManager.get_all_memories-1104"><span class="linenos">1104</span></a>            
</span><span id="SemanticMemoryManager.get_all_memories-1105"><a href="#SemanticMemoryManager.get_all_memories-1105"><span class="linenos">1105</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_all_memories-1106"><a href="#SemanticMemoryManager.get_all_memories-1106"><span class="linenos">1106</span></a>            <span class="c1"># Get all memories for the user</span>
</span><span id="SemanticMemoryManager.get_all_memories-1107"><a href="#SemanticMemoryManager.get_all_memories-1107"><span class="linenos">1107</span></a>            <span class="n">memory_rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_memories</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;desc&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_all_memories-1108"><a href="#SemanticMemoryManager.get_all_memories-1108"><span class="linenos">1108</span></a>
</span><span id="SemanticMemoryManager.get_all_memories-1109"><a href="#SemanticMemoryManager.get_all_memories-1109"><span class="linenos">1109</span></a>            <span class="n">user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.get_all_memories-1110"><a href="#SemanticMemoryManager.get_all_memories-1110"><span class="linenos">1110</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">memory_rows</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_all_memories-1111"><a href="#SemanticMemoryManager.get_all_memories-1111"><span class="linenos">1111</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_all_memories-1112"><a href="#SemanticMemoryManager.get_all_memories-1112"><span class="linenos">1112</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_all_memories-1113"><a href="#SemanticMemoryManager.get_all_memories-1113"><span class="linenos">1113</span></a>                        <span class="n">user_memory</span> <span class="o">=</span> <span class="n">UserMemory</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_all_memories-1114"><a href="#SemanticMemoryManager.get_all_memories-1114"><span class="linenos">1114</span></a>                        <span class="n">user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_memory</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_all_memories-1115"><a href="#SemanticMemoryManager.get_all_memories-1115"><span class="linenos">1115</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_all_memories-1116"><a href="#SemanticMemoryManager.get_all_memories-1116"><span class="linenos">1116</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.get_all_memories-1117"><a href="#SemanticMemoryManager.get_all_memories-1117"><span class="linenos">1117</span></a>                            <span class="s2">&quot;Failed to convert memory row to UserMemory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
</span><span id="SemanticMemoryManager.get_all_memories-1118"><a href="#SemanticMemoryManager.get_all_memories-1118"><span class="linenos">1118</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager.get_all_memories-1119"><a href="#SemanticMemoryManager.get_all_memories-1119"><span class="linenos">1119</span></a>
</span><span id="SemanticMemoryManager.get_all_memories-1120"><a href="#SemanticMemoryManager.get_all_memories-1120"><span class="linenos">1120</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieved </span><span class="si">%d</span><span class="s2"> memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_memories</span><span class="p">),</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_all_memories-1121"><a href="#SemanticMemoryManager.get_all_memories-1121"><span class="linenos">1121</span></a>            <span class="k">return</span> <span class="n">user_memories</span>
</span><span id="SemanticMemoryManager.get_all_memories-1122"><a href="#SemanticMemoryManager.get_all_memories-1122"><span class="linenos">1122</span></a>
</span><span id="SemanticMemoryManager.get_all_memories-1123"><a href="#SemanticMemoryManager.get_all_memories-1123"><span class="linenos">1123</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_all_memories-1124"><a href="#SemanticMemoryManager.get_all_memories-1124"><span class="linenos">1124</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving all memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_all_memories-1125"><a href="#SemanticMemoryManager.get_all_memories-1125"><span class="linenos">1125</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Get all memories for a user.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID to retrieve memories for</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>List of UserMemory objects</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.get_memory_stats" class="classattr">
                                        <input id="SemanticMemoryManager.get_memory_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_memory_stats</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.get_memory_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.get_memory_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.get_memory_stats-1127"><a href="#SemanticMemoryManager.get_memory_stats-1127"><span class="linenos">1127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1128"><a href="#SemanticMemoryManager.get_memory_stats-1128"><span class="linenos">1128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1129"><a href="#SemanticMemoryManager.get_memory_stats-1129"><span class="linenos">1129</span></a><span class="sd">        Get statistics about memories for a user.</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1130"><a href="#SemanticMemoryManager.get_memory_stats-1130"><span class="linenos">1130</span></a>
</span><span id="SemanticMemoryManager.get_memory_stats-1131"><a href="#SemanticMemoryManager.get_memory_stats-1131"><span class="linenos">1131</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1132"><a href="#SemanticMemoryManager.get_memory_stats-1132"><span class="linenos">1132</span></a><span class="sd">        :param user_id: User ID to analyze</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1133"><a href="#SemanticMemoryManager.get_memory_stats-1133"><span class="linenos">1133</span></a><span class="sd">        :return: Dictionary with memory statistics</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1134"><a href="#SemanticMemoryManager.get_memory_stats-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1135"><a href="#SemanticMemoryManager.get_memory_stats-1135"><span class="linenos">1135</span></a>        <span class="c1"># Get current user ID if not provided</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1136"><a href="#SemanticMemoryManager.get_memory_stats-1136"><span class="linenos">1136</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1137"><a href="#SemanticMemoryManager.get_memory_stats-1137"><span class="linenos">1137</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_current_user_id</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1138"><a href="#SemanticMemoryManager.get_memory_stats-1138"><span class="linenos">1138</span></a>            
</span><span id="SemanticMemoryManager.get_memory_stats-1139"><a href="#SemanticMemoryManager.get_memory_stats-1139"><span class="linenos">1139</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1140"><a href="#SemanticMemoryManager.get_memory_stats-1140"><span class="linenos">1140</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_memories</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1141"><a href="#SemanticMemoryManager.get_memory_stats-1141"><span class="linenos">1141</span></a>
</span><span id="SemanticMemoryManager.get_memory_stats-1142"><a href="#SemanticMemoryManager.get_memory_stats-1142"><span class="linenos">1142</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1143"><a href="#SemanticMemoryManager.get_memory_stats-1143"><span class="linenos">1143</span></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;total_memories&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1144"><a href="#SemanticMemoryManager.get_memory_stats-1144"><span class="linenos">1144</span></a>
</span><span id="SemanticMemoryManager.get_memory_stats-1145"><a href="#SemanticMemoryManager.get_memory_stats-1145"><span class="linenos">1145</span></a>            <span class="c1"># Topic distribution</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1146"><a href="#SemanticMemoryManager.get_memory_stats-1146"><span class="linenos">1146</span></a>            <span class="n">topic_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1147"><a href="#SemanticMemoryManager.get_memory_stats-1147"><span class="linenos">1147</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1148"><a href="#SemanticMemoryManager.get_memory_stats-1148"><span class="linenos">1148</span></a>                <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1149"><a href="#SemanticMemoryManager.get_memory_stats-1149"><span class="linenos">1149</span></a>                    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1150"><a href="#SemanticMemoryManager.get_memory_stats-1150"><span class="linenos">1150</span></a>                        <span class="n">topic_counts</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1151"><a href="#SemanticMemoryManager.get_memory_stats-1151"><span class="linenos">1151</span></a>
</span><span id="SemanticMemoryManager.get_memory_stats-1152"><a href="#SemanticMemoryManager.get_memory_stats-1152"><span class="linenos">1152</span></a>            <span class="c1"># Average memory length</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1153"><a href="#SemanticMemoryManager.get_memory_stats-1153"><span class="linenos">1153</span></a>            <span class="n">avg_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1154"><a href="#SemanticMemoryManager.get_memory_stats-1154"><span class="linenos">1154</span></a>
</span><span id="SemanticMemoryManager.get_memory_stats-1155"><a href="#SemanticMemoryManager.get_memory_stats-1155"><span class="linenos">1155</span></a>            <span class="c1"># Recent activity (memories in last 24 hours)</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1156"><a href="#SemanticMemoryManager.get_memory_stats-1156"><span class="linenos">1156</span></a>            <span class="n">recent_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1157"><a href="#SemanticMemoryManager.get_memory_stats-1157"><span class="linenos">1157</span></a>            <span class="k">if</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1158"><a href="#SemanticMemoryManager.get_memory_stats-1158"><span class="linenos">1158</span></a>                <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1159"><a href="#SemanticMemoryManager.get_memory_stats-1159"><span class="linenos">1159</span></a>                    <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1160"><a href="#SemanticMemoryManager.get_memory_stats-1160"><span class="linenos">1160</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1161"><a href="#SemanticMemoryManager.get_memory_stats-1161"><span class="linenos">1161</span></a>                <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1162"><a href="#SemanticMemoryManager.get_memory_stats-1162"><span class="linenos">1162</span></a>                    <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">last_updated</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">last_updated</span> <span class="o">&gt;=</span> <span class="n">cutoff</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1163"><a href="#SemanticMemoryManager.get_memory_stats-1163"><span class="linenos">1163</span></a>                        <span class="n">recent_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1164"><a href="#SemanticMemoryManager.get_memory_stats-1164"><span class="linenos">1164</span></a>
</span><span id="SemanticMemoryManager.get_memory_stats-1165"><a href="#SemanticMemoryManager.get_memory_stats-1165"><span class="linenos">1165</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1166"><a href="#SemanticMemoryManager.get_memory_stats-1166"><span class="linenos">1166</span></a>                <span class="s2">&quot;total_memories&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">),</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1167"><a href="#SemanticMemoryManager.get_memory_stats-1167"><span class="linenos">1167</span></a>                <span class="s2">&quot;topic_distribution&quot;</span><span class="p">:</span> <span class="n">topic_counts</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1168"><a href="#SemanticMemoryManager.get_memory_stats-1168"><span class="linenos">1168</span></a>                <span class="s2">&quot;average_memory_length&quot;</span><span class="p">:</span> <span class="n">avg_length</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1169"><a href="#SemanticMemoryManager.get_memory_stats-1169"><span class="linenos">1169</span></a>                <span class="s2">&quot;recent_memories_24h&quot;</span><span class="p">:</span> <span class="n">recent_count</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1170"><a href="#SemanticMemoryManager.get_memory_stats-1170"><span class="linenos">1170</span></a>                <span class="s2">&quot;most_common_topic&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1171"><a href="#SemanticMemoryManager.get_memory_stats-1171"><span class="linenos">1171</span></a>                    <span class="nb">max</span><span class="p">(</span><span class="n">topic_counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1172"><a href="#SemanticMemoryManager.get_memory_stats-1172"><span class="linenos">1172</span></a>                    <span class="k">if</span> <span class="n">topic_counts</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1173"><a href="#SemanticMemoryManager.get_memory_stats-1173"><span class="linenos">1173</span></a>                    <span class="k">else</span> <span class="kc">None</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1174"><a href="#SemanticMemoryManager.get_memory_stats-1174"><span class="linenos">1174</span></a>                <span class="p">),</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1175"><a href="#SemanticMemoryManager.get_memory_stats-1175"><span class="linenos">1175</span></a>            <span class="p">}</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1176"><a href="#SemanticMemoryManager.get_memory_stats-1176"><span class="linenos">1176</span></a>
</span><span id="SemanticMemoryManager.get_memory_stats-1177"><a href="#SemanticMemoryManager.get_memory_stats-1177"><span class="linenos">1177</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1178"><a href="#SemanticMemoryManager.get_memory_stats-1178"><span class="linenos">1178</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error getting memory stats: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.get_memory_stats-1179"><a href="#SemanticMemoryManager.get_memory_stats-1179"><span class="linenos">1179</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span></pre></div>


            <div class="docstring"><p>Get statistics about memories for a user.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID to analyze</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Dictionary with memory statistics</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.process_input" class="classattr">
                                        <input id="SemanticMemoryManager.process_input-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_input</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">input_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">extract_multiple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.process_input-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.process_input"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.process_input-1181"><a href="#SemanticMemoryManager.process_input-1181"><span class="linenos">1181</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_input</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.process_input-1182"><a href="#SemanticMemoryManager.process_input-1182"><span class="linenos">1182</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1183"><a href="#SemanticMemoryManager.process_input-1183"><span class="linenos">1183</span></a>        <span class="n">input_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1184"><a href="#SemanticMemoryManager.process_input-1184"><span class="linenos">1184</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1185"><a href="#SemanticMemoryManager.process_input-1185"><span class="linenos">1185</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1186"><a href="#SemanticMemoryManager.process_input-1186"><span class="linenos">1186</span></a>        <span class="n">extract_multiple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1187"><a href="#SemanticMemoryManager.process_input-1187"><span class="linenos">1187</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.process_input-1188"><a href="#SemanticMemoryManager.process_input-1188"><span class="linenos">1188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.process_input-1189"><a href="#SemanticMemoryManager.process_input-1189"><span class="linenos">1189</span></a><span class="sd">        Process input text and extract memories without using LLM.</span>
</span><span id="SemanticMemoryManager.process_input-1190"><a href="#SemanticMemoryManager.process_input-1190"><span class="linenos">1190</span></a>
</span><span id="SemanticMemoryManager.process_input-1191"><a href="#SemanticMemoryManager.process_input-1191"><span class="linenos">1191</span></a><span class="sd">        This method uses simple heuristics to determine if the input contains</span>
</span><span id="SemanticMemoryManager.process_input-1192"><a href="#SemanticMemoryManager.process_input-1192"><span class="linenos">1192</span></a><span class="sd">        memorable information and extracts it accordingly.</span>
</span><span id="SemanticMemoryManager.process_input-1193"><a href="#SemanticMemoryManager.process_input-1193"><span class="linenos">1193</span></a>
</span><span id="SemanticMemoryManager.process_input-1194"><a href="#SemanticMemoryManager.process_input-1194"><span class="linenos">1194</span></a><span class="sd">        :param input_text: Input text to process</span>
</span><span id="SemanticMemoryManager.process_input-1195"><a href="#SemanticMemoryManager.process_input-1195"><span class="linenos">1195</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.process_input-1196"><a href="#SemanticMemoryManager.process_input-1196"><span class="linenos">1196</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager.process_input-1197"><a href="#SemanticMemoryManager.process_input-1197"><span class="linenos">1197</span></a><span class="sd">        :param extract_multiple: Whether to try extracting multiple memories from input</span>
</span><span id="SemanticMemoryManager.process_input-1198"><a href="#SemanticMemoryManager.process_input-1198"><span class="linenos">1198</span></a><span class="sd">        :return: Dictionary with processing results</span>
</span><span id="SemanticMemoryManager.process_input-1199"><a href="#SemanticMemoryManager.process_input-1199"><span class="linenos">1199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.process_input-1200"><a href="#SemanticMemoryManager.process_input-1200"><span class="linenos">1200</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SemanticMemoryManager.process_input-1201"><a href="#SemanticMemoryManager.process_input-1201"><span class="linenos">1201</span></a>            <span class="s2">&quot;memories_added&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="SemanticMemoryManager.process_input-1202"><a href="#SemanticMemoryManager.process_input-1202"><span class="linenos">1202</span></a>            <span class="s2">&quot;memories_rejected&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="SemanticMemoryManager.process_input-1203"><a href="#SemanticMemoryManager.process_input-1203"><span class="linenos">1203</span></a>            <span class="s2">&quot;total_processed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1204"><a href="#SemanticMemoryManager.process_input-1204"><span class="linenos">1204</span></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1205"><a href="#SemanticMemoryManager.process_input-1205"><span class="linenos">1205</span></a>            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Processing completed&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1206"><a href="#SemanticMemoryManager.process_input-1206"><span class="linenos">1206</span></a>        <span class="p">}</span>
</span><span id="SemanticMemoryManager.process_input-1207"><a href="#SemanticMemoryManager.process_input-1207"><span class="linenos">1207</span></a>
</span><span id="SemanticMemoryManager.process_input-1208"><a href="#SemanticMemoryManager.process_input-1208"><span class="linenos">1208</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.process_input-1209"><a href="#SemanticMemoryManager.process_input-1209"><span class="linenos">1209</span></a>            <span class="c1"># Simple heuristics to extract memorable statements</span>
</span><span id="SemanticMemoryManager.process_input-1210"><a href="#SemanticMemoryManager.process_input-1210"><span class="linenos">1210</span></a>            <span class="n">memorable_statements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_memorable_statements</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.process_input-1211"><a href="#SemanticMemoryManager.process_input-1211"><span class="linenos">1211</span></a>
</span><span id="SemanticMemoryManager.process_input-1212"><a href="#SemanticMemoryManager.process_input-1212"><span class="linenos">1212</span></a>            <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.process_input-1213"><a href="#SemanticMemoryManager.process_input-1213"><span class="linenos">1213</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.process_input-1214"><a href="#SemanticMemoryManager.process_input-1214"><span class="linenos">1214</span></a>                    <span class="n">memory_text</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1215"><a href="#SemanticMemoryManager.process_input-1215"><span class="linenos">1215</span></a>                    <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1216"><a href="#SemanticMemoryManager.process_input-1216"><span class="linenos">1216</span></a>                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1217"><a href="#SemanticMemoryManager.process_input-1217"><span class="linenos">1217</span></a>                    <span class="n">input_text</span><span class="o">=</span><span class="n">input_text</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1218"><a href="#SemanticMemoryManager.process_input-1218"><span class="linenos">1218</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.process_input-1219"><a href="#SemanticMemoryManager.process_input-1219"><span class="linenos">1219</span></a>
</span><span id="SemanticMemoryManager.process_input-1220"><a href="#SemanticMemoryManager.process_input-1220"><span class="linenos">1220</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;total_processed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.process_input-1221"><a href="#SemanticMemoryManager.process_input-1221"><span class="linenos">1221</span></a>
</span><span id="SemanticMemoryManager.process_input-1222"><a href="#SemanticMemoryManager.process_input-1222"><span class="linenos">1222</span></a>                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.process_input-1223"><a href="#SemanticMemoryManager.process_input-1223"><span class="linenos">1223</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;memories_added&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.process_input-1224"><a href="#SemanticMemoryManager.process_input-1224"><span class="linenos">1224</span></a>                        <span class="p">{</span>
</span><span id="SemanticMemoryManager.process_input-1225"><a href="#SemanticMemoryManager.process_input-1225"><span class="linenos">1225</span></a>                            <span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1226"><a href="#SemanticMemoryManager.process_input-1226"><span class="linenos">1226</span></a>                            <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="n">statement</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1227"><a href="#SemanticMemoryManager.process_input-1227"><span class="linenos">1227</span></a>                            <span class="s2">&quot;topics&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.process_input-1228"><a href="#SemanticMemoryManager.process_input-1228"><span class="linenos">1228</span></a>                        <span class="p">}</span>
</span><span id="SemanticMemoryManager.process_input-1229"><a href="#SemanticMemoryManager.process_input-1229"><span class="linenos">1229</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager.process_input-1230"><a href="#SemanticMemoryManager.process_input-1230"><span class="linenos">1230</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.process_input-1231"><a href="#SemanticMemoryManager.process_input-1231"><span class="linenos">1231</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;memories_rejected&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.process_input-1232"><a href="#SemanticMemoryManager.process_input-1232"><span class="linenos">1232</span></a>                        <span class="p">{</span><span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="n">statement</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">}</span>
</span><span id="SemanticMemoryManager.process_input-1233"><a href="#SemanticMemoryManager.process_input-1233"><span class="linenos">1233</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager.process_input-1234"><a href="#SemanticMemoryManager.process_input-1234"><span class="linenos">1234</span></a>
</span><span id="SemanticMemoryManager.process_input-1235"><a href="#SemanticMemoryManager.process_input-1235"><span class="linenos">1235</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;memories_added&quot;</span><span class="p">]:</span>
</span><span id="SemanticMemoryManager.process_input-1236"><a href="#SemanticMemoryManager.process_input-1236"><span class="linenos">1236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager.process_input-1237"><a href="#SemanticMemoryManager.process_input-1237"><span class="linenos">1237</span></a>
</span><span id="SemanticMemoryManager.process_input-1238"><a href="#SemanticMemoryManager.process_input-1238"><span class="linenos">1238</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.process_input-1239"><a href="#SemanticMemoryManager.process_input-1239"><span class="linenos">1239</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SemanticMemoryManager.process_input-1240"><a href="#SemanticMemoryManager.process_input-1240"><span class="linenos">1240</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error processing input: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.process_input-1241"><a href="#SemanticMemoryManager.process_input-1241"><span class="linenos">1241</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error processing input: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.process_input-1242"><a href="#SemanticMemoryManager.process_input-1242"><span class="linenos">1242</span></a>
</span><span id="SemanticMemoryManager.process_input-1243"><a href="#SemanticMemoryManager.process_input-1243"><span class="linenos">1243</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Process input text and extract memories without using LLM.</p>

<p>This method uses simple heuristics to determine if the input contains
memorable information and extracts it accordingly.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>input_text</strong>:  Input text to process</li>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>user_id</strong>:  User ID for the memories</li>
<li><strong>extract_multiple</strong>:  Whether to try extracting multiple memories from input</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Dictionary with processing results</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.create_or_update_memories" class="classattr">
                                        <input id="SemanticMemoryManager.create_or_update_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_or_update_memories</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">messages</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.create_or_update_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.create_or_update_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.create_or_update_memories-1245"><a href="#SemanticMemoryManager.create_or_update_memories-1245"><span class="linenos">1245</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_or_update_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1246"><a href="#SemanticMemoryManager.create_or_update_memories-1246"><span class="linenos">1246</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1247"><a href="#SemanticMemoryManager.create_or_update_memories-1247"><span class="linenos">1247</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>  <span class="c1"># List[Message] from agno.models.message</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1248"><a href="#SemanticMemoryManager.create_or_update_memories-1248"><span class="linenos">1248</span></a>        <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1249"><a href="#SemanticMemoryManager.create_or_update_memories-1249"><span class="linenos">1249</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1250"><a href="#SemanticMemoryManager.create_or_update_memories-1250"><span class="linenos">1250</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1251"><a href="#SemanticMemoryManager.create_or_update_memories-1251"><span class="linenos">1251</span></a>        <span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1252"><a href="#SemanticMemoryManager.create_or_update_memories-1252"><span class="linenos">1252</span></a>        <span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1253"><a href="#SemanticMemoryManager.create_or_update_memories-1253"><span class="linenos">1253</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1254"><a href="#SemanticMemoryManager.create_or_update_memories-1254"><span class="linenos">1254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1255"><a href="#SemanticMemoryManager.create_or_update_memories-1255"><span class="linenos">1255</span></a><span class="sd">        Create or update memories based on messages - LLM-free implementation.</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1256"><a href="#SemanticMemoryManager.create_or_update_memories-1256"><span class="linenos">1256</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1257"><a href="#SemanticMemoryManager.create_or_update_memories-1257"><span class="linenos">1257</span></a><span class="sd">        This method provides the same interface as Agno&#39;s MemoryManager but uses</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1258"><a href="#SemanticMemoryManager.create_or_update_memories-1258"><span class="linenos">1258</span></a><span class="sd">        semantic analysis instead of LLM calls for better performance and reliability.</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1259"><a href="#SemanticMemoryManager.create_or_update_memories-1259"><span class="linenos">1259</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1260"><a href="#SemanticMemoryManager.create_or_update_memories-1260"><span class="linenos">1260</span></a><span class="sd">        :param messages: List of Message objects to process</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1261"><a href="#SemanticMemoryManager.create_or_update_memories-1261"><span class="linenos">1261</span></a><span class="sd">        :param existing_memories: List of existing memory dictionaries</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1262"><a href="#SemanticMemoryManager.create_or_update_memories-1262"><span class="linenos">1262</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1263"><a href="#SemanticMemoryManager.create_or_update_memories-1263"><span class="linenos">1263</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1264"><a href="#SemanticMemoryManager.create_or_update_memories-1264"><span class="linenos">1264</span></a><span class="sd">        :param delete_memories: Whether deletion is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1265"><a href="#SemanticMemoryManager.create_or_update_memories-1265"><span class="linenos">1265</span></a><span class="sd">        :param clear_memories: Whether clearing is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1266"><a href="#SemanticMemoryManager.create_or_update_memories-1266"><span class="linenos">1266</span></a><span class="sd">        :return: String describing the actions taken</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1267"><a href="#SemanticMemoryManager.create_or_update_memories-1267"><span class="linenos">1267</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1268"><a href="#SemanticMemoryManager.create_or_update_memories-1268"><span class="linenos">1268</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SemanticMemoryManager.create_or_update_memories Start&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1269"><a href="#SemanticMemoryManager.create_or_update_memories-1269"><span class="linenos">1269</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1270"><a href="#SemanticMemoryManager.create_or_update_memories-1270"><span class="linenos">1270</span></a>        <span class="c1"># Create a simple memory class for duplicate checking</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1271"><a href="#SemanticMemoryManager.create_or_update_memories-1271"><span class="linenos">1271</span></a>        <span class="k">class</span><span class="w"> </span><span class="nc">SimpleMemory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1272"><a href="#SemanticMemoryManager.create_or_update_memories-1272"><span class="linenos">1272</span></a>            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1273"><a href="#SemanticMemoryManager.create_or_update_memories-1273"><span class="linenos">1273</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">memory_text</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1274"><a href="#SemanticMemoryManager.create_or_update_memories-1274"><span class="linenos">1274</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memory_id</span> <span class="o">=</span> <span class="n">memory_id</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1275"><a href="#SemanticMemoryManager.create_or_update_memories-1275"><span class="linenos">1275</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1276"><a href="#SemanticMemoryManager.create_or_update_memories-1276"><span class="linenos">1276</span></a>        <span class="c1"># Convert existing memories to UserMemory objects for our processing</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1277"><a href="#SemanticMemoryManager.create_or_update_memories-1277"><span class="linenos">1277</span></a>        <span class="n">existing_user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1278"><a href="#SemanticMemoryManager.create_or_update_memories-1278"><span class="linenos">1278</span></a>        <span class="k">for</span> <span class="n">mem_dict</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1279"><a href="#SemanticMemoryManager.create_or_update_memories-1279"><span class="linenos">1279</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1280"><a href="#SemanticMemoryManager.create_or_update_memories-1280"><span class="linenos">1280</span></a>                <span class="c1"># Create a UserMemory-like object for our duplicate detection</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1281"><a href="#SemanticMemoryManager.create_or_update_memories-1281"><span class="linenos">1281</span></a>                <span class="n">memory_text</span> <span class="o">=</span> <span class="n">mem_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1282"><a href="#SemanticMemoryManager.create_or_update_memories-1282"><span class="linenos">1282</span></a>                <span class="k">if</span> <span class="n">memory_text</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1283"><a href="#SemanticMemoryManager.create_or_update_memories-1283"><span class="linenos">1283</span></a>                    <span class="n">existing_user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1284"><a href="#SemanticMemoryManager.create_or_update_memories-1284"><span class="linenos">1284</span></a>                        <span class="n">SimpleMemory</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">mem_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1285"><a href="#SemanticMemoryManager.create_or_update_memories-1285"><span class="linenos">1285</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1286"><a href="#SemanticMemoryManager.create_or_update_memories-1286"><span class="linenos">1286</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1287"><a href="#SemanticMemoryManager.create_or_update_memories-1287"><span class="linenos">1287</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process existing memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1288"><a href="#SemanticMemoryManager.create_or_update_memories-1288"><span class="linenos">1288</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1289"><a href="#SemanticMemoryManager.create_or_update_memories-1289"><span class="linenos">1289</span></a>        <span class="c1"># Extract text content from messages</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1290"><a href="#SemanticMemoryManager.create_or_update_memories-1290"><span class="linenos">1290</span></a>        <span class="n">message_texts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1291"><a href="#SemanticMemoryManager.create_or_update_memories-1291"><span class="linenos">1291</span></a>        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1292"><a href="#SemanticMemoryManager.create_or_update_memories-1292"><span class="linenos">1292</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1293"><a href="#SemanticMemoryManager.create_or_update_memories-1293"><span class="linenos">1293</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1294"><a href="#SemanticMemoryManager.create_or_update_memories-1294"><span class="linenos">1294</span></a>                    <span class="c1"># Only process user messages for memory extraction</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1295"><a href="#SemanticMemoryManager.create_or_update_memories-1295"><span class="linenos">1295</span></a>                    <span class="n">message_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1296"><a href="#SemanticMemoryManager.create_or_update_memories-1296"><span class="linenos">1296</span></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;get_content_string&quot;</span><span class="p">):</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1297"><a href="#SemanticMemoryManager.create_or_update_memories-1297"><span class="linenos">1297</span></a>                <span class="c1"># Use agno&#39;s method to get content</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1298"><a href="#SemanticMemoryManager.create_or_update_memories-1298"><span class="linenos">1298</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">get_content_string</span><span class="p">()</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1299"><a href="#SemanticMemoryManager.create_or_update_memories-1299"><span class="linenos">1299</span></a>                <span class="k">if</span> <span class="n">content</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1300"><a href="#SemanticMemoryManager.create_or_update_memories-1300"><span class="linenos">1300</span></a>                    <span class="n">message_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1301"><a href="#SemanticMemoryManager.create_or_update_memories-1301"><span class="linenos">1301</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1302"><a href="#SemanticMemoryManager.create_or_update_memories-1302"><span class="linenos">1302</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">message_texts</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1303"><a href="#SemanticMemoryManager.create_or_update_memories-1303"><span class="linenos">1303</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No user messages found to process&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1304"><a href="#SemanticMemoryManager.create_or_update_memories-1304"><span class="linenos">1304</span></a>            <span class="k">return</span> <span class="s2">&quot;No user messages to process for memory creation&quot;</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1305"><a href="#SemanticMemoryManager.create_or_update_memories-1305"><span class="linenos">1305</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1306"><a href="#SemanticMemoryManager.create_or_update_memories-1306"><span class="linenos">1306</span></a>        <span class="c1"># Combine all message texts</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1307"><a href="#SemanticMemoryManager.create_or_update_memories-1307"><span class="linenos">1307</span></a>        <span class="n">combined_input</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">message_texts</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1308"><a href="#SemanticMemoryManager.create_or_update_memories-1308"><span class="linenos">1308</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1309"><a href="#SemanticMemoryManager.create_or_update_memories-1309"><span class="linenos">1309</span></a>        <span class="c1"># Extract memorable statements</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1310"><a href="#SemanticMemoryManager.create_or_update_memories-1310"><span class="linenos">1310</span></a>        <span class="n">memorable_statements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_memorable_statements</span><span class="p">(</span><span class="n">combined_input</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1311"><a href="#SemanticMemoryManager.create_or_update_memories-1311"><span class="linenos">1311</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1312"><a href="#SemanticMemoryManager.create_or_update_memories-1312"><span class="linenos">1312</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1313"><a href="#SemanticMemoryManager.create_or_update_memories-1313"><span class="linenos">1313</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No memorable statements found in messages&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1314"><a href="#SemanticMemoryManager.create_or_update_memories-1314"><span class="linenos">1314</span></a>            <span class="k">return</span> <span class="s2">&quot;No memorable information found in the messages&quot;</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1315"><a href="#SemanticMemoryManager.create_or_update_memories-1315"><span class="linenos">1315</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1316"><a href="#SemanticMemoryManager.create_or_update_memories-1316"><span class="linenos">1316</span></a>        <span class="c1"># Process each memorable statement</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1317"><a href="#SemanticMemoryManager.create_or_update_memories-1317"><span class="linenos">1317</span></a>        <span class="n">actions_taken</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1318"><a href="#SemanticMemoryManager.create_or_update_memories-1318"><span class="linenos">1318</span></a>        <span class="n">memories_added</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1319"><a href="#SemanticMemoryManager.create_or_update_memories-1319"><span class="linenos">1319</span></a>        <span class="n">memories_rejected</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1320"><a href="#SemanticMemoryManager.create_or_update_memories-1320"><span class="linenos">1320</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1321"><a href="#SemanticMemoryManager.create_or_update_memories-1321"><span class="linenos">1321</span></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1322"><a href="#SemanticMemoryManager.create_or_update_memories-1322"><span class="linenos">1322</span></a>            <span class="c1"># Check for duplicates against existing memories</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1323"><a href="#SemanticMemoryManager.create_or_update_memories-1323"><span class="linenos">1323</span></a>            <span class="n">should_reject</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_reject_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1324"><a href="#SemanticMemoryManager.create_or_update_memories-1324"><span class="linenos">1324</span></a>                <span class="n">statement</span><span class="p">,</span> <span class="n">existing_user_memories</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1325"><a href="#SemanticMemoryManager.create_or_update_memories-1325"><span class="linenos">1325</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1326"><a href="#SemanticMemoryManager.create_or_update_memories-1326"><span class="linenos">1326</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1327"><a href="#SemanticMemoryManager.create_or_update_memories-1327"><span class="linenos">1327</span></a>            <span class="k">if</span> <span class="n">should_reject</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1328"><a href="#SemanticMemoryManager.create_or_update_memories-1328"><span class="linenos">1328</span></a>                <span class="n">memories_rejected</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1329"><a href="#SemanticMemoryManager.create_or_update_memories-1329"><span class="linenos">1329</span></a>                <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1330"><a href="#SemanticMemoryManager.create_or_update_memories-1330"><span class="linenos">1330</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected memory: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1331"><a href="#SemanticMemoryManager.create_or_update_memories-1331"><span class="linenos">1331</span></a>                <span class="k">continue</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1332"><a href="#SemanticMemoryManager.create_or_update_memories-1332"><span class="linenos">1332</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1333"><a href="#SemanticMemoryManager.create_or_update_memories-1333"><span class="linenos">1333</span></a>            <span class="c1"># Add the memory</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1334"><a href="#SemanticMemoryManager.create_or_update_memories-1334"><span class="linenos">1334</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1335"><a href="#SemanticMemoryManager.create_or_update_memories-1335"><span class="linenos">1335</span></a>                <span class="n">memory_text</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1336"><a href="#SemanticMemoryManager.create_or_update_memories-1336"><span class="linenos">1336</span></a>                <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1337"><a href="#SemanticMemoryManager.create_or_update_memories-1337"><span class="linenos">1337</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1338"><a href="#SemanticMemoryManager.create_or_update_memories-1338"><span class="linenos">1338</span></a>                <span class="n">input_text</span><span class="o">=</span><span class="n">combined_input</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1339"><a href="#SemanticMemoryManager.create_or_update_memories-1339"><span class="linenos">1339</span></a>            <span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1340"><a href="#SemanticMemoryManager.create_or_update_memories-1340"><span class="linenos">1340</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1341"><a href="#SemanticMemoryManager.create_or_update_memories-1341"><span class="linenos">1341</span></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1342"><a href="#SemanticMemoryManager.create_or_update_memories-1342"><span class="linenos">1342</span></a>                <span class="n">memories_added</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1343"><a href="#SemanticMemoryManager.create_or_update_memories-1343"><span class="linenos">1343</span></a>                <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1344"><a href="#SemanticMemoryManager.create_or_update_memories-1344"><span class="linenos">1344</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added memory: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1345"><a href="#SemanticMemoryManager.create_or_update_memories-1345"><span class="linenos">1345</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1346"><a href="#SemanticMemoryManager.create_or_update_memories-1346"><span class="linenos">1346</span></a>                <span class="c1"># Add to existing memories list for subsequent duplicate checking</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1347"><a href="#SemanticMemoryManager.create_or_update_memories-1347"><span class="linenos">1347</span></a>                <span class="n">existing_user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SimpleMemory</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">memory_id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1348"><a href="#SemanticMemoryManager.create_or_update_memories-1348"><span class="linenos">1348</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1349"><a href="#SemanticMemoryManager.create_or_update_memories-1349"><span class="linenos">1349</span></a>                <span class="n">memories_rejected</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1350"><a href="#SemanticMemoryManager.create_or_update_memories-1350"><span class="linenos">1350</span></a>                <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1351"><a href="#SemanticMemoryManager.create_or_update_memories-1351"><span class="linenos">1351</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to add: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; - </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1352"><a href="#SemanticMemoryManager.create_or_update_memories-1352"><span class="linenos">1352</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1353"><a href="#SemanticMemoryManager.create_or_update_memories-1353"><span class="linenos">1353</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to add memory: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1354"><a href="#SemanticMemoryManager.create_or_update_memories-1354"><span class="linenos">1354</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1355"><a href="#SemanticMemoryManager.create_or_update_memories-1355"><span class="linenos">1355</span></a>        <span class="c1"># Set memories_updated flag if any memories were added</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1356"><a href="#SemanticMemoryManager.create_or_update_memories-1356"><span class="linenos">1356</span></a>        <span class="k">if</span> <span class="n">memories_added</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1357"><a href="#SemanticMemoryManager.create_or_update_memories-1357"><span class="linenos">1357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1358"><a href="#SemanticMemoryManager.create_or_update_memories-1358"><span class="linenos">1358</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1359"><a href="#SemanticMemoryManager.create_or_update_memories-1359"><span class="linenos">1359</span></a>        <span class="c1"># Create response summary</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1360"><a href="#SemanticMemoryManager.create_or_update_memories-1360"><span class="linenos">1360</span></a>        <span class="n">response_parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1361"><a href="#SemanticMemoryManager.create_or_update_memories-1361"><span class="linenos">1361</span></a>            <span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memorable_statements</span><span class="p">)</span><span class="si">}</span><span class="s2"> memorable statements&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1362"><a href="#SemanticMemoryManager.create_or_update_memories-1362"><span class="linenos">1362</span></a>            <span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">memories_added</span><span class="si">}</span><span class="s2"> new memories&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1363"><a href="#SemanticMemoryManager.create_or_update_memories-1363"><span class="linenos">1363</span></a>            <span class="sa">f</span><span class="s2">&quot;Rejected </span><span class="si">{</span><span class="n">memories_rejected</span><span class="si">}</span><span class="s2"> duplicates/invalid memories&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1364"><a href="#SemanticMemoryManager.create_or_update_memories-1364"><span class="linenos">1364</span></a>        <span class="p">]</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1365"><a href="#SemanticMemoryManager.create_or_update_memories-1365"><span class="linenos">1365</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1366"><a href="#SemanticMemoryManager.create_or_update_memories-1366"><span class="linenos">1366</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span> <span class="ow">and</span> <span class="n">actions_taken</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1367"><a href="#SemanticMemoryManager.create_or_update_memories-1367"><span class="linenos">1367</span></a>            <span class="n">response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Actions taken:&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1368"><a href="#SemanticMemoryManager.create_or_update_memories-1368"><span class="linenos">1368</span></a>            <span class="n">response_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Limit to first 5 actions</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1369"><a href="#SemanticMemoryManager.create_or_update_memories-1369"><span class="linenos">1369</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1370"><a href="#SemanticMemoryManager.create_or_update_memories-1370"><span class="linenos">1370</span></a>                <span class="n">response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="si">}</span><span class="s2"> more actions&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1371"><a href="#SemanticMemoryManager.create_or_update_memories-1371"><span class="linenos">1371</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1372"><a href="#SemanticMemoryManager.create_or_update_memories-1372"><span class="linenos">1372</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;. &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response_parts</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1373"><a href="#SemanticMemoryManager.create_or_update_memories-1373"><span class="linenos">1373</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SemanticMemoryManager.create_or_update_memories End&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.create_or_update_memories-1374"><a href="#SemanticMemoryManager.create_or_update_memories-1374"><span class="linenos">1374</span></a>
</span><span id="SemanticMemoryManager.create_or_update_memories-1375"><a href="#SemanticMemoryManager.create_or_update_memories-1375"><span class="linenos">1375</span></a>        <span class="k">return</span> <span class="n">response</span>
</span></pre></div>


            <div class="docstring"><p>Create or update memories based on messages - LLM-free implementation.</p>

<p>This method provides the same interface as Agno's MemoryManager but uses
semantic analysis instead of LLM calls for better performance and reliability.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>messages</strong>:  List of Message objects to process</li>
<li><strong>existing_memories</strong>:  List of existing memory dictionaries</li>
<li><strong>user_id</strong>:  User ID for the memories</li>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>delete_memories</strong>:  Whether deletion is enabled (not used in our implementation)</li>
<li><strong>clear_memories</strong>:  Whether clearing is enabled (not used in our implementation)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>String describing the actions taken</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.acreate_or_update_memories" class="classattr">
                                        <input id="SemanticMemoryManager.acreate_or_update_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">acreate_or_update_memories</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">messages</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.acreate_or_update_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.acreate_or_update_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.acreate_or_update_memories-1377"><a href="#SemanticMemoryManager.acreate_or_update_memories-1377"><span class="linenos">1377</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">acreate_or_update_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1378"><a href="#SemanticMemoryManager.acreate_or_update_memories-1378"><span class="linenos">1378</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1379"><a href="#SemanticMemoryManager.acreate_or_update_memories-1379"><span class="linenos">1379</span></a>        <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>  <span class="c1"># List[Message] from agno.models.message</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1380"><a href="#SemanticMemoryManager.acreate_or_update_memories-1380"><span class="linenos">1380</span></a>        <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1381"><a href="#SemanticMemoryManager.acreate_or_update_memories-1381"><span class="linenos">1381</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1382"><a href="#SemanticMemoryManager.acreate_or_update_memories-1382"><span class="linenos">1382</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1383"><a href="#SemanticMemoryManager.acreate_or_update_memories-1383"><span class="linenos">1383</span></a>        <span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1384"><a href="#SemanticMemoryManager.acreate_or_update_memories-1384"><span class="linenos">1384</span></a>        <span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1385"><a href="#SemanticMemoryManager.acreate_or_update_memories-1385"><span class="linenos">1385</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1386"><a href="#SemanticMemoryManager.acreate_or_update_memories-1386"><span class="linenos">1386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1387"><a href="#SemanticMemoryManager.acreate_or_update_memories-1387"><span class="linenos">1387</span></a><span class="sd">        Async version of create_or_update_memories.</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1388"><a href="#SemanticMemoryManager.acreate_or_update_memories-1388"><span class="linenos">1388</span></a>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1389"><a href="#SemanticMemoryManager.acreate_or_update_memories-1389"><span class="linenos">1389</span></a><span class="sd">        Since our implementation doesn&#39;t use async operations, this just calls</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1390"><a href="#SemanticMemoryManager.acreate_or_update_memories-1390"><span class="linenos">1390</span></a><span class="sd">        the sync version. This maintains compatibility with Agno&#39;s async interface.</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1391"><a href="#SemanticMemoryManager.acreate_or_update_memories-1391"><span class="linenos">1391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1392"><a href="#SemanticMemoryManager.acreate_or_update_memories-1392"><span class="linenos">1392</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_or_update_memories</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1393"><a href="#SemanticMemoryManager.acreate_or_update_memories-1393"><span class="linenos">1393</span></a>            <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1394"><a href="#SemanticMemoryManager.acreate_or_update_memories-1394"><span class="linenos">1394</span></a>            <span class="n">existing_memories</span><span class="o">=</span><span class="n">existing_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1395"><a href="#SemanticMemoryManager.acreate_or_update_memories-1395"><span class="linenos">1395</span></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1396"><a href="#SemanticMemoryManager.acreate_or_update_memories-1396"><span class="linenos">1396</span></a>            <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1397"><a href="#SemanticMemoryManager.acreate_or_update_memories-1397"><span class="linenos">1397</span></a>            <span class="n">delete_memories</span><span class="o">=</span><span class="n">delete_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1398"><a href="#SemanticMemoryManager.acreate_or_update_memories-1398"><span class="linenos">1398</span></a>            <span class="n">clear_memories</span><span class="o">=</span><span class="n">clear_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.acreate_or_update_memories-1399"><a href="#SemanticMemoryManager.acreate_or_update_memories-1399"><span class="linenos">1399</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Async version of create_or_update_memories.</p>

<p>Since our implementation doesn't use async operations, this just calls
the sync version. This maintains compatibility with Agno's async interface.</p>
</div>


                            </div>
                            <div id="SemanticMemoryManager.run_memory_task" class="classattr">
                                        <input id="SemanticMemoryManager.run_memory_task-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_memory_task</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">task</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.run_memory_task-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.run_memory_task"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.run_memory_task-1401"><a href="#SemanticMemoryManager.run_memory_task-1401"><span class="linenos">1401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_memory_task</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.run_memory_task-1402"><a href="#SemanticMemoryManager.run_memory_task-1402"><span class="linenos">1402</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1403"><a href="#SemanticMemoryManager.run_memory_task-1403"><span class="linenos">1403</span></a>        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1404"><a href="#SemanticMemoryManager.run_memory_task-1404"><span class="linenos">1404</span></a>        <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SemanticMemoryManager.run_memory_task-1405"><a href="#SemanticMemoryManager.run_memory_task-1405"><span class="linenos">1405</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1406"><a href="#SemanticMemoryManager.run_memory_task-1406"><span class="linenos">1406</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1407"><a href="#SemanticMemoryManager.run_memory_task-1407"><span class="linenos">1407</span></a>        <span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1408"><a href="#SemanticMemoryManager.run_memory_task-1408"><span class="linenos">1408</span></a>        <span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1409"><a href="#SemanticMemoryManager.run_memory_task-1409"><span class="linenos">1409</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1410"><a href="#SemanticMemoryManager.run_memory_task-1410"><span class="linenos">1410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.run_memory_task-1411"><a href="#SemanticMemoryManager.run_memory_task-1411"><span class="linenos">1411</span></a><span class="sd">        Process a memory task without using LLM.</span>
</span><span id="SemanticMemoryManager.run_memory_task-1412"><a href="#SemanticMemoryManager.run_memory_task-1412"><span class="linenos">1412</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1413"><a href="#SemanticMemoryManager.run_memory_task-1413"><span class="linenos">1413</span></a><span class="sd">        This method provides the same interface as Agno&#39;s MemoryManager.run_memory_task</span>
</span><span id="SemanticMemoryManager.run_memory_task-1414"><a href="#SemanticMemoryManager.run_memory_task-1414"><span class="linenos">1414</span></a><span class="sd">        but uses semantic analysis instead of LLM calls for better performance and reliability.</span>
</span><span id="SemanticMemoryManager.run_memory_task-1415"><a href="#SemanticMemoryManager.run_memory_task-1415"><span class="linenos">1415</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1416"><a href="#SemanticMemoryManager.run_memory_task-1416"><span class="linenos">1416</span></a><span class="sd">        :param task: The task/input text to process for memory extraction</span>
</span><span id="SemanticMemoryManager.run_memory_task-1417"><a href="#SemanticMemoryManager.run_memory_task-1417"><span class="linenos">1417</span></a><span class="sd">        :param existing_memories: List of existing memory dictionaries</span>
</span><span id="SemanticMemoryManager.run_memory_task-1418"><a href="#SemanticMemoryManager.run_memory_task-1418"><span class="linenos">1418</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager.run_memory_task-1419"><a href="#SemanticMemoryManager.run_memory_task-1419"><span class="linenos">1419</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.run_memory_task-1420"><a href="#SemanticMemoryManager.run_memory_task-1420"><span class="linenos">1420</span></a><span class="sd">        :param delete_memories: Whether deletion is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1421"><a href="#SemanticMemoryManager.run_memory_task-1421"><span class="linenos">1421</span></a><span class="sd">        :param clear_memories: Whether clearing is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1422"><a href="#SemanticMemoryManager.run_memory_task-1422"><span class="linenos">1422</span></a><span class="sd">        :return: String describing the actions taken</span>
</span><span id="SemanticMemoryManager.run_memory_task-1423"><a href="#SemanticMemoryManager.run_memory_task-1423"><span class="linenos">1423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.run_memory_task-1424"><a href="#SemanticMemoryManager.run_memory_task-1424"><span class="linenos">1424</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SemanticMemoryManager.run_memory_task Start&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1425"><a href="#SemanticMemoryManager.run_memory_task-1425"><span class="linenos">1425</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1426"><a href="#SemanticMemoryManager.run_memory_task-1426"><span class="linenos">1426</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1427"><a href="#SemanticMemoryManager.run_memory_task-1427"><span class="linenos">1427</span></a>            <span class="c1"># Extract memorable statements from the task</span>
</span><span id="SemanticMemoryManager.run_memory_task-1428"><a href="#SemanticMemoryManager.run_memory_task-1428"><span class="linenos">1428</span></a>            <span class="n">memorable_statements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_memorable_statements</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1429"><a href="#SemanticMemoryManager.run_memory_task-1429"><span class="linenos">1429</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1430"><a href="#SemanticMemoryManager.run_memory_task-1430"><span class="linenos">1430</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1431"><a href="#SemanticMemoryManager.run_memory_task-1431"><span class="linenos">1431</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No memorable statements found in task&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1432"><a href="#SemanticMemoryManager.run_memory_task-1432"><span class="linenos">1432</span></a>                <span class="k">return</span> <span class="s2">&quot;No memorable information found in the task&quot;</span>
</span><span id="SemanticMemoryManager.run_memory_task-1433"><a href="#SemanticMemoryManager.run_memory_task-1433"><span class="linenos">1433</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1434"><a href="#SemanticMemoryManager.run_memory_task-1434"><span class="linenos">1434</span></a>            <span class="c1"># Convert existing memories to UserMemory-like objects for duplicate checking</span>
</span><span id="SemanticMemoryManager.run_memory_task-1435"><a href="#SemanticMemoryManager.run_memory_task-1435"><span class="linenos">1435</span></a>            <span class="k">class</span><span class="w"> </span><span class="nc">SimpleMemory</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1436"><a href="#SemanticMemoryManager.run_memory_task-1436"><span class="linenos">1436</span></a>                <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="SemanticMemoryManager.run_memory_task-1437"><a href="#SemanticMemoryManager.run_memory_task-1437"><span class="linenos">1437</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">memory_text</span>
</span><span id="SemanticMemoryManager.run_memory_task-1438"><a href="#SemanticMemoryManager.run_memory_task-1438"><span class="linenos">1438</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">memory_id</span> <span class="o">=</span> <span class="n">memory_id</span>
</span><span id="SemanticMemoryManager.run_memory_task-1439"><a href="#SemanticMemoryManager.run_memory_task-1439"><span class="linenos">1439</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1440"><a href="#SemanticMemoryManager.run_memory_task-1440"><span class="linenos">1440</span></a>            <span class="n">existing_user_memories</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.run_memory_task-1441"><a href="#SemanticMemoryManager.run_memory_task-1441"><span class="linenos">1441</span></a>            <span class="k">for</span> <span class="n">mem_dict</span> <span class="ow">in</span> <span class="n">existing_memories</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1442"><a href="#SemanticMemoryManager.run_memory_task-1442"><span class="linenos">1442</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1443"><a href="#SemanticMemoryManager.run_memory_task-1443"><span class="linenos">1443</span></a>                    <span class="n">memory_text</span> <span class="o">=</span> <span class="n">mem_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1444"><a href="#SemanticMemoryManager.run_memory_task-1444"><span class="linenos">1444</span></a>                    <span class="k">if</span> <span class="n">memory_text</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1445"><a href="#SemanticMemoryManager.run_memory_task-1445"><span class="linenos">1445</span></a>                        <span class="n">existing_user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.run_memory_task-1446"><a href="#SemanticMemoryManager.run_memory_task-1446"><span class="linenos">1446</span></a>                            <span class="n">SimpleMemory</span><span class="p">(</span><span class="n">memory_text</span><span class="p">,</span> <span class="n">mem_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="SemanticMemoryManager.run_memory_task-1447"><a href="#SemanticMemoryManager.run_memory_task-1447"><span class="linenos">1447</span></a>                        <span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1448"><a href="#SemanticMemoryManager.run_memory_task-1448"><span class="linenos">1448</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1449"><a href="#SemanticMemoryManager.run_memory_task-1449"><span class="linenos">1449</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process existing memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1450"><a href="#SemanticMemoryManager.run_memory_task-1450"><span class="linenos">1450</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1451"><a href="#SemanticMemoryManager.run_memory_task-1451"><span class="linenos">1451</span></a>            <span class="c1"># Process each memorable statement</span>
</span><span id="SemanticMemoryManager.run_memory_task-1452"><a href="#SemanticMemoryManager.run_memory_task-1452"><span class="linenos">1452</span></a>            <span class="n">actions_taken</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticMemoryManager.run_memory_task-1453"><a href="#SemanticMemoryManager.run_memory_task-1453"><span class="linenos">1453</span></a>            <span class="n">memories_added</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager.run_memory_task-1454"><a href="#SemanticMemoryManager.run_memory_task-1454"><span class="linenos">1454</span></a>            <span class="n">memories_rejected</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SemanticMemoryManager.run_memory_task-1455"><a href="#SemanticMemoryManager.run_memory_task-1455"><span class="linenos">1455</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1456"><a href="#SemanticMemoryManager.run_memory_task-1456"><span class="linenos">1456</span></a>            <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">memorable_statements</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1457"><a href="#SemanticMemoryManager.run_memory_task-1457"><span class="linenos">1457</span></a>                <span class="c1"># Check for duplicates against existing memories</span>
</span><span id="SemanticMemoryManager.run_memory_task-1458"><a href="#SemanticMemoryManager.run_memory_task-1458"><span class="linenos">1458</span></a>                <span class="n">should_reject</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_reject_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.run_memory_task-1459"><a href="#SemanticMemoryManager.run_memory_task-1459"><span class="linenos">1459</span></a>                    <span class="n">statement</span><span class="p">,</span> <span class="n">existing_user_memories</span>
</span><span id="SemanticMemoryManager.run_memory_task-1460"><a href="#SemanticMemoryManager.run_memory_task-1460"><span class="linenos">1460</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1461"><a href="#SemanticMemoryManager.run_memory_task-1461"><span class="linenos">1461</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1462"><a href="#SemanticMemoryManager.run_memory_task-1462"><span class="linenos">1462</span></a>                <span class="k">if</span> <span class="n">should_reject</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1463"><a href="#SemanticMemoryManager.run_memory_task-1463"><span class="linenos">1463</span></a>                    <span class="n">memories_rejected</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.run_memory_task-1464"><a href="#SemanticMemoryManager.run_memory_task-1464"><span class="linenos">1464</span></a>                    <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1465"><a href="#SemanticMemoryManager.run_memory_task-1465"><span class="linenos">1465</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected memory: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1466"><a href="#SemanticMemoryManager.run_memory_task-1466"><span class="linenos">1466</span></a>                    <span class="k">continue</span>
</span><span id="SemanticMemoryManager.run_memory_task-1467"><a href="#SemanticMemoryManager.run_memory_task-1467"><span class="linenos">1467</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1468"><a href="#SemanticMemoryManager.run_memory_task-1468"><span class="linenos">1468</span></a>                <span class="c1"># Add the memory</span>
</span><span id="SemanticMemoryManager.run_memory_task-1469"><a href="#SemanticMemoryManager.run_memory_task-1469"><span class="linenos">1469</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.run_memory_task-1470"><a href="#SemanticMemoryManager.run_memory_task-1470"><span class="linenos">1470</span></a>                    <span class="n">memory_text</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1471"><a href="#SemanticMemoryManager.run_memory_task-1471"><span class="linenos">1471</span></a>                    <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1472"><a href="#SemanticMemoryManager.run_memory_task-1472"><span class="linenos">1472</span></a>                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1473"><a href="#SemanticMemoryManager.run_memory_task-1473"><span class="linenos">1473</span></a>                    <span class="n">input_text</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1474"><a href="#SemanticMemoryManager.run_memory_task-1474"><span class="linenos">1474</span></a>                <span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1475"><a href="#SemanticMemoryManager.run_memory_task-1475"><span class="linenos">1475</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1476"><a href="#SemanticMemoryManager.run_memory_task-1476"><span class="linenos">1476</span></a>                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1477"><a href="#SemanticMemoryManager.run_memory_task-1477"><span class="linenos">1477</span></a>                    <span class="n">memories_added</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.run_memory_task-1478"><a href="#SemanticMemoryManager.run_memory_task-1478"><span class="linenos">1478</span></a>                    <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1479"><a href="#SemanticMemoryManager.run_memory_task-1479"><span class="linenos">1479</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added memory: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1480"><a href="#SemanticMemoryManager.run_memory_task-1480"><span class="linenos">1480</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1481"><a href="#SemanticMemoryManager.run_memory_task-1481"><span class="linenos">1481</span></a>                    <span class="c1"># Add to existing memories list for subsequent duplicate checking</span>
</span><span id="SemanticMemoryManager.run_memory_task-1482"><a href="#SemanticMemoryManager.run_memory_task-1482"><span class="linenos">1482</span></a>                    <span class="n">existing_user_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.run_memory_task-1483"><a href="#SemanticMemoryManager.run_memory_task-1483"><span class="linenos">1483</span></a>                        <span class="n">SimpleMemory</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">memory_id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1484"><a href="#SemanticMemoryManager.run_memory_task-1484"><span class="linenos">1484</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1485"><a href="#SemanticMemoryManager.run_memory_task-1485"><span class="linenos">1485</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1486"><a href="#SemanticMemoryManager.run_memory_task-1486"><span class="linenos">1486</span></a>                    <span class="n">memories_rejected</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticMemoryManager.run_memory_task-1487"><a href="#SemanticMemoryManager.run_memory_task-1487"><span class="linenos">1487</span></a>                    <span class="n">actions_taken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.run_memory_task-1488"><a href="#SemanticMemoryManager.run_memory_task-1488"><span class="linenos">1488</span></a>                        <span class="sa">f</span><span class="s2">&quot;Failed to add: &#39;</span><span class="si">{</span><span class="n">statement</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; - </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.run_memory_task-1489"><a href="#SemanticMemoryManager.run_memory_task-1489"><span class="linenos">1489</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1490"><a href="#SemanticMemoryManager.run_memory_task-1490"><span class="linenos">1490</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to add memory: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1491"><a href="#SemanticMemoryManager.run_memory_task-1491"><span class="linenos">1491</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1492"><a href="#SemanticMemoryManager.run_memory_task-1492"><span class="linenos">1492</span></a>            <span class="c1"># Set memories_updated flag if any memories were added</span>
</span><span id="SemanticMemoryManager.run_memory_task-1493"><a href="#SemanticMemoryManager.run_memory_task-1493"><span class="linenos">1493</span></a>            <span class="k">if</span> <span class="n">memories_added</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1494"><a href="#SemanticMemoryManager.run_memory_task-1494"><span class="linenos">1494</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">memories_updated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SemanticMemoryManager.run_memory_task-1495"><a href="#SemanticMemoryManager.run_memory_task-1495"><span class="linenos">1495</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1496"><a href="#SemanticMemoryManager.run_memory_task-1496"><span class="linenos">1496</span></a>            <span class="c1"># Create response summary</span>
</span><span id="SemanticMemoryManager.run_memory_task-1497"><a href="#SemanticMemoryManager.run_memory_task-1497"><span class="linenos">1497</span></a>            <span class="n">response_parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticMemoryManager.run_memory_task-1498"><a href="#SemanticMemoryManager.run_memory_task-1498"><span class="linenos">1498</span></a>                <span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memorable_statements</span><span class="p">)</span><span class="si">}</span><span class="s2"> memorable statements&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1499"><a href="#SemanticMemoryManager.run_memory_task-1499"><span class="linenos">1499</span></a>                <span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">memories_added</span><span class="si">}</span><span class="s2"> new memories&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1500"><a href="#SemanticMemoryManager.run_memory_task-1500"><span class="linenos">1500</span></a>                <span class="sa">f</span><span class="s2">&quot;Rejected </span><span class="si">{</span><span class="n">memories_rejected</span><span class="si">}</span><span class="s2"> duplicates/invalid memories&quot;</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.run_memory_task-1501"><a href="#SemanticMemoryManager.run_memory_task-1501"><span class="linenos">1501</span></a>            <span class="p">]</span>
</span><span id="SemanticMemoryManager.run_memory_task-1502"><a href="#SemanticMemoryManager.run_memory_task-1502"><span class="linenos">1502</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1503"><a href="#SemanticMemoryManager.run_memory_task-1503"><span class="linenos">1503</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug_mode</span> <span class="ow">and</span> <span class="n">actions_taken</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1504"><a href="#SemanticMemoryManager.run_memory_task-1504"><span class="linenos">1504</span></a>                <span class="n">response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Actions taken:&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1505"><a href="#SemanticMemoryManager.run_memory_task-1505"><span class="linenos">1505</span></a>                <span class="n">response_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Limit to first 5 actions</span>
</span><span id="SemanticMemoryManager.run_memory_task-1506"><a href="#SemanticMemoryManager.run_memory_task-1506"><span class="linenos">1506</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1507"><a href="#SemanticMemoryManager.run_memory_task-1507"><span class="linenos">1507</span></a>                    <span class="n">response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.run_memory_task-1508"><a href="#SemanticMemoryManager.run_memory_task-1508"><span class="linenos">1508</span></a>                        <span class="sa">f</span><span class="s2">&quot;... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">actions_taken</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="si">}</span><span class="s2"> more actions&quot;</span>
</span><span id="SemanticMemoryManager.run_memory_task-1509"><a href="#SemanticMemoryManager.run_memory_task-1509"><span class="linenos">1509</span></a>                    <span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1510"><a href="#SemanticMemoryManager.run_memory_task-1510"><span class="linenos">1510</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1511"><a href="#SemanticMemoryManager.run_memory_task-1511"><span class="linenos">1511</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;. &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response_parts</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1512"><a href="#SemanticMemoryManager.run_memory_task-1512"><span class="linenos">1512</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SemanticMemoryManager.run_memory_task End&quot;</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1513"><a href="#SemanticMemoryManager.run_memory_task-1513"><span class="linenos">1513</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1514"><a href="#SemanticMemoryManager.run_memory_task-1514"><span class="linenos">1514</span></a>            <span class="k">return</span> <span class="n">response</span>
</span><span id="SemanticMemoryManager.run_memory_task-1515"><a href="#SemanticMemoryManager.run_memory_task-1515"><span class="linenos">1515</span></a>
</span><span id="SemanticMemoryManager.run_memory_task-1516"><a href="#SemanticMemoryManager.run_memory_task-1516"><span class="linenos">1516</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.run_memory_task-1517"><a href="#SemanticMemoryManager.run_memory_task-1517"><span class="linenos">1517</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error in run_memory_task: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticMemoryManager.run_memory_task-1518"><a href="#SemanticMemoryManager.run_memory_task-1518"><span class="linenos">1518</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticMemoryManager.run_memory_task-1519"><a href="#SemanticMemoryManager.run_memory_task-1519"><span class="linenos">1519</span></a>            <span class="k">return</span> <span class="n">error_msg</span>
</span></pre></div>


            <div class="docstring"><p>Process a memory task without using LLM.</p>

<p>This method provides the same interface as Agno's MemoryManager.run_memory_task
but uses semantic analysis instead of LLM calls for better performance and reliability.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>task</strong>:  The task/input text to process for memory extraction</li>
<li><strong>existing_memories</strong>:  List of existing memory dictionaries</li>
<li><strong>user_id</strong>:  User ID for the memories</li>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>delete_memories</strong>:  Whether deletion is enabled (not used in our implementation)</li>
<li><strong>clear_memories</strong>:  Whether clearing is enabled (not used in our implementation)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>String describing the actions taken</p>
</blockquote>
</div>


                            </div>
                            <div id="SemanticMemoryManager.arun_memory_task" class="classattr">
                                        <input id="SemanticMemoryManager.arun_memory_task-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">arun_memory_task</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">task</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">db</span><span class="p">:</span> <span class="n">agno</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">MemoryDb</span>,</span><span class="param">	<span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticMemoryManager.arun_memory_task-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticMemoryManager.arun_memory_task"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticMemoryManager.arun_memory_task-1521"><a href="#SemanticMemoryManager.arun_memory_task-1521"><span class="linenos">1521</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">arun_memory_task</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1522"><a href="#SemanticMemoryManager.arun_memory_task-1522"><span class="linenos">1522</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1523"><a href="#SemanticMemoryManager.arun_memory_task-1523"><span class="linenos">1523</span></a>        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1524"><a href="#SemanticMemoryManager.arun_memory_task-1524"><span class="linenos">1524</span></a>        <span class="n">existing_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1525"><a href="#SemanticMemoryManager.arun_memory_task-1525"><span class="linenos">1525</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1526"><a href="#SemanticMemoryManager.arun_memory_task-1526"><span class="linenos">1526</span></a>        <span class="n">db</span><span class="p">:</span> <span class="n">MemoryDb</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1527"><a href="#SemanticMemoryManager.arun_memory_task-1527"><span class="linenos">1527</span></a>        <span class="n">delete_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1528"><a href="#SemanticMemoryManager.arun_memory_task-1528"><span class="linenos">1528</span></a>        <span class="n">clear_memories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1529"><a href="#SemanticMemoryManager.arun_memory_task-1529"><span class="linenos">1529</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1530"><a href="#SemanticMemoryManager.arun_memory_task-1530"><span class="linenos">1530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1531"><a href="#SemanticMemoryManager.arun_memory_task-1531"><span class="linenos">1531</span></a><span class="sd">        Async version of run_memory_task.</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1532"><a href="#SemanticMemoryManager.arun_memory_task-1532"><span class="linenos">1532</span></a>
</span><span id="SemanticMemoryManager.arun_memory_task-1533"><a href="#SemanticMemoryManager.arun_memory_task-1533"><span class="linenos">1533</span></a><span class="sd">        Since our implementation doesn&#39;t use async operations, this just calls</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1534"><a href="#SemanticMemoryManager.arun_memory_task-1534"><span class="linenos">1534</span></a><span class="sd">        the sync version. This maintains compatibility with Agno&#39;s async interface.</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1535"><a href="#SemanticMemoryManager.arun_memory_task-1535"><span class="linenos">1535</span></a>
</span><span id="SemanticMemoryManager.arun_memory_task-1536"><a href="#SemanticMemoryManager.arun_memory_task-1536"><span class="linenos">1536</span></a><span class="sd">        :param task: The task/input text to process for memory extraction</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1537"><a href="#SemanticMemoryManager.arun_memory_task-1537"><span class="linenos">1537</span></a><span class="sd">        :param existing_memories: List of existing memory dictionaries</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1538"><a href="#SemanticMemoryManager.arun_memory_task-1538"><span class="linenos">1538</span></a><span class="sd">        :param user_id: User ID for the memories</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1539"><a href="#SemanticMemoryManager.arun_memory_task-1539"><span class="linenos">1539</span></a><span class="sd">        :param db: Memory database instance</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1540"><a href="#SemanticMemoryManager.arun_memory_task-1540"><span class="linenos">1540</span></a><span class="sd">        :param delete_memories: Whether deletion is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1541"><a href="#SemanticMemoryManager.arun_memory_task-1541"><span class="linenos">1541</span></a><span class="sd">        :param clear_memories: Whether clearing is enabled (not used in our implementation)</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1542"><a href="#SemanticMemoryManager.arun_memory_task-1542"><span class="linenos">1542</span></a><span class="sd">        :return: String describing the actions taken</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1543"><a href="#SemanticMemoryManager.arun_memory_task-1543"><span class="linenos">1543</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1544"><a href="#SemanticMemoryManager.arun_memory_task-1544"><span class="linenos">1544</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_memory_task</span><span class="p">(</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1545"><a href="#SemanticMemoryManager.arun_memory_task-1545"><span class="linenos">1545</span></a>            <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1546"><a href="#SemanticMemoryManager.arun_memory_task-1546"><span class="linenos">1546</span></a>            <span class="n">existing_memories</span><span class="o">=</span><span class="n">existing_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1547"><a href="#SemanticMemoryManager.arun_memory_task-1547"><span class="linenos">1547</span></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1548"><a href="#SemanticMemoryManager.arun_memory_task-1548"><span class="linenos">1548</span></a>            <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1549"><a href="#SemanticMemoryManager.arun_memory_task-1549"><span class="linenos">1549</span></a>            <span class="n">delete_memories</span><span class="o">=</span><span class="n">delete_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1550"><a href="#SemanticMemoryManager.arun_memory_task-1550"><span class="linenos">1550</span></a>            <span class="n">clear_memories</span><span class="o">=</span><span class="n">clear_memories</span><span class="p">,</span>
</span><span id="SemanticMemoryManager.arun_memory_task-1551"><a href="#SemanticMemoryManager.arun_memory_task-1551"><span class="linenos">1551</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Async version of run_memory_task.</p>

<p>Since our implementation doesn't use async operations, this just calls
the sync version. This maintains compatibility with Agno's async interface.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>task</strong>:  The task/input text to process for memory extraction</li>
<li><strong>existing_memories</strong>:  List of existing memory dictionaries</li>
<li><strong>user_id</strong>:  User ID for the memories</li>
<li><strong>db</strong>:  Memory database instance</li>
<li><strong>delete_memories</strong>:  Whether deletion is enabled (not used in our implementation)</li>
<li><strong>clear_memories</strong>:  Whether clearing is enabled (not used in our implementation)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>String describing the actions taken</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="MemoryStorageStatus">
                            <input id="MemoryStorageStatus-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MemoryStorageStatus</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="MemoryStorageStatus-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryStorageStatus"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryStorageStatus-34"><a href="#MemoryStorageStatus-34"><span class="linenos">34</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MemoryStorageStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="MemoryStorageStatus-35"><a href="#MemoryStorageStatus-35"><span class="linenos">35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Enum for memory storage operation results.&quot;&quot;&quot;</span>
</span><span id="MemoryStorageStatus-36"><a href="#MemoryStorageStatus-36"><span class="linenos">36</span></a>    <span class="n">SUCCESS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>                    <span class="c1"># Memory stored successfully in both systems</span>
</span><span id="MemoryStorageStatus-37"><a href="#MemoryStorageStatus-37"><span class="linenos">37</span></a>    <span class="n">SUCCESS_LOCAL_ONLY</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>         <span class="c1"># Stored in local SQLite, graph sync failed</span>
</span><span id="MemoryStorageStatus-38"><a href="#MemoryStorageStatus-38"><span class="linenos">38</span></a>    <span class="n">DUPLICATE_EXACT</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>           <span class="c1"># Rejected: exact duplicate found</span>
</span><span id="MemoryStorageStatus-39"><a href="#MemoryStorageStatus-39"><span class="linenos">39</span></a>    <span class="n">DUPLICATE_SEMANTIC</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>        <span class="c1"># Rejected: semantic duplicate found  </span>
</span><span id="MemoryStorageStatus-40"><a href="#MemoryStorageStatus-40"><span class="linenos">40</span></a>    <span class="n">CONTENT_EMPTY</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>             <span class="c1"># Rejected: empty or invalid content</span>
</span><span id="MemoryStorageStatus-41"><a href="#MemoryStorageStatus-41"><span class="linenos">41</span></a>    <span class="n">CONTENT_TOO_LONG</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>          <span class="c1"># Rejected: content exceeds max length</span>
</span><span id="MemoryStorageStatus-42"><a href="#MemoryStorageStatus-42"><span class="linenos">42</span></a>    <span class="n">STORAGE_ERROR</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>             <span class="c1"># Error: database/storage failure</span>
</span><span id="MemoryStorageStatus-43"><a href="#MemoryStorageStatus-43"><span class="linenos">43</span></a>    <span class="n">VALIDATION_ERROR</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>          <span class="c1"># Error: input validation failed</span>
</span></pre></div>


            <div class="docstring"><p>Enum for memory storage operation results.</p>
</div>


                            <div id="MemoryStorageStatus.SUCCESS" class="classattr">
                                <div class="attr variable">
            <span class="name">SUCCESS</span>        =
<span class="default_value">&lt;<a href="#MemoryStorageStatus.SUCCESS">MemoryStorageStatus.SUCCESS</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageStatus.SUCCESS"></a>
    
    

                            </div>
                            <div id="MemoryStorageStatus.SUCCESS_LOCAL_ONLY" class="classattr">
                                <div class="attr variable">
            <span class="name">SUCCESS_LOCAL_ONLY</span>        =
<span class="default_value">&lt;<a href="#MemoryStorageStatus.SUCCESS_LOCAL_ONLY">MemoryStorageStatus.SUCCESS_LOCAL_ONLY</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageStatus.SUCCESS_LOCAL_ONLY"></a>
    
    

                            </div>
                            <div id="MemoryStorageStatus.DUPLICATE_EXACT" class="classattr">
                                <div class="attr variable">
            <span class="name">DUPLICATE_EXACT</span>        =
<span class="default_value">&lt;<a href="#MemoryStorageStatus.DUPLICATE_EXACT">MemoryStorageStatus.DUPLICATE_EXACT</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageStatus.DUPLICATE_EXACT"></a>
    
    

                            </div>
                            <div id="MemoryStorageStatus.DUPLICATE_SEMANTIC" class="classattr">
                                <div class="attr variable">
            <span class="name">DUPLICATE_SEMANTIC</span>        =
<span class="default_value">&lt;<a href="#MemoryStorageStatus.DUPLICATE_SEMANTIC">MemoryStorageStatus.DUPLICATE_SEMANTIC</a>: 4&gt;</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageStatus.DUPLICATE_SEMANTIC"></a>
    
    

                            </div>
                            <div id="MemoryStorageStatus.CONTENT_EMPTY" class="classattr">
                                <div class="attr variable">
            <span class="name">CONTENT_EMPTY</span>        =
<span class="default_value">&lt;<a href="#MemoryStorageStatus.CONTENT_EMPTY">MemoryStorageStatus.CONTENT_EMPTY</a>: 5&gt;</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageStatus.CONTENT_EMPTY"></a>
    
    

                            </div>
                            <div id="MemoryStorageStatus.CONTENT_TOO_LONG" class="classattr">
                                <div class="attr variable">
            <span class="name">CONTENT_TOO_LONG</span>        =
<span class="default_value">&lt;<a href="#MemoryStorageStatus.CONTENT_TOO_LONG">MemoryStorageStatus.CONTENT_TOO_LONG</a>: 6&gt;</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageStatus.CONTENT_TOO_LONG"></a>
    
    

                            </div>
                            <div id="MemoryStorageStatus.STORAGE_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">STORAGE_ERROR</span>        =
<span class="default_value">&lt;<a href="#MemoryStorageStatus.STORAGE_ERROR">MemoryStorageStatus.STORAGE_ERROR</a>: 7&gt;</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageStatus.STORAGE_ERROR"></a>
    
    

                            </div>
                            <div id="MemoryStorageStatus.VALIDATION_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">VALIDATION_ERROR</span>        =
<span class="default_value">&lt;<a href="#MemoryStorageStatus.VALIDATION_ERROR">MemoryStorageStatus.VALIDATION_ERROR</a>: 8&gt;</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageStatus.VALIDATION_ERROR"></a>
    
    

                            </div>
                </section>
                <section id="MemoryStorageResult">
                            <input id="MemoryStorageResult-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">MemoryStorageResult</span>:

                <label class="view-source-button" for="MemoryStorageResult-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryStorageResult"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryStorageResult-46"><a href="#MemoryStorageResult-46"><span class="linenos">46</span></a><span class="nd">@dataclass</span>
</span><span id="MemoryStorageResult-47"><a href="#MemoryStorageResult-47"><span class="linenos">47</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MemoryStorageResult</span><span class="p">:</span>
</span><span id="MemoryStorageResult-48"><a href="#MemoryStorageResult-48"><span class="linenos">48</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured result for memory storage operations.&quot;&quot;&quot;</span>
</span><span id="MemoryStorageResult-49"><a href="#MemoryStorageResult-49"><span class="linenos">49</span></a>    <span class="n">status</span><span class="p">:</span> <span class="n">MemoryStorageStatus</span>
</span><span id="MemoryStorageResult-50"><a href="#MemoryStorageResult-50"><span class="linenos">50</span></a>    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="MemoryStorageResult-51"><a href="#MemoryStorageResult-51"><span class="linenos">51</span></a>    <span class="n">memory_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MemoryStorageResult-52"><a href="#MemoryStorageResult-52"><span class="linenos">52</span></a>    <span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MemoryStorageResult-53"><a href="#MemoryStorageResult-53"><span class="linenos">53</span></a>    <span class="n">local_success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MemoryStorageResult-54"><a href="#MemoryStorageResult-54"><span class="linenos">54</span></a>    <span class="n">graph_success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MemoryStorageResult-55"><a href="#MemoryStorageResult-55"><span class="linenos">55</span></a>    <span class="n">similarity_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MemoryStorageResult-56"><a href="#MemoryStorageResult-56"><span class="linenos">56</span></a>    
</span><span id="MemoryStorageResult-57"><a href="#MemoryStorageResult-57"><span class="linenos">57</span></a>    <span class="nd">@property</span>
</span><span id="MemoryStorageResult-58"><a href="#MemoryStorageResult-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryStorageResult-59"><a href="#MemoryStorageResult-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if memory was stored (fully or partially).&quot;&quot;&quot;</span>
</span><span id="MemoryStorageResult-60"><a href="#MemoryStorageResult-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS_LOCAL_ONLY</span><span class="p">]</span>
</span><span id="MemoryStorageResult-61"><a href="#MemoryStorageResult-61"><span class="linenos">61</span></a>    
</span><span id="MemoryStorageResult-62"><a href="#MemoryStorageResult-62"><span class="linenos">62</span></a>    <span class="nd">@property</span>
</span><span id="MemoryStorageResult-63"><a href="#MemoryStorageResult-63"><span class="linenos">63</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryStorageResult-64"><a href="#MemoryStorageResult-64"><span class="linenos">64</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if memory was rejected (duplicate, validation, etc.).&quot;&quot;&quot;</span>
</span><span id="MemoryStorageResult-65"><a href="#MemoryStorageResult-65"><span class="linenos">65</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="MemoryStorageResult-66"><a href="#MemoryStorageResult-66"><span class="linenos">66</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_EXACT</span><span class="p">,</span>
</span><span id="MemoryStorageResult-67"><a href="#MemoryStorageResult-67"><span class="linenos">67</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_SEMANTIC</span><span class="p">,</span>
</span><span id="MemoryStorageResult-68"><a href="#MemoryStorageResult-68"><span class="linenos">68</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_EMPTY</span><span class="p">,</span>
</span><span id="MemoryStorageResult-69"><a href="#MemoryStorageResult-69"><span class="linenos">69</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_TOO_LONG</span><span class="p">,</span>
</span><span id="MemoryStorageResult-70"><a href="#MemoryStorageResult-70"><span class="linenos">70</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span>
</span><span id="MemoryStorageResult-71"><a href="#MemoryStorageResult-71"><span class="linenos">71</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Structured result for memory storage operations.</p>
</div>


                            <div id="MemoryStorageResult.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">MemoryStorageResult</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">status</span><span class="p">:</span> <span class="n"><a href="#MemoryStorageStatus">MemoryStorageStatus</a></span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">memory_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">local_success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">graph_success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">similarity_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageResult.__init__"></a>
    
    

                            </div>
                            <div id="MemoryStorageResult.status" class="classattr">
                                <div class="attr variable">
            <span class="name">status</span><span class="annotation">: <a href="#MemoryStorageStatus">MemoryStorageStatus</a></span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageResult.status"></a>
    
    

                            </div>
                            <div id="MemoryStorageResult.message" class="classattr">
                                <div class="attr variable">
            <span class="name">message</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageResult.message"></a>
    
    

                            </div>
                            <div id="MemoryStorageResult.memory_id" class="classattr">
                                <div class="attr variable">
            <span class="name">memory_id</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageResult.memory_id"></a>
    
    

                            </div>
                            <div id="MemoryStorageResult.topics" class="classattr">
                                <div class="attr variable">
            <span class="name">topics</span><span class="annotation">: Optional[List[str]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageResult.topics"></a>
    
    

                            </div>
                            <div id="MemoryStorageResult.local_success" class="classattr">
                                <div class="attr variable">
            <span class="name">local_success</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageResult.local_success"></a>
    
    

                            </div>
                            <div id="MemoryStorageResult.graph_success" class="classattr">
                                <div class="attr variable">
            <span class="name">graph_success</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageResult.graph_success"></a>
    
    

                            </div>
                            <div id="MemoryStorageResult.similarity_score" class="classattr">
                                <div class="attr variable">
            <span class="name">similarity_score</span><span class="annotation">: Optional[float]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MemoryStorageResult.similarity_score"></a>
    
    

                            </div>
                            <div id="MemoryStorageResult.is_success" class="classattr">
                                        <input id="MemoryStorageResult.is_success-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">is_success</span><span class="annotation">: bool</span>

                <label class="view-source-button" for="MemoryStorageResult.is_success-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryStorageResult.is_success"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryStorageResult.is_success-57"><a href="#MemoryStorageResult.is_success-57"><span class="linenos">57</span></a>    <span class="nd">@property</span>
</span><span id="MemoryStorageResult.is_success-58"><a href="#MemoryStorageResult.is_success-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryStorageResult.is_success-59"><a href="#MemoryStorageResult.is_success-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if memory was stored (fully or partially).&quot;&quot;&quot;</span>
</span><span id="MemoryStorageResult.is_success-60"><a href="#MemoryStorageResult.is_success-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS_LOCAL_ONLY</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>True if memory was stored (fully or partially).</p>
</div>


                            </div>
                            <div id="MemoryStorageResult.is_rejected" class="classattr">
                                        <input id="MemoryStorageResult.is_rejected-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">is_rejected</span><span class="annotation">: bool</span>

                <label class="view-source-button" for="MemoryStorageResult.is_rejected-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryStorageResult.is_rejected"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryStorageResult.is_rejected-62"><a href="#MemoryStorageResult.is_rejected-62"><span class="linenos">62</span></a>    <span class="nd">@property</span>
</span><span id="MemoryStorageResult.is_rejected-63"><a href="#MemoryStorageResult.is_rejected-63"><span class="linenos">63</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryStorageResult.is_rejected-64"><a href="#MemoryStorageResult.is_rejected-64"><span class="linenos">64</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if memory was rejected (duplicate, validation, etc.).&quot;&quot;&quot;</span>
</span><span id="MemoryStorageResult.is_rejected-65"><a href="#MemoryStorageResult.is_rejected-65"><span class="linenos">65</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="MemoryStorageResult.is_rejected-66"><a href="#MemoryStorageResult.is_rejected-66"><span class="linenos">66</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_EXACT</span><span class="p">,</span>
</span><span id="MemoryStorageResult.is_rejected-67"><a href="#MemoryStorageResult.is_rejected-67"><span class="linenos">67</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_SEMANTIC</span><span class="p">,</span>
</span><span id="MemoryStorageResult.is_rejected-68"><a href="#MemoryStorageResult.is_rejected-68"><span class="linenos">68</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_EMPTY</span><span class="p">,</span>
</span><span id="MemoryStorageResult.is_rejected-69"><a href="#MemoryStorageResult.is_rejected-69"><span class="linenos">69</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_TOO_LONG</span><span class="p">,</span>
</span><span id="MemoryStorageResult.is_rejected-70"><a href="#MemoryStorageResult.is_rejected-70"><span class="linenos">70</span></a>            <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span>
</span><span id="MemoryStorageResult.is_rejected-71"><a href="#MemoryStorageResult.is_rejected-71"><span class="linenos">71</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>True if memory was rejected (duplicate, validation, etc.).</p>
</div>


                            </div>
                </section>
                <section id="SemanticDuplicateDetector">
                            <input id="SemanticDuplicateDetector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SemanticDuplicateDetector</span>:

                <label class="view-source-button" for="SemanticDuplicateDetector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticDuplicateDetector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticDuplicateDetector-74"><a href="#SemanticDuplicateDetector-74"><span class="linenos"> 74</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SemanticDuplicateDetector</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-75"><a href="#SemanticDuplicateDetector-75"><span class="linenos"> 75</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Semantic duplicate detection without LLM using advanced text similarity.&quot;&quot;&quot;</span>
</span><span id="SemanticDuplicateDetector-76"><a href="#SemanticDuplicateDetector-76"><span class="linenos"> 76</span></a>
</span><span id="SemanticDuplicateDetector-77"><a href="#SemanticDuplicateDetector-77"><span class="linenos"> 77</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">):</span>
</span><span id="SemanticDuplicateDetector-78"><a href="#SemanticDuplicateDetector-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span> <span class="o">=</span> <span class="n">similarity_threshold</span>
</span><span id="SemanticDuplicateDetector-79"><a href="#SemanticDuplicateDetector-79"><span class="linenos"> 79</span></a>
</span><span id="SemanticDuplicateDetector-80"><a href="#SemanticDuplicateDetector-80"><span class="linenos"> 80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-81"><a href="#SemanticDuplicateDetector-81"><span class="linenos"> 81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize text for comparison.&quot;&quot;&quot;</span>
</span><span id="SemanticDuplicateDetector-82"><a href="#SemanticDuplicateDetector-82"><span class="linenos"> 82</span></a>        <span class="c1"># Convert to lowercase</span>
</span><span id="SemanticDuplicateDetector-83"><a href="#SemanticDuplicateDetector-83"><span class="linenos"> 83</span></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticDuplicateDetector-84"><a href="#SemanticDuplicateDetector-84"><span class="linenos"> 84</span></a>
</span><span id="SemanticDuplicateDetector-85"><a href="#SemanticDuplicateDetector-85"><span class="linenos"> 85</span></a>        <span class="c1"># Remove extra whitespace</span>
</span><span id="SemanticDuplicateDetector-86"><a href="#SemanticDuplicateDetector-86"><span class="linenos"> 86</span></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-87"><a href="#SemanticDuplicateDetector-87"><span class="linenos"> 87</span></a>
</span><span id="SemanticDuplicateDetector-88"><a href="#SemanticDuplicateDetector-88"><span class="linenos"> 88</span></a>        <span class="c1"># Remove common punctuation</span>
</span><span id="SemanticDuplicateDetector-89"><a href="#SemanticDuplicateDetector-89"><span class="linenos"> 89</span></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[.,!?;:]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-90"><a href="#SemanticDuplicateDetector-90"><span class="linenos"> 90</span></a>
</span><span id="SemanticDuplicateDetector-91"><a href="#SemanticDuplicateDetector-91"><span class="linenos"> 91</span></a>        <span class="k">return</span> <span class="n">text</span>
</span><span id="SemanticDuplicateDetector-92"><a href="#SemanticDuplicateDetector-92"><span class="linenos"> 92</span></a>
</span><span id="SemanticDuplicateDetector-93"><a href="#SemanticDuplicateDetector-93"><span class="linenos"> 93</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_key_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="SemanticDuplicateDetector-94"><a href="#SemanticDuplicateDetector-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract key terms from text for semantic comparison.&quot;&quot;&quot;</span>
</span><span id="SemanticDuplicateDetector-95"><a href="#SemanticDuplicateDetector-95"><span class="linenos"> 95</span></a>        <span class="n">normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-96"><a href="#SemanticDuplicateDetector-96"><span class="linenos"> 96</span></a>
</span><span id="SemanticDuplicateDetector-97"><a href="#SemanticDuplicateDetector-97"><span class="linenos"> 97</span></a>        <span class="c1"># Split into words</span>
</span><span id="SemanticDuplicateDetector-98"><a href="#SemanticDuplicateDetector-98"><span class="linenos"> 98</span></a>        <span class="n">words</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="SemanticDuplicateDetector-99"><a href="#SemanticDuplicateDetector-99"><span class="linenos"> 99</span></a>
</span><span id="SemanticDuplicateDetector-100"><a href="#SemanticDuplicateDetector-100"><span class="linenos">100</span></a>        <span class="c1"># Remove common stop words</span>
</span><span id="SemanticDuplicateDetector-101"><a href="#SemanticDuplicateDetector-101"><span class="linenos">101</span></a>        <span class="n">stop_words</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SemanticDuplicateDetector-102"><a href="#SemanticDuplicateDetector-102"><span class="linenos">102</span></a>            <span class="s2">&quot;i&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-103"><a href="#SemanticDuplicateDetector-103"><span class="linenos">103</span></a>            <span class="s2">&quot;me&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-104"><a href="#SemanticDuplicateDetector-104"><span class="linenos">104</span></a>            <span class="s2">&quot;my&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-105"><a href="#SemanticDuplicateDetector-105"><span class="linenos">105</span></a>            <span class="s2">&quot;myself&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-106"><a href="#SemanticDuplicateDetector-106"><span class="linenos">106</span></a>            <span class="s2">&quot;we&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-107"><a href="#SemanticDuplicateDetector-107"><span class="linenos">107</span></a>            <span class="s2">&quot;our&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-108"><a href="#SemanticDuplicateDetector-108"><span class="linenos">108</span></a>            <span class="s2">&quot;ours&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-109"><a href="#SemanticDuplicateDetector-109"><span class="linenos">109</span></a>            <span class="s2">&quot;ourselves&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-110"><a href="#SemanticDuplicateDetector-110"><span class="linenos">110</span></a>            <span class="s2">&quot;you&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-111"><a href="#SemanticDuplicateDetector-111"><span class="linenos">111</span></a>            <span class="s2">&quot;your&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-112"><a href="#SemanticDuplicateDetector-112"><span class="linenos">112</span></a>            <span class="s2">&quot;yours&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-113"><a href="#SemanticDuplicateDetector-113"><span class="linenos">113</span></a>            <span class="s2">&quot;yourself&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-114"><a href="#SemanticDuplicateDetector-114"><span class="linenos">114</span></a>            <span class="s2">&quot;yourselves&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-115"><a href="#SemanticDuplicateDetector-115"><span class="linenos">115</span></a>            <span class="s2">&quot;he&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-116"><a href="#SemanticDuplicateDetector-116"><span class="linenos">116</span></a>            <span class="s2">&quot;him&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-117"><a href="#SemanticDuplicateDetector-117"><span class="linenos">117</span></a>            <span class="s2">&quot;his&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-118"><a href="#SemanticDuplicateDetector-118"><span class="linenos">118</span></a>            <span class="s2">&quot;himself&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-119"><a href="#SemanticDuplicateDetector-119"><span class="linenos">119</span></a>            <span class="s2">&quot;she&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-120"><a href="#SemanticDuplicateDetector-120"><span class="linenos">120</span></a>            <span class="s2">&quot;her&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-121"><a href="#SemanticDuplicateDetector-121"><span class="linenos">121</span></a>            <span class="s2">&quot;hers&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-122"><a href="#SemanticDuplicateDetector-122"><span class="linenos">122</span></a>            <span class="s2">&quot;herself&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-123"><a href="#SemanticDuplicateDetector-123"><span class="linenos">123</span></a>            <span class="s2">&quot;it&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-124"><a href="#SemanticDuplicateDetector-124"><span class="linenos">124</span></a>            <span class="s2">&quot;its&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-125"><a href="#SemanticDuplicateDetector-125"><span class="linenos">125</span></a>            <span class="s2">&quot;itself&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-126"><a href="#SemanticDuplicateDetector-126"><span class="linenos">126</span></a>            <span class="s2">&quot;they&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-127"><a href="#SemanticDuplicateDetector-127"><span class="linenos">127</span></a>            <span class="s2">&quot;them&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-128"><a href="#SemanticDuplicateDetector-128"><span class="linenos">128</span></a>            <span class="s2">&quot;their&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-129"><a href="#SemanticDuplicateDetector-129"><span class="linenos">129</span></a>            <span class="s2">&quot;theirs&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-130"><a href="#SemanticDuplicateDetector-130"><span class="linenos">130</span></a>            <span class="s2">&quot;themselves&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-131"><a href="#SemanticDuplicateDetector-131"><span class="linenos">131</span></a>            <span class="s2">&quot;what&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-132"><a href="#SemanticDuplicateDetector-132"><span class="linenos">132</span></a>            <span class="s2">&quot;which&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-133"><a href="#SemanticDuplicateDetector-133"><span class="linenos">133</span></a>            <span class="s2">&quot;who&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-134"><a href="#SemanticDuplicateDetector-134"><span class="linenos">134</span></a>            <span class="s2">&quot;whom&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-135"><a href="#SemanticDuplicateDetector-135"><span class="linenos">135</span></a>            <span class="s2">&quot;this&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-136"><a href="#SemanticDuplicateDetector-136"><span class="linenos">136</span></a>            <span class="s2">&quot;that&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-137"><a href="#SemanticDuplicateDetector-137"><span class="linenos">137</span></a>            <span class="s2">&quot;these&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-138"><a href="#SemanticDuplicateDetector-138"><span class="linenos">138</span></a>            <span class="s2">&quot;those&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-139"><a href="#SemanticDuplicateDetector-139"><span class="linenos">139</span></a>            <span class="s2">&quot;am&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-140"><a href="#SemanticDuplicateDetector-140"><span class="linenos">140</span></a>            <span class="s2">&quot;is&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-141"><a href="#SemanticDuplicateDetector-141"><span class="linenos">141</span></a>            <span class="s2">&quot;are&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-142"><a href="#SemanticDuplicateDetector-142"><span class="linenos">142</span></a>            <span class="s2">&quot;was&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-143"><a href="#SemanticDuplicateDetector-143"><span class="linenos">143</span></a>            <span class="s2">&quot;were&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-144"><a href="#SemanticDuplicateDetector-144"><span class="linenos">144</span></a>            <span class="s2">&quot;be&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-145"><a href="#SemanticDuplicateDetector-145"><span class="linenos">145</span></a>            <span class="s2">&quot;been&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-146"><a href="#SemanticDuplicateDetector-146"><span class="linenos">146</span></a>            <span class="s2">&quot;being&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-147"><a href="#SemanticDuplicateDetector-147"><span class="linenos">147</span></a>            <span class="s2">&quot;have&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-148"><a href="#SemanticDuplicateDetector-148"><span class="linenos">148</span></a>            <span class="s2">&quot;has&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-149"><a href="#SemanticDuplicateDetector-149"><span class="linenos">149</span></a>            <span class="s2">&quot;had&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-150"><a href="#SemanticDuplicateDetector-150"><span class="linenos">150</span></a>            <span class="s2">&quot;having&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-151"><a href="#SemanticDuplicateDetector-151"><span class="linenos">151</span></a>            <span class="s2">&quot;do&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-152"><a href="#SemanticDuplicateDetector-152"><span class="linenos">152</span></a>            <span class="s2">&quot;does&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-153"><a href="#SemanticDuplicateDetector-153"><span class="linenos">153</span></a>            <span class="s2">&quot;did&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-154"><a href="#SemanticDuplicateDetector-154"><span class="linenos">154</span></a>            <span class="s2">&quot;doing&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-155"><a href="#SemanticDuplicateDetector-155"><span class="linenos">155</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-156"><a href="#SemanticDuplicateDetector-156"><span class="linenos">156</span></a>            <span class="s2">&quot;an&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-157"><a href="#SemanticDuplicateDetector-157"><span class="linenos">157</span></a>            <span class="s2">&quot;the&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-158"><a href="#SemanticDuplicateDetector-158"><span class="linenos">158</span></a>            <span class="s2">&quot;and&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-159"><a href="#SemanticDuplicateDetector-159"><span class="linenos">159</span></a>            <span class="s2">&quot;but&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-160"><a href="#SemanticDuplicateDetector-160"><span class="linenos">160</span></a>            <span class="s2">&quot;if&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-161"><a href="#SemanticDuplicateDetector-161"><span class="linenos">161</span></a>            <span class="s2">&quot;or&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-162"><a href="#SemanticDuplicateDetector-162"><span class="linenos">162</span></a>            <span class="s2">&quot;because&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-163"><a href="#SemanticDuplicateDetector-163"><span class="linenos">163</span></a>            <span class="s2">&quot;as&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-164"><a href="#SemanticDuplicateDetector-164"><span class="linenos">164</span></a>            <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-165"><a href="#SemanticDuplicateDetector-165"><span class="linenos">165</span></a>            <span class="s2">&quot;while&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-166"><a href="#SemanticDuplicateDetector-166"><span class="linenos">166</span></a>            <span class="s2">&quot;of&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-167"><a href="#SemanticDuplicateDetector-167"><span class="linenos">167</span></a>            <span class="s2">&quot;at&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-168"><a href="#SemanticDuplicateDetector-168"><span class="linenos">168</span></a>            <span class="s2">&quot;by&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-169"><a href="#SemanticDuplicateDetector-169"><span class="linenos">169</span></a>            <span class="s2">&quot;for&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-170"><a href="#SemanticDuplicateDetector-170"><span class="linenos">170</span></a>            <span class="s2">&quot;with&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-171"><a href="#SemanticDuplicateDetector-171"><span class="linenos">171</span></a>            <span class="s2">&quot;through&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-172"><a href="#SemanticDuplicateDetector-172"><span class="linenos">172</span></a>            <span class="s2">&quot;during&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-173"><a href="#SemanticDuplicateDetector-173"><span class="linenos">173</span></a>            <span class="s2">&quot;before&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-174"><a href="#SemanticDuplicateDetector-174"><span class="linenos">174</span></a>            <span class="s2">&quot;after&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-175"><a href="#SemanticDuplicateDetector-175"><span class="linenos">175</span></a>            <span class="s2">&quot;above&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-176"><a href="#SemanticDuplicateDetector-176"><span class="linenos">176</span></a>            <span class="s2">&quot;below&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-177"><a href="#SemanticDuplicateDetector-177"><span class="linenos">177</span></a>            <span class="s2">&quot;up&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-178"><a href="#SemanticDuplicateDetector-178"><span class="linenos">178</span></a>            <span class="s2">&quot;down&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-179"><a href="#SemanticDuplicateDetector-179"><span class="linenos">179</span></a>            <span class="s2">&quot;in&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-180"><a href="#SemanticDuplicateDetector-180"><span class="linenos">180</span></a>            <span class="s2">&quot;out&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-181"><a href="#SemanticDuplicateDetector-181"><span class="linenos">181</span></a>            <span class="s2">&quot;on&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-182"><a href="#SemanticDuplicateDetector-182"><span class="linenos">182</span></a>            <span class="s2">&quot;off&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-183"><a href="#SemanticDuplicateDetector-183"><span class="linenos">183</span></a>            <span class="s2">&quot;over&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-184"><a href="#SemanticDuplicateDetector-184"><span class="linenos">184</span></a>            <span class="s2">&quot;under&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-185"><a href="#SemanticDuplicateDetector-185"><span class="linenos">185</span></a>            <span class="s2">&quot;again&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-186"><a href="#SemanticDuplicateDetector-186"><span class="linenos">186</span></a>            <span class="s2">&quot;further&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-187"><a href="#SemanticDuplicateDetector-187"><span class="linenos">187</span></a>            <span class="s2">&quot;then&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-188"><a href="#SemanticDuplicateDetector-188"><span class="linenos">188</span></a>            <span class="s2">&quot;once&quot;</span><span class="p">,</span>
</span><span id="SemanticDuplicateDetector-189"><a href="#SemanticDuplicateDetector-189"><span class="linenos">189</span></a>        <span class="p">}</span>
</span><span id="SemanticDuplicateDetector-190"><a href="#SemanticDuplicateDetector-190"><span class="linenos">190</span></a>
</span><span id="SemanticDuplicateDetector-191"><a href="#SemanticDuplicateDetector-191"><span class="linenos">191</span></a>        <span class="n">key_terms</span> <span class="o">=</span> <span class="p">{</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">}</span>
</span><span id="SemanticDuplicateDetector-192"><a href="#SemanticDuplicateDetector-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">key_terms</span>
</span><span id="SemanticDuplicateDetector-193"><a href="#SemanticDuplicateDetector-193"><span class="linenos">193</span></a>
</span><span id="SemanticDuplicateDetector-194"><a href="#SemanticDuplicateDetector-194"><span class="linenos">194</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_semantic_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text2</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-195"><a href="#SemanticDuplicateDetector-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate semantic similarity between two texts with improved exact word matching.&quot;&quot;&quot;</span>
</span><span id="SemanticDuplicateDetector-196"><a href="#SemanticDuplicateDetector-196"><span class="linenos">196</span></a>        <span class="c1"># Normalize texts</span>
</span><span id="SemanticDuplicateDetector-197"><a href="#SemanticDuplicateDetector-197"><span class="linenos">197</span></a>        <span class="n">norm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_text</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-198"><a href="#SemanticDuplicateDetector-198"><span class="linenos">198</span></a>        <span class="n">norm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_text</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-199"><a href="#SemanticDuplicateDetector-199"><span class="linenos">199</span></a>
</span><span id="SemanticDuplicateDetector-200"><a href="#SemanticDuplicateDetector-200"><span class="linenos">200</span></a>        <span class="c1"># Check for exact word matches (NEW: improved for search queries)</span>
</span><span id="SemanticDuplicateDetector-201"><a href="#SemanticDuplicateDetector-201"><span class="linenos">201</span></a>        <span class="n">words1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">norm1</span><span class="p">))</span>
</span><span id="SemanticDuplicateDetector-202"><a href="#SemanticDuplicateDetector-202"><span class="linenos">202</span></a>        <span class="n">words2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">norm2</span><span class="p">))</span>
</span><span id="SemanticDuplicateDetector-203"><a href="#SemanticDuplicateDetector-203"><span class="linenos">203</span></a>        <span class="n">exact_matches</span> <span class="o">=</span> <span class="n">words1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">words2</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-204"><a href="#SemanticDuplicateDetector-204"><span class="linenos">204</span></a>
</span><span id="SemanticDuplicateDetector-205"><a href="#SemanticDuplicateDetector-205"><span class="linenos">205</span></a>        <span class="c1"># If we have exact word matches, boost the score significantly</span>
</span><span id="SemanticDuplicateDetector-206"><a href="#SemanticDuplicateDetector-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="n">exact_matches</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">words1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># For short queries (1-3 words)</span>
</span><span id="SemanticDuplicateDetector-207"><a href="#SemanticDuplicateDetector-207"><span class="linenos">207</span></a>            <span class="n">match_ratio</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exact_matches</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">words1</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-208"><a href="#SemanticDuplicateDetector-208"><span class="linenos">208</span></a>            <span class="n">exact_word_score</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">+</span> <span class="p">(</span><span class="n">match_ratio</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)</span>  <span class="c1"># 0.6 to 1.0 range</span>
</span><span id="SemanticDuplicateDetector-209"><a href="#SemanticDuplicateDetector-209"><span class="linenos">209</span></a>
</span><span id="SemanticDuplicateDetector-210"><a href="#SemanticDuplicateDetector-210"><span class="linenos">210</span></a>            <span class="c1"># Also calculate traditional semantic similarity</span>
</span><span id="SemanticDuplicateDetector-211"><a href="#SemanticDuplicateDetector-211"><span class="linenos">211</span></a>            <span class="n">string_similarity</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm1</span><span class="p">,</span> <span class="n">norm2</span><span class="p">)</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
</span><span id="SemanticDuplicateDetector-212"><a href="#SemanticDuplicateDetector-212"><span class="linenos">212</span></a>            <span class="n">terms1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_key_terms</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-213"><a href="#SemanticDuplicateDetector-213"><span class="linenos">213</span></a>            <span class="n">terms2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_key_terms</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-214"><a href="#SemanticDuplicateDetector-214"><span class="linenos">214</span></a>
</span><span id="SemanticDuplicateDetector-215"><a href="#SemanticDuplicateDetector-215"><span class="linenos">215</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">terms1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">terms2</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-216"><a href="#SemanticDuplicateDetector-216"><span class="linenos">216</span></a>                <span class="n">terms_similarity</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="SemanticDuplicateDetector-217"><a href="#SemanticDuplicateDetector-217"><span class="linenos">217</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">terms1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">terms2</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-218"><a href="#SemanticDuplicateDetector-218"><span class="linenos">218</span></a>                <span class="n">terms_similarity</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticDuplicateDetector-219"><a href="#SemanticDuplicateDetector-219"><span class="linenos">219</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-220"><a href="#SemanticDuplicateDetector-220"><span class="linenos">220</span></a>                <span class="n">intersection</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">terms2</span><span class="p">))</span>
</span><span id="SemanticDuplicateDetector-221"><a href="#SemanticDuplicateDetector-221"><span class="linenos">221</span></a>                <span class="n">union</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">terms2</span><span class="p">))</span>
</span><span id="SemanticDuplicateDetector-222"><a href="#SemanticDuplicateDetector-222"><span class="linenos">222</span></a>                <span class="n">terms_similarity</span> <span class="o">=</span> <span class="n">intersection</span> <span class="o">/</span> <span class="n">union</span> <span class="k">if</span> <span class="n">union</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
</span><span id="SemanticDuplicateDetector-223"><a href="#SemanticDuplicateDetector-223"><span class="linenos">223</span></a>
</span><span id="SemanticDuplicateDetector-224"><a href="#SemanticDuplicateDetector-224"><span class="linenos">224</span></a>            <span class="n">traditional_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">string_similarity</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">terms_similarity</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-225"><a href="#SemanticDuplicateDetector-225"><span class="linenos">225</span></a>
</span><span id="SemanticDuplicateDetector-226"><a href="#SemanticDuplicateDetector-226"><span class="linenos">226</span></a>            <span class="c1"># Return the higher of exact word score or traditional score</span>
</span><span id="SemanticDuplicateDetector-227"><a href="#SemanticDuplicateDetector-227"><span class="linenos">227</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">exact_word_score</span><span class="p">,</span> <span class="n">traditional_score</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-228"><a href="#SemanticDuplicateDetector-228"><span class="linenos">228</span></a>
</span><span id="SemanticDuplicateDetector-229"><a href="#SemanticDuplicateDetector-229"><span class="linenos">229</span></a>        <span class="c1"># For longer queries or no exact matches, use traditional method</span>
</span><span id="SemanticDuplicateDetector-230"><a href="#SemanticDuplicateDetector-230"><span class="linenos">230</span></a>        <span class="n">string_similarity</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm1</span><span class="p">,</span> <span class="n">norm2</span><span class="p">)</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
</span><span id="SemanticDuplicateDetector-231"><a href="#SemanticDuplicateDetector-231"><span class="linenos">231</span></a>
</span><span id="SemanticDuplicateDetector-232"><a href="#SemanticDuplicateDetector-232"><span class="linenos">232</span></a>        <span class="c1"># Key terms similarity</span>
</span><span id="SemanticDuplicateDetector-233"><a href="#SemanticDuplicateDetector-233"><span class="linenos">233</span></a>        <span class="n">terms1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_key_terms</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-234"><a href="#SemanticDuplicateDetector-234"><span class="linenos">234</span></a>        <span class="n">terms2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_key_terms</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-235"><a href="#SemanticDuplicateDetector-235"><span class="linenos">235</span></a>
</span><span id="SemanticDuplicateDetector-236"><a href="#SemanticDuplicateDetector-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">terms1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">terms2</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-237"><a href="#SemanticDuplicateDetector-237"><span class="linenos">237</span></a>            <span class="n">terms_similarity</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="SemanticDuplicateDetector-238"><a href="#SemanticDuplicateDetector-238"><span class="linenos">238</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">terms1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">terms2</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-239"><a href="#SemanticDuplicateDetector-239"><span class="linenos">239</span></a>            <span class="n">terms_similarity</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticDuplicateDetector-240"><a href="#SemanticDuplicateDetector-240"><span class="linenos">240</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-241"><a href="#SemanticDuplicateDetector-241"><span class="linenos">241</span></a>            <span class="n">intersection</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">terms2</span><span class="p">))</span>
</span><span id="SemanticDuplicateDetector-242"><a href="#SemanticDuplicateDetector-242"><span class="linenos">242</span></a>            <span class="n">union</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">terms2</span><span class="p">))</span>
</span><span id="SemanticDuplicateDetector-243"><a href="#SemanticDuplicateDetector-243"><span class="linenos">243</span></a>            <span class="n">terms_similarity</span> <span class="o">=</span> <span class="n">intersection</span> <span class="o">/</span> <span class="n">union</span> <span class="k">if</span> <span class="n">union</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
</span><span id="SemanticDuplicateDetector-244"><a href="#SemanticDuplicateDetector-244"><span class="linenos">244</span></a>
</span><span id="SemanticDuplicateDetector-245"><a href="#SemanticDuplicateDetector-245"><span class="linenos">245</span></a>        <span class="c1"># Weighted combination</span>
</span><span id="SemanticDuplicateDetector-246"><a href="#SemanticDuplicateDetector-246"><span class="linenos">246</span></a>        <span class="n">semantic_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">string_similarity</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">terms_similarity</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-247"><a href="#SemanticDuplicateDetector-247"><span class="linenos">247</span></a>
</span><span id="SemanticDuplicateDetector-248"><a href="#SemanticDuplicateDetector-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="n">semantic_score</span>
</span><span id="SemanticDuplicateDetector-249"><a href="#SemanticDuplicateDetector-249"><span class="linenos">249</span></a>
</span><span id="SemanticDuplicateDetector-250"><a href="#SemanticDuplicateDetector-250"><span class="linenos">250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_duplicate</span><span class="p">(</span>
</span><span id="SemanticDuplicateDetector-251"><a href="#SemanticDuplicateDetector-251"><span class="linenos">251</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">existing_texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="SemanticDuplicateDetector-252"><a href="#SemanticDuplicateDetector-252"><span class="linenos">252</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="SemanticDuplicateDetector-253"><a href="#SemanticDuplicateDetector-253"><span class="linenos">253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticDuplicateDetector-254"><a href="#SemanticDuplicateDetector-254"><span class="linenos">254</span></a><span class="sd">        Check if new text is a duplicate of any existing texts.</span>
</span><span id="SemanticDuplicateDetector-255"><a href="#SemanticDuplicateDetector-255"><span class="linenos">255</span></a>
</span><span id="SemanticDuplicateDetector-256"><a href="#SemanticDuplicateDetector-256"><span class="linenos">256</span></a><span class="sd">        :param new_text: New text to check</span>
</span><span id="SemanticDuplicateDetector-257"><a href="#SemanticDuplicateDetector-257"><span class="linenos">257</span></a><span class="sd">        :param existing_texts: List of existing texts to compare against</span>
</span><span id="SemanticDuplicateDetector-258"><a href="#SemanticDuplicateDetector-258"><span class="linenos">258</span></a><span class="sd">        :return: Tuple of (is_duplicate, matching_text, similarity_score)</span>
</span><span id="SemanticDuplicateDetector-259"><a href="#SemanticDuplicateDetector-259"><span class="linenos">259</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticDuplicateDetector-260"><a href="#SemanticDuplicateDetector-260"><span class="linenos">260</span></a>        <span class="n">max_similarity</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticDuplicateDetector-261"><a href="#SemanticDuplicateDetector-261"><span class="linenos">261</span></a>        <span class="n">best_match</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SemanticDuplicateDetector-262"><a href="#SemanticDuplicateDetector-262"><span class="linenos">262</span></a>
</span><span id="SemanticDuplicateDetector-263"><a href="#SemanticDuplicateDetector-263"><span class="linenos">263</span></a>        <span class="k">for</span> <span class="n">existing_text</span> <span class="ow">in</span> <span class="n">existing_texts</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-264"><a href="#SemanticDuplicateDetector-264"><span class="linenos">264</span></a>            <span class="n">similarity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_semantic_similarity</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">existing_text</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector-265"><a href="#SemanticDuplicateDetector-265"><span class="linenos">265</span></a>
</span><span id="SemanticDuplicateDetector-266"><a href="#SemanticDuplicateDetector-266"><span class="linenos">266</span></a>            <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="n">max_similarity</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector-267"><a href="#SemanticDuplicateDetector-267"><span class="linenos">267</span></a>                <span class="n">max_similarity</span> <span class="o">=</span> <span class="n">similarity</span>
</span><span id="SemanticDuplicateDetector-268"><a href="#SemanticDuplicateDetector-268"><span class="linenos">268</span></a>                <span class="n">best_match</span> <span class="o">=</span> <span class="n">existing_text</span>
</span><span id="SemanticDuplicateDetector-269"><a href="#SemanticDuplicateDetector-269"><span class="linenos">269</span></a>
</span><span id="SemanticDuplicateDetector-270"><a href="#SemanticDuplicateDetector-270"><span class="linenos">270</span></a>        <span class="n">is_duplicate</span> <span class="o">=</span> <span class="n">max_similarity</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span>
</span><span id="SemanticDuplicateDetector-271"><a href="#SemanticDuplicateDetector-271"><span class="linenos">271</span></a>
</span><span id="SemanticDuplicateDetector-272"><a href="#SemanticDuplicateDetector-272"><span class="linenos">272</span></a>        <span class="k">return</span> <span class="n">is_duplicate</span><span class="p">,</span> <span class="n">best_match</span><span class="p">,</span> <span class="n">max_similarity</span>
</span></pre></div>


            <div class="docstring"><p>Semantic duplicate detection without LLM using advanced text similarity.</p>
</div>


                            <div id="SemanticDuplicateDetector.__init__" class="classattr">
                                        <input id="SemanticDuplicateDetector.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SemanticDuplicateDetector</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span></span>)</span>

                <label class="view-source-button" for="SemanticDuplicateDetector.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticDuplicateDetector.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticDuplicateDetector.__init__-77"><a href="#SemanticDuplicateDetector.__init__-77"><span class="linenos">77</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">):</span>
</span><span id="SemanticDuplicateDetector.__init__-78"><a href="#SemanticDuplicateDetector.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span> <span class="o">=</span> <span class="n">similarity_threshold</span>
</span></pre></div>


    

                            </div>
                            <div id="SemanticDuplicateDetector.similarity_threshold" class="classattr">
                                <div class="attr variable">
            <span class="name">similarity_threshold</span>

        
    </div>
    <a class="headerlink" href="#SemanticDuplicateDetector.similarity_threshold"></a>
    
    

                            </div>
                            <div id="SemanticDuplicateDetector.is_duplicate" class="classattr">
                                        <input id="SemanticDuplicateDetector.is_duplicate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_duplicate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">existing_texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SemanticDuplicateDetector.is_duplicate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticDuplicateDetector.is_duplicate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticDuplicateDetector.is_duplicate-250"><a href="#SemanticDuplicateDetector.is_duplicate-250"><span class="linenos">250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_duplicate</span><span class="p">(</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-251"><a href="#SemanticDuplicateDetector.is_duplicate-251"><span class="linenos">251</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">existing_texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-252"><a href="#SemanticDuplicateDetector.is_duplicate-252"><span class="linenos">252</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-253"><a href="#SemanticDuplicateDetector.is_duplicate-253"><span class="linenos">253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-254"><a href="#SemanticDuplicateDetector.is_duplicate-254"><span class="linenos">254</span></a><span class="sd">        Check if new text is a duplicate of any existing texts.</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-255"><a href="#SemanticDuplicateDetector.is_duplicate-255"><span class="linenos">255</span></a>
</span><span id="SemanticDuplicateDetector.is_duplicate-256"><a href="#SemanticDuplicateDetector.is_duplicate-256"><span class="linenos">256</span></a><span class="sd">        :param new_text: New text to check</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-257"><a href="#SemanticDuplicateDetector.is_duplicate-257"><span class="linenos">257</span></a><span class="sd">        :param existing_texts: List of existing texts to compare against</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-258"><a href="#SemanticDuplicateDetector.is_duplicate-258"><span class="linenos">258</span></a><span class="sd">        :return: Tuple of (is_duplicate, matching_text, similarity_score)</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-259"><a href="#SemanticDuplicateDetector.is_duplicate-259"><span class="linenos">259</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-260"><a href="#SemanticDuplicateDetector.is_duplicate-260"><span class="linenos">260</span></a>        <span class="n">max_similarity</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-261"><a href="#SemanticDuplicateDetector.is_duplicate-261"><span class="linenos">261</span></a>        <span class="n">best_match</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-262"><a href="#SemanticDuplicateDetector.is_duplicate-262"><span class="linenos">262</span></a>
</span><span id="SemanticDuplicateDetector.is_duplicate-263"><a href="#SemanticDuplicateDetector.is_duplicate-263"><span class="linenos">263</span></a>        <span class="k">for</span> <span class="n">existing_text</span> <span class="ow">in</span> <span class="n">existing_texts</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-264"><a href="#SemanticDuplicateDetector.is_duplicate-264"><span class="linenos">264</span></a>            <span class="n">similarity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_semantic_similarity</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">existing_text</span><span class="p">)</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-265"><a href="#SemanticDuplicateDetector.is_duplicate-265"><span class="linenos">265</span></a>
</span><span id="SemanticDuplicateDetector.is_duplicate-266"><a href="#SemanticDuplicateDetector.is_duplicate-266"><span class="linenos">266</span></a>            <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="n">max_similarity</span><span class="p">:</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-267"><a href="#SemanticDuplicateDetector.is_duplicate-267"><span class="linenos">267</span></a>                <span class="n">max_similarity</span> <span class="o">=</span> <span class="n">similarity</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-268"><a href="#SemanticDuplicateDetector.is_duplicate-268"><span class="linenos">268</span></a>                <span class="n">best_match</span> <span class="o">=</span> <span class="n">existing_text</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-269"><a href="#SemanticDuplicateDetector.is_duplicate-269"><span class="linenos">269</span></a>
</span><span id="SemanticDuplicateDetector.is_duplicate-270"><a href="#SemanticDuplicateDetector.is_duplicate-270"><span class="linenos">270</span></a>        <span class="n">is_duplicate</span> <span class="o">=</span> <span class="n">max_similarity</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span>
</span><span id="SemanticDuplicateDetector.is_duplicate-271"><a href="#SemanticDuplicateDetector.is_duplicate-271"><span class="linenos">271</span></a>
</span><span id="SemanticDuplicateDetector.is_duplicate-272"><a href="#SemanticDuplicateDetector.is_duplicate-272"><span class="linenos">272</span></a>        <span class="k">return</span> <span class="n">is_duplicate</span><span class="p">,</span> <span class="n">best_match</span><span class="p">,</span> <span class="n">max_similarity</span>
</span></pre></div>


            <div class="docstring"><p>Check if new text is a duplicate of any existing texts.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>new_text</strong>:  New text to check</li>
<li><strong>existing_texts</strong>:  List of existing texts to compare against</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Tuple of (is_duplicate, matching_text, similarity_score)</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="create_semantic_memory_manager">
                            <input id="create_semantic_memory_manager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_semantic_memory_manager</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">agno</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span>,</span><span class="param">	<span class="n">enable_semantic_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">enable_exact_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">enable_topic_classification</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#SemanticMemoryManager">SemanticMemoryManager</a></span>:</span></span>

                <label class="view-source-button" for="create_semantic_memory_manager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_semantic_memory_manager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_semantic_memory_manager-1599"><a href="#create_semantic_memory_manager-1599"><span class="linenos">1599</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_semantic_memory_manager</span><span class="p">(</span>
</span><span id="create_semantic_memory_manager-1600"><a href="#create_semantic_memory_manager-1600"><span class="linenos">1600</span></a>    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1601"><a href="#create_semantic_memory_manager-1601"><span class="linenos">1601</span></a>    <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1602"><a href="#create_semantic_memory_manager-1602"><span class="linenos">1602</span></a>    <span class="n">enable_semantic_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1603"><a href="#create_semantic_memory_manager-1603"><span class="linenos">1603</span></a>    <span class="n">enable_exact_dedup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1604"><a href="#create_semantic_memory_manager-1604"><span class="linenos">1604</span></a>    <span class="n">enable_topic_classification</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1605"><a href="#create_semantic_memory_manager-1605"><span class="linenos">1605</span></a>    <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1606"><a href="#create_semantic_memory_manager-1606"><span class="linenos">1606</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SemanticMemoryManager</span><span class="p">:</span>
</span><span id="create_semantic_memory_manager-1607"><a href="#create_semantic_memory_manager-1607"><span class="linenos">1607</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_semantic_memory_manager-1608"><a href="#create_semantic_memory_manager-1608"><span class="linenos">1608</span></a><span class="sd">    Create a SemanticMemoryManager instance with sensible defaults.</span>
</span><span id="create_semantic_memory_manager-1609"><a href="#create_semantic_memory_manager-1609"><span class="linenos">1609</span></a>
</span><span id="create_semantic_memory_manager-1610"><a href="#create_semantic_memory_manager-1610"><span class="linenos">1610</span></a><span class="sd">    :param model: Optional model instance (required by Agno Memory class)</span>
</span><span id="create_semantic_memory_manager-1611"><a href="#create_semantic_memory_manager-1611"><span class="linenos">1611</span></a><span class="sd">    :param similarity_threshold: Threshold for semantic similarity</span>
</span><span id="create_semantic_memory_manager-1612"><a href="#create_semantic_memory_manager-1612"><span class="linenos">1612</span></a><span class="sd">    :param enable_semantic_dedup: Enable semantic duplicate detection</span>
</span><span id="create_semantic_memory_manager-1613"><a href="#create_semantic_memory_manager-1613"><span class="linenos">1613</span></a><span class="sd">    :param enable_exact_dedup: Enable exact duplicate detection</span>
</span><span id="create_semantic_memory_manager-1614"><a href="#create_semantic_memory_manager-1614"><span class="linenos">1614</span></a><span class="sd">    :param enable_topic_classification: Enable automatic topic classification</span>
</span><span id="create_semantic_memory_manager-1615"><a href="#create_semantic_memory_manager-1615"><span class="linenos">1615</span></a><span class="sd">    :param debug_mode: Enable debug output</span>
</span><span id="create_semantic_memory_manager-1616"><a href="#create_semantic_memory_manager-1616"><span class="linenos">1616</span></a><span class="sd">    :return: Configured SemanticMemoryManager instance</span>
</span><span id="create_semantic_memory_manager-1617"><a href="#create_semantic_memory_manager-1617"><span class="linenos">1617</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_semantic_memory_manager-1618"><a href="#create_semantic_memory_manager-1618"><span class="linenos">1618</span></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">SemanticMemoryManagerConfig</span><span class="p">(</span>
</span><span id="create_semantic_memory_manager-1619"><a href="#create_semantic_memory_manager-1619"><span class="linenos">1619</span></a>        <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">similarity_threshold</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1620"><a href="#create_semantic_memory_manager-1620"><span class="linenos">1620</span></a>        <span class="n">enable_semantic_dedup</span><span class="o">=</span><span class="n">enable_semantic_dedup</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1621"><a href="#create_semantic_memory_manager-1621"><span class="linenos">1621</span></a>        <span class="n">enable_exact_dedup</span><span class="o">=</span><span class="n">enable_exact_dedup</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1622"><a href="#create_semantic_memory_manager-1622"><span class="linenos">1622</span></a>        <span class="n">enable_topic_classification</span><span class="o">=</span><span class="n">enable_topic_classification</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1623"><a href="#create_semantic_memory_manager-1623"><span class="linenos">1623</span></a>        <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
</span><span id="create_semantic_memory_manager-1624"><a href="#create_semantic_memory_manager-1624"><span class="linenos">1624</span></a>    <span class="p">)</span>
</span><span id="create_semantic_memory_manager-1625"><a href="#create_semantic_memory_manager-1625"><span class="linenos">1625</span></a>
</span><span id="create_semantic_memory_manager-1626"><a href="#create_semantic_memory_manager-1626"><span class="linenos">1626</span></a>    <span class="k">return</span> <span class="n">SemanticMemoryManager</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a SemanticMemoryManager instance with sensible defaults.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>model</strong>:  Optional model instance (required by Agno Memory class)</li>
<li><strong>similarity_threshold</strong>:  Threshold for semantic similarity</li>
<li><strong>enable_semantic_dedup</strong>:  Enable semantic duplicate detection</li>
<li><strong>enable_exact_dedup</strong>:  Enable exact duplicate detection</li>
<li><strong>enable_topic_classification</strong>:  Enable automatic topic classification</li>
<li><strong>debug_mode</strong>:  Enable debug output</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Configured SemanticMemoryManager instance</p>
</blockquote>
</div>


                </section>
                <section id="AgentMemoryManager">
                            <input id="AgentMemoryManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AgentMemoryManager</span>:

                <label class="view-source-button" for="AgentMemoryManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager-29"><a href="#AgentMemoryManager-29"><span class="linenos">  29</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AgentMemoryManager</span><span class="p">:</span>
</span><span id="AgentMemoryManager-30"><a href="#AgentMemoryManager-30"><span class="linenos">  30</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages memory operations including storage, retrieval, and updates.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-31"><a href="#AgentMemoryManager-31"><span class="linenos">  31</span></a>
</span><span id="AgentMemoryManager-32"><a href="#AgentMemoryManager-32"><span class="linenos">  32</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AgentMemoryManager-33"><a href="#AgentMemoryManager-33"><span class="linenos">  33</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AgentMemoryManager-34"><a href="#AgentMemoryManager-34"><span class="linenos">  34</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager-35"><a href="#AgentMemoryManager-35"><span class="linenos">  35</span></a>        <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager-36"><a href="#AgentMemoryManager-36"><span class="linenos">  36</span></a>        <span class="n">agno_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager-37"><a href="#AgentMemoryManager-37"><span class="linenos">  37</span></a>        <span class="n">lightrag_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager-38"><a href="#AgentMemoryManager-38"><span class="linenos">  38</span></a>        <span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager-39"><a href="#AgentMemoryManager-39"><span class="linenos">  39</span></a>        <span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-40"><a href="#AgentMemoryManager-40"><span class="linenos">  40</span></a>    <span class="p">):</span>
</span><span id="AgentMemoryManager-41"><a href="#AgentMemoryManager-41"><span class="linenos">  41</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the memory manager.</span>
</span><span id="AgentMemoryManager-42"><a href="#AgentMemoryManager-42"><span class="linenos">  42</span></a>
</span><span id="AgentMemoryManager-43"><a href="#AgentMemoryManager-43"><span class="linenos">  43</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-44"><a href="#AgentMemoryManager-44"><span class="linenos">  44</span></a><span class="sd">            user_id: User identifier for memory operations</span>
</span><span id="AgentMemoryManager-45"><a href="#AgentMemoryManager-45"><span class="linenos">  45</span></a><span class="sd">            storage_dir: Directory for storage files</span>
</span><span id="AgentMemoryManager-46"><a href="#AgentMemoryManager-46"><span class="linenos">  46</span></a><span class="sd">            agno_memory: Optional initialized agno memory instance</span>
</span><span id="AgentMemoryManager-47"><a href="#AgentMemoryManager-47"><span class="linenos">  47</span></a><span class="sd">            lightrag_url: Optional URL for LightRAG API</span>
</span><span id="AgentMemoryManager-48"><a href="#AgentMemoryManager-48"><span class="linenos">  48</span></a><span class="sd">            lightrag_memory_url: Optional URL for LightRAG Memory API</span>
</span><span id="AgentMemoryManager-49"><a href="#AgentMemoryManager-49"><span class="linenos">  49</span></a><span class="sd">            enable_memory: Whether memory is enabled</span>
</span><span id="AgentMemoryManager-50"><a href="#AgentMemoryManager-50"><span class="linenos">  50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-51"><a href="#AgentMemoryManager-51"><span class="linenos">  51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgentMemoryManager-52"><a href="#AgentMemoryManager-52"><span class="linenos">  52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">storage_dir</span>
</span><span id="AgentMemoryManager-53"><a href="#AgentMemoryManager-53"><span class="linenos">  53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="n">agno_memory</span>
</span><span id="AgentMemoryManager-54"><a href="#AgentMemoryManager-54"><span class="linenos">  54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_url</span> <span class="o">=</span> <span class="n">lightrag_url</span>
</span><span id="AgentMemoryManager-55"><a href="#AgentMemoryManager-55"><span class="linenos">  55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span> <span class="o">=</span> <span class="n">lightrag_memory_url</span>
</span><span id="AgentMemoryManager-56"><a href="#AgentMemoryManager-56"><span class="linenos">  56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="o">=</span> <span class="n">enable_memory</span>
</span><span id="AgentMemoryManager-57"><a href="#AgentMemoryManager-57"><span class="linenos">  57</span></a>
</span><span id="AgentMemoryManager-58"><a href="#AgentMemoryManager-58"><span class="linenos">  58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agno_memory</span><span class="p">):</span>
</span><span id="AgentMemoryManager-59"><a href="#AgentMemoryManager-59"><span class="linenos">  59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the memory manager with agno_memory.</span>
</span><span id="AgentMemoryManager-60"><a href="#AgentMemoryManager-60"><span class="linenos">  60</span></a>
</span><span id="AgentMemoryManager-61"><a href="#AgentMemoryManager-61"><span class="linenos">  61</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-62"><a href="#AgentMemoryManager-62"><span class="linenos">  62</span></a><span class="sd">            agno_memory: The initialized agno memory instance</span>
</span><span id="AgentMemoryManager-63"><a href="#AgentMemoryManager-63"><span class="linenos">  63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-64"><a href="#AgentMemoryManager-64"><span class="linenos">  64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="n">agno_memory</span>
</span><span id="AgentMemoryManager-65"><a href="#AgentMemoryManager-65"><span class="linenos">  65</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Memory manager initialized with agno_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-66"><a href="#AgentMemoryManager-66"><span class="linenos">  66</span></a>
</span><span id="AgentMemoryManager-67"><a href="#AgentMemoryManager-67"><span class="linenos">  67</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">direct_search_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager-68"><a href="#AgentMemoryManager-68"><span class="linenos">  68</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="AgentMemoryManager-69"><a href="#AgentMemoryManager-69"><span class="linenos">  69</span></a>    <span class="p">):</span>
</span><span id="AgentMemoryManager-70"><a href="#AgentMemoryManager-70"><span class="linenos">  70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Direct semantic search without agentic retrieval.</span>
</span><span id="AgentMemoryManager-71"><a href="#AgentMemoryManager-71"><span class="linenos">  71</span></a>
</span><span id="AgentMemoryManager-72"><a href="#AgentMemoryManager-72"><span class="linenos">  72</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-73"><a href="#AgentMemoryManager-73"><span class="linenos">  73</span></a><span class="sd">            query: The search query</span>
</span><span id="AgentMemoryManager-74"><a href="#AgentMemoryManager-74"><span class="linenos">  74</span></a><span class="sd">            limit: Maximum number of results to return</span>
</span><span id="AgentMemoryManager-75"><a href="#AgentMemoryManager-75"><span class="linenos">  75</span></a><span class="sd">            similarity_threshold: Minimum similarity score for results</span>
</span><span id="AgentMemoryManager-76"><a href="#AgentMemoryManager-76"><span class="linenos">  76</span></a>
</span><span id="AgentMemoryManager-77"><a href="#AgentMemoryManager-77"><span class="linenos">  77</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-78"><a href="#AgentMemoryManager-78"><span class="linenos">  78</span></a><span class="sd">            List of memory results</span>
</span><span id="AgentMemoryManager-79"><a href="#AgentMemoryManager-79"><span class="linenos">  79</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-80"><a href="#AgentMemoryManager-80"><span class="linenos">  80</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgentMemoryManager-81"><a href="#AgentMemoryManager-81"><span class="linenos">  81</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-82"><a href="#AgentMemoryManager-82"><span class="linenos">  82</span></a>
</span><span id="AgentMemoryManager-83"><a href="#AgentMemoryManager-83"><span class="linenos">  83</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-84"><a href="#AgentMemoryManager-84"><span class="linenos">  84</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">search_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager-85"><a href="#AgentMemoryManager-85"><span class="linenos">  85</span></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
</span><span id="AgentMemoryManager-86"><a href="#AgentMemoryManager-86"><span class="linenos">  86</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager-87"><a href="#AgentMemoryManager-87"><span class="linenos">  87</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-88"><a href="#AgentMemoryManager-88"><span class="linenos">  88</span></a>                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span id="AgentMemoryManager-89"><a href="#AgentMemoryManager-89"><span class="linenos">  89</span></a>                <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">similarity_threshold</span><span class="p">,</span>
</span><span id="AgentMemoryManager-90"><a href="#AgentMemoryManager-90"><span class="linenos">  90</span></a>                <span class="n">search_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-91"><a href="#AgentMemoryManager-91"><span class="linenos">  91</span></a>                <span class="n">topic_boost</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="AgentMemoryManager-92"><a href="#AgentMemoryManager-92"><span class="linenos">  92</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-93"><a href="#AgentMemoryManager-93"><span class="linenos">  93</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="AgentMemoryManager-94"><a href="#AgentMemoryManager-94"><span class="linenos">  94</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-95"><a href="#AgentMemoryManager-95"><span class="linenos">  95</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Direct semantic search failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-96"><a href="#AgentMemoryManager-96"><span class="linenos">  96</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-97"><a href="#AgentMemoryManager-97"><span class="linenos">  97</span></a>
</span><span id="AgentMemoryManager-98"><a href="#AgentMemoryManager-98"><span class="linenos">  98</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="AgentMemoryManager-99"><a href="#AgentMemoryManager-99"><span class="linenos">  99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create memory tools using direct SemanticMemoryManager method calls.</span>
</span><span id="AgentMemoryManager-100"><a href="#AgentMemoryManager-100"><span class="linenos"> 100</span></a>
</span><span id="AgentMemoryManager-101"><a href="#AgentMemoryManager-101"><span class="linenos"> 101</span></a><span class="sd">        This method creates memory tools that directly call SemanticMemoryManager methods</span>
</span><span id="AgentMemoryManager-102"><a href="#AgentMemoryManager-102"><span class="linenos"> 102</span></a><span class="sd">        instead of using complex wrapper functions, making the code much simpler and more maintainable.</span>
</span><span id="AgentMemoryManager-103"><a href="#AgentMemoryManager-103"><span class="linenos"> 103</span></a>
</span><span id="AgentMemoryManager-104"><a href="#AgentMemoryManager-104"><span class="linenos"> 104</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-105"><a href="#AgentMemoryManager-105"><span class="linenos"> 105</span></a><span class="sd">            List of memory tool functions</span>
</span><span id="AgentMemoryManager-106"><a href="#AgentMemoryManager-106"><span class="linenos"> 106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-107"><a href="#AgentMemoryManager-107"><span class="linenos"> 107</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgentMemoryManager-108"><a href="#AgentMemoryManager-108"><span class="linenos"> 108</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Memory not enabled or memory not initialized&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-109"><a href="#AgentMemoryManager-109"><span class="linenos"> 109</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-110"><a href="#AgentMemoryManager-110"><span class="linenos"> 110</span></a>
</span><span id="AgentMemoryManager-111"><a href="#AgentMemoryManager-111"><span class="linenos"> 111</span></a>        <span class="c1"># Check if memory is available</span>
</span><span id="AgentMemoryManager-112"><a href="#AgentMemoryManager-112"><span class="linenos"> 112</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgentMemoryManager-113"><a href="#AgentMemoryManager-113"><span class="linenos"> 113</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Memory not initialized&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-114"><a href="#AgentMemoryManager-114"><span class="linenos"> 114</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-115"><a href="#AgentMemoryManager-115"><span class="linenos"> 115</span></a>
</span><span id="AgentMemoryManager-116"><a href="#AgentMemoryManager-116"><span class="linenos"> 116</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-117"><a href="#AgentMemoryManager-117"><span class="linenos"> 117</span></a>
</span><span id="AgentMemoryManager-118"><a href="#AgentMemoryManager-118"><span class="linenos"> 118</span></a>        <span class="c1"># Define all the memory tool functions</span>
</span><span id="AgentMemoryManager-119"><a href="#AgentMemoryManager-119"><span class="linenos"> 119</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_user_memory_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager-120"><a href="#AgentMemoryManager-120"><span class="linenos"> 120</span></a>            <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-121"><a href="#AgentMemoryManager-121"><span class="linenos"> 121</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-122"><a href="#AgentMemoryManager-122"><span class="linenos"> 122</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;A tool that wraps the public store_user_memory method.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-123"><a href="#AgentMemoryManager-123"><span class="linenos"> 123</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_user_memory</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">)</span>
</span><span id="AgentMemoryManager-124"><a href="#AgentMemoryManager-124"><span class="linenos"> 124</span></a>
</span><span id="AgentMemoryManager-125"><a href="#AgentMemoryManager-125"><span class="linenos"> 125</span></a>            <span class="c1"># Format the result for user display</span>
</span><span id="AgentMemoryManager-126"><a href="#AgentMemoryManager-126"><span class="linenos"> 126</span></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-127"><a href="#AgentMemoryManager-127"><span class="linenos"> 127</span></a>                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
</span><span id="AgentMemoryManager-128"><a href="#AgentMemoryManager-128"><span class="linenos"> 128</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-129"><a href="#AgentMemoryManager-129"><span class="linenos"> 129</span></a>                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS_LOCAL_ONLY</span><span class="p">:</span>
</span><span id="AgentMemoryManager-130"><a href="#AgentMemoryManager-130"><span class="linenos"> 130</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;⚠️ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-131"><a href="#AgentMemoryManager-131"><span class="linenos"> 131</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-132"><a href="#AgentMemoryManager-132"><span class="linenos"> 132</span></a>                <span class="c1"># Handle different rejection types with appropriate emojis</span>
</span><span id="AgentMemoryManager-133"><a href="#AgentMemoryManager-133"><span class="linenos"> 133</span></a>                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_EXACT</span><span class="p">:</span>
</span><span id="AgentMemoryManager-134"><a href="#AgentMemoryManager-134"><span class="linenos"> 134</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🔄 </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-135"><a href="#AgentMemoryManager-135"><span class="linenos"> 135</span></a>                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_SEMANTIC</span><span class="p">:</span>
</span><span id="AgentMemoryManager-136"><a href="#AgentMemoryManager-136"><span class="linenos"> 136</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🔄 </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2"> (similarity: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">similarity_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="AgentMemoryManager-137"><a href="#AgentMemoryManager-137"><span class="linenos"> 137</span></a>                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_EMPTY</span><span class="p">:</span>
</span><span id="AgentMemoryManager-138"><a href="#AgentMemoryManager-138"><span class="linenos"> 138</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-139"><a href="#AgentMemoryManager-139"><span class="linenos"> 139</span></a>                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_TOO_LONG</span><span class="p">:</span>
</span><span id="AgentMemoryManager-140"><a href="#AgentMemoryManager-140"><span class="linenos"> 140</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-141"><a href="#AgentMemoryManager-141"><span class="linenos"> 141</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-142"><a href="#AgentMemoryManager-142"><span class="linenos"> 142</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-143"><a href="#AgentMemoryManager-143"><span class="linenos"> 143</span></a>
</span><span id="AgentMemoryManager-144"><a href="#AgentMemoryManager-144"><span class="linenos"> 144</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_memory_tool</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-145"><a href="#AgentMemoryManager-145"><span class="linenos"> 145</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Search user memories using direct SemanticMemoryManager calls.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-146"><a href="#AgentMemoryManager-146"><span class="linenos"> 146</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_memory</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
</span><span id="AgentMemoryManager-147"><a href="#AgentMemoryManager-147"><span class="linenos"> 147</span></a>
</span><span id="AgentMemoryManager-148"><a href="#AgentMemoryManager-148"><span class="linenos"> 148</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_memory_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager-149"><a href="#AgentMemoryManager-149"><span class="linenos"> 149</span></a>            <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-150"><a href="#AgentMemoryManager-150"><span class="linenos"> 150</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-151"><a href="#AgentMemoryManager-151"><span class="linenos"> 151</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Update an existing memory.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-152"><a href="#AgentMemoryManager-152"><span class="linenos"> 152</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_memory</span><span class="p">(</span><span class="n">memory_id</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
</span><span id="AgentMemoryManager-153"><a href="#AgentMemoryManager-153"><span class="linenos"> 153</span></a>
</span><span id="AgentMemoryManager-154"><a href="#AgentMemoryManager-154"><span class="linenos"> 154</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_memory_tool</span><span class="p">(</span><span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-155"><a href="#AgentMemoryManager-155"><span class="linenos"> 155</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Delete a memory from both SQLite and LightRAG systems.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-156"><a href="#AgentMemoryManager-156"><span class="linenos"> 156</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">memory_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-157"><a href="#AgentMemoryManager-157"><span class="linenos"> 157</span></a>
</span><span id="AgentMemoryManager-158"><a href="#AgentMemoryManager-158"><span class="linenos"> 158</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_recent_memories_tool</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-159"><a href="#AgentMemoryManager-159"><span class="linenos"> 159</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get recent memories by searching all memories and sorting by date.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-160"><a href="#AgentMemoryManager-160"><span class="linenos"> 160</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_recent_memories</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
</span><span id="AgentMemoryManager-161"><a href="#AgentMemoryManager-161"><span class="linenos"> 161</span></a>
</span><span id="AgentMemoryManager-162"><a href="#AgentMemoryManager-162"><span class="linenos"> 162</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_memories_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-163"><a href="#AgentMemoryManager-163"><span class="linenos"> 163</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get all user memories.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-164"><a href="#AgentMemoryManager-164"><span class="linenos"> 164</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">()</span>
</span><span id="AgentMemoryManager-165"><a href="#AgentMemoryManager-165"><span class="linenos"> 165</span></a>
</span><span id="AgentMemoryManager-166"><a href="#AgentMemoryManager-166"><span class="linenos"> 166</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_stats_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-167"><a href="#AgentMemoryManager-167"><span class="linenos"> 167</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get memory statistics.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-168"><a href="#AgentMemoryManager-168"><span class="linenos"> 168</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_stats</span><span class="p">()</span>
</span><span id="AgentMemoryManager-169"><a href="#AgentMemoryManager-169"><span class="linenos"> 169</span></a>
</span><span id="AgentMemoryManager-170"><a href="#AgentMemoryManager-170"><span class="linenos"> 170</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memories_by_topic_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager-171"><a href="#AgentMemoryManager-171"><span class="linenos"> 171</span></a>            <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-172"><a href="#AgentMemoryManager-172"><span class="linenos"> 172</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-173"><a href="#AgentMemoryManager-173"><span class="linenos"> 173</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get memories by topic without similarity search.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-174"><a href="#AgentMemoryManager-174"><span class="linenos"> 174</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memories_by_topic</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
</span><span id="AgentMemoryManager-175"><a href="#AgentMemoryManager-175"><span class="linenos"> 175</span></a>
</span><span id="AgentMemoryManager-176"><a href="#AgentMemoryManager-176"><span class="linenos"> 176</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_memories_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-177"><a href="#AgentMemoryManager-177"><span class="linenos"> 177</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;List all memories in a simple, user-friendly format.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-178"><a href="#AgentMemoryManager-178"><span class="linenos"> 178</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_memories</span><span class="p">()</span>
</span><span id="AgentMemoryManager-179"><a href="#AgentMemoryManager-179"><span class="linenos"> 179</span></a>
</span><span id="AgentMemoryManager-180"><a href="#AgentMemoryManager-180"><span class="linenos"> 180</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_graph_memory_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager-181"><a href="#AgentMemoryManager-181"><span class="linenos"> 181</span></a>            <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager-182"><a href="#AgentMemoryManager-182"><span class="linenos"> 182</span></a>            <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager-183"><a href="#AgentMemoryManager-183"><span class="linenos"> 183</span></a>            <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager-184"><a href="#AgentMemoryManager-184"><span class="linenos"> 184</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-185"><a href="#AgentMemoryManager-185"><span class="linenos"> 185</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Store a memory in the LightRAG graph database to capture relationships.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-186"><a href="#AgentMemoryManager-186"><span class="linenos"> 186</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_graph_memory</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">topics</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-187"><a href="#AgentMemoryManager-187"><span class="linenos"> 187</span></a>
</span><span id="AgentMemoryManager-188"><a href="#AgentMemoryManager-188"><span class="linenos"> 188</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_graph_memory_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager-189"><a href="#AgentMemoryManager-189"><span class="linenos"> 189</span></a>            <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager-190"><a href="#AgentMemoryManager-190"><span class="linenos"> 190</span></a>            <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mix&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-191"><a href="#AgentMemoryManager-191"><span class="linenos"> 191</span></a>            <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="AgentMemoryManager-192"><a href="#AgentMemoryManager-192"><span class="linenos"> 192</span></a>            <span class="n">response_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-193"><a href="#AgentMemoryManager-193"><span class="linenos"> 193</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="AgentMemoryManager-194"><a href="#AgentMemoryManager-194"><span class="linenos"> 194</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Query the LightRAG memory graph to explore relationships between memories.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-195"><a href="#AgentMemoryManager-195"><span class="linenos"> 195</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_graph_memory</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">top_k</span><span class="p">,</span> <span class="n">response_type</span><span class="p">)</span>
</span><span id="AgentMemoryManager-196"><a href="#AgentMemoryManager-196"><span class="linenos"> 196</span></a>
</span><span id="AgentMemoryManager-197"><a href="#AgentMemoryManager-197"><span class="linenos"> 197</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_graph_labels_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-198"><a href="#AgentMemoryManager-198"><span class="linenos"> 198</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get the list of all entity and relation labels from the memory graph.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-199"><a href="#AgentMemoryManager-199"><span class="linenos"> 199</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_graph_labels</span><span class="p">()</span>
</span><span id="AgentMemoryManager-200"><a href="#AgentMemoryManager-200"><span class="linenos"> 200</span></a>
</span><span id="AgentMemoryManager-201"><a href="#AgentMemoryManager-201"><span class="linenos"> 201</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_memories_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-202"><a href="#AgentMemoryManager-202"><span class="linenos"> 202</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Clear all memories for the user using direct SemanticMemoryManager calls.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-203"><a href="#AgentMemoryManager-203"><span class="linenos"> 203</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-204"><a href="#AgentMemoryManager-204"><span class="linenos"> 204</span></a>                <span class="c1"># Direct call to SemanticMemoryManager.clear_memories()</span>
</span><span id="AgentMemoryManager-205"><a href="#AgentMemoryManager-205"><span class="linenos"> 205</span></a>                <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">clear_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager-206"><a href="#AgentMemoryManager-206"><span class="linenos"> 206</span></a>                    <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager-207"><a href="#AgentMemoryManager-207"><span class="linenos"> 207</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-208"><a href="#AgentMemoryManager-208"><span class="linenos"> 208</span></a>
</span><span id="AgentMemoryManager-209"><a href="#AgentMemoryManager-209"><span class="linenos"> 209</span></a>                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-210"><a href="#AgentMemoryManager-210"><span class="linenos"> 210</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-211"><a href="#AgentMemoryManager-211"><span class="linenos"> 211</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-212"><a href="#AgentMemoryManager-212"><span class="linenos"> 212</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-213"><a href="#AgentMemoryManager-213"><span class="linenos"> 213</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="AgentMemoryManager-214"><a href="#AgentMemoryManager-214"><span class="linenos"> 214</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error clearing memories: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-215"><a href="#AgentMemoryManager-215"><span class="linenos"> 215</span></a>
</span><span id="AgentMemoryManager-216"><a href="#AgentMemoryManager-216"><span class="linenos"> 216</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-217"><a href="#AgentMemoryManager-217"><span class="linenos"> 217</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error clearing memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-218"><a href="#AgentMemoryManager-218"><span class="linenos"> 218</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error clearing memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-219"><a href="#AgentMemoryManager-219"><span class="linenos"> 219</span></a>
</span><span id="AgentMemoryManager-220"><a href="#AgentMemoryManager-220"><span class="linenos"> 220</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_memories_by_topic_tool</span><span class="p">(</span><span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-221"><a href="#AgentMemoryManager-221"><span class="linenos"> 221</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Delete all memories associated with a specific topic or list of topics.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-222"><a href="#AgentMemoryManager-222"><span class="linenos"> 222</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-223"><a href="#AgentMemoryManager-223"><span class="linenos"> 223</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager-224"><a href="#AgentMemoryManager-224"><span class="linenos"> 224</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</span><span id="AgentMemoryManager-225"><a href="#AgentMemoryManager-225"><span class="linenos"> 225</span></a>
</span><span id="AgentMemoryManager-226"><a href="#AgentMemoryManager-226"><span class="linenos"> 226</span></a>                <span class="p">(</span>
</span><span id="AgentMemoryManager-227"><a href="#AgentMemoryManager-227"><span class="linenos"> 227</span></a>                    <span class="n">success</span><span class="p">,</span>
</span><span id="AgentMemoryManager-228"><a href="#AgentMemoryManager-228"><span class="linenos"> 228</span></a>                    <span class="n">message</span><span class="p">,</span>
</span><span id="AgentMemoryManager-229"><a href="#AgentMemoryManager-229"><span class="linenos"> 229</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">delete_memories_by_topic</span><span class="p">(</span>
</span><span id="AgentMemoryManager-230"><a href="#AgentMemoryManager-230"><span class="linenos"> 230</span></a>                    <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager-231"><a href="#AgentMemoryManager-231"><span class="linenos"> 231</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-232"><a href="#AgentMemoryManager-232"><span class="linenos"> 232</span></a>
</span><span id="AgentMemoryManager-233"><a href="#AgentMemoryManager-233"><span class="linenos"> 233</span></a>                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-234"><a href="#AgentMemoryManager-234"><span class="linenos"> 234</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-235"><a href="#AgentMemoryManager-235"><span class="linenos"> 235</span></a>                        <span class="s2">&quot;Deleted memories for topics &#39;</span><span class="si">%s</span><span class="s2">&#39; for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-236"><a href="#AgentMemoryManager-236"><span class="linenos"> 236</span></a>                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">),</span>
</span><span id="AgentMemoryManager-237"><a href="#AgentMemoryManager-237"><span class="linenos"> 237</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-238"><a href="#AgentMemoryManager-238"><span class="linenos"> 238</span></a>                    <span class="p">)</span>
</span><span id="AgentMemoryManager-239"><a href="#AgentMemoryManager-239"><span class="linenos"> 239</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-240"><a href="#AgentMemoryManager-240"><span class="linenos"> 240</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-241"><a href="#AgentMemoryManager-241"><span class="linenos"> 241</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgentMemoryManager-242"><a href="#AgentMemoryManager-242"><span class="linenos"> 242</span></a>                        <span class="s2">&quot;Failed to delete memories for topics </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-243"><a href="#AgentMemoryManager-243"><span class="linenos"> 243</span></a>                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">),</span>
</span><span id="AgentMemoryManager-244"><a href="#AgentMemoryManager-244"><span class="linenos"> 244</span></a>                        <span class="n">message</span><span class="p">,</span>
</span><span id="AgentMemoryManager-245"><a href="#AgentMemoryManager-245"><span class="linenos"> 245</span></a>                    <span class="p">)</span>
</span><span id="AgentMemoryManager-246"><a href="#AgentMemoryManager-246"><span class="linenos"> 246</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error deleting memories by topic: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-247"><a href="#AgentMemoryManager-247"><span class="linenos"> 247</span></a>
</span><span id="AgentMemoryManager-248"><a href="#AgentMemoryManager-248"><span class="linenos"> 248</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-249"><a href="#AgentMemoryManager-249"><span class="linenos"> 249</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error deleting memories by topic: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-250"><a href="#AgentMemoryManager-250"><span class="linenos"> 250</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error deleting memories by topic: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-251"><a href="#AgentMemoryManager-251"><span class="linenos"> 251</span></a>
</span><span id="AgentMemoryManager-252"><a href="#AgentMemoryManager-252"><span class="linenos"> 252</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_all_memories_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-253"><a href="#AgentMemoryManager-253"><span class="linenos"> 253</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Clear all memories from both SQLite and LightRAG systems.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-254"><a href="#AgentMemoryManager-254"><span class="linenos"> 254</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_all_memories</span><span class="p">()</span>
</span><span id="AgentMemoryManager-255"><a href="#AgentMemoryManager-255"><span class="linenos"> 255</span></a>
</span><span id="AgentMemoryManager-256"><a href="#AgentMemoryManager-256"><span class="linenos"> 256</span></a>        <span class="c1"># Set proper function names for tool identification</span>
</span><span id="AgentMemoryManager-257"><a href="#AgentMemoryManager-257"><span class="linenos"> 257</span></a>        <span class="n">store_user_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;store_user_memory&quot;</span>
</span><span id="AgentMemoryManager-258"><a href="#AgentMemoryManager-258"><span class="linenos"> 258</span></a>        <span class="n">query_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;query_memory&quot;</span>
</span><span id="AgentMemoryManager-259"><a href="#AgentMemoryManager-259"><span class="linenos"> 259</span></a>        <span class="n">update_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;update_memory&quot;</span>
</span><span id="AgentMemoryManager-260"><a href="#AgentMemoryManager-260"><span class="linenos"> 260</span></a>        <span class="n">delete_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;delete_memory&quot;</span>
</span><span id="AgentMemoryManager-261"><a href="#AgentMemoryManager-261"><span class="linenos"> 261</span></a>        <span class="n">delete_memories_by_topic_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;delete_memories_by_topic&quot;</span>
</span><span id="AgentMemoryManager-262"><a href="#AgentMemoryManager-262"><span class="linenos"> 262</span></a>        <span class="n">clear_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;clear_memories&quot;</span>
</span><span id="AgentMemoryManager-263"><a href="#AgentMemoryManager-263"><span class="linenos"> 263</span></a>        <span class="n">clear_all_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;clear_all_memories&quot;</span>
</span><span id="AgentMemoryManager-264"><a href="#AgentMemoryManager-264"><span class="linenos"> 264</span></a>        <span class="n">get_recent_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_recent_memories&quot;</span>
</span><span id="AgentMemoryManager-265"><a href="#AgentMemoryManager-265"><span class="linenos"> 265</span></a>        <span class="n">get_all_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_all_memories&quot;</span>
</span><span id="AgentMemoryManager-266"><a href="#AgentMemoryManager-266"><span class="linenos"> 266</span></a>        <span class="n">get_memory_stats_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_memory_stats&quot;</span>
</span><span id="AgentMemoryManager-267"><a href="#AgentMemoryManager-267"><span class="linenos"> 267</span></a>        <span class="n">get_memories_by_topic_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_memories_by_topic&quot;</span>
</span><span id="AgentMemoryManager-268"><a href="#AgentMemoryManager-268"><span class="linenos"> 268</span></a>        <span class="n">list_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;list_memories&quot;</span>
</span><span id="AgentMemoryManager-269"><a href="#AgentMemoryManager-269"><span class="linenos"> 269</span></a>        <span class="n">store_graph_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;store_graph_memory&quot;</span>
</span><span id="AgentMemoryManager-270"><a href="#AgentMemoryManager-270"><span class="linenos"> 270</span></a>        <span class="n">query_graph_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;query_graph_memory&quot;</span>
</span><span id="AgentMemoryManager-271"><a href="#AgentMemoryManager-271"><span class="linenos"> 271</span></a>        <span class="n">get_memory_graph_labels_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_memory_graph_labels&quot;</span>
</span><span id="AgentMemoryManager-272"><a href="#AgentMemoryManager-272"><span class="linenos"> 272</span></a>
</span><span id="AgentMemoryManager-273"><a href="#AgentMemoryManager-273"><span class="linenos"> 273</span></a>        <span class="c1"># Add tools to the list</span>
</span><span id="AgentMemoryManager-274"><a href="#AgentMemoryManager-274"><span class="linenos"> 274</span></a>        <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="AgentMemoryManager-275"><a href="#AgentMemoryManager-275"><span class="linenos"> 275</span></a>            <span class="p">[</span>
</span><span id="AgentMemoryManager-276"><a href="#AgentMemoryManager-276"><span class="linenos"> 276</span></a>                <span class="n">store_user_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-277"><a href="#AgentMemoryManager-277"><span class="linenos"> 277</span></a>                <span class="n">query_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-278"><a href="#AgentMemoryManager-278"><span class="linenos"> 278</span></a>                <span class="n">update_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-279"><a href="#AgentMemoryManager-279"><span class="linenos"> 279</span></a>                <span class="n">delete_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-280"><a href="#AgentMemoryManager-280"><span class="linenos"> 280</span></a>                <span class="n">delete_memories_by_topic_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-281"><a href="#AgentMemoryManager-281"><span class="linenos"> 281</span></a>                <span class="n">clear_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-282"><a href="#AgentMemoryManager-282"><span class="linenos"> 282</span></a>                <span class="n">clear_all_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-283"><a href="#AgentMemoryManager-283"><span class="linenos"> 283</span></a>                <span class="n">get_recent_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-284"><a href="#AgentMemoryManager-284"><span class="linenos"> 284</span></a>                <span class="n">get_all_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-285"><a href="#AgentMemoryManager-285"><span class="linenos"> 285</span></a>                <span class="n">get_memory_stats_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-286"><a href="#AgentMemoryManager-286"><span class="linenos"> 286</span></a>                <span class="n">get_memories_by_topic_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-287"><a href="#AgentMemoryManager-287"><span class="linenos"> 287</span></a>                <span class="n">list_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-288"><a href="#AgentMemoryManager-288"><span class="linenos"> 288</span></a>                <span class="n">store_graph_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-289"><a href="#AgentMemoryManager-289"><span class="linenos"> 289</span></a>                <span class="n">query_graph_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-290"><a href="#AgentMemoryManager-290"><span class="linenos"> 290</span></a>                <span class="n">get_memory_graph_labels_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager-291"><a href="#AgentMemoryManager-291"><span class="linenos"> 291</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager-292"><a href="#AgentMemoryManager-292"><span class="linenos"> 292</span></a>        <span class="p">)</span>
</span><span id="AgentMemoryManager-293"><a href="#AgentMemoryManager-293"><span class="linenos"> 293</span></a>
</span><span id="AgentMemoryManager-294"><a href="#AgentMemoryManager-294"><span class="linenos"> 294</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-295"><a href="#AgentMemoryManager-295"><span class="linenos"> 295</span></a>            <span class="s2">&quot;Created </span><span class="si">%d</span><span class="s2"> memory tools using direct SemanticMemoryManager calls&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-296"><a href="#AgentMemoryManager-296"><span class="linenos"> 296</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">tools</span><span class="p">),</span>
</span><span id="AgentMemoryManager-297"><a href="#AgentMemoryManager-297"><span class="linenos"> 297</span></a>        <span class="p">)</span>
</span><span id="AgentMemoryManager-298"><a href="#AgentMemoryManager-298"><span class="linenos"> 298</span></a>        <span class="k">return</span> <span class="n">tools</span>
</span><span id="AgentMemoryManager-299"><a href="#AgentMemoryManager-299"><span class="linenos"> 299</span></a>
</span><span id="AgentMemoryManager-300"><a href="#AgentMemoryManager-300"><span class="linenos"> 300</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_user_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager-301"><a href="#AgentMemoryManager-301"><span class="linenos"> 301</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-302"><a href="#AgentMemoryManager-302"><span class="linenos"> 302</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryStorageResult</span><span class="p">:</span>
</span><span id="AgentMemoryManager-303"><a href="#AgentMemoryManager-303"><span class="linenos"> 303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store information as a user memory in BOTH local SQLite and LightRAG graph systems.</span>
</span><span id="AgentMemoryManager-304"><a href="#AgentMemoryManager-304"><span class="linenos"> 304</span></a>
</span><span id="AgentMemoryManager-305"><a href="#AgentMemoryManager-305"><span class="linenos"> 305</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-306"><a href="#AgentMemoryManager-306"><span class="linenos"> 306</span></a><span class="sd">            content: The information to store as a memory</span>
</span><span id="AgentMemoryManager-307"><a href="#AgentMemoryManager-307"><span class="linenos"> 307</span></a><span class="sd">            topics: Optional list of topics/categories for the memory (None = auto-classify)</span>
</span><span id="AgentMemoryManager-308"><a href="#AgentMemoryManager-308"><span class="linenos"> 308</span></a>
</span><span id="AgentMemoryManager-309"><a href="#AgentMemoryManager-309"><span class="linenos"> 309</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-310"><a href="#AgentMemoryManager-310"><span class="linenos"> 310</span></a><span class="sd">            MemoryStorageResult: Structured result with detailed status information</span>
</span><span id="AgentMemoryManager-311"><a href="#AgentMemoryManager-311"><span class="linenos"> 311</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-312"><a href="#AgentMemoryManager-312"><span class="linenos"> 312</span></a>        <span class="c1"># Validate that content is provided</span>
</span><span id="AgentMemoryManager-313"><a href="#AgentMemoryManager-313"><span class="linenos"> 313</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="AgentMemoryManager-314"><a href="#AgentMemoryManager-314"><span class="linenos"> 314</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="AgentMemoryManager-315"><a href="#AgentMemoryManager-315"><span class="linenos"> 315</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_EMPTY</span><span class="p">,</span>
</span><span id="AgentMemoryManager-316"><a href="#AgentMemoryManager-316"><span class="linenos"> 316</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Content is required to store a memory. Please provide the information you want me to remember.&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-317"><a href="#AgentMemoryManager-317"><span class="linenos"> 317</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager-318"><a href="#AgentMemoryManager-318"><span class="linenos"> 318</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager-319"><a href="#AgentMemoryManager-319"><span class="linenos"> 319</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-320"><a href="#AgentMemoryManager-320"><span class="linenos"> 320</span></a>
</span><span id="AgentMemoryManager-321"><a href="#AgentMemoryManager-321"><span class="linenos"> 321</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-322"><a href="#AgentMemoryManager-322"><span class="linenos"> 322</span></a>            <span class="c1"># Restate the user fact from first-person to third-person</span>
</span><span id="AgentMemoryManager-323"><a href="#AgentMemoryManager-323"><span class="linenos"> 323</span></a>            <span class="n">restated_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restate_user_fact</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="AgentMemoryManager-324"><a href="#AgentMemoryManager-324"><span class="linenos"> 324</span></a>            
</span><span id="AgentMemoryManager-325"><a href="#AgentMemoryManager-325"><span class="linenos"> 325</span></a>            <span class="c1"># SIMPLIFIED TOPIC HANDLING: Handle the common cases simply</span>
</span><span id="AgentMemoryManager-326"><a href="#AgentMemoryManager-326"><span class="linenos"> 326</span></a>            <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgentMemoryManager-327"><a href="#AgentMemoryManager-327"><span class="linenos"> 327</span></a>                <span class="c1"># Leave as None - let memory manager auto-classify</span>
</span><span id="AgentMemoryManager-328"><a href="#AgentMemoryManager-328"><span class="linenos"> 328</span></a>                <span class="k">pass</span>
</span><span id="AgentMemoryManager-329"><a href="#AgentMemoryManager-329"><span class="linenos"> 329</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager-330"><a href="#AgentMemoryManager-330"><span class="linenos"> 330</span></a>                <span class="c1"># Convert string to list, handle comma-separated values</span>
</span><span id="AgentMemoryManager-331"><a href="#AgentMemoryManager-331"><span class="linenos"> 331</span></a>                <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-332"><a href="#AgentMemoryManager-332"><span class="linenos"> 332</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager-333"><a href="#AgentMemoryManager-333"><span class="linenos"> 333</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-334"><a href="#AgentMemoryManager-334"><span class="linenos"> 334</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-335"><a href="#AgentMemoryManager-335"><span class="linenos"> 335</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager-336"><a href="#AgentMemoryManager-336"><span class="linenos"> 336</span></a>                <span class="c1"># Clean up list - remove empty entries</span>
</span><span id="AgentMemoryManager-337"><a href="#AgentMemoryManager-337"><span class="linenos"> 337</span></a>                <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager-338"><a href="#AgentMemoryManager-338"><span class="linenos"> 338</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-339"><a href="#AgentMemoryManager-339"><span class="linenos"> 339</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-340"><a href="#AgentMemoryManager-340"><span class="linenos"> 340</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-341"><a href="#AgentMemoryManager-341"><span class="linenos"> 341</span></a>                <span class="c1"># Convert anything else to string and put in list</span>
</span><span id="AgentMemoryManager-342"><a href="#AgentMemoryManager-342"><span class="linenos"> 342</span></a>                <span class="n">topic_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="AgentMemoryManager-343"><a href="#AgentMemoryManager-343"><span class="linenos"> 343</span></a>                <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_str</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic_str</span> <span class="ow">and</span> <span class="n">topic_str</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-344"><a href="#AgentMemoryManager-344"><span class="linenos"> 344</span></a>
</span><span id="AgentMemoryManager-345"><a href="#AgentMemoryManager-345"><span class="linenos"> 345</span></a>            <span class="c1"># 1. Store in local SQLite memory system</span>
</span><span id="AgentMemoryManager-346"><a href="#AgentMemoryManager-346"><span class="linenos"> 346</span></a>            <span class="n">local_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager-347"><a href="#AgentMemoryManager-347"><span class="linenos"> 347</span></a>                <span class="n">memory_text</span><span class="o">=</span><span class="n">restated_content</span><span class="p">,</span>
</span><span id="AgentMemoryManager-348"><a href="#AgentMemoryManager-348"><span class="linenos"> 348</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager-349"><a href="#AgentMemoryManager-349"><span class="linenos"> 349</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-350"><a href="#AgentMemoryManager-350"><span class="linenos"> 350</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="AgentMemoryManager-351"><a href="#AgentMemoryManager-351"><span class="linenos"> 351</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-352"><a href="#AgentMemoryManager-352"><span class="linenos"> 352</span></a>
</span><span id="AgentMemoryManager-353"><a href="#AgentMemoryManager-353"><span class="linenos"> 353</span></a>            <span class="c1"># Handle different rejection cases</span>
</span><span id="AgentMemoryManager-354"><a href="#AgentMemoryManager-354"><span class="linenos"> 354</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">local_result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-355"><a href="#AgentMemoryManager-355"><span class="linenos"> 355</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Local memory rejected: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">local_result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</span><span id="AgentMemoryManager-356"><a href="#AgentMemoryManager-356"><span class="linenos"> 356</span></a>                <span class="c1"># Return the rejection status directly from the memory manager</span>
</span><span id="AgentMemoryManager-357"><a href="#AgentMemoryManager-357"><span class="linenos"> 357</span></a>                <span class="k">return</span> <span class="n">local_result</span>
</span><span id="AgentMemoryManager-358"><a href="#AgentMemoryManager-358"><span class="linenos"> 358</span></a>
</span><span id="AgentMemoryManager-359"><a href="#AgentMemoryManager-359"><span class="linenos"> 359</span></a>            <span class="c1"># Local storage succeeded</span>
</span><span id="AgentMemoryManager-360"><a href="#AgentMemoryManager-360"><span class="linenos"> 360</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-361"><a href="#AgentMemoryManager-361"><span class="linenos"> 361</span></a>                <span class="s2">&quot;Stored in local memory: </span><span class="si">%s</span><span class="s2">... (ID: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-362"><a href="#AgentMemoryManager-362"><span class="linenos"> 362</span></a>                <span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span>
</span><span id="AgentMemoryManager-363"><a href="#AgentMemoryManager-363"><span class="linenos"> 363</span></a>                <span class="n">local_result</span><span class="o">.</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-364"><a href="#AgentMemoryManager-364"><span class="linenos"> 364</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-365"><a href="#AgentMemoryManager-365"><span class="linenos"> 365</span></a>
</span><span id="AgentMemoryManager-366"><a href="#AgentMemoryManager-366"><span class="linenos"> 366</span></a>            <span class="c1"># 2. Store in LightRAG graph memory system</span>
</span><span id="AgentMemoryManager-367"><a href="#AgentMemoryManager-367"><span class="linenos"> 367</span></a>            <span class="n">graph_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager-368"><a href="#AgentMemoryManager-368"><span class="linenos"> 368</span></a>            <span class="n">graph_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="AgentMemoryManager-369"><a href="#AgentMemoryManager-369"><span class="linenos"> 369</span></a>
</span><span id="AgentMemoryManager-370"><a href="#AgentMemoryManager-370"><span class="linenos"> 370</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-371"><a href="#AgentMemoryManager-371"><span class="linenos"> 371</span></a>                <span class="c1"># Store in graph memory</span>
</span><span id="AgentMemoryManager-372"><a href="#AgentMemoryManager-372"><span class="linenos"> 372</span></a>                <span class="n">graph_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_graph_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager-373"><a href="#AgentMemoryManager-373"><span class="linenos"> 373</span></a>                    <span class="n">restated_content</span><span class="p">,</span> <span class="n">local_result</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="n">local_result</span><span class="o">.</span><span class="n">memory_id</span>
</span><span id="AgentMemoryManager-374"><a href="#AgentMemoryManager-374"><span class="linenos"> 374</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-375"><a href="#AgentMemoryManager-375"><span class="linenos"> 375</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Graph memory result: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">graph_result</span><span class="p">)</span>
</span><span id="AgentMemoryManager-376"><a href="#AgentMemoryManager-376"><span class="linenos"> 376</span></a>                <span class="k">if</span> <span class="s2">&quot;✅&quot;</span> <span class="ow">in</span> <span class="n">graph_result</span><span class="p">:</span>
</span><span id="AgentMemoryManager-377"><a href="#AgentMemoryManager-377"><span class="linenos"> 377</span></a>                    <span class="n">graph_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AgentMemoryManager-378"><a href="#AgentMemoryManager-378"><span class="linenos"> 378</span></a>                    <span class="n">graph_message</span> <span class="o">=</span> <span class="s2">&quot;Graph memory synced successfully&quot;</span>
</span><span id="AgentMemoryManager-379"><a href="#AgentMemoryManager-379"><span class="linenos"> 379</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-380"><a href="#AgentMemoryManager-380"><span class="linenos"> 380</span></a>                    <span class="n">graph_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Graph memory sync failed: </span><span class="si">{</span><span class="n">graph_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-381"><a href="#AgentMemoryManager-381"><span class="linenos"> 381</span></a>
</span><span id="AgentMemoryManager-382"><a href="#AgentMemoryManager-382"><span class="linenos"> 382</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-383"><a href="#AgentMemoryManager-383"><span class="linenos"> 383</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error storing in graph memory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-384"><a href="#AgentMemoryManager-384"><span class="linenos"> 384</span></a>                <span class="n">graph_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Graph memory error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-385"><a href="#AgentMemoryManager-385"><span class="linenos"> 385</span></a>
</span><span id="AgentMemoryManager-386"><a href="#AgentMemoryManager-386"><span class="linenos"> 386</span></a>            <span class="c1"># Determine final status based on local and graph results</span>
</span><span id="AgentMemoryManager-387"><a href="#AgentMemoryManager-387"><span class="linenos"> 387</span></a>            <span class="k">if</span> <span class="n">graph_success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-388"><a href="#AgentMemoryManager-388"><span class="linenos"> 388</span></a>                <span class="n">final_status</span> <span class="o">=</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS</span>
</span><span id="AgentMemoryManager-389"><a href="#AgentMemoryManager-389"><span class="linenos"> 389</span></a>                <span class="n">final_message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgentMemoryManager-390"><a href="#AgentMemoryManager-390"><span class="linenos"> 390</span></a>                    <span class="sa">f</span><span class="s2">&quot;Memory stored successfully in both systems: </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="AgentMemoryManager-391"><a href="#AgentMemoryManager-391"><span class="linenos"> 391</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-392"><a href="#AgentMemoryManager-392"><span class="linenos"> 392</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-393"><a href="#AgentMemoryManager-393"><span class="linenos"> 393</span></a>                    <span class="s2">&quot;✅ DUAL STORAGE SUCCESS: Memory stored in both local SQLite and LightRAG graph&quot;</span>
</span><span id="AgentMemoryManager-394"><a href="#AgentMemoryManager-394"><span class="linenos"> 394</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-395"><a href="#AgentMemoryManager-395"><span class="linenos"> 395</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-396"><a href="#AgentMemoryManager-396"><span class="linenos"> 396</span></a>                <span class="n">final_status</span> <span class="o">=</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS_LOCAL_ONLY</span>
</span><span id="AgentMemoryManager-397"><a href="#AgentMemoryManager-397"><span class="linenos"> 397</span></a>                <span class="n">final_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Memory stored in local system only: </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">... | </span><span class="si">{</span><span class="n">graph_message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-398"><a href="#AgentMemoryManager-398"><span class="linenos"> 398</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager-399"><a href="#AgentMemoryManager-399"><span class="linenos"> 399</span></a>                    <span class="s2">&quot;⚠️ PARTIAL STORAGE: Memory stored in local SQLite only (graph sync failed)&quot;</span>
</span><span id="AgentMemoryManager-400"><a href="#AgentMemoryManager-400"><span class="linenos"> 400</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-401"><a href="#AgentMemoryManager-401"><span class="linenos"> 401</span></a>
</span><span id="AgentMemoryManager-402"><a href="#AgentMemoryManager-402"><span class="linenos"> 402</span></a>            <span class="c1"># Return the enhanced result with dual storage information</span>
</span><span id="AgentMemoryManager-403"><a href="#AgentMemoryManager-403"><span class="linenos"> 403</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="AgentMemoryManager-404"><a href="#AgentMemoryManager-404"><span class="linenos"> 404</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">final_status</span><span class="p">,</span>
</span><span id="AgentMemoryManager-405"><a href="#AgentMemoryManager-405"><span class="linenos"> 405</span></a>                <span class="n">message</span><span class="o">=</span><span class="n">final_message</span><span class="p">,</span>
</span><span id="AgentMemoryManager-406"><a href="#AgentMemoryManager-406"><span class="linenos"> 406</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">local_result</span><span class="o">.</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-407"><a href="#AgentMemoryManager-407"><span class="linenos"> 407</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">local_result</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span>
</span><span id="AgentMemoryManager-408"><a href="#AgentMemoryManager-408"><span class="linenos"> 408</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-409"><a href="#AgentMemoryManager-409"><span class="linenos"> 409</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="n">graph_success</span><span class="p">,</span>
</span><span id="AgentMemoryManager-410"><a href="#AgentMemoryManager-410"><span class="linenos"> 410</span></a>                <span class="n">similarity_score</span><span class="o">=</span><span class="n">local_result</span><span class="o">.</span><span class="n">similarity_score</span><span class="p">,</span>
</span><span id="AgentMemoryManager-411"><a href="#AgentMemoryManager-411"><span class="linenos"> 411</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-412"><a href="#AgentMemoryManager-412"><span class="linenos"> 412</span></a>
</span><span id="AgentMemoryManager-413"><a href="#AgentMemoryManager-413"><span class="linenos"> 413</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-414"><a href="#AgentMemoryManager-414"><span class="linenos"> 414</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error storing user memory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-415"><a href="#AgentMemoryManager-415"><span class="linenos"> 415</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="AgentMemoryManager-416"><a href="#AgentMemoryManager-416"><span class="linenos"> 416</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">STORAGE_ERROR</span><span class="p">,</span>
</span><span id="AgentMemoryManager-417"><a href="#AgentMemoryManager-417"><span class="linenos"> 417</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error storing memory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-418"><a href="#AgentMemoryManager-418"><span class="linenos"> 418</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager-419"><a href="#AgentMemoryManager-419"><span class="linenos"> 419</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager-420"><a href="#AgentMemoryManager-420"><span class="linenos"> 420</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-421"><a href="#AgentMemoryManager-421"><span class="linenos"> 421</span></a>
</span><span id="AgentMemoryManager-422"><a href="#AgentMemoryManager-422"><span class="linenos"> 422</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">restate_user_fact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-423"><a href="#AgentMemoryManager-423"><span class="linenos"> 423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Restate a user fact from first-person to third-person.</span>
</span><span id="AgentMemoryManager-424"><a href="#AgentMemoryManager-424"><span class="linenos"> 424</span></a>
</span><span id="AgentMemoryManager-425"><a href="#AgentMemoryManager-425"><span class="linenos"> 425</span></a><span class="sd">        This method converts statements like &quot;I have a PhD&quot; to &quot;{user_id} has a PhD&quot;</span>
</span><span id="AgentMemoryManager-426"><a href="#AgentMemoryManager-426"><span class="linenos"> 426</span></a><span class="sd">        to ensure correct entity mapping in the knowledge graph.</span>
</span><span id="AgentMemoryManager-427"><a href="#AgentMemoryManager-427"><span class="linenos"> 427</span></a>
</span><span id="AgentMemoryManager-428"><a href="#AgentMemoryManager-428"><span class="linenos"> 428</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-429"><a href="#AgentMemoryManager-429"><span class="linenos"> 429</span></a><span class="sd">            content: The original fact from the user</span>
</span><span id="AgentMemoryManager-430"><a href="#AgentMemoryManager-430"><span class="linenos"> 430</span></a>
</span><span id="AgentMemoryManager-431"><a href="#AgentMemoryManager-431"><span class="linenos"> 431</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-432"><a href="#AgentMemoryManager-432"><span class="linenos"> 432</span></a><span class="sd">            The restated fact</span>
</span><span id="AgentMemoryManager-433"><a href="#AgentMemoryManager-433"><span class="linenos"> 433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-434"><a href="#AgentMemoryManager-434"><span class="linenos"> 434</span></a>        <span class="c1"># Ensure user_id is a safe string for replacement</span>
</span><span id="AgentMemoryManager-435"><a href="#AgentMemoryManager-435"><span class="linenos"> 435</span></a>        <span class="n">user_id_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-436"><a href="#AgentMemoryManager-436"><span class="linenos"> 436</span></a>
</span><span id="AgentMemoryManager-437"><a href="#AgentMemoryManager-437"><span class="linenos"> 437</span></a>        <span class="c1"># Define regex patterns for pronoun and verb replacement</span>
</span><span id="AgentMemoryManager-438"><a href="#AgentMemoryManager-438"><span class="linenos"> 438</span></a>        <span class="c1"># Using word boundaries (\b) to avoid replacing parts of words like &quot;mine&quot; in &quot;mining&quot;</span>
</span><span id="AgentMemoryManager-439"><a href="#AgentMemoryManager-439"><span class="linenos"> 439</span></a>        <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager-440"><a href="#AgentMemoryManager-440"><span class="linenos"> 440</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI am\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> is&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager-441"><a href="#AgentMemoryManager-441"><span class="linenos"> 441</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI was\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> was&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager-442"><a href="#AgentMemoryManager-442"><span class="linenos"> 442</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI have\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> has&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager-443"><a href="#AgentMemoryManager-443"><span class="linenos"> 443</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI&#39;m\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> is&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager-444"><a href="#AgentMemoryManager-444"><span class="linenos"> 444</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI&#39;ve\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> has&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager-445"><a href="#AgentMemoryManager-445"><span class="linenos"> 445</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI\b&quot;</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">),</span>
</span><span id="AgentMemoryManager-446"><a href="#AgentMemoryManager-446"><span class="linenos"> 446</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bmy\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2">&#39;s&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager-447"><a href="#AgentMemoryManager-447"><span class="linenos"> 447</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bmine\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2">&#39;s&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager-448"><a href="#AgentMemoryManager-448"><span class="linenos"> 448</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bmyself\b&quot;</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">),</span>
</span><span id="AgentMemoryManager-449"><a href="#AgentMemoryManager-449"><span class="linenos"> 449</span></a>        <span class="p">]</span>
</span><span id="AgentMemoryManager-450"><a href="#AgentMemoryManager-450"><span class="linenos"> 450</span></a>
</span><span id="AgentMemoryManager-451"><a href="#AgentMemoryManager-451"><span class="linenos"> 451</span></a>        <span class="n">restated_content</span> <span class="o">=</span> <span class="n">content</span>
</span><span id="AgentMemoryManager-452"><a href="#AgentMemoryManager-452"><span class="linenos"> 452</span></a>        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
</span><span id="AgentMemoryManager-453"><a href="#AgentMemoryManager-453"><span class="linenos"> 453</span></a>            <span class="c1"># Use re.IGNORECASE to handle variations like &quot;i&quot; vs &quot;I&quot;</span>
</span><span id="AgentMemoryManager-454"><a href="#AgentMemoryManager-454"><span class="linenos"> 454</span></a>            <span class="n">restated_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
</span><span id="AgentMemoryManager-455"><a href="#AgentMemoryManager-455"><span class="linenos"> 455</span></a>                <span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">restated_content</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span>
</span><span id="AgentMemoryManager-456"><a href="#AgentMemoryManager-456"><span class="linenos"> 456</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-457"><a href="#AgentMemoryManager-457"><span class="linenos"> 457</span></a>
</span><span id="AgentMemoryManager-458"><a href="#AgentMemoryManager-458"><span class="linenos"> 458</span></a>        <span class="k">return</span> <span class="n">restated_content</span>
</span><span id="AgentMemoryManager-459"><a href="#AgentMemoryManager-459"><span class="linenos"> 459</span></a>
</span><span id="AgentMemoryManager-460"><a href="#AgentMemoryManager-460"><span class="linenos"> 460</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">seed_entity_in_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentMemoryManager-461"><a href="#AgentMemoryManager-461"><span class="linenos"> 461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Seed an entity into the graph by creating and uploading a physical file.</span>
</span><span id="AgentMemoryManager-462"><a href="#AgentMemoryManager-462"><span class="linenos"> 462</span></a>
</span><span id="AgentMemoryManager-463"><a href="#AgentMemoryManager-463"><span class="linenos"> 463</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-464"><a href="#AgentMemoryManager-464"><span class="linenos"> 464</span></a><span class="sd">            entity_name: Name of the entity to create</span>
</span><span id="AgentMemoryManager-465"><a href="#AgentMemoryManager-465"><span class="linenos"> 465</span></a><span class="sd">            entity_type: Type of the entity</span>
</span><span id="AgentMemoryManager-466"><a href="#AgentMemoryManager-466"><span class="linenos"> 466</span></a>
</span><span id="AgentMemoryManager-467"><a href="#AgentMemoryManager-467"><span class="linenos"> 467</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-468"><a href="#AgentMemoryManager-468"><span class="linenos"> 468</span></a><span class="sd">            True if entity was successfully seeded</span>
</span><span id="AgentMemoryManager-469"><a href="#AgentMemoryManager-469"><span class="linenos"> 469</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-470"><a href="#AgentMemoryManager-470"><span class="linenos"> 470</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-471"><a href="#AgentMemoryManager-471"><span class="linenos"> 471</span></a>            <span class="c1"># Create a minimal document to seed the entity</span>
</span><span id="AgentMemoryManager-472"><a href="#AgentMemoryManager-472"><span class="linenos"> 472</span></a>            <span class="n">seed_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2"> is a </span><span class="si">{</span><span class="n">entity_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="AgentMemoryManager-473"><a href="#AgentMemoryManager-473"><span class="linenos"> 473</span></a>
</span><span id="AgentMemoryManager-474"><a href="#AgentMemoryManager-474"><span class="linenos"> 474</span></a>            <span class="c1"># Create a unique filename for this entity seed</span>
</span><span id="AgentMemoryManager-475"><a href="#AgentMemoryManager-475"><span class="linenos"> 475</span></a>            <span class="n">entity_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
</span><span id="AgentMemoryManager-476"><a href="#AgentMemoryManager-476"><span class="linenos"> 476</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">entity_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="AgentMemoryManager-477"><a href="#AgentMemoryManager-477"><span class="linenos"> 477</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="AgentMemoryManager-478"><a href="#AgentMemoryManager-478"><span class="linenos"> 478</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;entity_seed_</span><span class="si">{</span><span class="n">entity_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">entity_hash</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="AgentMemoryManager-479"><a href="#AgentMemoryManager-479"><span class="linenos"> 479</span></a>
</span><span id="AgentMemoryManager-480"><a href="#AgentMemoryManager-480"><span class="linenos"> 480</span></a>            <span class="c1"># Create a temporary file</span>
</span><span id="AgentMemoryManager-481"><a href="#AgentMemoryManager-481"><span class="linenos"> 481</span></a>            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
</span><span id="AgentMemoryManager-482"><a href="#AgentMemoryManager-482"><span class="linenos"> 482</span></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span>
</span><span id="AgentMemoryManager-483"><a href="#AgentMemoryManager-483"><span class="linenos"> 483</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">temp_file</span><span class="p">:</span>
</span><span id="AgentMemoryManager-484"><a href="#AgentMemoryManager-484"><span class="linenos"> 484</span></a>                <span class="n">temp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">seed_text</span><span class="p">)</span>
</span><span id="AgentMemoryManager-485"><a href="#AgentMemoryManager-485"><span class="linenos"> 485</span></a>                <span class="n">temp_file_path</span> <span class="o">=</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="AgentMemoryManager-486"><a href="#AgentMemoryManager-486"><span class="linenos"> 486</span></a>
</span><span id="AgentMemoryManager-487"><a href="#AgentMemoryManager-487"><span class="linenos"> 487</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-488"><a href="#AgentMemoryManager-488"><span class="linenos"> 488</span></a>                <span class="c1"># Upload the file using the /documents/upload endpoint</span>
</span><span id="AgentMemoryManager-489"><a href="#AgentMemoryManager-489"><span class="linenos"> 489</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents/upload&quot;</span>
</span><span id="AgentMemoryManager-490"><a href="#AgentMemoryManager-490"><span class="linenos"> 490</span></a>
</span><span id="AgentMemoryManager-491"><a href="#AgentMemoryManager-491"><span class="linenos"> 491</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager-492"><a href="#AgentMemoryManager-492"><span class="linenos"> 492</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="AgentMemoryManager-493"><a href="#AgentMemoryManager-493"><span class="linenos"> 493</span></a>                        <span class="c1"># Create form data for file upload</span>
</span><span id="AgentMemoryManager-494"><a href="#AgentMemoryManager-494"><span class="linenos"> 494</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">FormData</span><span class="p">()</span>
</span><span id="AgentMemoryManager-495"><a href="#AgentMemoryManager-495"><span class="linenos"> 495</span></a>                        <span class="n">data</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
</span><span id="AgentMemoryManager-496"><a href="#AgentMemoryManager-496"><span class="linenos"> 496</span></a>                            <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span>
</span><span id="AgentMemoryManager-497"><a href="#AgentMemoryManager-497"><span class="linenos"> 497</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager-498"><a href="#AgentMemoryManager-498"><span class="linenos"> 498</span></a>
</span><span id="AgentMemoryManager-499"><a href="#AgentMemoryManager-499"><span class="linenos"> 499</span></a>                        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-500"><a href="#AgentMemoryManager-500"><span class="linenos"> 500</span></a>                            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
</span><span id="AgentMemoryManager-501"><a href="#AgentMemoryManager-501"><span class="linenos"> 501</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-502"><a href="#AgentMemoryManager-502"><span class="linenos"> 502</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Successfully seeded entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-503"><a href="#AgentMemoryManager-503"><span class="linenos"> 503</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-504"><a href="#AgentMemoryManager-504"><span class="linenos"> 504</span></a>                                <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentMemoryManager-505"><a href="#AgentMemoryManager-505"><span class="linenos"> 505</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-506"><a href="#AgentMemoryManager-506"><span class="linenos"> 506</span></a>                                <span class="n">error_detail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager-507"><a href="#AgentMemoryManager-507"><span class="linenos"> 507</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager-508"><a href="#AgentMemoryManager-508"><span class="linenos"> 508</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Failed to seed entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-509"><a href="#AgentMemoryManager-509"><span class="linenos"> 509</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-510"><a href="#AgentMemoryManager-510"><span class="linenos"> 510</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager-511"><a href="#AgentMemoryManager-511"><span class="linenos"> 511</span></a>
</span><span id="AgentMemoryManager-512"><a href="#AgentMemoryManager-512"><span class="linenos"> 512</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="AgentMemoryManager-513"><a href="#AgentMemoryManager-513"><span class="linenos"> 513</span></a>                <span class="c1"># Clean up the temporary file</span>
</span><span id="AgentMemoryManager-514"><a href="#AgentMemoryManager-514"><span class="linenos"> 514</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-515"><a href="#AgentMemoryManager-515"><span class="linenos"> 515</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">)</span>
</span><span id="AgentMemoryManager-516"><a href="#AgentMemoryManager-516"><span class="linenos"> 516</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="AgentMemoryManager-517"><a href="#AgentMemoryManager-517"><span class="linenos"> 517</span></a>                    <span class="k">pass</span>  <span class="c1"># Ignore cleanup errors</span>
</span><span id="AgentMemoryManager-518"><a href="#AgentMemoryManager-518"><span class="linenos"> 518</span></a>
</span><span id="AgentMemoryManager-519"><a href="#AgentMemoryManager-519"><span class="linenos"> 519</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-520"><a href="#AgentMemoryManager-520"><span class="linenos"> 520</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error seeding entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-521"><a href="#AgentMemoryManager-521"><span class="linenos"> 521</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager-522"><a href="#AgentMemoryManager-522"><span class="linenos"> 522</span></a>
</span><span id="AgentMemoryManager-523"><a href="#AgentMemoryManager-523"><span class="linenos"> 523</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_entity_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentMemoryManager-524"><a href="#AgentMemoryManager-524"><span class="linenos"> 524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if entity exists in the graph using the correct /graph/entity/exists endpoint.</span>
</span><span id="AgentMemoryManager-525"><a href="#AgentMemoryManager-525"><span class="linenos"> 525</span></a>
</span><span id="AgentMemoryManager-526"><a href="#AgentMemoryManager-526"><span class="linenos"> 526</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-527"><a href="#AgentMemoryManager-527"><span class="linenos"> 527</span></a><span class="sd">            entity_name: Name of the entity to check</span>
</span><span id="AgentMemoryManager-528"><a href="#AgentMemoryManager-528"><span class="linenos"> 528</span></a>
</span><span id="AgentMemoryManager-529"><a href="#AgentMemoryManager-529"><span class="linenos"> 529</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-530"><a href="#AgentMemoryManager-530"><span class="linenos"> 530</span></a><span class="sd">            True if entity exists</span>
</span><span id="AgentMemoryManager-531"><a href="#AgentMemoryManager-531"><span class="linenos"> 531</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-532"><a href="#AgentMemoryManager-532"><span class="linenos"> 532</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-533"><a href="#AgentMemoryManager-533"><span class="linenos"> 533</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/entity/exists&quot;</span>
</span><span id="AgentMemoryManager-534"><a href="#AgentMemoryManager-534"><span class="linenos"> 534</span></a>
</span><span id="AgentMemoryManager-535"><a href="#AgentMemoryManager-535"><span class="linenos"> 535</span></a>            <span class="c1"># Try different parameter formats that LightRAG might expect</span>
</span><span id="AgentMemoryManager-536"><a href="#AgentMemoryManager-536"><span class="linenos"> 536</span></a>            <span class="n">params_options</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager-537"><a href="#AgentMemoryManager-537"><span class="linenos"> 537</span></a>                <span class="p">{</span><span class="s2">&quot;entity_name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">},</span>
</span><span id="AgentMemoryManager-538"><a href="#AgentMemoryManager-538"><span class="linenos"> 538</span></a>                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">},</span>
</span><span id="AgentMemoryManager-539"><a href="#AgentMemoryManager-539"><span class="linenos"> 539</span></a>                <span class="p">{</span><span class="s2">&quot;entity&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">},</span>
</span><span id="AgentMemoryManager-540"><a href="#AgentMemoryManager-540"><span class="linenos"> 540</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager-541"><a href="#AgentMemoryManager-541"><span class="linenos"> 541</span></a>
</span><span id="AgentMemoryManager-542"><a href="#AgentMemoryManager-542"><span class="linenos"> 542</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager-543"><a href="#AgentMemoryManager-543"><span class="linenos"> 543</span></a>                <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">params_options</span><span class="p">:</span>
</span><span id="AgentMemoryManager-544"><a href="#AgentMemoryManager-544"><span class="linenos"> 544</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-545"><a href="#AgentMemoryManager-545"><span class="linenos"> 545</span></a>                        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-546"><a href="#AgentMemoryManager-546"><span class="linenos"> 546</span></a>                            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager-547"><a href="#AgentMemoryManager-547"><span class="linenos"> 547</span></a>                                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager-548"><a href="#AgentMemoryManager-548"><span class="linenos"> 548</span></a>                                <span class="c1"># Handle different response formats</span>
</span><span id="AgentMemoryManager-549"><a href="#AgentMemoryManager-549"><span class="linenos"> 549</span></a>                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="AgentMemoryManager-550"><a href="#AgentMemoryManager-550"><span class="linenos"> 550</span></a>                                    <span class="n">exists</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-551"><a href="#AgentMemoryManager-551"><span class="linenos"> 551</span></a>                                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="AgentMemoryManager-552"><a href="#AgentMemoryManager-552"><span class="linenos"> 552</span></a>                                    <span class="n">exists</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exists&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgentMemoryManager-553"><a href="#AgentMemoryManager-553"><span class="linenos"> 553</span></a>                                        <span class="s2">&quot;found&quot;</span><span class="p">,</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager-554"><a href="#AgentMemoryManager-554"><span class="linenos"> 554</span></a>                                    <span class="p">)</span>
</span><span id="AgentMemoryManager-555"><a href="#AgentMemoryManager-555"><span class="linenos"> 555</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-556"><a href="#AgentMemoryManager-556"><span class="linenos"> 556</span></a>                                    <span class="n">exists</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager-557"><a href="#AgentMemoryManager-557"><span class="linenos"> 557</span></a>
</span><span id="AgentMemoryManager-558"><a href="#AgentMemoryManager-558"><span class="linenos"> 558</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="AgentMemoryManager-559"><a href="#AgentMemoryManager-559"><span class="linenos"> 559</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2"> exists: </span><span class="si">{</span><span class="n">exists</span><span class="si">}</span><span class="s2"> (params: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="AgentMemoryManager-560"><a href="#AgentMemoryManager-560"><span class="linenos"> 560</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-561"><a href="#AgentMemoryManager-561"><span class="linenos"> 561</span></a>                                <span class="k">return</span> <span class="n">exists</span>
</span><span id="AgentMemoryManager-562"><a href="#AgentMemoryManager-562"><span class="linenos"> 562</span></a>                            <span class="k">elif</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">422</span><span class="p">:</span>
</span><span id="AgentMemoryManager-563"><a href="#AgentMemoryManager-563"><span class="linenos"> 563</span></a>                                <span class="c1"># Try next parameter format</span>
</span><span id="AgentMemoryManager-564"><a href="#AgentMemoryManager-564"><span class="linenos"> 564</span></a>                                <span class="k">continue</span>
</span><span id="AgentMemoryManager-565"><a href="#AgentMemoryManager-565"><span class="linenos"> 565</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-566"><a href="#AgentMemoryManager-566"><span class="linenos"> 566</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager-567"><a href="#AgentMemoryManager-567"><span class="linenos"> 567</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Failed to check entity existence for </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-568"><a href="#AgentMemoryManager-568"><span class="linenos"> 568</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-569"><a href="#AgentMemoryManager-569"><span class="linenos"> 569</span></a>                                <span class="k">break</span>
</span><span id="AgentMemoryManager-570"><a href="#AgentMemoryManager-570"><span class="linenos"> 570</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-571"><a href="#AgentMemoryManager-571"><span class="linenos"> 571</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error with params </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-572"><a href="#AgentMemoryManager-572"><span class="linenos"> 572</span></a>                        <span class="k">continue</span>
</span><span id="AgentMemoryManager-573"><a href="#AgentMemoryManager-573"><span class="linenos"> 573</span></a>
</span><span id="AgentMemoryManager-574"><a href="#AgentMemoryManager-574"><span class="linenos"> 574</span></a>                <span class="c1"># If all parameter formats fail, fall back to label list approach</span>
</span><span id="AgentMemoryManager-575"><a href="#AgentMemoryManager-575"><span class="linenos"> 575</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="AgentMemoryManager-576"><a href="#AgentMemoryManager-576"><span class="linenos"> 576</span></a>                    <span class="sa">f</span><span class="s2">&quot;All parameter formats failed for </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">, falling back to label list&quot;</span>
</span><span id="AgentMemoryManager-577"><a href="#AgentMemoryManager-577"><span class="linenos"> 577</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-578"><a href="#AgentMemoryManager-578"><span class="linenos"> 578</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/label/list&quot;</span>
</span><span id="AgentMemoryManager-579"><a href="#AgentMemoryManager-579"><span class="linenos"> 579</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-580"><a href="#AgentMemoryManager-580"><span class="linenos"> 580</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager-581"><a href="#AgentMemoryManager-581"><span class="linenos"> 581</span></a>                        <span class="n">labels_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager-582"><a href="#AgentMemoryManager-582"><span class="linenos"> 582</span></a>
</span><span id="AgentMemoryManager-583"><a href="#AgentMemoryManager-583"><span class="linenos"> 583</span></a>                        <span class="c1"># Handle both response formats: direct array or dict with &#39;labels&#39; key</span>
</span><span id="AgentMemoryManager-584"><a href="#AgentMemoryManager-584"><span class="linenos"> 584</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager-585"><a href="#AgentMemoryManager-585"><span class="linenos"> 585</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">labels_data</span>
</span><span id="AgentMemoryManager-586"><a href="#AgentMemoryManager-586"><span class="linenos"> 586</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;labels&quot;</span> <span class="ow">in</span> <span class="n">labels_data</span><span class="p">:</span>
</span><span id="AgentMemoryManager-587"><a href="#AgentMemoryManager-587"><span class="linenos"> 587</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">labels_data</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-588"><a href="#AgentMemoryManager-588"><span class="linenos"> 588</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-589"><a href="#AgentMemoryManager-589"><span class="linenos"> 589</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-590"><a href="#AgentMemoryManager-590"><span class="linenos"> 590</span></a>
</span><span id="AgentMemoryManager-591"><a href="#AgentMemoryManager-591"><span class="linenos"> 591</span></a>                        <span class="c1"># Check if entity name exists in labels (case-insensitive)</span>
</span><span id="AgentMemoryManager-592"><a href="#AgentMemoryManager-592"><span class="linenos"> 592</span></a>                        <span class="n">exists</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="AgentMemoryManager-593"><a href="#AgentMemoryManager-593"><span class="linenos"> 593</span></a>                            <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">all_labels</span>
</span><span id="AgentMemoryManager-594"><a href="#AgentMemoryManager-594"><span class="linenos"> 594</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager-595"><a href="#AgentMemoryManager-595"><span class="linenos"> 595</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="AgentMemoryManager-596"><a href="#AgentMemoryManager-596"><span class="linenos"> 596</span></a>                            <span class="sa">f</span><span class="s2">&quot;Entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2"> exists (via labels): </span><span class="si">{</span><span class="n">exists</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-597"><a href="#AgentMemoryManager-597"><span class="linenos"> 597</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager-598"><a href="#AgentMemoryManager-598"><span class="linenos"> 598</span></a>                        <span class="k">return</span> <span class="n">exists</span>
</span><span id="AgentMemoryManager-599"><a href="#AgentMemoryManager-599"><span class="linenos"> 599</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-600"><a href="#AgentMemoryManager-600"><span class="linenos"> 600</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager-601"><a href="#AgentMemoryManager-601"><span class="linenos"> 601</span></a>                            <span class="sa">f</span><span class="s2">&quot;Failed to get graph labels for entity check: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-602"><a href="#AgentMemoryManager-602"><span class="linenos"> 602</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager-603"><a href="#AgentMemoryManager-603"><span class="linenos"> 603</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager-604"><a href="#AgentMemoryManager-604"><span class="linenos"> 604</span></a>
</span><span id="AgentMemoryManager-605"><a href="#AgentMemoryManager-605"><span class="linenos"> 605</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-606"><a href="#AgentMemoryManager-606"><span class="linenos"> 606</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking entity existence for </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-607"><a href="#AgentMemoryManager-607"><span class="linenos"> 607</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager-608"><a href="#AgentMemoryManager-608"><span class="linenos"> 608</span></a>
</span><span id="AgentMemoryManager-609"><a href="#AgentMemoryManager-609"><span class="linenos"> 609</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_all_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-610"><a href="#AgentMemoryManager-610"><span class="linenos"> 610</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all memories from both SQLite and LightRAG systems using the centralized service.</span>
</span><span id="AgentMemoryManager-611"><a href="#AgentMemoryManager-611"><span class="linenos"> 611</span></a>
</span><span id="AgentMemoryManager-612"><a href="#AgentMemoryManager-612"><span class="linenos"> 612</span></a><span class="sd">        This method provides a complete reset of the dual memory system by:</span>
</span><span id="AgentMemoryManager-613"><a href="#AgentMemoryManager-613"><span class="linenos"> 613</span></a><span class="sd">        1. Clearing all memories from the local SQLite database</span>
</span><span id="AgentMemoryManager-614"><a href="#AgentMemoryManager-614"><span class="linenos"> 614</span></a><span class="sd">        2. Clearing all documents from the LightRAG memory server</span>
</span><span id="AgentMemoryManager-615"><a href="#AgentMemoryManager-615"><span class="linenos"> 615</span></a><span class="sd">        3. Clearing the memory_inputs directory (NEW)</span>
</span><span id="AgentMemoryManager-616"><a href="#AgentMemoryManager-616"><span class="linenos"> 616</span></a><span class="sd">        4. Deleting the knowledge graph file</span>
</span><span id="AgentMemoryManager-617"><a href="#AgentMemoryManager-617"><span class="linenos"> 617</span></a><span class="sd">        5. Clearing server cache</span>
</span><span id="AgentMemoryManager-618"><a href="#AgentMemoryManager-618"><span class="linenos"> 618</span></a>
</span><span id="AgentMemoryManager-619"><a href="#AgentMemoryManager-619"><span class="linenos"> 619</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-620"><a href="#AgentMemoryManager-620"><span class="linenos"> 620</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgentMemoryManager-621"><a href="#AgentMemoryManager-621"><span class="linenos"> 621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-622"><a href="#AgentMemoryManager-622"><span class="linenos"> 622</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-623"><a href="#AgentMemoryManager-623"><span class="linenos"> 623</span></a>            <span class="c1"># Import the centralized clearing service</span>
</span><span id="AgentMemoryManager-624"><a href="#AgentMemoryManager-624"><span class="linenos"> 624</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">..core.memory_clearing_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemoryClearingService</span><span class="p">,</span> <span class="n">ClearingOptions</span>
</span><span id="AgentMemoryManager-625"><a href="#AgentMemoryManager-625"><span class="linenos"> 625</span></a>            
</span><span id="AgentMemoryManager-626"><a href="#AgentMemoryManager-626"><span class="linenos"> 626</span></a>            <span class="c1"># Create the clearing service</span>
</span><span id="AgentMemoryManager-627"><a href="#AgentMemoryManager-627"><span class="linenos"> 627</span></a>            <span class="n">clearing_service</span> <span class="o">=</span> <span class="n">MemoryClearingService</span><span class="p">(</span>
</span><span id="AgentMemoryManager-628"><a href="#AgentMemoryManager-628"><span class="linenos"> 628</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-629"><a href="#AgentMemoryManager-629"><span class="linenos"> 629</span></a>                <span class="n">agno_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">,</span>
</span><span id="AgentMemoryManager-630"><a href="#AgentMemoryManager-630"><span class="linenos"> 630</span></a>                <span class="n">lightrag_memory_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">,</span>
</span><span id="AgentMemoryManager-631"><a href="#AgentMemoryManager-631"><span class="linenos"> 631</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Keep quiet for agent use</span>
</span><span id="AgentMemoryManager-632"><a href="#AgentMemoryManager-632"><span class="linenos"> 632</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-633"><a href="#AgentMemoryManager-633"><span class="linenos"> 633</span></a>            
</span><span id="AgentMemoryManager-634"><a href="#AgentMemoryManager-634"><span class="linenos"> 634</span></a>            <span class="c1"># Create clearing options</span>
</span><span id="AgentMemoryManager-635"><a href="#AgentMemoryManager-635"><span class="linenos"> 635</span></a>            <span class="n">options</span> <span class="o">=</span> <span class="n">ClearingOptions</span><span class="p">(</span>
</span><span id="AgentMemoryManager-636"><a href="#AgentMemoryManager-636"><span class="linenos"> 636</span></a>                <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager-637"><a href="#AgentMemoryManager-637"><span class="linenos"> 637</span></a>                <span class="n">semantic_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager-638"><a href="#AgentMemoryManager-638"><span class="linenos"> 638</span></a>                <span class="n">lightrag_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager-639"><a href="#AgentMemoryManager-639"><span class="linenos"> 639</span></a>                <span class="n">include_memory_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># NEW: Include memory inputs clearing</span>
</span><span id="AgentMemoryManager-640"><a href="#AgentMemoryManager-640"><span class="linenos"> 640</span></a>                <span class="n">include_knowledge_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-641"><a href="#AgentMemoryManager-641"><span class="linenos"> 641</span></a>                <span class="n">include_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-642"><a href="#AgentMemoryManager-642"><span class="linenos"> 642</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="AgentMemoryManager-643"><a href="#AgentMemoryManager-643"><span class="linenos"> 643</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-644"><a href="#AgentMemoryManager-644"><span class="linenos"> 644</span></a>            
</span><span id="AgentMemoryManager-645"><a href="#AgentMemoryManager-645"><span class="linenos"> 645</span></a>            <span class="c1"># Use the centralized service to clear all memories</span>
</span><span id="AgentMemoryManager-646"><a href="#AgentMemoryManager-646"><span class="linenos"> 646</span></a>            <span class="n">service_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">clearing_service</span><span class="o">.</span><span class="n">clear_all_memories</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span id="AgentMemoryManager-647"><a href="#AgentMemoryManager-647"><span class="linenos"> 647</span></a>            
</span><span id="AgentMemoryManager-648"><a href="#AgentMemoryManager-648"><span class="linenos"> 648</span></a>            <span class="c1"># Convert service results to user-friendly messages</span>
</span><span id="AgentMemoryManager-649"><a href="#AgentMemoryManager-649"><span class="linenos"> 649</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-650"><a href="#AgentMemoryManager-650"><span class="linenos"> 650</span></a>            
</span><span id="AgentMemoryManager-651"><a href="#AgentMemoryManager-651"><span class="linenos"> 651</span></a>            <span class="c1"># Process semantic memory results</span>
</span><span id="AgentMemoryManager-652"><a href="#AgentMemoryManager-652"><span class="linenos"> 652</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager-653"><a href="#AgentMemoryManager-653"><span class="linenos"> 653</span></a>                <span class="n">semantic_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-654"><a href="#AgentMemoryManager-654"><span class="linenos"> 654</span></a>                <span class="k">if</span> <span class="n">semantic_result</span> <span class="ow">and</span> <span class="n">semantic_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-655"><a href="#AgentMemoryManager-655"><span class="linenos"> 655</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Local memory: </span><span class="si">{</span><span class="n">semantic_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-656"><a href="#AgentMemoryManager-656"><span class="linenos"> 656</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all memories from SQLite for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-657"><a href="#AgentMemoryManager-657"><span class="linenos"> 657</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-658"><a href="#AgentMemoryManager-658"><span class="linenos"> 658</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">semantic_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">semantic_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager-659"><a href="#AgentMemoryManager-659"><span class="linenos"> 659</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Local memory error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-660"><a href="#AgentMemoryManager-660"><span class="linenos"> 660</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear memories from SQLite: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager-661"><a href="#AgentMemoryManager-661"><span class="linenos"> 661</span></a>            
</span><span id="AgentMemoryManager-662"><a href="#AgentMemoryManager-662"><span class="linenos"> 662</span></a>            <span class="c1"># Process LightRAG memory results</span>
</span><span id="AgentMemoryManager-663"><a href="#AgentMemoryManager-663"><span class="linenos"> 663</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager-664"><a href="#AgentMemoryManager-664"><span class="linenos"> 664</span></a>                <span class="n">lightrag_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-665"><a href="#AgentMemoryManager-665"><span class="linenos"> 665</span></a>                <span class="k">if</span> <span class="n">lightrag_result</span> <span class="ow">and</span> <span class="n">lightrag_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-666"><a href="#AgentMemoryManager-666"><span class="linenos"> 666</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Graph memory: </span><span class="si">{</span><span class="n">lightrag_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-667"><a href="#AgentMemoryManager-667"><span class="linenos"> 667</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all memories from LightRAG&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-668"><a href="#AgentMemoryManager-668"><span class="linenos"> 668</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-669"><a href="#AgentMemoryManager-669"><span class="linenos"> 669</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">lightrag_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">lightrag_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager-670"><a href="#AgentMemoryManager-670"><span class="linenos"> 670</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Graph memory error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-671"><a href="#AgentMemoryManager-671"><span class="linenos"> 671</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear memories from LightRAG: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager-672"><a href="#AgentMemoryManager-672"><span class="linenos"> 672</span></a>            
</span><span id="AgentMemoryManager-673"><a href="#AgentMemoryManager-673"><span class="linenos"> 673</span></a>            <span class="c1"># Process memory inputs results (NEW)</span>
</span><span id="AgentMemoryManager-674"><a href="#AgentMemoryManager-674"><span class="linenos"> 674</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;memory_inputs&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager-675"><a href="#AgentMemoryManager-675"><span class="linenos"> 675</span></a>                <span class="n">inputs_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;memory_inputs&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-676"><a href="#AgentMemoryManager-676"><span class="linenos"> 676</span></a>                <span class="k">if</span> <span class="n">inputs_result</span> <span class="ow">and</span> <span class="n">inputs_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-677"><a href="#AgentMemoryManager-677"><span class="linenos"> 677</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Memory inputs: </span><span class="si">{</span><span class="n">inputs_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-678"><a href="#AgentMemoryManager-678"><span class="linenos"> 678</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared memory inputs directory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-679"><a href="#AgentMemoryManager-679"><span class="linenos"> 679</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-680"><a href="#AgentMemoryManager-680"><span class="linenos"> 680</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">inputs_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">inputs_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager-681"><a href="#AgentMemoryManager-681"><span class="linenos"> 681</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Memory inputs error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-682"><a href="#AgentMemoryManager-682"><span class="linenos"> 682</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear memory inputs: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager-683"><a href="#AgentMemoryManager-683"><span class="linenos"> 683</span></a>            
</span><span id="AgentMemoryManager-684"><a href="#AgentMemoryManager-684"><span class="linenos"> 684</span></a>            <span class="c1"># Process knowledge graph results</span>
</span><span id="AgentMemoryManager-685"><a href="#AgentMemoryManager-685"><span class="linenos"> 685</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;knowledge_graph&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager-686"><a href="#AgentMemoryManager-686"><span class="linenos"> 686</span></a>                <span class="n">graph_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;knowledge_graph&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-687"><a href="#AgentMemoryManager-687"><span class="linenos"> 687</span></a>                <span class="k">if</span> <span class="n">graph_result</span> <span class="ow">and</span> <span class="n">graph_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-688"><a href="#AgentMemoryManager-688"><span class="linenos"> 688</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Knowledge graph: </span><span class="si">{</span><span class="n">graph_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-689"><a href="#AgentMemoryManager-689"><span class="linenos"> 689</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted knowledge graph files&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-690"><a href="#AgentMemoryManager-690"><span class="linenos"> 690</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-691"><a href="#AgentMemoryManager-691"><span class="linenos"> 691</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">graph_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">graph_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager-692"><a href="#AgentMemoryManager-692"><span class="linenos"> 692</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Knowledge graph error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-693"><a href="#AgentMemoryManager-693"><span class="linenos"> 693</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to delete knowledge graph files: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager-694"><a href="#AgentMemoryManager-694"><span class="linenos"> 694</span></a>            
</span><span id="AgentMemoryManager-695"><a href="#AgentMemoryManager-695"><span class="linenos"> 695</span></a>            <span class="c1"># Process server cache results</span>
</span><span id="AgentMemoryManager-696"><a href="#AgentMemoryManager-696"><span class="linenos"> 696</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;server_cache&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager-697"><a href="#AgentMemoryManager-697"><span class="linenos"> 697</span></a>                <span class="n">cache_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;server_cache&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-698"><a href="#AgentMemoryManager-698"><span class="linenos"> 698</span></a>                <span class="k">if</span> <span class="n">cache_result</span> <span class="ow">and</span> <span class="n">cache_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-699"><a href="#AgentMemoryManager-699"><span class="linenos"> 699</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Server cache: </span><span class="si">{</span><span class="n">cache_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-700"><a href="#AgentMemoryManager-700"><span class="linenos"> 700</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared server cache&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-701"><a href="#AgentMemoryManager-701"><span class="linenos"> 701</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-702"><a href="#AgentMemoryManager-702"><span class="linenos"> 702</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">cache_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">cache_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager-703"><a href="#AgentMemoryManager-703"><span class="linenos"> 703</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Server cache error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-704"><a href="#AgentMemoryManager-704"><span class="linenos"> 704</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear server cache: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager-705"><a href="#AgentMemoryManager-705"><span class="linenos"> 705</span></a>            
</span><span id="AgentMemoryManager-706"><a href="#AgentMemoryManager-706"><span class="linenos"> 706</span></a>            <span class="c1"># Return combined results</span>
</span><span id="AgentMemoryManager-707"><a href="#AgentMemoryManager-707"><span class="linenos"> 707</span></a>            <span class="k">return</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="AgentMemoryManager-708"><a href="#AgentMemoryManager-708"><span class="linenos"> 708</span></a>
</span><span id="AgentMemoryManager-709"><a href="#AgentMemoryManager-709"><span class="linenos"> 709</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-710"><a href="#AgentMemoryManager-710"><span class="linenos"> 710</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error clearing all memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-711"><a href="#AgentMemoryManager-711"><span class="linenos"> 711</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error clearing all memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-712"><a href="#AgentMemoryManager-712"><span class="linenos"> 712</span></a>
</span><span id="AgentMemoryManager-713"><a href="#AgentMemoryManager-713"><span class="linenos"> 713</span></a>    <span class="c1"># The following methods will be implemented in subsequent phases</span>
</span><span id="AgentMemoryManager-714"><a href="#AgentMemoryManager-714"><span class="linenos"> 714</span></a>    <span class="c1"># They are placeholders for now</span>
</span><span id="AgentMemoryManager-715"><a href="#AgentMemoryManager-715"><span class="linenos"> 715</span></a>
</span><span id="AgentMemoryManager-716"><a href="#AgentMemoryManager-716"><span class="linenos"> 716</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-717"><a href="#AgentMemoryManager-717"><span class="linenos"> 717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Search user memories using direct SemanticMemoryManager calls.</span>
</span><span id="AgentMemoryManager-718"><a href="#AgentMemoryManager-718"><span class="linenos"> 718</span></a>
</span><span id="AgentMemoryManager-719"><a href="#AgentMemoryManager-719"><span class="linenos"> 719</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-720"><a href="#AgentMemoryManager-720"><span class="linenos"> 720</span></a><span class="sd">            query: The query to search for in memories</span>
</span><span id="AgentMemoryManager-721"><a href="#AgentMemoryManager-721"><span class="linenos"> 721</span></a><span class="sd">            limit: Maximum number of memories to return</span>
</span><span id="AgentMemoryManager-722"><a href="#AgentMemoryManager-722"><span class="linenos"> 722</span></a>
</span><span id="AgentMemoryManager-723"><a href="#AgentMemoryManager-723"><span class="linenos"> 723</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-724"><a href="#AgentMemoryManager-724"><span class="linenos"> 724</span></a><span class="sd">            str: Found memories or message if none found</span>
</span><span id="AgentMemoryManager-725"><a href="#AgentMemoryManager-725"><span class="linenos"> 725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-726"><a href="#AgentMemoryManager-726"><span class="linenos"> 726</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-727"><a href="#AgentMemoryManager-727"><span class="linenos"> 727</span></a>            <span class="n">stripped_query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="AgentMemoryManager-728"><a href="#AgentMemoryManager-728"><span class="linenos"> 728</span></a>
</span><span id="AgentMemoryManager-729"><a href="#AgentMemoryManager-729"><span class="linenos"> 729</span></a>            <span class="c1"># List of phrases that should trigger get_all_memories instead of search</span>
</span><span id="AgentMemoryManager-730"><a href="#AgentMemoryManager-730"><span class="linenos"> 730</span></a>            <span class="n">get_all_phrases</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager-731"><a href="#AgentMemoryManager-731"><span class="linenos"> 731</span></a>                <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-732"><a href="#AgentMemoryManager-732"><span class="linenos"> 732</span></a>                <span class="s2">&quot;all memories&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-733"><a href="#AgentMemoryManager-733"><span class="linenos"> 733</span></a>                <span class="s2">&quot;everything&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-734"><a href="#AgentMemoryManager-734"><span class="linenos"> 734</span></a>                <span class="s2">&quot;summarize all memories&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-735"><a href="#AgentMemoryManager-735"><span class="linenos"> 735</span></a>                <span class="s2">&quot;what do you know about me&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-736"><a href="#AgentMemoryManager-736"><span class="linenos"> 736</span></a>                <span class="s2">&quot;what have i told you&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-737"><a href="#AgentMemoryManager-737"><span class="linenos"> 737</span></a>                <span class="s2">&quot;list all memories&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-738"><a href="#AgentMemoryManager-738"><span class="linenos"> 738</span></a>                <span class="s2">&quot;show all memories&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-739"><a href="#AgentMemoryManager-739"><span class="linenos"> 739</span></a>                <span class="s2">&quot;tell me everything&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-740"><a href="#AgentMemoryManager-740"><span class="linenos"> 740</span></a>                <span class="s2">&quot;list everything you know&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-741"><a href="#AgentMemoryManager-741"><span class="linenos"> 741</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager-742"><a href="#AgentMemoryManager-742"><span class="linenos"> 742</span></a>
</span><span id="AgentMemoryManager-743"><a href="#AgentMemoryManager-743"><span class="linenos"> 743</span></a>            <span class="k">if</span> <span class="n">stripped_query</span> <span class="ow">in</span> <span class="n">get_all_phrases</span><span class="p">:</span>
</span><span id="AgentMemoryManager-744"><a href="#AgentMemoryManager-744"><span class="linenos"> 744</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-745"><a href="#AgentMemoryManager-745"><span class="linenos"> 745</span></a>                    <span class="s2">&quot;Generic query &#39;</span><span class="si">%s</span><span class="s2">&#39; detected. Delegating to get_all_memories.&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-746"><a href="#AgentMemoryManager-746"><span class="linenos"> 746</span></a>                    <span class="n">query</span><span class="p">,</span>
</span><span id="AgentMemoryManager-747"><a href="#AgentMemoryManager-747"><span class="linenos"> 747</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-748"><a href="#AgentMemoryManager-748"><span class="linenos"> 748</span></a>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">()</span>
</span><span id="AgentMemoryManager-749"><a href="#AgentMemoryManager-749"><span class="linenos"> 749</span></a>
</span><span id="AgentMemoryManager-750"><a href="#AgentMemoryManager-750"><span class="linenos"> 750</span></a>            <span class="c1"># Validate query parameter</span>
</span><span id="AgentMemoryManager-751"><a href="#AgentMemoryManager-751"><span class="linenos"> 751</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="AgentMemoryManager-752"><a href="#AgentMemoryManager-752"><span class="linenos"> 752</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Empty query provided to query_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-753"><a href="#AgentMemoryManager-753"><span class="linenos"> 753</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Error: Query cannot be empty. Please provide a search term.&quot;</span>
</span><span id="AgentMemoryManager-754"><a href="#AgentMemoryManager-754"><span class="linenos"> 754</span></a>
</span><span id="AgentMemoryManager-755"><a href="#AgentMemoryManager-755"><span class="linenos"> 755</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.search_memories()</span>
</span><span id="AgentMemoryManager-756"><a href="#AgentMemoryManager-756"><span class="linenos"> 756</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">search_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager-757"><a href="#AgentMemoryManager-757"><span class="linenos"> 757</span></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="AgentMemoryManager-758"><a href="#AgentMemoryManager-758"><span class="linenos"> 758</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager-759"><a href="#AgentMemoryManager-759"><span class="linenos"> 759</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-760"><a href="#AgentMemoryManager-760"><span class="linenos"> 760</span></a>                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span id="AgentMemoryManager-761"><a href="#AgentMemoryManager-761"><span class="linenos"> 761</span></a>                <span class="n">similarity_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="AgentMemoryManager-762"><a href="#AgentMemoryManager-762"><span class="linenos"> 762</span></a>                <span class="n">search_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-763"><a href="#AgentMemoryManager-763"><span class="linenos"> 763</span></a>                <span class="n">topic_boost</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="AgentMemoryManager-764"><a href="#AgentMemoryManager-764"><span class="linenos"> 764</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-765"><a href="#AgentMemoryManager-765"><span class="linenos"> 765</span></a>
</span><span id="AgentMemoryManager-766"><a href="#AgentMemoryManager-766"><span class="linenos"> 766</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
</span><span id="AgentMemoryManager-767"><a href="#AgentMemoryManager-767"><span class="linenos"> 767</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No matching memories found for query: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span id="AgentMemoryManager-768"><a href="#AgentMemoryManager-768"><span class="linenos"> 768</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🔍 No memories found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. Try different keywords or ask me to remember something new!&quot;</span>
</span><span id="AgentMemoryManager-769"><a href="#AgentMemoryManager-769"><span class="linenos"> 769</span></a>
</span><span id="AgentMemoryManager-770"><a href="#AgentMemoryManager-770"><span class="linenos"> 770</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager-771"><a href="#AgentMemoryManager-771"><span class="linenos"> 771</span></a>            <span class="n">display_memories</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="n">results</span>
</span><span id="AgentMemoryManager-772"><a href="#AgentMemoryManager-772"><span class="linenos"> 772</span></a>            <span class="n">result_note</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🧠 MEMORY RETRIEVAL (found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> matches via semantic search)&quot;</span>
</span><span id="AgentMemoryManager-773"><a href="#AgentMemoryManager-773"><span class="linenos"> 773</span></a>
</span><span id="AgentMemoryManager-774"><a href="#AgentMemoryManager-774"><span class="linenos"> 774</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_note</span><span class="si">}</span><span class="s2">: The following memories were found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. You must restate this information addressing the user as &#39;you&#39; (second person), not as if you are the user:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-775"><a href="#AgentMemoryManager-775"><span class="linenos"> 775</span></a>
</span><span id="AgentMemoryManager-776"><a href="#AgentMemoryManager-776"><span class="linenos"> 776</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">display_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager-777"><a href="#AgentMemoryManager-777"><span class="linenos"> 777</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="s2"> (similarity: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-778"><a href="#AgentMemoryManager-778"><span class="linenos"> 778</span></a>                <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-779"><a href="#AgentMemoryManager-779"><span class="linenos"> 779</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-780"><a href="#AgentMemoryManager-780"><span class="linenos"> 780</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-781"><a href="#AgentMemoryManager-781"><span class="linenos"> 781</span></a>
</span><span id="AgentMemoryManager-782"><a href="#AgentMemoryManager-782"><span class="linenos"> 782</span></a>            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">REMEMBER: Restate this information as an AI assistant talking ABOUT the user, not AS the user. Use &#39;you&#39; instead of &#39;I&#39; when referring to the user&#39;s information.&quot;</span>
</span><span id="AgentMemoryManager-783"><a href="#AgentMemoryManager-783"><span class="linenos"> 783</span></a>
</span><span id="AgentMemoryManager-784"><a href="#AgentMemoryManager-784"><span class="linenos"> 784</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> matching memories for query: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">query</span><span class="p">)</span>
</span><span id="AgentMemoryManager-785"><a href="#AgentMemoryManager-785"><span class="linenos"> 785</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-786"><a href="#AgentMemoryManager-786"><span class="linenos"> 786</span></a>
</span><span id="AgentMemoryManager-787"><a href="#AgentMemoryManager-787"><span class="linenos"> 787</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-788"><a href="#AgentMemoryManager-788"><span class="linenos"> 788</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error querying memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-789"><a href="#AgentMemoryManager-789"><span class="linenos"> 789</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error searching memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-790"><a href="#AgentMemoryManager-790"><span class="linenos"> 790</span></a>
</span><span id="AgentMemoryManager-791"><a href="#AgentMemoryManager-791"><span class="linenos"> 791</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager-792"><a href="#AgentMemoryManager-792"><span class="linenos"> 792</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-793"><a href="#AgentMemoryManager-793"><span class="linenos"> 793</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-794"><a href="#AgentMemoryManager-794"><span class="linenos"> 794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an existing memory using direct SemanticMemoryManager calls.</span>
</span><span id="AgentMemoryManager-795"><a href="#AgentMemoryManager-795"><span class="linenos"> 795</span></a>
</span><span id="AgentMemoryManager-796"><a href="#AgentMemoryManager-796"><span class="linenos"> 796</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-797"><a href="#AgentMemoryManager-797"><span class="linenos"> 797</span></a><span class="sd">            memory_id: ID of the memory to update</span>
</span><span id="AgentMemoryManager-798"><a href="#AgentMemoryManager-798"><span class="linenos"> 798</span></a><span class="sd">            content: New memory content</span>
</span><span id="AgentMemoryManager-799"><a href="#AgentMemoryManager-799"><span class="linenos"> 799</span></a><span class="sd">            topics: Optional list of topics/categories for the memory</span>
</span><span id="AgentMemoryManager-800"><a href="#AgentMemoryManager-800"><span class="linenos"> 800</span></a>
</span><span id="AgentMemoryManager-801"><a href="#AgentMemoryManager-801"><span class="linenos"> 801</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-802"><a href="#AgentMemoryManager-802"><span class="linenos"> 802</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgentMemoryManager-803"><a href="#AgentMemoryManager-803"><span class="linenos"> 803</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-804"><a href="#AgentMemoryManager-804"><span class="linenos"> 804</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-805"><a href="#AgentMemoryManager-805"><span class="linenos"> 805</span></a>            <span class="c1"># SIMPLIFIED TOPIC HANDLING: Handle the common cases simply</span>
</span><span id="AgentMemoryManager-806"><a href="#AgentMemoryManager-806"><span class="linenos"> 806</span></a>            <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgentMemoryManager-807"><a href="#AgentMemoryManager-807"><span class="linenos"> 807</span></a>                <span class="c1"># Leave as None - let memory manager auto-classify</span>
</span><span id="AgentMemoryManager-808"><a href="#AgentMemoryManager-808"><span class="linenos"> 808</span></a>                <span class="k">pass</span>
</span><span id="AgentMemoryManager-809"><a href="#AgentMemoryManager-809"><span class="linenos"> 809</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager-810"><a href="#AgentMemoryManager-810"><span class="linenos"> 810</span></a>                <span class="c1"># Convert string to list, handle comma-separated values</span>
</span><span id="AgentMemoryManager-811"><a href="#AgentMemoryManager-811"><span class="linenos"> 811</span></a>                <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-812"><a href="#AgentMemoryManager-812"><span class="linenos"> 812</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager-813"><a href="#AgentMemoryManager-813"><span class="linenos"> 813</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-814"><a href="#AgentMemoryManager-814"><span class="linenos"> 814</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-815"><a href="#AgentMemoryManager-815"><span class="linenos"> 815</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager-816"><a href="#AgentMemoryManager-816"><span class="linenos"> 816</span></a>                <span class="c1"># Clean up list - remove empty entries</span>
</span><span id="AgentMemoryManager-817"><a href="#AgentMemoryManager-817"><span class="linenos"> 817</span></a>                <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager-818"><a href="#AgentMemoryManager-818"><span class="linenos"> 818</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-819"><a href="#AgentMemoryManager-819"><span class="linenos"> 819</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-820"><a href="#AgentMemoryManager-820"><span class="linenos"> 820</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-821"><a href="#AgentMemoryManager-821"><span class="linenos"> 821</span></a>                <span class="c1"># Convert anything else to string and put in list</span>
</span><span id="AgentMemoryManager-822"><a href="#AgentMemoryManager-822"><span class="linenos"> 822</span></a>                <span class="n">topic_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="AgentMemoryManager-823"><a href="#AgentMemoryManager-823"><span class="linenos"> 823</span></a>                <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_str</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic_str</span> <span class="ow">and</span> <span class="n">topic_str</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-824"><a href="#AgentMemoryManager-824"><span class="linenos"> 824</span></a>
</span><span id="AgentMemoryManager-825"><a href="#AgentMemoryManager-825"><span class="linenos"> 825</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.update_memory()</span>
</span><span id="AgentMemoryManager-826"><a href="#AgentMemoryManager-826"><span class="linenos"> 826</span></a>            <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">update_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager-827"><a href="#AgentMemoryManager-827"><span class="linenos"> 827</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-828"><a href="#AgentMemoryManager-828"><span class="linenos"> 828</span></a>                <span class="n">memory_text</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
</span><span id="AgentMemoryManager-829"><a href="#AgentMemoryManager-829"><span class="linenos"> 829</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager-830"><a href="#AgentMemoryManager-830"><span class="linenos"> 830</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-831"><a href="#AgentMemoryManager-831"><span class="linenos"> 831</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="AgentMemoryManager-832"><a href="#AgentMemoryManager-832"><span class="linenos"> 832</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-833"><a href="#AgentMemoryManager-833"><span class="linenos"> 833</span></a>
</span><span id="AgentMemoryManager-834"><a href="#AgentMemoryManager-834"><span class="linenos"> 834</span></a>            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-835"><a href="#AgentMemoryManager-835"><span class="linenos"> 835</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updated memory </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">])</span>
</span><span id="AgentMemoryManager-836"><a href="#AgentMemoryManager-836"><span class="linenos"> 836</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ Successfully updated memory: </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="AgentMemoryManager-837"><a href="#AgentMemoryManager-837"><span class="linenos"> 837</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-838"><a href="#AgentMemoryManager-838"><span class="linenos"> 838</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to update memory </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="AgentMemoryManager-839"><a href="#AgentMemoryManager-839"><span class="linenos"> 839</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error updating memory: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-840"><a href="#AgentMemoryManager-840"><span class="linenos"> 840</span></a>
</span><span id="AgentMemoryManager-841"><a href="#AgentMemoryManager-841"><span class="linenos"> 841</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-842"><a href="#AgentMemoryManager-842"><span class="linenos"> 842</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error updating memory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-843"><a href="#AgentMemoryManager-843"><span class="linenos"> 843</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error updating memory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-844"><a href="#AgentMemoryManager-844"><span class="linenos"> 844</span></a>
</span><span id="AgentMemoryManager-845"><a href="#AgentMemoryManager-845"><span class="linenos"> 845</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-846"><a href="#AgentMemoryManager-846"><span class="linenos"> 846</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a memory from both SQLite and LightRAG systems.</span>
</span><span id="AgentMemoryManager-847"><a href="#AgentMemoryManager-847"><span class="linenos"> 847</span></a>
</span><span id="AgentMemoryManager-848"><a href="#AgentMemoryManager-848"><span class="linenos"> 848</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-849"><a href="#AgentMemoryManager-849"><span class="linenos"> 849</span></a><span class="sd">            memory_id: ID of the memory to delete</span>
</span><span id="AgentMemoryManager-850"><a href="#AgentMemoryManager-850"><span class="linenos"> 850</span></a>
</span><span id="AgentMemoryManager-851"><a href="#AgentMemoryManager-851"><span class="linenos"> 851</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-852"><a href="#AgentMemoryManager-852"><span class="linenos"> 852</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgentMemoryManager-853"><a href="#AgentMemoryManager-853"><span class="linenos"> 853</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-854"><a href="#AgentMemoryManager-854"><span class="linenos"> 854</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-855"><a href="#AgentMemoryManager-855"><span class="linenos"> 855</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-856"><a href="#AgentMemoryManager-856"><span class="linenos"> 856</span></a>
</span><span id="AgentMemoryManager-857"><a href="#AgentMemoryManager-857"><span class="linenos"> 857</span></a>            <span class="c1"># 1. Delete from local SQLite memory system</span>
</span><span id="AgentMemoryManager-858"><a href="#AgentMemoryManager-858"><span class="linenos"> 858</span></a>            <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager-859"><a href="#AgentMemoryManager-859"><span class="linenos"> 859</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager-860"><a href="#AgentMemoryManager-860"><span class="linenos"> 860</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-861"><a href="#AgentMemoryManager-861"><span class="linenos"> 861</span></a>
</span><span id="AgentMemoryManager-862"><a href="#AgentMemoryManager-862"><span class="linenos"> 862</span></a>            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager-863"><a href="#AgentMemoryManager-863"><span class="linenos"> 863</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted memory </span><span class="si">%s</span><span class="s2"> from SQLite&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-864"><a href="#AgentMemoryManager-864"><span class="linenos"> 864</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;✅ Local memory: Deleted successfully&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-865"><a href="#AgentMemoryManager-865"><span class="linenos"> 865</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-866"><a href="#AgentMemoryManager-866"><span class="linenos"> 866</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgentMemoryManager-867"><a href="#AgentMemoryManager-867"><span class="linenos"> 867</span></a>                    <span class="s2">&quot;Failed to delete memory </span><span class="si">%s</span><span class="s2"> from SQLite: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">message</span>
</span><span id="AgentMemoryManager-868"><a href="#AgentMemoryManager-868"><span class="linenos"> 868</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-869"><a href="#AgentMemoryManager-869"><span class="linenos"> 869</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Local memory error: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-870"><a href="#AgentMemoryManager-870"><span class="linenos"> 870</span></a>
</span><span id="AgentMemoryManager-871"><a href="#AgentMemoryManager-871"><span class="linenos"> 871</span></a>            <span class="c1"># 2. Delete from LightRAG graph memory system</span>
</span><span id="AgentMemoryManager-872"><a href="#AgentMemoryManager-872"><span class="linenos"> 872</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-873"><a href="#AgentMemoryManager-873"><span class="linenos"> 873</span></a>                <span class="c1"># Construct the filename pattern to search for</span>
</span><span id="AgentMemoryManager-874"><a href="#AgentMemoryManager-874"><span class="linenos"> 874</span></a>                <span class="n">filename_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;memory_</span><span class="si">{</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">_*.txt&quot;</span>
</span><span id="AgentMemoryManager-875"><a href="#AgentMemoryManager-875"><span class="linenos"> 875</span></a>
</span><span id="AgentMemoryManager-876"><a href="#AgentMemoryManager-876"><span class="linenos"> 876</span></a>                <span class="c1"># Use LightRAG API to find documents matching the pattern</span>
</span><span id="AgentMemoryManager-877"><a href="#AgentMemoryManager-877"><span class="linenos"> 877</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents&quot;</span>
</span><span id="AgentMemoryManager-878"><a href="#AgentMemoryManager-878"><span class="linenos"> 878</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager-879"><a href="#AgentMemoryManager-879"><span class="linenos"> 879</span></a>                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-880"><a href="#AgentMemoryManager-880"><span class="linenos"> 880</span></a>                        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager-881"><a href="#AgentMemoryManager-881"><span class="linenos"> 881</span></a>                            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager-882"><a href="#AgentMemoryManager-882"><span class="linenos"> 882</span></a>                            <span class="n">all_docs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-883"><a href="#AgentMemoryManager-883"><span class="linenos"> 883</span></a>
</span><span id="AgentMemoryManager-884"><a href="#AgentMemoryManager-884"><span class="linenos"> 884</span></a>                            <span class="c1"># Extract documents from response</span>
</span><span id="AgentMemoryManager-885"><a href="#AgentMemoryManager-885"><span class="linenos"> 885</span></a>                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;statuses&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager-886"><a href="#AgentMemoryManager-886"><span class="linenos"> 886</span></a>                                <span class="n">statuses</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;statuses&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-887"><a href="#AgentMemoryManager-887"><span class="linenos"> 887</span></a>                                <span class="k">for</span> <span class="n">status_name</span><span class="p">,</span> <span class="n">docs_list</span> <span class="ow">in</span> <span class="n">statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentMemoryManager-888"><a href="#AgentMemoryManager-888"><span class="linenos"> 888</span></a>                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager-889"><a href="#AgentMemoryManager-889"><span class="linenos"> 889</span></a>                                        <span class="n">all_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs_list</span><span class="p">)</span>
</span><span id="AgentMemoryManager-890"><a href="#AgentMemoryManager-890"><span class="linenos"> 890</span></a>                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;documents&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager-891"><a href="#AgentMemoryManager-891"><span class="linenos"> 891</span></a>                                <span class="n">all_docs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-892"><a href="#AgentMemoryManager-892"><span class="linenos"> 892</span></a>                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager-893"><a href="#AgentMemoryManager-893"><span class="linenos"> 893</span></a>                                <span class="n">all_docs</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="AgentMemoryManager-894"><a href="#AgentMemoryManager-894"><span class="linenos"> 894</span></a>
</span><span id="AgentMemoryManager-895"><a href="#AgentMemoryManager-895"><span class="linenos"> 895</span></a>                            <span class="c1"># Find documents matching our memory_id pattern</span>
</span><span id="AgentMemoryManager-896"><a href="#AgentMemoryManager-896"><span class="linenos"> 896</span></a>                            <span class="n">docs_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-897"><a href="#AgentMemoryManager-897"><span class="linenos"> 897</span></a>                            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">:</span>
</span><span id="AgentMemoryManager-898"><a href="#AgentMemoryManager-898"><span class="linenos"> 898</span></a>                                <span class="n">file_path</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-899"><a href="#AgentMemoryManager-899"><span class="linenos"> 899</span></a>                                <span class="k">if</span> <span class="n">file_path</span> <span class="ow">and</span> <span class="sa">f</span><span class="s2">&quot;memory_</span><span class="si">{</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
</span><span id="AgentMemoryManager-900"><a href="#AgentMemoryManager-900"><span class="linenos"> 900</span></a>                                    <span class="n">docs_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="AgentMemoryManager-901"><a href="#AgentMemoryManager-901"><span class="linenos"> 901</span></a>
</span><span id="AgentMemoryManager-902"><a href="#AgentMemoryManager-902"><span class="linenos"> 902</span></a>                            <span class="k">if</span> <span class="n">docs_to_delete</span><span class="p">:</span>
</span><span id="AgentMemoryManager-903"><a href="#AgentMemoryManager-903"><span class="linenos"> 903</span></a>                                <span class="c1"># Delete the matching documents</span>
</span><span id="AgentMemoryManager-904"><a href="#AgentMemoryManager-904"><span class="linenos"> 904</span></a>                                <span class="n">doc_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs_to_delete</span><span class="p">]</span>
</span><span id="AgentMemoryManager-905"><a href="#AgentMemoryManager-905"><span class="linenos"> 905</span></a>                                <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;doc_ids&quot;</span><span class="p">:</span> <span class="n">doc_ids</span><span class="p">,</span> <span class="s2">&quot;delete_file&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="AgentMemoryManager-906"><a href="#AgentMemoryManager-906"><span class="linenos"> 906</span></a>
</span><span id="AgentMemoryManager-907"><a href="#AgentMemoryManager-907"><span class="linenos"> 907</span></a>                                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="AgentMemoryManager-908"><a href="#AgentMemoryManager-908"><span class="linenos"> 908</span></a>                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents/delete_document&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-909"><a href="#AgentMemoryManager-909"><span class="linenos"> 909</span></a>                                    <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="AgentMemoryManager-910"><a href="#AgentMemoryManager-910"><span class="linenos"> 910</span></a>                                    <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span id="AgentMemoryManager-911"><a href="#AgentMemoryManager-911"><span class="linenos"> 911</span></a>                                <span class="p">)</span> <span class="k">as</span> <span class="n">del_resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-912"><a href="#AgentMemoryManager-912"><span class="linenos"> 912</span></a>                                    <span class="k">if</span> <span class="n">del_resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager-913"><a href="#AgentMemoryManager-913"><span class="linenos"> 913</span></a>                                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-914"><a href="#AgentMemoryManager-914"><span class="linenos"> 914</span></a>                                            <span class="s2">&quot;Deleted memory </span><span class="si">%s</span><span class="s2"> from LightRAG&quot;</span><span class="p">,</span> <span class="n">memory_id</span>
</span><span id="AgentMemoryManager-915"><a href="#AgentMemoryManager-915"><span class="linenos"> 915</span></a>                                        <span class="p">)</span>
</span><span id="AgentMemoryManager-916"><a href="#AgentMemoryManager-916"><span class="linenos"> 916</span></a>                                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgentMemoryManager-917"><a href="#AgentMemoryManager-917"><span class="linenos"> 917</span></a>                                            <span class="s2">&quot;✅ Graph memory: Deleted successfully&quot;</span>
</span><span id="AgentMemoryManager-918"><a href="#AgentMemoryManager-918"><span class="linenos"> 918</span></a>                                        <span class="p">)</span>
</span><span id="AgentMemoryManager-919"><a href="#AgentMemoryManager-919"><span class="linenos"> 919</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-920"><a href="#AgentMemoryManager-920"><span class="linenos"> 920</span></a>                                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">del_resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager-921"><a href="#AgentMemoryManager-921"><span class="linenos"> 921</span></a>                                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgentMemoryManager-922"><a href="#AgentMemoryManager-922"><span class="linenos"> 922</span></a>                                            <span class="s2">&quot;Failed to delete memory </span><span class="si">%s</span><span class="s2"> from LightRAG: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-923"><a href="#AgentMemoryManager-923"><span class="linenos"> 923</span></a>                                            <span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-924"><a href="#AgentMemoryManager-924"><span class="linenos"> 924</span></a>                                            <span class="n">error_text</span><span class="p">,</span>
</span><span id="AgentMemoryManager-925"><a href="#AgentMemoryManager-925"><span class="linenos"> 925</span></a>                                        <span class="p">)</span>
</span><span id="AgentMemoryManager-926"><a href="#AgentMemoryManager-926"><span class="linenos"> 926</span></a>                                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgentMemoryManager-927"><a href="#AgentMemoryManager-927"><span class="linenos"> 927</span></a>                                            <span class="sa">f</span><span class="s2">&quot;❌ Graph memory error: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-928"><a href="#AgentMemoryManager-928"><span class="linenos"> 928</span></a>                                        <span class="p">)</span>
</span><span id="AgentMemoryManager-929"><a href="#AgentMemoryManager-929"><span class="linenos"> 929</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-930"><a href="#AgentMemoryManager-930"><span class="linenos"> 930</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-931"><a href="#AgentMemoryManager-931"><span class="linenos"> 931</span></a>                                    <span class="s2">&quot;No matching documents found in LightRAG for memory </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-932"><a href="#AgentMemoryManager-932"><span class="linenos"> 932</span></a>                                    <span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-933"><a href="#AgentMemoryManager-933"><span class="linenos"> 933</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-934"><a href="#AgentMemoryManager-934"><span class="linenos"> 934</span></a>                                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgentMemoryManager-935"><a href="#AgentMemoryManager-935"><span class="linenos"> 935</span></a>                                    <span class="s2">&quot;⚠️ Graph memory: No matching documents found&quot;</span>
</span><span id="AgentMemoryManager-936"><a href="#AgentMemoryManager-936"><span class="linenos"> 936</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-937"><a href="#AgentMemoryManager-937"><span class="linenos"> 937</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-938"><a href="#AgentMemoryManager-938"><span class="linenos"> 938</span></a>                            <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager-939"><a href="#AgentMemoryManager-939"><span class="linenos"> 939</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgentMemoryManager-940"><a href="#AgentMemoryManager-940"><span class="linenos"> 940</span></a>                                <span class="s2">&quot;Failed to get documents from LightRAG: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_text</span>
</span><span id="AgentMemoryManager-941"><a href="#AgentMemoryManager-941"><span class="linenos"> 941</span></a>                            <span class="p">)</span>
</span><span id="AgentMemoryManager-942"><a href="#AgentMemoryManager-942"><span class="linenos"> 942</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Graph memory error: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-943"><a href="#AgentMemoryManager-943"><span class="linenos"> 943</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-944"><a href="#AgentMemoryManager-944"><span class="linenos"> 944</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error deleting from LightRAG: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-945"><a href="#AgentMemoryManager-945"><span class="linenos"> 945</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Graph memory error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-946"><a href="#AgentMemoryManager-946"><span class="linenos"> 946</span></a>
</span><span id="AgentMemoryManager-947"><a href="#AgentMemoryManager-947"><span class="linenos"> 947</span></a>            <span class="c1"># Return combined results</span>
</span><span id="AgentMemoryManager-948"><a href="#AgentMemoryManager-948"><span class="linenos"> 948</span></a>            <span class="k">return</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="AgentMemoryManager-949"><a href="#AgentMemoryManager-949"><span class="linenos"> 949</span></a>
</span><span id="AgentMemoryManager-950"><a href="#AgentMemoryManager-950"><span class="linenos"> 950</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-951"><a href="#AgentMemoryManager-951"><span class="linenos"> 951</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error deleting memory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-952"><a href="#AgentMemoryManager-952"><span class="linenos"> 952</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error deleting memory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-953"><a href="#AgentMemoryManager-953"><span class="linenos"> 953</span></a>
</span><span id="AgentMemoryManager-954"><a href="#AgentMemoryManager-954"><span class="linenos"> 954</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_recent_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-955"><a href="#AgentMemoryManager-955"><span class="linenos"> 955</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get recent memories by searching all memories and sorting by date.</span>
</span><span id="AgentMemoryManager-956"><a href="#AgentMemoryManager-956"><span class="linenos"> 956</span></a>
</span><span id="AgentMemoryManager-957"><a href="#AgentMemoryManager-957"><span class="linenos"> 957</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-958"><a href="#AgentMemoryManager-958"><span class="linenos"> 958</span></a><span class="sd">            limit: Maximum number of memories to return</span>
</span><span id="AgentMemoryManager-959"><a href="#AgentMemoryManager-959"><span class="linenos"> 959</span></a>
</span><span id="AgentMemoryManager-960"><a href="#AgentMemoryManager-960"><span class="linenos"> 960</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-961"><a href="#AgentMemoryManager-961"><span class="linenos"> 961</span></a><span class="sd">            str: Formatted string of recent memories</span>
</span><span id="AgentMemoryManager-962"><a href="#AgentMemoryManager-962"><span class="linenos"> 962</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-963"><a href="#AgentMemoryManager-963"><span class="linenos"> 963</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-964"><a href="#AgentMemoryManager-964"><span class="linenos"> 964</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.get_all_memories()</span>
</span><span id="AgentMemoryManager-965"><a href="#AgentMemoryManager-965"><span class="linenos"> 965</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager-966"><a href="#AgentMemoryManager-966"><span class="linenos"> 966</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager-967"><a href="#AgentMemoryManager-967"><span class="linenos"> 967</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-968"><a href="#AgentMemoryManager-968"><span class="linenos"> 968</span></a>
</span><span id="AgentMemoryManager-969"><a href="#AgentMemoryManager-969"><span class="linenos"> 969</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager-970"><a href="#AgentMemoryManager-970"><span class="linenos"> 970</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-971"><a href="#AgentMemoryManager-971"><span class="linenos"> 971</span></a>                <span class="k">return</span> <span class="s2">&quot;🔍 No memories found. Try storing some information first!&quot;</span>
</span><span id="AgentMemoryManager-972"><a href="#AgentMemoryManager-972"><span class="linenos"> 972</span></a>
</span><span id="AgentMemoryManager-973"><a href="#AgentMemoryManager-973"><span class="linenos"> 973</span></a>            <span class="c1"># Sort memories by timestamp (newest first)</span>
</span><span id="AgentMemoryManager-974"><a href="#AgentMemoryManager-974"><span class="linenos"> 974</span></a>            <span class="n">sorted_memories</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="AgentMemoryManager-975"><a href="#AgentMemoryManager-975"><span class="linenos"> 975</span></a>                <span class="n">memories</span><span class="p">,</span>
</span><span id="AgentMemoryManager-976"><a href="#AgentMemoryManager-976"><span class="linenos"> 976</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AgentMemoryManager-977"><a href="#AgentMemoryManager-977"><span class="linenos"> 977</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-978"><a href="#AgentMemoryManager-978"><span class="linenos"> 978</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-979"><a href="#AgentMemoryManager-979"><span class="linenos"> 979</span></a>
</span><span id="AgentMemoryManager-980"><a href="#AgentMemoryManager-980"><span class="linenos"> 980</span></a>            <span class="c1"># Limit the number of memories</span>
</span><span id="AgentMemoryManager-981"><a href="#AgentMemoryManager-981"><span class="linenos"> 981</span></a>            <span class="n">display_memories</span> <span class="o">=</span> <span class="n">sorted_memories</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="n">sorted_memories</span>
</span><span id="AgentMemoryManager-982"><a href="#AgentMemoryManager-982"><span class="linenos"> 982</span></a>
</span><span id="AgentMemoryManager-983"><a href="#AgentMemoryManager-983"><span class="linenos"> 983</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager-984"><a href="#AgentMemoryManager-984"><span class="linenos"> 984</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🧠 RECENT MEMORIES (showing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">display_memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> total memories):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-985"><a href="#AgentMemoryManager-985"><span class="linenos"> 985</span></a>
</span><span id="AgentMemoryManager-986"><a href="#AgentMemoryManager-986"><span class="linenos"> 986</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">display_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager-987"><a href="#AgentMemoryManager-987"><span class="linenos"> 987</span></a>                <span class="c1"># Format the memory content</span>
</span><span id="AgentMemoryManager-988"><a href="#AgentMemoryManager-988"><span class="linenos"> 988</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-989"><a href="#AgentMemoryManager-989"><span class="linenos"> 989</span></a>
</span><span id="AgentMemoryManager-990"><a href="#AgentMemoryManager-990"><span class="linenos"> 990</span></a>                <span class="c1"># Add topics if available</span>
</span><span id="AgentMemoryManager-991"><a href="#AgentMemoryManager-991"><span class="linenos"> 991</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-992"><a href="#AgentMemoryManager-992"><span class="linenos"> 992</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-993"><a href="#AgentMemoryManager-993"><span class="linenos"> 993</span></a>
</span><span id="AgentMemoryManager-994"><a href="#AgentMemoryManager-994"><span class="linenos"> 994</span></a>                <span class="c1"># Add timestamp if available</span>
</span><span id="AgentMemoryManager-995"><a href="#AgentMemoryManager-995"><span class="linenos"> 995</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-996"><a href="#AgentMemoryManager-996"><span class="linenos"> 996</span></a>                    <span class="c1"># Convert timestamp to readable format</span>
</span><span id="AgentMemoryManager-997"><a href="#AgentMemoryManager-997"><span class="linenos"> 997</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager-998"><a href="#AgentMemoryManager-998"><span class="linenos"> 998</span></a>
</span><span id="AgentMemoryManager-999"><a href="#AgentMemoryManager-999"><span class="linenos"> 999</span></a>                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1000"><a href="#AgentMemoryManager-1000"><span class="linenos">1000</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Created: </span><span class="si">{</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1001"><a href="#AgentMemoryManager-1001"><span class="linenos">1001</span></a>
</span><span id="AgentMemoryManager-1002"><a href="#AgentMemoryManager-1002"><span class="linenos">1002</span></a>                <span class="c1"># Add memory ID for reference</span>
</span><span id="AgentMemoryManager-1003"><a href="#AgentMemoryManager-1003"><span class="linenos">1003</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   ID: </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1004"><a href="#AgentMemoryManager-1004"><span class="linenos">1004</span></a>
</span><span id="AgentMemoryManager-1005"><a href="#AgentMemoryManager-1005"><span class="linenos">1005</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1006"><a href="#AgentMemoryManager-1006"><span class="linenos">1006</span></a>                <span class="s2">&quot;Retrieved </span><span class="si">%d</span><span class="s2"> recent memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1007"><a href="#AgentMemoryManager-1007"><span class="linenos">1007</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">display_memories</span><span class="p">),</span>
</span><span id="AgentMemoryManager-1008"><a href="#AgentMemoryManager-1008"><span class="linenos">1008</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1009"><a href="#AgentMemoryManager-1009"><span class="linenos">1009</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1010"><a href="#AgentMemoryManager-1010"><span class="linenos">1010</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-1011"><a href="#AgentMemoryManager-1011"><span class="linenos">1011</span></a>
</span><span id="AgentMemoryManager-1012"><a href="#AgentMemoryManager-1012"><span class="linenos">1012</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1013"><a href="#AgentMemoryManager-1013"><span class="linenos">1013</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving recent memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1014"><a href="#AgentMemoryManager-1014"><span class="linenos">1014</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving recent memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1015"><a href="#AgentMemoryManager-1015"><span class="linenos">1015</span></a>
</span><span id="AgentMemoryManager-1016"><a href="#AgentMemoryManager-1016"><span class="linenos">1016</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1017"><a href="#AgentMemoryManager-1017"><span class="linenos">1017</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all user memories.</span>
</span><span id="AgentMemoryManager-1018"><a href="#AgentMemoryManager-1018"><span class="linenos">1018</span></a>
</span><span id="AgentMemoryManager-1019"><a href="#AgentMemoryManager-1019"><span class="linenos">1019</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-1020"><a href="#AgentMemoryManager-1020"><span class="linenos">1020</span></a><span class="sd">            str: Formatted string of all memories</span>
</span><span id="AgentMemoryManager-1021"><a href="#AgentMemoryManager-1021"><span class="linenos">1021</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-1022"><a href="#AgentMemoryManager-1022"><span class="linenos">1022</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1023"><a href="#AgentMemoryManager-1023"><span class="linenos">1023</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.get_all_memories()</span>
</span><span id="AgentMemoryManager-1024"><a href="#AgentMemoryManager-1024"><span class="linenos">1024</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1025"><a href="#AgentMemoryManager-1025"><span class="linenos">1025</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager-1026"><a href="#AgentMemoryManager-1026"><span class="linenos">1026</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1027"><a href="#AgentMemoryManager-1027"><span class="linenos">1027</span></a>
</span><span id="AgentMemoryManager-1028"><a href="#AgentMemoryManager-1028"><span class="linenos">1028</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1029"><a href="#AgentMemoryManager-1029"><span class="linenos">1029</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1030"><a href="#AgentMemoryManager-1030"><span class="linenos">1030</span></a>                <span class="k">return</span> <span class="s2">&quot;🔍 No memories found. Try storing some information first!&quot;</span>
</span><span id="AgentMemoryManager-1031"><a href="#AgentMemoryManager-1031"><span class="linenos">1031</span></a>
</span><span id="AgentMemoryManager-1032"><a href="#AgentMemoryManager-1032"><span class="linenos">1032</span></a>            <span class="c1"># Sort memories by timestamp (newest first)</span>
</span><span id="AgentMemoryManager-1033"><a href="#AgentMemoryManager-1033"><span class="linenos">1033</span></a>            <span class="n">sorted_memories</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1034"><a href="#AgentMemoryManager-1034"><span class="linenos">1034</span></a>                <span class="n">memories</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1035"><a href="#AgentMemoryManager-1035"><span class="linenos">1035</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1036"><a href="#AgentMemoryManager-1036"><span class="linenos">1036</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1037"><a href="#AgentMemoryManager-1037"><span class="linenos">1037</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1038"><a href="#AgentMemoryManager-1038"><span class="linenos">1038</span></a>
</span><span id="AgentMemoryManager-1039"><a href="#AgentMemoryManager-1039"><span class="linenos">1039</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager-1040"><a href="#AgentMemoryManager-1040"><span class="linenos">1040</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🧠 ALL MEMORIES (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> total):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1041"><a href="#AgentMemoryManager-1041"><span class="linenos">1041</span></a>
</span><span id="AgentMemoryManager-1042"><a href="#AgentMemoryManager-1042"><span class="linenos">1042</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1043"><a href="#AgentMemoryManager-1043"><span class="linenos">1043</span></a>                <span class="c1"># Format the memory content</span>
</span><span id="AgentMemoryManager-1044"><a href="#AgentMemoryManager-1044"><span class="linenos">1044</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1045"><a href="#AgentMemoryManager-1045"><span class="linenos">1045</span></a>
</span><span id="AgentMemoryManager-1046"><a href="#AgentMemoryManager-1046"><span class="linenos">1046</span></a>                <span class="c1"># Add topics if available</span>
</span><span id="AgentMemoryManager-1047"><a href="#AgentMemoryManager-1047"><span class="linenos">1047</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1048"><a href="#AgentMemoryManager-1048"><span class="linenos">1048</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1049"><a href="#AgentMemoryManager-1049"><span class="linenos">1049</span></a>
</span><span id="AgentMemoryManager-1050"><a href="#AgentMemoryManager-1050"><span class="linenos">1050</span></a>                <span class="c1"># Add timestamp if available</span>
</span><span id="AgentMemoryManager-1051"><a href="#AgentMemoryManager-1051"><span class="linenos">1051</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1052"><a href="#AgentMemoryManager-1052"><span class="linenos">1052</span></a>                    <span class="c1"># Convert timestamp to readable format</span>
</span><span id="AgentMemoryManager-1053"><a href="#AgentMemoryManager-1053"><span class="linenos">1053</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager-1054"><a href="#AgentMemoryManager-1054"><span class="linenos">1054</span></a>
</span><span id="AgentMemoryManager-1055"><a href="#AgentMemoryManager-1055"><span class="linenos">1055</span></a>                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1056"><a href="#AgentMemoryManager-1056"><span class="linenos">1056</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Created: </span><span class="si">{</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1057"><a href="#AgentMemoryManager-1057"><span class="linenos">1057</span></a>
</span><span id="AgentMemoryManager-1058"><a href="#AgentMemoryManager-1058"><span class="linenos">1058</span></a>                <span class="c1"># Add memory ID for reference</span>
</span><span id="AgentMemoryManager-1059"><a href="#AgentMemoryManager-1059"><span class="linenos">1059</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   ID: </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1060"><a href="#AgentMemoryManager-1060"><span class="linenos">1060</span></a>
</span><span id="AgentMemoryManager-1061"><a href="#AgentMemoryManager-1061"><span class="linenos">1061</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1062"><a href="#AgentMemoryManager-1062"><span class="linenos">1062</span></a>                <span class="s2">&quot;Retrieved all </span><span class="si">%d</span><span class="s2"> memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager-1063"><a href="#AgentMemoryManager-1063"><span class="linenos">1063</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1064"><a href="#AgentMemoryManager-1064"><span class="linenos">1064</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-1065"><a href="#AgentMemoryManager-1065"><span class="linenos">1065</span></a>
</span><span id="AgentMemoryManager-1066"><a href="#AgentMemoryManager-1066"><span class="linenos">1066</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1067"><a href="#AgentMemoryManager-1067"><span class="linenos">1067</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving all memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1068"><a href="#AgentMemoryManager-1068"><span class="linenos">1068</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving all memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1069"><a href="#AgentMemoryManager-1069"><span class="linenos">1069</span></a>
</span><span id="AgentMemoryManager-1070"><a href="#AgentMemoryManager-1070"><span class="linenos">1070</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1071"><a href="#AgentMemoryManager-1071"><span class="linenos">1071</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get memory statistics.</span>
</span><span id="AgentMemoryManager-1072"><a href="#AgentMemoryManager-1072"><span class="linenos">1072</span></a>
</span><span id="AgentMemoryManager-1073"><a href="#AgentMemoryManager-1073"><span class="linenos">1073</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-1074"><a href="#AgentMemoryManager-1074"><span class="linenos">1074</span></a><span class="sd">            str: Formatted string with memory statistics</span>
</span><span id="AgentMemoryManager-1075"><a href="#AgentMemoryManager-1075"><span class="linenos">1075</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-1076"><a href="#AgentMemoryManager-1076"><span class="linenos">1076</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1077"><a href="#AgentMemoryManager-1077"><span class="linenos">1077</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.get_all_memories()</span>
</span><span id="AgentMemoryManager-1078"><a href="#AgentMemoryManager-1078"><span class="linenos">1078</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1079"><a href="#AgentMemoryManager-1079"><span class="linenos">1079</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager-1080"><a href="#AgentMemoryManager-1080"><span class="linenos">1080</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1081"><a href="#AgentMemoryManager-1081"><span class="linenos">1081</span></a>
</span><span id="AgentMemoryManager-1082"><a href="#AgentMemoryManager-1082"><span class="linenos">1082</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1083"><a href="#AgentMemoryManager-1083"><span class="linenos">1083</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1084"><a href="#AgentMemoryManager-1084"><span class="linenos">1084</span></a>                <span class="k">return</span> <span class="s2">&quot;🔍 No memories found. Try storing some information first!&quot;</span>
</span><span id="AgentMemoryManager-1085"><a href="#AgentMemoryManager-1085"><span class="linenos">1085</span></a>
</span><span id="AgentMemoryManager-1086"><a href="#AgentMemoryManager-1086"><span class="linenos">1086</span></a>            <span class="c1"># Calculate basic statistics</span>
</span><span id="AgentMemoryManager-1087"><a href="#AgentMemoryManager-1087"><span class="linenos">1087</span></a>            <span class="n">total_memories</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1088"><a href="#AgentMemoryManager-1088"><span class="linenos">1088</span></a>
</span><span id="AgentMemoryManager-1089"><a href="#AgentMemoryManager-1089"><span class="linenos">1089</span></a>            <span class="c1"># Get all unique topics</span>
</span><span id="AgentMemoryManager-1090"><a href="#AgentMemoryManager-1090"><span class="linenos">1090</span></a>            <span class="n">all_topics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentMemoryManager-1091"><a href="#AgentMemoryManager-1091"><span class="linenos">1091</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1092"><a href="#AgentMemoryManager-1092"><span class="linenos">1092</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1093"><a href="#AgentMemoryManager-1093"><span class="linenos">1093</span></a>                    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1094"><a href="#AgentMemoryManager-1094"><span class="linenos">1094</span></a>                        <span class="n">all_topics</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_topics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="AgentMemoryManager-1095"><a href="#AgentMemoryManager-1095"><span class="linenos">1095</span></a>
</span><span id="AgentMemoryManager-1096"><a href="#AgentMemoryManager-1096"><span class="linenos">1096</span></a>            <span class="c1"># Sort topics by frequency (most common first)</span>
</span><span id="AgentMemoryManager-1097"><a href="#AgentMemoryManager-1097"><span class="linenos">1097</span></a>            <span class="n">sorted_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_topics</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1098"><a href="#AgentMemoryManager-1098"><span class="linenos">1098</span></a>
</span><span id="AgentMemoryManager-1099"><a href="#AgentMemoryManager-1099"><span class="linenos">1099</span></a>            <span class="c1"># Calculate average memory length</span>
</span><span id="AgentMemoryManager-1100"><a href="#AgentMemoryManager-1100"><span class="linenos">1100</span></a>            <span class="n">total_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span> <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1101"><a href="#AgentMemoryManager-1101"><span class="linenos">1101</span></a>            <span class="n">avg_length</span> <span class="o">=</span> <span class="n">total_length</span> <span class="o">/</span> <span class="n">total_memories</span> <span class="k">if</span> <span class="n">total_memories</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="AgentMemoryManager-1102"><a href="#AgentMemoryManager-1102"><span class="linenos">1102</span></a>
</span><span id="AgentMemoryManager-1103"><a href="#AgentMemoryManager-1103"><span class="linenos">1103</span></a>            <span class="c1"># Get oldest and newest memory timestamps</span>
</span><span id="AgentMemoryManager-1104"><a href="#AgentMemoryManager-1104"><span class="linenos">1104</span></a>            <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager-1105"><a href="#AgentMemoryManager-1105"><span class="linenos">1105</span></a>                <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1106"><a href="#AgentMemoryManager-1106"><span class="linenos">1106</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager-1107"><a href="#AgentMemoryManager-1107"><span class="linenos">1107</span></a>            <span class="n">oldest_timestamp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="k">if</span> <span class="n">timestamps</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-1108"><a href="#AgentMemoryManager-1108"><span class="linenos">1108</span></a>            <span class="n">newest_timestamp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="k">if</span> <span class="n">timestamps</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-1109"><a href="#AgentMemoryManager-1109"><span class="linenos">1109</span></a>
</span><span id="AgentMemoryManager-1110"><a href="#AgentMemoryManager-1110"><span class="linenos">1110</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager-1111"><a href="#AgentMemoryManager-1111"><span class="linenos">1111</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;📊 MEMORY STATISTICS</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1112"><a href="#AgentMemoryManager-1112"><span class="linenos">1112</span></a>            <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Total memories: </span><span class="si">{</span><span class="n">total_memories</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1113"><a href="#AgentMemoryManager-1113"><span class="linenos">1113</span></a>            <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Average memory length: </span><span class="si">{</span><span class="n">avg_length</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> characters</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1114"><a href="#AgentMemoryManager-1114"><span class="linenos">1114</span></a>
</span><span id="AgentMemoryManager-1115"><a href="#AgentMemoryManager-1115"><span class="linenos">1115</span></a>            <span class="k">if</span> <span class="n">oldest_timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1116"><a href="#AgentMemoryManager-1116"><span class="linenos">1116</span></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager-1117"><a href="#AgentMemoryManager-1117"><span class="linenos">1117</span></a>
</span><span id="AgentMemoryManager-1118"><a href="#AgentMemoryManager-1118"><span class="linenos">1118</span></a>                <span class="n">oldest_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">oldest_timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1119"><a href="#AgentMemoryManager-1119"><span class="linenos">1119</span></a>                    <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
</span><span id="AgentMemoryManager-1120"><a href="#AgentMemoryManager-1120"><span class="linenos">1120</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-1121"><a href="#AgentMemoryManager-1121"><span class="linenos">1121</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Oldest memory: </span><span class="si">{</span><span class="n">oldest_date</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1122"><a href="#AgentMemoryManager-1122"><span class="linenos">1122</span></a>
</span><span id="AgentMemoryManager-1123"><a href="#AgentMemoryManager-1123"><span class="linenos">1123</span></a>            <span class="k">if</span> <span class="n">newest_timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1124"><a href="#AgentMemoryManager-1124"><span class="linenos">1124</span></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager-1125"><a href="#AgentMemoryManager-1125"><span class="linenos">1125</span></a>
</span><span id="AgentMemoryManager-1126"><a href="#AgentMemoryManager-1126"><span class="linenos">1126</span></a>                <span class="n">newest_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">newest_timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1127"><a href="#AgentMemoryManager-1127"><span class="linenos">1127</span></a>                    <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
</span><span id="AgentMemoryManager-1128"><a href="#AgentMemoryManager-1128"><span class="linenos">1128</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-1129"><a href="#AgentMemoryManager-1129"><span class="linenos">1129</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Newest memory: </span><span class="si">{</span><span class="n">newest_date</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1130"><a href="#AgentMemoryManager-1130"><span class="linenos">1130</span></a>
</span><span id="AgentMemoryManager-1131"><a href="#AgentMemoryManager-1131"><span class="linenos">1131</span></a>            <span class="k">if</span> <span class="n">sorted_topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1132"><a href="#AgentMemoryManager-1132"><span class="linenos">1132</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top topics:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1133"><a href="#AgentMemoryManager-1133"><span class="linenos">1133</span></a>                <span class="c1"># Show top 10 topics</span>
</span><span id="AgentMemoryManager-1134"><a href="#AgentMemoryManager-1134"><span class="linenos">1134</span></a>                <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">sorted_topics</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
</span><span id="AgentMemoryManager-1135"><a href="#AgentMemoryManager-1135"><span class="linenos">1135</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> memories</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1136"><a href="#AgentMemoryManager-1136"><span class="linenos">1136</span></a>
</span><span id="AgentMemoryManager-1137"><a href="#AgentMemoryManager-1137"><span class="linenos">1137</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_topics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1138"><a href="#AgentMemoryManager-1138"><span class="linenos">1138</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_topics</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more topics</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1139"><a href="#AgentMemoryManager-1139"><span class="linenos">1139</span></a>
</span><span id="AgentMemoryManager-1140"><a href="#AgentMemoryManager-1140"><span class="linenos">1140</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generated memory statistics for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1141"><a href="#AgentMemoryManager-1141"><span class="linenos">1141</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-1142"><a href="#AgentMemoryManager-1142"><span class="linenos">1142</span></a>
</span><span id="AgentMemoryManager-1143"><a href="#AgentMemoryManager-1143"><span class="linenos">1143</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1144"><a href="#AgentMemoryManager-1144"><span class="linenos">1144</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving memory statistics: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1145"><a href="#AgentMemoryManager-1145"><span class="linenos">1145</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving memory statistics: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1146"><a href="#AgentMemoryManager-1146"><span class="linenos">1146</span></a>
</span><span id="AgentMemoryManager-1147"><a href="#AgentMemoryManager-1147"><span class="linenos">1147</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memories_by_topic</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1148"><a href="#AgentMemoryManager-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager-1149"><a href="#AgentMemoryManager-1149"><span class="linenos">1149</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1150"><a href="#AgentMemoryManager-1150"><span class="linenos">1150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get memories by topic without similarity search, using enhanced SemanticMemoryManager.</span>
</span><span id="AgentMemoryManager-1151"><a href="#AgentMemoryManager-1151"><span class="linenos">1151</span></a>
</span><span id="AgentMemoryManager-1152"><a href="#AgentMemoryManager-1152"><span class="linenos">1152</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-1153"><a href="#AgentMemoryManager-1153"><span class="linenos">1153</span></a><span class="sd">            topics: Topic or list of topics to filter memories by</span>
</span><span id="AgentMemoryManager-1154"><a href="#AgentMemoryManager-1154"><span class="linenos">1154</span></a><span class="sd">            limit: Maximum number of memories to return</span>
</span><span id="AgentMemoryManager-1155"><a href="#AgentMemoryManager-1155"><span class="linenos">1155</span></a>
</span><span id="AgentMemoryManager-1156"><a href="#AgentMemoryManager-1156"><span class="linenos">1156</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-1157"><a href="#AgentMemoryManager-1157"><span class="linenos">1157</span></a><span class="sd">            str: Formatted string of memories matching the topics</span>
</span><span id="AgentMemoryManager-1158"><a href="#AgentMemoryManager-1158"><span class="linenos">1158</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-1159"><a href="#AgentMemoryManager-1159"><span class="linenos">1159</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1160"><a href="#AgentMemoryManager-1160"><span class="linenos">1160</span></a>            <span class="c1"># Validate topics parameter</span>
</span><span id="AgentMemoryManager-1161"><a href="#AgentMemoryManager-1161"><span class="linenos">1161</span></a>            <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1162"><a href="#AgentMemoryManager-1162"><span class="linenos">1162</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No topics provided to get_memories_by_topic&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1163"><a href="#AgentMemoryManager-1163"><span class="linenos">1163</span></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="AgentMemoryManager-1164"><a href="#AgentMemoryManager-1164"><span class="linenos">1164</span></a>                    <span class="s2">&quot;❌ Error: No topics provided. Please specify at least one topic.&quot;</span>
</span><span id="AgentMemoryManager-1165"><a href="#AgentMemoryManager-1165"><span class="linenos">1165</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-1166"><a href="#AgentMemoryManager-1166"><span class="linenos">1166</span></a>
</span><span id="AgentMemoryManager-1167"><a href="#AgentMemoryManager-1167"><span class="linenos">1167</span></a>            <span class="c1"># Parse topics parameter</span>
</span><span id="AgentMemoryManager-1168"><a href="#AgentMemoryManager-1168"><span class="linenos">1168</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1169"><a href="#AgentMemoryManager-1169"><span class="linenos">1169</span></a>                <span class="c1"># Convert string to list, handle comma-separated values</span>
</span><span id="AgentMemoryManager-1170"><a href="#AgentMemoryManager-1170"><span class="linenos">1170</span></a>                <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1171"><a href="#AgentMemoryManager-1171"><span class="linenos">1171</span></a>                    <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager-1172"><a href="#AgentMemoryManager-1172"><span class="linenos">1172</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1173"><a href="#AgentMemoryManager-1173"><span class="linenos">1173</span></a>                    <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-1174"><a href="#AgentMemoryManager-1174"><span class="linenos">1174</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1175"><a href="#AgentMemoryManager-1175"><span class="linenos">1175</span></a>                <span class="c1"># Clean up list - remove empty entries</span>
</span><span id="AgentMemoryManager-1176"><a href="#AgentMemoryManager-1176"><span class="linenos">1176</span></a>                <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager-1177"><a href="#AgentMemoryManager-1177"><span class="linenos">1177</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1178"><a href="#AgentMemoryManager-1178"><span class="linenos">1178</span></a>                <span class="c1"># Convert anything else to string and put in list</span>
</span><span id="AgentMemoryManager-1179"><a href="#AgentMemoryManager-1179"><span class="linenos">1179</span></a>                <span class="n">topic_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="AgentMemoryManager-1180"><a href="#AgentMemoryManager-1180"><span class="linenos">1180</span></a>                <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_str</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic_str</span> <span class="ow">and</span> <span class="n">topic_str</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-1181"><a href="#AgentMemoryManager-1181"><span class="linenos">1181</span></a>
</span><span id="AgentMemoryManager-1182"><a href="#AgentMemoryManager-1182"><span class="linenos">1182</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">topic_list</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1183"><a href="#AgentMemoryManager-1183"><span class="linenos">1183</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid topics provided after parsing&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1184"><a href="#AgentMemoryManager-1184"><span class="linenos">1184</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Error: No valid topics provided. Please specify at least one topic.&quot;</span>
</span><span id="AgentMemoryManager-1185"><a href="#AgentMemoryManager-1185"><span class="linenos">1185</span></a>
</span><span id="AgentMemoryManager-1186"><a href="#AgentMemoryManager-1186"><span class="linenos">1186</span></a>            <span class="c1"># ENHANCED: Use the SemanticMemoryManager&#39;s enhanced get_memories_by_topic method</span>
</span><span id="AgentMemoryManager-1187"><a href="#AgentMemoryManager-1187"><span class="linenos">1187</span></a>            <span class="c1"># This method includes topic classifier integration for query expansion</span>
</span><span id="AgentMemoryManager-1188"><a href="#AgentMemoryManager-1188"><span class="linenos">1188</span></a>            <span class="n">filtered_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_memories_by_topic</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1189"><a href="#AgentMemoryManager-1189"><span class="linenos">1189</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1190"><a href="#AgentMemoryManager-1190"><span class="linenos">1190</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1191"><a href="#AgentMemoryManager-1191"><span class="linenos">1191</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topic_list</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1192"><a href="#AgentMemoryManager-1192"><span class="linenos">1192</span></a>                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1193"><a href="#AgentMemoryManager-1193"><span class="linenos">1193</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1194"><a href="#AgentMemoryManager-1194"><span class="linenos">1194</span></a>
</span><span id="AgentMemoryManager-1195"><a href="#AgentMemoryManager-1195"><span class="linenos">1195</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1196"><a href="#AgentMemoryManager-1196"><span class="linenos">1196</span></a>                <span class="n">topics_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topic_list</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1197"><a href="#AgentMemoryManager-1197"><span class="linenos">1197</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for topics: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">topics_str</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1198"><a href="#AgentMemoryManager-1198"><span class="linenos">1198</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🔍 No memories found for topics: </span><span class="si">{</span><span class="n">topics_str</span><span class="si">}</span><span class="s2">. Try different topics or store new memories with these topics.&quot;</span>
</span><span id="AgentMemoryManager-1199"><a href="#AgentMemoryManager-1199"><span class="linenos">1199</span></a>
</span><span id="AgentMemoryManager-1200"><a href="#AgentMemoryManager-1200"><span class="linenos">1200</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager-1201"><a href="#AgentMemoryManager-1201"><span class="linenos">1201</span></a>            <span class="n">topics_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topic_list</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1202"><a href="#AgentMemoryManager-1202"><span class="linenos">1202</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🧠 MEMORIES BY TOPIC: </span><span class="si">{</span><span class="n">topics_str</span><span class="si">}</span><span class="s2"> (showing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> matching memories)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1203"><a href="#AgentMemoryManager-1203"><span class="linenos">1203</span></a>
</span><span id="AgentMemoryManager-1204"><a href="#AgentMemoryManager-1204"><span class="linenos">1204</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filtered_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1205"><a href="#AgentMemoryManager-1205"><span class="linenos">1205</span></a>                <span class="c1"># Format the memory content</span>
</span><span id="AgentMemoryManager-1206"><a href="#AgentMemoryManager-1206"><span class="linenos">1206</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1207"><a href="#AgentMemoryManager-1207"><span class="linenos">1207</span></a>
</span><span id="AgentMemoryManager-1208"><a href="#AgentMemoryManager-1208"><span class="linenos">1208</span></a>                <span class="c1"># Add topics if available</span>
</span><span id="AgentMemoryManager-1209"><a href="#AgentMemoryManager-1209"><span class="linenos">1209</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1210"><a href="#AgentMemoryManager-1210"><span class="linenos">1210</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1211"><a href="#AgentMemoryManager-1211"><span class="linenos">1211</span></a>
</span><span id="AgentMemoryManager-1212"><a href="#AgentMemoryManager-1212"><span class="linenos">1212</span></a>                <span class="c1"># Add timestamp if available</span>
</span><span id="AgentMemoryManager-1213"><a href="#AgentMemoryManager-1213"><span class="linenos">1213</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1214"><a href="#AgentMemoryManager-1214"><span class="linenos">1214</span></a>                    <span class="c1"># Convert timestamp to readable format</span>
</span><span id="AgentMemoryManager-1215"><a href="#AgentMemoryManager-1215"><span class="linenos">1215</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager-1216"><a href="#AgentMemoryManager-1216"><span class="linenos">1216</span></a>
</span><span id="AgentMemoryManager-1217"><a href="#AgentMemoryManager-1217"><span class="linenos">1217</span></a>                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1218"><a href="#AgentMemoryManager-1218"><span class="linenos">1218</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Created: </span><span class="si">{</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1219"><a href="#AgentMemoryManager-1219"><span class="linenos">1219</span></a>
</span><span id="AgentMemoryManager-1220"><a href="#AgentMemoryManager-1220"><span class="linenos">1220</span></a>                <span class="c1"># Add memory ID for reference</span>
</span><span id="AgentMemoryManager-1221"><a href="#AgentMemoryManager-1221"><span class="linenos">1221</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   ID: </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1222"><a href="#AgentMemoryManager-1222"><span class="linenos">1222</span></a>
</span><span id="AgentMemoryManager-1223"><a href="#AgentMemoryManager-1223"><span class="linenos">1223</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1224"><a href="#AgentMemoryManager-1224"><span class="linenos">1224</span></a>                <span class="s2">&quot;Retrieved </span><span class="si">%d</span><span class="s2"> memories for topics </span><span class="si">%s</span><span class="s2"> using enhanced SemanticMemoryManager&quot;</span><span class="p">,</span> 
</span><span id="AgentMemoryManager-1225"><a href="#AgentMemoryManager-1225"><span class="linenos">1225</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">filtered_memories</span><span class="p">),</span> <span class="n">topics_str</span>
</span><span id="AgentMemoryManager-1226"><a href="#AgentMemoryManager-1226"><span class="linenos">1226</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1227"><a href="#AgentMemoryManager-1227"><span class="linenos">1227</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-1228"><a href="#AgentMemoryManager-1228"><span class="linenos">1228</span></a>
</span><span id="AgentMemoryManager-1229"><a href="#AgentMemoryManager-1229"><span class="linenos">1229</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1230"><a href="#AgentMemoryManager-1230"><span class="linenos">1230</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving memories by topic: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1231"><a href="#AgentMemoryManager-1231"><span class="linenos">1231</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving memories by topic: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1232"><a href="#AgentMemoryManager-1232"><span class="linenos">1232</span></a>
</span><span id="AgentMemoryManager-1233"><a href="#AgentMemoryManager-1233"><span class="linenos">1233</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1234"><a href="#AgentMemoryManager-1234"><span class="linenos">1234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all memories in a simple, user-friendly format.</span>
</span><span id="AgentMemoryManager-1235"><a href="#AgentMemoryManager-1235"><span class="linenos">1235</span></a>
</span><span id="AgentMemoryManager-1236"><a href="#AgentMemoryManager-1236"><span class="linenos">1236</span></a><span class="sd">        This method provides a more concise view of all memories compared to get_all_memories,</span>
</span><span id="AgentMemoryManager-1237"><a href="#AgentMemoryManager-1237"><span class="linenos">1237</span></a><span class="sd">        focusing on just the content and topics without additional metadata.</span>
</span><span id="AgentMemoryManager-1238"><a href="#AgentMemoryManager-1238"><span class="linenos">1238</span></a>
</span><span id="AgentMemoryManager-1239"><a href="#AgentMemoryManager-1239"><span class="linenos">1239</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-1240"><a href="#AgentMemoryManager-1240"><span class="linenos">1240</span></a><span class="sd">            str: Simplified list of all memories</span>
</span><span id="AgentMemoryManager-1241"><a href="#AgentMemoryManager-1241"><span class="linenos">1241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-1242"><a href="#AgentMemoryManager-1242"><span class="linenos">1242</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1243"><a href="#AgentMemoryManager-1243"><span class="linenos">1243</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.get_all_memories()</span>
</span><span id="AgentMemoryManager-1244"><a href="#AgentMemoryManager-1244"><span class="linenos">1244</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1245"><a href="#AgentMemoryManager-1245"><span class="linenos">1245</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager-1246"><a href="#AgentMemoryManager-1246"><span class="linenos">1246</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1247"><a href="#AgentMemoryManager-1247"><span class="linenos">1247</span></a>
</span><span id="AgentMemoryManager-1248"><a href="#AgentMemoryManager-1248"><span class="linenos">1248</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1249"><a href="#AgentMemoryManager-1249"><span class="linenos">1249</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1250"><a href="#AgentMemoryManager-1250"><span class="linenos">1250</span></a>                <span class="k">return</span> <span class="s2">&quot;🔍 No memories found. Try storing some information first!&quot;</span>
</span><span id="AgentMemoryManager-1251"><a href="#AgentMemoryManager-1251"><span class="linenos">1251</span></a>
</span><span id="AgentMemoryManager-1252"><a href="#AgentMemoryManager-1252"><span class="linenos">1252</span></a>            <span class="c1"># Sort memories by timestamp (newest first)</span>
</span><span id="AgentMemoryManager-1253"><a href="#AgentMemoryManager-1253"><span class="linenos">1253</span></a>            <span class="n">sorted_memories</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1254"><a href="#AgentMemoryManager-1254"><span class="linenos">1254</span></a>                <span class="n">memories</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1255"><a href="#AgentMemoryManager-1255"><span class="linenos">1255</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1256"><a href="#AgentMemoryManager-1256"><span class="linenos">1256</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1257"><a href="#AgentMemoryManager-1257"><span class="linenos">1257</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1258"><a href="#AgentMemoryManager-1258"><span class="linenos">1258</span></a>
</span><span id="AgentMemoryManager-1259"><a href="#AgentMemoryManager-1259"><span class="linenos">1259</span></a>            <span class="c1"># Format results in a simplified way</span>
</span><span id="AgentMemoryManager-1260"><a href="#AgentMemoryManager-1260"><span class="linenos">1260</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;📝 MEMORY LIST (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> total):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1261"><a href="#AgentMemoryManager-1261"><span class="linenos">1261</span></a>
</span><span id="AgentMemoryManager-1262"><a href="#AgentMemoryManager-1262"><span class="linenos">1262</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1263"><a href="#AgentMemoryManager-1263"><span class="linenos">1263</span></a>                <span class="c1"># Just show the memory content and topics, omit other metadata</span>
</span><span id="AgentMemoryManager-1264"><a href="#AgentMemoryManager-1264"><span class="linenos">1264</span></a>                <span class="n">memory_preview</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgentMemoryManager-1265"><a href="#AgentMemoryManager-1265"><span class="linenos">1265</span></a>                    <span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
</span><span id="AgentMemoryManager-1266"><a href="#AgentMemoryManager-1266"><span class="linenos">1266</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span>
</span><span id="AgentMemoryManager-1267"><a href="#AgentMemoryManager-1267"><span class="linenos">1267</span></a>                    <span class="k">else</span> <span class="n">memory</span><span class="o">.</span><span class="n">memory</span>
</span><span id="AgentMemoryManager-1268"><a href="#AgentMemoryManager-1268"><span class="linenos">1268</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-1269"><a href="#AgentMemoryManager-1269"><span class="linenos">1269</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory_preview</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1270"><a href="#AgentMemoryManager-1270"><span class="linenos">1270</span></a>
</span><span id="AgentMemoryManager-1271"><a href="#AgentMemoryManager-1271"><span class="linenos">1271</span></a>                <span class="c1"># Add topics if available</span>
</span><span id="AgentMemoryManager-1272"><a href="#AgentMemoryManager-1272"><span class="linenos">1272</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1273"><a href="#AgentMemoryManager-1273"><span class="linenos">1273</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1274"><a href="#AgentMemoryManager-1274"><span class="linenos">1274</span></a>
</span><span id="AgentMemoryManager-1275"><a href="#AgentMemoryManager-1275"><span class="linenos">1275</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1276"><a href="#AgentMemoryManager-1276"><span class="linenos">1276</span></a>
</span><span id="AgentMemoryManager-1277"><a href="#AgentMemoryManager-1277"><span class="linenos">1277</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1278"><a href="#AgentMemoryManager-1278"><span class="linenos">1278</span></a>                <span class="s2">&quot;Listed all </span><span class="si">%d</span><span class="s2"> memories for user </span><span class="si">%s</span><span class="s2"> in simplified format&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1279"><a href="#AgentMemoryManager-1279"><span class="linenos">1279</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">),</span>
</span><span id="AgentMemoryManager-1280"><a href="#AgentMemoryManager-1280"><span class="linenos">1280</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1281"><a href="#AgentMemoryManager-1281"><span class="linenos">1281</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager-1282"><a href="#AgentMemoryManager-1282"><span class="linenos">1282</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-1283"><a href="#AgentMemoryManager-1283"><span class="linenos">1283</span></a>
</span><span id="AgentMemoryManager-1284"><a href="#AgentMemoryManager-1284"><span class="linenos">1284</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1285"><a href="#AgentMemoryManager-1285"><span class="linenos">1285</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error listing memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1286"><a href="#AgentMemoryManager-1286"><span class="linenos">1286</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error listing memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1287"><a href="#AgentMemoryManager-1287"><span class="linenos">1287</span></a>
</span><span id="AgentMemoryManager-1288"><a href="#AgentMemoryManager-1288"><span class="linenos">1288</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_graph_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1289"><a href="#AgentMemoryManager-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1290"><a href="#AgentMemoryManager-1290"><span class="linenos">1290</span></a>        <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1291"><a href="#AgentMemoryManager-1291"><span class="linenos">1291</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1292"><a href="#AgentMemoryManager-1292"><span class="linenos">1292</span></a>        <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1293"><a href="#AgentMemoryManager-1293"><span class="linenos">1293</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1294"><a href="#AgentMemoryManager-1294"><span class="linenos">1294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store a memory in the LightRAG graph database to capture relationships.</span>
</span><span id="AgentMemoryManager-1295"><a href="#AgentMemoryManager-1295"><span class="linenos">1295</span></a>
</span><span id="AgentMemoryManager-1296"><a href="#AgentMemoryManager-1296"><span class="linenos">1296</span></a><span class="sd">        This method creates a text file with the memory content and uploads it to the LightRAG</span>
</span><span id="AgentMemoryManager-1297"><a href="#AgentMemoryManager-1297"><span class="linenos">1297</span></a><span class="sd">        memory server, which then processes it to extract entities and relationships.</span>
</span><span id="AgentMemoryManager-1298"><a href="#AgentMemoryManager-1298"><span class="linenos">1298</span></a>
</span><span id="AgentMemoryManager-1299"><a href="#AgentMemoryManager-1299"><span class="linenos">1299</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-1300"><a href="#AgentMemoryManager-1300"><span class="linenos">1300</span></a><span class="sd">            content: The memory content to store</span>
</span><span id="AgentMemoryManager-1301"><a href="#AgentMemoryManager-1301"><span class="linenos">1301</span></a><span class="sd">            topics: Optional list of topics/categories for the memory</span>
</span><span id="AgentMemoryManager-1302"><a href="#AgentMemoryManager-1302"><span class="linenos">1302</span></a><span class="sd">            memory_id: Optional memory ID to link with the SQLite memory</span>
</span><span id="AgentMemoryManager-1303"><a href="#AgentMemoryManager-1303"><span class="linenos">1303</span></a>
</span><span id="AgentMemoryManager-1304"><a href="#AgentMemoryManager-1304"><span class="linenos">1304</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-1305"><a href="#AgentMemoryManager-1305"><span class="linenos">1305</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgentMemoryManager-1306"><a href="#AgentMemoryManager-1306"><span class="linenos">1306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-1307"><a href="#AgentMemoryManager-1307"><span class="linenos">1307</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1308"><a href="#AgentMemoryManager-1308"><span class="linenos">1308</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1309"><a href="#AgentMemoryManager-1309"><span class="linenos">1309</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;LightRAG memory URL not configured&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1310"><a href="#AgentMemoryManager-1310"><span class="linenos">1310</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Graph memory not configured. Memory not stored in graph database.&quot;</span>
</span><span id="AgentMemoryManager-1311"><a href="#AgentMemoryManager-1311"><span class="linenos">1311</span></a>
</span><span id="AgentMemoryManager-1312"><a href="#AgentMemoryManager-1312"><span class="linenos">1312</span></a>            <span class="c1"># Validate content</span>
</span><span id="AgentMemoryManager-1313"><a href="#AgentMemoryManager-1313"><span class="linenos">1313</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="AgentMemoryManager-1314"><a href="#AgentMemoryManager-1314"><span class="linenos">1314</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Empty content provided to store_graph_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1315"><a href="#AgentMemoryManager-1315"><span class="linenos">1315</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Error: Content cannot be empty.&quot;</span>
</span><span id="AgentMemoryManager-1316"><a href="#AgentMemoryManager-1316"><span class="linenos">1316</span></a>
</span><span id="AgentMemoryManager-1317"><a href="#AgentMemoryManager-1317"><span class="linenos">1317</span></a>            <span class="c1"># Parse topics parameter</span>
</span><span id="AgentMemoryManager-1318"><a href="#AgentMemoryManager-1318"><span class="linenos">1318</span></a>            <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-1319"><a href="#AgentMemoryManager-1319"><span class="linenos">1319</span></a>            <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1320"><a href="#AgentMemoryManager-1320"><span class="linenos">1320</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1321"><a href="#AgentMemoryManager-1321"><span class="linenos">1321</span></a>                    <span class="c1"># Convert string to list, handle comma-separated values</span>
</span><span id="AgentMemoryManager-1322"><a href="#AgentMemoryManager-1322"><span class="linenos">1322</span></a>                    <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1323"><a href="#AgentMemoryManager-1323"><span class="linenos">1323</span></a>                        <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager-1324"><a href="#AgentMemoryManager-1324"><span class="linenos">1324</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1325"><a href="#AgentMemoryManager-1325"><span class="linenos">1325</span></a>                        <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-1326"><a href="#AgentMemoryManager-1326"><span class="linenos">1326</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1327"><a href="#AgentMemoryManager-1327"><span class="linenos">1327</span></a>                    <span class="c1"># Clean up list - remove empty entries</span>
</span><span id="AgentMemoryManager-1328"><a href="#AgentMemoryManager-1328"><span class="linenos">1328</span></a>                    <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager-1329"><a href="#AgentMemoryManager-1329"><span class="linenos">1329</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1330"><a href="#AgentMemoryManager-1330"><span class="linenos">1330</span></a>                    <span class="c1"># Convert anything else to string and put in list</span>
</span><span id="AgentMemoryManager-1331"><a href="#AgentMemoryManager-1331"><span class="linenos">1331</span></a>                    <span class="n">topic_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="AgentMemoryManager-1332"><a href="#AgentMemoryManager-1332"><span class="linenos">1332</span></a>                    <span class="n">topic_list</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgentMemoryManager-1333"><a href="#AgentMemoryManager-1333"><span class="linenos">1333</span></a>                        <span class="p">[</span><span class="n">topic_str</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic_str</span> <span class="ow">and</span> <span class="n">topic_str</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-1334"><a href="#AgentMemoryManager-1334"><span class="linenos">1334</span></a>                    <span class="p">)</span>
</span><span id="AgentMemoryManager-1335"><a href="#AgentMemoryManager-1335"><span class="linenos">1335</span></a>
</span><span id="AgentMemoryManager-1336"><a href="#AgentMemoryManager-1336"><span class="linenos">1336</span></a>            <span class="c1"># Create a unique filename for this memory</span>
</span><span id="AgentMemoryManager-1337"><a href="#AgentMemoryManager-1337"><span class="linenos">1337</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="AgentMemoryManager-1338"><a href="#AgentMemoryManager-1338"><span class="linenos">1338</span></a>            <span class="n">memory_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="AgentMemoryManager-1339"><a href="#AgentMemoryManager-1339"><span class="linenos">1339</span></a>
</span><span id="AgentMemoryManager-1340"><a href="#AgentMemoryManager-1340"><span class="linenos">1340</span></a>            <span class="c1"># If memory_id is provided, use it in the filename for traceability</span>
</span><span id="AgentMemoryManager-1341"><a href="#AgentMemoryManager-1341"><span class="linenos">1341</span></a>            <span class="k">if</span> <span class="n">memory_id</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1342"><a href="#AgentMemoryManager-1342"><span class="linenos">1342</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;memory_</span><span class="si">{</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">memory_hash</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="AgentMemoryManager-1343"><a href="#AgentMemoryManager-1343"><span class="linenos">1343</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1344"><a href="#AgentMemoryManager-1344"><span class="linenos">1344</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;memory_</span><span class="si">{</span><span class="n">memory_hash</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="AgentMemoryManager-1345"><a href="#AgentMemoryManager-1345"><span class="linenos">1345</span></a>
</span><span id="AgentMemoryManager-1346"><a href="#AgentMemoryManager-1346"><span class="linenos">1346</span></a>            <span class="c1"># Prepare the content with metadata</span>
</span><span id="AgentMemoryManager-1347"><a href="#AgentMemoryManager-1347"><span class="linenos">1347</span></a>            <span class="n">file_content</span> <span class="o">=</span> <span class="n">content</span>
</span><span id="AgentMemoryManager-1348"><a href="#AgentMemoryManager-1348"><span class="linenos">1348</span></a>
</span><span id="AgentMemoryManager-1349"><a href="#AgentMemoryManager-1349"><span class="linenos">1349</span></a>            <span class="c1"># Add topics as metadata if available</span>
</span><span id="AgentMemoryManager-1350"><a href="#AgentMemoryManager-1350"><span class="linenos">1350</span></a>            <span class="k">if</span> <span class="n">topic_list</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1351"><a href="#AgentMemoryManager-1351"><span class="linenos">1351</span></a>                <span class="n">file_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topic_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1352"><a href="#AgentMemoryManager-1352"><span class="linenos">1352</span></a>
</span><span id="AgentMemoryManager-1353"><a href="#AgentMemoryManager-1353"><span class="linenos">1353</span></a>            <span class="c1"># Create a temporary file</span>
</span><span id="AgentMemoryManager-1354"><a href="#AgentMemoryManager-1354"><span class="linenos">1354</span></a>            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1355"><a href="#AgentMemoryManager-1355"><span class="linenos">1355</span></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span>
</span><span id="AgentMemoryManager-1356"><a href="#AgentMemoryManager-1356"><span class="linenos">1356</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">temp_file</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1357"><a href="#AgentMemoryManager-1357"><span class="linenos">1357</span></a>                <span class="n">temp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1358"><a href="#AgentMemoryManager-1358"><span class="linenos">1358</span></a>                <span class="n">temp_file_path</span> <span class="o">=</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="AgentMemoryManager-1359"><a href="#AgentMemoryManager-1359"><span class="linenos">1359</span></a>
</span><span id="AgentMemoryManager-1360"><a href="#AgentMemoryManager-1360"><span class="linenos">1360</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1361"><a href="#AgentMemoryManager-1361"><span class="linenos">1361</span></a>                <span class="c1"># Upload the file using the /documents/upload endpoint</span>
</span><span id="AgentMemoryManager-1362"><a href="#AgentMemoryManager-1362"><span class="linenos">1362</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents/upload&quot;</span>
</span><span id="AgentMemoryManager-1363"><a href="#AgentMemoryManager-1363"><span class="linenos">1363</span></a>
</span><span id="AgentMemoryManager-1364"><a href="#AgentMemoryManager-1364"><span class="linenos">1364</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1365"><a href="#AgentMemoryManager-1365"><span class="linenos">1365</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1366"><a href="#AgentMemoryManager-1366"><span class="linenos">1366</span></a>                        <span class="c1"># Create form data for file upload</span>
</span><span id="AgentMemoryManager-1367"><a href="#AgentMemoryManager-1367"><span class="linenos">1367</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">FormData</span><span class="p">()</span>
</span><span id="AgentMemoryManager-1368"><a href="#AgentMemoryManager-1368"><span class="linenos">1368</span></a>                        <span class="n">data</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1369"><a href="#AgentMemoryManager-1369"><span class="linenos">1369</span></a>                            <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span>
</span><span id="AgentMemoryManager-1370"><a href="#AgentMemoryManager-1370"><span class="linenos">1370</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager-1371"><a href="#AgentMemoryManager-1371"><span class="linenos">1371</span></a>
</span><span id="AgentMemoryManager-1372"><a href="#AgentMemoryManager-1372"><span class="linenos">1372</span></a>                        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1373"><a href="#AgentMemoryManager-1373"><span class="linenos">1373</span></a>                            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
</span><span id="AgentMemoryManager-1374"><a href="#AgentMemoryManager-1374"><span class="linenos">1374</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1375"><a href="#AgentMemoryManager-1375"><span class="linenos">1375</span></a>                                    <span class="s2">&quot;Successfully stored memory in graph database: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1376"><a href="#AgentMemoryManager-1376"><span class="linenos">1376</span></a>                                    <span class="n">filename</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1377"><a href="#AgentMemoryManager-1377"><span class="linenos">1377</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-1378"><a href="#AgentMemoryManager-1378"><span class="linenos">1378</span></a>                                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ Memory successfully stored in graph database: </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="AgentMemoryManager-1379"><a href="#AgentMemoryManager-1379"><span class="linenos">1379</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1380"><a href="#AgentMemoryManager-1380"><span class="linenos">1380</span></a>                                <span class="n">error_detail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager-1381"><a href="#AgentMemoryManager-1381"><span class="linenos">1381</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1382"><a href="#AgentMemoryManager-1382"><span class="linenos">1382</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Failed to store memory in graph: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1383"><a href="#AgentMemoryManager-1383"><span class="linenos">1383</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-1384"><a href="#AgentMemoryManager-1384"><span class="linenos">1384</span></a>                                <span class="k">return</span> <span class="p">(</span>
</span><span id="AgentMemoryManager-1385"><a href="#AgentMemoryManager-1385"><span class="linenos">1385</span></a>                                    <span class="sa">f</span><span class="s2">&quot;❌ Error storing memory in graph: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1386"><a href="#AgentMemoryManager-1386"><span class="linenos">1386</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager-1387"><a href="#AgentMemoryManager-1387"><span class="linenos">1387</span></a>
</span><span id="AgentMemoryManager-1388"><a href="#AgentMemoryManager-1388"><span class="linenos">1388</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1389"><a href="#AgentMemoryManager-1389"><span class="linenos">1389</span></a>                <span class="c1"># Clean up the temporary file</span>
</span><span id="AgentMemoryManager-1390"><a href="#AgentMemoryManager-1390"><span class="linenos">1390</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1391"><a href="#AgentMemoryManager-1391"><span class="linenos">1391</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1392"><a href="#AgentMemoryManager-1392"><span class="linenos">1392</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1393"><a href="#AgentMemoryManager-1393"><span class="linenos">1393</span></a>                    <span class="k">pass</span>  <span class="c1"># Ignore cleanup errors</span>
</span><span id="AgentMemoryManager-1394"><a href="#AgentMemoryManager-1394"><span class="linenos">1394</span></a>
</span><span id="AgentMemoryManager-1395"><a href="#AgentMemoryManager-1395"><span class="linenos">1395</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1396"><a href="#AgentMemoryManager-1396"><span class="linenos">1396</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error storing memory in graph: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1397"><a href="#AgentMemoryManager-1397"><span class="linenos">1397</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error storing memory in graph: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1398"><a href="#AgentMemoryManager-1398"><span class="linenos">1398</span></a>
</span><span id="AgentMemoryManager-1399"><a href="#AgentMemoryManager-1399"><span class="linenos">1399</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_graph_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1400"><a href="#AgentMemoryManager-1400"><span class="linenos">1400</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1401"><a href="#AgentMemoryManager-1401"><span class="linenos">1401</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1402"><a href="#AgentMemoryManager-1402"><span class="linenos">1402</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mix&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1403"><a href="#AgentMemoryManager-1403"><span class="linenos">1403</span></a>        <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1404"><a href="#AgentMemoryManager-1404"><span class="linenos">1404</span></a>        <span class="n">response_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1405"><a href="#AgentMemoryManager-1405"><span class="linenos">1405</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1406"><a href="#AgentMemoryManager-1406"><span class="linenos">1406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the LightRAG memory graph to explore relationships between memories.</span>
</span><span id="AgentMemoryManager-1407"><a href="#AgentMemoryManager-1407"><span class="linenos">1407</span></a>
</span><span id="AgentMemoryManager-1408"><a href="#AgentMemoryManager-1408"><span class="linenos">1408</span></a><span class="sd">        This method sends a query to the LightRAG memory server to retrieve memories and their</span>
</span><span id="AgentMemoryManager-1409"><a href="#AgentMemoryManager-1409"><span class="linenos">1409</span></a><span class="sd">        relationships based on the query. It supports different query modes and response formats.</span>
</span><span id="AgentMemoryManager-1410"><a href="#AgentMemoryManager-1410"><span class="linenos">1410</span></a>
</span><span id="AgentMemoryManager-1411"><a href="#AgentMemoryManager-1411"><span class="linenos">1411</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager-1412"><a href="#AgentMemoryManager-1412"><span class="linenos">1412</span></a><span class="sd">            query: The query to search for in the memory graph</span>
</span><span id="AgentMemoryManager-1413"><a href="#AgentMemoryManager-1413"><span class="linenos">1413</span></a><span class="sd">            mode: Query mode - &quot;semantic&quot; (vector search), &quot;graph&quot; (graph traversal), or &quot;mix&quot; (combined)</span>
</span><span id="AgentMemoryManager-1414"><a href="#AgentMemoryManager-1414"><span class="linenos">1414</span></a><span class="sd">            top_k: Maximum number of results to return</span>
</span><span id="AgentMemoryManager-1415"><a href="#AgentMemoryManager-1415"><span class="linenos">1415</span></a><span class="sd">            response_type: Format of the response - &quot;Multiple Paragraphs&quot;, &quot;Single Paragraph&quot;, etc.</span>
</span><span id="AgentMemoryManager-1416"><a href="#AgentMemoryManager-1416"><span class="linenos">1416</span></a>
</span><span id="AgentMemoryManager-1417"><a href="#AgentMemoryManager-1417"><span class="linenos">1417</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-1418"><a href="#AgentMemoryManager-1418"><span class="linenos">1418</span></a><span class="sd">            dict: Query results with memories and their relationships</span>
</span><span id="AgentMemoryManager-1419"><a href="#AgentMemoryManager-1419"><span class="linenos">1419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-1420"><a href="#AgentMemoryManager-1420"><span class="linenos">1420</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1421"><a href="#AgentMemoryManager-1421"><span class="linenos">1421</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1422"><a href="#AgentMemoryManager-1422"><span class="linenos">1422</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;LightRAG memory URL not configured&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1423"><a href="#AgentMemoryManager-1423"><span class="linenos">1423</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentMemoryManager-1424"><a href="#AgentMemoryManager-1424"><span class="linenos">1424</span></a>                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Graph memory not configured. Cannot query graph database.&quot;</span>
</span><span id="AgentMemoryManager-1425"><a href="#AgentMemoryManager-1425"><span class="linenos">1425</span></a>                <span class="p">}</span>
</span><span id="AgentMemoryManager-1426"><a href="#AgentMemoryManager-1426"><span class="linenos">1426</span></a>
</span><span id="AgentMemoryManager-1427"><a href="#AgentMemoryManager-1427"><span class="linenos">1427</span></a>            <span class="c1"># Validate query</span>
</span><span id="AgentMemoryManager-1428"><a href="#AgentMemoryManager-1428"><span class="linenos">1428</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="AgentMemoryManager-1429"><a href="#AgentMemoryManager-1429"><span class="linenos">1429</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Empty query provided to query_graph_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1430"><a href="#AgentMemoryManager-1430"><span class="linenos">1430</span></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Query cannot be empty. Please provide a search term.&quot;</span><span class="p">}</span>
</span><span id="AgentMemoryManager-1431"><a href="#AgentMemoryManager-1431"><span class="linenos">1431</span></a>
</span><span id="AgentMemoryManager-1432"><a href="#AgentMemoryManager-1432"><span class="linenos">1432</span></a>            <span class="c1"># Validate mode</span>
</span><span id="AgentMemoryManager-1433"><a href="#AgentMemoryManager-1433"><span class="linenos">1433</span></a>            <span class="n">valid_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;semantic&quot;</span><span class="p">,</span> <span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;mix&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-1434"><a href="#AgentMemoryManager-1434"><span class="linenos">1434</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modes</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1435"><a href="#AgentMemoryManager-1435"><span class="linenos">1435</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39; provided to query_graph_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1436"><a href="#AgentMemoryManager-1436"><span class="linenos">1436</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;mix&quot;</span>  <span class="c1"># Default to mix mode</span>
</span><span id="AgentMemoryManager-1437"><a href="#AgentMemoryManager-1437"><span class="linenos">1437</span></a>
</span><span id="AgentMemoryManager-1438"><a href="#AgentMemoryManager-1438"><span class="linenos">1438</span></a>            <span class="c1"># Validate response_type</span>
</span><span id="AgentMemoryManager-1439"><a href="#AgentMemoryManager-1439"><span class="linenos">1439</span></a>            <span class="n">valid_response_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager-1440"><a href="#AgentMemoryManager-1440"><span class="linenos">1440</span></a>                <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1441"><a href="#AgentMemoryManager-1441"><span class="linenos">1441</span></a>                <span class="s2">&quot;Single Paragraph&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1442"><a href="#AgentMemoryManager-1442"><span class="linenos">1442</span></a>                <span class="s2">&quot;Bullet Points&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1443"><a href="#AgentMemoryManager-1443"><span class="linenos">1443</span></a>                <span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1444"><a href="#AgentMemoryManager-1444"><span class="linenos">1444</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager-1445"><a href="#AgentMemoryManager-1445"><span class="linenos">1445</span></a>            <span class="k">if</span> <span class="n">response_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_response_types</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1446"><a href="#AgentMemoryManager-1446"><span class="linenos">1446</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1447"><a href="#AgentMemoryManager-1447"><span class="linenos">1447</span></a>                    <span class="sa">f</span><span class="s2">&quot;Invalid response_type &#39;</span><span class="si">{</span><span class="n">response_type</span><span class="si">}</span><span class="s2">&#39; provided to query_graph_memory&quot;</span>
</span><span id="AgentMemoryManager-1448"><a href="#AgentMemoryManager-1448"><span class="linenos">1448</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager-1449"><a href="#AgentMemoryManager-1449"><span class="linenos">1449</span></a>                <span class="n">response_type</span> <span class="o">=</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span>  <span class="c1"># Default to multiple paragraphs</span>
</span><span id="AgentMemoryManager-1450"><a href="#AgentMemoryManager-1450"><span class="linenos">1450</span></a>
</span><span id="AgentMemoryManager-1451"><a href="#AgentMemoryManager-1451"><span class="linenos">1451</span></a>            <span class="c1"># Prepare the query parameters</span>
</span><span id="AgentMemoryManager-1452"><a href="#AgentMemoryManager-1452"><span class="linenos">1452</span></a>            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentMemoryManager-1453"><a href="#AgentMemoryManager-1453"><span class="linenos">1453</span></a>                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="AgentMemoryManager-1454"><a href="#AgentMemoryManager-1454"><span class="linenos">1454</span></a>                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1455"><a href="#AgentMemoryManager-1455"><span class="linenos">1455</span></a>                <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="n">top_k</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1456"><a href="#AgentMemoryManager-1456"><span class="linenos">1456</span></a>                <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="n">response_type</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1457"><a href="#AgentMemoryManager-1457"><span class="linenos">1457</span></a>            <span class="p">}</span>
</span><span id="AgentMemoryManager-1458"><a href="#AgentMemoryManager-1458"><span class="linenos">1458</span></a>
</span><span id="AgentMemoryManager-1459"><a href="#AgentMemoryManager-1459"><span class="linenos">1459</span></a>            <span class="c1"># Send the query to the LightRAG memory server</span>
</span><span id="AgentMemoryManager-1460"><a href="#AgentMemoryManager-1460"><span class="linenos">1460</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/query&quot;</span>
</span><span id="AgentMemoryManager-1461"><a href="#AgentMemoryManager-1461"><span class="linenos">1461</span></a>
</span><span id="AgentMemoryManager-1462"><a href="#AgentMemoryManager-1462"><span class="linenos">1462</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1463"><a href="#AgentMemoryManager-1463"><span class="linenos">1463</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1464"><a href="#AgentMemoryManager-1464"><span class="linenos">1464</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1465"><a href="#AgentMemoryManager-1465"><span class="linenos">1465</span></a>                        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager-1466"><a href="#AgentMemoryManager-1466"><span class="linenos">1466</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1467"><a href="#AgentMemoryManager-1467"><span class="linenos">1467</span></a>                            <span class="sa">f</span><span class="s2">&quot;Successfully queried graph memory: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="AgentMemoryManager-1468"><a href="#AgentMemoryManager-1468"><span class="linenos">1468</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager-1469"><a href="#AgentMemoryManager-1469"><span class="linenos">1469</span></a>                        <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-1470"><a href="#AgentMemoryManager-1470"><span class="linenos">1470</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1471"><a href="#AgentMemoryManager-1471"><span class="linenos">1471</span></a>                        <span class="n">error_detail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager-1472"><a href="#AgentMemoryManager-1472"><span class="linenos">1472</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to query graph memory: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1473"><a href="#AgentMemoryManager-1473"><span class="linenos">1473</span></a>                        <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentMemoryManager-1474"><a href="#AgentMemoryManager-1474"><span class="linenos">1474</span></a>                            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Error querying graph memory: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1475"><a href="#AgentMemoryManager-1475"><span class="linenos">1475</span></a>                            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1476"><a href="#AgentMemoryManager-1476"><span class="linenos">1476</span></a>                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1477"><a href="#AgentMemoryManager-1477"><span class="linenos">1477</span></a>                        <span class="p">}</span>
</span><span id="AgentMemoryManager-1478"><a href="#AgentMemoryManager-1478"><span class="linenos">1478</span></a>
</span><span id="AgentMemoryManager-1479"><a href="#AgentMemoryManager-1479"><span class="linenos">1479</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1480"><a href="#AgentMemoryManager-1480"><span class="linenos">1480</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying graph memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1481"><a href="#AgentMemoryManager-1481"><span class="linenos">1481</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentMemoryManager-1482"><a href="#AgentMemoryManager-1482"><span class="linenos">1482</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Error querying graph memory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1483"><a href="#AgentMemoryManager-1483"><span class="linenos">1483</span></a>                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1484"><a href="#AgentMemoryManager-1484"><span class="linenos">1484</span></a>                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
</span><span id="AgentMemoryManager-1485"><a href="#AgentMemoryManager-1485"><span class="linenos">1485</span></a>            <span class="p">}</span>
</span><span id="AgentMemoryManager-1486"><a href="#AgentMemoryManager-1486"><span class="linenos">1486</span></a>
</span><span id="AgentMemoryManager-1487"><a href="#AgentMemoryManager-1487"><span class="linenos">1487</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_graph_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1488"><a href="#AgentMemoryManager-1488"><span class="linenos">1488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of all entity and relation labels from the memory graph.</span>
</span><span id="AgentMemoryManager-1489"><a href="#AgentMemoryManager-1489"><span class="linenos">1489</span></a>
</span><span id="AgentMemoryManager-1490"><a href="#AgentMemoryManager-1490"><span class="linenos">1490</span></a><span class="sd">        This method retrieves all entity and relation labels from the LightRAG memory graph,</span>
</span><span id="AgentMemoryManager-1491"><a href="#AgentMemoryManager-1491"><span class="linenos">1491</span></a><span class="sd">        providing insights into the types of information stored in the graph.</span>
</span><span id="AgentMemoryManager-1492"><a href="#AgentMemoryManager-1492"><span class="linenos">1492</span></a>
</span><span id="AgentMemoryManager-1493"><a href="#AgentMemoryManager-1493"><span class="linenos">1493</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager-1494"><a href="#AgentMemoryManager-1494"><span class="linenos">1494</span></a><span class="sd">            str: Formatted string with entity and relation labels</span>
</span><span id="AgentMemoryManager-1495"><a href="#AgentMemoryManager-1495"><span class="linenos">1495</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager-1496"><a href="#AgentMemoryManager-1496"><span class="linenos">1496</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1497"><a href="#AgentMemoryManager-1497"><span class="linenos">1497</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1498"><a href="#AgentMemoryManager-1498"><span class="linenos">1498</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;LightRAG memory URL not configured&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1499"><a href="#AgentMemoryManager-1499"><span class="linenos">1499</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Graph memory not configured. Cannot retrieve graph labels.&quot;</span>
</span><span id="AgentMemoryManager-1500"><a href="#AgentMemoryManager-1500"><span class="linenos">1500</span></a>
</span><span id="AgentMemoryManager-1501"><a href="#AgentMemoryManager-1501"><span class="linenos">1501</span></a>            <span class="c1"># Send the request to the LightRAG memory server</span>
</span><span id="AgentMemoryManager-1502"><a href="#AgentMemoryManager-1502"><span class="linenos">1502</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/label/list&quot;</span>
</span><span id="AgentMemoryManager-1503"><a href="#AgentMemoryManager-1503"><span class="linenos">1503</span></a>
</span><span id="AgentMemoryManager-1504"><a href="#AgentMemoryManager-1504"><span class="linenos">1504</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1505"><a href="#AgentMemoryManager-1505"><span class="linenos">1505</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1506"><a href="#AgentMemoryManager-1506"><span class="linenos">1506</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1507"><a href="#AgentMemoryManager-1507"><span class="linenos">1507</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager-1508"><a href="#AgentMemoryManager-1508"><span class="linenos">1508</span></a>
</span><span id="AgentMemoryManager-1509"><a href="#AgentMemoryManager-1509"><span class="linenos">1509</span></a>                        <span class="c1"># Handle different response formats</span>
</span><span id="AgentMemoryManager-1510"><a href="#AgentMemoryManager-1510"><span class="linenos">1510</span></a>                        <span class="n">entity_labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-1511"><a href="#AgentMemoryManager-1511"><span class="linenos">1511</span></a>                        <span class="n">relation_labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager-1512"><a href="#AgentMemoryManager-1512"><span class="linenos">1512</span></a>
</span><span id="AgentMemoryManager-1513"><a href="#AgentMemoryManager-1513"><span class="linenos">1513</span></a>                        <span class="c1"># Format 1: Direct array of all labels</span>
</span><span id="AgentMemoryManager-1514"><a href="#AgentMemoryManager-1514"><span class="linenos">1514</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1515"><a href="#AgentMemoryManager-1515"><span class="linenos">1515</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="AgentMemoryManager-1516"><a href="#AgentMemoryManager-1516"><span class="linenos">1516</span></a>                            <span class="c1"># We can&#39;t distinguish between entity and relation labels in this format</span>
</span><span id="AgentMemoryManager-1517"><a href="#AgentMemoryManager-1517"><span class="linenos">1517</span></a>                            <span class="n">entity_labels</span> <span class="o">=</span> <span class="n">all_labels</span>
</span><span id="AgentMemoryManager-1518"><a href="#AgentMemoryManager-1518"><span class="linenos">1518</span></a>
</span><span id="AgentMemoryManager-1519"><a href="#AgentMemoryManager-1519"><span class="linenos">1519</span></a>                        <span class="c1"># Format 2: Dict with &#39;labels&#39; key containing all labels</span>
</span><span id="AgentMemoryManager-1520"><a href="#AgentMemoryManager-1520"><span class="linenos">1520</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;labels&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1521"><a href="#AgentMemoryManager-1521"><span class="linenos">1521</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-1522"><a href="#AgentMemoryManager-1522"><span class="linenos">1522</span></a>                            <span class="c1"># We can&#39;t distinguish between entity and relation labels in this format</span>
</span><span id="AgentMemoryManager-1523"><a href="#AgentMemoryManager-1523"><span class="linenos">1523</span></a>                            <span class="n">entity_labels</span> <span class="o">=</span> <span class="n">all_labels</span>
</span><span id="AgentMemoryManager-1524"><a href="#AgentMemoryManager-1524"><span class="linenos">1524</span></a>
</span><span id="AgentMemoryManager-1525"><a href="#AgentMemoryManager-1525"><span class="linenos">1525</span></a>                        <span class="c1"># Format 3: Dict with separate &#39;entity_labels&#39; and &#39;relation_labels&#39; keys</span>
</span><span id="AgentMemoryManager-1526"><a href="#AgentMemoryManager-1526"><span class="linenos">1526</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1527"><a href="#AgentMemoryManager-1527"><span class="linenos">1527</span></a>                            <span class="k">if</span> <span class="s2">&quot;entity_labels&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1528"><a href="#AgentMemoryManager-1528"><span class="linenos">1528</span></a>                                <span class="n">entity_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;entity_labels&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-1529"><a href="#AgentMemoryManager-1529"><span class="linenos">1529</span></a>                            <span class="k">if</span> <span class="s2">&quot;relation_labels&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1530"><a href="#AgentMemoryManager-1530"><span class="linenos">1530</span></a>                                <span class="n">relation_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;relation_labels&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager-1531"><a href="#AgentMemoryManager-1531"><span class="linenos">1531</span></a>
</span><span id="AgentMemoryManager-1532"><a href="#AgentMemoryManager-1532"><span class="linenos">1532</span></a>                        <span class="c1"># Format the result</span>
</span><span id="AgentMemoryManager-1533"><a href="#AgentMemoryManager-1533"><span class="linenos">1533</span></a>                        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;🏷️ MEMORY GRAPH LABELS</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1534"><a href="#AgentMemoryManager-1534"><span class="linenos">1534</span></a>
</span><span id="AgentMemoryManager-1535"><a href="#AgentMemoryManager-1535"><span class="linenos">1535</span></a>                        <span class="k">if</span> <span class="n">entity_labels</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1536"><a href="#AgentMemoryManager-1536"><span class="linenos">1536</span></a>                            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;Entity Types:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1537"><a href="#AgentMemoryManager-1537"><span class="linenos">1537</span></a>                            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entity_labels</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1538"><a href="#AgentMemoryManager-1538"><span class="linenos">1538</span></a>                                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1539"><a href="#AgentMemoryManager-1539"><span class="linenos">1539</span></a>                            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1540"><a href="#AgentMemoryManager-1540"><span class="linenos">1540</span></a>
</span><span id="AgentMemoryManager-1541"><a href="#AgentMemoryManager-1541"><span class="linenos">1541</span></a>                        <span class="k">if</span> <span class="n">relation_labels</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1542"><a href="#AgentMemoryManager-1542"><span class="linenos">1542</span></a>                            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;Relation Types:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1543"><a href="#AgentMemoryManager-1543"><span class="linenos">1543</span></a>                            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">relation_labels</span><span class="p">):</span>
</span><span id="AgentMemoryManager-1544"><a href="#AgentMemoryManager-1544"><span class="linenos">1544</span></a>                                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1545"><a href="#AgentMemoryManager-1545"><span class="linenos">1545</span></a>
</span><span id="AgentMemoryManager-1546"><a href="#AgentMemoryManager-1546"><span class="linenos">1546</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_labels</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">relation_labels</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1547"><a href="#AgentMemoryManager-1547"><span class="linenos">1547</span></a>                            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;No labels found in the memory graph. Try storing some memories first!&quot;</span>
</span><span id="AgentMemoryManager-1548"><a href="#AgentMemoryManager-1548"><span class="linenos">1548</span></a>
</span><span id="AgentMemoryManager-1549"><a href="#AgentMemoryManager-1549"><span class="linenos">1549</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieved memory graph labels successfully&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1550"><a href="#AgentMemoryManager-1550"><span class="linenos">1550</span></a>                        <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager-1551"><a href="#AgentMemoryManager-1551"><span class="linenos">1551</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1552"><a href="#AgentMemoryManager-1552"><span class="linenos">1552</span></a>                        <span class="n">error_detail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager-1553"><a href="#AgentMemoryManager-1553"><span class="linenos">1553</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager-1554"><a href="#AgentMemoryManager-1554"><span class="linenos">1554</span></a>                            <span class="sa">f</span><span class="s2">&quot;Failed to retrieve graph labels: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1555"><a href="#AgentMemoryManager-1555"><span class="linenos">1555</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager-1556"><a href="#AgentMemoryManager-1556"><span class="linenos">1556</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving graph labels: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager-1557"><a href="#AgentMemoryManager-1557"><span class="linenos">1557</span></a>
</span><span id="AgentMemoryManager-1558"><a href="#AgentMemoryManager-1558"><span class="linenos">1558</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager-1559"><a href="#AgentMemoryManager-1559"><span class="linenos">1559</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error retrieving memory graph labels: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager-1560"><a href="#AgentMemoryManager-1560"><span class="linenos">1560</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving memory graph labels: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Manages memory operations including storage, retrieval, and updates.</p>
</div>


                            <div id="AgentMemoryManager.__init__" class="classattr">
                                        <input id="AgentMemoryManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AgentMemoryManager</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">agno_memory</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">lightrag_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="AgentMemoryManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.__init__-32"><a href="#AgentMemoryManager.__init__-32"><span class="linenos">32</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AgentMemoryManager.__init__-33"><a href="#AgentMemoryManager.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AgentMemoryManager.__init__-34"><a href="#AgentMemoryManager.__init__-34"><span class="linenos">34</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager.__init__-35"><a href="#AgentMemoryManager.__init__-35"><span class="linenos">35</span></a>        <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager.__init__-36"><a href="#AgentMemoryManager.__init__-36"><span class="linenos">36</span></a>        <span class="n">agno_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager.__init__-37"><a href="#AgentMemoryManager.__init__-37"><span class="linenos">37</span></a>        <span class="n">lightrag_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager.__init__-38"><a href="#AgentMemoryManager.__init__-38"><span class="linenos">38</span></a>        <span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager.__init__-39"><a href="#AgentMemoryManager.__init__-39"><span class="linenos">39</span></a>        <span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.__init__-40"><a href="#AgentMemoryManager.__init__-40"><span class="linenos">40</span></a>    <span class="p">):</span>
</span><span id="AgentMemoryManager.__init__-41"><a href="#AgentMemoryManager.__init__-41"><span class="linenos">41</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the memory manager.</span>
</span><span id="AgentMemoryManager.__init__-42"><a href="#AgentMemoryManager.__init__-42"><span class="linenos">42</span></a>
</span><span id="AgentMemoryManager.__init__-43"><a href="#AgentMemoryManager.__init__-43"><span class="linenos">43</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.__init__-44"><a href="#AgentMemoryManager.__init__-44"><span class="linenos">44</span></a><span class="sd">            user_id: User identifier for memory operations</span>
</span><span id="AgentMemoryManager.__init__-45"><a href="#AgentMemoryManager.__init__-45"><span class="linenos">45</span></a><span class="sd">            storage_dir: Directory for storage files</span>
</span><span id="AgentMemoryManager.__init__-46"><a href="#AgentMemoryManager.__init__-46"><span class="linenos">46</span></a><span class="sd">            agno_memory: Optional initialized agno memory instance</span>
</span><span id="AgentMemoryManager.__init__-47"><a href="#AgentMemoryManager.__init__-47"><span class="linenos">47</span></a><span class="sd">            lightrag_url: Optional URL for LightRAG API</span>
</span><span id="AgentMemoryManager.__init__-48"><a href="#AgentMemoryManager.__init__-48"><span class="linenos">48</span></a><span class="sd">            lightrag_memory_url: Optional URL for LightRAG Memory API</span>
</span><span id="AgentMemoryManager.__init__-49"><a href="#AgentMemoryManager.__init__-49"><span class="linenos">49</span></a><span class="sd">            enable_memory: Whether memory is enabled</span>
</span><span id="AgentMemoryManager.__init__-50"><a href="#AgentMemoryManager.__init__-50"><span class="linenos">50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.__init__-51"><a href="#AgentMemoryManager.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgentMemoryManager.__init__-52"><a href="#AgentMemoryManager.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">storage_dir</span>
</span><span id="AgentMemoryManager.__init__-53"><a href="#AgentMemoryManager.__init__-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="n">agno_memory</span>
</span><span id="AgentMemoryManager.__init__-54"><a href="#AgentMemoryManager.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_url</span> <span class="o">=</span> <span class="n">lightrag_url</span>
</span><span id="AgentMemoryManager.__init__-55"><a href="#AgentMemoryManager.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span> <span class="o">=</span> <span class="n">lightrag_memory_url</span>
</span><span id="AgentMemoryManager.__init__-56"><a href="#AgentMemoryManager.__init__-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="o">=</span> <span class="n">enable_memory</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the memory manager.</p>

<p>Args:
    user_id: User identifier for memory operations
    storage_dir: Directory for storage files
    agno_memory: Optional initialized agno memory instance
    lightrag_url: Optional URL for LightRAG API
    lightrag_memory_url: Optional URL for LightRAG Memory API
    enable_memory: Whether memory is enabled</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.user_id" class="classattr">
                                <div class="attr variable">
            <span class="name">user_id</span>

        
    </div>
    <a class="headerlink" href="#AgentMemoryManager.user_id"></a>
    
    

                            </div>
                            <div id="AgentMemoryManager.storage_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">storage_dir</span>

        
    </div>
    <a class="headerlink" href="#AgentMemoryManager.storage_dir"></a>
    
    

                            </div>
                            <div id="AgentMemoryManager.agno_memory" class="classattr">
                                <div class="attr variable">
            <span class="name">agno_memory</span>

        
    </div>
    <a class="headerlink" href="#AgentMemoryManager.agno_memory"></a>
    
    

                            </div>
                            <div id="AgentMemoryManager.lightrag_url" class="classattr">
                                <div class="attr variable">
            <span class="name">lightrag_url</span>

        
    </div>
    <a class="headerlink" href="#AgentMemoryManager.lightrag_url"></a>
    
    

                            </div>
                            <div id="AgentMemoryManager.lightrag_memory_url" class="classattr">
                                <div class="attr variable">
            <span class="name">lightrag_memory_url</span>

        
    </div>
    <a class="headerlink" href="#AgentMemoryManager.lightrag_memory_url"></a>
    
    

                            </div>
                            <div id="AgentMemoryManager.enable_memory" class="classattr">
                                <div class="attr variable">
            <span class="name">enable_memory</span>

        
    </div>
    <a class="headerlink" href="#AgentMemoryManager.enable_memory"></a>
    
    

                            </div>
                            <div id="AgentMemoryManager.initialize" class="classattr">
                                        <input id="AgentMemoryManager.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">agno_memory</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AgentMemoryManager.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.initialize-58"><a href="#AgentMemoryManager.initialize-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agno_memory</span><span class="p">):</span>
</span><span id="AgentMemoryManager.initialize-59"><a href="#AgentMemoryManager.initialize-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the memory manager with agno_memory.</span>
</span><span id="AgentMemoryManager.initialize-60"><a href="#AgentMemoryManager.initialize-60"><span class="linenos">60</span></a>
</span><span id="AgentMemoryManager.initialize-61"><a href="#AgentMemoryManager.initialize-61"><span class="linenos">61</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.initialize-62"><a href="#AgentMemoryManager.initialize-62"><span class="linenos">62</span></a><span class="sd">            agno_memory: The initialized agno memory instance</span>
</span><span id="AgentMemoryManager.initialize-63"><a href="#AgentMemoryManager.initialize-63"><span class="linenos">63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.initialize-64"><a href="#AgentMemoryManager.initialize-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span> <span class="o">=</span> <span class="n">agno_memory</span>
</span><span id="AgentMemoryManager.initialize-65"><a href="#AgentMemoryManager.initialize-65"><span class="linenos">65</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Memory manager initialized with agno_memory&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the memory manager with agno_memory.</p>

<p>Args:
    agno_memory: The initialized agno memory instance</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.direct_search_memories" class="classattr">
                                        <input id="AgentMemoryManager.direct_search_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">direct_search_memories</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>, </span><span class="param"><span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AgentMemoryManager.direct_search_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.direct_search_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.direct_search_memories-67"><a href="#AgentMemoryManager.direct_search_memories-67"><span class="linenos">67</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">direct_search_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager.direct_search_memories-68"><a href="#AgentMemoryManager.direct_search_memories-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="AgentMemoryManager.direct_search_memories-69"><a href="#AgentMemoryManager.direct_search_memories-69"><span class="linenos">69</span></a>    <span class="p">):</span>
</span><span id="AgentMemoryManager.direct_search_memories-70"><a href="#AgentMemoryManager.direct_search_memories-70"><span class="linenos">70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Direct semantic search without agentic retrieval.</span>
</span><span id="AgentMemoryManager.direct_search_memories-71"><a href="#AgentMemoryManager.direct_search_memories-71"><span class="linenos">71</span></a>
</span><span id="AgentMemoryManager.direct_search_memories-72"><a href="#AgentMemoryManager.direct_search_memories-72"><span class="linenos">72</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.direct_search_memories-73"><a href="#AgentMemoryManager.direct_search_memories-73"><span class="linenos">73</span></a><span class="sd">            query: The search query</span>
</span><span id="AgentMemoryManager.direct_search_memories-74"><a href="#AgentMemoryManager.direct_search_memories-74"><span class="linenos">74</span></a><span class="sd">            limit: Maximum number of results to return</span>
</span><span id="AgentMemoryManager.direct_search_memories-75"><a href="#AgentMemoryManager.direct_search_memories-75"><span class="linenos">75</span></a><span class="sd">            similarity_threshold: Minimum similarity score for results</span>
</span><span id="AgentMemoryManager.direct_search_memories-76"><a href="#AgentMemoryManager.direct_search_memories-76"><span class="linenos">76</span></a>
</span><span id="AgentMemoryManager.direct_search_memories-77"><a href="#AgentMemoryManager.direct_search_memories-77"><span class="linenos">77</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.direct_search_memories-78"><a href="#AgentMemoryManager.direct_search_memories-78"><span class="linenos">78</span></a><span class="sd">            List of memory results</span>
</span><span id="AgentMemoryManager.direct_search_memories-79"><a href="#AgentMemoryManager.direct_search_memories-79"><span class="linenos">79</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.direct_search_memories-80"><a href="#AgentMemoryManager.direct_search_memories-80"><span class="linenos">80</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgentMemoryManager.direct_search_memories-81"><a href="#AgentMemoryManager.direct_search_memories-81"><span class="linenos">81</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.direct_search_memories-82"><a href="#AgentMemoryManager.direct_search_memories-82"><span class="linenos">82</span></a>
</span><span id="AgentMemoryManager.direct_search_memories-83"><a href="#AgentMemoryManager.direct_search_memories-83"><span class="linenos">83</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.direct_search_memories-84"><a href="#AgentMemoryManager.direct_search_memories-84"><span class="linenos">84</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">search_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager.direct_search_memories-85"><a href="#AgentMemoryManager.direct_search_memories-85"><span class="linenos">85</span></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
</span><span id="AgentMemoryManager.direct_search_memories-86"><a href="#AgentMemoryManager.direct_search_memories-86"><span class="linenos">86</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager.direct_search_memories-87"><a href="#AgentMemoryManager.direct_search_memories-87"><span class="linenos">87</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.direct_search_memories-88"><a href="#AgentMemoryManager.direct_search_memories-88"><span class="linenos">88</span></a>                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span id="AgentMemoryManager.direct_search_memories-89"><a href="#AgentMemoryManager.direct_search_memories-89"><span class="linenos">89</span></a>                <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">similarity_threshold</span><span class="p">,</span>
</span><span id="AgentMemoryManager.direct_search_memories-90"><a href="#AgentMemoryManager.direct_search_memories-90"><span class="linenos">90</span></a>                <span class="n">search_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.direct_search_memories-91"><a href="#AgentMemoryManager.direct_search_memories-91"><span class="linenos">91</span></a>                <span class="n">topic_boost</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="AgentMemoryManager.direct_search_memories-92"><a href="#AgentMemoryManager.direct_search_memories-92"><span class="linenos">92</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.direct_search_memories-93"><a href="#AgentMemoryManager.direct_search_memories-93"><span class="linenos">93</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="AgentMemoryManager.direct_search_memories-94"><a href="#AgentMemoryManager.direct_search_memories-94"><span class="linenos">94</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.direct_search_memories-95"><a href="#AgentMemoryManager.direct_search_memories-95"><span class="linenos">95</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Direct semantic search failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.direct_search_memories-96"><a href="#AgentMemoryManager.direct_search_memories-96"><span class="linenos">96</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Direct semantic search without agentic retrieval.</p>

<p>Args:
    query: The search query
    limit: Maximum number of results to return
    similarity_threshold: Minimum similarity score for results</p>

<p>Returns:
    List of memory results</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.get_memory_tools" class="classattr">
                                        <input id="AgentMemoryManager.get_memory_tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_memory_tools</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.get_memory_tools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.get_memory_tools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.get_memory_tools-98"><a href="#AgentMemoryManager.get_memory_tools-98"><span class="linenos"> 98</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-99"><a href="#AgentMemoryManager.get_memory_tools-99"><span class="linenos"> 99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create memory tools using direct SemanticMemoryManager method calls.</span>
</span><span id="AgentMemoryManager.get_memory_tools-100"><a href="#AgentMemoryManager.get_memory_tools-100"><span class="linenos">100</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-101"><a href="#AgentMemoryManager.get_memory_tools-101"><span class="linenos">101</span></a><span class="sd">        This method creates memory tools that directly call SemanticMemoryManager methods</span>
</span><span id="AgentMemoryManager.get_memory_tools-102"><a href="#AgentMemoryManager.get_memory_tools-102"><span class="linenos">102</span></a><span class="sd">        instead of using complex wrapper functions, making the code much simpler and more maintainable.</span>
</span><span id="AgentMemoryManager.get_memory_tools-103"><a href="#AgentMemoryManager.get_memory_tools-103"><span class="linenos">103</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-104"><a href="#AgentMemoryManager.get_memory_tools-104"><span class="linenos">104</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.get_memory_tools-105"><a href="#AgentMemoryManager.get_memory_tools-105"><span class="linenos">105</span></a><span class="sd">            List of memory tool functions</span>
</span><span id="AgentMemoryManager.get_memory_tools-106"><a href="#AgentMemoryManager.get_memory_tools-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-107"><a href="#AgentMemoryManager.get_memory_tools-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-108"><a href="#AgentMemoryManager.get_memory_tools-108"><span class="linenos">108</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Memory not enabled or memory not initialized&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-109"><a href="#AgentMemoryManager.get_memory_tools-109"><span class="linenos">109</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.get_memory_tools-110"><a href="#AgentMemoryManager.get_memory_tools-110"><span class="linenos">110</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-111"><a href="#AgentMemoryManager.get_memory_tools-111"><span class="linenos">111</span></a>        <span class="c1"># Check if memory is available</span>
</span><span id="AgentMemoryManager.get_memory_tools-112"><a href="#AgentMemoryManager.get_memory_tools-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-113"><a href="#AgentMemoryManager.get_memory_tools-113"><span class="linenos">113</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Memory not initialized&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-114"><a href="#AgentMemoryManager.get_memory_tools-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.get_memory_tools-115"><a href="#AgentMemoryManager.get_memory_tools-115"><span class="linenos">115</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-116"><a href="#AgentMemoryManager.get_memory_tools-116"><span class="linenos">116</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.get_memory_tools-117"><a href="#AgentMemoryManager.get_memory_tools-117"><span class="linenos">117</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-118"><a href="#AgentMemoryManager.get_memory_tools-118"><span class="linenos">118</span></a>        <span class="c1"># Define all the memory tool functions</span>
</span><span id="AgentMemoryManager.get_memory_tools-119"><a href="#AgentMemoryManager.get_memory_tools-119"><span class="linenos">119</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_user_memory_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-120"><a href="#AgentMemoryManager.get_memory_tools-120"><span class="linenos">120</span></a>            <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.get_memory_tools-121"><a href="#AgentMemoryManager.get_memory_tools-121"><span class="linenos">121</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-122"><a href="#AgentMemoryManager.get_memory_tools-122"><span class="linenos">122</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;A tool that wraps the public store_user_memory method.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-123"><a href="#AgentMemoryManager.get_memory_tools-123"><span class="linenos">123</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_user_memory</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-124"><a href="#AgentMemoryManager.get_memory_tools-124"><span class="linenos">124</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-125"><a href="#AgentMemoryManager.get_memory_tools-125"><span class="linenos">125</span></a>            <span class="c1"># Format the result for user display</span>
</span><span id="AgentMemoryManager.get_memory_tools-126"><a href="#AgentMemoryManager.get_memory_tools-126"><span class="linenos">126</span></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-127"><a href="#AgentMemoryManager.get_memory_tools-127"><span class="linenos">127</span></a>                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-128"><a href="#AgentMemoryManager.get_memory_tools-128"><span class="linenos">128</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-129"><a href="#AgentMemoryManager.get_memory_tools-129"><span class="linenos">129</span></a>                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS_LOCAL_ONLY</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-130"><a href="#AgentMemoryManager.get_memory_tools-130"><span class="linenos">130</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;⚠️ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-131"><a href="#AgentMemoryManager.get_memory_tools-131"><span class="linenos">131</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-132"><a href="#AgentMemoryManager.get_memory_tools-132"><span class="linenos">132</span></a>                <span class="c1"># Handle different rejection types with appropriate emojis</span>
</span><span id="AgentMemoryManager.get_memory_tools-133"><a href="#AgentMemoryManager.get_memory_tools-133"><span class="linenos">133</span></a>                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_EXACT</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-134"><a href="#AgentMemoryManager.get_memory_tools-134"><span class="linenos">134</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🔄 </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-135"><a href="#AgentMemoryManager.get_memory_tools-135"><span class="linenos">135</span></a>                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">DUPLICATE_SEMANTIC</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-136"><a href="#AgentMemoryManager.get_memory_tools-136"><span class="linenos">136</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🔄 </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2"> (similarity: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">similarity_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-137"><a href="#AgentMemoryManager.get_memory_tools-137"><span class="linenos">137</span></a>                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_EMPTY</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-138"><a href="#AgentMemoryManager.get_memory_tools-138"><span class="linenos">138</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-139"><a href="#AgentMemoryManager.get_memory_tools-139"><span class="linenos">139</span></a>                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_TOO_LONG</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-140"><a href="#AgentMemoryManager.get_memory_tools-140"><span class="linenos">140</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-141"><a href="#AgentMemoryManager.get_memory_tools-141"><span class="linenos">141</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-142"><a href="#AgentMemoryManager.get_memory_tools-142"><span class="linenos">142</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-143"><a href="#AgentMemoryManager.get_memory_tools-143"><span class="linenos">143</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-144"><a href="#AgentMemoryManager.get_memory_tools-144"><span class="linenos">144</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_memory_tool</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-145"><a href="#AgentMemoryManager.get_memory_tools-145"><span class="linenos">145</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Search user memories using direct SemanticMemoryManager calls.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-146"><a href="#AgentMemoryManager.get_memory_tools-146"><span class="linenos">146</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_memory</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-147"><a href="#AgentMemoryManager.get_memory_tools-147"><span class="linenos">147</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-148"><a href="#AgentMemoryManager.get_memory_tools-148"><span class="linenos">148</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_memory_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-149"><a href="#AgentMemoryManager.get_memory_tools-149"><span class="linenos">149</span></a>            <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.get_memory_tools-150"><a href="#AgentMemoryManager.get_memory_tools-150"><span class="linenos">150</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-151"><a href="#AgentMemoryManager.get_memory_tools-151"><span class="linenos">151</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Update an existing memory.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-152"><a href="#AgentMemoryManager.get_memory_tools-152"><span class="linenos">152</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_memory</span><span class="p">(</span><span class="n">memory_id</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-153"><a href="#AgentMemoryManager.get_memory_tools-153"><span class="linenos">153</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-154"><a href="#AgentMemoryManager.get_memory_tools-154"><span class="linenos">154</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_memory_tool</span><span class="p">(</span><span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-155"><a href="#AgentMemoryManager.get_memory_tools-155"><span class="linenos">155</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Delete a memory from both SQLite and LightRAG systems.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-156"><a href="#AgentMemoryManager.get_memory_tools-156"><span class="linenos">156</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">memory_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-157"><a href="#AgentMemoryManager.get_memory_tools-157"><span class="linenos">157</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-158"><a href="#AgentMemoryManager.get_memory_tools-158"><span class="linenos">158</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_recent_memories_tool</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-159"><a href="#AgentMemoryManager.get_memory_tools-159"><span class="linenos">159</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get recent memories by searching all memories and sorting by date.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-160"><a href="#AgentMemoryManager.get_memory_tools-160"><span class="linenos">160</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_recent_memories</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-161"><a href="#AgentMemoryManager.get_memory_tools-161"><span class="linenos">161</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-162"><a href="#AgentMemoryManager.get_memory_tools-162"><span class="linenos">162</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_memories_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-163"><a href="#AgentMemoryManager.get_memory_tools-163"><span class="linenos">163</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get all user memories.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-164"><a href="#AgentMemoryManager.get_memory_tools-164"><span class="linenos">164</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">()</span>
</span><span id="AgentMemoryManager.get_memory_tools-165"><a href="#AgentMemoryManager.get_memory_tools-165"><span class="linenos">165</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-166"><a href="#AgentMemoryManager.get_memory_tools-166"><span class="linenos">166</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_stats_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-167"><a href="#AgentMemoryManager.get_memory_tools-167"><span class="linenos">167</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get memory statistics.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-168"><a href="#AgentMemoryManager.get_memory_tools-168"><span class="linenos">168</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_stats</span><span class="p">()</span>
</span><span id="AgentMemoryManager.get_memory_tools-169"><a href="#AgentMemoryManager.get_memory_tools-169"><span class="linenos">169</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-170"><a href="#AgentMemoryManager.get_memory_tools-170"><span class="linenos">170</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memories_by_topic_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-171"><a href="#AgentMemoryManager.get_memory_tools-171"><span class="linenos">171</span></a>            <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.get_memory_tools-172"><a href="#AgentMemoryManager.get_memory_tools-172"><span class="linenos">172</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-173"><a href="#AgentMemoryManager.get_memory_tools-173"><span class="linenos">173</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get memories by topic without similarity search.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-174"><a href="#AgentMemoryManager.get_memory_tools-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memories_by_topic</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-175"><a href="#AgentMemoryManager.get_memory_tools-175"><span class="linenos">175</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-176"><a href="#AgentMemoryManager.get_memory_tools-176"><span class="linenos">176</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_memories_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-177"><a href="#AgentMemoryManager.get_memory_tools-177"><span class="linenos">177</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;List all memories in a simple, user-friendly format.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-178"><a href="#AgentMemoryManager.get_memory_tools-178"><span class="linenos">178</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_memories</span><span class="p">()</span>
</span><span id="AgentMemoryManager.get_memory_tools-179"><a href="#AgentMemoryManager.get_memory_tools-179"><span class="linenos">179</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-180"><a href="#AgentMemoryManager.get_memory_tools-180"><span class="linenos">180</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_graph_memory_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-181"><a href="#AgentMemoryManager.get_memory_tools-181"><span class="linenos">181</span></a>            <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-182"><a href="#AgentMemoryManager.get_memory_tools-182"><span class="linenos">182</span></a>            <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-183"><a href="#AgentMemoryManager.get_memory_tools-183"><span class="linenos">183</span></a>            <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-184"><a href="#AgentMemoryManager.get_memory_tools-184"><span class="linenos">184</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-185"><a href="#AgentMemoryManager.get_memory_tools-185"><span class="linenos">185</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Store a memory in the LightRAG graph database to capture relationships.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-186"><a href="#AgentMemoryManager.get_memory_tools-186"><span class="linenos">186</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_graph_memory</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">topics</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-187"><a href="#AgentMemoryManager.get_memory_tools-187"><span class="linenos">187</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-188"><a href="#AgentMemoryManager.get_memory_tools-188"><span class="linenos">188</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_graph_memory_tool</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-189"><a href="#AgentMemoryManager.get_memory_tools-189"><span class="linenos">189</span></a>            <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-190"><a href="#AgentMemoryManager.get_memory_tools-190"><span class="linenos">190</span></a>            <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mix&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-191"><a href="#AgentMemoryManager.get_memory_tools-191"><span class="linenos">191</span></a>            <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-192"><a href="#AgentMemoryManager.get_memory_tools-192"><span class="linenos">192</span></a>            <span class="n">response_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-193"><a href="#AgentMemoryManager.get_memory_tools-193"><span class="linenos">193</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-194"><a href="#AgentMemoryManager.get_memory_tools-194"><span class="linenos">194</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Query the LightRAG memory graph to explore relationships between memories.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-195"><a href="#AgentMemoryManager.get_memory_tools-195"><span class="linenos">195</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_graph_memory</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">top_k</span><span class="p">,</span> <span class="n">response_type</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-196"><a href="#AgentMemoryManager.get_memory_tools-196"><span class="linenos">196</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-197"><a href="#AgentMemoryManager.get_memory_tools-197"><span class="linenos">197</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_graph_labels_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-198"><a href="#AgentMemoryManager.get_memory_tools-198"><span class="linenos">198</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get the list of all entity and relation labels from the memory graph.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-199"><a href="#AgentMemoryManager.get_memory_tools-199"><span class="linenos">199</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_graph_labels</span><span class="p">()</span>
</span><span id="AgentMemoryManager.get_memory_tools-200"><a href="#AgentMemoryManager.get_memory_tools-200"><span class="linenos">200</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-201"><a href="#AgentMemoryManager.get_memory_tools-201"><span class="linenos">201</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_memories_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-202"><a href="#AgentMemoryManager.get_memory_tools-202"><span class="linenos">202</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Clear all memories for the user using direct SemanticMemoryManager calls.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-203"><a href="#AgentMemoryManager.get_memory_tools-203"><span class="linenos">203</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-204"><a href="#AgentMemoryManager.get_memory_tools-204"><span class="linenos">204</span></a>                <span class="c1"># Direct call to SemanticMemoryManager.clear_memories()</span>
</span><span id="AgentMemoryManager.get_memory_tools-205"><a href="#AgentMemoryManager.get_memory_tools-205"><span class="linenos">205</span></a>                <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">clear_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-206"><a href="#AgentMemoryManager.get_memory_tools-206"><span class="linenos">206</span></a>                    <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager.get_memory_tools-207"><a href="#AgentMemoryManager.get_memory_tools-207"><span class="linenos">207</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-208"><a href="#AgentMemoryManager.get_memory_tools-208"><span class="linenos">208</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-209"><a href="#AgentMemoryManager.get_memory_tools-209"><span class="linenos">209</span></a>                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-210"><a href="#AgentMemoryManager.get_memory_tools-210"><span class="linenos">210</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-211"><a href="#AgentMemoryManager.get_memory_tools-211"><span class="linenos">211</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-212"><a href="#AgentMemoryManager.get_memory_tools-212"><span class="linenos">212</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-213"><a href="#AgentMemoryManager.get_memory_tools-213"><span class="linenos">213</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-214"><a href="#AgentMemoryManager.get_memory_tools-214"><span class="linenos">214</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error clearing memories: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-215"><a href="#AgentMemoryManager.get_memory_tools-215"><span class="linenos">215</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-216"><a href="#AgentMemoryManager.get_memory_tools-216"><span class="linenos">216</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-217"><a href="#AgentMemoryManager.get_memory_tools-217"><span class="linenos">217</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error clearing memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-218"><a href="#AgentMemoryManager.get_memory_tools-218"><span class="linenos">218</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error clearing memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-219"><a href="#AgentMemoryManager.get_memory_tools-219"><span class="linenos">219</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-220"><a href="#AgentMemoryManager.get_memory_tools-220"><span class="linenos">220</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_memories_by_topic_tool</span><span class="p">(</span><span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-221"><a href="#AgentMemoryManager.get_memory_tools-221"><span class="linenos">221</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Delete all memories associated with a specific topic or list of topics.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-222"><a href="#AgentMemoryManager.get_memory_tools-222"><span class="linenos">222</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-223"><a href="#AgentMemoryManager.get_memory_tools-223"><span class="linenos">223</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_memory_tools-224"><a href="#AgentMemoryManager.get_memory_tools-224"><span class="linenos">224</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</span><span id="AgentMemoryManager.get_memory_tools-225"><a href="#AgentMemoryManager.get_memory_tools-225"><span class="linenos">225</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-226"><a href="#AgentMemoryManager.get_memory_tools-226"><span class="linenos">226</span></a>                <span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-227"><a href="#AgentMemoryManager.get_memory_tools-227"><span class="linenos">227</span></a>                    <span class="n">success</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-228"><a href="#AgentMemoryManager.get_memory_tools-228"><span class="linenos">228</span></a>                    <span class="n">message</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-229"><a href="#AgentMemoryManager.get_memory_tools-229"><span class="linenos">229</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">delete_memories_by_topic</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-230"><a href="#AgentMemoryManager.get_memory_tools-230"><span class="linenos">230</span></a>                    <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager.get_memory_tools-231"><a href="#AgentMemoryManager.get_memory_tools-231"><span class="linenos">231</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-232"><a href="#AgentMemoryManager.get_memory_tools-232"><span class="linenos">232</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-233"><a href="#AgentMemoryManager.get_memory_tools-233"><span class="linenos">233</span></a>                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-234"><a href="#AgentMemoryManager.get_memory_tools-234"><span class="linenos">234</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-235"><a href="#AgentMemoryManager.get_memory_tools-235"><span class="linenos">235</span></a>                        <span class="s2">&quot;Deleted memories for topics &#39;</span><span class="si">%s</span><span class="s2">&#39; for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-236"><a href="#AgentMemoryManager.get_memory_tools-236"><span class="linenos">236</span></a>                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">),</span>
</span><span id="AgentMemoryManager.get_memory_tools-237"><a href="#AgentMemoryManager.get_memory_tools-237"><span class="linenos">237</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-238"><a href="#AgentMemoryManager.get_memory_tools-238"><span class="linenos">238</span></a>                    <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-239"><a href="#AgentMemoryManager.get_memory_tools-239"><span class="linenos">239</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-240"><a href="#AgentMemoryManager.get_memory_tools-240"><span class="linenos">240</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-241"><a href="#AgentMemoryManager.get_memory_tools-241"><span class="linenos">241</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-242"><a href="#AgentMemoryManager.get_memory_tools-242"><span class="linenos">242</span></a>                        <span class="s2">&quot;Failed to delete memories for topics </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-243"><a href="#AgentMemoryManager.get_memory_tools-243"><span class="linenos">243</span></a>                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="p">),</span>
</span><span id="AgentMemoryManager.get_memory_tools-244"><a href="#AgentMemoryManager.get_memory_tools-244"><span class="linenos">244</span></a>                        <span class="n">message</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-245"><a href="#AgentMemoryManager.get_memory_tools-245"><span class="linenos">245</span></a>                    <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-246"><a href="#AgentMemoryManager.get_memory_tools-246"><span class="linenos">246</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error deleting memories by topic: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-247"><a href="#AgentMemoryManager.get_memory_tools-247"><span class="linenos">247</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-248"><a href="#AgentMemoryManager.get_memory_tools-248"><span class="linenos">248</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-249"><a href="#AgentMemoryManager.get_memory_tools-249"><span class="linenos">249</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error deleting memories by topic: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-250"><a href="#AgentMemoryManager.get_memory_tools-250"><span class="linenos">250</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error deleting memories by topic: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-251"><a href="#AgentMemoryManager.get_memory_tools-251"><span class="linenos">251</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-252"><a href="#AgentMemoryManager.get_memory_tools-252"><span class="linenos">252</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_all_memories_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_tools-253"><a href="#AgentMemoryManager.get_memory_tools-253"><span class="linenos">253</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Clear all memories from both SQLite and LightRAG systems.&quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-254"><a href="#AgentMemoryManager.get_memory_tools-254"><span class="linenos">254</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_all_memories</span><span class="p">()</span>
</span><span id="AgentMemoryManager.get_memory_tools-255"><a href="#AgentMemoryManager.get_memory_tools-255"><span class="linenos">255</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-256"><a href="#AgentMemoryManager.get_memory_tools-256"><span class="linenos">256</span></a>        <span class="c1"># Set proper function names for tool identification</span>
</span><span id="AgentMemoryManager.get_memory_tools-257"><a href="#AgentMemoryManager.get_memory_tools-257"><span class="linenos">257</span></a>        <span class="n">store_user_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;store_user_memory&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-258"><a href="#AgentMemoryManager.get_memory_tools-258"><span class="linenos">258</span></a>        <span class="n">query_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;query_memory&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-259"><a href="#AgentMemoryManager.get_memory_tools-259"><span class="linenos">259</span></a>        <span class="n">update_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;update_memory&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-260"><a href="#AgentMemoryManager.get_memory_tools-260"><span class="linenos">260</span></a>        <span class="n">delete_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;delete_memory&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-261"><a href="#AgentMemoryManager.get_memory_tools-261"><span class="linenos">261</span></a>        <span class="n">delete_memories_by_topic_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;delete_memories_by_topic&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-262"><a href="#AgentMemoryManager.get_memory_tools-262"><span class="linenos">262</span></a>        <span class="n">clear_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;clear_memories&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-263"><a href="#AgentMemoryManager.get_memory_tools-263"><span class="linenos">263</span></a>        <span class="n">clear_all_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;clear_all_memories&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-264"><a href="#AgentMemoryManager.get_memory_tools-264"><span class="linenos">264</span></a>        <span class="n">get_recent_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_recent_memories&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-265"><a href="#AgentMemoryManager.get_memory_tools-265"><span class="linenos">265</span></a>        <span class="n">get_all_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_all_memories&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-266"><a href="#AgentMemoryManager.get_memory_tools-266"><span class="linenos">266</span></a>        <span class="n">get_memory_stats_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_memory_stats&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-267"><a href="#AgentMemoryManager.get_memory_tools-267"><span class="linenos">267</span></a>        <span class="n">get_memories_by_topic_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_memories_by_topic&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-268"><a href="#AgentMemoryManager.get_memory_tools-268"><span class="linenos">268</span></a>        <span class="n">list_memories_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;list_memories&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-269"><a href="#AgentMemoryManager.get_memory_tools-269"><span class="linenos">269</span></a>        <span class="n">store_graph_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;store_graph_memory&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-270"><a href="#AgentMemoryManager.get_memory_tools-270"><span class="linenos">270</span></a>        <span class="n">query_graph_memory_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;query_graph_memory&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-271"><a href="#AgentMemoryManager.get_memory_tools-271"><span class="linenos">271</span></a>        <span class="n">get_memory_graph_labels_tool</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;get_memory_graph_labels&quot;</span>
</span><span id="AgentMemoryManager.get_memory_tools-272"><a href="#AgentMemoryManager.get_memory_tools-272"><span class="linenos">272</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-273"><a href="#AgentMemoryManager.get_memory_tools-273"><span class="linenos">273</span></a>        <span class="c1"># Add tools to the list</span>
</span><span id="AgentMemoryManager.get_memory_tools-274"><a href="#AgentMemoryManager.get_memory_tools-274"><span class="linenos">274</span></a>        <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-275"><a href="#AgentMemoryManager.get_memory_tools-275"><span class="linenos">275</span></a>            <span class="p">[</span>
</span><span id="AgentMemoryManager.get_memory_tools-276"><a href="#AgentMemoryManager.get_memory_tools-276"><span class="linenos">276</span></a>                <span class="n">store_user_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-277"><a href="#AgentMemoryManager.get_memory_tools-277"><span class="linenos">277</span></a>                <span class="n">query_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-278"><a href="#AgentMemoryManager.get_memory_tools-278"><span class="linenos">278</span></a>                <span class="n">update_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-279"><a href="#AgentMemoryManager.get_memory_tools-279"><span class="linenos">279</span></a>                <span class="n">delete_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-280"><a href="#AgentMemoryManager.get_memory_tools-280"><span class="linenos">280</span></a>                <span class="n">delete_memories_by_topic_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-281"><a href="#AgentMemoryManager.get_memory_tools-281"><span class="linenos">281</span></a>                <span class="n">clear_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-282"><a href="#AgentMemoryManager.get_memory_tools-282"><span class="linenos">282</span></a>                <span class="n">clear_all_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-283"><a href="#AgentMemoryManager.get_memory_tools-283"><span class="linenos">283</span></a>                <span class="n">get_recent_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-284"><a href="#AgentMemoryManager.get_memory_tools-284"><span class="linenos">284</span></a>                <span class="n">get_all_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-285"><a href="#AgentMemoryManager.get_memory_tools-285"><span class="linenos">285</span></a>                <span class="n">get_memory_stats_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-286"><a href="#AgentMemoryManager.get_memory_tools-286"><span class="linenos">286</span></a>                <span class="n">get_memories_by_topic_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-287"><a href="#AgentMemoryManager.get_memory_tools-287"><span class="linenos">287</span></a>                <span class="n">list_memories_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-288"><a href="#AgentMemoryManager.get_memory_tools-288"><span class="linenos">288</span></a>                <span class="n">store_graph_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-289"><a href="#AgentMemoryManager.get_memory_tools-289"><span class="linenos">289</span></a>                <span class="n">query_graph_memory_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-290"><a href="#AgentMemoryManager.get_memory_tools-290"><span class="linenos">290</span></a>                <span class="n">get_memory_graph_labels_tool</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-291"><a href="#AgentMemoryManager.get_memory_tools-291"><span class="linenos">291</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager.get_memory_tools-292"><a href="#AgentMemoryManager.get_memory_tools-292"><span class="linenos">292</span></a>        <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-293"><a href="#AgentMemoryManager.get_memory_tools-293"><span class="linenos">293</span></a>
</span><span id="AgentMemoryManager.get_memory_tools-294"><a href="#AgentMemoryManager.get_memory_tools-294"><span class="linenos">294</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_tools-295"><a href="#AgentMemoryManager.get_memory_tools-295"><span class="linenos">295</span></a>            <span class="s2">&quot;Created </span><span class="si">%d</span><span class="s2"> memory tools using direct SemanticMemoryManager calls&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memory_tools-296"><a href="#AgentMemoryManager.get_memory_tools-296"><span class="linenos">296</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">tools</span><span class="p">),</span>
</span><span id="AgentMemoryManager.get_memory_tools-297"><a href="#AgentMemoryManager.get_memory_tools-297"><span class="linenos">297</span></a>        <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_tools-298"><a href="#AgentMemoryManager.get_memory_tools-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="n">tools</span>
</span></pre></div>


            <div class="docstring"><p>Create memory tools using direct SemanticMemoryManager method calls.</p>

<p>This method creates memory tools that directly call SemanticMemoryManager methods
instead of using complex wrapper functions, making the code much simpler and more maintainable.</p>

<p>Returns:
    List of memory tool functions</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.store_user_memory" class="classattr">
                                        <input id="AgentMemoryManager.store_user_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">store_user_memory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#MemoryStorageResult">MemoryStorageResult</a></span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.store_user_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.store_user_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.store_user_memory-300"><a href="#AgentMemoryManager.store_user_memory-300"><span class="linenos">300</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_user_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-301"><a href="#AgentMemoryManager.store_user_memory-301"><span class="linenos">301</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.store_user_memory-302"><a href="#AgentMemoryManager.store_user_memory-302"><span class="linenos">302</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryStorageResult</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-303"><a href="#AgentMemoryManager.store_user_memory-303"><span class="linenos">303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store information as a user memory in BOTH local SQLite and LightRAG graph systems.</span>
</span><span id="AgentMemoryManager.store_user_memory-304"><a href="#AgentMemoryManager.store_user_memory-304"><span class="linenos">304</span></a>
</span><span id="AgentMemoryManager.store_user_memory-305"><a href="#AgentMemoryManager.store_user_memory-305"><span class="linenos">305</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.store_user_memory-306"><a href="#AgentMemoryManager.store_user_memory-306"><span class="linenos">306</span></a><span class="sd">            content: The information to store as a memory</span>
</span><span id="AgentMemoryManager.store_user_memory-307"><a href="#AgentMemoryManager.store_user_memory-307"><span class="linenos">307</span></a><span class="sd">            topics: Optional list of topics/categories for the memory (None = auto-classify)</span>
</span><span id="AgentMemoryManager.store_user_memory-308"><a href="#AgentMemoryManager.store_user_memory-308"><span class="linenos">308</span></a>
</span><span id="AgentMemoryManager.store_user_memory-309"><a href="#AgentMemoryManager.store_user_memory-309"><span class="linenos">309</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.store_user_memory-310"><a href="#AgentMemoryManager.store_user_memory-310"><span class="linenos">310</span></a><span class="sd">            MemoryStorageResult: Structured result with detailed status information</span>
</span><span id="AgentMemoryManager.store_user_memory-311"><a href="#AgentMemoryManager.store_user_memory-311"><span class="linenos">311</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-312"><a href="#AgentMemoryManager.store_user_memory-312"><span class="linenos">312</span></a>        <span class="c1"># Validate that content is provided</span>
</span><span id="AgentMemoryManager.store_user_memory-313"><a href="#AgentMemoryManager.store_user_memory-313"><span class="linenos">313</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="AgentMemoryManager.store_user_memory-314"><a href="#AgentMemoryManager.store_user_memory-314"><span class="linenos">314</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-315"><a href="#AgentMemoryManager.store_user_memory-315"><span class="linenos">315</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">CONTENT_EMPTY</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-316"><a href="#AgentMemoryManager.store_user_memory-316"><span class="linenos">316</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Content is required to store a memory. Please provide the information you want me to remember.&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-317"><a href="#AgentMemoryManager.store_user_memory-317"><span class="linenos">317</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-318"><a href="#AgentMemoryManager.store_user_memory-318"><span class="linenos">318</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-319"><a href="#AgentMemoryManager.store_user_memory-319"><span class="linenos">319</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-320"><a href="#AgentMemoryManager.store_user_memory-320"><span class="linenos">320</span></a>
</span><span id="AgentMemoryManager.store_user_memory-321"><a href="#AgentMemoryManager.store_user_memory-321"><span class="linenos">321</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-322"><a href="#AgentMemoryManager.store_user_memory-322"><span class="linenos">322</span></a>            <span class="c1"># Restate the user fact from first-person to third-person</span>
</span><span id="AgentMemoryManager.store_user_memory-323"><a href="#AgentMemoryManager.store_user_memory-323"><span class="linenos">323</span></a>            <span class="n">restated_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restate_user_fact</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-324"><a href="#AgentMemoryManager.store_user_memory-324"><span class="linenos">324</span></a>            
</span><span id="AgentMemoryManager.store_user_memory-325"><a href="#AgentMemoryManager.store_user_memory-325"><span class="linenos">325</span></a>            <span class="c1"># SIMPLIFIED TOPIC HANDLING: Handle the common cases simply</span>
</span><span id="AgentMemoryManager.store_user_memory-326"><a href="#AgentMemoryManager.store_user_memory-326"><span class="linenos">326</span></a>            <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-327"><a href="#AgentMemoryManager.store_user_memory-327"><span class="linenos">327</span></a>                <span class="c1"># Leave as None - let memory manager auto-classify</span>
</span><span id="AgentMemoryManager.store_user_memory-328"><a href="#AgentMemoryManager.store_user_memory-328"><span class="linenos">328</span></a>                <span class="k">pass</span>
</span><span id="AgentMemoryManager.store_user_memory-329"><a href="#AgentMemoryManager.store_user_memory-329"><span class="linenos">329</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager.store_user_memory-330"><a href="#AgentMemoryManager.store_user_memory-330"><span class="linenos">330</span></a>                <span class="c1"># Convert string to list, handle comma-separated values</span>
</span><span id="AgentMemoryManager.store_user_memory-331"><a href="#AgentMemoryManager.store_user_memory-331"><span class="linenos">331</span></a>                <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-332"><a href="#AgentMemoryManager.store_user_memory-332"><span class="linenos">332</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager.store_user_memory-333"><a href="#AgentMemoryManager.store_user_memory-333"><span class="linenos">333</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-334"><a href="#AgentMemoryManager.store_user_memory-334"><span class="linenos">334</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.store_user_memory-335"><a href="#AgentMemoryManager.store_user_memory-335"><span class="linenos">335</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager.store_user_memory-336"><a href="#AgentMemoryManager.store_user_memory-336"><span class="linenos">336</span></a>                <span class="c1"># Clean up list - remove empty entries</span>
</span><span id="AgentMemoryManager.store_user_memory-337"><a href="#AgentMemoryManager.store_user_memory-337"><span class="linenos">337</span></a>                <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager.store_user_memory-338"><a href="#AgentMemoryManager.store_user_memory-338"><span class="linenos">338</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-339"><a href="#AgentMemoryManager.store_user_memory-339"><span class="linenos">339</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.store_user_memory-340"><a href="#AgentMemoryManager.store_user_memory-340"><span class="linenos">340</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-341"><a href="#AgentMemoryManager.store_user_memory-341"><span class="linenos">341</span></a>                <span class="c1"># Convert anything else to string and put in list</span>
</span><span id="AgentMemoryManager.store_user_memory-342"><a href="#AgentMemoryManager.store_user_memory-342"><span class="linenos">342</span></a>                <span class="n">topic_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="AgentMemoryManager.store_user_memory-343"><a href="#AgentMemoryManager.store_user_memory-343"><span class="linenos">343</span></a>                <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_str</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic_str</span> <span class="ow">and</span> <span class="n">topic_str</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.store_user_memory-344"><a href="#AgentMemoryManager.store_user_memory-344"><span class="linenos">344</span></a>
</span><span id="AgentMemoryManager.store_user_memory-345"><a href="#AgentMemoryManager.store_user_memory-345"><span class="linenos">345</span></a>            <span class="c1"># 1. Store in local SQLite memory system</span>
</span><span id="AgentMemoryManager.store_user_memory-346"><a href="#AgentMemoryManager.store_user_memory-346"><span class="linenos">346</span></a>            <span class="n">local_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-347"><a href="#AgentMemoryManager.store_user_memory-347"><span class="linenos">347</span></a>                <span class="n">memory_text</span><span class="o">=</span><span class="n">restated_content</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-348"><a href="#AgentMemoryManager.store_user_memory-348"><span class="linenos">348</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-349"><a href="#AgentMemoryManager.store_user_memory-349"><span class="linenos">349</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-350"><a href="#AgentMemoryManager.store_user_memory-350"><span class="linenos">350</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-351"><a href="#AgentMemoryManager.store_user_memory-351"><span class="linenos">351</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-352"><a href="#AgentMemoryManager.store_user_memory-352"><span class="linenos">352</span></a>
</span><span id="AgentMemoryManager.store_user_memory-353"><a href="#AgentMemoryManager.store_user_memory-353"><span class="linenos">353</span></a>            <span class="c1"># Handle different rejection cases</span>
</span><span id="AgentMemoryManager.store_user_memory-354"><a href="#AgentMemoryManager.store_user_memory-354"><span class="linenos">354</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">local_result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-355"><a href="#AgentMemoryManager.store_user_memory-355"><span class="linenos">355</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Local memory rejected: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">local_result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-356"><a href="#AgentMemoryManager.store_user_memory-356"><span class="linenos">356</span></a>                <span class="c1"># Return the rejection status directly from the memory manager</span>
</span><span id="AgentMemoryManager.store_user_memory-357"><a href="#AgentMemoryManager.store_user_memory-357"><span class="linenos">357</span></a>                <span class="k">return</span> <span class="n">local_result</span>
</span><span id="AgentMemoryManager.store_user_memory-358"><a href="#AgentMemoryManager.store_user_memory-358"><span class="linenos">358</span></a>
</span><span id="AgentMemoryManager.store_user_memory-359"><a href="#AgentMemoryManager.store_user_memory-359"><span class="linenos">359</span></a>            <span class="c1"># Local storage succeeded</span>
</span><span id="AgentMemoryManager.store_user_memory-360"><a href="#AgentMemoryManager.store_user_memory-360"><span class="linenos">360</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-361"><a href="#AgentMemoryManager.store_user_memory-361"><span class="linenos">361</span></a>                <span class="s2">&quot;Stored in local memory: </span><span class="si">%s</span><span class="s2">... (ID: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-362"><a href="#AgentMemoryManager.store_user_memory-362"><span class="linenos">362</span></a>                <span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span>
</span><span id="AgentMemoryManager.store_user_memory-363"><a href="#AgentMemoryManager.store_user_memory-363"><span class="linenos">363</span></a>                <span class="n">local_result</span><span class="o">.</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-364"><a href="#AgentMemoryManager.store_user_memory-364"><span class="linenos">364</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-365"><a href="#AgentMemoryManager.store_user_memory-365"><span class="linenos">365</span></a>
</span><span id="AgentMemoryManager.store_user_memory-366"><a href="#AgentMemoryManager.store_user_memory-366"><span class="linenos">366</span></a>            <span class="c1"># 2. Store in LightRAG graph memory system</span>
</span><span id="AgentMemoryManager.store_user_memory-367"><a href="#AgentMemoryManager.store_user_memory-367"><span class="linenos">367</span></a>            <span class="n">graph_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager.store_user_memory-368"><a href="#AgentMemoryManager.store_user_memory-368"><span class="linenos">368</span></a>            <span class="n">graph_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-369"><a href="#AgentMemoryManager.store_user_memory-369"><span class="linenos">369</span></a>
</span><span id="AgentMemoryManager.store_user_memory-370"><a href="#AgentMemoryManager.store_user_memory-370"><span class="linenos">370</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-371"><a href="#AgentMemoryManager.store_user_memory-371"><span class="linenos">371</span></a>                <span class="c1"># Store in graph memory</span>
</span><span id="AgentMemoryManager.store_user_memory-372"><a href="#AgentMemoryManager.store_user_memory-372"><span class="linenos">372</span></a>                <span class="n">graph_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_graph_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-373"><a href="#AgentMemoryManager.store_user_memory-373"><span class="linenos">373</span></a>                    <span class="n">restated_content</span><span class="p">,</span> <span class="n">local_result</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="n">local_result</span><span class="o">.</span><span class="n">memory_id</span>
</span><span id="AgentMemoryManager.store_user_memory-374"><a href="#AgentMemoryManager.store_user_memory-374"><span class="linenos">374</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-375"><a href="#AgentMemoryManager.store_user_memory-375"><span class="linenos">375</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Graph memory result: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">graph_result</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-376"><a href="#AgentMemoryManager.store_user_memory-376"><span class="linenos">376</span></a>                <span class="k">if</span> <span class="s2">&quot;✅&quot;</span> <span class="ow">in</span> <span class="n">graph_result</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-377"><a href="#AgentMemoryManager.store_user_memory-377"><span class="linenos">377</span></a>                    <span class="n">graph_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AgentMemoryManager.store_user_memory-378"><a href="#AgentMemoryManager.store_user_memory-378"><span class="linenos">378</span></a>                    <span class="n">graph_message</span> <span class="o">=</span> <span class="s2">&quot;Graph memory synced successfully&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-379"><a href="#AgentMemoryManager.store_user_memory-379"><span class="linenos">379</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-380"><a href="#AgentMemoryManager.store_user_memory-380"><span class="linenos">380</span></a>                    <span class="n">graph_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Graph memory sync failed: </span><span class="si">{</span><span class="n">graph_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-381"><a href="#AgentMemoryManager.store_user_memory-381"><span class="linenos">381</span></a>
</span><span id="AgentMemoryManager.store_user_memory-382"><a href="#AgentMemoryManager.store_user_memory-382"><span class="linenos">382</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-383"><a href="#AgentMemoryManager.store_user_memory-383"><span class="linenos">383</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error storing in graph memory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-384"><a href="#AgentMemoryManager.store_user_memory-384"><span class="linenos">384</span></a>                <span class="n">graph_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Graph memory error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-385"><a href="#AgentMemoryManager.store_user_memory-385"><span class="linenos">385</span></a>
</span><span id="AgentMemoryManager.store_user_memory-386"><a href="#AgentMemoryManager.store_user_memory-386"><span class="linenos">386</span></a>            <span class="c1"># Determine final status based on local and graph results</span>
</span><span id="AgentMemoryManager.store_user_memory-387"><a href="#AgentMemoryManager.store_user_memory-387"><span class="linenos">387</span></a>            <span class="k">if</span> <span class="n">graph_success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-388"><a href="#AgentMemoryManager.store_user_memory-388"><span class="linenos">388</span></a>                <span class="n">final_status</span> <span class="o">=</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS</span>
</span><span id="AgentMemoryManager.store_user_memory-389"><a href="#AgentMemoryManager.store_user_memory-389"><span class="linenos">389</span></a>                <span class="n">final_message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-390"><a href="#AgentMemoryManager.store_user_memory-390"><span class="linenos">390</span></a>                    <span class="sa">f</span><span class="s2">&quot;Memory stored successfully in both systems: </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-391"><a href="#AgentMemoryManager.store_user_memory-391"><span class="linenos">391</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-392"><a href="#AgentMemoryManager.store_user_memory-392"><span class="linenos">392</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-393"><a href="#AgentMemoryManager.store_user_memory-393"><span class="linenos">393</span></a>                    <span class="s2">&quot;✅ DUAL STORAGE SUCCESS: Memory stored in both local SQLite and LightRAG graph&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-394"><a href="#AgentMemoryManager.store_user_memory-394"><span class="linenos">394</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-395"><a href="#AgentMemoryManager.store_user_memory-395"><span class="linenos">395</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-396"><a href="#AgentMemoryManager.store_user_memory-396"><span class="linenos">396</span></a>                <span class="n">final_status</span> <span class="o">=</span> <span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">SUCCESS_LOCAL_ONLY</span>
</span><span id="AgentMemoryManager.store_user_memory-397"><a href="#AgentMemoryManager.store_user_memory-397"><span class="linenos">397</span></a>                <span class="n">final_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Memory stored in local system only: </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">... | </span><span class="si">{</span><span class="n">graph_message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-398"><a href="#AgentMemoryManager.store_user_memory-398"><span class="linenos">398</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-399"><a href="#AgentMemoryManager.store_user_memory-399"><span class="linenos">399</span></a>                    <span class="s2">&quot;⚠️ PARTIAL STORAGE: Memory stored in local SQLite only (graph sync failed)&quot;</span>
</span><span id="AgentMemoryManager.store_user_memory-400"><a href="#AgentMemoryManager.store_user_memory-400"><span class="linenos">400</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-401"><a href="#AgentMemoryManager.store_user_memory-401"><span class="linenos">401</span></a>
</span><span id="AgentMemoryManager.store_user_memory-402"><a href="#AgentMemoryManager.store_user_memory-402"><span class="linenos">402</span></a>            <span class="c1"># Return the enhanced result with dual storage information</span>
</span><span id="AgentMemoryManager.store_user_memory-403"><a href="#AgentMemoryManager.store_user_memory-403"><span class="linenos">403</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-404"><a href="#AgentMemoryManager.store_user_memory-404"><span class="linenos">404</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">final_status</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-405"><a href="#AgentMemoryManager.store_user_memory-405"><span class="linenos">405</span></a>                <span class="n">message</span><span class="o">=</span><span class="n">final_message</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-406"><a href="#AgentMemoryManager.store_user_memory-406"><span class="linenos">406</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">local_result</span><span class="o">.</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-407"><a href="#AgentMemoryManager.store_user_memory-407"><span class="linenos">407</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">local_result</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-408"><a href="#AgentMemoryManager.store_user_memory-408"><span class="linenos">408</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-409"><a href="#AgentMemoryManager.store_user_memory-409"><span class="linenos">409</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="n">graph_success</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-410"><a href="#AgentMemoryManager.store_user_memory-410"><span class="linenos">410</span></a>                <span class="n">similarity_score</span><span class="o">=</span><span class="n">local_result</span><span class="o">.</span><span class="n">similarity_score</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-411"><a href="#AgentMemoryManager.store_user_memory-411"><span class="linenos">411</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-412"><a href="#AgentMemoryManager.store_user_memory-412"><span class="linenos">412</span></a>
</span><span id="AgentMemoryManager.store_user_memory-413"><a href="#AgentMemoryManager.store_user_memory-413"><span class="linenos">413</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_user_memory-414"><a href="#AgentMemoryManager.store_user_memory-414"><span class="linenos">414</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error storing user memory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_user_memory-415"><a href="#AgentMemoryManager.store_user_memory-415"><span class="linenos">415</span></a>            <span class="k">return</span> <span class="n">MemoryStorageResult</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_user_memory-416"><a href="#AgentMemoryManager.store_user_memory-416"><span class="linenos">416</span></a>                <span class="n">status</span><span class="o">=</span><span class="n">MemoryStorageStatus</span><span class="o">.</span><span class="n">STORAGE_ERROR</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-417"><a href="#AgentMemoryManager.store_user_memory-417"><span class="linenos">417</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error storing memory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-418"><a href="#AgentMemoryManager.store_user_memory-418"><span class="linenos">418</span></a>                <span class="n">local_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-419"><a href="#AgentMemoryManager.store_user_memory-419"><span class="linenos">419</span></a>                <span class="n">graph_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_user_memory-420"><a href="#AgentMemoryManager.store_user_memory-420"><span class="linenos">420</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Store information as a user memory in BOTH local SQLite and LightRAG graph systems.</p>

<p>Args:
    content: The information to store as a memory
    topics: Optional list of topics/categories for the memory (None = auto-classify)</p>

<p>Returns:
    MemoryStorageResult: Structured result with detailed status information</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.restate_user_fact" class="classattr">
                                        <input id="AgentMemoryManager.restate_user_fact-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">restate_user_fact</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">content</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.restate_user_fact-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.restate_user_fact"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.restate_user_fact-422"><a href="#AgentMemoryManager.restate_user_fact-422"><span class="linenos">422</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">restate_user_fact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.restate_user_fact-423"><a href="#AgentMemoryManager.restate_user_fact-423"><span class="linenos">423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Restate a user fact from first-person to third-person.</span>
</span><span id="AgentMemoryManager.restate_user_fact-424"><a href="#AgentMemoryManager.restate_user_fact-424"><span class="linenos">424</span></a>
</span><span id="AgentMemoryManager.restate_user_fact-425"><a href="#AgentMemoryManager.restate_user_fact-425"><span class="linenos">425</span></a><span class="sd">        This method converts statements like &quot;I have a PhD&quot; to &quot;{user_id} has a PhD&quot;</span>
</span><span id="AgentMemoryManager.restate_user_fact-426"><a href="#AgentMemoryManager.restate_user_fact-426"><span class="linenos">426</span></a><span class="sd">        to ensure correct entity mapping in the knowledge graph.</span>
</span><span id="AgentMemoryManager.restate_user_fact-427"><a href="#AgentMemoryManager.restate_user_fact-427"><span class="linenos">427</span></a>
</span><span id="AgentMemoryManager.restate_user_fact-428"><a href="#AgentMemoryManager.restate_user_fact-428"><span class="linenos">428</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.restate_user_fact-429"><a href="#AgentMemoryManager.restate_user_fact-429"><span class="linenos">429</span></a><span class="sd">            content: The original fact from the user</span>
</span><span id="AgentMemoryManager.restate_user_fact-430"><a href="#AgentMemoryManager.restate_user_fact-430"><span class="linenos">430</span></a>
</span><span id="AgentMemoryManager.restate_user_fact-431"><a href="#AgentMemoryManager.restate_user_fact-431"><span class="linenos">431</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.restate_user_fact-432"><a href="#AgentMemoryManager.restate_user_fact-432"><span class="linenos">432</span></a><span class="sd">            The restated fact</span>
</span><span id="AgentMemoryManager.restate_user_fact-433"><a href="#AgentMemoryManager.restate_user_fact-433"><span class="linenos">433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.restate_user_fact-434"><a href="#AgentMemoryManager.restate_user_fact-434"><span class="linenos">434</span></a>        <span class="c1"># Ensure user_id is a safe string for replacement</span>
</span><span id="AgentMemoryManager.restate_user_fact-435"><a href="#AgentMemoryManager.restate_user_fact-435"><span class="linenos">435</span></a>        <span class="n">user_id_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.restate_user_fact-436"><a href="#AgentMemoryManager.restate_user_fact-436"><span class="linenos">436</span></a>
</span><span id="AgentMemoryManager.restate_user_fact-437"><a href="#AgentMemoryManager.restate_user_fact-437"><span class="linenos">437</span></a>        <span class="c1"># Define regex patterns for pronoun and verb replacement</span>
</span><span id="AgentMemoryManager.restate_user_fact-438"><a href="#AgentMemoryManager.restate_user_fact-438"><span class="linenos">438</span></a>        <span class="c1"># Using word boundaries (\b) to avoid replacing parts of words like &quot;mine&quot; in &quot;mining&quot;</span>
</span><span id="AgentMemoryManager.restate_user_fact-439"><a href="#AgentMemoryManager.restate_user_fact-439"><span class="linenos">439</span></a>        <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager.restate_user_fact-440"><a href="#AgentMemoryManager.restate_user_fact-440"><span class="linenos">440</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI am\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> is&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-441"><a href="#AgentMemoryManager.restate_user_fact-441"><span class="linenos">441</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI was\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> was&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-442"><a href="#AgentMemoryManager.restate_user_fact-442"><span class="linenos">442</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI have\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> has&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-443"><a href="#AgentMemoryManager.restate_user_fact-443"><span class="linenos">443</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI&#39;m\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> is&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-444"><a href="#AgentMemoryManager.restate_user_fact-444"><span class="linenos">444</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI&#39;ve\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2"> has&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-445"><a href="#AgentMemoryManager.restate_user_fact-445"><span class="linenos">445</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bI\b&quot;</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-446"><a href="#AgentMemoryManager.restate_user_fact-446"><span class="linenos">446</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bmy\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2">&#39;s&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-447"><a href="#AgentMemoryManager.restate_user_fact-447"><span class="linenos">447</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bmine\b&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id_str</span><span class="si">}</span><span class="s2">&#39;s&quot;</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-448"><a href="#AgentMemoryManager.restate_user_fact-448"><span class="linenos">448</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bmyself\b&quot;</span><span class="p">,</span> <span class="n">user_id_str</span><span class="p">),</span>
</span><span id="AgentMemoryManager.restate_user_fact-449"><a href="#AgentMemoryManager.restate_user_fact-449"><span class="linenos">449</span></a>        <span class="p">]</span>
</span><span id="AgentMemoryManager.restate_user_fact-450"><a href="#AgentMemoryManager.restate_user_fact-450"><span class="linenos">450</span></a>
</span><span id="AgentMemoryManager.restate_user_fact-451"><a href="#AgentMemoryManager.restate_user_fact-451"><span class="linenos">451</span></a>        <span class="n">restated_content</span> <span class="o">=</span> <span class="n">content</span>
</span><span id="AgentMemoryManager.restate_user_fact-452"><a href="#AgentMemoryManager.restate_user_fact-452"><span class="linenos">452</span></a>        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
</span><span id="AgentMemoryManager.restate_user_fact-453"><a href="#AgentMemoryManager.restate_user_fact-453"><span class="linenos">453</span></a>            <span class="c1"># Use re.IGNORECASE to handle variations like &quot;i&quot; vs &quot;I&quot;</span>
</span><span id="AgentMemoryManager.restate_user_fact-454"><a href="#AgentMemoryManager.restate_user_fact-454"><span class="linenos">454</span></a>            <span class="n">restated_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
</span><span id="AgentMemoryManager.restate_user_fact-455"><a href="#AgentMemoryManager.restate_user_fact-455"><span class="linenos">455</span></a>                <span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">restated_content</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span>
</span><span id="AgentMemoryManager.restate_user_fact-456"><a href="#AgentMemoryManager.restate_user_fact-456"><span class="linenos">456</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.restate_user_fact-457"><a href="#AgentMemoryManager.restate_user_fact-457"><span class="linenos">457</span></a>
</span><span id="AgentMemoryManager.restate_user_fact-458"><a href="#AgentMemoryManager.restate_user_fact-458"><span class="linenos">458</span></a>        <span class="k">return</span> <span class="n">restated_content</span>
</span></pre></div>


            <div class="docstring"><p>Restate a user fact from first-person to third-person.</p>

<p>This method converts statements like "I have a PhD" to "{user_id} has a PhD"
to ensure correct entity mapping in the knowledge graph.</p>

<p>Args:
    content: The original fact from the user</p>

<p>Returns:
    The restated fact</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.seed_entity_in_graph" class="classattr">
                                        <input id="AgentMemoryManager.seed_entity_in_graph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">seed_entity_in_graph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.seed_entity_in_graph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.seed_entity_in_graph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.seed_entity_in_graph-460"><a href="#AgentMemoryManager.seed_entity_in_graph-460"><span class="linenos">460</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">seed_entity_in_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-461"><a href="#AgentMemoryManager.seed_entity_in_graph-461"><span class="linenos">461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Seed an entity into the graph by creating and uploading a physical file.</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-462"><a href="#AgentMemoryManager.seed_entity_in_graph-462"><span class="linenos">462</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-463"><a href="#AgentMemoryManager.seed_entity_in_graph-463"><span class="linenos">463</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-464"><a href="#AgentMemoryManager.seed_entity_in_graph-464"><span class="linenos">464</span></a><span class="sd">            entity_name: Name of the entity to create</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-465"><a href="#AgentMemoryManager.seed_entity_in_graph-465"><span class="linenos">465</span></a><span class="sd">            entity_type: Type of the entity</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-466"><a href="#AgentMemoryManager.seed_entity_in_graph-466"><span class="linenos">466</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-467"><a href="#AgentMemoryManager.seed_entity_in_graph-467"><span class="linenos">467</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-468"><a href="#AgentMemoryManager.seed_entity_in_graph-468"><span class="linenos">468</span></a><span class="sd">            True if entity was successfully seeded</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-469"><a href="#AgentMemoryManager.seed_entity_in_graph-469"><span class="linenos">469</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-470"><a href="#AgentMemoryManager.seed_entity_in_graph-470"><span class="linenos">470</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-471"><a href="#AgentMemoryManager.seed_entity_in_graph-471"><span class="linenos">471</span></a>            <span class="c1"># Create a minimal document to seed the entity</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-472"><a href="#AgentMemoryManager.seed_entity_in_graph-472"><span class="linenos">472</span></a>            <span class="n">seed_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2"> is a </span><span class="si">{</span><span class="n">entity_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-473"><a href="#AgentMemoryManager.seed_entity_in_graph-473"><span class="linenos">473</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-474"><a href="#AgentMemoryManager.seed_entity_in_graph-474"><span class="linenos">474</span></a>            <span class="c1"># Create a unique filename for this entity seed</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-475"><a href="#AgentMemoryManager.seed_entity_in_graph-475"><span class="linenos">475</span></a>            <span class="n">entity_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-476"><a href="#AgentMemoryManager.seed_entity_in_graph-476"><span class="linenos">476</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">entity_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-477"><a href="#AgentMemoryManager.seed_entity_in_graph-477"><span class="linenos">477</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-478"><a href="#AgentMemoryManager.seed_entity_in_graph-478"><span class="linenos">478</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;entity_seed_</span><span class="si">{</span><span class="n">entity_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">entity_hash</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-479"><a href="#AgentMemoryManager.seed_entity_in_graph-479"><span class="linenos">479</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-480"><a href="#AgentMemoryManager.seed_entity_in_graph-480"><span class="linenos">480</span></a>            <span class="c1"># Create a temporary file</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-481"><a href="#AgentMemoryManager.seed_entity_in_graph-481"><span class="linenos">481</span></a>            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-482"><a href="#AgentMemoryManager.seed_entity_in_graph-482"><span class="linenos">482</span></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-483"><a href="#AgentMemoryManager.seed_entity_in_graph-483"><span class="linenos">483</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">temp_file</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-484"><a href="#AgentMemoryManager.seed_entity_in_graph-484"><span class="linenos">484</span></a>                <span class="n">temp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">seed_text</span><span class="p">)</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-485"><a href="#AgentMemoryManager.seed_entity_in_graph-485"><span class="linenos">485</span></a>                <span class="n">temp_file_path</span> <span class="o">=</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-486"><a href="#AgentMemoryManager.seed_entity_in_graph-486"><span class="linenos">486</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-487"><a href="#AgentMemoryManager.seed_entity_in_graph-487"><span class="linenos">487</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-488"><a href="#AgentMemoryManager.seed_entity_in_graph-488"><span class="linenos">488</span></a>                <span class="c1"># Upload the file using the /documents/upload endpoint</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-489"><a href="#AgentMemoryManager.seed_entity_in_graph-489"><span class="linenos">489</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents/upload&quot;</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-490"><a href="#AgentMemoryManager.seed_entity_in_graph-490"><span class="linenos">490</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-491"><a href="#AgentMemoryManager.seed_entity_in_graph-491"><span class="linenos">491</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-492"><a href="#AgentMemoryManager.seed_entity_in_graph-492"><span class="linenos">492</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-493"><a href="#AgentMemoryManager.seed_entity_in_graph-493"><span class="linenos">493</span></a>                        <span class="c1"># Create form data for file upload</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-494"><a href="#AgentMemoryManager.seed_entity_in_graph-494"><span class="linenos">494</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">FormData</span><span class="p">()</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-495"><a href="#AgentMemoryManager.seed_entity_in_graph-495"><span class="linenos">495</span></a>                        <span class="n">data</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-496"><a href="#AgentMemoryManager.seed_entity_in_graph-496"><span class="linenos">496</span></a>                            <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-497"><a href="#AgentMemoryManager.seed_entity_in_graph-497"><span class="linenos">497</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-498"><a href="#AgentMemoryManager.seed_entity_in_graph-498"><span class="linenos">498</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-499"><a href="#AgentMemoryManager.seed_entity_in_graph-499"><span class="linenos">499</span></a>                        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-500"><a href="#AgentMemoryManager.seed_entity_in_graph-500"><span class="linenos">500</span></a>                            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-501"><a href="#AgentMemoryManager.seed_entity_in_graph-501"><span class="linenos">501</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-502"><a href="#AgentMemoryManager.seed_entity_in_graph-502"><span class="linenos">502</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Successfully seeded entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-503"><a href="#AgentMemoryManager.seed_entity_in_graph-503"><span class="linenos">503</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-504"><a href="#AgentMemoryManager.seed_entity_in_graph-504"><span class="linenos">504</span></a>                                <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-505"><a href="#AgentMemoryManager.seed_entity_in_graph-505"><span class="linenos">505</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-506"><a href="#AgentMemoryManager.seed_entity_in_graph-506"><span class="linenos">506</span></a>                                <span class="n">error_detail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-507"><a href="#AgentMemoryManager.seed_entity_in_graph-507"><span class="linenos">507</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-508"><a href="#AgentMemoryManager.seed_entity_in_graph-508"><span class="linenos">508</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Failed to seed entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-509"><a href="#AgentMemoryManager.seed_entity_in_graph-509"><span class="linenos">509</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-510"><a href="#AgentMemoryManager.seed_entity_in_graph-510"><span class="linenos">510</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-511"><a href="#AgentMemoryManager.seed_entity_in_graph-511"><span class="linenos">511</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-512"><a href="#AgentMemoryManager.seed_entity_in_graph-512"><span class="linenos">512</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-513"><a href="#AgentMemoryManager.seed_entity_in_graph-513"><span class="linenos">513</span></a>                <span class="c1"># Clean up the temporary file</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-514"><a href="#AgentMemoryManager.seed_entity_in_graph-514"><span class="linenos">514</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-515"><a href="#AgentMemoryManager.seed_entity_in_graph-515"><span class="linenos">515</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">)</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-516"><a href="#AgentMemoryManager.seed_entity_in_graph-516"><span class="linenos">516</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-517"><a href="#AgentMemoryManager.seed_entity_in_graph-517"><span class="linenos">517</span></a>                    <span class="k">pass</span>  <span class="c1"># Ignore cleanup errors</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-518"><a href="#AgentMemoryManager.seed_entity_in_graph-518"><span class="linenos">518</span></a>
</span><span id="AgentMemoryManager.seed_entity_in_graph-519"><a href="#AgentMemoryManager.seed_entity_in_graph-519"><span class="linenos">519</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-520"><a href="#AgentMemoryManager.seed_entity_in_graph-520"><span class="linenos">520</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error seeding entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.seed_entity_in_graph-521"><a href="#AgentMemoryManager.seed_entity_in_graph-521"><span class="linenos">521</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Seed an entity into the graph by creating and uploading a physical file.</p>

<p>Args:
    entity_name: Name of the entity to create
    entity_type: Type of the entity</p>

<p>Returns:
    True if entity was successfully seeded</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.check_entity_exists" class="classattr">
                                        <input id="AgentMemoryManager.check_entity_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">check_entity_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.check_entity_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.check_entity_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.check_entity_exists-523"><a href="#AgentMemoryManager.check_entity_exists-523"><span class="linenos">523</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_entity_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-524"><a href="#AgentMemoryManager.check_entity_exists-524"><span class="linenos">524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if entity exists in the graph using the correct /graph/entity/exists endpoint.</span>
</span><span id="AgentMemoryManager.check_entity_exists-525"><a href="#AgentMemoryManager.check_entity_exists-525"><span class="linenos">525</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-526"><a href="#AgentMemoryManager.check_entity_exists-526"><span class="linenos">526</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.check_entity_exists-527"><a href="#AgentMemoryManager.check_entity_exists-527"><span class="linenos">527</span></a><span class="sd">            entity_name: Name of the entity to check</span>
</span><span id="AgentMemoryManager.check_entity_exists-528"><a href="#AgentMemoryManager.check_entity_exists-528"><span class="linenos">528</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-529"><a href="#AgentMemoryManager.check_entity_exists-529"><span class="linenos">529</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.check_entity_exists-530"><a href="#AgentMemoryManager.check_entity_exists-530"><span class="linenos">530</span></a><span class="sd">            True if entity exists</span>
</span><span id="AgentMemoryManager.check_entity_exists-531"><a href="#AgentMemoryManager.check_entity_exists-531"><span class="linenos">531</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.check_entity_exists-532"><a href="#AgentMemoryManager.check_entity_exists-532"><span class="linenos">532</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-533"><a href="#AgentMemoryManager.check_entity_exists-533"><span class="linenos">533</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/entity/exists&quot;</span>
</span><span id="AgentMemoryManager.check_entity_exists-534"><a href="#AgentMemoryManager.check_entity_exists-534"><span class="linenos">534</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-535"><a href="#AgentMemoryManager.check_entity_exists-535"><span class="linenos">535</span></a>            <span class="c1"># Try different parameter formats that LightRAG might expect</span>
</span><span id="AgentMemoryManager.check_entity_exists-536"><a href="#AgentMemoryManager.check_entity_exists-536"><span class="linenos">536</span></a>            <span class="n">params_options</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager.check_entity_exists-537"><a href="#AgentMemoryManager.check_entity_exists-537"><span class="linenos">537</span></a>                <span class="p">{</span><span class="s2">&quot;entity_name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">},</span>
</span><span id="AgentMemoryManager.check_entity_exists-538"><a href="#AgentMemoryManager.check_entity_exists-538"><span class="linenos">538</span></a>                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">},</span>
</span><span id="AgentMemoryManager.check_entity_exists-539"><a href="#AgentMemoryManager.check_entity_exists-539"><span class="linenos">539</span></a>                <span class="p">{</span><span class="s2">&quot;entity&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">},</span>
</span><span id="AgentMemoryManager.check_entity_exists-540"><a href="#AgentMemoryManager.check_entity_exists-540"><span class="linenos">540</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager.check_entity_exists-541"><a href="#AgentMemoryManager.check_entity_exists-541"><span class="linenos">541</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-542"><a href="#AgentMemoryManager.check_entity_exists-542"><span class="linenos">542</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-543"><a href="#AgentMemoryManager.check_entity_exists-543"><span class="linenos">543</span></a>                <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">params_options</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-544"><a href="#AgentMemoryManager.check_entity_exists-544"><span class="linenos">544</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-545"><a href="#AgentMemoryManager.check_entity_exists-545"><span class="linenos">545</span></a>                        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-546"><a href="#AgentMemoryManager.check_entity_exists-546"><span class="linenos">546</span></a>                            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-547"><a href="#AgentMemoryManager.check_entity_exists-547"><span class="linenos">547</span></a>                                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager.check_entity_exists-548"><a href="#AgentMemoryManager.check_entity_exists-548"><span class="linenos">548</span></a>                                <span class="c1"># Handle different response formats</span>
</span><span id="AgentMemoryManager.check_entity_exists-549"><a href="#AgentMemoryManager.check_entity_exists-549"><span class="linenos">549</span></a>                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="AgentMemoryManager.check_entity_exists-550"><a href="#AgentMemoryManager.check_entity_exists-550"><span class="linenos">550</span></a>                                    <span class="n">exists</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.check_entity_exists-551"><a href="#AgentMemoryManager.check_entity_exists-551"><span class="linenos">551</span></a>                                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="AgentMemoryManager.check_entity_exists-552"><a href="#AgentMemoryManager.check_entity_exists-552"><span class="linenos">552</span></a>                                    <span class="n">exists</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exists&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgentMemoryManager.check_entity_exists-553"><a href="#AgentMemoryManager.check_entity_exists-553"><span class="linenos">553</span></a>                                        <span class="s2">&quot;found&quot;</span><span class="p">,</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager.check_entity_exists-554"><a href="#AgentMemoryManager.check_entity_exists-554"><span class="linenos">554</span></a>                                    <span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-555"><a href="#AgentMemoryManager.check_entity_exists-555"><span class="linenos">555</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-556"><a href="#AgentMemoryManager.check_entity_exists-556"><span class="linenos">556</span></a>                                    <span class="n">exists</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager.check_entity_exists-557"><a href="#AgentMemoryManager.check_entity_exists-557"><span class="linenos">557</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-558"><a href="#AgentMemoryManager.check_entity_exists-558"><span class="linenos">558</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="AgentMemoryManager.check_entity_exists-559"><a href="#AgentMemoryManager.check_entity_exists-559"><span class="linenos">559</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2"> exists: </span><span class="si">{</span><span class="n">exists</span><span class="si">}</span><span class="s2"> (params: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="AgentMemoryManager.check_entity_exists-560"><a href="#AgentMemoryManager.check_entity_exists-560"><span class="linenos">560</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-561"><a href="#AgentMemoryManager.check_entity_exists-561"><span class="linenos">561</span></a>                                <span class="k">return</span> <span class="n">exists</span>
</span><span id="AgentMemoryManager.check_entity_exists-562"><a href="#AgentMemoryManager.check_entity_exists-562"><span class="linenos">562</span></a>                            <span class="k">elif</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">422</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-563"><a href="#AgentMemoryManager.check_entity_exists-563"><span class="linenos">563</span></a>                                <span class="c1"># Try next parameter format</span>
</span><span id="AgentMemoryManager.check_entity_exists-564"><a href="#AgentMemoryManager.check_entity_exists-564"><span class="linenos">564</span></a>                                <span class="k">continue</span>
</span><span id="AgentMemoryManager.check_entity_exists-565"><a href="#AgentMemoryManager.check_entity_exists-565"><span class="linenos">565</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-566"><a href="#AgentMemoryManager.check_entity_exists-566"><span class="linenos">566</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager.check_entity_exists-567"><a href="#AgentMemoryManager.check_entity_exists-567"><span class="linenos">567</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Failed to check entity existence for </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.check_entity_exists-568"><a href="#AgentMemoryManager.check_entity_exists-568"><span class="linenos">568</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-569"><a href="#AgentMemoryManager.check_entity_exists-569"><span class="linenos">569</span></a>                                <span class="k">break</span>
</span><span id="AgentMemoryManager.check_entity_exists-570"><a href="#AgentMemoryManager.check_entity_exists-570"><span class="linenos">570</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-571"><a href="#AgentMemoryManager.check_entity_exists-571"><span class="linenos">571</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error with params </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-572"><a href="#AgentMemoryManager.check_entity_exists-572"><span class="linenos">572</span></a>                        <span class="k">continue</span>
</span><span id="AgentMemoryManager.check_entity_exists-573"><a href="#AgentMemoryManager.check_entity_exists-573"><span class="linenos">573</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-574"><a href="#AgentMemoryManager.check_entity_exists-574"><span class="linenos">574</span></a>                <span class="c1"># If all parameter formats fail, fall back to label list approach</span>
</span><span id="AgentMemoryManager.check_entity_exists-575"><a href="#AgentMemoryManager.check_entity_exists-575"><span class="linenos">575</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="AgentMemoryManager.check_entity_exists-576"><a href="#AgentMemoryManager.check_entity_exists-576"><span class="linenos">576</span></a>                    <span class="sa">f</span><span class="s2">&quot;All parameter formats failed for </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">, falling back to label list&quot;</span>
</span><span id="AgentMemoryManager.check_entity_exists-577"><a href="#AgentMemoryManager.check_entity_exists-577"><span class="linenos">577</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-578"><a href="#AgentMemoryManager.check_entity_exists-578"><span class="linenos">578</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/label/list&quot;</span>
</span><span id="AgentMemoryManager.check_entity_exists-579"><a href="#AgentMemoryManager.check_entity_exists-579"><span class="linenos">579</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-580"><a href="#AgentMemoryManager.check_entity_exists-580"><span class="linenos">580</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-581"><a href="#AgentMemoryManager.check_entity_exists-581"><span class="linenos">581</span></a>                        <span class="n">labels_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager.check_entity_exists-582"><a href="#AgentMemoryManager.check_entity_exists-582"><span class="linenos">582</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-583"><a href="#AgentMemoryManager.check_entity_exists-583"><span class="linenos">583</span></a>                        <span class="c1"># Handle both response formats: direct array or dict with &#39;labels&#39; key</span>
</span><span id="AgentMemoryManager.check_entity_exists-584"><a href="#AgentMemoryManager.check_entity_exists-584"><span class="linenos">584</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager.check_entity_exists-585"><a href="#AgentMemoryManager.check_entity_exists-585"><span class="linenos">585</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">labels_data</span>
</span><span id="AgentMemoryManager.check_entity_exists-586"><a href="#AgentMemoryManager.check_entity_exists-586"><span class="linenos">586</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;labels&quot;</span> <span class="ow">in</span> <span class="n">labels_data</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-587"><a href="#AgentMemoryManager.check_entity_exists-587"><span class="linenos">587</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">labels_data</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.check_entity_exists-588"><a href="#AgentMemoryManager.check_entity_exists-588"><span class="linenos">588</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-589"><a href="#AgentMemoryManager.check_entity_exists-589"><span class="linenos">589</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.check_entity_exists-590"><a href="#AgentMemoryManager.check_entity_exists-590"><span class="linenos">590</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-591"><a href="#AgentMemoryManager.check_entity_exists-591"><span class="linenos">591</span></a>                        <span class="c1"># Check if entity name exists in labels (case-insensitive)</span>
</span><span id="AgentMemoryManager.check_entity_exists-592"><a href="#AgentMemoryManager.check_entity_exists-592"><span class="linenos">592</span></a>                        <span class="n">exists</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="AgentMemoryManager.check_entity_exists-593"><a href="#AgentMemoryManager.check_entity_exists-593"><span class="linenos">593</span></a>                            <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">all_labels</span>
</span><span id="AgentMemoryManager.check_entity_exists-594"><a href="#AgentMemoryManager.check_entity_exists-594"><span class="linenos">594</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-595"><a href="#AgentMemoryManager.check_entity_exists-595"><span class="linenos">595</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="AgentMemoryManager.check_entity_exists-596"><a href="#AgentMemoryManager.check_entity_exists-596"><span class="linenos">596</span></a>                            <span class="sa">f</span><span class="s2">&quot;Entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2"> exists (via labels): </span><span class="si">{</span><span class="n">exists</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.check_entity_exists-597"><a href="#AgentMemoryManager.check_entity_exists-597"><span class="linenos">597</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-598"><a href="#AgentMemoryManager.check_entity_exists-598"><span class="linenos">598</span></a>                        <span class="k">return</span> <span class="n">exists</span>
</span><span id="AgentMemoryManager.check_entity_exists-599"><a href="#AgentMemoryManager.check_entity_exists-599"><span class="linenos">599</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-600"><a href="#AgentMemoryManager.check_entity_exists-600"><span class="linenos">600</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager.check_entity_exists-601"><a href="#AgentMemoryManager.check_entity_exists-601"><span class="linenos">601</span></a>                            <span class="sa">f</span><span class="s2">&quot;Failed to get graph labels for entity check: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.check_entity_exists-602"><a href="#AgentMemoryManager.check_entity_exists-602"><span class="linenos">602</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-603"><a href="#AgentMemoryManager.check_entity_exists-603"><span class="linenos">603</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentMemoryManager.check_entity_exists-604"><a href="#AgentMemoryManager.check_entity_exists-604"><span class="linenos">604</span></a>
</span><span id="AgentMemoryManager.check_entity_exists-605"><a href="#AgentMemoryManager.check_entity_exists-605"><span class="linenos">605</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.check_entity_exists-606"><a href="#AgentMemoryManager.check_entity_exists-606"><span class="linenos">606</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking entity existence for </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.check_entity_exists-607"><a href="#AgentMemoryManager.check_entity_exists-607"><span class="linenos">607</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check if entity exists in the graph using the correct /graph/entity/exists endpoint.</p>

<p>Args:
    entity_name: Name of the entity to check</p>

<p>Returns:
    True if entity exists</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.clear_all_memories" class="classattr">
                                        <input id="AgentMemoryManager.clear_all_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">clear_all_memories</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.clear_all_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.clear_all_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.clear_all_memories-609"><a href="#AgentMemoryManager.clear_all_memories-609"><span class="linenos">609</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_all_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-610"><a href="#AgentMemoryManager.clear_all_memories-610"><span class="linenos">610</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all memories from both SQLite and LightRAG systems using the centralized service.</span>
</span><span id="AgentMemoryManager.clear_all_memories-611"><a href="#AgentMemoryManager.clear_all_memories-611"><span class="linenos">611</span></a>
</span><span id="AgentMemoryManager.clear_all_memories-612"><a href="#AgentMemoryManager.clear_all_memories-612"><span class="linenos">612</span></a><span class="sd">        This method provides a complete reset of the dual memory system by:</span>
</span><span id="AgentMemoryManager.clear_all_memories-613"><a href="#AgentMemoryManager.clear_all_memories-613"><span class="linenos">613</span></a><span class="sd">        1. Clearing all memories from the local SQLite database</span>
</span><span id="AgentMemoryManager.clear_all_memories-614"><a href="#AgentMemoryManager.clear_all_memories-614"><span class="linenos">614</span></a><span class="sd">        2. Clearing all documents from the LightRAG memory server</span>
</span><span id="AgentMemoryManager.clear_all_memories-615"><a href="#AgentMemoryManager.clear_all_memories-615"><span class="linenos">615</span></a><span class="sd">        3. Clearing the memory_inputs directory (NEW)</span>
</span><span id="AgentMemoryManager.clear_all_memories-616"><a href="#AgentMemoryManager.clear_all_memories-616"><span class="linenos">616</span></a><span class="sd">        4. Deleting the knowledge graph file</span>
</span><span id="AgentMemoryManager.clear_all_memories-617"><a href="#AgentMemoryManager.clear_all_memories-617"><span class="linenos">617</span></a><span class="sd">        5. Clearing server cache</span>
</span><span id="AgentMemoryManager.clear_all_memories-618"><a href="#AgentMemoryManager.clear_all_memories-618"><span class="linenos">618</span></a>
</span><span id="AgentMemoryManager.clear_all_memories-619"><a href="#AgentMemoryManager.clear_all_memories-619"><span class="linenos">619</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.clear_all_memories-620"><a href="#AgentMemoryManager.clear_all_memories-620"><span class="linenos">620</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgentMemoryManager.clear_all_memories-621"><a href="#AgentMemoryManager.clear_all_memories-621"><span class="linenos">621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.clear_all_memories-622"><a href="#AgentMemoryManager.clear_all_memories-622"><span class="linenos">622</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-623"><a href="#AgentMemoryManager.clear_all_memories-623"><span class="linenos">623</span></a>            <span class="c1"># Import the centralized clearing service</span>
</span><span id="AgentMemoryManager.clear_all_memories-624"><a href="#AgentMemoryManager.clear_all_memories-624"><span class="linenos">624</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">..core.memory_clearing_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemoryClearingService</span><span class="p">,</span> <span class="n">ClearingOptions</span>
</span><span id="AgentMemoryManager.clear_all_memories-625"><a href="#AgentMemoryManager.clear_all_memories-625"><span class="linenos">625</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-626"><a href="#AgentMemoryManager.clear_all_memories-626"><span class="linenos">626</span></a>            <span class="c1"># Create the clearing service</span>
</span><span id="AgentMemoryManager.clear_all_memories-627"><a href="#AgentMemoryManager.clear_all_memories-627"><span class="linenos">627</span></a>            <span class="n">clearing_service</span> <span class="o">=</span> <span class="n">MemoryClearingService</span><span class="p">(</span>
</span><span id="AgentMemoryManager.clear_all_memories-628"><a href="#AgentMemoryManager.clear_all_memories-628"><span class="linenos">628</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.clear_all_memories-629"><a href="#AgentMemoryManager.clear_all_memories-629"><span class="linenos">629</span></a>                <span class="n">agno_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="p">,</span>
</span><span id="AgentMemoryManager.clear_all_memories-630"><a href="#AgentMemoryManager.clear_all_memories-630"><span class="linenos">630</span></a>                <span class="n">lightrag_memory_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">,</span>
</span><span id="AgentMemoryManager.clear_all_memories-631"><a href="#AgentMemoryManager.clear_all_memories-631"><span class="linenos">631</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Keep quiet for agent use</span>
</span><span id="AgentMemoryManager.clear_all_memories-632"><a href="#AgentMemoryManager.clear_all_memories-632"><span class="linenos">632</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-633"><a href="#AgentMemoryManager.clear_all_memories-633"><span class="linenos">633</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-634"><a href="#AgentMemoryManager.clear_all_memories-634"><span class="linenos">634</span></a>            <span class="c1"># Create clearing options</span>
</span><span id="AgentMemoryManager.clear_all_memories-635"><a href="#AgentMemoryManager.clear_all_memories-635"><span class="linenos">635</span></a>            <span class="n">options</span> <span class="o">=</span> <span class="n">ClearingOptions</span><span class="p">(</span>
</span><span id="AgentMemoryManager.clear_all_memories-636"><a href="#AgentMemoryManager.clear_all_memories-636"><span class="linenos">636</span></a>                <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager.clear_all_memories-637"><a href="#AgentMemoryManager.clear_all_memories-637"><span class="linenos">637</span></a>                <span class="n">semantic_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager.clear_all_memories-638"><a href="#AgentMemoryManager.clear_all_memories-638"><span class="linenos">638</span></a>                <span class="n">lightrag_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AgentMemoryManager.clear_all_memories-639"><a href="#AgentMemoryManager.clear_all_memories-639"><span class="linenos">639</span></a>                <span class="n">include_memory_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># NEW: Include memory inputs clearing</span>
</span><span id="AgentMemoryManager.clear_all_memories-640"><a href="#AgentMemoryManager.clear_all_memories-640"><span class="linenos">640</span></a>                <span class="n">include_knowledge_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.clear_all_memories-641"><a href="#AgentMemoryManager.clear_all_memories-641"><span class="linenos">641</span></a>                <span class="n">include_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.clear_all_memories-642"><a href="#AgentMemoryManager.clear_all_memories-642"><span class="linenos">642</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="AgentMemoryManager.clear_all_memories-643"><a href="#AgentMemoryManager.clear_all_memories-643"><span class="linenos">643</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-644"><a href="#AgentMemoryManager.clear_all_memories-644"><span class="linenos">644</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-645"><a href="#AgentMemoryManager.clear_all_memories-645"><span class="linenos">645</span></a>            <span class="c1"># Use the centralized service to clear all memories</span>
</span><span id="AgentMemoryManager.clear_all_memories-646"><a href="#AgentMemoryManager.clear_all_memories-646"><span class="linenos">646</span></a>            <span class="n">service_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">clearing_service</span><span class="o">.</span><span class="n">clear_all_memories</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-647"><a href="#AgentMemoryManager.clear_all_memories-647"><span class="linenos">647</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-648"><a href="#AgentMemoryManager.clear_all_memories-648"><span class="linenos">648</span></a>            <span class="c1"># Convert service results to user-friendly messages</span>
</span><span id="AgentMemoryManager.clear_all_memories-649"><a href="#AgentMemoryManager.clear_all_memories-649"><span class="linenos">649</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.clear_all_memories-650"><a href="#AgentMemoryManager.clear_all_memories-650"><span class="linenos">650</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-651"><a href="#AgentMemoryManager.clear_all_memories-651"><span class="linenos">651</span></a>            <span class="c1"># Process semantic memory results</span>
</span><span id="AgentMemoryManager.clear_all_memories-652"><a href="#AgentMemoryManager.clear_all_memories-652"><span class="linenos">652</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager.clear_all_memories-653"><a href="#AgentMemoryManager.clear_all_memories-653"><span class="linenos">653</span></a>                <span class="n">semantic_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.clear_all_memories-654"><a href="#AgentMemoryManager.clear_all_memories-654"><span class="linenos">654</span></a>                <span class="k">if</span> <span class="n">semantic_result</span> <span class="ow">and</span> <span class="n">semantic_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-655"><a href="#AgentMemoryManager.clear_all_memories-655"><span class="linenos">655</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Local memory: </span><span class="si">{</span><span class="n">semantic_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-656"><a href="#AgentMemoryManager.clear_all_memories-656"><span class="linenos">656</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all memories from SQLite for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-657"><a href="#AgentMemoryManager.clear_all_memories-657"><span class="linenos">657</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-658"><a href="#AgentMemoryManager.clear_all_memories-658"><span class="linenos">658</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">semantic_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">semantic_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager.clear_all_memories-659"><a href="#AgentMemoryManager.clear_all_memories-659"><span class="linenos">659</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Local memory error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-660"><a href="#AgentMemoryManager.clear_all_memories-660"><span class="linenos">660</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear memories from SQLite: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-661"><a href="#AgentMemoryManager.clear_all_memories-661"><span class="linenos">661</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-662"><a href="#AgentMemoryManager.clear_all_memories-662"><span class="linenos">662</span></a>            <span class="c1"># Process LightRAG memory results</span>
</span><span id="AgentMemoryManager.clear_all_memories-663"><a href="#AgentMemoryManager.clear_all_memories-663"><span class="linenos">663</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager.clear_all_memories-664"><a href="#AgentMemoryManager.clear_all_memories-664"><span class="linenos">664</span></a>                <span class="n">lightrag_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.clear_all_memories-665"><a href="#AgentMemoryManager.clear_all_memories-665"><span class="linenos">665</span></a>                <span class="k">if</span> <span class="n">lightrag_result</span> <span class="ow">and</span> <span class="n">lightrag_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-666"><a href="#AgentMemoryManager.clear_all_memories-666"><span class="linenos">666</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Graph memory: </span><span class="si">{</span><span class="n">lightrag_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-667"><a href="#AgentMemoryManager.clear_all_memories-667"><span class="linenos">667</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all memories from LightRAG&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-668"><a href="#AgentMemoryManager.clear_all_memories-668"><span class="linenos">668</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-669"><a href="#AgentMemoryManager.clear_all_memories-669"><span class="linenos">669</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">lightrag_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">lightrag_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager.clear_all_memories-670"><a href="#AgentMemoryManager.clear_all_memories-670"><span class="linenos">670</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Graph memory error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-671"><a href="#AgentMemoryManager.clear_all_memories-671"><span class="linenos">671</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear memories from LightRAG: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-672"><a href="#AgentMemoryManager.clear_all_memories-672"><span class="linenos">672</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-673"><a href="#AgentMemoryManager.clear_all_memories-673"><span class="linenos">673</span></a>            <span class="c1"># Process memory inputs results (NEW)</span>
</span><span id="AgentMemoryManager.clear_all_memories-674"><a href="#AgentMemoryManager.clear_all_memories-674"><span class="linenos">674</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;memory_inputs&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager.clear_all_memories-675"><a href="#AgentMemoryManager.clear_all_memories-675"><span class="linenos">675</span></a>                <span class="n">inputs_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;memory_inputs&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.clear_all_memories-676"><a href="#AgentMemoryManager.clear_all_memories-676"><span class="linenos">676</span></a>                <span class="k">if</span> <span class="n">inputs_result</span> <span class="ow">and</span> <span class="n">inputs_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-677"><a href="#AgentMemoryManager.clear_all_memories-677"><span class="linenos">677</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Memory inputs: </span><span class="si">{</span><span class="n">inputs_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-678"><a href="#AgentMemoryManager.clear_all_memories-678"><span class="linenos">678</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared memory inputs directory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-679"><a href="#AgentMemoryManager.clear_all_memories-679"><span class="linenos">679</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-680"><a href="#AgentMemoryManager.clear_all_memories-680"><span class="linenos">680</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">inputs_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">inputs_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager.clear_all_memories-681"><a href="#AgentMemoryManager.clear_all_memories-681"><span class="linenos">681</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Memory inputs error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-682"><a href="#AgentMemoryManager.clear_all_memories-682"><span class="linenos">682</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear memory inputs: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-683"><a href="#AgentMemoryManager.clear_all_memories-683"><span class="linenos">683</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-684"><a href="#AgentMemoryManager.clear_all_memories-684"><span class="linenos">684</span></a>            <span class="c1"># Process knowledge graph results</span>
</span><span id="AgentMemoryManager.clear_all_memories-685"><a href="#AgentMemoryManager.clear_all_memories-685"><span class="linenos">685</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;knowledge_graph&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager.clear_all_memories-686"><a href="#AgentMemoryManager.clear_all_memories-686"><span class="linenos">686</span></a>                <span class="n">graph_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;knowledge_graph&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.clear_all_memories-687"><a href="#AgentMemoryManager.clear_all_memories-687"><span class="linenos">687</span></a>                <span class="k">if</span> <span class="n">graph_result</span> <span class="ow">and</span> <span class="n">graph_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-688"><a href="#AgentMemoryManager.clear_all_memories-688"><span class="linenos">688</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Knowledge graph: </span><span class="si">{</span><span class="n">graph_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-689"><a href="#AgentMemoryManager.clear_all_memories-689"><span class="linenos">689</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted knowledge graph files&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-690"><a href="#AgentMemoryManager.clear_all_memories-690"><span class="linenos">690</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-691"><a href="#AgentMemoryManager.clear_all_memories-691"><span class="linenos">691</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">graph_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">graph_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager.clear_all_memories-692"><a href="#AgentMemoryManager.clear_all_memories-692"><span class="linenos">692</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Knowledge graph error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-693"><a href="#AgentMemoryManager.clear_all_memories-693"><span class="linenos">693</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to delete knowledge graph files: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-694"><a href="#AgentMemoryManager.clear_all_memories-694"><span class="linenos">694</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-695"><a href="#AgentMemoryManager.clear_all_memories-695"><span class="linenos">695</span></a>            <span class="c1"># Process server cache results</span>
</span><span id="AgentMemoryManager.clear_all_memories-696"><a href="#AgentMemoryManager.clear_all_memories-696"><span class="linenos">696</span></a>            <span class="k">if</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;server_cache&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="AgentMemoryManager.clear_all_memories-697"><a href="#AgentMemoryManager.clear_all_memories-697"><span class="linenos">697</span></a>                <span class="n">cache_result</span> <span class="o">=</span> <span class="n">service_results</span><span class="p">[</span><span class="s2">&quot;server_cache&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.clear_all_memories-698"><a href="#AgentMemoryManager.clear_all_memories-698"><span class="linenos">698</span></a>                <span class="k">if</span> <span class="n">cache_result</span> <span class="ow">and</span> <span class="n">cache_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-699"><a href="#AgentMemoryManager.clear_all_memories-699"><span class="linenos">699</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Server cache: </span><span class="si">{</span><span class="n">cache_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-700"><a href="#AgentMemoryManager.clear_all_memories-700"><span class="linenos">700</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared server cache&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-701"><a href="#AgentMemoryManager.clear_all_memories-701"><span class="linenos">701</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-702"><a href="#AgentMemoryManager.clear_all_memories-702"><span class="linenos">702</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">cache_result</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="n">cache_result</span> <span class="k">else</span> <span class="s2">&quot;Unknown error&quot;</span>
</span><span id="AgentMemoryManager.clear_all_memories-703"><a href="#AgentMemoryManager.clear_all_memories-703"><span class="linenos">703</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Server cache error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-704"><a href="#AgentMemoryManager.clear_all_memories-704"><span class="linenos">704</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clear server cache: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-705"><a href="#AgentMemoryManager.clear_all_memories-705"><span class="linenos">705</span></a>            
</span><span id="AgentMemoryManager.clear_all_memories-706"><a href="#AgentMemoryManager.clear_all_memories-706"><span class="linenos">706</span></a>            <span class="c1"># Return combined results</span>
</span><span id="AgentMemoryManager.clear_all_memories-707"><a href="#AgentMemoryManager.clear_all_memories-707"><span class="linenos">707</span></a>            <span class="k">return</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-708"><a href="#AgentMemoryManager.clear_all_memories-708"><span class="linenos">708</span></a>
</span><span id="AgentMemoryManager.clear_all_memories-709"><a href="#AgentMemoryManager.clear_all_memories-709"><span class="linenos">709</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.clear_all_memories-710"><a href="#AgentMemoryManager.clear_all_memories-710"><span class="linenos">710</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error clearing all memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.clear_all_memories-711"><a href="#AgentMemoryManager.clear_all_memories-711"><span class="linenos">711</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error clearing all memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Clear all memories from both SQLite and LightRAG systems using the centralized service.</p>

<p>This method provides a complete reset of the dual memory system by:</p>

<ol>
<li>Clearing all memories from the local SQLite database</li>
<li>Clearing all documents from the LightRAG memory server</li>
<li>Clearing the memory_inputs directory (NEW)</li>
<li>Deleting the knowledge graph file</li>
<li>Clearing server cache</li>
</ol>

<p>Returns:
    str: Success or error message</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.query_memory" class="classattr">
                                        <input id="AgentMemoryManager.query_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">query_memory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.query_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.query_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.query_memory-716"><a href="#AgentMemoryManager.query_memory-716"><span class="linenos">716</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_memory-717"><a href="#AgentMemoryManager.query_memory-717"><span class="linenos">717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Search user memories using direct SemanticMemoryManager calls.</span>
</span><span id="AgentMemoryManager.query_memory-718"><a href="#AgentMemoryManager.query_memory-718"><span class="linenos">718</span></a>
</span><span id="AgentMemoryManager.query_memory-719"><a href="#AgentMemoryManager.query_memory-719"><span class="linenos">719</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.query_memory-720"><a href="#AgentMemoryManager.query_memory-720"><span class="linenos">720</span></a><span class="sd">            query: The query to search for in memories</span>
</span><span id="AgentMemoryManager.query_memory-721"><a href="#AgentMemoryManager.query_memory-721"><span class="linenos">721</span></a><span class="sd">            limit: Maximum number of memories to return</span>
</span><span id="AgentMemoryManager.query_memory-722"><a href="#AgentMemoryManager.query_memory-722"><span class="linenos">722</span></a>
</span><span id="AgentMemoryManager.query_memory-723"><a href="#AgentMemoryManager.query_memory-723"><span class="linenos">723</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.query_memory-724"><a href="#AgentMemoryManager.query_memory-724"><span class="linenos">724</span></a><span class="sd">            str: Found memories or message if none found</span>
</span><span id="AgentMemoryManager.query_memory-725"><a href="#AgentMemoryManager.query_memory-725"><span class="linenos">725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.query_memory-726"><a href="#AgentMemoryManager.query_memory-726"><span class="linenos">726</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_memory-727"><a href="#AgentMemoryManager.query_memory-727"><span class="linenos">727</span></a>            <span class="n">stripped_query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="AgentMemoryManager.query_memory-728"><a href="#AgentMemoryManager.query_memory-728"><span class="linenos">728</span></a>
</span><span id="AgentMemoryManager.query_memory-729"><a href="#AgentMemoryManager.query_memory-729"><span class="linenos">729</span></a>            <span class="c1"># List of phrases that should trigger get_all_memories instead of search</span>
</span><span id="AgentMemoryManager.query_memory-730"><a href="#AgentMemoryManager.query_memory-730"><span class="linenos">730</span></a>            <span class="n">get_all_phrases</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager.query_memory-731"><a href="#AgentMemoryManager.query_memory-731"><span class="linenos">731</span></a>                <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-732"><a href="#AgentMemoryManager.query_memory-732"><span class="linenos">732</span></a>                <span class="s2">&quot;all memories&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-733"><a href="#AgentMemoryManager.query_memory-733"><span class="linenos">733</span></a>                <span class="s2">&quot;everything&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-734"><a href="#AgentMemoryManager.query_memory-734"><span class="linenos">734</span></a>                <span class="s2">&quot;summarize all memories&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-735"><a href="#AgentMemoryManager.query_memory-735"><span class="linenos">735</span></a>                <span class="s2">&quot;what do you know about me&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-736"><a href="#AgentMemoryManager.query_memory-736"><span class="linenos">736</span></a>                <span class="s2">&quot;what have i told you&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-737"><a href="#AgentMemoryManager.query_memory-737"><span class="linenos">737</span></a>                <span class="s2">&quot;list all memories&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-738"><a href="#AgentMemoryManager.query_memory-738"><span class="linenos">738</span></a>                <span class="s2">&quot;show all memories&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-739"><a href="#AgentMemoryManager.query_memory-739"><span class="linenos">739</span></a>                <span class="s2">&quot;tell me everything&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-740"><a href="#AgentMemoryManager.query_memory-740"><span class="linenos">740</span></a>                <span class="s2">&quot;list everything you know&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-741"><a href="#AgentMemoryManager.query_memory-741"><span class="linenos">741</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager.query_memory-742"><a href="#AgentMemoryManager.query_memory-742"><span class="linenos">742</span></a>
</span><span id="AgentMemoryManager.query_memory-743"><a href="#AgentMemoryManager.query_memory-743"><span class="linenos">743</span></a>            <span class="k">if</span> <span class="n">stripped_query</span> <span class="ow">in</span> <span class="n">get_all_phrases</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_memory-744"><a href="#AgentMemoryManager.query_memory-744"><span class="linenos">744</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.query_memory-745"><a href="#AgentMemoryManager.query_memory-745"><span class="linenos">745</span></a>                    <span class="s2">&quot;Generic query &#39;</span><span class="si">%s</span><span class="s2">&#39; detected. Delegating to get_all_memories.&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-746"><a href="#AgentMemoryManager.query_memory-746"><span class="linenos">746</span></a>                    <span class="n">query</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-747"><a href="#AgentMemoryManager.query_memory-747"><span class="linenos">747</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.query_memory-748"><a href="#AgentMemoryManager.query_memory-748"><span class="linenos">748</span></a>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">()</span>
</span><span id="AgentMemoryManager.query_memory-749"><a href="#AgentMemoryManager.query_memory-749"><span class="linenos">749</span></a>
</span><span id="AgentMemoryManager.query_memory-750"><a href="#AgentMemoryManager.query_memory-750"><span class="linenos">750</span></a>            <span class="c1"># Validate query parameter</span>
</span><span id="AgentMemoryManager.query_memory-751"><a href="#AgentMemoryManager.query_memory-751"><span class="linenos">751</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="AgentMemoryManager.query_memory-752"><a href="#AgentMemoryManager.query_memory-752"><span class="linenos">752</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Empty query provided to query_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_memory-753"><a href="#AgentMemoryManager.query_memory-753"><span class="linenos">753</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Error: Query cannot be empty. Please provide a search term.&quot;</span>
</span><span id="AgentMemoryManager.query_memory-754"><a href="#AgentMemoryManager.query_memory-754"><span class="linenos">754</span></a>
</span><span id="AgentMemoryManager.query_memory-755"><a href="#AgentMemoryManager.query_memory-755"><span class="linenos">755</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.search_memories()</span>
</span><span id="AgentMemoryManager.query_memory-756"><a href="#AgentMemoryManager.query_memory-756"><span class="linenos">756</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">search_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager.query_memory-757"><a href="#AgentMemoryManager.query_memory-757"><span class="linenos">757</span></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="AgentMemoryManager.query_memory-758"><a href="#AgentMemoryManager.query_memory-758"><span class="linenos">758</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-759"><a href="#AgentMemoryManager.query_memory-759"><span class="linenos">759</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-760"><a href="#AgentMemoryManager.query_memory-760"><span class="linenos">760</span></a>                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-761"><a href="#AgentMemoryManager.query_memory-761"><span class="linenos">761</span></a>                <span class="n">similarity_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-762"><a href="#AgentMemoryManager.query_memory-762"><span class="linenos">762</span></a>                <span class="n">search_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-763"><a href="#AgentMemoryManager.query_memory-763"><span class="linenos">763</span></a>                <span class="n">topic_boost</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_memory-764"><a href="#AgentMemoryManager.query_memory-764"><span class="linenos">764</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.query_memory-765"><a href="#AgentMemoryManager.query_memory-765"><span class="linenos">765</span></a>
</span><span id="AgentMemoryManager.query_memory-766"><a href="#AgentMemoryManager.query_memory-766"><span class="linenos">766</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_memory-767"><a href="#AgentMemoryManager.query_memory-767"><span class="linenos">767</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No matching memories found for query: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_memory-768"><a href="#AgentMemoryManager.query_memory-768"><span class="linenos">768</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🔍 No memories found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. Try different keywords or ask me to remember something new!&quot;</span>
</span><span id="AgentMemoryManager.query_memory-769"><a href="#AgentMemoryManager.query_memory-769"><span class="linenos">769</span></a>
</span><span id="AgentMemoryManager.query_memory-770"><a href="#AgentMemoryManager.query_memory-770"><span class="linenos">770</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager.query_memory-771"><a href="#AgentMemoryManager.query_memory-771"><span class="linenos">771</span></a>            <span class="n">display_memories</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="n">results</span>
</span><span id="AgentMemoryManager.query_memory-772"><a href="#AgentMemoryManager.query_memory-772"><span class="linenos">772</span></a>            <span class="n">result_note</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🧠 MEMORY RETRIEVAL (found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> matches via semantic search)&quot;</span>
</span><span id="AgentMemoryManager.query_memory-773"><a href="#AgentMemoryManager.query_memory-773"><span class="linenos">773</span></a>
</span><span id="AgentMemoryManager.query_memory-774"><a href="#AgentMemoryManager.query_memory-774"><span class="linenos">774</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_note</span><span class="si">}</span><span class="s2">: The following memories were found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. You must restate this information addressing the user as &#39;you&#39; (second person), not as if you are the user:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.query_memory-775"><a href="#AgentMemoryManager.query_memory-775"><span class="linenos">775</span></a>
</span><span id="AgentMemoryManager.query_memory-776"><a href="#AgentMemoryManager.query_memory-776"><span class="linenos">776</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">display_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager.query_memory-777"><a href="#AgentMemoryManager.query_memory-777"><span class="linenos">777</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="s2"> (similarity: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.query_memory-778"><a href="#AgentMemoryManager.query_memory-778"><span class="linenos">778</span></a>                <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_memory-779"><a href="#AgentMemoryManager.query_memory-779"><span class="linenos">779</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.query_memory-780"><a href="#AgentMemoryManager.query_memory-780"><span class="linenos">780</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.query_memory-781"><a href="#AgentMemoryManager.query_memory-781"><span class="linenos">781</span></a>
</span><span id="AgentMemoryManager.query_memory-782"><a href="#AgentMemoryManager.query_memory-782"><span class="linenos">782</span></a>            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">REMEMBER: Restate this information as an AI assistant talking ABOUT the user, not AS the user. Use &#39;you&#39; instead of &#39;I&#39; when referring to the user&#39;s information.&quot;</span>
</span><span id="AgentMemoryManager.query_memory-783"><a href="#AgentMemoryManager.query_memory-783"><span class="linenos">783</span></a>
</span><span id="AgentMemoryManager.query_memory-784"><a href="#AgentMemoryManager.query_memory-784"><span class="linenos">784</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> matching memories for query: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">query</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_memory-785"><a href="#AgentMemoryManager.query_memory-785"><span class="linenos">785</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.query_memory-786"><a href="#AgentMemoryManager.query_memory-786"><span class="linenos">786</span></a>
</span><span id="AgentMemoryManager.query_memory-787"><a href="#AgentMemoryManager.query_memory-787"><span class="linenos">787</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_memory-788"><a href="#AgentMemoryManager.query_memory-788"><span class="linenos">788</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error querying memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_memory-789"><a href="#AgentMemoryManager.query_memory-789"><span class="linenos">789</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error searching memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Search user memories using direct SemanticMemoryManager calls.</p>

<p>Args:
    query: The query to search for in memories
    limit: Maximum number of memories to return</p>

<p>Returns:
    str: Found memories or message if none found</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.update_memory" class="classattr">
                                        <input id="AgentMemoryManager.update_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">update_memory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">content</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.update_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.update_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.update_memory-791"><a href="#AgentMemoryManager.update_memory-791"><span class="linenos">791</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager.update_memory-792"><a href="#AgentMemoryManager.update_memory-792"><span class="linenos">792</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.update_memory-793"><a href="#AgentMemoryManager.update_memory-793"><span class="linenos">793</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-794"><a href="#AgentMemoryManager.update_memory-794"><span class="linenos">794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an existing memory using direct SemanticMemoryManager calls.</span>
</span><span id="AgentMemoryManager.update_memory-795"><a href="#AgentMemoryManager.update_memory-795"><span class="linenos">795</span></a>
</span><span id="AgentMemoryManager.update_memory-796"><a href="#AgentMemoryManager.update_memory-796"><span class="linenos">796</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.update_memory-797"><a href="#AgentMemoryManager.update_memory-797"><span class="linenos">797</span></a><span class="sd">            memory_id: ID of the memory to update</span>
</span><span id="AgentMemoryManager.update_memory-798"><a href="#AgentMemoryManager.update_memory-798"><span class="linenos">798</span></a><span class="sd">            content: New memory content</span>
</span><span id="AgentMemoryManager.update_memory-799"><a href="#AgentMemoryManager.update_memory-799"><span class="linenos">799</span></a><span class="sd">            topics: Optional list of topics/categories for the memory</span>
</span><span id="AgentMemoryManager.update_memory-800"><a href="#AgentMemoryManager.update_memory-800"><span class="linenos">800</span></a>
</span><span id="AgentMemoryManager.update_memory-801"><a href="#AgentMemoryManager.update_memory-801"><span class="linenos">801</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.update_memory-802"><a href="#AgentMemoryManager.update_memory-802"><span class="linenos">802</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgentMemoryManager.update_memory-803"><a href="#AgentMemoryManager.update_memory-803"><span class="linenos">803</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.update_memory-804"><a href="#AgentMemoryManager.update_memory-804"><span class="linenos">804</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-805"><a href="#AgentMemoryManager.update_memory-805"><span class="linenos">805</span></a>            <span class="c1"># SIMPLIFIED TOPIC HANDLING: Handle the common cases simply</span>
</span><span id="AgentMemoryManager.update_memory-806"><a href="#AgentMemoryManager.update_memory-806"><span class="linenos">806</span></a>            <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-807"><a href="#AgentMemoryManager.update_memory-807"><span class="linenos">807</span></a>                <span class="c1"># Leave as None - let memory manager auto-classify</span>
</span><span id="AgentMemoryManager.update_memory-808"><a href="#AgentMemoryManager.update_memory-808"><span class="linenos">808</span></a>                <span class="k">pass</span>
</span><span id="AgentMemoryManager.update_memory-809"><a href="#AgentMemoryManager.update_memory-809"><span class="linenos">809</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager.update_memory-810"><a href="#AgentMemoryManager.update_memory-810"><span class="linenos">810</span></a>                <span class="c1"># Convert string to list, handle comma-separated values</span>
</span><span id="AgentMemoryManager.update_memory-811"><a href="#AgentMemoryManager.update_memory-811"><span class="linenos">811</span></a>                <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-812"><a href="#AgentMemoryManager.update_memory-812"><span class="linenos">812</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager.update_memory-813"><a href="#AgentMemoryManager.update_memory-813"><span class="linenos">813</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-814"><a href="#AgentMemoryManager.update_memory-814"><span class="linenos">814</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.update_memory-815"><a href="#AgentMemoryManager.update_memory-815"><span class="linenos">815</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager.update_memory-816"><a href="#AgentMemoryManager.update_memory-816"><span class="linenos">816</span></a>                <span class="c1"># Clean up list - remove empty entries</span>
</span><span id="AgentMemoryManager.update_memory-817"><a href="#AgentMemoryManager.update_memory-817"><span class="linenos">817</span></a>                <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager.update_memory-818"><a href="#AgentMemoryManager.update_memory-818"><span class="linenos">818</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-819"><a href="#AgentMemoryManager.update_memory-819"><span class="linenos">819</span></a>                    <span class="n">topics</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.update_memory-820"><a href="#AgentMemoryManager.update_memory-820"><span class="linenos">820</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-821"><a href="#AgentMemoryManager.update_memory-821"><span class="linenos">821</span></a>                <span class="c1"># Convert anything else to string and put in list</span>
</span><span id="AgentMemoryManager.update_memory-822"><a href="#AgentMemoryManager.update_memory-822"><span class="linenos">822</span></a>                <span class="n">topic_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="AgentMemoryManager.update_memory-823"><a href="#AgentMemoryManager.update_memory-823"><span class="linenos">823</span></a>                <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_str</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic_str</span> <span class="ow">and</span> <span class="n">topic_str</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.update_memory-824"><a href="#AgentMemoryManager.update_memory-824"><span class="linenos">824</span></a>
</span><span id="AgentMemoryManager.update_memory-825"><a href="#AgentMemoryManager.update_memory-825"><span class="linenos">825</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.update_memory()</span>
</span><span id="AgentMemoryManager.update_memory-826"><a href="#AgentMemoryManager.update_memory-826"><span class="linenos">826</span></a>            <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">update_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager.update_memory-827"><a href="#AgentMemoryManager.update_memory-827"><span class="linenos">827</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.update_memory-828"><a href="#AgentMemoryManager.update_memory-828"><span class="linenos">828</span></a>                <span class="n">memory_text</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
</span><span id="AgentMemoryManager.update_memory-829"><a href="#AgentMemoryManager.update_memory-829"><span class="linenos">829</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager.update_memory-830"><a href="#AgentMemoryManager.update_memory-830"><span class="linenos">830</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.update_memory-831"><a href="#AgentMemoryManager.update_memory-831"><span class="linenos">831</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="AgentMemoryManager.update_memory-832"><a href="#AgentMemoryManager.update_memory-832"><span class="linenos">832</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.update_memory-833"><a href="#AgentMemoryManager.update_memory-833"><span class="linenos">833</span></a>
</span><span id="AgentMemoryManager.update_memory-834"><a href="#AgentMemoryManager.update_memory-834"><span class="linenos">834</span></a>            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-835"><a href="#AgentMemoryManager.update_memory-835"><span class="linenos">835</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updated memory </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">])</span>
</span><span id="AgentMemoryManager.update_memory-836"><a href="#AgentMemoryManager.update_memory-836"><span class="linenos">836</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ Successfully updated memory: </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="AgentMemoryManager.update_memory-837"><a href="#AgentMemoryManager.update_memory-837"><span class="linenos">837</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-838"><a href="#AgentMemoryManager.update_memory-838"><span class="linenos">838</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to update memory </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="AgentMemoryManager.update_memory-839"><a href="#AgentMemoryManager.update_memory-839"><span class="linenos">839</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error updating memory: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.update_memory-840"><a href="#AgentMemoryManager.update_memory-840"><span class="linenos">840</span></a>
</span><span id="AgentMemoryManager.update_memory-841"><a href="#AgentMemoryManager.update_memory-841"><span class="linenos">841</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.update_memory-842"><a href="#AgentMemoryManager.update_memory-842"><span class="linenos">842</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error updating memory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.update_memory-843"><a href="#AgentMemoryManager.update_memory-843"><span class="linenos">843</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error updating memory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Update an existing memory using direct SemanticMemoryManager calls.</p>

<p>Args:
    memory_id: ID of the memory to update
    content: New memory content
    topics: Optional list of topics/categories for the memory</p>

<p>Returns:
    str: Success or error message</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.delete_memory" class="classattr">
                                        <input id="AgentMemoryManager.delete_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">delete_memory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.delete_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.delete_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.delete_memory-845"><a href="#AgentMemoryManager.delete_memory-845"><span class="linenos">845</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-846"><a href="#AgentMemoryManager.delete_memory-846"><span class="linenos">846</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a memory from both SQLite and LightRAG systems.</span>
</span><span id="AgentMemoryManager.delete_memory-847"><a href="#AgentMemoryManager.delete_memory-847"><span class="linenos">847</span></a>
</span><span id="AgentMemoryManager.delete_memory-848"><a href="#AgentMemoryManager.delete_memory-848"><span class="linenos">848</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.delete_memory-849"><a href="#AgentMemoryManager.delete_memory-849"><span class="linenos">849</span></a><span class="sd">            memory_id: ID of the memory to delete</span>
</span><span id="AgentMemoryManager.delete_memory-850"><a href="#AgentMemoryManager.delete_memory-850"><span class="linenos">850</span></a>
</span><span id="AgentMemoryManager.delete_memory-851"><a href="#AgentMemoryManager.delete_memory-851"><span class="linenos">851</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.delete_memory-852"><a href="#AgentMemoryManager.delete_memory-852"><span class="linenos">852</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgentMemoryManager.delete_memory-853"><a href="#AgentMemoryManager.delete_memory-853"><span class="linenos">853</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.delete_memory-854"><a href="#AgentMemoryManager.delete_memory-854"><span class="linenos">854</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-855"><a href="#AgentMemoryManager.delete_memory-855"><span class="linenos">855</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.delete_memory-856"><a href="#AgentMemoryManager.delete_memory-856"><span class="linenos">856</span></a>
</span><span id="AgentMemoryManager.delete_memory-857"><a href="#AgentMemoryManager.delete_memory-857"><span class="linenos">857</span></a>            <span class="c1"># 1. Delete from local SQLite memory system</span>
</span><span id="AgentMemoryManager.delete_memory-858"><a href="#AgentMemoryManager.delete_memory-858"><span class="linenos">858</span></a>            <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-859"><a href="#AgentMemoryManager.delete_memory-859"><span class="linenos">859</span></a>                <span class="n">memory_id</span><span class="o">=</span><span class="n">memory_id</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager.delete_memory-860"><a href="#AgentMemoryManager.delete_memory-860"><span class="linenos">860</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-861"><a href="#AgentMemoryManager.delete_memory-861"><span class="linenos">861</span></a>
</span><span id="AgentMemoryManager.delete_memory-862"><a href="#AgentMemoryManager.delete_memory-862"><span class="linenos">862</span></a>            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-863"><a href="#AgentMemoryManager.delete_memory-863"><span class="linenos">863</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted memory </span><span class="si">%s</span><span class="s2"> from SQLite&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-864"><a href="#AgentMemoryManager.delete_memory-864"><span class="linenos">864</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;✅ Local memory: Deleted successfully&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-865"><a href="#AgentMemoryManager.delete_memory-865"><span class="linenos">865</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-866"><a href="#AgentMemoryManager.delete_memory-866"><span class="linenos">866</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-867"><a href="#AgentMemoryManager.delete_memory-867"><span class="linenos">867</span></a>                    <span class="s2">&quot;Failed to delete memory </span><span class="si">%s</span><span class="s2"> from SQLite: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">memory_id</span><span class="p">,</span> <span class="n">message</span>
</span><span id="AgentMemoryManager.delete_memory-868"><a href="#AgentMemoryManager.delete_memory-868"><span class="linenos">868</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-869"><a href="#AgentMemoryManager.delete_memory-869"><span class="linenos">869</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Local memory error: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-870"><a href="#AgentMemoryManager.delete_memory-870"><span class="linenos">870</span></a>
</span><span id="AgentMemoryManager.delete_memory-871"><a href="#AgentMemoryManager.delete_memory-871"><span class="linenos">871</span></a>            <span class="c1"># 2. Delete from LightRAG graph memory system</span>
</span><span id="AgentMemoryManager.delete_memory-872"><a href="#AgentMemoryManager.delete_memory-872"><span class="linenos">872</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-873"><a href="#AgentMemoryManager.delete_memory-873"><span class="linenos">873</span></a>                <span class="c1"># Construct the filename pattern to search for</span>
</span><span id="AgentMemoryManager.delete_memory-874"><a href="#AgentMemoryManager.delete_memory-874"><span class="linenos">874</span></a>                <span class="n">filename_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;memory_</span><span class="si">{</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">_*.txt&quot;</span>
</span><span id="AgentMemoryManager.delete_memory-875"><a href="#AgentMemoryManager.delete_memory-875"><span class="linenos">875</span></a>
</span><span id="AgentMemoryManager.delete_memory-876"><a href="#AgentMemoryManager.delete_memory-876"><span class="linenos">876</span></a>                <span class="c1"># Use LightRAG API to find documents matching the pattern</span>
</span><span id="AgentMemoryManager.delete_memory-877"><a href="#AgentMemoryManager.delete_memory-877"><span class="linenos">877</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents&quot;</span>
</span><span id="AgentMemoryManager.delete_memory-878"><a href="#AgentMemoryManager.delete_memory-878"><span class="linenos">878</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-879"><a href="#AgentMemoryManager.delete_memory-879"><span class="linenos">879</span></a>                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-880"><a href="#AgentMemoryManager.delete_memory-880"><span class="linenos">880</span></a>                        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-881"><a href="#AgentMemoryManager.delete_memory-881"><span class="linenos">881</span></a>                            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager.delete_memory-882"><a href="#AgentMemoryManager.delete_memory-882"><span class="linenos">882</span></a>                            <span class="n">all_docs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.delete_memory-883"><a href="#AgentMemoryManager.delete_memory-883"><span class="linenos">883</span></a>
</span><span id="AgentMemoryManager.delete_memory-884"><a href="#AgentMemoryManager.delete_memory-884"><span class="linenos">884</span></a>                            <span class="c1"># Extract documents from response</span>
</span><span id="AgentMemoryManager.delete_memory-885"><a href="#AgentMemoryManager.delete_memory-885"><span class="linenos">885</span></a>                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;statuses&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-886"><a href="#AgentMemoryManager.delete_memory-886"><span class="linenos">886</span></a>                                <span class="n">statuses</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;statuses&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.delete_memory-887"><a href="#AgentMemoryManager.delete_memory-887"><span class="linenos">887</span></a>                                <span class="k">for</span> <span class="n">status_name</span><span class="p">,</span> <span class="n">docs_list</span> <span class="ow">in</span> <span class="n">statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentMemoryManager.delete_memory-888"><a href="#AgentMemoryManager.delete_memory-888"><span class="linenos">888</span></a>                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager.delete_memory-889"><a href="#AgentMemoryManager.delete_memory-889"><span class="linenos">889</span></a>                                        <span class="n">all_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs_list</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-890"><a href="#AgentMemoryManager.delete_memory-890"><span class="linenos">890</span></a>                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;documents&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-891"><a href="#AgentMemoryManager.delete_memory-891"><span class="linenos">891</span></a>                                <span class="n">all_docs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.delete_memory-892"><a href="#AgentMemoryManager.delete_memory-892"><span class="linenos">892</span></a>                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager.delete_memory-893"><a href="#AgentMemoryManager.delete_memory-893"><span class="linenos">893</span></a>                                <span class="n">all_docs</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="AgentMemoryManager.delete_memory-894"><a href="#AgentMemoryManager.delete_memory-894"><span class="linenos">894</span></a>
</span><span id="AgentMemoryManager.delete_memory-895"><a href="#AgentMemoryManager.delete_memory-895"><span class="linenos">895</span></a>                            <span class="c1"># Find documents matching our memory_id pattern</span>
</span><span id="AgentMemoryManager.delete_memory-896"><a href="#AgentMemoryManager.delete_memory-896"><span class="linenos">896</span></a>                            <span class="n">docs_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.delete_memory-897"><a href="#AgentMemoryManager.delete_memory-897"><span class="linenos">897</span></a>                            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-898"><a href="#AgentMemoryManager.delete_memory-898"><span class="linenos">898</span></a>                                <span class="n">file_path</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-899"><a href="#AgentMemoryManager.delete_memory-899"><span class="linenos">899</span></a>                                <span class="k">if</span> <span class="n">file_path</span> <span class="ow">and</span> <span class="sa">f</span><span class="s2">&quot;memory_</span><span class="si">{</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-900"><a href="#AgentMemoryManager.delete_memory-900"><span class="linenos">900</span></a>                                    <span class="n">docs_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-901"><a href="#AgentMemoryManager.delete_memory-901"><span class="linenos">901</span></a>
</span><span id="AgentMemoryManager.delete_memory-902"><a href="#AgentMemoryManager.delete_memory-902"><span class="linenos">902</span></a>                            <span class="k">if</span> <span class="n">docs_to_delete</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-903"><a href="#AgentMemoryManager.delete_memory-903"><span class="linenos">903</span></a>                                <span class="c1"># Delete the matching documents</span>
</span><span id="AgentMemoryManager.delete_memory-904"><a href="#AgentMemoryManager.delete_memory-904"><span class="linenos">904</span></a>                                <span class="n">doc_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs_to_delete</span><span class="p">]</span>
</span><span id="AgentMemoryManager.delete_memory-905"><a href="#AgentMemoryManager.delete_memory-905"><span class="linenos">905</span></a>                                <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;doc_ids&quot;</span><span class="p">:</span> <span class="n">doc_ids</span><span class="p">,</span> <span class="s2">&quot;delete_file&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="AgentMemoryManager.delete_memory-906"><a href="#AgentMemoryManager.delete_memory-906"><span class="linenos">906</span></a>
</span><span id="AgentMemoryManager.delete_memory-907"><a href="#AgentMemoryManager.delete_memory-907"><span class="linenos">907</span></a>                                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-908"><a href="#AgentMemoryManager.delete_memory-908"><span class="linenos">908</span></a>                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents/delete_document&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.delete_memory-909"><a href="#AgentMemoryManager.delete_memory-909"><span class="linenos">909</span></a>                                    <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="AgentMemoryManager.delete_memory-910"><a href="#AgentMemoryManager.delete_memory-910"><span class="linenos">910</span></a>                                    <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span id="AgentMemoryManager.delete_memory-911"><a href="#AgentMemoryManager.delete_memory-911"><span class="linenos">911</span></a>                                <span class="p">)</span> <span class="k">as</span> <span class="n">del_resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-912"><a href="#AgentMemoryManager.delete_memory-912"><span class="linenos">912</span></a>                                    <span class="k">if</span> <span class="n">del_resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-913"><a href="#AgentMemoryManager.delete_memory-913"><span class="linenos">913</span></a>                                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-914"><a href="#AgentMemoryManager.delete_memory-914"><span class="linenos">914</span></a>                                            <span class="s2">&quot;Deleted memory </span><span class="si">%s</span><span class="s2"> from LightRAG&quot;</span><span class="p">,</span> <span class="n">memory_id</span>
</span><span id="AgentMemoryManager.delete_memory-915"><a href="#AgentMemoryManager.delete_memory-915"><span class="linenos">915</span></a>                                        <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-916"><a href="#AgentMemoryManager.delete_memory-916"><span class="linenos">916</span></a>                                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-917"><a href="#AgentMemoryManager.delete_memory-917"><span class="linenos">917</span></a>                                            <span class="s2">&quot;✅ Graph memory: Deleted successfully&quot;</span>
</span><span id="AgentMemoryManager.delete_memory-918"><a href="#AgentMemoryManager.delete_memory-918"><span class="linenos">918</span></a>                                        <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-919"><a href="#AgentMemoryManager.delete_memory-919"><span class="linenos">919</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-920"><a href="#AgentMemoryManager.delete_memory-920"><span class="linenos">920</span></a>                                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">del_resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager.delete_memory-921"><a href="#AgentMemoryManager.delete_memory-921"><span class="linenos">921</span></a>                                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-922"><a href="#AgentMemoryManager.delete_memory-922"><span class="linenos">922</span></a>                                            <span class="s2">&quot;Failed to delete memory </span><span class="si">%s</span><span class="s2"> from LightRAG: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.delete_memory-923"><a href="#AgentMemoryManager.delete_memory-923"><span class="linenos">923</span></a>                                            <span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.delete_memory-924"><a href="#AgentMemoryManager.delete_memory-924"><span class="linenos">924</span></a>                                            <span class="n">error_text</span><span class="p">,</span>
</span><span id="AgentMemoryManager.delete_memory-925"><a href="#AgentMemoryManager.delete_memory-925"><span class="linenos">925</span></a>                                        <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-926"><a href="#AgentMemoryManager.delete_memory-926"><span class="linenos">926</span></a>                                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-927"><a href="#AgentMemoryManager.delete_memory-927"><span class="linenos">927</span></a>                                            <span class="sa">f</span><span class="s2">&quot;❌ Graph memory error: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.delete_memory-928"><a href="#AgentMemoryManager.delete_memory-928"><span class="linenos">928</span></a>                                        <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-929"><a href="#AgentMemoryManager.delete_memory-929"><span class="linenos">929</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-930"><a href="#AgentMemoryManager.delete_memory-930"><span class="linenos">930</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-931"><a href="#AgentMemoryManager.delete_memory-931"><span class="linenos">931</span></a>                                    <span class="s2">&quot;No matching documents found in LightRAG for memory </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.delete_memory-932"><a href="#AgentMemoryManager.delete_memory-932"><span class="linenos">932</span></a>                                    <span class="n">memory_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.delete_memory-933"><a href="#AgentMemoryManager.delete_memory-933"><span class="linenos">933</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-934"><a href="#AgentMemoryManager.delete_memory-934"><span class="linenos">934</span></a>                                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-935"><a href="#AgentMemoryManager.delete_memory-935"><span class="linenos">935</span></a>                                    <span class="s2">&quot;⚠️ Graph memory: No matching documents found&quot;</span>
</span><span id="AgentMemoryManager.delete_memory-936"><a href="#AgentMemoryManager.delete_memory-936"><span class="linenos">936</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-937"><a href="#AgentMemoryManager.delete_memory-937"><span class="linenos">937</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-938"><a href="#AgentMemoryManager.delete_memory-938"><span class="linenos">938</span></a>                            <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager.delete_memory-939"><a href="#AgentMemoryManager.delete_memory-939"><span class="linenos">939</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="AgentMemoryManager.delete_memory-940"><a href="#AgentMemoryManager.delete_memory-940"><span class="linenos">940</span></a>                                <span class="s2">&quot;Failed to get documents from LightRAG: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error_text</span>
</span><span id="AgentMemoryManager.delete_memory-941"><a href="#AgentMemoryManager.delete_memory-941"><span class="linenos">941</span></a>                            <span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-942"><a href="#AgentMemoryManager.delete_memory-942"><span class="linenos">942</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Graph memory error: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-943"><a href="#AgentMemoryManager.delete_memory-943"><span class="linenos">943</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-944"><a href="#AgentMemoryManager.delete_memory-944"><span class="linenos">944</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error deleting from LightRAG: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-945"><a href="#AgentMemoryManager.delete_memory-945"><span class="linenos">945</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Graph memory error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-946"><a href="#AgentMemoryManager.delete_memory-946"><span class="linenos">946</span></a>
</span><span id="AgentMemoryManager.delete_memory-947"><a href="#AgentMemoryManager.delete_memory-947"><span class="linenos">947</span></a>            <span class="c1"># Return combined results</span>
</span><span id="AgentMemoryManager.delete_memory-948"><a href="#AgentMemoryManager.delete_memory-948"><span class="linenos">948</span></a>            <span class="k">return</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-949"><a href="#AgentMemoryManager.delete_memory-949"><span class="linenos">949</span></a>
</span><span id="AgentMemoryManager.delete_memory-950"><a href="#AgentMemoryManager.delete_memory-950"><span class="linenos">950</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.delete_memory-951"><a href="#AgentMemoryManager.delete_memory-951"><span class="linenos">951</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error deleting memory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.delete_memory-952"><a href="#AgentMemoryManager.delete_memory-952"><span class="linenos">952</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error deleting memory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Delete a memory from both SQLite and LightRAG systems.</p>

<p>Args:
    memory_id: ID of the memory to delete</p>

<p>Returns:
    str: Success or error message</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.get_recent_memories" class="classattr">
                                        <input id="AgentMemoryManager.get_recent_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_recent_memories</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.get_recent_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.get_recent_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.get_recent_memories-954"><a href="#AgentMemoryManager.get_recent_memories-954"><span class="linenos"> 954</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_recent_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_recent_memories-955"><a href="#AgentMemoryManager.get_recent_memories-955"><span class="linenos"> 955</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get recent memories by searching all memories and sorting by date.</span>
</span><span id="AgentMemoryManager.get_recent_memories-956"><a href="#AgentMemoryManager.get_recent_memories-956"><span class="linenos"> 956</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-957"><a href="#AgentMemoryManager.get_recent_memories-957"><span class="linenos"> 957</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.get_recent_memories-958"><a href="#AgentMemoryManager.get_recent_memories-958"><span class="linenos"> 958</span></a><span class="sd">            limit: Maximum number of memories to return</span>
</span><span id="AgentMemoryManager.get_recent_memories-959"><a href="#AgentMemoryManager.get_recent_memories-959"><span class="linenos"> 959</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-960"><a href="#AgentMemoryManager.get_recent_memories-960"><span class="linenos"> 960</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.get_recent_memories-961"><a href="#AgentMemoryManager.get_recent_memories-961"><span class="linenos"> 961</span></a><span class="sd">            str: Formatted string of recent memories</span>
</span><span id="AgentMemoryManager.get_recent_memories-962"><a href="#AgentMemoryManager.get_recent_memories-962"><span class="linenos"> 962</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_recent_memories-963"><a href="#AgentMemoryManager.get_recent_memories-963"><span class="linenos"> 963</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_recent_memories-964"><a href="#AgentMemoryManager.get_recent_memories-964"><span class="linenos"> 964</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.get_all_memories()</span>
</span><span id="AgentMemoryManager.get_recent_memories-965"><a href="#AgentMemoryManager.get_recent_memories-965"><span class="linenos"> 965</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_recent_memories-966"><a href="#AgentMemoryManager.get_recent_memories-966"><span class="linenos"> 966</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager.get_recent_memories-967"><a href="#AgentMemoryManager.get_recent_memories-967"><span class="linenos"> 967</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_recent_memories-968"><a href="#AgentMemoryManager.get_recent_memories-968"><span class="linenos"> 968</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-969"><a href="#AgentMemoryManager.get_recent_memories-969"><span class="linenos"> 969</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_recent_memories-970"><a href="#AgentMemoryManager.get_recent_memories-970"><span class="linenos"> 970</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_recent_memories-971"><a href="#AgentMemoryManager.get_recent_memories-971"><span class="linenos"> 971</span></a>                <span class="k">return</span> <span class="s2">&quot;🔍 No memories found. Try storing some information first!&quot;</span>
</span><span id="AgentMemoryManager.get_recent_memories-972"><a href="#AgentMemoryManager.get_recent_memories-972"><span class="linenos"> 972</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-973"><a href="#AgentMemoryManager.get_recent_memories-973"><span class="linenos"> 973</span></a>            <span class="c1"># Sort memories by timestamp (newest first)</span>
</span><span id="AgentMemoryManager.get_recent_memories-974"><a href="#AgentMemoryManager.get_recent_memories-974"><span class="linenos"> 974</span></a>            <span class="n">sorted_memories</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_recent_memories-975"><a href="#AgentMemoryManager.get_recent_memories-975"><span class="linenos"> 975</span></a>                <span class="n">memories</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_recent_memories-976"><a href="#AgentMemoryManager.get_recent_memories-976"><span class="linenos"> 976</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_recent_memories-977"><a href="#AgentMemoryManager.get_recent_memories-977"><span class="linenos"> 977</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_recent_memories-978"><a href="#AgentMemoryManager.get_recent_memories-978"><span class="linenos"> 978</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_recent_memories-979"><a href="#AgentMemoryManager.get_recent_memories-979"><span class="linenos"> 979</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-980"><a href="#AgentMemoryManager.get_recent_memories-980"><span class="linenos"> 980</span></a>            <span class="c1"># Limit the number of memories</span>
</span><span id="AgentMemoryManager.get_recent_memories-981"><a href="#AgentMemoryManager.get_recent_memories-981"><span class="linenos"> 981</span></a>            <span class="n">display_memories</span> <span class="o">=</span> <span class="n">sorted_memories</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="n">sorted_memories</span>
</span><span id="AgentMemoryManager.get_recent_memories-982"><a href="#AgentMemoryManager.get_recent_memories-982"><span class="linenos"> 982</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-983"><a href="#AgentMemoryManager.get_recent_memories-983"><span class="linenos"> 983</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager.get_recent_memories-984"><a href="#AgentMemoryManager.get_recent_memories-984"><span class="linenos"> 984</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🧠 RECENT MEMORIES (showing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">display_memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> total memories):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_recent_memories-985"><a href="#AgentMemoryManager.get_recent_memories-985"><span class="linenos"> 985</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-986"><a href="#AgentMemoryManager.get_recent_memories-986"><span class="linenos"> 986</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">display_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_recent_memories-987"><a href="#AgentMemoryManager.get_recent_memories-987"><span class="linenos"> 987</span></a>                <span class="c1"># Format the memory content</span>
</span><span id="AgentMemoryManager.get_recent_memories-988"><a href="#AgentMemoryManager.get_recent_memories-988"><span class="linenos"> 988</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_recent_memories-989"><a href="#AgentMemoryManager.get_recent_memories-989"><span class="linenos"> 989</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-990"><a href="#AgentMemoryManager.get_recent_memories-990"><span class="linenos"> 990</span></a>                <span class="c1"># Add topics if available</span>
</span><span id="AgentMemoryManager.get_recent_memories-991"><a href="#AgentMemoryManager.get_recent_memories-991"><span class="linenos"> 991</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_recent_memories-992"><a href="#AgentMemoryManager.get_recent_memories-992"><span class="linenos"> 992</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_recent_memories-993"><a href="#AgentMemoryManager.get_recent_memories-993"><span class="linenos"> 993</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-994"><a href="#AgentMemoryManager.get_recent_memories-994"><span class="linenos"> 994</span></a>                <span class="c1"># Add timestamp if available</span>
</span><span id="AgentMemoryManager.get_recent_memories-995"><a href="#AgentMemoryManager.get_recent_memories-995"><span class="linenos"> 995</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_recent_memories-996"><a href="#AgentMemoryManager.get_recent_memories-996"><span class="linenos"> 996</span></a>                    <span class="c1"># Convert timestamp to readable format</span>
</span><span id="AgentMemoryManager.get_recent_memories-997"><a href="#AgentMemoryManager.get_recent_memories-997"><span class="linenos"> 997</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager.get_recent_memories-998"><a href="#AgentMemoryManager.get_recent_memories-998"><span class="linenos"> 998</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-999"><a href="#AgentMemoryManager.get_recent_memories-999"><span class="linenos"> 999</span></a>                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_recent_memories-1000"><a href="#AgentMemoryManager.get_recent_memories-1000"><span class="linenos">1000</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Created: </span><span class="si">{</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_recent_memories-1001"><a href="#AgentMemoryManager.get_recent_memories-1001"><span class="linenos">1001</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-1002"><a href="#AgentMemoryManager.get_recent_memories-1002"><span class="linenos">1002</span></a>                <span class="c1"># Add memory ID for reference</span>
</span><span id="AgentMemoryManager.get_recent_memories-1003"><a href="#AgentMemoryManager.get_recent_memories-1003"><span class="linenos">1003</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   ID: </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_recent_memories-1004"><a href="#AgentMemoryManager.get_recent_memories-1004"><span class="linenos">1004</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-1005"><a href="#AgentMemoryManager.get_recent_memories-1005"><span class="linenos">1005</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_recent_memories-1006"><a href="#AgentMemoryManager.get_recent_memories-1006"><span class="linenos">1006</span></a>                <span class="s2">&quot;Retrieved </span><span class="si">%d</span><span class="s2"> recent memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_recent_memories-1007"><a href="#AgentMemoryManager.get_recent_memories-1007"><span class="linenos">1007</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">display_memories</span><span class="p">),</span>
</span><span id="AgentMemoryManager.get_recent_memories-1008"><a href="#AgentMemoryManager.get_recent_memories-1008"><span class="linenos">1008</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_recent_memories-1009"><a href="#AgentMemoryManager.get_recent_memories-1009"><span class="linenos">1009</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_recent_memories-1010"><a href="#AgentMemoryManager.get_recent_memories-1010"><span class="linenos">1010</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.get_recent_memories-1011"><a href="#AgentMemoryManager.get_recent_memories-1011"><span class="linenos">1011</span></a>
</span><span id="AgentMemoryManager.get_recent_memories-1012"><a href="#AgentMemoryManager.get_recent_memories-1012"><span class="linenos">1012</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_recent_memories-1013"><a href="#AgentMemoryManager.get_recent_memories-1013"><span class="linenos">1013</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving recent memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_recent_memories-1014"><a href="#AgentMemoryManager.get_recent_memories-1014"><span class="linenos">1014</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving recent memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Get recent memories by searching all memories and sorting by date.</p>

<p>Args:
    limit: Maximum number of memories to return</p>

<p>Returns:
    str: Formatted string of recent memories</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.get_all_memories" class="classattr">
                                        <input id="AgentMemoryManager.get_all_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_all_memories</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.get_all_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.get_all_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.get_all_memories-1016"><a href="#AgentMemoryManager.get_all_memories-1016"><span class="linenos">1016</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_all_memories-1017"><a href="#AgentMemoryManager.get_all_memories-1017"><span class="linenos">1017</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all user memories.</span>
</span><span id="AgentMemoryManager.get_all_memories-1018"><a href="#AgentMemoryManager.get_all_memories-1018"><span class="linenos">1018</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1019"><a href="#AgentMemoryManager.get_all_memories-1019"><span class="linenos">1019</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.get_all_memories-1020"><a href="#AgentMemoryManager.get_all_memories-1020"><span class="linenos">1020</span></a><span class="sd">            str: Formatted string of all memories</span>
</span><span id="AgentMemoryManager.get_all_memories-1021"><a href="#AgentMemoryManager.get_all_memories-1021"><span class="linenos">1021</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_all_memories-1022"><a href="#AgentMemoryManager.get_all_memories-1022"><span class="linenos">1022</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_all_memories-1023"><a href="#AgentMemoryManager.get_all_memories-1023"><span class="linenos">1023</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.get_all_memories()</span>
</span><span id="AgentMemoryManager.get_all_memories-1024"><a href="#AgentMemoryManager.get_all_memories-1024"><span class="linenos">1024</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_all_memories-1025"><a href="#AgentMemoryManager.get_all_memories-1025"><span class="linenos">1025</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager.get_all_memories-1026"><a href="#AgentMemoryManager.get_all_memories-1026"><span class="linenos">1026</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_all_memories-1027"><a href="#AgentMemoryManager.get_all_memories-1027"><span class="linenos">1027</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1028"><a href="#AgentMemoryManager.get_all_memories-1028"><span class="linenos">1028</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_all_memories-1029"><a href="#AgentMemoryManager.get_all_memories-1029"><span class="linenos">1029</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_all_memories-1030"><a href="#AgentMemoryManager.get_all_memories-1030"><span class="linenos">1030</span></a>                <span class="k">return</span> <span class="s2">&quot;🔍 No memories found. Try storing some information first!&quot;</span>
</span><span id="AgentMemoryManager.get_all_memories-1031"><a href="#AgentMemoryManager.get_all_memories-1031"><span class="linenos">1031</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1032"><a href="#AgentMemoryManager.get_all_memories-1032"><span class="linenos">1032</span></a>            <span class="c1"># Sort memories by timestamp (newest first)</span>
</span><span id="AgentMemoryManager.get_all_memories-1033"><a href="#AgentMemoryManager.get_all_memories-1033"><span class="linenos">1033</span></a>            <span class="n">sorted_memories</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_all_memories-1034"><a href="#AgentMemoryManager.get_all_memories-1034"><span class="linenos">1034</span></a>                <span class="n">memories</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_all_memories-1035"><a href="#AgentMemoryManager.get_all_memories-1035"><span class="linenos">1035</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_all_memories-1036"><a href="#AgentMemoryManager.get_all_memories-1036"><span class="linenos">1036</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_all_memories-1037"><a href="#AgentMemoryManager.get_all_memories-1037"><span class="linenos">1037</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_all_memories-1038"><a href="#AgentMemoryManager.get_all_memories-1038"><span class="linenos">1038</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1039"><a href="#AgentMemoryManager.get_all_memories-1039"><span class="linenos">1039</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager.get_all_memories-1040"><a href="#AgentMemoryManager.get_all_memories-1040"><span class="linenos">1040</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🧠 ALL MEMORIES (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> total):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_all_memories-1041"><a href="#AgentMemoryManager.get_all_memories-1041"><span class="linenos">1041</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1042"><a href="#AgentMemoryManager.get_all_memories-1042"><span class="linenos">1042</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_all_memories-1043"><a href="#AgentMemoryManager.get_all_memories-1043"><span class="linenos">1043</span></a>                <span class="c1"># Format the memory content</span>
</span><span id="AgentMemoryManager.get_all_memories-1044"><a href="#AgentMemoryManager.get_all_memories-1044"><span class="linenos">1044</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_all_memories-1045"><a href="#AgentMemoryManager.get_all_memories-1045"><span class="linenos">1045</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1046"><a href="#AgentMemoryManager.get_all_memories-1046"><span class="linenos">1046</span></a>                <span class="c1"># Add topics if available</span>
</span><span id="AgentMemoryManager.get_all_memories-1047"><a href="#AgentMemoryManager.get_all_memories-1047"><span class="linenos">1047</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_all_memories-1048"><a href="#AgentMemoryManager.get_all_memories-1048"><span class="linenos">1048</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_all_memories-1049"><a href="#AgentMemoryManager.get_all_memories-1049"><span class="linenos">1049</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1050"><a href="#AgentMemoryManager.get_all_memories-1050"><span class="linenos">1050</span></a>                <span class="c1"># Add timestamp if available</span>
</span><span id="AgentMemoryManager.get_all_memories-1051"><a href="#AgentMemoryManager.get_all_memories-1051"><span class="linenos">1051</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_all_memories-1052"><a href="#AgentMemoryManager.get_all_memories-1052"><span class="linenos">1052</span></a>                    <span class="c1"># Convert timestamp to readable format</span>
</span><span id="AgentMemoryManager.get_all_memories-1053"><a href="#AgentMemoryManager.get_all_memories-1053"><span class="linenos">1053</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager.get_all_memories-1054"><a href="#AgentMemoryManager.get_all_memories-1054"><span class="linenos">1054</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1055"><a href="#AgentMemoryManager.get_all_memories-1055"><span class="linenos">1055</span></a>                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_all_memories-1056"><a href="#AgentMemoryManager.get_all_memories-1056"><span class="linenos">1056</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Created: </span><span class="si">{</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_all_memories-1057"><a href="#AgentMemoryManager.get_all_memories-1057"><span class="linenos">1057</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1058"><a href="#AgentMemoryManager.get_all_memories-1058"><span class="linenos">1058</span></a>                <span class="c1"># Add memory ID for reference</span>
</span><span id="AgentMemoryManager.get_all_memories-1059"><a href="#AgentMemoryManager.get_all_memories-1059"><span class="linenos">1059</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   ID: </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_all_memories-1060"><a href="#AgentMemoryManager.get_all_memories-1060"><span class="linenos">1060</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1061"><a href="#AgentMemoryManager.get_all_memories-1061"><span class="linenos">1061</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_all_memories-1062"><a href="#AgentMemoryManager.get_all_memories-1062"><span class="linenos">1062</span></a>                <span class="s2">&quot;Retrieved all </span><span class="si">%d</span><span class="s2"> memories for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager.get_all_memories-1063"><a href="#AgentMemoryManager.get_all_memories-1063"><span class="linenos">1063</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_all_memories-1064"><a href="#AgentMemoryManager.get_all_memories-1064"><span class="linenos">1064</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.get_all_memories-1065"><a href="#AgentMemoryManager.get_all_memories-1065"><span class="linenos">1065</span></a>
</span><span id="AgentMemoryManager.get_all_memories-1066"><a href="#AgentMemoryManager.get_all_memories-1066"><span class="linenos">1066</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_all_memories-1067"><a href="#AgentMemoryManager.get_all_memories-1067"><span class="linenos">1067</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving all memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_all_memories-1068"><a href="#AgentMemoryManager.get_all_memories-1068"><span class="linenos">1068</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving all memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Get all user memories.</p>

<p>Returns:
    str: Formatted string of all memories</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.get_memory_stats" class="classattr">
                                        <input id="AgentMemoryManager.get_memory_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_memory_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.get_memory_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.get_memory_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.get_memory_stats-1070"><a href="#AgentMemoryManager.get_memory_stats-1070"><span class="linenos">1070</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1071"><a href="#AgentMemoryManager.get_memory_stats-1071"><span class="linenos">1071</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get memory statistics.</span>
</span><span id="AgentMemoryManager.get_memory_stats-1072"><a href="#AgentMemoryManager.get_memory_stats-1072"><span class="linenos">1072</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1073"><a href="#AgentMemoryManager.get_memory_stats-1073"><span class="linenos">1073</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1074"><a href="#AgentMemoryManager.get_memory_stats-1074"><span class="linenos">1074</span></a><span class="sd">            str: Formatted string with memory statistics</span>
</span><span id="AgentMemoryManager.get_memory_stats-1075"><a href="#AgentMemoryManager.get_memory_stats-1075"><span class="linenos">1075</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1076"><a href="#AgentMemoryManager.get_memory_stats-1076"><span class="linenos">1076</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1077"><a href="#AgentMemoryManager.get_memory_stats-1077"><span class="linenos">1077</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.get_all_memories()</span>
</span><span id="AgentMemoryManager.get_memory_stats-1078"><a href="#AgentMemoryManager.get_memory_stats-1078"><span class="linenos">1078</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_stats-1079"><a href="#AgentMemoryManager.get_memory_stats-1079"><span class="linenos">1079</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager.get_memory_stats-1080"><a href="#AgentMemoryManager.get_memory_stats-1080"><span class="linenos">1080</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1081"><a href="#AgentMemoryManager.get_memory_stats-1081"><span class="linenos">1081</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1082"><a href="#AgentMemoryManager.get_memory_stats-1082"><span class="linenos">1082</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1083"><a href="#AgentMemoryManager.get_memory_stats-1083"><span class="linenos">1083</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1084"><a href="#AgentMemoryManager.get_memory_stats-1084"><span class="linenos">1084</span></a>                <span class="k">return</span> <span class="s2">&quot;🔍 No memories found. Try storing some information first!&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1085"><a href="#AgentMemoryManager.get_memory_stats-1085"><span class="linenos">1085</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1086"><a href="#AgentMemoryManager.get_memory_stats-1086"><span class="linenos">1086</span></a>            <span class="c1"># Calculate basic statistics</span>
</span><span id="AgentMemoryManager.get_memory_stats-1087"><a href="#AgentMemoryManager.get_memory_stats-1087"><span class="linenos">1087</span></a>            <span class="n">total_memories</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1088"><a href="#AgentMemoryManager.get_memory_stats-1088"><span class="linenos">1088</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1089"><a href="#AgentMemoryManager.get_memory_stats-1089"><span class="linenos">1089</span></a>            <span class="c1"># Get all unique topics</span>
</span><span id="AgentMemoryManager.get_memory_stats-1090"><a href="#AgentMemoryManager.get_memory_stats-1090"><span class="linenos">1090</span></a>            <span class="n">all_topics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentMemoryManager.get_memory_stats-1091"><a href="#AgentMemoryManager.get_memory_stats-1091"><span class="linenos">1091</span></a>            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1092"><a href="#AgentMemoryManager.get_memory_stats-1092"><span class="linenos">1092</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1093"><a href="#AgentMemoryManager.get_memory_stats-1093"><span class="linenos">1093</span></a>                    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1094"><a href="#AgentMemoryManager.get_memory_stats-1094"><span class="linenos">1094</span></a>                        <span class="n">all_topics</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_topics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="AgentMemoryManager.get_memory_stats-1095"><a href="#AgentMemoryManager.get_memory_stats-1095"><span class="linenos">1095</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1096"><a href="#AgentMemoryManager.get_memory_stats-1096"><span class="linenos">1096</span></a>            <span class="c1"># Sort topics by frequency (most common first)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1097"><a href="#AgentMemoryManager.get_memory_stats-1097"><span class="linenos">1097</span></a>            <span class="n">sorted_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_topics</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1098"><a href="#AgentMemoryManager.get_memory_stats-1098"><span class="linenos">1098</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1099"><a href="#AgentMemoryManager.get_memory_stats-1099"><span class="linenos">1099</span></a>            <span class="c1"># Calculate average memory length</span>
</span><span id="AgentMemoryManager.get_memory_stats-1100"><a href="#AgentMemoryManager.get_memory_stats-1100"><span class="linenos">1100</span></a>            <span class="n">total_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span> <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1101"><a href="#AgentMemoryManager.get_memory_stats-1101"><span class="linenos">1101</span></a>            <span class="n">avg_length</span> <span class="o">=</span> <span class="n">total_length</span> <span class="o">/</span> <span class="n">total_memories</span> <span class="k">if</span> <span class="n">total_memories</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="AgentMemoryManager.get_memory_stats-1102"><a href="#AgentMemoryManager.get_memory_stats-1102"><span class="linenos">1102</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1103"><a href="#AgentMemoryManager.get_memory_stats-1103"><span class="linenos">1103</span></a>            <span class="c1"># Get oldest and newest memory timestamps</span>
</span><span id="AgentMemoryManager.get_memory_stats-1104"><a href="#AgentMemoryManager.get_memory_stats-1104"><span class="linenos">1104</span></a>            <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager.get_memory_stats-1105"><a href="#AgentMemoryManager.get_memory_stats-1105"><span class="linenos">1105</span></a>                <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1106"><a href="#AgentMemoryManager.get_memory_stats-1106"><span class="linenos">1106</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager.get_memory_stats-1107"><a href="#AgentMemoryManager.get_memory_stats-1107"><span class="linenos">1107</span></a>            <span class="n">oldest_timestamp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="k">if</span> <span class="n">timestamps</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.get_memory_stats-1108"><a href="#AgentMemoryManager.get_memory_stats-1108"><span class="linenos">1108</span></a>            <span class="n">newest_timestamp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="k">if</span> <span class="n">timestamps</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.get_memory_stats-1109"><a href="#AgentMemoryManager.get_memory_stats-1109"><span class="linenos">1109</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1110"><a href="#AgentMemoryManager.get_memory_stats-1110"><span class="linenos">1110</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager.get_memory_stats-1111"><a href="#AgentMemoryManager.get_memory_stats-1111"><span class="linenos">1111</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;📊 MEMORY STATISTICS</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1112"><a href="#AgentMemoryManager.get_memory_stats-1112"><span class="linenos">1112</span></a>            <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Total memories: </span><span class="si">{</span><span class="n">total_memories</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1113"><a href="#AgentMemoryManager.get_memory_stats-1113"><span class="linenos">1113</span></a>            <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Average memory length: </span><span class="si">{</span><span class="n">avg_length</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> characters</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1114"><a href="#AgentMemoryManager.get_memory_stats-1114"><span class="linenos">1114</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1115"><a href="#AgentMemoryManager.get_memory_stats-1115"><span class="linenos">1115</span></a>            <span class="k">if</span> <span class="n">oldest_timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1116"><a href="#AgentMemoryManager.get_memory_stats-1116"><span class="linenos">1116</span></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager.get_memory_stats-1117"><a href="#AgentMemoryManager.get_memory_stats-1117"><span class="linenos">1117</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1118"><a href="#AgentMemoryManager.get_memory_stats-1118"><span class="linenos">1118</span></a>                <span class="n">oldest_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">oldest_timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_stats-1119"><a href="#AgentMemoryManager.get_memory_stats-1119"><span class="linenos">1119</span></a>                    <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1120"><a href="#AgentMemoryManager.get_memory_stats-1120"><span class="linenos">1120</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1121"><a href="#AgentMemoryManager.get_memory_stats-1121"><span class="linenos">1121</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Oldest memory: </span><span class="si">{</span><span class="n">oldest_date</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1122"><a href="#AgentMemoryManager.get_memory_stats-1122"><span class="linenos">1122</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1123"><a href="#AgentMemoryManager.get_memory_stats-1123"><span class="linenos">1123</span></a>            <span class="k">if</span> <span class="n">newest_timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1124"><a href="#AgentMemoryManager.get_memory_stats-1124"><span class="linenos">1124</span></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager.get_memory_stats-1125"><a href="#AgentMemoryManager.get_memory_stats-1125"><span class="linenos">1125</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1126"><a href="#AgentMemoryManager.get_memory_stats-1126"><span class="linenos">1126</span></a>                <span class="n">newest_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">newest_timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_stats-1127"><a href="#AgentMemoryManager.get_memory_stats-1127"><span class="linenos">1127</span></a>                    <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1128"><a href="#AgentMemoryManager.get_memory_stats-1128"><span class="linenos">1128</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1129"><a href="#AgentMemoryManager.get_memory_stats-1129"><span class="linenos">1129</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Newest memory: </span><span class="si">{</span><span class="n">newest_date</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1130"><a href="#AgentMemoryManager.get_memory_stats-1130"><span class="linenos">1130</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1131"><a href="#AgentMemoryManager.get_memory_stats-1131"><span class="linenos">1131</span></a>            <span class="k">if</span> <span class="n">sorted_topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1132"><a href="#AgentMemoryManager.get_memory_stats-1132"><span class="linenos">1132</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top topics:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1133"><a href="#AgentMemoryManager.get_memory_stats-1133"><span class="linenos">1133</span></a>                <span class="c1"># Show top 10 topics</span>
</span><span id="AgentMemoryManager.get_memory_stats-1134"><a href="#AgentMemoryManager.get_memory_stats-1134"><span class="linenos">1134</span></a>                <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">sorted_topics</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1135"><a href="#AgentMemoryManager.get_memory_stats-1135"><span class="linenos">1135</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> memories</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1136"><a href="#AgentMemoryManager.get_memory_stats-1136"><span class="linenos">1136</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1137"><a href="#AgentMemoryManager.get_memory_stats-1137"><span class="linenos">1137</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_topics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1138"><a href="#AgentMemoryManager.get_memory_stats-1138"><span class="linenos">1138</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_topics</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more topics</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_stats-1139"><a href="#AgentMemoryManager.get_memory_stats-1139"><span class="linenos">1139</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1140"><a href="#AgentMemoryManager.get_memory_stats-1140"><span class="linenos">1140</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generated memory statistics for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1141"><a href="#AgentMemoryManager.get_memory_stats-1141"><span class="linenos">1141</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.get_memory_stats-1142"><a href="#AgentMemoryManager.get_memory_stats-1142"><span class="linenos">1142</span></a>
</span><span id="AgentMemoryManager.get_memory_stats-1143"><a href="#AgentMemoryManager.get_memory_stats-1143"><span class="linenos">1143</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_stats-1144"><a href="#AgentMemoryManager.get_memory_stats-1144"><span class="linenos">1144</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving memory statistics: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_stats-1145"><a href="#AgentMemoryManager.get_memory_stats-1145"><span class="linenos">1145</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving memory statistics: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Get memory statistics.</p>

<p>Returns:
    str: Formatted string with memory statistics</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.get_memories_by_topic" class="classattr">
                                        <input id="AgentMemoryManager.get_memories_by_topic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_memories_by_topic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.get_memories_by_topic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.get_memories_by_topic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.get_memories_by_topic-1147"><a href="#AgentMemoryManager.get_memories_by_topic-1147"><span class="linenos">1147</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memories_by_topic</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1148"><a href="#AgentMemoryManager.get_memories_by_topic-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1149"><a href="#AgentMemoryManager.get_memories_by_topic-1149"><span class="linenos">1149</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1150"><a href="#AgentMemoryManager.get_memories_by_topic-1150"><span class="linenos">1150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get memories by topic without similarity search, using enhanced SemanticMemoryManager.</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1151"><a href="#AgentMemoryManager.get_memories_by_topic-1151"><span class="linenos">1151</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1152"><a href="#AgentMemoryManager.get_memories_by_topic-1152"><span class="linenos">1152</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1153"><a href="#AgentMemoryManager.get_memories_by_topic-1153"><span class="linenos">1153</span></a><span class="sd">            topics: Topic or list of topics to filter memories by</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1154"><a href="#AgentMemoryManager.get_memories_by_topic-1154"><span class="linenos">1154</span></a><span class="sd">            limit: Maximum number of memories to return</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1155"><a href="#AgentMemoryManager.get_memories_by_topic-1155"><span class="linenos">1155</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1156"><a href="#AgentMemoryManager.get_memories_by_topic-1156"><span class="linenos">1156</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1157"><a href="#AgentMemoryManager.get_memories_by_topic-1157"><span class="linenos">1157</span></a><span class="sd">            str: Formatted string of memories matching the topics</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1158"><a href="#AgentMemoryManager.get_memories_by_topic-1158"><span class="linenos">1158</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1159"><a href="#AgentMemoryManager.get_memories_by_topic-1159"><span class="linenos">1159</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1160"><a href="#AgentMemoryManager.get_memories_by_topic-1160"><span class="linenos">1160</span></a>            <span class="c1"># Validate topics parameter</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1161"><a href="#AgentMemoryManager.get_memories_by_topic-1161"><span class="linenos">1161</span></a>            <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1162"><a href="#AgentMemoryManager.get_memories_by_topic-1162"><span class="linenos">1162</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No topics provided to get_memories_by_topic&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1163"><a href="#AgentMemoryManager.get_memories_by_topic-1163"><span class="linenos">1163</span></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1164"><a href="#AgentMemoryManager.get_memories_by_topic-1164"><span class="linenos">1164</span></a>                    <span class="s2">&quot;❌ Error: No topics provided. Please specify at least one topic.&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1165"><a href="#AgentMemoryManager.get_memories_by_topic-1165"><span class="linenos">1165</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1166"><a href="#AgentMemoryManager.get_memories_by_topic-1166"><span class="linenos">1166</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1167"><a href="#AgentMemoryManager.get_memories_by_topic-1167"><span class="linenos">1167</span></a>            <span class="c1"># Parse topics parameter</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1168"><a href="#AgentMemoryManager.get_memories_by_topic-1168"><span class="linenos">1168</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1169"><a href="#AgentMemoryManager.get_memories_by_topic-1169"><span class="linenos">1169</span></a>                <span class="c1"># Convert string to list, handle comma-separated values</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1170"><a href="#AgentMemoryManager.get_memories_by_topic-1170"><span class="linenos">1170</span></a>                <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1171"><a href="#AgentMemoryManager.get_memories_by_topic-1171"><span class="linenos">1171</span></a>                    <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1172"><a href="#AgentMemoryManager.get_memories_by_topic-1172"><span class="linenos">1172</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1173"><a href="#AgentMemoryManager.get_memories_by_topic-1173"><span class="linenos">1173</span></a>                    <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1174"><a href="#AgentMemoryManager.get_memories_by_topic-1174"><span class="linenos">1174</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1175"><a href="#AgentMemoryManager.get_memories_by_topic-1175"><span class="linenos">1175</span></a>                <span class="c1"># Clean up list - remove empty entries</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1176"><a href="#AgentMemoryManager.get_memories_by_topic-1176"><span class="linenos">1176</span></a>                <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1177"><a href="#AgentMemoryManager.get_memories_by_topic-1177"><span class="linenos">1177</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1178"><a href="#AgentMemoryManager.get_memories_by_topic-1178"><span class="linenos">1178</span></a>                <span class="c1"># Convert anything else to string and put in list</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1179"><a href="#AgentMemoryManager.get_memories_by_topic-1179"><span class="linenos">1179</span></a>                <span class="n">topic_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1180"><a href="#AgentMemoryManager.get_memories_by_topic-1180"><span class="linenos">1180</span></a>                <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_str</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic_str</span> <span class="ow">and</span> <span class="n">topic_str</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1181"><a href="#AgentMemoryManager.get_memories_by_topic-1181"><span class="linenos">1181</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1182"><a href="#AgentMemoryManager.get_memories_by_topic-1182"><span class="linenos">1182</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">topic_list</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1183"><a href="#AgentMemoryManager.get_memories_by_topic-1183"><span class="linenos">1183</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid topics provided after parsing&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1184"><a href="#AgentMemoryManager.get_memories_by_topic-1184"><span class="linenos">1184</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Error: No valid topics provided. Please specify at least one topic.&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1185"><a href="#AgentMemoryManager.get_memories_by_topic-1185"><span class="linenos">1185</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1186"><a href="#AgentMemoryManager.get_memories_by_topic-1186"><span class="linenos">1186</span></a>            <span class="c1"># ENHANCED: Use the SemanticMemoryManager&#39;s enhanced get_memories_by_topic method</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1187"><a href="#AgentMemoryManager.get_memories_by_topic-1187"><span class="linenos">1187</span></a>            <span class="c1"># This method includes topic classifier integration for query expansion</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1188"><a href="#AgentMemoryManager.get_memories_by_topic-1188"><span class="linenos">1188</span></a>            <span class="n">filtered_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_memories_by_topic</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1189"><a href="#AgentMemoryManager.get_memories_by_topic-1189"><span class="linenos">1189</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1190"><a href="#AgentMemoryManager.get_memories_by_topic-1190"><span class="linenos">1190</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1191"><a href="#AgentMemoryManager.get_memories_by_topic-1191"><span class="linenos">1191</span></a>                <span class="n">topics</span><span class="o">=</span><span class="n">topic_list</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1192"><a href="#AgentMemoryManager.get_memories_by_topic-1192"><span class="linenos">1192</span></a>                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1193"><a href="#AgentMemoryManager.get_memories_by_topic-1193"><span class="linenos">1193</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1194"><a href="#AgentMemoryManager.get_memories_by_topic-1194"><span class="linenos">1194</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1195"><a href="#AgentMemoryManager.get_memories_by_topic-1195"><span class="linenos">1195</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1196"><a href="#AgentMemoryManager.get_memories_by_topic-1196"><span class="linenos">1196</span></a>                <span class="n">topics_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topic_list</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1197"><a href="#AgentMemoryManager.get_memories_by_topic-1197"><span class="linenos">1197</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for topics: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">topics_str</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1198"><a href="#AgentMemoryManager.get_memories_by_topic-1198"><span class="linenos">1198</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🔍 No memories found for topics: </span><span class="si">{</span><span class="n">topics_str</span><span class="si">}</span><span class="s2">. Try different topics or store new memories with these topics.&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1199"><a href="#AgentMemoryManager.get_memories_by_topic-1199"><span class="linenos">1199</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1200"><a href="#AgentMemoryManager.get_memories_by_topic-1200"><span class="linenos">1200</span></a>            <span class="c1"># Format results</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1201"><a href="#AgentMemoryManager.get_memories_by_topic-1201"><span class="linenos">1201</span></a>            <span class="n">topics_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topic_list</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1202"><a href="#AgentMemoryManager.get_memories_by_topic-1202"><span class="linenos">1202</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🧠 MEMORIES BY TOPIC: </span><span class="si">{</span><span class="n">topics_str</span><span class="si">}</span><span class="s2"> (showing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> matching memories)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1203"><a href="#AgentMemoryManager.get_memories_by_topic-1203"><span class="linenos">1203</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1204"><a href="#AgentMemoryManager.get_memories_by_topic-1204"><span class="linenos">1204</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filtered_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1205"><a href="#AgentMemoryManager.get_memories_by_topic-1205"><span class="linenos">1205</span></a>                <span class="c1"># Format the memory content</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1206"><a href="#AgentMemoryManager.get_memories_by_topic-1206"><span class="linenos">1206</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1207"><a href="#AgentMemoryManager.get_memories_by_topic-1207"><span class="linenos">1207</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1208"><a href="#AgentMemoryManager.get_memories_by_topic-1208"><span class="linenos">1208</span></a>                <span class="c1"># Add topics if available</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1209"><a href="#AgentMemoryManager.get_memories_by_topic-1209"><span class="linenos">1209</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1210"><a href="#AgentMemoryManager.get_memories_by_topic-1210"><span class="linenos">1210</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1211"><a href="#AgentMemoryManager.get_memories_by_topic-1211"><span class="linenos">1211</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1212"><a href="#AgentMemoryManager.get_memories_by_topic-1212"><span class="linenos">1212</span></a>                <span class="c1"># Add timestamp if available</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1213"><a href="#AgentMemoryManager.get_memories_by_topic-1213"><span class="linenos">1213</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1214"><a href="#AgentMemoryManager.get_memories_by_topic-1214"><span class="linenos">1214</span></a>                    <span class="c1"># Convert timestamp to readable format</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1215"><a href="#AgentMemoryManager.get_memories_by_topic-1215"><span class="linenos">1215</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1216"><a href="#AgentMemoryManager.get_memories_by_topic-1216"><span class="linenos">1216</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1217"><a href="#AgentMemoryManager.get_memories_by_topic-1217"><span class="linenos">1217</span></a>                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1218"><a href="#AgentMemoryManager.get_memories_by_topic-1218"><span class="linenos">1218</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Created: </span><span class="si">{</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1219"><a href="#AgentMemoryManager.get_memories_by_topic-1219"><span class="linenos">1219</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1220"><a href="#AgentMemoryManager.get_memories_by_topic-1220"><span class="linenos">1220</span></a>                <span class="c1"># Add memory ID for reference</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1221"><a href="#AgentMemoryManager.get_memories_by_topic-1221"><span class="linenos">1221</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   ID: </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">memory_id</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1222"><a href="#AgentMemoryManager.get_memories_by_topic-1222"><span class="linenos">1222</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1223"><a href="#AgentMemoryManager.get_memories_by_topic-1223"><span class="linenos">1223</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1224"><a href="#AgentMemoryManager.get_memories_by_topic-1224"><span class="linenos">1224</span></a>                <span class="s2">&quot;Retrieved </span><span class="si">%d</span><span class="s2"> memories for topics </span><span class="si">%s</span><span class="s2"> using enhanced SemanticMemoryManager&quot;</span><span class="p">,</span> 
</span><span id="AgentMemoryManager.get_memories_by_topic-1225"><a href="#AgentMemoryManager.get_memories_by_topic-1225"><span class="linenos">1225</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">filtered_memories</span><span class="p">),</span> <span class="n">topics_str</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1226"><a href="#AgentMemoryManager.get_memories_by_topic-1226"><span class="linenos">1226</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1227"><a href="#AgentMemoryManager.get_memories_by_topic-1227"><span class="linenos">1227</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1228"><a href="#AgentMemoryManager.get_memories_by_topic-1228"><span class="linenos">1228</span></a>
</span><span id="AgentMemoryManager.get_memories_by_topic-1229"><a href="#AgentMemoryManager.get_memories_by_topic-1229"><span class="linenos">1229</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1230"><a href="#AgentMemoryManager.get_memories_by_topic-1230"><span class="linenos">1230</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error retrieving memories by topic: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memories_by_topic-1231"><a href="#AgentMemoryManager.get_memories_by_topic-1231"><span class="linenos">1231</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving memories by topic: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Get memories by topic without similarity search, using enhanced SemanticMemoryManager.</p>

<p>Args:
    topics: Topic or list of topics to filter memories by
    limit: Maximum number of memories to return</p>

<p>Returns:
    str: Formatted string of memories matching the topics</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.list_memories" class="classattr">
                                        <input id="AgentMemoryManager.list_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">list_memories</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.list_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.list_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.list_memories-1233"><a href="#AgentMemoryManager.list_memories-1233"><span class="linenos">1233</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.list_memories-1234"><a href="#AgentMemoryManager.list_memories-1234"><span class="linenos">1234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all memories in a simple, user-friendly format.</span>
</span><span id="AgentMemoryManager.list_memories-1235"><a href="#AgentMemoryManager.list_memories-1235"><span class="linenos">1235</span></a>
</span><span id="AgentMemoryManager.list_memories-1236"><a href="#AgentMemoryManager.list_memories-1236"><span class="linenos">1236</span></a><span class="sd">        This method provides a more concise view of all memories compared to get_all_memories,</span>
</span><span id="AgentMemoryManager.list_memories-1237"><a href="#AgentMemoryManager.list_memories-1237"><span class="linenos">1237</span></a><span class="sd">        focusing on just the content and topics without additional metadata.</span>
</span><span id="AgentMemoryManager.list_memories-1238"><a href="#AgentMemoryManager.list_memories-1238"><span class="linenos">1238</span></a>
</span><span id="AgentMemoryManager.list_memories-1239"><a href="#AgentMemoryManager.list_memories-1239"><span class="linenos">1239</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.list_memories-1240"><a href="#AgentMemoryManager.list_memories-1240"><span class="linenos">1240</span></a><span class="sd">            str: Simplified list of all memories</span>
</span><span id="AgentMemoryManager.list_memories-1241"><a href="#AgentMemoryManager.list_memories-1241"><span class="linenos">1241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.list_memories-1242"><a href="#AgentMemoryManager.list_memories-1242"><span class="linenos">1242</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.list_memories-1243"><a href="#AgentMemoryManager.list_memories-1243"><span class="linenos">1243</span></a>            <span class="c1"># Direct call to SemanticMemoryManager.get_all_memories()</span>
</span><span id="AgentMemoryManager.list_memories-1244"><a href="#AgentMemoryManager.list_memories-1244"><span class="linenos">1244</span></a>            <span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_all_memories</span><span class="p">(</span>
</span><span id="AgentMemoryManager.list_memories-1245"><a href="#AgentMemoryManager.list_memories-1245"><span class="linenos">1245</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_memory</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="AgentMemoryManager.list_memories-1246"><a href="#AgentMemoryManager.list_memories-1246"><span class="linenos">1246</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.list_memories-1247"><a href="#AgentMemoryManager.list_memories-1247"><span class="linenos">1247</span></a>
</span><span id="AgentMemoryManager.list_memories-1248"><a href="#AgentMemoryManager.list_memories-1248"><span class="linenos">1248</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">memories</span><span class="p">:</span>
</span><span id="AgentMemoryManager.list_memories-1249"><a href="#AgentMemoryManager.list_memories-1249"><span class="linenos">1249</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No memories found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="AgentMemoryManager.list_memories-1250"><a href="#AgentMemoryManager.list_memories-1250"><span class="linenos">1250</span></a>                <span class="k">return</span> <span class="s2">&quot;🔍 No memories found. Try storing some information first!&quot;</span>
</span><span id="AgentMemoryManager.list_memories-1251"><a href="#AgentMemoryManager.list_memories-1251"><span class="linenos">1251</span></a>
</span><span id="AgentMemoryManager.list_memories-1252"><a href="#AgentMemoryManager.list_memories-1252"><span class="linenos">1252</span></a>            <span class="c1"># Sort memories by timestamp (newest first)</span>
</span><span id="AgentMemoryManager.list_memories-1253"><a href="#AgentMemoryManager.list_memories-1253"><span class="linenos">1253</span></a>            <span class="n">sorted_memories</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="AgentMemoryManager.list_memories-1254"><a href="#AgentMemoryManager.list_memories-1254"><span class="linenos">1254</span></a>                <span class="n">memories</span><span class="p">,</span>
</span><span id="AgentMemoryManager.list_memories-1255"><a href="#AgentMemoryManager.list_memories-1255"><span class="linenos">1255</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AgentMemoryManager.list_memories-1256"><a href="#AgentMemoryManager.list_memories-1256"><span class="linenos">1256</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="AgentMemoryManager.list_memories-1257"><a href="#AgentMemoryManager.list_memories-1257"><span class="linenos">1257</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.list_memories-1258"><a href="#AgentMemoryManager.list_memories-1258"><span class="linenos">1258</span></a>
</span><span id="AgentMemoryManager.list_memories-1259"><a href="#AgentMemoryManager.list_memories-1259"><span class="linenos">1259</span></a>            <span class="c1"># Format results in a simplified way</span>
</span><span id="AgentMemoryManager.list_memories-1260"><a href="#AgentMemoryManager.list_memories-1260"><span class="linenos">1260</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;📝 MEMORY LIST (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span><span class="si">}</span><span class="s2"> total):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.list_memories-1261"><a href="#AgentMemoryManager.list_memories-1261"><span class="linenos">1261</span></a>
</span><span id="AgentMemoryManager.list_memories-1262"><a href="#AgentMemoryManager.list_memories-1262"><span class="linenos">1262</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_memories</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AgentMemoryManager.list_memories-1263"><a href="#AgentMemoryManager.list_memories-1263"><span class="linenos">1263</span></a>                <span class="c1"># Just show the memory content and topics, omit other metadata</span>
</span><span id="AgentMemoryManager.list_memories-1264"><a href="#AgentMemoryManager.list_memories-1264"><span class="linenos">1264</span></a>                <span class="n">memory_preview</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgentMemoryManager.list_memories-1265"><a href="#AgentMemoryManager.list_memories-1265"><span class="linenos">1265</span></a>                    <span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
</span><span id="AgentMemoryManager.list_memories-1266"><a href="#AgentMemoryManager.list_memories-1266"><span class="linenos">1266</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span>
</span><span id="AgentMemoryManager.list_memories-1267"><a href="#AgentMemoryManager.list_memories-1267"><span class="linenos">1267</span></a>                    <span class="k">else</span> <span class="n">memory</span><span class="o">.</span><span class="n">memory</span>
</span><span id="AgentMemoryManager.list_memories-1268"><a href="#AgentMemoryManager.list_memories-1268"><span class="linenos">1268</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.list_memories-1269"><a href="#AgentMemoryManager.list_memories-1269"><span class="linenos">1269</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">memory_preview</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.list_memories-1270"><a href="#AgentMemoryManager.list_memories-1270"><span class="linenos">1270</span></a>
</span><span id="AgentMemoryManager.list_memories-1271"><a href="#AgentMemoryManager.list_memories-1271"><span class="linenos">1271</span></a>                <span class="c1"># Add topics if available</span>
</span><span id="AgentMemoryManager.list_memories-1272"><a href="#AgentMemoryManager.list_memories-1272"><span class="linenos">1272</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;topics&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.list_memories-1273"><a href="#AgentMemoryManager.list_memories-1273"><span class="linenos">1273</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.list_memories-1274"><a href="#AgentMemoryManager.list_memories-1274"><span class="linenos">1274</span></a>
</span><span id="AgentMemoryManager.list_memories-1275"><a href="#AgentMemoryManager.list_memories-1275"><span class="linenos">1275</span></a>                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.list_memories-1276"><a href="#AgentMemoryManager.list_memories-1276"><span class="linenos">1276</span></a>
</span><span id="AgentMemoryManager.list_memories-1277"><a href="#AgentMemoryManager.list_memories-1277"><span class="linenos">1277</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.list_memories-1278"><a href="#AgentMemoryManager.list_memories-1278"><span class="linenos">1278</span></a>                <span class="s2">&quot;Listed all </span><span class="si">%d</span><span class="s2"> memories for user </span><span class="si">%s</span><span class="s2"> in simplified format&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.list_memories-1279"><a href="#AgentMemoryManager.list_memories-1279"><span class="linenos">1279</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">),</span>
</span><span id="AgentMemoryManager.list_memories-1280"><a href="#AgentMemoryManager.list_memories-1280"><span class="linenos">1280</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="AgentMemoryManager.list_memories-1281"><a href="#AgentMemoryManager.list_memories-1281"><span class="linenos">1281</span></a>            <span class="p">)</span>
</span><span id="AgentMemoryManager.list_memories-1282"><a href="#AgentMemoryManager.list_memories-1282"><span class="linenos">1282</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.list_memories-1283"><a href="#AgentMemoryManager.list_memories-1283"><span class="linenos">1283</span></a>
</span><span id="AgentMemoryManager.list_memories-1284"><a href="#AgentMemoryManager.list_memories-1284"><span class="linenos">1284</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.list_memories-1285"><a href="#AgentMemoryManager.list_memories-1285"><span class="linenos">1285</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error listing memories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.list_memories-1286"><a href="#AgentMemoryManager.list_memories-1286"><span class="linenos">1286</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error listing memories: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>List all memories in a simple, user-friendly format.</p>

<p>This method provides a more concise view of all memories compared to get_all_memories,
focusing on just the content and topics without additional metadata.</p>

<p>Returns:
    str: Simplified list of all memories</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.store_graph_memory" class="classattr">
                                        <input id="AgentMemoryManager.store_graph_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">store_graph_memory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">content</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.store_graph_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.store_graph_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.store_graph_memory-1288"><a href="#AgentMemoryManager.store_graph_memory-1288"><span class="linenos">1288</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">store_graph_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_graph_memory-1289"><a href="#AgentMemoryManager.store_graph_memory-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_graph_memory-1290"><a href="#AgentMemoryManager.store_graph_memory-1290"><span class="linenos">1290</span></a>        <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_graph_memory-1291"><a href="#AgentMemoryManager.store_graph_memory-1291"><span class="linenos">1291</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_graph_memory-1292"><a href="#AgentMemoryManager.store_graph_memory-1292"><span class="linenos">1292</span></a>        <span class="n">memory_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_graph_memory-1293"><a href="#AgentMemoryManager.store_graph_memory-1293"><span class="linenos">1293</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1294"><a href="#AgentMemoryManager.store_graph_memory-1294"><span class="linenos">1294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store a memory in the LightRAG graph database to capture relationships.</span>
</span><span id="AgentMemoryManager.store_graph_memory-1295"><a href="#AgentMemoryManager.store_graph_memory-1295"><span class="linenos">1295</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1296"><a href="#AgentMemoryManager.store_graph_memory-1296"><span class="linenos">1296</span></a><span class="sd">        This method creates a text file with the memory content and uploads it to the LightRAG</span>
</span><span id="AgentMemoryManager.store_graph_memory-1297"><a href="#AgentMemoryManager.store_graph_memory-1297"><span class="linenos">1297</span></a><span class="sd">        memory server, which then processes it to extract entities and relationships.</span>
</span><span id="AgentMemoryManager.store_graph_memory-1298"><a href="#AgentMemoryManager.store_graph_memory-1298"><span class="linenos">1298</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1299"><a href="#AgentMemoryManager.store_graph_memory-1299"><span class="linenos">1299</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1300"><a href="#AgentMemoryManager.store_graph_memory-1300"><span class="linenos">1300</span></a><span class="sd">            content: The memory content to store</span>
</span><span id="AgentMemoryManager.store_graph_memory-1301"><a href="#AgentMemoryManager.store_graph_memory-1301"><span class="linenos">1301</span></a><span class="sd">            topics: Optional list of topics/categories for the memory</span>
</span><span id="AgentMemoryManager.store_graph_memory-1302"><a href="#AgentMemoryManager.store_graph_memory-1302"><span class="linenos">1302</span></a><span class="sd">            memory_id: Optional memory ID to link with the SQLite memory</span>
</span><span id="AgentMemoryManager.store_graph_memory-1303"><a href="#AgentMemoryManager.store_graph_memory-1303"><span class="linenos">1303</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1304"><a href="#AgentMemoryManager.store_graph_memory-1304"><span class="linenos">1304</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1305"><a href="#AgentMemoryManager.store_graph_memory-1305"><span class="linenos">1305</span></a><span class="sd">            str: Success or error message</span>
</span><span id="AgentMemoryManager.store_graph_memory-1306"><a href="#AgentMemoryManager.store_graph_memory-1306"><span class="linenos">1306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1307"><a href="#AgentMemoryManager.store_graph_memory-1307"><span class="linenos">1307</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1308"><a href="#AgentMemoryManager.store_graph_memory-1308"><span class="linenos">1308</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1309"><a href="#AgentMemoryManager.store_graph_memory-1309"><span class="linenos">1309</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;LightRAG memory URL not configured&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1310"><a href="#AgentMemoryManager.store_graph_memory-1310"><span class="linenos">1310</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Graph memory not configured. Memory not stored in graph database.&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1311"><a href="#AgentMemoryManager.store_graph_memory-1311"><span class="linenos">1311</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1312"><a href="#AgentMemoryManager.store_graph_memory-1312"><span class="linenos">1312</span></a>            <span class="c1"># Validate content</span>
</span><span id="AgentMemoryManager.store_graph_memory-1313"><a href="#AgentMemoryManager.store_graph_memory-1313"><span class="linenos">1313</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="AgentMemoryManager.store_graph_memory-1314"><a href="#AgentMemoryManager.store_graph_memory-1314"><span class="linenos">1314</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Empty content provided to store_graph_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1315"><a href="#AgentMemoryManager.store_graph_memory-1315"><span class="linenos">1315</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Error: Content cannot be empty.&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1316"><a href="#AgentMemoryManager.store_graph_memory-1316"><span class="linenos">1316</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1317"><a href="#AgentMemoryManager.store_graph_memory-1317"><span class="linenos">1317</span></a>            <span class="c1"># Parse topics parameter</span>
</span><span id="AgentMemoryManager.store_graph_memory-1318"><a href="#AgentMemoryManager.store_graph_memory-1318"><span class="linenos">1318</span></a>            <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.store_graph_memory-1319"><a href="#AgentMemoryManager.store_graph_memory-1319"><span class="linenos">1319</span></a>            <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1320"><a href="#AgentMemoryManager.store_graph_memory-1320"><span class="linenos">1320</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentMemoryManager.store_graph_memory-1321"><a href="#AgentMemoryManager.store_graph_memory-1321"><span class="linenos">1321</span></a>                    <span class="c1"># Convert string to list, handle comma-separated values</span>
</span><span id="AgentMemoryManager.store_graph_memory-1322"><a href="#AgentMemoryManager.store_graph_memory-1322"><span class="linenos">1322</span></a>                    <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1323"><a href="#AgentMemoryManager.store_graph_memory-1323"><span class="linenos">1323</span></a>                        <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager.store_graph_memory-1324"><a href="#AgentMemoryManager.store_graph_memory-1324"><span class="linenos">1324</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1325"><a href="#AgentMemoryManager.store_graph_memory-1325"><span class="linenos">1325</span></a>                        <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.store_graph_memory-1326"><a href="#AgentMemoryManager.store_graph_memory-1326"><span class="linenos">1326</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager.store_graph_memory-1327"><a href="#AgentMemoryManager.store_graph_memory-1327"><span class="linenos">1327</span></a>                    <span class="c1"># Clean up list - remove empty entries</span>
</span><span id="AgentMemoryManager.store_graph_memory-1328"><a href="#AgentMemoryManager.store_graph_memory-1328"><span class="linenos">1328</span></a>                    <span class="n">topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="AgentMemoryManager.store_graph_memory-1329"><a href="#AgentMemoryManager.store_graph_memory-1329"><span class="linenos">1329</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1330"><a href="#AgentMemoryManager.store_graph_memory-1330"><span class="linenos">1330</span></a>                    <span class="c1"># Convert anything else to string and put in list</span>
</span><span id="AgentMemoryManager.store_graph_memory-1331"><a href="#AgentMemoryManager.store_graph_memory-1331"><span class="linenos">1331</span></a>                    <span class="n">topic_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="AgentMemoryManager.store_graph_memory-1332"><a href="#AgentMemoryManager.store_graph_memory-1332"><span class="linenos">1332</span></a>                    <span class="n">topic_list</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgentMemoryManager.store_graph_memory-1333"><a href="#AgentMemoryManager.store_graph_memory-1333"><span class="linenos">1333</span></a>                        <span class="p">[</span><span class="n">topic_str</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic_str</span> <span class="ow">and</span> <span class="n">topic_str</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.store_graph_memory-1334"><a href="#AgentMemoryManager.store_graph_memory-1334"><span class="linenos">1334</span></a>                    <span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1335"><a href="#AgentMemoryManager.store_graph_memory-1335"><span class="linenos">1335</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1336"><a href="#AgentMemoryManager.store_graph_memory-1336"><span class="linenos">1336</span></a>            <span class="c1"># Create a unique filename for this memory</span>
</span><span id="AgentMemoryManager.store_graph_memory-1337"><a href="#AgentMemoryManager.store_graph_memory-1337"><span class="linenos">1337</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="AgentMemoryManager.store_graph_memory-1338"><a href="#AgentMemoryManager.store_graph_memory-1338"><span class="linenos">1338</span></a>            <span class="n">memory_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="AgentMemoryManager.store_graph_memory-1339"><a href="#AgentMemoryManager.store_graph_memory-1339"><span class="linenos">1339</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1340"><a href="#AgentMemoryManager.store_graph_memory-1340"><span class="linenos">1340</span></a>            <span class="c1"># If memory_id is provided, use it in the filename for traceability</span>
</span><span id="AgentMemoryManager.store_graph_memory-1341"><a href="#AgentMemoryManager.store_graph_memory-1341"><span class="linenos">1341</span></a>            <span class="k">if</span> <span class="n">memory_id</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1342"><a href="#AgentMemoryManager.store_graph_memory-1342"><span class="linenos">1342</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;memory_</span><span class="si">{</span><span class="n">memory_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">memory_hash</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1343"><a href="#AgentMemoryManager.store_graph_memory-1343"><span class="linenos">1343</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1344"><a href="#AgentMemoryManager.store_graph_memory-1344"><span class="linenos">1344</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;memory_</span><span class="si">{</span><span class="n">memory_hash</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1345"><a href="#AgentMemoryManager.store_graph_memory-1345"><span class="linenos">1345</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1346"><a href="#AgentMemoryManager.store_graph_memory-1346"><span class="linenos">1346</span></a>            <span class="c1"># Prepare the content with metadata</span>
</span><span id="AgentMemoryManager.store_graph_memory-1347"><a href="#AgentMemoryManager.store_graph_memory-1347"><span class="linenos">1347</span></a>            <span class="n">file_content</span> <span class="o">=</span> <span class="n">content</span>
</span><span id="AgentMemoryManager.store_graph_memory-1348"><a href="#AgentMemoryManager.store_graph_memory-1348"><span class="linenos">1348</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1349"><a href="#AgentMemoryManager.store_graph_memory-1349"><span class="linenos">1349</span></a>            <span class="c1"># Add topics as metadata if available</span>
</span><span id="AgentMemoryManager.store_graph_memory-1350"><a href="#AgentMemoryManager.store_graph_memory-1350"><span class="linenos">1350</span></a>            <span class="k">if</span> <span class="n">topic_list</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1351"><a href="#AgentMemoryManager.store_graph_memory-1351"><span class="linenos">1351</span></a>                <span class="n">file_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Topics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topic_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1352"><a href="#AgentMemoryManager.store_graph_memory-1352"><span class="linenos">1352</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1353"><a href="#AgentMemoryManager.store_graph_memory-1353"><span class="linenos">1353</span></a>            <span class="c1"># Create a temporary file</span>
</span><span id="AgentMemoryManager.store_graph_memory-1354"><a href="#AgentMemoryManager.store_graph_memory-1354"><span class="linenos">1354</span></a>            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_graph_memory-1355"><a href="#AgentMemoryManager.store_graph_memory-1355"><span class="linenos">1355</span></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span>
</span><span id="AgentMemoryManager.store_graph_memory-1356"><a href="#AgentMemoryManager.store_graph_memory-1356"><span class="linenos">1356</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">temp_file</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1357"><a href="#AgentMemoryManager.store_graph_memory-1357"><span class="linenos">1357</span></a>                <span class="n">temp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1358"><a href="#AgentMemoryManager.store_graph_memory-1358"><span class="linenos">1358</span></a>                <span class="n">temp_file_path</span> <span class="o">=</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="AgentMemoryManager.store_graph_memory-1359"><a href="#AgentMemoryManager.store_graph_memory-1359"><span class="linenos">1359</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1360"><a href="#AgentMemoryManager.store_graph_memory-1360"><span class="linenos">1360</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1361"><a href="#AgentMemoryManager.store_graph_memory-1361"><span class="linenos">1361</span></a>                <span class="c1"># Upload the file using the /documents/upload endpoint</span>
</span><span id="AgentMemoryManager.store_graph_memory-1362"><a href="#AgentMemoryManager.store_graph_memory-1362"><span class="linenos">1362</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents/upload&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1363"><a href="#AgentMemoryManager.store_graph_memory-1363"><span class="linenos">1363</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1364"><a href="#AgentMemoryManager.store_graph_memory-1364"><span class="linenos">1364</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1365"><a href="#AgentMemoryManager.store_graph_memory-1365"><span class="linenos">1365</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1366"><a href="#AgentMemoryManager.store_graph_memory-1366"><span class="linenos">1366</span></a>                        <span class="c1"># Create form data for file upload</span>
</span><span id="AgentMemoryManager.store_graph_memory-1367"><a href="#AgentMemoryManager.store_graph_memory-1367"><span class="linenos">1367</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">FormData</span><span class="p">()</span>
</span><span id="AgentMemoryManager.store_graph_memory-1368"><a href="#AgentMemoryManager.store_graph_memory-1368"><span class="linenos">1368</span></a>                        <span class="n">data</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_graph_memory-1369"><a href="#AgentMemoryManager.store_graph_memory-1369"><span class="linenos">1369</span></a>                            <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1370"><a href="#AgentMemoryManager.store_graph_memory-1370"><span class="linenos">1370</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1371"><a href="#AgentMemoryManager.store_graph_memory-1371"><span class="linenos">1371</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1372"><a href="#AgentMemoryManager.store_graph_memory-1372"><span class="linenos">1372</span></a>                        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1373"><a href="#AgentMemoryManager.store_graph_memory-1373"><span class="linenos">1373</span></a>                            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1374"><a href="#AgentMemoryManager.store_graph_memory-1374"><span class="linenos">1374</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_graph_memory-1375"><a href="#AgentMemoryManager.store_graph_memory-1375"><span class="linenos">1375</span></a>                                    <span class="s2">&quot;Successfully stored memory in graph database: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_graph_memory-1376"><a href="#AgentMemoryManager.store_graph_memory-1376"><span class="linenos">1376</span></a>                                    <span class="n">filename</span><span class="p">,</span>
</span><span id="AgentMemoryManager.store_graph_memory-1377"><a href="#AgentMemoryManager.store_graph_memory-1377"><span class="linenos">1377</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1378"><a href="#AgentMemoryManager.store_graph_memory-1378"><span class="linenos">1378</span></a>                                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;✅ Memory successfully stored in graph database: </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1379"><a href="#AgentMemoryManager.store_graph_memory-1379"><span class="linenos">1379</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1380"><a href="#AgentMemoryManager.store_graph_memory-1380"><span class="linenos">1380</span></a>                                <span class="n">error_detail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager.store_graph_memory-1381"><a href="#AgentMemoryManager.store_graph_memory-1381"><span class="linenos">1381</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager.store_graph_memory-1382"><a href="#AgentMemoryManager.store_graph_memory-1382"><span class="linenos">1382</span></a>                                    <span class="sa">f</span><span class="s2">&quot;Failed to store memory in graph: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1383"><a href="#AgentMemoryManager.store_graph_memory-1383"><span class="linenos">1383</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1384"><a href="#AgentMemoryManager.store_graph_memory-1384"><span class="linenos">1384</span></a>                                <span class="k">return</span> <span class="p">(</span>
</span><span id="AgentMemoryManager.store_graph_memory-1385"><a href="#AgentMemoryManager.store_graph_memory-1385"><span class="linenos">1385</span></a>                                    <span class="sa">f</span><span class="s2">&quot;❌ Error storing memory in graph: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.store_graph_memory-1386"><a href="#AgentMemoryManager.store_graph_memory-1386"><span class="linenos">1386</span></a>                                <span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1387"><a href="#AgentMemoryManager.store_graph_memory-1387"><span class="linenos">1387</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1388"><a href="#AgentMemoryManager.store_graph_memory-1388"><span class="linenos">1388</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1389"><a href="#AgentMemoryManager.store_graph_memory-1389"><span class="linenos">1389</span></a>                <span class="c1"># Clean up the temporary file</span>
</span><span id="AgentMemoryManager.store_graph_memory-1390"><a href="#AgentMemoryManager.store_graph_memory-1390"><span class="linenos">1390</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1391"><a href="#AgentMemoryManager.store_graph_memory-1391"><span class="linenos">1391</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1392"><a href="#AgentMemoryManager.store_graph_memory-1392"><span class="linenos">1392</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1393"><a href="#AgentMemoryManager.store_graph_memory-1393"><span class="linenos">1393</span></a>                    <span class="k">pass</span>  <span class="c1"># Ignore cleanup errors</span>
</span><span id="AgentMemoryManager.store_graph_memory-1394"><a href="#AgentMemoryManager.store_graph_memory-1394"><span class="linenos">1394</span></a>
</span><span id="AgentMemoryManager.store_graph_memory-1395"><a href="#AgentMemoryManager.store_graph_memory-1395"><span class="linenos">1395</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.store_graph_memory-1396"><a href="#AgentMemoryManager.store_graph_memory-1396"><span class="linenos">1396</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error storing memory in graph: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AgentMemoryManager.store_graph_memory-1397"><a href="#AgentMemoryManager.store_graph_memory-1397"><span class="linenos">1397</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error storing memory in graph: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Store a memory in the LightRAG graph database to capture relationships.</p>

<p>This method creates a text file with the memory content and uploads it to the LightRAG
memory server, which then processes it to extract entities and relationships.</p>

<p>Args:
    content: The memory content to store
    topics: Optional list of topics/categories for the memory
    memory_id: Optional memory ID to link with the SQLite memory</p>

<p>Returns:
    str: Success or error message</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.query_graph_memory" class="classattr">
                                        <input id="AgentMemoryManager.query_graph_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">query_graph_memory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mix&#39;</span>,</span><span class="param">	<span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">response_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Multiple Paragraphs&#39;</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.query_graph_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.query_graph_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.query_graph_memory-1399"><a href="#AgentMemoryManager.query_graph_memory-1399"><span class="linenos">1399</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_graph_memory</span><span class="p">(</span>
</span><span id="AgentMemoryManager.query_graph_memory-1400"><a href="#AgentMemoryManager.query_graph_memory-1400"><span class="linenos">1400</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1401"><a href="#AgentMemoryManager.query_graph_memory-1401"><span class="linenos">1401</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1402"><a href="#AgentMemoryManager.query_graph_memory-1402"><span class="linenos">1402</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mix&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1403"><a href="#AgentMemoryManager.query_graph_memory-1403"><span class="linenos">1403</span></a>        <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1404"><a href="#AgentMemoryManager.query_graph_memory-1404"><span class="linenos">1404</span></a>        <span class="n">response_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1405"><a href="#AgentMemoryManager.query_graph_memory-1405"><span class="linenos">1405</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1406"><a href="#AgentMemoryManager.query_graph_memory-1406"><span class="linenos">1406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the LightRAG memory graph to explore relationships between memories.</span>
</span><span id="AgentMemoryManager.query_graph_memory-1407"><a href="#AgentMemoryManager.query_graph_memory-1407"><span class="linenos">1407</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1408"><a href="#AgentMemoryManager.query_graph_memory-1408"><span class="linenos">1408</span></a><span class="sd">        This method sends a query to the LightRAG memory server to retrieve memories and their</span>
</span><span id="AgentMemoryManager.query_graph_memory-1409"><a href="#AgentMemoryManager.query_graph_memory-1409"><span class="linenos">1409</span></a><span class="sd">        relationships based on the query. It supports different query modes and response formats.</span>
</span><span id="AgentMemoryManager.query_graph_memory-1410"><a href="#AgentMemoryManager.query_graph_memory-1410"><span class="linenos">1410</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1411"><a href="#AgentMemoryManager.query_graph_memory-1411"><span class="linenos">1411</span></a><span class="sd">        Args:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1412"><a href="#AgentMemoryManager.query_graph_memory-1412"><span class="linenos">1412</span></a><span class="sd">            query: The query to search for in the memory graph</span>
</span><span id="AgentMemoryManager.query_graph_memory-1413"><a href="#AgentMemoryManager.query_graph_memory-1413"><span class="linenos">1413</span></a><span class="sd">            mode: Query mode - &quot;semantic&quot; (vector search), &quot;graph&quot; (graph traversal), or &quot;mix&quot; (combined)</span>
</span><span id="AgentMemoryManager.query_graph_memory-1414"><a href="#AgentMemoryManager.query_graph_memory-1414"><span class="linenos">1414</span></a><span class="sd">            top_k: Maximum number of results to return</span>
</span><span id="AgentMemoryManager.query_graph_memory-1415"><a href="#AgentMemoryManager.query_graph_memory-1415"><span class="linenos">1415</span></a><span class="sd">            response_type: Format of the response - &quot;Multiple Paragraphs&quot;, &quot;Single Paragraph&quot;, etc.</span>
</span><span id="AgentMemoryManager.query_graph_memory-1416"><a href="#AgentMemoryManager.query_graph_memory-1416"><span class="linenos">1416</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1417"><a href="#AgentMemoryManager.query_graph_memory-1417"><span class="linenos">1417</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1418"><a href="#AgentMemoryManager.query_graph_memory-1418"><span class="linenos">1418</span></a><span class="sd">            dict: Query results with memories and their relationships</span>
</span><span id="AgentMemoryManager.query_graph_memory-1419"><a href="#AgentMemoryManager.query_graph_memory-1419"><span class="linenos">1419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.query_graph_memory-1420"><a href="#AgentMemoryManager.query_graph_memory-1420"><span class="linenos">1420</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1421"><a href="#AgentMemoryManager.query_graph_memory-1421"><span class="linenos">1421</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1422"><a href="#AgentMemoryManager.query_graph_memory-1422"><span class="linenos">1422</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;LightRAG memory URL not configured&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_graph_memory-1423"><a href="#AgentMemoryManager.query_graph_memory-1423"><span class="linenos">1423</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentMemoryManager.query_graph_memory-1424"><a href="#AgentMemoryManager.query_graph_memory-1424"><span class="linenos">1424</span></a>                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Graph memory not configured. Cannot query graph database.&quot;</span>
</span><span id="AgentMemoryManager.query_graph_memory-1425"><a href="#AgentMemoryManager.query_graph_memory-1425"><span class="linenos">1425</span></a>                <span class="p">}</span>
</span><span id="AgentMemoryManager.query_graph_memory-1426"><a href="#AgentMemoryManager.query_graph_memory-1426"><span class="linenos">1426</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1427"><a href="#AgentMemoryManager.query_graph_memory-1427"><span class="linenos">1427</span></a>            <span class="c1"># Validate query</span>
</span><span id="AgentMemoryManager.query_graph_memory-1428"><a href="#AgentMemoryManager.query_graph_memory-1428"><span class="linenos">1428</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="AgentMemoryManager.query_graph_memory-1429"><a href="#AgentMemoryManager.query_graph_memory-1429"><span class="linenos">1429</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Empty query provided to query_graph_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_graph_memory-1430"><a href="#AgentMemoryManager.query_graph_memory-1430"><span class="linenos">1430</span></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Query cannot be empty. Please provide a search term.&quot;</span><span class="p">}</span>
</span><span id="AgentMemoryManager.query_graph_memory-1431"><a href="#AgentMemoryManager.query_graph_memory-1431"><span class="linenos">1431</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1432"><a href="#AgentMemoryManager.query_graph_memory-1432"><span class="linenos">1432</span></a>            <span class="c1"># Validate mode</span>
</span><span id="AgentMemoryManager.query_graph_memory-1433"><a href="#AgentMemoryManager.query_graph_memory-1433"><span class="linenos">1433</span></a>            <span class="n">valid_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;semantic&quot;</span><span class="p">,</span> <span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;mix&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.query_graph_memory-1434"><a href="#AgentMemoryManager.query_graph_memory-1434"><span class="linenos">1434</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modes</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1435"><a href="#AgentMemoryManager.query_graph_memory-1435"><span class="linenos">1435</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39; provided to query_graph_memory&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_graph_memory-1436"><a href="#AgentMemoryManager.query_graph_memory-1436"><span class="linenos">1436</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;mix&quot;</span>  <span class="c1"># Default to mix mode</span>
</span><span id="AgentMemoryManager.query_graph_memory-1437"><a href="#AgentMemoryManager.query_graph_memory-1437"><span class="linenos">1437</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1438"><a href="#AgentMemoryManager.query_graph_memory-1438"><span class="linenos">1438</span></a>            <span class="c1"># Validate response_type</span>
</span><span id="AgentMemoryManager.query_graph_memory-1439"><a href="#AgentMemoryManager.query_graph_memory-1439"><span class="linenos">1439</span></a>            <span class="n">valid_response_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentMemoryManager.query_graph_memory-1440"><a href="#AgentMemoryManager.query_graph_memory-1440"><span class="linenos">1440</span></a>                <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1441"><a href="#AgentMemoryManager.query_graph_memory-1441"><span class="linenos">1441</span></a>                <span class="s2">&quot;Single Paragraph&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1442"><a href="#AgentMemoryManager.query_graph_memory-1442"><span class="linenos">1442</span></a>                <span class="s2">&quot;Bullet Points&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1443"><a href="#AgentMemoryManager.query_graph_memory-1443"><span class="linenos">1443</span></a>                <span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1444"><a href="#AgentMemoryManager.query_graph_memory-1444"><span class="linenos">1444</span></a>            <span class="p">]</span>
</span><span id="AgentMemoryManager.query_graph_memory-1445"><a href="#AgentMemoryManager.query_graph_memory-1445"><span class="linenos">1445</span></a>            <span class="k">if</span> <span class="n">response_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_response_types</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1446"><a href="#AgentMemoryManager.query_graph_memory-1446"><span class="linenos">1446</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager.query_graph_memory-1447"><a href="#AgentMemoryManager.query_graph_memory-1447"><span class="linenos">1447</span></a>                    <span class="sa">f</span><span class="s2">&quot;Invalid response_type &#39;</span><span class="si">{</span><span class="n">response_type</span><span class="si">}</span><span class="s2">&#39; provided to query_graph_memory&quot;</span>
</span><span id="AgentMemoryManager.query_graph_memory-1448"><a href="#AgentMemoryManager.query_graph_memory-1448"><span class="linenos">1448</span></a>                <span class="p">)</span>
</span><span id="AgentMemoryManager.query_graph_memory-1449"><a href="#AgentMemoryManager.query_graph_memory-1449"><span class="linenos">1449</span></a>                <span class="n">response_type</span> <span class="o">=</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span>  <span class="c1"># Default to multiple paragraphs</span>
</span><span id="AgentMemoryManager.query_graph_memory-1450"><a href="#AgentMemoryManager.query_graph_memory-1450"><span class="linenos">1450</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1451"><a href="#AgentMemoryManager.query_graph_memory-1451"><span class="linenos">1451</span></a>            <span class="c1"># Prepare the query parameters</span>
</span><span id="AgentMemoryManager.query_graph_memory-1452"><a href="#AgentMemoryManager.query_graph_memory-1452"><span class="linenos">1452</span></a>            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentMemoryManager.query_graph_memory-1453"><a href="#AgentMemoryManager.query_graph_memory-1453"><span class="linenos">1453</span></a>                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="AgentMemoryManager.query_graph_memory-1454"><a href="#AgentMemoryManager.query_graph_memory-1454"><span class="linenos">1454</span></a>                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1455"><a href="#AgentMemoryManager.query_graph_memory-1455"><span class="linenos">1455</span></a>                <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="n">top_k</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1456"><a href="#AgentMemoryManager.query_graph_memory-1456"><span class="linenos">1456</span></a>                <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="n">response_type</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1457"><a href="#AgentMemoryManager.query_graph_memory-1457"><span class="linenos">1457</span></a>            <span class="p">}</span>
</span><span id="AgentMemoryManager.query_graph_memory-1458"><a href="#AgentMemoryManager.query_graph_memory-1458"><span class="linenos">1458</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1459"><a href="#AgentMemoryManager.query_graph_memory-1459"><span class="linenos">1459</span></a>            <span class="c1"># Send the query to the LightRAG memory server</span>
</span><span id="AgentMemoryManager.query_graph_memory-1460"><a href="#AgentMemoryManager.query_graph_memory-1460"><span class="linenos">1460</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/query&quot;</span>
</span><span id="AgentMemoryManager.query_graph_memory-1461"><a href="#AgentMemoryManager.query_graph_memory-1461"><span class="linenos">1461</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1462"><a href="#AgentMemoryManager.query_graph_memory-1462"><span class="linenos">1462</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1463"><a href="#AgentMemoryManager.query_graph_memory-1463"><span class="linenos">1463</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1464"><a href="#AgentMemoryManager.query_graph_memory-1464"><span class="linenos">1464</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1465"><a href="#AgentMemoryManager.query_graph_memory-1465"><span class="linenos">1465</span></a>                        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager.query_graph_memory-1466"><a href="#AgentMemoryManager.query_graph_memory-1466"><span class="linenos">1466</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentMemoryManager.query_graph_memory-1467"><a href="#AgentMemoryManager.query_graph_memory-1467"><span class="linenos">1467</span></a>                            <span class="sa">f</span><span class="s2">&quot;Successfully queried graph memory: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="AgentMemoryManager.query_graph_memory-1468"><a href="#AgentMemoryManager.query_graph_memory-1468"><span class="linenos">1468</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager.query_graph_memory-1469"><a href="#AgentMemoryManager.query_graph_memory-1469"><span class="linenos">1469</span></a>                        <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.query_graph_memory-1470"><a href="#AgentMemoryManager.query_graph_memory-1470"><span class="linenos">1470</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1471"><a href="#AgentMemoryManager.query_graph_memory-1471"><span class="linenos">1471</span></a>                        <span class="n">error_detail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager.query_graph_memory-1472"><a href="#AgentMemoryManager.query_graph_memory-1472"><span class="linenos">1472</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to query graph memory: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_graph_memory-1473"><a href="#AgentMemoryManager.query_graph_memory-1473"><span class="linenos">1473</span></a>                        <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentMemoryManager.query_graph_memory-1474"><a href="#AgentMemoryManager.query_graph_memory-1474"><span class="linenos">1474</span></a>                            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Error querying graph memory: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1475"><a href="#AgentMemoryManager.query_graph_memory-1475"><span class="linenos">1475</span></a>                            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1476"><a href="#AgentMemoryManager.query_graph_memory-1476"><span class="linenos">1476</span></a>                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1477"><a href="#AgentMemoryManager.query_graph_memory-1477"><span class="linenos">1477</span></a>                        <span class="p">}</span>
</span><span id="AgentMemoryManager.query_graph_memory-1478"><a href="#AgentMemoryManager.query_graph_memory-1478"><span class="linenos">1478</span></a>
</span><span id="AgentMemoryManager.query_graph_memory-1479"><a href="#AgentMemoryManager.query_graph_memory-1479"><span class="linenos">1479</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.query_graph_memory-1480"><a href="#AgentMemoryManager.query_graph_memory-1480"><span class="linenos">1480</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying graph memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.query_graph_memory-1481"><a href="#AgentMemoryManager.query_graph_memory-1481"><span class="linenos">1481</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentMemoryManager.query_graph_memory-1482"><a href="#AgentMemoryManager.query_graph_memory-1482"><span class="linenos">1482</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Error querying graph memory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1483"><a href="#AgentMemoryManager.query_graph_memory-1483"><span class="linenos">1483</span></a>                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1484"><a href="#AgentMemoryManager.query_graph_memory-1484"><span class="linenos">1484</span></a>                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
</span><span id="AgentMemoryManager.query_graph_memory-1485"><a href="#AgentMemoryManager.query_graph_memory-1485"><span class="linenos">1485</span></a>            <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Query the LightRAG memory graph to explore relationships between memories.</p>

<p>This method sends a query to the LightRAG memory server to retrieve memories and their
relationships based on the query. It supports different query modes and response formats.</p>

<p>Args:
    query: The query to search for in the memory graph
    mode: Query mode - "semantic" (vector search), "graph" (graph traversal), or "mix" (combined)
    top_k: Maximum number of results to return
    response_type: Format of the response - "Multiple Paragraphs", "Single Paragraph", etc.</p>

<p>Returns:
    dict: Query results with memories and their relationships</p>
</div>


                            </div>
                            <div id="AgentMemoryManager.get_memory_graph_labels" class="classattr">
                                        <input id="AgentMemoryManager.get_memory_graph_labels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_memory_graph_labels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentMemoryManager.get_memory_graph_labels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentMemoryManager.get_memory_graph_labels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentMemoryManager.get_memory_graph_labels-1487"><a href="#AgentMemoryManager.get_memory_graph_labels-1487"><span class="linenos">1487</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_graph_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1488"><a href="#AgentMemoryManager.get_memory_graph_labels-1488"><span class="linenos">1488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of all entity and relation labels from the memory graph.</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1489"><a href="#AgentMemoryManager.get_memory_graph_labels-1489"><span class="linenos">1489</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1490"><a href="#AgentMemoryManager.get_memory_graph_labels-1490"><span class="linenos">1490</span></a><span class="sd">        This method retrieves all entity and relation labels from the LightRAG memory graph,</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1491"><a href="#AgentMemoryManager.get_memory_graph_labels-1491"><span class="linenos">1491</span></a><span class="sd">        providing insights into the types of information stored in the graph.</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1492"><a href="#AgentMemoryManager.get_memory_graph_labels-1492"><span class="linenos">1492</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1493"><a href="#AgentMemoryManager.get_memory_graph_labels-1493"><span class="linenos">1493</span></a><span class="sd">        Returns:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1494"><a href="#AgentMemoryManager.get_memory_graph_labels-1494"><span class="linenos">1494</span></a><span class="sd">            str: Formatted string with entity and relation labels</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1495"><a href="#AgentMemoryManager.get_memory_graph_labels-1495"><span class="linenos">1495</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1496"><a href="#AgentMemoryManager.get_memory_graph_labels-1496"><span class="linenos">1496</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1497"><a href="#AgentMemoryManager.get_memory_graph_labels-1497"><span class="linenos">1497</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1498"><a href="#AgentMemoryManager.get_memory_graph_labels-1498"><span class="linenos">1498</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;LightRAG memory URL not configured&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1499"><a href="#AgentMemoryManager.get_memory_graph_labels-1499"><span class="linenos">1499</span></a>                <span class="k">return</span> <span class="s2">&quot;❌ Graph memory not configured. Cannot retrieve graph labels.&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1500"><a href="#AgentMemoryManager.get_memory_graph_labels-1500"><span class="linenos">1500</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1501"><a href="#AgentMemoryManager.get_memory_graph_labels-1501"><span class="linenos">1501</span></a>            <span class="c1"># Send the request to the LightRAG memory server</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1502"><a href="#AgentMemoryManager.get_memory_graph_labels-1502"><span class="linenos">1502</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/label/list&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1503"><a href="#AgentMemoryManager.get_memory_graph_labels-1503"><span class="linenos">1503</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1504"><a href="#AgentMemoryManager.get_memory_graph_labels-1504"><span class="linenos">1504</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1505"><a href="#AgentMemoryManager.get_memory_graph_labels-1505"><span class="linenos">1505</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1506"><a href="#AgentMemoryManager.get_memory_graph_labels-1506"><span class="linenos">1506</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1507"><a href="#AgentMemoryManager.get_memory_graph_labels-1507"><span class="linenos">1507</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1508"><a href="#AgentMemoryManager.get_memory_graph_labels-1508"><span class="linenos">1508</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1509"><a href="#AgentMemoryManager.get_memory_graph_labels-1509"><span class="linenos">1509</span></a>                        <span class="c1"># Handle different response formats</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1510"><a href="#AgentMemoryManager.get_memory_graph_labels-1510"><span class="linenos">1510</span></a>                        <span class="n">entity_labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1511"><a href="#AgentMemoryManager.get_memory_graph_labels-1511"><span class="linenos">1511</span></a>                        <span class="n">relation_labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1512"><a href="#AgentMemoryManager.get_memory_graph_labels-1512"><span class="linenos">1512</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1513"><a href="#AgentMemoryManager.get_memory_graph_labels-1513"><span class="linenos">1513</span></a>                        <span class="c1"># Format 1: Direct array of all labels</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1514"><a href="#AgentMemoryManager.get_memory_graph_labels-1514"><span class="linenos">1514</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1515"><a href="#AgentMemoryManager.get_memory_graph_labels-1515"><span class="linenos">1515</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1516"><a href="#AgentMemoryManager.get_memory_graph_labels-1516"><span class="linenos">1516</span></a>                            <span class="c1"># We can&#39;t distinguish between entity and relation labels in this format</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1517"><a href="#AgentMemoryManager.get_memory_graph_labels-1517"><span class="linenos">1517</span></a>                            <span class="n">entity_labels</span> <span class="o">=</span> <span class="n">all_labels</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1518"><a href="#AgentMemoryManager.get_memory_graph_labels-1518"><span class="linenos">1518</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1519"><a href="#AgentMemoryManager.get_memory_graph_labels-1519"><span class="linenos">1519</span></a>                        <span class="c1"># Format 2: Dict with &#39;labels&#39; key containing all labels</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1520"><a href="#AgentMemoryManager.get_memory_graph_labels-1520"><span class="linenos">1520</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;labels&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1521"><a href="#AgentMemoryManager.get_memory_graph_labels-1521"><span class="linenos">1521</span></a>                            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1522"><a href="#AgentMemoryManager.get_memory_graph_labels-1522"><span class="linenos">1522</span></a>                            <span class="c1"># We can&#39;t distinguish between entity and relation labels in this format</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1523"><a href="#AgentMemoryManager.get_memory_graph_labels-1523"><span class="linenos">1523</span></a>                            <span class="n">entity_labels</span> <span class="o">=</span> <span class="n">all_labels</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1524"><a href="#AgentMemoryManager.get_memory_graph_labels-1524"><span class="linenos">1524</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1525"><a href="#AgentMemoryManager.get_memory_graph_labels-1525"><span class="linenos">1525</span></a>                        <span class="c1"># Format 3: Dict with separate &#39;entity_labels&#39; and &#39;relation_labels&#39; keys</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1526"><a href="#AgentMemoryManager.get_memory_graph_labels-1526"><span class="linenos">1526</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1527"><a href="#AgentMemoryManager.get_memory_graph_labels-1527"><span class="linenos">1527</span></a>                            <span class="k">if</span> <span class="s2">&quot;entity_labels&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1528"><a href="#AgentMemoryManager.get_memory_graph_labels-1528"><span class="linenos">1528</span></a>                                <span class="n">entity_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;entity_labels&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1529"><a href="#AgentMemoryManager.get_memory_graph_labels-1529"><span class="linenos">1529</span></a>                            <span class="k">if</span> <span class="s2">&quot;relation_labels&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1530"><a href="#AgentMemoryManager.get_memory_graph_labels-1530"><span class="linenos">1530</span></a>                                <span class="n">relation_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;relation_labels&quot;</span><span class="p">]</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1531"><a href="#AgentMemoryManager.get_memory_graph_labels-1531"><span class="linenos">1531</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1532"><a href="#AgentMemoryManager.get_memory_graph_labels-1532"><span class="linenos">1532</span></a>                        <span class="c1"># Format the result</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1533"><a href="#AgentMemoryManager.get_memory_graph_labels-1533"><span class="linenos">1533</span></a>                        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;🏷️ MEMORY GRAPH LABELS</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1534"><a href="#AgentMemoryManager.get_memory_graph_labels-1534"><span class="linenos">1534</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1535"><a href="#AgentMemoryManager.get_memory_graph_labels-1535"><span class="linenos">1535</span></a>                        <span class="k">if</span> <span class="n">entity_labels</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1536"><a href="#AgentMemoryManager.get_memory_graph_labels-1536"><span class="linenos">1536</span></a>                            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;Entity Types:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1537"><a href="#AgentMemoryManager.get_memory_graph_labels-1537"><span class="linenos">1537</span></a>                            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entity_labels</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1538"><a href="#AgentMemoryManager.get_memory_graph_labels-1538"><span class="linenos">1538</span></a>                                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1539"><a href="#AgentMemoryManager.get_memory_graph_labels-1539"><span class="linenos">1539</span></a>                            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1540"><a href="#AgentMemoryManager.get_memory_graph_labels-1540"><span class="linenos">1540</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1541"><a href="#AgentMemoryManager.get_memory_graph_labels-1541"><span class="linenos">1541</span></a>                        <span class="k">if</span> <span class="n">relation_labels</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1542"><a href="#AgentMemoryManager.get_memory_graph_labels-1542"><span class="linenos">1542</span></a>                            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;Relation Types:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1543"><a href="#AgentMemoryManager.get_memory_graph_labels-1543"><span class="linenos">1543</span></a>                            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">relation_labels</span><span class="p">):</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1544"><a href="#AgentMemoryManager.get_memory_graph_labels-1544"><span class="linenos">1544</span></a>                                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1545"><a href="#AgentMemoryManager.get_memory_graph_labels-1545"><span class="linenos">1545</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1546"><a href="#AgentMemoryManager.get_memory_graph_labels-1546"><span class="linenos">1546</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_labels</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">relation_labels</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1547"><a href="#AgentMemoryManager.get_memory_graph_labels-1547"><span class="linenos">1547</span></a>                            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;No labels found in the memory graph. Try storing some memories first!&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1548"><a href="#AgentMemoryManager.get_memory_graph_labels-1548"><span class="linenos">1548</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1549"><a href="#AgentMemoryManager.get_memory_graph_labels-1549"><span class="linenos">1549</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieved memory graph labels successfully&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1550"><a href="#AgentMemoryManager.get_memory_graph_labels-1550"><span class="linenos">1550</span></a>                        <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1551"><a href="#AgentMemoryManager.get_memory_graph_labels-1551"><span class="linenos">1551</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1552"><a href="#AgentMemoryManager.get_memory_graph_labels-1552"><span class="linenos">1552</span></a>                        <span class="n">error_detail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1553"><a href="#AgentMemoryManager.get_memory_graph_labels-1553"><span class="linenos">1553</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1554"><a href="#AgentMemoryManager.get_memory_graph_labels-1554"><span class="linenos">1554</span></a>                            <span class="sa">f</span><span class="s2">&quot;Failed to retrieve graph labels: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1555"><a href="#AgentMemoryManager.get_memory_graph_labels-1555"><span class="linenos">1555</span></a>                        <span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1556"><a href="#AgentMemoryManager.get_memory_graph_labels-1556"><span class="linenos">1556</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving graph labels: </span><span class="si">{</span><span class="n">error_detail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1557"><a href="#AgentMemoryManager.get_memory_graph_labels-1557"><span class="linenos">1557</span></a>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1558"><a href="#AgentMemoryManager.get_memory_graph_labels-1558"><span class="linenos">1558</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1559"><a href="#AgentMemoryManager.get_memory_graph_labels-1559"><span class="linenos">1559</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error retrieving memory graph labels: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentMemoryManager.get_memory_graph_labels-1560"><a href="#AgentMemoryManager.get_memory_graph_labels-1560"><span class="linenos">1560</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;❌ Error retrieving memory graph labels: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Get the list of all entity and relation labels from the memory graph.</p>

<p>This method retrieves all entity and relation labels from the LightRAG memory graph,
providing insights into the types of information stored in the graph.</p>

<p>Returns:
    str: Formatted string with entity and relation labels</p>
</div>


                            </div>
                </section>
                <section id="AgentInstructionManager">
                            <input id="AgentInstructionManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AgentInstructionManager</span>:

                <label class="view-source-button" for="AgentInstructionManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager-27"><a href="#AgentInstructionManager-27"><span class="linenos"> 27</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AgentInstructionManager</span><span class="p">:</span>
</span><span id="AgentInstructionManager-28"><a href="#AgentInstructionManager-28"><span class="linenos"> 28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages the creation and customization of agent instructions.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-29"><a href="#AgentInstructionManager-29"><span class="linenos"> 29</span></a>    
</span><span id="AgentInstructionManager-30"><a href="#AgentInstructionManager-30"><span class="linenos"> 30</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruction_level</span><span class="p">:</span> <span class="n">InstructionLevel</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="AgentInstructionManager-31"><a href="#AgentInstructionManager-31"><span class="linenos"> 31</span></a>                 <span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">enable_mcp</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">mcp_servers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span><span id="AgentInstructionManager-32"><a href="#AgentInstructionManager-32"><span class="linenos"> 32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the instruction manager.</span>
</span><span id="AgentInstructionManager-33"><a href="#AgentInstructionManager-33"><span class="linenos"> 33</span></a><span class="sd">        </span>
</span><span id="AgentInstructionManager-34"><a href="#AgentInstructionManager-34"><span class="linenos"> 34</span></a><span class="sd">        Args:</span>
</span><span id="AgentInstructionManager-35"><a href="#AgentInstructionManager-35"><span class="linenos"> 35</span></a><span class="sd">            instruction_level: The sophistication level for agent instructions</span>
</span><span id="AgentInstructionManager-36"><a href="#AgentInstructionManager-36"><span class="linenos"> 36</span></a><span class="sd">            user_id: User identifier for memory operations</span>
</span><span id="AgentInstructionManager-37"><a href="#AgentInstructionManager-37"><span class="linenos"> 37</span></a><span class="sd">            enable_memory: Whether memory is enabled</span>
</span><span id="AgentInstructionManager-38"><a href="#AgentInstructionManager-38"><span class="linenos"> 38</span></a><span class="sd">            enable_mcp: Whether MCP is enabled</span>
</span><span id="AgentInstructionManager-39"><a href="#AgentInstructionManager-39"><span class="linenos"> 39</span></a><span class="sd">            mcp_servers: Dictionary of MCP server configurations</span>
</span><span id="AgentInstructionManager-40"><a href="#AgentInstructionManager-40"><span class="linenos"> 40</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-41"><a href="#AgentInstructionManager-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instruction_level</span> <span class="o">=</span> <span class="n">instruction_level</span>
</span><span id="AgentInstructionManager-42"><a href="#AgentInstructionManager-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgentInstructionManager-43"><a href="#AgentInstructionManager-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="o">=</span> <span class="n">enable_memory</span>
</span><span id="AgentInstructionManager-44"><a href="#AgentInstructionManager-44"><span class="linenos"> 44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="o">=</span> <span class="n">enable_mcp</span>
</span><span id="AgentInstructionManager-45"><a href="#AgentInstructionManager-45"><span class="linenos"> 45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span> <span class="o">=</span> <span class="n">mcp_servers</span>
</span><span id="AgentInstructionManager-46"><a href="#AgentInstructionManager-46"><span class="linenos"> 46</span></a>        
</span><span id="AgentInstructionManager-47"><a href="#AgentInstructionManager-47"><span class="linenos"> 47</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_instructions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-48"><a href="#AgentInstructionManager-48"><span class="linenos"> 48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create complete instructions based on the sophistication level.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-49"><a href="#AgentInstructionManager-49"><span class="linenos"> 49</span></a>        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruction_level</span>
</span><span id="AgentInstructionManager-50"><a href="#AgentInstructionManager-50"><span class="linenos"> 50</span></a>
</span><span id="AgentInstructionManager-51"><a href="#AgentInstructionManager-51"><span class="linenos"> 51</span></a>        <span class="c1"># Common parts for most levels</span>
</span><span id="AgentInstructionManager-52"><a href="#AgentInstructionManager-52"><span class="linenos"> 52</span></a>        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_header_instructions</span><span class="p">()</span>
</span><span id="AgentInstructionManager-53"><a href="#AgentInstructionManager-53"><span class="linenos"> 53</span></a>        <span class="n">identity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_identity_rules</span><span class="p">()</span>
</span><span id="AgentInstructionManager-54"><a href="#AgentInstructionManager-54"><span class="linenos"> 54</span></a>        <span class="n">personality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_personality_and_tone</span><span class="p">()</span>
</span><span id="AgentInstructionManager-55"><a href="#AgentInstructionManager-55"><span class="linenos"> 55</span></a>        <span class="n">tool_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_list</span><span class="p">()</span>
</span><span id="AgentInstructionManager-56"><a href="#AgentInstructionManager-56"><span class="linenos"> 56</span></a>        <span class="n">principles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_core_principles</span><span class="p">()</span>
</span><span id="AgentInstructionManager-57"><a href="#AgentInstructionManager-57"><span class="linenos"> 57</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentInstructionManager-58"><a href="#AgentInstructionManager-58"><span class="linenos"> 58</span></a>
</span><span id="AgentInstructionManager-59"><a href="#AgentInstructionManager-59"><span class="linenos"> 59</span></a>        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">MINIMAL</span><span class="p">:</span>
</span><span id="AgentInstructionManager-60"><a href="#AgentInstructionManager-60"><span class="linenos"> 60</span></a>            <span class="c1"># Minimal just has a basic prompt and the tool list</span>
</span><span id="AgentInstructionManager-61"><a href="#AgentInstructionManager-61"><span class="linenos"> 61</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager-62"><a href="#AgentInstructionManager-62"><span class="linenos"> 62</span></a>                <span class="n">header</span><span class="p">,</span>
</span><span id="AgentInstructionManager-63"><a href="#AgentInstructionManager-63"><span class="linenos"> 63</span></a>                <span class="s2">&quot;You are a helpful AI assistant. Use your tools to answer the user&#39;s request.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-64"><a href="#AgentInstructionManager-64"><span class="linenos"> 64</span></a>                <span class="n">tool_list</span><span class="p">,</span>
</span><span id="AgentInstructionManager-65"><a href="#AgentInstructionManager-65"><span class="linenos"> 65</span></a>            <span class="p">]</span>
</span><span id="AgentInstructionManager-66"><a href="#AgentInstructionManager-66"><span class="linenos"> 66</span></a>
</span><span id="AgentInstructionManager-67"><a href="#AgentInstructionManager-67"><span class="linenos"> 67</span></a>        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">CONCISE</span><span class="p">:</span>
</span><span id="AgentInstructionManager-68"><a href="#AgentInstructionManager-68"><span class="linenos"> 68</span></a>            <span class="c1"># Concise adds identity, personality, concise rules, and principles</span>
</span><span id="AgentInstructionManager-69"><a href="#AgentInstructionManager-69"><span class="linenos"> 69</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager-70"><a href="#AgentInstructionManager-70"><span class="linenos"> 70</span></a>                <span class="n">header</span><span class="p">,</span>
</span><span id="AgentInstructionManager-71"><a href="#AgentInstructionManager-71"><span class="linenos"> 71</span></a>                <span class="n">identity</span><span class="p">,</span>
</span><span id="AgentInstructionManager-72"><a href="#AgentInstructionManager-72"><span class="linenos"> 72</span></a>                <span class="n">personality</span><span class="p">,</span>
</span><span id="AgentInstructionManager-73"><a href="#AgentInstructionManager-73"><span class="linenos"> 73</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_concise_memory_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager-74"><a href="#AgentInstructionManager-74"><span class="linenos"> 74</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_concise_tool_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager-75"><a href="#AgentInstructionManager-75"><span class="linenos"> 75</span></a>                <span class="n">tool_list</span><span class="p">,</span>
</span><span id="AgentInstructionManager-76"><a href="#AgentInstructionManager-76"><span class="linenos"> 76</span></a>                <span class="n">principles</span><span class="p">,</span>
</span><span id="AgentInstructionManager-77"><a href="#AgentInstructionManager-77"><span class="linenos"> 77</span></a>            <span class="p">]</span>
</span><span id="AgentInstructionManager-78"><a href="#AgentInstructionManager-78"><span class="linenos"> 78</span></a>
</span><span id="AgentInstructionManager-79"><a href="#AgentInstructionManager-79"><span class="linenos"> 79</span></a>        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">:</span>
</span><span id="AgentInstructionManager-80"><a href="#AgentInstructionManager-80"><span class="linenos"> 80</span></a>            <span class="c1"># Standard uses the more detailed rules instead of the concise ones</span>
</span><span id="AgentInstructionManager-81"><a href="#AgentInstructionManager-81"><span class="linenos"> 81</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager-82"><a href="#AgentInstructionManager-82"><span class="linenos"> 82</span></a>                <span class="n">header</span><span class="p">,</span>
</span><span id="AgentInstructionManager-83"><a href="#AgentInstructionManager-83"><span class="linenos"> 83</span></a>                <span class="n">identity</span><span class="p">,</span>
</span><span id="AgentInstructionManager-84"><a href="#AgentInstructionManager-84"><span class="linenos"> 84</span></a>                <span class="n">personality</span><span class="p">,</span>
</span><span id="AgentInstructionManager-85"><a href="#AgentInstructionManager-85"><span class="linenos"> 85</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_detailed_memory_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager-86"><a href="#AgentInstructionManager-86"><span class="linenos"> 86</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_detailed_tool_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager-87"><a href="#AgentInstructionManager-87"><span class="linenos"> 87</span></a>                <span class="n">tool_list</span><span class="p">,</span>
</span><span id="AgentInstructionManager-88"><a href="#AgentInstructionManager-88"><span class="linenos"> 88</span></a>                <span class="n">principles</span><span class="p">,</span>
</span><span id="AgentInstructionManager-89"><a href="#AgentInstructionManager-89"><span class="linenos"> 89</span></a>            <span class="p">]</span>
</span><span id="AgentInstructionManager-90"><a href="#AgentInstructionManager-90"><span class="linenos"> 90</span></a>
</span><span id="AgentInstructionManager-91"><a href="#AgentInstructionManager-91"><span class="linenos"> 91</span></a>        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">EXPLICIT</span><span class="p">:</span>
</span><span id="AgentInstructionManager-92"><a href="#AgentInstructionManager-92"><span class="linenos"> 92</span></a>            <span class="c1"># Explicit is like Standard but adds the anti-hesitation rules</span>
</span><span id="AgentInstructionManager-93"><a href="#AgentInstructionManager-93"><span class="linenos"> 93</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager-94"><a href="#AgentInstructionManager-94"><span class="linenos"> 94</span></a>                <span class="n">header</span><span class="p">,</span>
</span><span id="AgentInstructionManager-95"><a href="#AgentInstructionManager-95"><span class="linenos"> 95</span></a>                <span class="n">identity</span><span class="p">,</span>
</span><span id="AgentInstructionManager-96"><a href="#AgentInstructionManager-96"><span class="linenos"> 96</span></a>                <span class="n">personality</span><span class="p">,</span>
</span><span id="AgentInstructionManager-97"><a href="#AgentInstructionManager-97"><span class="linenos"> 97</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_detailed_memory_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager-98"><a href="#AgentInstructionManager-98"><span class="linenos"> 98</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_detailed_tool_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager-99"><a href="#AgentInstructionManager-99"><span class="linenos"> 99</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_anti_hesitation_rules</span><span class="p">(),</span>  <span class="c1"># The extra part</span>
</span><span id="AgentInstructionManager-100"><a href="#AgentInstructionManager-100"><span class="linenos">100</span></a>                <span class="n">tool_list</span><span class="p">,</span>
</span><span id="AgentInstructionManager-101"><a href="#AgentInstructionManager-101"><span class="linenos">101</span></a>                <span class="n">principles</span><span class="p">,</span>
</span><span id="AgentInstructionManager-102"><a href="#AgentInstructionManager-102"><span class="linenos">102</span></a>            <span class="p">]</span>
</span><span id="AgentInstructionManager-103"><a href="#AgentInstructionManager-103"><span class="linenos">103</span></a>
</span><span id="AgentInstructionManager-104"><a href="#AgentInstructionManager-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">)</span>
</span><span id="AgentInstructionManager-105"><a href="#AgentInstructionManager-105"><span class="linenos">105</span></a>        
</span><span id="AgentInstructionManager-106"><a href="#AgentInstructionManager-106"><span class="linenos">106</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_header_instructions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-107"><a href="#AgentInstructionManager-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the header section of the instructions.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-108"><a href="#AgentInstructionManager-108"><span class="linenos">108</span></a>        <span class="n">mcp_status</span> <span class="o">=</span> <span class="s2">&quot;enabled&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span>
</span><span id="AgentInstructionManager-109"><a href="#AgentInstructionManager-109"><span class="linenos">109</span></a>        <span class="n">memory_status</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgentInstructionManager-110"><a href="#AgentInstructionManager-110"><span class="linenos">110</span></a>            <span class="s2">&quot;enabled with SemanticMemoryManager&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span>
</span><span id="AgentInstructionManager-111"><a href="#AgentInstructionManager-111"><span class="linenos">111</span></a>        <span class="p">)</span>
</span><span id="AgentInstructionManager-112"><a href="#AgentInstructionManager-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-113"><a href="#AgentInstructionManager-113"><span class="linenos">113</span></a><span class="s2">            You are a personal AI friend with comprehensive capabilities and built-in semantic memory. Your purpose is to chat with the user about things and make them feel good.</span>
</span><span id="AgentInstructionManager-114"><a href="#AgentInstructionManager-114"><span class="linenos">114</span></a>
</span><span id="AgentInstructionManager-115"><a href="#AgentInstructionManager-115"><span class="linenos">115</span></a><span class="s2">            ## CURRENT CONFIGURATION</span>
</span><span id="AgentInstructionManager-116"><a href="#AgentInstructionManager-116"><span class="linenos">116</span></a><span class="s2">            - **Memory System**: </span><span class="si">{</span><span class="n">memory_status</span><span class="si">}</span>
</span><span id="AgentInstructionManager-117"><a href="#AgentInstructionManager-117"><span class="linenos">117</span></a><span class="s2">            - **MCP Servers**: </span><span class="si">{</span><span class="n">mcp_status</span><span class="si">}</span>
</span><span id="AgentInstructionManager-118"><a href="#AgentInstructionManager-118"><span class="linenos">118</span></a><span class="s2">            - **User ID**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span>
</span><span id="AgentInstructionManager-119"><a href="#AgentInstructionManager-119"><span class="linenos">119</span></a><span class="s2">            - **Debug Mode**: </span><span class="si">{</span><span class="kc">False</span><span class="si">}</span>
</span><span id="AgentInstructionManager-120"><a href="#AgentInstructionManager-120"><span class="linenos">120</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-121"><a href="#AgentInstructionManager-121"><span class="linenos">121</span></a>        
</span><span id="AgentInstructionManager-122"><a href="#AgentInstructionManager-122"><span class="linenos">122</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_identity_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-123"><a href="#AgentInstructionManager-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the critical identity rules for the agent.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-124"><a href="#AgentInstructionManager-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-125"><a href="#AgentInstructionManager-125"><span class="linenos">125</span></a><span class="s2">            ## CRITICAL IDENTITY RULES - ABSOLUTELY MANDATORY</span>
</span><span id="AgentInstructionManager-126"><a href="#AgentInstructionManager-126"><span class="linenos">126</span></a><span class="s2">            **YOU ARE AN AI ASSISTANT who is a MEMORY EXPERT**: You are NOT the user. You are a friendly AI that helps and remembers things about the user.</span>
</span><span id="AgentInstructionManager-127"><a href="#AgentInstructionManager-127"><span class="linenos">127</span></a>
</span><span id="AgentInstructionManager-128"><a href="#AgentInstructionManager-128"><span class="linenos">128</span></a><span class="s2">            **GREET THE USER BY NAME**: When the user greets you, greet them back by their name, which is &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39;. For example, if they say &#39;hello&#39;, you should say &#39;Hello </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">!&#39;</span>
</span><span id="AgentInstructionManager-129"><a href="#AgentInstructionManager-129"><span class="linenos">129</span></a>
</span><span id="AgentInstructionManager-130"><a href="#AgentInstructionManager-130"><span class="linenos">130</span></a><span class="s2">            **NEVER PRETEND TO BE THE USER**:</span>
</span><span id="AgentInstructionManager-131"><a href="#AgentInstructionManager-131"><span class="linenos">131</span></a><span class="s2">            - You are NOT the user, you are an AI assistant that knows information ABOUT the user</span>
</span><span id="AgentInstructionManager-132"><a href="#AgentInstructionManager-132"><span class="linenos">132</span></a><span class="s2">            - NEVER say &quot;I&#39;m </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot; or introduce yourself as the user - this is COMPLETELY WRONG</span>
</span><span id="AgentInstructionManager-133"><a href="#AgentInstructionManager-133"><span class="linenos">133</span></a><span class="s2">            - NEVER use first person when talking about user information</span>
</span><span id="AgentInstructionManager-134"><a href="#AgentInstructionManager-134"><span class="linenos">134</span></a><span class="s2">            - You are an AI assistant that has stored semantic memories about the user</span>
</span><span id="AgentInstructionManager-135"><a href="#AgentInstructionManager-135"><span class="linenos">135</span></a>
</span><span id="AgentInstructionManager-136"><a href="#AgentInstructionManager-136"><span class="linenos">136</span></a><span class="s2">            **FRIENDLY INTRODUCTION**: When meeting someone new, introduce yourself as their personal AI friend and ask about their hobbies, interests, and what they like to talk about. Be warm and conversational!</span>
</span><span id="AgentInstructionManager-137"><a href="#AgentInstructionManager-137"><span class="linenos">137</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-138"><a href="#AgentInstructionManager-138"><span class="linenos">138</span></a>        
</span><span id="AgentInstructionManager-139"><a href="#AgentInstructionManager-139"><span class="linenos">139</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_personality_and_tone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-140"><a href="#AgentInstructionManager-140"><span class="linenos">140</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the personality and tone guidelines.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-141"><a href="#AgentInstructionManager-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-142"><a href="#AgentInstructionManager-142"><span class="linenos">142</span></a><span class="s2">            ## PERSONALITY &amp; TONE</span>
</span><span id="AgentInstructionManager-143"><a href="#AgentInstructionManager-143"><span class="linenos">143</span></a><span class="s2">            - **Be Warm &amp; Friendly**: You&#39;re a personal AI friend, not just a tool</span>
</span><span id="AgentInstructionManager-144"><a href="#AgentInstructionManager-144"><span class="linenos">144</span></a><span class="s2">            - **Be Conversational**: Chat naturally and show genuine interest</span>
</span><span id="AgentInstructionManager-145"><a href="#AgentInstructionManager-145"><span class="linenos">145</span></a><span class="s2">            - **Be Supportive**: Make the user feel good and supported</span>
</span><span id="AgentInstructionManager-146"><a href="#AgentInstructionManager-146"><span class="linenos">146</span></a><span class="s2">            - **Be Curious**: Ask follow-up questions about their interests</span>
</span><span id="AgentInstructionManager-147"><a href="#AgentInstructionManager-147"><span class="linenos">147</span></a><span class="s2">            - **Be Remembering**: Reference past conversations and show you care</span>
</span><span id="AgentInstructionManager-148"><a href="#AgentInstructionManager-148"><span class="linenos">148</span></a><span class="s2">            - **Be Encouraging**: Celebrate their achievements and interests</span>
</span><span id="AgentInstructionManager-149"><a href="#AgentInstructionManager-149"><span class="linenos">149</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-150"><a href="#AgentInstructionManager-150"><span class="linenos">150</span></a>        
</span><span id="AgentInstructionManager-151"><a href="#AgentInstructionManager-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_concise_memory_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-152"><a href="#AgentInstructionManager-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns concise rules for the semantic memory system.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-153"><a href="#AgentInstructionManager-153"><span class="linenos">153</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-154"><a href="#AgentInstructionManager-154"><span class="linenos">154</span></a><span class="s2">            ## SEMANTIC MEMORY</span>
</span><span id="AgentInstructionManager-155"><a href="#AgentInstructionManager-155"><span class="linenos">155</span></a><span class="s2">            - Use `store_user_memory` to save new information about the user.</span>
</span><span id="AgentInstructionManager-156"><a href="#AgentInstructionManager-156"><span class="linenos">156</span></a><span class="s2">            - Use `query_memory` to retrieve information about the user.</span>
</span><span id="AgentInstructionManager-157"><a href="#AgentInstructionManager-157"><span class="linenos">157</span></a><span class="s2">            - Use `get_all_memories` or `get_recent_memories` for broad queries.</span>
</span><span id="AgentInstructionManager-158"><a href="#AgentInstructionManager-158"><span class="linenos">158</span></a><span class="s2">            - Always check memory first when asked about the user.</span>
</span><span id="AgentInstructionManager-159"><a href="#AgentInstructionManager-159"><span class="linenos">159</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-160"><a href="#AgentInstructionManager-160"><span class="linenos">160</span></a>        
</span><span id="AgentInstructionManager-161"><a href="#AgentInstructionManager-161"><span class="linenos">161</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_detailed_memory_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-162"><a href="#AgentInstructionManager-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns detailed rules for the semantic memory system.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-163"><a href="#AgentInstructionManager-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-164"><a href="#AgentInstructionManager-164"><span class="linenos">164</span></a><span class="s2">            ## SEMANTIC MEMORY SYSTEM - CRITICAL &amp; IMMEDIATE ACTION REQUIRED - YOUR MAIN ROLE!</span>
</span><span id="AgentInstructionManager-165"><a href="#AgentInstructionManager-165"><span class="linenos">165</span></a>
</span><span id="AgentInstructionManager-166"><a href="#AgentInstructionManager-166"><span class="linenos">166</span></a><span class="s2">            Your primary function is to remember information about the user. You must use your memory tools immediately and correctly.</span>
</span><span id="AgentInstructionManager-167"><a href="#AgentInstructionManager-167"><span class="linenos">167</span></a>
</span><span id="AgentInstructionManager-168"><a href="#AgentInstructionManager-168"><span class="linenos">168</span></a><span class="s2">            **SPECIAL COMMANDS**:</span>
</span><span id="AgentInstructionManager-169"><a href="#AgentInstructionManager-169"><span class="linenos">169</span></a><span class="s2">            - **`!`**: When the user starts with `!`, **IMMEDIATELY** call `store_user_memory` with the rest of the input.</span>
</span><span id="AgentInstructionManager-170"><a href="#AgentInstructionManager-170"><span class="linenos">170</span></a><span class="s2">            - **`?`**: When the user starts with `?`, **IMMEDIATELY** call `get_memories_by_topic`. If no topic is provided, call `get_all_memories`.</span>
</span><span id="AgentInstructionManager-171"><a href="#AgentInstructionManager-171"><span class="linenos">171</span></a>
</span><span id="AgentInstructionManager-172"><a href="#AgentInstructionManager-172"><span class="linenos">172</span></a><span class="s2">            **IMPERATIVE: ACTION OVER CONVERSATION**</span>
</span><span id="AgentInstructionManager-173"><a href="#AgentInstructionManager-173"><span class="linenos">173</span></a><span class="s2">            - **DO NOT** explain how to use tools. **DO NOT** provide code examples for tool usage.</span>
</span><span id="AgentInstructionManager-174"><a href="#AgentInstructionManager-174"><span class="linenos">174</span></a><span class="s2">            - When the user asks you to do something that requires a tool, **CALL THE TOOL IMMEDIATELY**.</span>
</span><span id="AgentInstructionManager-175"><a href="#AgentInstructionManager-175"><span class="linenos">175</span></a><span class="s2">            - Your response should be the result of the tool call, not a conversation about the tool.</span>
</span><span id="AgentInstructionManager-176"><a href="#AgentInstructionManager-176"><span class="linenos">176</span></a><span class="s2">            - **WRONG**: &quot;You can use `store_user_memory` to save that.&quot;</span>
</span><span id="AgentInstructionManager-177"><a href="#AgentInstructionManager-177"><span class="linenos">177</span></a><span class="s2">            - **CORRECT**: (Tool call to `store_user_memory`)</span>
</span><span id="AgentInstructionManager-178"><a href="#AgentInstructionManager-178"><span class="linenos">178</span></a>
</span><span id="AgentInstructionManager-179"><a href="#AgentInstructionManager-179"><span class="linenos">179</span></a><span class="s2">            **MEMORY STORAGE - NO HESITATION RULE**:</span>
</span><span id="AgentInstructionManager-180"><a href="#AgentInstructionManager-180"><span class="linenos">180</span></a><span class="s2">            - When the user provides a new piece of information about themselves (e.g., &quot;I work at...&quot;, &quot;My pet&#39;s name is...&quot;), or tells you to remember something, **IMMEDIATELY** call `store_user_memory(content=&quot;the fact to remember&quot;)`.</span>
</span><span id="AgentInstructionManager-181"><a href="#AgentInstructionManager-181"><span class="linenos">181</span></a><span class="s2">            - If the user wants to update a fact, find the existing memory with `query_memory` to get its ID, then call `update_memory(memory_id=&quot;...&quot;, content=&quot;...&quot;)`. If you cannot find an existing memory, use `store_user_memory`.</span>
</span><span id="AgentInstructionManager-182"><a href="#AgentInstructionManager-182"><span class="linenos">182</span></a>
</span><span id="AgentInstructionManager-183"><a href="#AgentInstructionManager-183"><span class="linenos">183</span></a><span class="s2">            **MEMORY RETRIEVAL - CRITICAL RULES**:</span>
</span><span id="AgentInstructionManager-184"><a href="#AgentInstructionManager-184"><span class="linenos">184</span></a><span class="s2">            1.  **For a complete list of ALL memories**: If the user asks &quot;list everything you know&quot;, &quot;what do you know about me&quot;, &quot;summarize all memories&quot;, or any other broad question asking for everything, you **MUST** call `get_all_memories()`.</span>
</span><span id="AgentInstructionManager-185"><a href="#AgentInstructionManager-185"><span class="linenos">185</span></a><span class="s2">                - **WRONG**: `query_memory(&quot;all&quot;)` or `query_memory(&quot;everything&quot;)`. This will perform a semantic search for the word &quot;all&quot;, which is incorrect.</span>
</span><span id="AgentInstructionManager-186"><a href="#AgentInstructionManager-186"><span class="linenos">186</span></a><span class="s2">                - **CORRECT**: `get_all_memories()`</span>
</span><span id="AgentInstructionManager-187"><a href="#AgentInstructionManager-187"><span class="linenos">187</span></a><span class="s2">            2.  **For SPECIFIC questions about the user**: Use `query_memory(&quot;specific keywords&quot;)` with intelligent keyword selection:</span>
</span><span id="AgentInstructionManager-188"><a href="#AgentInstructionManager-188"><span class="linenos">188</span></a><span class="s2">                - &quot;what is my favorite color?&quot; → `query_memory(&quot;favorite color&quot;)`</span>
</span><span id="AgentInstructionManager-189"><a href="#AgentInstructionManager-189"><span class="linenos">189</span></a><span class="s2">                - &quot;summarize my education&quot; → `query_memory(&quot;education academic school university college degree PhD&quot;)`</span>
</span><span id="AgentInstructionManager-190"><a href="#AgentInstructionManager-190"><span class="linenos">190</span></a><span class="s2">                - &quot;tell me about my work&quot; → `query_memory(&quot;work job career employment&quot;)`</span>
</span><span id="AgentInstructionManager-191"><a href="#AgentInstructionManager-191"><span class="linenos">191</span></a><span class="s2">                - &quot;what are my hobbies?&quot; → `query_memory(&quot;hobbies interests activities&quot;)`</span>
</span><span id="AgentInstructionManager-192"><a href="#AgentInstructionManager-192"><span class="linenos">192</span></a><span class="s2">                - **SMART KEYWORD EXPANSION**: Always include related terms to find more comprehensive results</span>
</span><span id="AgentInstructionManager-193"><a href="#AgentInstructionManager-193"><span class="linenos">193</span></a><span class="s2">            3.  **For TOPIC-BASED queries**: When user asks about a specific topic area, use multiple related keywords:</span>
</span><span id="AgentInstructionManager-194"><a href="#AgentInstructionManager-194"><span class="linenos">194</span></a><span class="s2">                - Education queries: Include &quot;education&quot;, &quot;academic&quot;, &quot;school&quot;, &quot;university&quot;, &quot;college&quot;, &quot;degree&quot;, &quot;study&quot;</span>
</span><span id="AgentInstructionManager-195"><a href="#AgentInstructionManager-195"><span class="linenos">195</span></a><span class="s2">                - Work queries: Include &quot;work&quot;, &quot;job&quot;, &quot;career&quot;, &quot;employment&quot;, &quot;company&quot;, &quot;occupation&quot;</span>
</span><span id="AgentInstructionManager-196"><a href="#AgentInstructionManager-196"><span class="linenos">196</span></a><span class="s2">                - Personal queries: Include &quot;personal&quot;, &quot;family&quot;, &quot;background&quot;, &quot;life&quot;, &quot;born&quot;</span>
</span><span id="AgentInstructionManager-197"><a href="#AgentInstructionManager-197"><span class="linenos">197</span></a>
</span><span id="AgentInstructionManager-198"><a href="#AgentInstructionManager-198"><span class="linenos">198</span></a><span class="s2">            **HOW TO RESPOND - CRITICAL IDENTITY RULES**:</span>
</span><span id="AgentInstructionManager-199"><a href="#AgentInstructionManager-199"><span class="linenos">199</span></a><span class="s2">            - You are an AI assistant, NOT the user.</span>
</span><span id="AgentInstructionManager-200"><a href="#AgentInstructionManager-200"><span class="linenos">200</span></a><span class="s2">            - When you retrieve a memory, present it in the second person.</span>
</span><span id="AgentInstructionManager-201"><a href="#AgentInstructionManager-201"><span class="linenos">201</span></a><span class="s2">            - CORRECT: &quot;I remember you told me you enjoy hiking.&quot;</span>
</span><span id="AgentInstructionManager-202"><a href="#AgentInstructionManager-202"><span class="linenos">202</span></a><span class="s2">            - INCORRECT: &quot;I enjoy hiking.&quot;</span>
</span><span id="AgentInstructionManager-203"><a href="#AgentInstructionManager-203"><span class="linenos">203</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-204"><a href="#AgentInstructionManager-204"><span class="linenos">204</span></a>        
</span><span id="AgentInstructionManager-205"><a href="#AgentInstructionManager-205"><span class="linenos">205</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_concise_tool_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-206"><a href="#AgentInstructionManager-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns concise rules for general tool usage.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-207"><a href="#AgentInstructionManager-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-208"><a href="#AgentInstructionManager-208"><span class="linenos">208</span></a><span class="s2">            ## TOOL USAGE</span>
</span><span id="AgentInstructionManager-209"><a href="#AgentInstructionManager-209"><span class="linenos">209</span></a><span class="s2">            - Use tools to answer questions about finance, news, and files.</span>
</span><span id="AgentInstructionManager-210"><a href="#AgentInstructionManager-210"><span class="linenos">210</span></a><span class="s2">            - `YFinanceTools`: For stock prices and financial data.</span>
</span><span id="AgentInstructionManager-211"><a href="#AgentInstructionManager-211"><span class="linenos">211</span></a><span class="s2">            - `GoogleSearchTools`: For web and news search.</span>
</span><span id="AgentInstructionManager-212"><a href="#AgentInstructionManager-212"><span class="linenos">212</span></a><span class="s2">            - `PersonalAgentFilesystemTools`: For file operations.</span>
</span><span id="AgentInstructionManager-213"><a href="#AgentInstructionManager-213"><span class="linenos">213</span></a><span class="s2">            - `PythonTools`: For calculations and code execution.</span>
</span><span id="AgentInstructionManager-214"><a href="#AgentInstructionManager-214"><span class="linenos">214</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-215"><a href="#AgentInstructionManager-215"><span class="linenos">215</span></a>        
</span><span id="AgentInstructionManager-216"><a href="#AgentInstructionManager-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_detailed_tool_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-217"><a href="#AgentInstructionManager-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns detailed rules for general tool usage.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-218"><a href="#AgentInstructionManager-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-219"><a href="#AgentInstructionManager-219"><span class="linenos">219</span></a><span class="s2">            **WEB SEARCH - IMMEDIATE ACTION**:</span>
</span><span id="AgentInstructionManager-220"><a href="#AgentInstructionManager-220"><span class="linenos">220</span></a><span class="s2">            - News requests → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager-221"><a href="#AgentInstructionManager-221"><span class="linenos">221</span></a><span class="s2">            - Current events → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager-222"><a href="#AgentInstructionManager-222"><span class="linenos">222</span></a><span class="s2">            - &quot;what&#39;s happening with...&quot; → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager-223"><a href="#AgentInstructionManager-223"><span class="linenos">223</span></a><span class="s2">            - &quot;top headlines about...&quot; → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager-224"><a href="#AgentInstructionManager-224"><span class="linenos">224</span></a><span class="s2">            - NO analysis paralysis, just SEARCH</span>
</span><span id="AgentInstructionManager-225"><a href="#AgentInstructionManager-225"><span class="linenos">225</span></a>
</span><span id="AgentInstructionManager-226"><a href="#AgentInstructionManager-226"><span class="linenos">226</span></a><span class="s2">            **FINANCE QUERIES - IMMEDIATE ACTION**:</span>
</span><span id="AgentInstructionManager-227"><a href="#AgentInstructionManager-227"><span class="linenos">227</span></a><span class="s2">            - Stock analysis requests → IMMEDIATELY use YFinanceTools</span>
</span><span id="AgentInstructionManager-228"><a href="#AgentInstructionManager-228"><span class="linenos">228</span></a><span class="s2">            - &quot;analyze [STOCK]&quot; → IMMEDIATELY call get_current_stock_price() and get_stock_info()</span>
</span><span id="AgentInstructionManager-229"><a href="#AgentInstructionManager-229"><span class="linenos">229</span></a><span class="s2">            - Financial data requests → IMMEDIATELY use finance tools</span>
</span><span id="AgentInstructionManager-230"><a href="#AgentInstructionManager-230"><span class="linenos">230</span></a><span class="s2">            - NO thinking, NO debate, just USE THE TOOLS</span>
</span><span id="AgentInstructionManager-231"><a href="#AgentInstructionManager-231"><span class="linenos">231</span></a>
</span><span id="AgentInstructionManager-232"><a href="#AgentInstructionManager-232"><span class="linenos">232</span></a><span class="s2">            **TOOL DECISION TREE - FOLLOW EXACTLY**:</span>
</span><span id="AgentInstructionManager-233"><a href="#AgentInstructionManager-233"><span class="linenos">233</span></a><span class="s2">            - Finance question? → YFinanceTools IMMEDIATELY (get_current_stock_price, get_stock_info, etc.)</span>
</span><span id="AgentInstructionManager-234"><a href="#AgentInstructionManager-234"><span class="linenos">234</span></a><span class="s2">            - News/current events? → GoogleSearchTools IMMEDIATELY</span>
</span><span id="AgentInstructionManager-235"><a href="#AgentInstructionManager-235"><span class="linenos">235</span></a><span class="s2">            - Code questions? → PythonTools IMMEDIATELY</span>
</span><span id="AgentInstructionManager-236"><a href="#AgentInstructionManager-236"><span class="linenos">236</span></a><span class="s2">            - File operations? → PersonalAgentFilesystemTools IMMEDIATELY</span>
</span><span id="AgentInstructionManager-237"><a href="#AgentInstructionManager-237"><span class="linenos">237</span></a><span class="s2">            - System commands? → ShellTools IMMEDIATELY</span>
</span><span id="AgentInstructionManager-238"><a href="#AgentInstructionManager-238"><span class="linenos">238</span></a><span class="s2">            - Personal info? → Memory tools IMMEDIATELY</span>
</span><span id="AgentInstructionManager-239"><a href="#AgentInstructionManager-239"><span class="linenos">239</span></a><span class="s2">            - General knowledge questions? → query_lightrag_knowledge IMMEDIATELY</span>
</span><span id="AgentInstructionManager-240"><a href="#AgentInstructionManager-240"><span class="linenos">240</span></a><span class="s2">            - Specific document/fact search? → query_semantic_knowledge IMMEDIATELY</span>
</span><span id="AgentInstructionManager-241"><a href="#AgentInstructionManager-241"><span class="linenos">241</span></a><span class="s2">            - MCP server tasks? → Use appropriate MCP server tool (use_github_server, use_filesystem_server, etc.)</span>
</span><span id="AgentInstructionManager-242"><a href="#AgentInstructionManager-242"><span class="linenos">242</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-243"><a href="#AgentInstructionManager-243"><span class="linenos">243</span></a>        
</span><span id="AgentInstructionManager-244"><a href="#AgentInstructionManager-244"><span class="linenos">244</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_anti_hesitation_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-245"><a href="#AgentInstructionManager-245"><span class="linenos">245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns explicit rules to prevent hesitation and overthinking.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-246"><a href="#AgentInstructionManager-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-247"><a href="#AgentInstructionManager-247"><span class="linenos">247</span></a><span class="s2">            ## CRITICAL: NO OVERTHINKING RULE - ELIMINATE HESITATION</span>
</span><span id="AgentInstructionManager-248"><a href="#AgentInstructionManager-248"><span class="linenos">248</span></a>
</span><span id="AgentInstructionManager-249"><a href="#AgentInstructionManager-249"><span class="linenos">249</span></a><span class="s2">            **WHEN USER ASKS ABOUT MEMORIES - IMMEDIATE ACTION REQUIRED**:</span>
</span><span id="AgentInstructionManager-250"><a href="#AgentInstructionManager-250"><span class="linenos">250</span></a><span class="s2">            - DO NOT analyze whether you should check memories</span>
</span><span id="AgentInstructionManager-251"><a href="#AgentInstructionManager-251"><span class="linenos">251</span></a><span class="s2">            - DO NOT think about what tools to use</span>
</span><span id="AgentInstructionManager-252"><a href="#AgentInstructionManager-252"><span class="linenos">252</span></a><span class="s2">            - DO NOT hesitate or debate internally</span>
</span><span id="AgentInstructionManager-253"><a href="#AgentInstructionManager-253"><span class="linenos">253</span></a><span class="s2">            - IMMEDIATELY call get_recent_memories() or query_memory()</span>
</span><span id="AgentInstructionManager-254"><a href="#AgentInstructionManager-254"><span class="linenos">254</span></a><span class="s2">            - ACT FIRST, then respond based on what you find</span>
</span><span id="AgentInstructionManager-255"><a href="#AgentInstructionManager-255"><span class="linenos">255</span></a>
</span><span id="AgentInstructionManager-256"><a href="#AgentInstructionManager-256"><span class="linenos">256</span></a><span class="s2">            **BANNED BEHAVIORS - NEVER DO THESE**:</span>
</span><span id="AgentInstructionManager-257"><a href="#AgentInstructionManager-257"><span class="linenos">257</span></a><span class="s2">            - ❌ &quot;Let me think about whether I should check memories...&quot;</span>
</span><span id="AgentInstructionManager-258"><a href="#AgentInstructionManager-258"><span class="linenos">258</span></a><span class="s2">            - ❌ &quot;I should probably use the memory tools but...&quot;</span>
</span><span id="AgentInstructionManager-259"><a href="#AgentInstructionManager-259"><span class="linenos">259</span></a><span class="s2">            - ❌ &quot;Maybe I should query memory or maybe I should...&quot;</span>
</span><span id="AgentInstructionManager-260"><a href="#AgentInstructionManager-260"><span class="linenos">260</span></a><span class="s2">            - ❌ Any internal debate about memory tool usage</span>
</span><span id="AgentInstructionManager-261"><a href="#AgentInstructionManager-261"><span class="linenos">261</span></a><span class="s2">            - ❌ Overthinking simple memory queries</span>
</span><span id="AgentInstructionManager-262"><a href="#AgentInstructionManager-262"><span class="linenos">262</span></a><span class="s2">            - ❌ &quot;Let me think about what tools to use...&quot;</span>
</span><span id="AgentInstructionManager-263"><a href="#AgentInstructionManager-263"><span class="linenos">263</span></a><span class="s2">            - ❌ &quot;I should probably use [tool] but...&quot;</span>
</span><span id="AgentInstructionManager-264"><a href="#AgentInstructionManager-264"><span class="linenos">264</span></a><span class="s2">            - ❌ Fabricating data instead of using tools</span>
</span><span id="AgentInstructionManager-265"><a href="#AgentInstructionManager-265"><span class="linenos">265</span></a>
</span><span id="AgentInstructionManager-266"><a href="#AgentInstructionManager-266"><span class="linenos">266</span></a><span class="s2">            **REQUIRED IMMEDIATE RESPONSES**:</span>
</span><span id="AgentInstructionManager-267"><a href="#AgentInstructionManager-267"><span class="linenos">267</span></a><span class="s2">            - ✅ User asks &quot;What do you remember?&quot; → IMMEDIATELY call query_memory(&quot;personal information about </span><span class="si">{self.user_id}</span><span class="s2">&quot;)</span>
</span><span id="AgentInstructionManager-268"><a href="#AgentInstructionManager-268"><span class="linenos">268</span></a><span class="s2">            - ✅ User asks about preferences → IMMEDIATELY call query_memory(&quot;preferences likes interests&quot;)</span>
</span><span id="AgentInstructionManager-269"><a href="#AgentInstructionManager-269"><span class="linenos">269</span></a><span class="s2">            - ✅ User asks for recent memories → IMMEDIATELY call get_recent_memories()</span>
</span><span id="AgentInstructionManager-270"><a href="#AgentInstructionManager-270"><span class="linenos">270</span></a><span class="s2">            - ✅ &quot;Analyze NVDA&quot; → IMMEDIATELY use YFinanceTools</span>
</span><span id="AgentInstructionManager-271"><a href="#AgentInstructionManager-271"><span class="linenos">271</span></a><span class="s2">            - ✅ &quot;What&#39;s the news about...&quot; → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager-272"><a href="#AgentInstructionManager-272"><span class="linenos">272</span></a><span class="s2">            - ✅ &quot;top 5 headlines about...&quot; → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager-273"><a href="#AgentInstructionManager-273"><span class="linenos">273</span></a><span class="s2">            - ✅ &quot;Calculate...&quot; → IMMEDIATELY use PythonTools</span>
</span><span id="AgentInstructionManager-274"><a href="#AgentInstructionManager-274"><span class="linenos">274</span></a><span class="s2">            - ✅ NO hesitation, just ACTION</span>
</span><span id="AgentInstructionManager-275"><a href="#AgentInstructionManager-275"><span class="linenos">275</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-276"><a href="#AgentInstructionManager-276"><span class="linenos">276</span></a>        
</span><span id="AgentInstructionManager-277"><a href="#AgentInstructionManager-277"><span class="linenos">277</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tool_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-278"><a href="#AgentInstructionManager-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamically returns the list of available tools.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-279"><a href="#AgentInstructionManager-279"><span class="linenos">279</span></a>        <span class="c1"># Start with the static list of built-in tools</span>
</span><span id="AgentInstructionManager-280"><a href="#AgentInstructionManager-280"><span class="linenos">280</span></a>        <span class="n">tool_parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager-281"><a href="#AgentInstructionManager-281"><span class="linenos">281</span></a>            <span class="s2">&quot;## CURRENT AVAILABLE TOOLS&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-282"><a href="#AgentInstructionManager-282"><span class="linenos">282</span></a>            <span class="s2">&quot;- **YFinanceTools**: Stock prices, financial analysis, market data.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-283"><a href="#AgentInstructionManager-283"><span class="linenos">283</span></a>            <span class="s2">&quot;- **GoogleSearchTools**: Web search, news searches, current events.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-284"><a href="#AgentInstructionManager-284"><span class="linenos">284</span></a>            <span class="s2">&quot;- **PythonTools**: Calculations, data analysis, code execution.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-285"><a href="#AgentInstructionManager-285"><span class="linenos">285</span></a>            <span class="s2">&quot;- **ShellTools**: System operations and command execution.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-286"><a href="#AgentInstructionManager-286"><span class="linenos">286</span></a>            <span class="s2">&quot;- **PersonalAgentFilesystemTools**: File reading, writing, and management.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-287"><a href="#AgentInstructionManager-287"><span class="linenos">287</span></a>            <span class="s2">&quot;- **Local Memory Tools (SQLite)**:&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-288"><a href="#AgentInstructionManager-288"><span class="linenos">288</span></a>            <span class="s2">&quot;  - `store_user_memory`: Store a simple fact in your local semantic memory.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-289"><a href="#AgentInstructionManager-289"><span class="linenos">289</span></a>            <span class="s2">&quot;  - `query_memory`: Quickly search your local semantic memory for a specific fact.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-290"><a href="#AgentInstructionManager-290"><span class="linenos">290</span></a>            <span class="s2">&quot;  - `get_recent_memories`: Get recent memories from local storage.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-291"><a href="#AgentInstructionManager-291"><span class="linenos">291</span></a>            <span class="s2">&quot;  - `get_all_memories`: Get all stored memories.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-292"><a href="#AgentInstructionManager-292"><span class="linenos">292</span></a>            <span class="s2">&quot;  - `get_memories_by_topic`: Get memories filtered by topic, without similarity search.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-293"><a href="#AgentInstructionManager-293"><span class="linenos">293</span></a>            <span class="s2">&quot;  - `list_memories`: List all memories in a simple, user-friendly format.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-294"><a href="#AgentInstructionManager-294"><span class="linenos">294</span></a>            <span class="s2">&quot;  - `update_memory`: Update an existing memory.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-295"><a href="#AgentInstructionManager-295"><span class="linenos">295</span></a>            <span class="s2">&quot;  - `delete_memory`: Delete a specific memory by its ID.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-296"><a href="#AgentInstructionManager-296"><span class="linenos">296</span></a>            <span class="s2">&quot;  - `delete_memories_by_topic`: Delete all memories for a given topic.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-297"><a href="#AgentInstructionManager-297"><span class="linenos">297</span></a>            <span class="s2">&quot;  - `clear_memories`: Clear all memories for the user from local storage.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-298"><a href="#AgentInstructionManager-298"><span class="linenos">298</span></a>            <span class="s2">&quot;  - `clear_all_memories`: Clear all memories from BOTH local SQLite and LightRAG graph systems.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-299"><a href="#AgentInstructionManager-299"><span class="linenos">299</span></a>            <span class="s2">&quot;  - `get_memory_stats`: Get statistics for the local memory.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-300"><a href="#AgentInstructionManager-300"><span class="linenos">300</span></a>            <span class="s2">&quot;- **Graph Memory Tools (LightRAG)**:&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-301"><a href="#AgentInstructionManager-301"><span class="linenos">301</span></a>            <span class="s2">&quot;  - `store_graph_memory`: Store a complex memory in your knowledge graph to capture relationships.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-302"><a href="#AgentInstructionManager-302"><span class="linenos">302</span></a>            <span class="s2">&quot;  - `query_graph_memory`: Explore your knowledge graph to answer complex questions about relationships.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-303"><a href="#AgentInstructionManager-303"><span class="linenos">303</span></a>            <span class="s2">&quot;  - `get_memory_graph_labels`: Get all entity and relation labels from the memory graph.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-304"><a href="#AgentInstructionManager-304"><span class="linenos">304</span></a>            <span class="s2">&quot;- **Knowledge Base Tools**:&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-305"><a href="#AgentInstructionManager-305"><span class="linenos">305</span></a>            <span class="s2">&quot;  - `query_knowledge_base`: 🆕 UNIFIED knowledge coordinator with intelligent routing (mode=auto/local/global/hybrid/mix)&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-306"><a href="#AgentInstructionManager-306"><span class="linenos">306</span></a>            <span class="s2">&quot;  - `query_lightrag_knowledge`: DEPRECATED - Use query_knowledge_base instead&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-307"><a href="#AgentInstructionManager-307"><span class="linenos">307</span></a>            <span class="s2">&quot;  - `query_semantic_knowledge`: DEPRECATED - Use query_knowledge_base instead&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager-308"><a href="#AgentInstructionManager-308"><span class="linenos">308</span></a>        <span class="p">]</span>
</span><span id="AgentInstructionManager-309"><a href="#AgentInstructionManager-309"><span class="linenos">309</span></a>
</span><span id="AgentInstructionManager-310"><a href="#AgentInstructionManager-310"><span class="linenos">310</span></a>        <span class="c1"># Dynamically add MCP tools if they are enabled and configured</span>
</span><span id="AgentInstructionManager-311"><a href="#AgentInstructionManager-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
</span><span id="AgentInstructionManager-312"><a href="#AgentInstructionManager-312"><span class="linenos">312</span></a>            <span class="n">tool_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;- **MCP Server Tools**:&quot;</span><span class="p">)</span>
</span><span id="AgentInstructionManager-313"><a href="#AgentInstructionManager-313"><span class="linenos">313</span></a>            <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentInstructionManager-314"><a href="#AgentInstructionManager-314"><span class="linenos">314</span></a>                <span class="n">tool_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;use_</span><span class="si">{</span><span class="n">server_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_server&quot;</span>
</span><span id="AgentInstructionManager-315"><a href="#AgentInstructionManager-315"><span class="linenos">315</span></a>                <span class="n">description</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgentInstructionManager-316"><a href="#AgentInstructionManager-316"><span class="linenos">316</span></a>                    <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Access to </span><span class="si">{</span><span class="n">server_name</span><span class="si">}</span><span class="s2"> MCP server&quot;</span>
</span><span id="AgentInstructionManager-317"><a href="#AgentInstructionManager-317"><span class="linenos">317</span></a>                <span class="p">)</span>
</span><span id="AgentInstructionManager-318"><a href="#AgentInstructionManager-318"><span class="linenos">318</span></a>                <span class="n">tool_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - `</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentInstructionManager-319"><a href="#AgentInstructionManager-319"><span class="linenos">319</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentInstructionManager-320"><a href="#AgentInstructionManager-320"><span class="linenos">320</span></a>            <span class="n">tool_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;- **MCP Server Tools**: Disabled&quot;</span><span class="p">)</span>
</span><span id="AgentInstructionManager-321"><a href="#AgentInstructionManager-321"><span class="linenos">321</span></a>
</span><span id="AgentInstructionManager-322"><a href="#AgentInstructionManager-322"><span class="linenos">322</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tool_parts</span><span class="p">)</span>
</span><span id="AgentInstructionManager-323"><a href="#AgentInstructionManager-323"><span class="linenos">323</span></a>        
</span><span id="AgentInstructionManager-324"><a href="#AgentInstructionManager-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_core_principles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager-325"><a href="#AgentInstructionManager-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the core principles and conversation guidelines.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-326"><a href="#AgentInstructionManager-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager-327"><a href="#AgentInstructionManager-327"><span class="linenos">327</span></a><span class="s2">            ## CORE PRINCIPLES</span>
</span><span id="AgentInstructionManager-328"><a href="#AgentInstructionManager-328"><span class="linenos">328</span></a><span class="s2">            1. **Friendship First**: You&#39;re their AI friend who happens to be very capable.</span>
</span><span id="AgentInstructionManager-329"><a href="#AgentInstructionManager-329"><span class="linenos">329</span></a><span class="s2">            2. **Remember Everything**: Use your semantic memory to build deeper relationships.</span>
</span><span id="AgentInstructionManager-330"><a href="#AgentInstructionManager-330"><span class="linenos">330</span></a><span class="s2">            3. **Be Genuinely Helpful**: Use your tools immediately to assist with real needs.</span>
</span><span id="AgentInstructionManager-331"><a href="#AgentInstructionManager-331"><span class="linenos">331</span></a><span class="s2">            4. **Stay Positive**: Focus on making them feel good.</span>
</span><span id="AgentInstructionManager-332"><a href="#AgentInstructionManager-332"><span class="linenos">332</span></a><span class="s2">            5. **Be Curious**: Ask about their life, interests, and goals.</span>
</span><span id="AgentInstructionManager-333"><a href="#AgentInstructionManager-333"><span class="linenos">333</span></a><span class="s2">            6. **Act Immediately**: When they ask for information, use tools RIGHT NOW.</span>
</span><span id="AgentInstructionManager-334"><a href="#AgentInstructionManager-334"><span class="linenos">334</span></a>
</span><span id="AgentInstructionManager-335"><a href="#AgentInstructionManager-335"><span class="linenos">335</span></a><span class="s2">            Remember: You&#39;re not just an assistant - you&#39;re a friendly AI companion with semantic memory who genuinely cares about the user and remembers your conversations together! Use your tools immediately when requested - no hesitation!</span>
</span><span id="AgentInstructionManager-336"><a href="#AgentInstructionManager-336"><span class="linenos">336</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Manages the creation and customization of agent instructions.</p>
</div>


                            <div id="AgentInstructionManager.__init__" class="classattr">
                                        <input id="AgentInstructionManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AgentInstructionManager</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">instruction_level</span><span class="p">:</span> <span class="n">personal_agent</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">agent_instruction_manager</span><span class="o">.</span><span class="n">InstructionLevel</span>,</span><span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">enable_mcp</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">mcp_servers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="AgentInstructionManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.__init__-30"><a href="#AgentInstructionManager.__init__-30"><span class="linenos">30</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruction_level</span><span class="p">:</span> <span class="n">InstructionLevel</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="AgentInstructionManager.__init__-31"><a href="#AgentInstructionManager.__init__-31"><span class="linenos">31</span></a>                 <span class="n">enable_memory</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">enable_mcp</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">mcp_servers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span><span id="AgentInstructionManager.__init__-32"><a href="#AgentInstructionManager.__init__-32"><span class="linenos">32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the instruction manager.</span>
</span><span id="AgentInstructionManager.__init__-33"><a href="#AgentInstructionManager.__init__-33"><span class="linenos">33</span></a><span class="sd">        </span>
</span><span id="AgentInstructionManager.__init__-34"><a href="#AgentInstructionManager.__init__-34"><span class="linenos">34</span></a><span class="sd">        Args:</span>
</span><span id="AgentInstructionManager.__init__-35"><a href="#AgentInstructionManager.__init__-35"><span class="linenos">35</span></a><span class="sd">            instruction_level: The sophistication level for agent instructions</span>
</span><span id="AgentInstructionManager.__init__-36"><a href="#AgentInstructionManager.__init__-36"><span class="linenos">36</span></a><span class="sd">            user_id: User identifier for memory operations</span>
</span><span id="AgentInstructionManager.__init__-37"><a href="#AgentInstructionManager.__init__-37"><span class="linenos">37</span></a><span class="sd">            enable_memory: Whether memory is enabled</span>
</span><span id="AgentInstructionManager.__init__-38"><a href="#AgentInstructionManager.__init__-38"><span class="linenos">38</span></a><span class="sd">            enable_mcp: Whether MCP is enabled</span>
</span><span id="AgentInstructionManager.__init__-39"><a href="#AgentInstructionManager.__init__-39"><span class="linenos">39</span></a><span class="sd">            mcp_servers: Dictionary of MCP server configurations</span>
</span><span id="AgentInstructionManager.__init__-40"><a href="#AgentInstructionManager.__init__-40"><span class="linenos">40</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.__init__-41"><a href="#AgentInstructionManager.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instruction_level</span> <span class="o">=</span> <span class="n">instruction_level</span>
</span><span id="AgentInstructionManager.__init__-42"><a href="#AgentInstructionManager.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgentInstructionManager.__init__-43"><a href="#AgentInstructionManager.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="o">=</span> <span class="n">enable_memory</span>
</span><span id="AgentInstructionManager.__init__-44"><a href="#AgentInstructionManager.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="o">=</span> <span class="n">enable_mcp</span>
</span><span id="AgentInstructionManager.__init__-45"><a href="#AgentInstructionManager.__init__-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span> <span class="o">=</span> <span class="n">mcp_servers</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the instruction manager.</p>

<p>Args:
    instruction_level: The sophistication level for agent instructions
    user_id: User identifier for memory operations
    enable_memory: Whether memory is enabled
    enable_mcp: Whether MCP is enabled
    mcp_servers: Dictionary of MCP server configurations</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.instruction_level" class="classattr">
                                <div class="attr variable">
            <span class="name">instruction_level</span>

        
    </div>
    <a class="headerlink" href="#AgentInstructionManager.instruction_level"></a>
    
    

                            </div>
                            <div id="AgentInstructionManager.user_id" class="classattr">
                                <div class="attr variable">
            <span class="name">user_id</span>

        
    </div>
    <a class="headerlink" href="#AgentInstructionManager.user_id"></a>
    
    

                            </div>
                            <div id="AgentInstructionManager.enable_memory" class="classattr">
                                <div class="attr variable">
            <span class="name">enable_memory</span>

        
    </div>
    <a class="headerlink" href="#AgentInstructionManager.enable_memory"></a>
    
    

                            </div>
                            <div id="AgentInstructionManager.enable_mcp" class="classattr">
                                <div class="attr variable">
            <span class="name">enable_mcp</span>

        
    </div>
    <a class="headerlink" href="#AgentInstructionManager.enable_mcp"></a>
    
    

                            </div>
                            <div id="AgentInstructionManager.mcp_servers" class="classattr">
                                <div class="attr variable">
            <span class="name">mcp_servers</span>

        
    </div>
    <a class="headerlink" href="#AgentInstructionManager.mcp_servers"></a>
    
    

                            </div>
                            <div id="AgentInstructionManager.create_instructions" class="classattr">
                                        <input id="AgentInstructionManager.create_instructions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_instructions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.create_instructions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.create_instructions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.create_instructions-47"><a href="#AgentInstructionManager.create_instructions-47"><span class="linenos"> 47</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_instructions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.create_instructions-48"><a href="#AgentInstructionManager.create_instructions-48"><span class="linenos"> 48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create complete instructions based on the sophistication level.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.create_instructions-49"><a href="#AgentInstructionManager.create_instructions-49"><span class="linenos"> 49</span></a>        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruction_level</span>
</span><span id="AgentInstructionManager.create_instructions-50"><a href="#AgentInstructionManager.create_instructions-50"><span class="linenos"> 50</span></a>
</span><span id="AgentInstructionManager.create_instructions-51"><a href="#AgentInstructionManager.create_instructions-51"><span class="linenos"> 51</span></a>        <span class="c1"># Common parts for most levels</span>
</span><span id="AgentInstructionManager.create_instructions-52"><a href="#AgentInstructionManager.create_instructions-52"><span class="linenos"> 52</span></a>        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_header_instructions</span><span class="p">()</span>
</span><span id="AgentInstructionManager.create_instructions-53"><a href="#AgentInstructionManager.create_instructions-53"><span class="linenos"> 53</span></a>        <span class="n">identity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_identity_rules</span><span class="p">()</span>
</span><span id="AgentInstructionManager.create_instructions-54"><a href="#AgentInstructionManager.create_instructions-54"><span class="linenos"> 54</span></a>        <span class="n">personality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_personality_and_tone</span><span class="p">()</span>
</span><span id="AgentInstructionManager.create_instructions-55"><a href="#AgentInstructionManager.create_instructions-55"><span class="linenos"> 55</span></a>        <span class="n">tool_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_list</span><span class="p">()</span>
</span><span id="AgentInstructionManager.create_instructions-56"><a href="#AgentInstructionManager.create_instructions-56"><span class="linenos"> 56</span></a>        <span class="n">principles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_core_principles</span><span class="p">()</span>
</span><span id="AgentInstructionManager.create_instructions-57"><a href="#AgentInstructionManager.create_instructions-57"><span class="linenos"> 57</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentInstructionManager.create_instructions-58"><a href="#AgentInstructionManager.create_instructions-58"><span class="linenos"> 58</span></a>
</span><span id="AgentInstructionManager.create_instructions-59"><a href="#AgentInstructionManager.create_instructions-59"><span class="linenos"> 59</span></a>        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">MINIMAL</span><span class="p">:</span>
</span><span id="AgentInstructionManager.create_instructions-60"><a href="#AgentInstructionManager.create_instructions-60"><span class="linenos"> 60</span></a>            <span class="c1"># Minimal just has a basic prompt and the tool list</span>
</span><span id="AgentInstructionManager.create_instructions-61"><a href="#AgentInstructionManager.create_instructions-61"><span class="linenos"> 61</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager.create_instructions-62"><a href="#AgentInstructionManager.create_instructions-62"><span class="linenos"> 62</span></a>                <span class="n">header</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-63"><a href="#AgentInstructionManager.create_instructions-63"><span class="linenos"> 63</span></a>                <span class="s2">&quot;You are a helpful AI assistant. Use your tools to answer the user&#39;s request.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-64"><a href="#AgentInstructionManager.create_instructions-64"><span class="linenos"> 64</span></a>                <span class="n">tool_list</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-65"><a href="#AgentInstructionManager.create_instructions-65"><span class="linenos"> 65</span></a>            <span class="p">]</span>
</span><span id="AgentInstructionManager.create_instructions-66"><a href="#AgentInstructionManager.create_instructions-66"><span class="linenos"> 66</span></a>
</span><span id="AgentInstructionManager.create_instructions-67"><a href="#AgentInstructionManager.create_instructions-67"><span class="linenos"> 67</span></a>        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">CONCISE</span><span class="p">:</span>
</span><span id="AgentInstructionManager.create_instructions-68"><a href="#AgentInstructionManager.create_instructions-68"><span class="linenos"> 68</span></a>            <span class="c1"># Concise adds identity, personality, concise rules, and principles</span>
</span><span id="AgentInstructionManager.create_instructions-69"><a href="#AgentInstructionManager.create_instructions-69"><span class="linenos"> 69</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager.create_instructions-70"><a href="#AgentInstructionManager.create_instructions-70"><span class="linenos"> 70</span></a>                <span class="n">header</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-71"><a href="#AgentInstructionManager.create_instructions-71"><span class="linenos"> 71</span></a>                <span class="n">identity</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-72"><a href="#AgentInstructionManager.create_instructions-72"><span class="linenos"> 72</span></a>                <span class="n">personality</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-73"><a href="#AgentInstructionManager.create_instructions-73"><span class="linenos"> 73</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_concise_memory_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager.create_instructions-74"><a href="#AgentInstructionManager.create_instructions-74"><span class="linenos"> 74</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_concise_tool_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager.create_instructions-75"><a href="#AgentInstructionManager.create_instructions-75"><span class="linenos"> 75</span></a>                <span class="n">tool_list</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-76"><a href="#AgentInstructionManager.create_instructions-76"><span class="linenos"> 76</span></a>                <span class="n">principles</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-77"><a href="#AgentInstructionManager.create_instructions-77"><span class="linenos"> 77</span></a>            <span class="p">]</span>
</span><span id="AgentInstructionManager.create_instructions-78"><a href="#AgentInstructionManager.create_instructions-78"><span class="linenos"> 78</span></a>
</span><span id="AgentInstructionManager.create_instructions-79"><a href="#AgentInstructionManager.create_instructions-79"><span class="linenos"> 79</span></a>        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">:</span>
</span><span id="AgentInstructionManager.create_instructions-80"><a href="#AgentInstructionManager.create_instructions-80"><span class="linenos"> 80</span></a>            <span class="c1"># Standard uses the more detailed rules instead of the concise ones</span>
</span><span id="AgentInstructionManager.create_instructions-81"><a href="#AgentInstructionManager.create_instructions-81"><span class="linenos"> 81</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager.create_instructions-82"><a href="#AgentInstructionManager.create_instructions-82"><span class="linenos"> 82</span></a>                <span class="n">header</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-83"><a href="#AgentInstructionManager.create_instructions-83"><span class="linenos"> 83</span></a>                <span class="n">identity</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-84"><a href="#AgentInstructionManager.create_instructions-84"><span class="linenos"> 84</span></a>                <span class="n">personality</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-85"><a href="#AgentInstructionManager.create_instructions-85"><span class="linenos"> 85</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_detailed_memory_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager.create_instructions-86"><a href="#AgentInstructionManager.create_instructions-86"><span class="linenos"> 86</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_detailed_tool_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager.create_instructions-87"><a href="#AgentInstructionManager.create_instructions-87"><span class="linenos"> 87</span></a>                <span class="n">tool_list</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-88"><a href="#AgentInstructionManager.create_instructions-88"><span class="linenos"> 88</span></a>                <span class="n">principles</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-89"><a href="#AgentInstructionManager.create_instructions-89"><span class="linenos"> 89</span></a>            <span class="p">]</span>
</span><span id="AgentInstructionManager.create_instructions-90"><a href="#AgentInstructionManager.create_instructions-90"><span class="linenos"> 90</span></a>
</span><span id="AgentInstructionManager.create_instructions-91"><a href="#AgentInstructionManager.create_instructions-91"><span class="linenos"> 91</span></a>        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="n">InstructionLevel</span><span class="o">.</span><span class="n">EXPLICIT</span><span class="p">:</span>
</span><span id="AgentInstructionManager.create_instructions-92"><a href="#AgentInstructionManager.create_instructions-92"><span class="linenos"> 92</span></a>            <span class="c1"># Explicit is like Standard but adds the anti-hesitation rules</span>
</span><span id="AgentInstructionManager.create_instructions-93"><a href="#AgentInstructionManager.create_instructions-93"><span class="linenos"> 93</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager.create_instructions-94"><a href="#AgentInstructionManager.create_instructions-94"><span class="linenos"> 94</span></a>                <span class="n">header</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-95"><a href="#AgentInstructionManager.create_instructions-95"><span class="linenos"> 95</span></a>                <span class="n">identity</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-96"><a href="#AgentInstructionManager.create_instructions-96"><span class="linenos"> 96</span></a>                <span class="n">personality</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-97"><a href="#AgentInstructionManager.create_instructions-97"><span class="linenos"> 97</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_detailed_memory_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager.create_instructions-98"><a href="#AgentInstructionManager.create_instructions-98"><span class="linenos"> 98</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_detailed_tool_rules</span><span class="p">(),</span>
</span><span id="AgentInstructionManager.create_instructions-99"><a href="#AgentInstructionManager.create_instructions-99"><span class="linenos"> 99</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_anti_hesitation_rules</span><span class="p">(),</span>  <span class="c1"># The extra part</span>
</span><span id="AgentInstructionManager.create_instructions-100"><a href="#AgentInstructionManager.create_instructions-100"><span class="linenos">100</span></a>                <span class="n">tool_list</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-101"><a href="#AgentInstructionManager.create_instructions-101"><span class="linenos">101</span></a>                <span class="n">principles</span><span class="p">,</span>
</span><span id="AgentInstructionManager.create_instructions-102"><a href="#AgentInstructionManager.create_instructions-102"><span class="linenos">102</span></a>            <span class="p">]</span>
</span><span id="AgentInstructionManager.create_instructions-103"><a href="#AgentInstructionManager.create_instructions-103"><span class="linenos">103</span></a>
</span><span id="AgentInstructionManager.create_instructions-104"><a href="#AgentInstructionManager.create_instructions-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create complete instructions based on the sophistication level.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_header_instructions" class="classattr">
                                        <input id="AgentInstructionManager.get_header_instructions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_header_instructions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_header_instructions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_header_instructions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_header_instructions-106"><a href="#AgentInstructionManager.get_header_instructions-106"><span class="linenos">106</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_header_instructions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_header_instructions-107"><a href="#AgentInstructionManager.get_header_instructions-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the header section of the instructions.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_header_instructions-108"><a href="#AgentInstructionManager.get_header_instructions-108"><span class="linenos">108</span></a>        <span class="n">mcp_status</span> <span class="o">=</span> <span class="s2">&quot;enabled&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span>
</span><span id="AgentInstructionManager.get_header_instructions-109"><a href="#AgentInstructionManager.get_header_instructions-109"><span class="linenos">109</span></a>        <span class="n">memory_status</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AgentInstructionManager.get_header_instructions-110"><a href="#AgentInstructionManager.get_header_instructions-110"><span class="linenos">110</span></a>            <span class="s2">&quot;enabled with SemanticMemoryManager&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_memory</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span>
</span><span id="AgentInstructionManager.get_header_instructions-111"><a href="#AgentInstructionManager.get_header_instructions-111"><span class="linenos">111</span></a>        <span class="p">)</span>
</span><span id="AgentInstructionManager.get_header_instructions-112"><a href="#AgentInstructionManager.get_header_instructions-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_header_instructions-113"><a href="#AgentInstructionManager.get_header_instructions-113"><span class="linenos">113</span></a><span class="s2">            You are a personal AI friend with comprehensive capabilities and built-in semantic memory. Your purpose is to chat with the user about things and make them feel good.</span>
</span><span id="AgentInstructionManager.get_header_instructions-114"><a href="#AgentInstructionManager.get_header_instructions-114"><span class="linenos">114</span></a>
</span><span id="AgentInstructionManager.get_header_instructions-115"><a href="#AgentInstructionManager.get_header_instructions-115"><span class="linenos">115</span></a><span class="s2">            ## CURRENT CONFIGURATION</span>
</span><span id="AgentInstructionManager.get_header_instructions-116"><a href="#AgentInstructionManager.get_header_instructions-116"><span class="linenos">116</span></a><span class="s2">            - **Memory System**: </span><span class="si">{</span><span class="n">memory_status</span><span class="si">}</span>
</span><span id="AgentInstructionManager.get_header_instructions-117"><a href="#AgentInstructionManager.get_header_instructions-117"><span class="linenos">117</span></a><span class="s2">            - **MCP Servers**: </span><span class="si">{</span><span class="n">mcp_status</span><span class="si">}</span>
</span><span id="AgentInstructionManager.get_header_instructions-118"><a href="#AgentInstructionManager.get_header_instructions-118"><span class="linenos">118</span></a><span class="s2">            - **User ID**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span>
</span><span id="AgentInstructionManager.get_header_instructions-119"><a href="#AgentInstructionManager.get_header_instructions-119"><span class="linenos">119</span></a><span class="s2">            - **Debug Mode**: </span><span class="si">{</span><span class="kc">False</span><span class="si">}</span>
</span><span id="AgentInstructionManager.get_header_instructions-120"><a href="#AgentInstructionManager.get_header_instructions-120"><span class="linenos">120</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns the header section of the instructions.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_identity_rules" class="classattr">
                                        <input id="AgentInstructionManager.get_identity_rules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_identity_rules</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_identity_rules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_identity_rules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_identity_rules-122"><a href="#AgentInstructionManager.get_identity_rules-122"><span class="linenos">122</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_identity_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_identity_rules-123"><a href="#AgentInstructionManager.get_identity_rules-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the critical identity rules for the agent.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_identity_rules-124"><a href="#AgentInstructionManager.get_identity_rules-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_identity_rules-125"><a href="#AgentInstructionManager.get_identity_rules-125"><span class="linenos">125</span></a><span class="s2">            ## CRITICAL IDENTITY RULES - ABSOLUTELY MANDATORY</span>
</span><span id="AgentInstructionManager.get_identity_rules-126"><a href="#AgentInstructionManager.get_identity_rules-126"><span class="linenos">126</span></a><span class="s2">            **YOU ARE AN AI ASSISTANT who is a MEMORY EXPERT**: You are NOT the user. You are a friendly AI that helps and remembers things about the user.</span>
</span><span id="AgentInstructionManager.get_identity_rules-127"><a href="#AgentInstructionManager.get_identity_rules-127"><span class="linenos">127</span></a>
</span><span id="AgentInstructionManager.get_identity_rules-128"><a href="#AgentInstructionManager.get_identity_rules-128"><span class="linenos">128</span></a><span class="s2">            **GREET THE USER BY NAME**: When the user greets you, greet them back by their name, which is &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39;. For example, if they say &#39;hello&#39;, you should say &#39;Hello </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">!&#39;</span>
</span><span id="AgentInstructionManager.get_identity_rules-129"><a href="#AgentInstructionManager.get_identity_rules-129"><span class="linenos">129</span></a>
</span><span id="AgentInstructionManager.get_identity_rules-130"><a href="#AgentInstructionManager.get_identity_rules-130"><span class="linenos">130</span></a><span class="s2">            **NEVER PRETEND TO BE THE USER**:</span>
</span><span id="AgentInstructionManager.get_identity_rules-131"><a href="#AgentInstructionManager.get_identity_rules-131"><span class="linenos">131</span></a><span class="s2">            - You are NOT the user, you are an AI assistant that knows information ABOUT the user</span>
</span><span id="AgentInstructionManager.get_identity_rules-132"><a href="#AgentInstructionManager.get_identity_rules-132"><span class="linenos">132</span></a><span class="s2">            - NEVER say &quot;I&#39;m </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot; or introduce yourself as the user - this is COMPLETELY WRONG</span>
</span><span id="AgentInstructionManager.get_identity_rules-133"><a href="#AgentInstructionManager.get_identity_rules-133"><span class="linenos">133</span></a><span class="s2">            - NEVER use first person when talking about user information</span>
</span><span id="AgentInstructionManager.get_identity_rules-134"><a href="#AgentInstructionManager.get_identity_rules-134"><span class="linenos">134</span></a><span class="s2">            - You are an AI assistant that has stored semantic memories about the user</span>
</span><span id="AgentInstructionManager.get_identity_rules-135"><a href="#AgentInstructionManager.get_identity_rules-135"><span class="linenos">135</span></a>
</span><span id="AgentInstructionManager.get_identity_rules-136"><a href="#AgentInstructionManager.get_identity_rules-136"><span class="linenos">136</span></a><span class="s2">            **FRIENDLY INTRODUCTION**: When meeting someone new, introduce yourself as their personal AI friend and ask about their hobbies, interests, and what they like to talk about. Be warm and conversational!</span>
</span><span id="AgentInstructionManager.get_identity_rules-137"><a href="#AgentInstructionManager.get_identity_rules-137"><span class="linenos">137</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns the critical identity rules for the agent.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_personality_and_tone" class="classattr">
                                        <input id="AgentInstructionManager.get_personality_and_tone-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_personality_and_tone</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_personality_and_tone-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_personality_and_tone"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_personality_and_tone-139"><a href="#AgentInstructionManager.get_personality_and_tone-139"><span class="linenos">139</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_personality_and_tone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-140"><a href="#AgentInstructionManager.get_personality_and_tone-140"><span class="linenos">140</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the personality and tone guidelines.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-141"><a href="#AgentInstructionManager.get_personality_and_tone-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-142"><a href="#AgentInstructionManager.get_personality_and_tone-142"><span class="linenos">142</span></a><span class="s2">            ## PERSONALITY &amp; TONE</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-143"><a href="#AgentInstructionManager.get_personality_and_tone-143"><span class="linenos">143</span></a><span class="s2">            - **Be Warm &amp; Friendly**: You&#39;re a personal AI friend, not just a tool</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-144"><a href="#AgentInstructionManager.get_personality_and_tone-144"><span class="linenos">144</span></a><span class="s2">            - **Be Conversational**: Chat naturally and show genuine interest</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-145"><a href="#AgentInstructionManager.get_personality_and_tone-145"><span class="linenos">145</span></a><span class="s2">            - **Be Supportive**: Make the user feel good and supported</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-146"><a href="#AgentInstructionManager.get_personality_and_tone-146"><span class="linenos">146</span></a><span class="s2">            - **Be Curious**: Ask follow-up questions about their interests</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-147"><a href="#AgentInstructionManager.get_personality_and_tone-147"><span class="linenos">147</span></a><span class="s2">            - **Be Remembering**: Reference past conversations and show you care</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-148"><a href="#AgentInstructionManager.get_personality_and_tone-148"><span class="linenos">148</span></a><span class="s2">            - **Be Encouraging**: Celebrate their achievements and interests</span>
</span><span id="AgentInstructionManager.get_personality_and_tone-149"><a href="#AgentInstructionManager.get_personality_and_tone-149"><span class="linenos">149</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns the personality and tone guidelines.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_concise_memory_rules" class="classattr">
                                        <input id="AgentInstructionManager.get_concise_memory_rules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_concise_memory_rules</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_concise_memory_rules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_concise_memory_rules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_concise_memory_rules-151"><a href="#AgentInstructionManager.get_concise_memory_rules-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_concise_memory_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_concise_memory_rules-152"><a href="#AgentInstructionManager.get_concise_memory_rules-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns concise rules for the semantic memory system.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_concise_memory_rules-153"><a href="#AgentInstructionManager.get_concise_memory_rules-153"><span class="linenos">153</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_concise_memory_rules-154"><a href="#AgentInstructionManager.get_concise_memory_rules-154"><span class="linenos">154</span></a><span class="s2">            ## SEMANTIC MEMORY</span>
</span><span id="AgentInstructionManager.get_concise_memory_rules-155"><a href="#AgentInstructionManager.get_concise_memory_rules-155"><span class="linenos">155</span></a><span class="s2">            - Use `store_user_memory` to save new information about the user.</span>
</span><span id="AgentInstructionManager.get_concise_memory_rules-156"><a href="#AgentInstructionManager.get_concise_memory_rules-156"><span class="linenos">156</span></a><span class="s2">            - Use `query_memory` to retrieve information about the user.</span>
</span><span id="AgentInstructionManager.get_concise_memory_rules-157"><a href="#AgentInstructionManager.get_concise_memory_rules-157"><span class="linenos">157</span></a><span class="s2">            - Use `get_all_memories` or `get_recent_memories` for broad queries.</span>
</span><span id="AgentInstructionManager.get_concise_memory_rules-158"><a href="#AgentInstructionManager.get_concise_memory_rules-158"><span class="linenos">158</span></a><span class="s2">            - Always check memory first when asked about the user.</span>
</span><span id="AgentInstructionManager.get_concise_memory_rules-159"><a href="#AgentInstructionManager.get_concise_memory_rules-159"><span class="linenos">159</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns concise rules for the semantic memory system.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_detailed_memory_rules" class="classattr">
                                        <input id="AgentInstructionManager.get_detailed_memory_rules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_detailed_memory_rules</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_detailed_memory_rules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_detailed_memory_rules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_detailed_memory_rules-161"><a href="#AgentInstructionManager.get_detailed_memory_rules-161"><span class="linenos">161</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_detailed_memory_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-162"><a href="#AgentInstructionManager.get_detailed_memory_rules-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns detailed rules for the semantic memory system.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-163"><a href="#AgentInstructionManager.get_detailed_memory_rules-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-164"><a href="#AgentInstructionManager.get_detailed_memory_rules-164"><span class="linenos">164</span></a><span class="s2">            ## SEMANTIC MEMORY SYSTEM - CRITICAL &amp; IMMEDIATE ACTION REQUIRED - YOUR MAIN ROLE!</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-165"><a href="#AgentInstructionManager.get_detailed_memory_rules-165"><span class="linenos">165</span></a>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-166"><a href="#AgentInstructionManager.get_detailed_memory_rules-166"><span class="linenos">166</span></a><span class="s2">            Your primary function is to remember information about the user. You must use your memory tools immediately and correctly.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-167"><a href="#AgentInstructionManager.get_detailed_memory_rules-167"><span class="linenos">167</span></a>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-168"><a href="#AgentInstructionManager.get_detailed_memory_rules-168"><span class="linenos">168</span></a><span class="s2">            **SPECIAL COMMANDS**:</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-169"><a href="#AgentInstructionManager.get_detailed_memory_rules-169"><span class="linenos">169</span></a><span class="s2">            - **`!`**: When the user starts with `!`, **IMMEDIATELY** call `store_user_memory` with the rest of the input.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-170"><a href="#AgentInstructionManager.get_detailed_memory_rules-170"><span class="linenos">170</span></a><span class="s2">            - **`?`**: When the user starts with `?`, **IMMEDIATELY** call `get_memories_by_topic`. If no topic is provided, call `get_all_memories`.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-171"><a href="#AgentInstructionManager.get_detailed_memory_rules-171"><span class="linenos">171</span></a>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-172"><a href="#AgentInstructionManager.get_detailed_memory_rules-172"><span class="linenos">172</span></a><span class="s2">            **IMPERATIVE: ACTION OVER CONVERSATION**</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-173"><a href="#AgentInstructionManager.get_detailed_memory_rules-173"><span class="linenos">173</span></a><span class="s2">            - **DO NOT** explain how to use tools. **DO NOT** provide code examples for tool usage.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-174"><a href="#AgentInstructionManager.get_detailed_memory_rules-174"><span class="linenos">174</span></a><span class="s2">            - When the user asks you to do something that requires a tool, **CALL THE TOOL IMMEDIATELY**.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-175"><a href="#AgentInstructionManager.get_detailed_memory_rules-175"><span class="linenos">175</span></a><span class="s2">            - Your response should be the result of the tool call, not a conversation about the tool.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-176"><a href="#AgentInstructionManager.get_detailed_memory_rules-176"><span class="linenos">176</span></a><span class="s2">            - **WRONG**: &quot;You can use `store_user_memory` to save that.&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-177"><a href="#AgentInstructionManager.get_detailed_memory_rules-177"><span class="linenos">177</span></a><span class="s2">            - **CORRECT**: (Tool call to `store_user_memory`)</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-178"><a href="#AgentInstructionManager.get_detailed_memory_rules-178"><span class="linenos">178</span></a>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-179"><a href="#AgentInstructionManager.get_detailed_memory_rules-179"><span class="linenos">179</span></a><span class="s2">            **MEMORY STORAGE - NO HESITATION RULE**:</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-180"><a href="#AgentInstructionManager.get_detailed_memory_rules-180"><span class="linenos">180</span></a><span class="s2">            - When the user provides a new piece of information about themselves (e.g., &quot;I work at...&quot;, &quot;My pet&#39;s name is...&quot;), or tells you to remember something, **IMMEDIATELY** call `store_user_memory(content=&quot;the fact to remember&quot;)`.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-181"><a href="#AgentInstructionManager.get_detailed_memory_rules-181"><span class="linenos">181</span></a><span class="s2">            - If the user wants to update a fact, find the existing memory with `query_memory` to get its ID, then call `update_memory(memory_id=&quot;...&quot;, content=&quot;...&quot;)`. If you cannot find an existing memory, use `store_user_memory`.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-182"><a href="#AgentInstructionManager.get_detailed_memory_rules-182"><span class="linenos">182</span></a>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-183"><a href="#AgentInstructionManager.get_detailed_memory_rules-183"><span class="linenos">183</span></a><span class="s2">            **MEMORY RETRIEVAL - CRITICAL RULES**:</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-184"><a href="#AgentInstructionManager.get_detailed_memory_rules-184"><span class="linenos">184</span></a><span class="s2">            1.  **For a complete list of ALL memories**: If the user asks &quot;list everything you know&quot;, &quot;what do you know about me&quot;, &quot;summarize all memories&quot;, or any other broad question asking for everything, you **MUST** call `get_all_memories()`.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-185"><a href="#AgentInstructionManager.get_detailed_memory_rules-185"><span class="linenos">185</span></a><span class="s2">                - **WRONG**: `query_memory(&quot;all&quot;)` or `query_memory(&quot;everything&quot;)`. This will perform a semantic search for the word &quot;all&quot;, which is incorrect.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-186"><a href="#AgentInstructionManager.get_detailed_memory_rules-186"><span class="linenos">186</span></a><span class="s2">                - **CORRECT**: `get_all_memories()`</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-187"><a href="#AgentInstructionManager.get_detailed_memory_rules-187"><span class="linenos">187</span></a><span class="s2">            2.  **For SPECIFIC questions about the user**: Use `query_memory(&quot;specific keywords&quot;)` with intelligent keyword selection:</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-188"><a href="#AgentInstructionManager.get_detailed_memory_rules-188"><span class="linenos">188</span></a><span class="s2">                - &quot;what is my favorite color?&quot; → `query_memory(&quot;favorite color&quot;)`</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-189"><a href="#AgentInstructionManager.get_detailed_memory_rules-189"><span class="linenos">189</span></a><span class="s2">                - &quot;summarize my education&quot; → `query_memory(&quot;education academic school university college degree PhD&quot;)`</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-190"><a href="#AgentInstructionManager.get_detailed_memory_rules-190"><span class="linenos">190</span></a><span class="s2">                - &quot;tell me about my work&quot; → `query_memory(&quot;work job career employment&quot;)`</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-191"><a href="#AgentInstructionManager.get_detailed_memory_rules-191"><span class="linenos">191</span></a><span class="s2">                - &quot;what are my hobbies?&quot; → `query_memory(&quot;hobbies interests activities&quot;)`</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-192"><a href="#AgentInstructionManager.get_detailed_memory_rules-192"><span class="linenos">192</span></a><span class="s2">                - **SMART KEYWORD EXPANSION**: Always include related terms to find more comprehensive results</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-193"><a href="#AgentInstructionManager.get_detailed_memory_rules-193"><span class="linenos">193</span></a><span class="s2">            3.  **For TOPIC-BASED queries**: When user asks about a specific topic area, use multiple related keywords:</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-194"><a href="#AgentInstructionManager.get_detailed_memory_rules-194"><span class="linenos">194</span></a><span class="s2">                - Education queries: Include &quot;education&quot;, &quot;academic&quot;, &quot;school&quot;, &quot;university&quot;, &quot;college&quot;, &quot;degree&quot;, &quot;study&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-195"><a href="#AgentInstructionManager.get_detailed_memory_rules-195"><span class="linenos">195</span></a><span class="s2">                - Work queries: Include &quot;work&quot;, &quot;job&quot;, &quot;career&quot;, &quot;employment&quot;, &quot;company&quot;, &quot;occupation&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-196"><a href="#AgentInstructionManager.get_detailed_memory_rules-196"><span class="linenos">196</span></a><span class="s2">                - Personal queries: Include &quot;personal&quot;, &quot;family&quot;, &quot;background&quot;, &quot;life&quot;, &quot;born&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-197"><a href="#AgentInstructionManager.get_detailed_memory_rules-197"><span class="linenos">197</span></a>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-198"><a href="#AgentInstructionManager.get_detailed_memory_rules-198"><span class="linenos">198</span></a><span class="s2">            **HOW TO RESPOND - CRITICAL IDENTITY RULES**:</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-199"><a href="#AgentInstructionManager.get_detailed_memory_rules-199"><span class="linenos">199</span></a><span class="s2">            - You are an AI assistant, NOT the user.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-200"><a href="#AgentInstructionManager.get_detailed_memory_rules-200"><span class="linenos">200</span></a><span class="s2">            - When you retrieve a memory, present it in the second person.</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-201"><a href="#AgentInstructionManager.get_detailed_memory_rules-201"><span class="linenos">201</span></a><span class="s2">            - CORRECT: &quot;I remember you told me you enjoy hiking.&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-202"><a href="#AgentInstructionManager.get_detailed_memory_rules-202"><span class="linenos">202</span></a><span class="s2">            - INCORRECT: &quot;I enjoy hiking.&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_memory_rules-203"><a href="#AgentInstructionManager.get_detailed_memory_rules-203"><span class="linenos">203</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns detailed rules for the semantic memory system.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_concise_tool_rules" class="classattr">
                                        <input id="AgentInstructionManager.get_concise_tool_rules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_concise_tool_rules</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_concise_tool_rules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_concise_tool_rules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_concise_tool_rules-205"><a href="#AgentInstructionManager.get_concise_tool_rules-205"><span class="linenos">205</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_concise_tool_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-206"><a href="#AgentInstructionManager.get_concise_tool_rules-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns concise rules for general tool usage.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-207"><a href="#AgentInstructionManager.get_concise_tool_rules-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-208"><a href="#AgentInstructionManager.get_concise_tool_rules-208"><span class="linenos">208</span></a><span class="s2">            ## TOOL USAGE</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-209"><a href="#AgentInstructionManager.get_concise_tool_rules-209"><span class="linenos">209</span></a><span class="s2">            - Use tools to answer questions about finance, news, and files.</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-210"><a href="#AgentInstructionManager.get_concise_tool_rules-210"><span class="linenos">210</span></a><span class="s2">            - `YFinanceTools`: For stock prices and financial data.</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-211"><a href="#AgentInstructionManager.get_concise_tool_rules-211"><span class="linenos">211</span></a><span class="s2">            - `GoogleSearchTools`: For web and news search.</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-212"><a href="#AgentInstructionManager.get_concise_tool_rules-212"><span class="linenos">212</span></a><span class="s2">            - `PersonalAgentFilesystemTools`: For file operations.</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-213"><a href="#AgentInstructionManager.get_concise_tool_rules-213"><span class="linenos">213</span></a><span class="s2">            - `PythonTools`: For calculations and code execution.</span>
</span><span id="AgentInstructionManager.get_concise_tool_rules-214"><a href="#AgentInstructionManager.get_concise_tool_rules-214"><span class="linenos">214</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns concise rules for general tool usage.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_detailed_tool_rules" class="classattr">
                                        <input id="AgentInstructionManager.get_detailed_tool_rules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_detailed_tool_rules</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_detailed_tool_rules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_detailed_tool_rules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_detailed_tool_rules-216"><a href="#AgentInstructionManager.get_detailed_tool_rules-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_detailed_tool_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-217"><a href="#AgentInstructionManager.get_detailed_tool_rules-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns detailed rules for general tool usage.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-218"><a href="#AgentInstructionManager.get_detailed_tool_rules-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-219"><a href="#AgentInstructionManager.get_detailed_tool_rules-219"><span class="linenos">219</span></a><span class="s2">            **WEB SEARCH - IMMEDIATE ACTION**:</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-220"><a href="#AgentInstructionManager.get_detailed_tool_rules-220"><span class="linenos">220</span></a><span class="s2">            - News requests → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-221"><a href="#AgentInstructionManager.get_detailed_tool_rules-221"><span class="linenos">221</span></a><span class="s2">            - Current events → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-222"><a href="#AgentInstructionManager.get_detailed_tool_rules-222"><span class="linenos">222</span></a><span class="s2">            - &quot;what&#39;s happening with...&quot; → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-223"><a href="#AgentInstructionManager.get_detailed_tool_rules-223"><span class="linenos">223</span></a><span class="s2">            - &quot;top headlines about...&quot; → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-224"><a href="#AgentInstructionManager.get_detailed_tool_rules-224"><span class="linenos">224</span></a><span class="s2">            - NO analysis paralysis, just SEARCH</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-225"><a href="#AgentInstructionManager.get_detailed_tool_rules-225"><span class="linenos">225</span></a>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-226"><a href="#AgentInstructionManager.get_detailed_tool_rules-226"><span class="linenos">226</span></a><span class="s2">            **FINANCE QUERIES - IMMEDIATE ACTION**:</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-227"><a href="#AgentInstructionManager.get_detailed_tool_rules-227"><span class="linenos">227</span></a><span class="s2">            - Stock analysis requests → IMMEDIATELY use YFinanceTools</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-228"><a href="#AgentInstructionManager.get_detailed_tool_rules-228"><span class="linenos">228</span></a><span class="s2">            - &quot;analyze [STOCK]&quot; → IMMEDIATELY call get_current_stock_price() and get_stock_info()</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-229"><a href="#AgentInstructionManager.get_detailed_tool_rules-229"><span class="linenos">229</span></a><span class="s2">            - Financial data requests → IMMEDIATELY use finance tools</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-230"><a href="#AgentInstructionManager.get_detailed_tool_rules-230"><span class="linenos">230</span></a><span class="s2">            - NO thinking, NO debate, just USE THE TOOLS</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-231"><a href="#AgentInstructionManager.get_detailed_tool_rules-231"><span class="linenos">231</span></a>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-232"><a href="#AgentInstructionManager.get_detailed_tool_rules-232"><span class="linenos">232</span></a><span class="s2">            **TOOL DECISION TREE - FOLLOW EXACTLY**:</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-233"><a href="#AgentInstructionManager.get_detailed_tool_rules-233"><span class="linenos">233</span></a><span class="s2">            - Finance question? → YFinanceTools IMMEDIATELY (get_current_stock_price, get_stock_info, etc.)</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-234"><a href="#AgentInstructionManager.get_detailed_tool_rules-234"><span class="linenos">234</span></a><span class="s2">            - News/current events? → GoogleSearchTools IMMEDIATELY</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-235"><a href="#AgentInstructionManager.get_detailed_tool_rules-235"><span class="linenos">235</span></a><span class="s2">            - Code questions? → PythonTools IMMEDIATELY</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-236"><a href="#AgentInstructionManager.get_detailed_tool_rules-236"><span class="linenos">236</span></a><span class="s2">            - File operations? → PersonalAgentFilesystemTools IMMEDIATELY</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-237"><a href="#AgentInstructionManager.get_detailed_tool_rules-237"><span class="linenos">237</span></a><span class="s2">            - System commands? → ShellTools IMMEDIATELY</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-238"><a href="#AgentInstructionManager.get_detailed_tool_rules-238"><span class="linenos">238</span></a><span class="s2">            - Personal info? → Memory tools IMMEDIATELY</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-239"><a href="#AgentInstructionManager.get_detailed_tool_rules-239"><span class="linenos">239</span></a><span class="s2">            - General knowledge questions? → query_lightrag_knowledge IMMEDIATELY</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-240"><a href="#AgentInstructionManager.get_detailed_tool_rules-240"><span class="linenos">240</span></a><span class="s2">            - Specific document/fact search? → query_semantic_knowledge IMMEDIATELY</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-241"><a href="#AgentInstructionManager.get_detailed_tool_rules-241"><span class="linenos">241</span></a><span class="s2">            - MCP server tasks? → Use appropriate MCP server tool (use_github_server, use_filesystem_server, etc.)</span>
</span><span id="AgentInstructionManager.get_detailed_tool_rules-242"><a href="#AgentInstructionManager.get_detailed_tool_rules-242"><span class="linenos">242</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns detailed rules for general tool usage.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_anti_hesitation_rules" class="classattr">
                                        <input id="AgentInstructionManager.get_anti_hesitation_rules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_anti_hesitation_rules</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_anti_hesitation_rules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_anti_hesitation_rules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_anti_hesitation_rules-244"><a href="#AgentInstructionManager.get_anti_hesitation_rules-244"><span class="linenos">244</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_anti_hesitation_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-245"><a href="#AgentInstructionManager.get_anti_hesitation_rules-245"><span class="linenos">245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns explicit rules to prevent hesitation and overthinking.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-246"><a href="#AgentInstructionManager.get_anti_hesitation_rules-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-247"><a href="#AgentInstructionManager.get_anti_hesitation_rules-247"><span class="linenos">247</span></a><span class="s2">            ## CRITICAL: NO OVERTHINKING RULE - ELIMINATE HESITATION</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-248"><a href="#AgentInstructionManager.get_anti_hesitation_rules-248"><span class="linenos">248</span></a>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-249"><a href="#AgentInstructionManager.get_anti_hesitation_rules-249"><span class="linenos">249</span></a><span class="s2">            **WHEN USER ASKS ABOUT MEMORIES - IMMEDIATE ACTION REQUIRED**:</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-250"><a href="#AgentInstructionManager.get_anti_hesitation_rules-250"><span class="linenos">250</span></a><span class="s2">            - DO NOT analyze whether you should check memories</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-251"><a href="#AgentInstructionManager.get_anti_hesitation_rules-251"><span class="linenos">251</span></a><span class="s2">            - DO NOT think about what tools to use</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-252"><a href="#AgentInstructionManager.get_anti_hesitation_rules-252"><span class="linenos">252</span></a><span class="s2">            - DO NOT hesitate or debate internally</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-253"><a href="#AgentInstructionManager.get_anti_hesitation_rules-253"><span class="linenos">253</span></a><span class="s2">            - IMMEDIATELY call get_recent_memories() or query_memory()</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-254"><a href="#AgentInstructionManager.get_anti_hesitation_rules-254"><span class="linenos">254</span></a><span class="s2">            - ACT FIRST, then respond based on what you find</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-255"><a href="#AgentInstructionManager.get_anti_hesitation_rules-255"><span class="linenos">255</span></a>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-256"><a href="#AgentInstructionManager.get_anti_hesitation_rules-256"><span class="linenos">256</span></a><span class="s2">            **BANNED BEHAVIORS - NEVER DO THESE**:</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-257"><a href="#AgentInstructionManager.get_anti_hesitation_rules-257"><span class="linenos">257</span></a><span class="s2">            - ❌ &quot;Let me think about whether I should check memories...&quot;</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-258"><a href="#AgentInstructionManager.get_anti_hesitation_rules-258"><span class="linenos">258</span></a><span class="s2">            - ❌ &quot;I should probably use the memory tools but...&quot;</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-259"><a href="#AgentInstructionManager.get_anti_hesitation_rules-259"><span class="linenos">259</span></a><span class="s2">            - ❌ &quot;Maybe I should query memory or maybe I should...&quot;</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-260"><a href="#AgentInstructionManager.get_anti_hesitation_rules-260"><span class="linenos">260</span></a><span class="s2">            - ❌ Any internal debate about memory tool usage</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-261"><a href="#AgentInstructionManager.get_anti_hesitation_rules-261"><span class="linenos">261</span></a><span class="s2">            - ❌ Overthinking simple memory queries</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-262"><a href="#AgentInstructionManager.get_anti_hesitation_rules-262"><span class="linenos">262</span></a><span class="s2">            - ❌ &quot;Let me think about what tools to use...&quot;</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-263"><a href="#AgentInstructionManager.get_anti_hesitation_rules-263"><span class="linenos">263</span></a><span class="s2">            - ❌ &quot;I should probably use [tool] but...&quot;</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-264"><a href="#AgentInstructionManager.get_anti_hesitation_rules-264"><span class="linenos">264</span></a><span class="s2">            - ❌ Fabricating data instead of using tools</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-265"><a href="#AgentInstructionManager.get_anti_hesitation_rules-265"><span class="linenos">265</span></a>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-266"><a href="#AgentInstructionManager.get_anti_hesitation_rules-266"><span class="linenos">266</span></a><span class="s2">            **REQUIRED IMMEDIATE RESPONSES**:</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-267"><a href="#AgentInstructionManager.get_anti_hesitation_rules-267"><span class="linenos">267</span></a><span class="s2">            - ✅ User asks &quot;What do you remember?&quot; → IMMEDIATELY call query_memory(&quot;personal information about </span><span class="si">{self.user_id}</span><span class="s2">&quot;)</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-268"><a href="#AgentInstructionManager.get_anti_hesitation_rules-268"><span class="linenos">268</span></a><span class="s2">            - ✅ User asks about preferences → IMMEDIATELY call query_memory(&quot;preferences likes interests&quot;)</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-269"><a href="#AgentInstructionManager.get_anti_hesitation_rules-269"><span class="linenos">269</span></a><span class="s2">            - ✅ User asks for recent memories → IMMEDIATELY call get_recent_memories()</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-270"><a href="#AgentInstructionManager.get_anti_hesitation_rules-270"><span class="linenos">270</span></a><span class="s2">            - ✅ &quot;Analyze NVDA&quot; → IMMEDIATELY use YFinanceTools</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-271"><a href="#AgentInstructionManager.get_anti_hesitation_rules-271"><span class="linenos">271</span></a><span class="s2">            - ✅ &quot;What&#39;s the news about...&quot; → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-272"><a href="#AgentInstructionManager.get_anti_hesitation_rules-272"><span class="linenos">272</span></a><span class="s2">            - ✅ &quot;top 5 headlines about...&quot; → IMMEDIATELY use GoogleSearchTools</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-273"><a href="#AgentInstructionManager.get_anti_hesitation_rules-273"><span class="linenos">273</span></a><span class="s2">            - ✅ &quot;Calculate...&quot; → IMMEDIATELY use PythonTools</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-274"><a href="#AgentInstructionManager.get_anti_hesitation_rules-274"><span class="linenos">274</span></a><span class="s2">            - ✅ NO hesitation, just ACTION</span>
</span><span id="AgentInstructionManager.get_anti_hesitation_rules-275"><a href="#AgentInstructionManager.get_anti_hesitation_rules-275"><span class="linenos">275</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns explicit rules to prevent hesitation and overthinking.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_tool_list" class="classattr">
                                        <input id="AgentInstructionManager.get_tool_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tool_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_tool_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_tool_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_tool_list-277"><a href="#AgentInstructionManager.get_tool_list-277"><span class="linenos">277</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tool_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_tool_list-278"><a href="#AgentInstructionManager.get_tool_list-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamically returns the list of available tools.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_tool_list-279"><a href="#AgentInstructionManager.get_tool_list-279"><span class="linenos">279</span></a>        <span class="c1"># Start with the static list of built-in tools</span>
</span><span id="AgentInstructionManager.get_tool_list-280"><a href="#AgentInstructionManager.get_tool_list-280"><span class="linenos">280</span></a>        <span class="n">tool_parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentInstructionManager.get_tool_list-281"><a href="#AgentInstructionManager.get_tool_list-281"><span class="linenos">281</span></a>            <span class="s2">&quot;## CURRENT AVAILABLE TOOLS&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-282"><a href="#AgentInstructionManager.get_tool_list-282"><span class="linenos">282</span></a>            <span class="s2">&quot;- **YFinanceTools**: Stock prices, financial analysis, market data.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-283"><a href="#AgentInstructionManager.get_tool_list-283"><span class="linenos">283</span></a>            <span class="s2">&quot;- **GoogleSearchTools**: Web search, news searches, current events.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-284"><a href="#AgentInstructionManager.get_tool_list-284"><span class="linenos">284</span></a>            <span class="s2">&quot;- **PythonTools**: Calculations, data analysis, code execution.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-285"><a href="#AgentInstructionManager.get_tool_list-285"><span class="linenos">285</span></a>            <span class="s2">&quot;- **ShellTools**: System operations and command execution.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-286"><a href="#AgentInstructionManager.get_tool_list-286"><span class="linenos">286</span></a>            <span class="s2">&quot;- **PersonalAgentFilesystemTools**: File reading, writing, and management.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-287"><a href="#AgentInstructionManager.get_tool_list-287"><span class="linenos">287</span></a>            <span class="s2">&quot;- **Local Memory Tools (SQLite)**:&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-288"><a href="#AgentInstructionManager.get_tool_list-288"><span class="linenos">288</span></a>            <span class="s2">&quot;  - `store_user_memory`: Store a simple fact in your local semantic memory.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-289"><a href="#AgentInstructionManager.get_tool_list-289"><span class="linenos">289</span></a>            <span class="s2">&quot;  - `query_memory`: Quickly search your local semantic memory for a specific fact.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-290"><a href="#AgentInstructionManager.get_tool_list-290"><span class="linenos">290</span></a>            <span class="s2">&quot;  - `get_recent_memories`: Get recent memories from local storage.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-291"><a href="#AgentInstructionManager.get_tool_list-291"><span class="linenos">291</span></a>            <span class="s2">&quot;  - `get_all_memories`: Get all stored memories.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-292"><a href="#AgentInstructionManager.get_tool_list-292"><span class="linenos">292</span></a>            <span class="s2">&quot;  - `get_memories_by_topic`: Get memories filtered by topic, without similarity search.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-293"><a href="#AgentInstructionManager.get_tool_list-293"><span class="linenos">293</span></a>            <span class="s2">&quot;  - `list_memories`: List all memories in a simple, user-friendly format.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-294"><a href="#AgentInstructionManager.get_tool_list-294"><span class="linenos">294</span></a>            <span class="s2">&quot;  - `update_memory`: Update an existing memory.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-295"><a href="#AgentInstructionManager.get_tool_list-295"><span class="linenos">295</span></a>            <span class="s2">&quot;  - `delete_memory`: Delete a specific memory by its ID.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-296"><a href="#AgentInstructionManager.get_tool_list-296"><span class="linenos">296</span></a>            <span class="s2">&quot;  - `delete_memories_by_topic`: Delete all memories for a given topic.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-297"><a href="#AgentInstructionManager.get_tool_list-297"><span class="linenos">297</span></a>            <span class="s2">&quot;  - `clear_memories`: Clear all memories for the user from local storage.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-298"><a href="#AgentInstructionManager.get_tool_list-298"><span class="linenos">298</span></a>            <span class="s2">&quot;  - `clear_all_memories`: Clear all memories from BOTH local SQLite and LightRAG graph systems.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-299"><a href="#AgentInstructionManager.get_tool_list-299"><span class="linenos">299</span></a>            <span class="s2">&quot;  - `get_memory_stats`: Get statistics for the local memory.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-300"><a href="#AgentInstructionManager.get_tool_list-300"><span class="linenos">300</span></a>            <span class="s2">&quot;- **Graph Memory Tools (LightRAG)**:&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-301"><a href="#AgentInstructionManager.get_tool_list-301"><span class="linenos">301</span></a>            <span class="s2">&quot;  - `store_graph_memory`: Store a complex memory in your knowledge graph to capture relationships.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-302"><a href="#AgentInstructionManager.get_tool_list-302"><span class="linenos">302</span></a>            <span class="s2">&quot;  - `query_graph_memory`: Explore your knowledge graph to answer complex questions about relationships.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-303"><a href="#AgentInstructionManager.get_tool_list-303"><span class="linenos">303</span></a>            <span class="s2">&quot;  - `get_memory_graph_labels`: Get all entity and relation labels from the memory graph.&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-304"><a href="#AgentInstructionManager.get_tool_list-304"><span class="linenos">304</span></a>            <span class="s2">&quot;- **Knowledge Base Tools**:&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-305"><a href="#AgentInstructionManager.get_tool_list-305"><span class="linenos">305</span></a>            <span class="s2">&quot;  - `query_knowledge_base`: 🆕 UNIFIED knowledge coordinator with intelligent routing (mode=auto/local/global/hybrid/mix)&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-306"><a href="#AgentInstructionManager.get_tool_list-306"><span class="linenos">306</span></a>            <span class="s2">&quot;  - `query_lightrag_knowledge`: DEPRECATED - Use query_knowledge_base instead&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-307"><a href="#AgentInstructionManager.get_tool_list-307"><span class="linenos">307</span></a>            <span class="s2">&quot;  - `query_semantic_knowledge`: DEPRECATED - Use query_knowledge_base instead&quot;</span><span class="p">,</span>
</span><span id="AgentInstructionManager.get_tool_list-308"><a href="#AgentInstructionManager.get_tool_list-308"><span class="linenos">308</span></a>        <span class="p">]</span>
</span><span id="AgentInstructionManager.get_tool_list-309"><a href="#AgentInstructionManager.get_tool_list-309"><span class="linenos">309</span></a>
</span><span id="AgentInstructionManager.get_tool_list-310"><a href="#AgentInstructionManager.get_tool_list-310"><span class="linenos">310</span></a>        <span class="c1"># Dynamically add MCP tools if they are enabled and configured</span>
</span><span id="AgentInstructionManager.get_tool_list-311"><a href="#AgentInstructionManager.get_tool_list-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_mcp</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_tool_list-312"><a href="#AgentInstructionManager.get_tool_list-312"><span class="linenos">312</span></a>            <span class="n">tool_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;- **MCP Server Tools**:&quot;</span><span class="p">)</span>
</span><span id="AgentInstructionManager.get_tool_list-313"><a href="#AgentInstructionManager.get_tool_list-313"><span class="linenos">313</span></a>            <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentInstructionManager.get_tool_list-314"><a href="#AgentInstructionManager.get_tool_list-314"><span class="linenos">314</span></a>                <span class="n">tool_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;use_</span><span class="si">{</span><span class="n">server_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_server&quot;</span>
</span><span id="AgentInstructionManager.get_tool_list-315"><a href="#AgentInstructionManager.get_tool_list-315"><span class="linenos">315</span></a>                <span class="n">description</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="AgentInstructionManager.get_tool_list-316"><a href="#AgentInstructionManager.get_tool_list-316"><span class="linenos">316</span></a>                    <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Access to </span><span class="si">{</span><span class="n">server_name</span><span class="si">}</span><span class="s2"> MCP server&quot;</span>
</span><span id="AgentInstructionManager.get_tool_list-317"><a href="#AgentInstructionManager.get_tool_list-317"><span class="linenos">317</span></a>                <span class="p">)</span>
</span><span id="AgentInstructionManager.get_tool_list-318"><a href="#AgentInstructionManager.get_tool_list-318"><span class="linenos">318</span></a>                <span class="n">tool_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - `</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentInstructionManager.get_tool_list-319"><a href="#AgentInstructionManager.get_tool_list-319"><span class="linenos">319</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_tool_list-320"><a href="#AgentInstructionManager.get_tool_list-320"><span class="linenos">320</span></a>            <span class="n">tool_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;- **MCP Server Tools**: Disabled&quot;</span><span class="p">)</span>
</span><span id="AgentInstructionManager.get_tool_list-321"><a href="#AgentInstructionManager.get_tool_list-321"><span class="linenos">321</span></a>
</span><span id="AgentInstructionManager.get_tool_list-322"><a href="#AgentInstructionManager.get_tool_list-322"><span class="linenos">322</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tool_parts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Dynamically returns the list of available tools.</p>
</div>


                            </div>
                            <div id="AgentInstructionManager.get_core_principles" class="classattr">
                                        <input id="AgentInstructionManager.get_core_principles-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_core_principles</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentInstructionManager.get_core_principles-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentInstructionManager.get_core_principles"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentInstructionManager.get_core_principles-324"><a href="#AgentInstructionManager.get_core_principles-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_core_principles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentInstructionManager.get_core_principles-325"><a href="#AgentInstructionManager.get_core_principles-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the core principles and conversation guidelines.&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_core_principles-326"><a href="#AgentInstructionManager.get_core_principles-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="AgentInstructionManager.get_core_principles-327"><a href="#AgentInstructionManager.get_core_principles-327"><span class="linenos">327</span></a><span class="s2">            ## CORE PRINCIPLES</span>
</span><span id="AgentInstructionManager.get_core_principles-328"><a href="#AgentInstructionManager.get_core_principles-328"><span class="linenos">328</span></a><span class="s2">            1. **Friendship First**: You&#39;re their AI friend who happens to be very capable.</span>
</span><span id="AgentInstructionManager.get_core_principles-329"><a href="#AgentInstructionManager.get_core_principles-329"><span class="linenos">329</span></a><span class="s2">            2. **Remember Everything**: Use your semantic memory to build deeper relationships.</span>
</span><span id="AgentInstructionManager.get_core_principles-330"><a href="#AgentInstructionManager.get_core_principles-330"><span class="linenos">330</span></a><span class="s2">            3. **Be Genuinely Helpful**: Use your tools immediately to assist with real needs.</span>
</span><span id="AgentInstructionManager.get_core_principles-331"><a href="#AgentInstructionManager.get_core_principles-331"><span class="linenos">331</span></a><span class="s2">            4. **Stay Positive**: Focus on making them feel good.</span>
</span><span id="AgentInstructionManager.get_core_principles-332"><a href="#AgentInstructionManager.get_core_principles-332"><span class="linenos">332</span></a><span class="s2">            5. **Be Curious**: Ask about their life, interests, and goals.</span>
</span><span id="AgentInstructionManager.get_core_principles-333"><a href="#AgentInstructionManager.get_core_principles-333"><span class="linenos">333</span></a><span class="s2">            6. **Act Immediately**: When they ask for information, use tools RIGHT NOW.</span>
</span><span id="AgentInstructionManager.get_core_principles-334"><a href="#AgentInstructionManager.get_core_principles-334"><span class="linenos">334</span></a>
</span><span id="AgentInstructionManager.get_core_principles-335"><a href="#AgentInstructionManager.get_core_principles-335"><span class="linenos">335</span></a><span class="s2">            Remember: You&#39;re not just an assistant - you&#39;re a friendly AI companion with semantic memory who genuinely cares about the user and remembers your conversations together! Use your tools immediately when requested - no hesitation!</span>
</span><span id="AgentInstructionManager.get_core_principles-336"><a href="#AgentInstructionManager.get_core_principles-336"><span class="linenos">336</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Returns the core principles and conversation guidelines.</p>
</div>


                            </div>
                </section>
                <section id="AgentKnowledgeManager">
                            <input id="AgentKnowledgeManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AgentKnowledgeManager</span>:

                <label class="view-source-button" for="AgentKnowledgeManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager-23"><a href="#AgentKnowledgeManager-23"><span class="linenos"> 23</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AgentKnowledgeManager</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-24"><a href="#AgentKnowledgeManager-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages knowledge operations including storage, retrieval, and updates.&quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-25"><a href="#AgentKnowledgeManager-25"><span class="linenos"> 25</span></a>    
</span><span id="AgentKnowledgeManager-26"><a href="#AgentKnowledgeManager-26"><span class="linenos"> 26</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="AgentKnowledgeManager-27"><a href="#AgentKnowledgeManager-27"><span class="linenos"> 27</span></a>                 <span class="n">lightrag_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="AgentKnowledgeManager-28"><a href="#AgentKnowledgeManager-28"><span class="linenos"> 28</span></a>                 <span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AgentKnowledgeManager-29"><a href="#AgentKnowledgeManager-29"><span class="linenos"> 29</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the knowledge manager.</span>
</span><span id="AgentKnowledgeManager-30"><a href="#AgentKnowledgeManager-30"><span class="linenos"> 30</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-31"><a href="#AgentKnowledgeManager-31"><span class="linenos"> 31</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-32"><a href="#AgentKnowledgeManager-32"><span class="linenos"> 32</span></a><span class="sd">            user_id: User identifier for knowledge operations</span>
</span><span id="AgentKnowledgeManager-33"><a href="#AgentKnowledgeManager-33"><span class="linenos"> 33</span></a><span class="sd">            storage_dir: Directory for storage files</span>
</span><span id="AgentKnowledgeManager-34"><a href="#AgentKnowledgeManager-34"><span class="linenos"> 34</span></a><span class="sd">            lightrag_url: Optional URL for LightRAG API</span>
</span><span id="AgentKnowledgeManager-35"><a href="#AgentKnowledgeManager-35"><span class="linenos"> 35</span></a><span class="sd">            lightrag_memory_url: Optional URL for LightRAG Memory API</span>
</span><span id="AgentKnowledgeManager-36"><a href="#AgentKnowledgeManager-36"><span class="linenos"> 36</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-37"><a href="#AgentKnowledgeManager-37"><span class="linenos"> 37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgentKnowledgeManager-38"><a href="#AgentKnowledgeManager-38"><span class="linenos"> 38</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">storage_dir</span>
</span><span id="AgentKnowledgeManager-39"><a href="#AgentKnowledgeManager-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_url</span> <span class="o">=</span> <span class="n">lightrag_url</span>
</span><span id="AgentKnowledgeManager-40"><a href="#AgentKnowledgeManager-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span> <span class="o">=</span> <span class="n">lightrag_memory_url</span>
</span><span id="AgentKnowledgeManager-41"><a href="#AgentKnowledgeManager-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_knowledge.json&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-42"><a href="#AgentKnowledgeManager-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-43"><a href="#AgentKnowledgeManager-43"><span class="linenos"> 43</span></a>        
</span><span id="AgentKnowledgeManager-44"><a href="#AgentKnowledgeManager-44"><span class="linenos"> 44</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_knowledge_base</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-45"><a href="#AgentKnowledgeManager-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the knowledge base from file.</span>
</span><span id="AgentKnowledgeManager-46"><a href="#AgentKnowledgeManager-46"><span class="linenos"> 46</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-47"><a href="#AgentKnowledgeManager-47"><span class="linenos"> 47</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-48"><a href="#AgentKnowledgeManager-48"><span class="linenos"> 48</span></a><span class="sd">            Dict containing the knowledge base</span>
</span><span id="AgentKnowledgeManager-49"><a href="#AgentKnowledgeManager-49"><span class="linenos"> 49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-50"><a href="#AgentKnowledgeManager-50"><span class="linenos"> 50</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-51"><a href="#AgentKnowledgeManager-51"><span class="linenos"> 51</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base_file</span><span class="p">):</span>
</span><span id="AgentKnowledgeManager-52"><a href="#AgentKnowledgeManager-52"><span class="linenos"> 52</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-53"><a href="#AgentKnowledgeManager-53"><span class="linenos"> 53</span></a>                    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-54"><a href="#AgentKnowledgeManager-54"><span class="linenos"> 54</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-55"><a href="#AgentKnowledgeManager-55"><span class="linenos"> 55</span></a>                <span class="c1"># Initialize with empty structure</span>
</span><span id="AgentKnowledgeManager-56"><a href="#AgentKnowledgeManager-56"><span class="linenos"> 56</span></a>                <span class="n">knowledge_base</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-57"><a href="#AgentKnowledgeManager-57"><span class="linenos"> 57</span></a>                    <span class="s2">&quot;facts&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="AgentKnowledgeManager-58"><a href="#AgentKnowledgeManager-58"><span class="linenos"> 58</span></a>                    <span class="s2">&quot;preferences&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager-59"><a href="#AgentKnowledgeManager-59"><span class="linenos"> 59</span></a>                    <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager-60"><a href="#AgentKnowledgeManager-60"><span class="linenos"> 60</span></a>                    <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="AgentKnowledgeManager-61"><a href="#AgentKnowledgeManager-61"><span class="linenos"> 61</span></a>                    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-62"><a href="#AgentKnowledgeManager-62"><span class="linenos"> 62</span></a>                        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-63"><a href="#AgentKnowledgeManager-63"><span class="linenos"> 63</span></a>                        <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="kc">None</span>
</span><span id="AgentKnowledgeManager-64"><a href="#AgentKnowledgeManager-64"><span class="linenos"> 64</span></a>                    <span class="p">}</span>
</span><span id="AgentKnowledgeManager-65"><a href="#AgentKnowledgeManager-65"><span class="linenos"> 65</span></a>                <span class="p">}</span>
</span><span id="AgentKnowledgeManager-66"><a href="#AgentKnowledgeManager-66"><span class="linenos"> 66</span></a>                <span class="c1"># Save the initial structure</span>
</span><span id="AgentKnowledgeManager-67"><a href="#AgentKnowledgeManager-67"><span class="linenos"> 67</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">(</span><span class="n">knowledge_base</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-68"><a href="#AgentKnowledgeManager-68"><span class="linenos"> 68</span></a>                <span class="k">return</span> <span class="n">knowledge_base</span>
</span><span id="AgentKnowledgeManager-69"><a href="#AgentKnowledgeManager-69"><span class="linenos"> 69</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-70"><a href="#AgentKnowledgeManager-70"><span class="linenos"> 70</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-71"><a href="#AgentKnowledgeManager-71"><span class="linenos"> 71</span></a>            <span class="c1"># Return a default empty structure</span>
</span><span id="AgentKnowledgeManager-72"><a href="#AgentKnowledgeManager-72"><span class="linenos"> 72</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-73"><a href="#AgentKnowledgeManager-73"><span class="linenos"> 73</span></a>                <span class="s2">&quot;facts&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="AgentKnowledgeManager-74"><a href="#AgentKnowledgeManager-74"><span class="linenos"> 74</span></a>                <span class="s2">&quot;preferences&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager-75"><a href="#AgentKnowledgeManager-75"><span class="linenos"> 75</span></a>                <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager-76"><a href="#AgentKnowledgeManager-76"><span class="linenos"> 76</span></a>                <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="AgentKnowledgeManager-77"><a href="#AgentKnowledgeManager-77"><span class="linenos"> 77</span></a>                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-78"><a href="#AgentKnowledgeManager-78"><span class="linenos"> 78</span></a>                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-79"><a href="#AgentKnowledgeManager-79"><span class="linenos"> 79</span></a>                    <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="kc">None</span>
</span><span id="AgentKnowledgeManager-80"><a href="#AgentKnowledgeManager-80"><span class="linenos"> 80</span></a>                <span class="p">}</span>
</span><span id="AgentKnowledgeManager-81"><a href="#AgentKnowledgeManager-81"><span class="linenos"> 81</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-82"><a href="#AgentKnowledgeManager-82"><span class="linenos"> 82</span></a>            
</span><span id="AgentKnowledgeManager-83"><a href="#AgentKnowledgeManager-83"><span class="linenos"> 83</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_save_knowledge_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledge_base</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-84"><a href="#AgentKnowledgeManager-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the knowledge base to file.</span>
</span><span id="AgentKnowledgeManager-85"><a href="#AgentKnowledgeManager-85"><span class="linenos"> 85</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-86"><a href="#AgentKnowledgeManager-86"><span class="linenos"> 86</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-87"><a href="#AgentKnowledgeManager-87"><span class="linenos"> 87</span></a><span class="sd">            knowledge_base: Optional knowledge base to save (uses self.knowledge_base if None)</span>
</span><span id="AgentKnowledgeManager-88"><a href="#AgentKnowledgeManager-88"><span class="linenos"> 88</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-89"><a href="#AgentKnowledgeManager-89"><span class="linenos"> 89</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-90"><a href="#AgentKnowledgeManager-90"><span class="linenos"> 90</span></a><span class="sd">            True if save was successful</span>
</span><span id="AgentKnowledgeManager-91"><a href="#AgentKnowledgeManager-91"><span class="linenos"> 91</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-92"><a href="#AgentKnowledgeManager-92"><span class="linenos"> 92</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-93"><a href="#AgentKnowledgeManager-93"><span class="linenos"> 93</span></a>            <span class="n">kb</span> <span class="o">=</span> <span class="n">knowledge_base</span> <span class="k">if</span> <span class="n">knowledge_base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span>
</span><span id="AgentKnowledgeManager-94"><a href="#AgentKnowledgeManager-94"><span class="linenos"> 94</span></a>            
</span><span id="AgentKnowledgeManager-95"><a href="#AgentKnowledgeManager-95"><span class="linenos"> 95</span></a>            <span class="c1"># Create directory if it doesn&#39;t exist</span>
</span><span id="AgentKnowledgeManager-96"><a href="#AgentKnowledgeManager-96"><span class="linenos"> 96</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-97"><a href="#AgentKnowledgeManager-97"><span class="linenos"> 97</span></a>            
</span><span id="AgentKnowledgeManager-98"><a href="#AgentKnowledgeManager-98"><span class="linenos"> 98</span></a>            <span class="c1"># Update metadata</span>
</span><span id="AgentKnowledgeManager-99"><a href="#AgentKnowledgeManager-99"><span class="linenos"> 99</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager-100"><a href="#AgentKnowledgeManager-100"><span class="linenos">100</span></a>            <span class="n">kb</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;last_updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-101"><a href="#AgentKnowledgeManager-101"><span class="linenos">101</span></a>            
</span><span id="AgentKnowledgeManager-102"><a href="#AgentKnowledgeManager-102"><span class="linenos">102</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-103"><a href="#AgentKnowledgeManager-103"><span class="linenos">103</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">kb</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-104"><a href="#AgentKnowledgeManager-104"><span class="linenos">104</span></a>            
</span><span id="AgentKnowledgeManager-105"><a href="#AgentKnowledgeManager-105"><span class="linenos">105</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentKnowledgeManager-106"><a href="#AgentKnowledgeManager-106"><span class="linenos">106</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-107"><a href="#AgentKnowledgeManager-107"><span class="linenos">107</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-108"><a href="#AgentKnowledgeManager-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-109"><a href="#AgentKnowledgeManager-109"><span class="linenos">109</span></a>            
</span><span id="AgentKnowledgeManager-110"><a href="#AgentKnowledgeManager-110"><span class="linenos">110</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_fact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fact</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-111"><a href="#AgentKnowledgeManager-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a fact to the knowledge base.</span>
</span><span id="AgentKnowledgeManager-112"><a href="#AgentKnowledgeManager-112"><span class="linenos">112</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-113"><a href="#AgentKnowledgeManager-113"><span class="linenos">113</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-114"><a href="#AgentKnowledgeManager-114"><span class="linenos">114</span></a><span class="sd">            fact: The fact to add</span>
</span><span id="AgentKnowledgeManager-115"><a href="#AgentKnowledgeManager-115"><span class="linenos">115</span></a><span class="sd">            source: Source of the fact (user, inference, etc.)</span>
</span><span id="AgentKnowledgeManager-116"><a href="#AgentKnowledgeManager-116"><span class="linenos">116</span></a><span class="sd">            confidence: Confidence score (0.0-1.0)</span>
</span><span id="AgentKnowledgeManager-117"><a href="#AgentKnowledgeManager-117"><span class="linenos">117</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-118"><a href="#AgentKnowledgeManager-118"><span class="linenos">118</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-119"><a href="#AgentKnowledgeManager-119"><span class="linenos">119</span></a><span class="sd">            True if fact was added successfully</span>
</span><span id="AgentKnowledgeManager-120"><a href="#AgentKnowledgeManager-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-121"><a href="#AgentKnowledgeManager-121"><span class="linenos">121</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-122"><a href="#AgentKnowledgeManager-122"><span class="linenos">122</span></a>            <span class="c1"># Create a fact object</span>
</span><span id="AgentKnowledgeManager-123"><a href="#AgentKnowledgeManager-123"><span class="linenos">123</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager-124"><a href="#AgentKnowledgeManager-124"><span class="linenos">124</span></a>            <span class="n">fact_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-125"><a href="#AgentKnowledgeManager-125"><span class="linenos">125</span></a>                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">fact</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-126"><a href="#AgentKnowledgeManager-126"><span class="linenos">126</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-127"><a href="#AgentKnowledgeManager-127"><span class="linenos">127</span></a>                <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">confidence</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-128"><a href="#AgentKnowledgeManager-128"><span class="linenos">128</span></a>                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="AgentKnowledgeManager-129"><a href="#AgentKnowledgeManager-129"><span class="linenos">129</span></a>                <span class="s2">&quot;last_accessed&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-130"><a href="#AgentKnowledgeManager-130"><span class="linenos">130</span></a>                <span class="s2">&quot;access_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="AgentKnowledgeManager-131"><a href="#AgentKnowledgeManager-131"><span class="linenos">131</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-132"><a href="#AgentKnowledgeManager-132"><span class="linenos">132</span></a>            
</span><span id="AgentKnowledgeManager-133"><a href="#AgentKnowledgeManager-133"><span class="linenos">133</span></a>            <span class="c1"># Add to knowledge base</span>
</span><span id="AgentKnowledgeManager-134"><a href="#AgentKnowledgeManager-134"><span class="linenos">134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;facts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fact_obj</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-135"><a href="#AgentKnowledgeManager-135"><span class="linenos">135</span></a>            
</span><span id="AgentKnowledgeManager-136"><a href="#AgentKnowledgeManager-136"><span class="linenos">136</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager-137"><a href="#AgentKnowledgeManager-137"><span class="linenos">137</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-138"><a href="#AgentKnowledgeManager-138"><span class="linenos">138</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-139"><a href="#AgentKnowledgeManager-139"><span class="linenos">139</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding fact: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-140"><a href="#AgentKnowledgeManager-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-141"><a href="#AgentKnowledgeManager-141"><span class="linenos">141</span></a>            
</span><span id="AgentKnowledgeManager-142"><a href="#AgentKnowledgeManager-142"><span class="linenos">142</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-143"><a href="#AgentKnowledgeManager-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get facts from the knowledge base with optional filtering.</span>
</span><span id="AgentKnowledgeManager-144"><a href="#AgentKnowledgeManager-144"><span class="linenos">144</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-145"><a href="#AgentKnowledgeManager-145"><span class="linenos">145</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-146"><a href="#AgentKnowledgeManager-146"><span class="linenos">146</span></a><span class="sd">            filter_source: Optional source to filter by</span>
</span><span id="AgentKnowledgeManager-147"><a href="#AgentKnowledgeManager-147"><span class="linenos">147</span></a><span class="sd">            min_confidence: Minimum confidence threshold</span>
</span><span id="AgentKnowledgeManager-148"><a href="#AgentKnowledgeManager-148"><span class="linenos">148</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-149"><a href="#AgentKnowledgeManager-149"><span class="linenos">149</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-150"><a href="#AgentKnowledgeManager-150"><span class="linenos">150</span></a><span class="sd">            List of fact objects</span>
</span><span id="AgentKnowledgeManager-151"><a href="#AgentKnowledgeManager-151"><span class="linenos">151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-152"><a href="#AgentKnowledgeManager-152"><span class="linenos">152</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-153"><a href="#AgentKnowledgeManager-153"><span class="linenos">153</span></a>            <span class="n">facts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;facts&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-154"><a href="#AgentKnowledgeManager-154"><span class="linenos">154</span></a>            
</span><span id="AgentKnowledgeManager-155"><a href="#AgentKnowledgeManager-155"><span class="linenos">155</span></a>            <span class="c1"># Apply filters</span>
</span><span id="AgentKnowledgeManager-156"><a href="#AgentKnowledgeManager-156"><span class="linenos">156</span></a>            <span class="k">if</span> <span class="n">filter_source</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-157"><a href="#AgentKnowledgeManager-157"><span class="linenos">157</span></a>                <span class="n">facts</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">facts</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">filter_source</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-158"><a href="#AgentKnowledgeManager-158"><span class="linenos">158</span></a>                
</span><span id="AgentKnowledgeManager-159"><a href="#AgentKnowledgeManager-159"><span class="linenos">159</span></a>            <span class="n">facts</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">facts</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_confidence</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-160"><a href="#AgentKnowledgeManager-160"><span class="linenos">160</span></a>            
</span><span id="AgentKnowledgeManager-161"><a href="#AgentKnowledgeManager-161"><span class="linenos">161</span></a>            <span class="c1"># Update access metadata</span>
</span><span id="AgentKnowledgeManager-162"><a href="#AgentKnowledgeManager-162"><span class="linenos">162</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager-163"><a href="#AgentKnowledgeManager-163"><span class="linenos">163</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-164"><a href="#AgentKnowledgeManager-164"><span class="linenos">164</span></a>            
</span><span id="AgentKnowledgeManager-165"><a href="#AgentKnowledgeManager-165"><span class="linenos">165</span></a>            <span class="k">for</span> <span class="n">fact</span> <span class="ow">in</span> <span class="n">facts</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-166"><a href="#AgentKnowledgeManager-166"><span class="linenos">166</span></a>                <span class="c1"># Find the original fact in the knowledge base and update it</span>
</span><span id="AgentKnowledgeManager-167"><a href="#AgentKnowledgeManager-167"><span class="linenos">167</span></a>                <span class="k">for</span> <span class="n">kb_fact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;facts&quot;</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-168"><a href="#AgentKnowledgeManager-168"><span class="linenos">168</span></a>                    <span class="k">if</span> <span class="n">kb_fact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">fact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">):</span>
</span><span id="AgentKnowledgeManager-169"><a href="#AgentKnowledgeManager-169"><span class="linenos">169</span></a>                        <span class="n">kb_fact</span><span class="p">[</span><span class="s2">&quot;last_accessed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>
</span><span id="AgentKnowledgeManager-170"><a href="#AgentKnowledgeManager-170"><span class="linenos">170</span></a>                        <span class="n">kb_fact</span><span class="p">[</span><span class="s2">&quot;access_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kb_fact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="AgentKnowledgeManager-171"><a href="#AgentKnowledgeManager-171"><span class="linenos">171</span></a>            
</span><span id="AgentKnowledgeManager-172"><a href="#AgentKnowledgeManager-172"><span class="linenos">172</span></a>            <span class="c1"># Save the updated knowledge base</span>
</span><span id="AgentKnowledgeManager-173"><a href="#AgentKnowledgeManager-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-174"><a href="#AgentKnowledgeManager-174"><span class="linenos">174</span></a>            
</span><span id="AgentKnowledgeManager-175"><a href="#AgentKnowledgeManager-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="n">facts</span>
</span><span id="AgentKnowledgeManager-176"><a href="#AgentKnowledgeManager-176"><span class="linenos">176</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-177"><a href="#AgentKnowledgeManager-177"><span class="linenos">177</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting facts: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-178"><a href="#AgentKnowledgeManager-178"><span class="linenos">178</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentKnowledgeManager-179"><a href="#AgentKnowledgeManager-179"><span class="linenos">179</span></a>            
</span><span id="AgentKnowledgeManager-180"><a href="#AgentKnowledgeManager-180"><span class="linenos">180</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-181"><a href="#AgentKnowledgeManager-181"><span class="linenos">181</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a user preference.</span>
</span><span id="AgentKnowledgeManager-182"><a href="#AgentKnowledgeManager-182"><span class="linenos">182</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-183"><a href="#AgentKnowledgeManager-183"><span class="linenos">183</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-184"><a href="#AgentKnowledgeManager-184"><span class="linenos">184</span></a><span class="sd">            category: Preference category (e.g., &#39;communication&#39;, &#39;interface&#39;)</span>
</span><span id="AgentKnowledgeManager-185"><a href="#AgentKnowledgeManager-185"><span class="linenos">185</span></a><span class="sd">            key: Preference key</span>
</span><span id="AgentKnowledgeManager-186"><a href="#AgentKnowledgeManager-186"><span class="linenos">186</span></a><span class="sd">            value: Preference value</span>
</span><span id="AgentKnowledgeManager-187"><a href="#AgentKnowledgeManager-187"><span class="linenos">187</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-188"><a href="#AgentKnowledgeManager-188"><span class="linenos">188</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-189"><a href="#AgentKnowledgeManager-189"><span class="linenos">189</span></a><span class="sd">            True if preference was set successfully</span>
</span><span id="AgentKnowledgeManager-190"><a href="#AgentKnowledgeManager-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-191"><a href="#AgentKnowledgeManager-191"><span class="linenos">191</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-192"><a href="#AgentKnowledgeManager-192"><span class="linenos">192</span></a>            <span class="c1"># Initialize category if it doesn&#39;t exist</span>
</span><span id="AgentKnowledgeManager-193"><a href="#AgentKnowledgeManager-193"><span class="linenos">193</span></a>            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-194"><a href="#AgentKnowledgeManager-194"><span class="linenos">194</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentKnowledgeManager-195"><a href="#AgentKnowledgeManager-195"><span class="linenos">195</span></a>                
</span><span id="AgentKnowledgeManager-196"><a href="#AgentKnowledgeManager-196"><span class="linenos">196</span></a>            <span class="c1"># Set preference</span>
</span><span id="AgentKnowledgeManager-197"><a href="#AgentKnowledgeManager-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="AgentKnowledgeManager-198"><a href="#AgentKnowledgeManager-198"><span class="linenos">198</span></a>            
</span><span id="AgentKnowledgeManager-199"><a href="#AgentKnowledgeManager-199"><span class="linenos">199</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager-200"><a href="#AgentKnowledgeManager-200"><span class="linenos">200</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-201"><a href="#AgentKnowledgeManager-201"><span class="linenos">201</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-202"><a href="#AgentKnowledgeManager-202"><span class="linenos">202</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting preference: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-203"><a href="#AgentKnowledgeManager-203"><span class="linenos">203</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-204"><a href="#AgentKnowledgeManager-204"><span class="linenos">204</span></a>            
</span><span id="AgentKnowledgeManager-205"><a href="#AgentKnowledgeManager-205"><span class="linenos">205</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-206"><a href="#AgentKnowledgeManager-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a user preference.</span>
</span><span id="AgentKnowledgeManager-207"><a href="#AgentKnowledgeManager-207"><span class="linenos">207</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-208"><a href="#AgentKnowledgeManager-208"><span class="linenos">208</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-209"><a href="#AgentKnowledgeManager-209"><span class="linenos">209</span></a><span class="sd">            category: Preference category</span>
</span><span id="AgentKnowledgeManager-210"><a href="#AgentKnowledgeManager-210"><span class="linenos">210</span></a><span class="sd">            key: Preference key</span>
</span><span id="AgentKnowledgeManager-211"><a href="#AgentKnowledgeManager-211"><span class="linenos">211</span></a><span class="sd">            default: Default value if preference doesn&#39;t exist</span>
</span><span id="AgentKnowledgeManager-212"><a href="#AgentKnowledgeManager-212"><span class="linenos">212</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-213"><a href="#AgentKnowledgeManager-213"><span class="linenos">213</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-214"><a href="#AgentKnowledgeManager-214"><span class="linenos">214</span></a><span class="sd">            Preference value or default</span>
</span><span id="AgentKnowledgeManager-215"><a href="#AgentKnowledgeManager-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-216"><a href="#AgentKnowledgeManager-216"><span class="linenos">216</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-217"><a href="#AgentKnowledgeManager-217"><span class="linenos">217</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-218"><a href="#AgentKnowledgeManager-218"><span class="linenos">218</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-219"><a href="#AgentKnowledgeManager-219"><span class="linenos">219</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting preference: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-220"><a href="#AgentKnowledgeManager-220"><span class="linenos">220</span></a>            <span class="k">return</span> <span class="n">default</span>
</span><span id="AgentKnowledgeManager-221"><a href="#AgentKnowledgeManager-221"><span class="linenos">221</span></a>            
</span><span id="AgentKnowledgeManager-222"><a href="#AgentKnowledgeManager-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_preferences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-223"><a href="#AgentKnowledgeManager-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all preferences, optionally filtered by category.</span>
</span><span id="AgentKnowledgeManager-224"><a href="#AgentKnowledgeManager-224"><span class="linenos">224</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-225"><a href="#AgentKnowledgeManager-225"><span class="linenos">225</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-226"><a href="#AgentKnowledgeManager-226"><span class="linenos">226</span></a><span class="sd">            category: Optional category to filter by</span>
</span><span id="AgentKnowledgeManager-227"><a href="#AgentKnowledgeManager-227"><span class="linenos">227</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-228"><a href="#AgentKnowledgeManager-228"><span class="linenos">228</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-229"><a href="#AgentKnowledgeManager-229"><span class="linenos">229</span></a><span class="sd">            Dictionary of preferences</span>
</span><span id="AgentKnowledgeManager-230"><a href="#AgentKnowledgeManager-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-231"><a href="#AgentKnowledgeManager-231"><span class="linenos">231</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-232"><a href="#AgentKnowledgeManager-232"><span class="linenos">232</span></a>            <span class="k">if</span> <span class="n">category</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-233"><a href="#AgentKnowledgeManager-233"><span class="linenos">233</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="AgentKnowledgeManager-234"><a href="#AgentKnowledgeManager-234"><span class="linenos">234</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-235"><a href="#AgentKnowledgeManager-235"><span class="linenos">235</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-236"><a href="#AgentKnowledgeManager-236"><span class="linenos">236</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-237"><a href="#AgentKnowledgeManager-237"><span class="linenos">237</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting all preferences: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-238"><a href="#AgentKnowledgeManager-238"><span class="linenos">238</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="AgentKnowledgeManager-239"><a href="#AgentKnowledgeManager-239"><span class="linenos">239</span></a>            
</span><span id="AgentKnowledgeManager-240"><a href="#AgentKnowledgeManager-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-241"><a href="#AgentKnowledgeManager-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an entity to the knowledge base.</span>
</span><span id="AgentKnowledgeManager-242"><a href="#AgentKnowledgeManager-242"><span class="linenos">242</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-243"><a href="#AgentKnowledgeManager-243"><span class="linenos">243</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-244"><a href="#AgentKnowledgeManager-244"><span class="linenos">244</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager-245"><a href="#AgentKnowledgeManager-245"><span class="linenos">245</span></a><span class="sd">            entity_type: Type of the entity (person, place, thing, etc.)</span>
</span><span id="AgentKnowledgeManager-246"><a href="#AgentKnowledgeManager-246"><span class="linenos">246</span></a><span class="sd">            properties: Optional properties of the entity</span>
</span><span id="AgentKnowledgeManager-247"><a href="#AgentKnowledgeManager-247"><span class="linenos">247</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-248"><a href="#AgentKnowledgeManager-248"><span class="linenos">248</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-249"><a href="#AgentKnowledgeManager-249"><span class="linenos">249</span></a><span class="sd">            True if entity was added successfully</span>
</span><span id="AgentKnowledgeManager-250"><a href="#AgentKnowledgeManager-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-251"><a href="#AgentKnowledgeManager-251"><span class="linenos">251</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-252"><a href="#AgentKnowledgeManager-252"><span class="linenos">252</span></a>            <span class="c1"># Create entity object</span>
</span><span id="AgentKnowledgeManager-253"><a href="#AgentKnowledgeManager-253"><span class="linenos">253</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager-254"><a href="#AgentKnowledgeManager-254"><span class="linenos">254</span></a>            <span class="n">entity_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-255"><a href="#AgentKnowledgeManager-255"><span class="linenos">255</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-256"><a href="#AgentKnowledgeManager-256"><span class="linenos">256</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-257"><a href="#AgentKnowledgeManager-257"><span class="linenos">257</span></a>                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager-258"><a href="#AgentKnowledgeManager-258"><span class="linenos">258</span></a>                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="AgentKnowledgeManager-259"><a href="#AgentKnowledgeManager-259"><span class="linenos">259</span></a>                <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-260"><a href="#AgentKnowledgeManager-260"><span class="linenos">260</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-261"><a href="#AgentKnowledgeManager-261"><span class="linenos">261</span></a>            
</span><span id="AgentKnowledgeManager-262"><a href="#AgentKnowledgeManager-262"><span class="linenos">262</span></a>            <span class="c1"># Add to knowledge base</span>
</span><span id="AgentKnowledgeManager-263"><a href="#AgentKnowledgeManager-263"><span class="linenos">263</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">][</span><span class="n">entity_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_obj</span>
</span><span id="AgentKnowledgeManager-264"><a href="#AgentKnowledgeManager-264"><span class="linenos">264</span></a>            
</span><span id="AgentKnowledgeManager-265"><a href="#AgentKnowledgeManager-265"><span class="linenos">265</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager-266"><a href="#AgentKnowledgeManager-266"><span class="linenos">266</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-267"><a href="#AgentKnowledgeManager-267"><span class="linenos">267</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-268"><a href="#AgentKnowledgeManager-268"><span class="linenos">268</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding entity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-269"><a href="#AgentKnowledgeManager-269"><span class="linenos">269</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-270"><a href="#AgentKnowledgeManager-270"><span class="linenos">270</span></a>            
</span><span id="AgentKnowledgeManager-271"><a href="#AgentKnowledgeManager-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-272"><a href="#AgentKnowledgeManager-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an entity from the knowledge base.</span>
</span><span id="AgentKnowledgeManager-273"><a href="#AgentKnowledgeManager-273"><span class="linenos">273</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-274"><a href="#AgentKnowledgeManager-274"><span class="linenos">274</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-275"><a href="#AgentKnowledgeManager-275"><span class="linenos">275</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager-276"><a href="#AgentKnowledgeManager-276"><span class="linenos">276</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-277"><a href="#AgentKnowledgeManager-277"><span class="linenos">277</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-278"><a href="#AgentKnowledgeManager-278"><span class="linenos">278</span></a><span class="sd">            Entity object or None if not found</span>
</span><span id="AgentKnowledgeManager-279"><a href="#AgentKnowledgeManager-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-280"><a href="#AgentKnowledgeManager-280"><span class="linenos">280</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-281"><a href="#AgentKnowledgeManager-281"><span class="linenos">281</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-282"><a href="#AgentKnowledgeManager-282"><span class="linenos">282</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-283"><a href="#AgentKnowledgeManager-283"><span class="linenos">283</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting entity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-284"><a href="#AgentKnowledgeManager-284"><span class="linenos">284</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="AgentKnowledgeManager-285"><a href="#AgentKnowledgeManager-285"><span class="linenos">285</span></a>            
</span><span id="AgentKnowledgeManager-286"><a href="#AgentKnowledgeManager-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-287"><a href="#AgentKnowledgeManager-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an entity&#39;s properties.</span>
</span><span id="AgentKnowledgeManager-288"><a href="#AgentKnowledgeManager-288"><span class="linenos">288</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-289"><a href="#AgentKnowledgeManager-289"><span class="linenos">289</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-290"><a href="#AgentKnowledgeManager-290"><span class="linenos">290</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager-291"><a href="#AgentKnowledgeManager-291"><span class="linenos">291</span></a><span class="sd">            properties: Properties to update</span>
</span><span id="AgentKnowledgeManager-292"><a href="#AgentKnowledgeManager-292"><span class="linenos">292</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-293"><a href="#AgentKnowledgeManager-293"><span class="linenos">293</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-294"><a href="#AgentKnowledgeManager-294"><span class="linenos">294</span></a><span class="sd">            True if entity was updated successfully</span>
</span><span id="AgentKnowledgeManager-295"><a href="#AgentKnowledgeManager-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-296"><a href="#AgentKnowledgeManager-296"><span class="linenos">296</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-297"><a href="#AgentKnowledgeManager-297"><span class="linenos">297</span></a>            <span class="c1"># Check if entity exists</span>
</span><span id="AgentKnowledgeManager-298"><a href="#AgentKnowledgeManager-298"><span class="linenos">298</span></a>            <span class="k">if</span> <span class="n">entity_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-299"><a href="#AgentKnowledgeManager-299"><span class="linenos">299</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-300"><a href="#AgentKnowledgeManager-300"><span class="linenos">300</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-301"><a href="#AgentKnowledgeManager-301"><span class="linenos">301</span></a>                
</span><span id="AgentKnowledgeManager-302"><a href="#AgentKnowledgeManager-302"><span class="linenos">302</span></a>            <span class="c1"># Update properties</span>
</span><span id="AgentKnowledgeManager-303"><a href="#AgentKnowledgeManager-303"><span class="linenos">303</span></a>            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">][</span><span class="n">entity_name</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-304"><a href="#AgentKnowledgeManager-304"><span class="linenos">304</span></a>            <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-305"><a href="#AgentKnowledgeManager-305"><span class="linenos">305</span></a>            
</span><span id="AgentKnowledgeManager-306"><a href="#AgentKnowledgeManager-306"><span class="linenos">306</span></a>            <span class="c1"># Update the last_updated timestamp</span>
</span><span id="AgentKnowledgeManager-307"><a href="#AgentKnowledgeManager-307"><span class="linenos">307</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager-308"><a href="#AgentKnowledgeManager-308"><span class="linenos">308</span></a>            <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-309"><a href="#AgentKnowledgeManager-309"><span class="linenos">309</span></a>            
</span><span id="AgentKnowledgeManager-310"><a href="#AgentKnowledgeManager-310"><span class="linenos">310</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager-311"><a href="#AgentKnowledgeManager-311"><span class="linenos">311</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-312"><a href="#AgentKnowledgeManager-312"><span class="linenos">312</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-313"><a href="#AgentKnowledgeManager-313"><span class="linenos">313</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating entity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-314"><a href="#AgentKnowledgeManager-314"><span class="linenos">314</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-315"><a href="#AgentKnowledgeManager-315"><span class="linenos">315</span></a>            
</span><span id="AgentKnowledgeManager-316"><a href="#AgentKnowledgeManager-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-317"><a href="#AgentKnowledgeManager-317"><span class="linenos">317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a relationship between entities.</span>
</span><span id="AgentKnowledgeManager-318"><a href="#AgentKnowledgeManager-318"><span class="linenos">318</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-319"><a href="#AgentKnowledgeManager-319"><span class="linenos">319</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-320"><a href="#AgentKnowledgeManager-320"><span class="linenos">320</span></a><span class="sd">            entity1: First entity name</span>
</span><span id="AgentKnowledgeManager-321"><a href="#AgentKnowledgeManager-321"><span class="linenos">321</span></a><span class="sd">            relation: Relationship type</span>
</span><span id="AgentKnowledgeManager-322"><a href="#AgentKnowledgeManager-322"><span class="linenos">322</span></a><span class="sd">            entity2: Second entity name</span>
</span><span id="AgentKnowledgeManager-323"><a href="#AgentKnowledgeManager-323"><span class="linenos">323</span></a><span class="sd">            properties: Optional properties of the relationship</span>
</span><span id="AgentKnowledgeManager-324"><a href="#AgentKnowledgeManager-324"><span class="linenos">324</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-325"><a href="#AgentKnowledgeManager-325"><span class="linenos">325</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-326"><a href="#AgentKnowledgeManager-326"><span class="linenos">326</span></a><span class="sd">            True if relationship was added successfully</span>
</span><span id="AgentKnowledgeManager-327"><a href="#AgentKnowledgeManager-327"><span class="linenos">327</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-328"><a href="#AgentKnowledgeManager-328"><span class="linenos">328</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-329"><a href="#AgentKnowledgeManager-329"><span class="linenos">329</span></a>            <span class="c1"># Create relationship object</span>
</span><span id="AgentKnowledgeManager-330"><a href="#AgentKnowledgeManager-330"><span class="linenos">330</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager-331"><a href="#AgentKnowledgeManager-331"><span class="linenos">331</span></a>            <span class="n">rel_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-332"><a href="#AgentKnowledgeManager-332"><span class="linenos">332</span></a>                <span class="s2">&quot;entity1&quot;</span><span class="p">:</span> <span class="n">entity1</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-333"><a href="#AgentKnowledgeManager-333"><span class="linenos">333</span></a>                <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-334"><a href="#AgentKnowledgeManager-334"><span class="linenos">334</span></a>                <span class="s2">&quot;entity2&quot;</span><span class="p">:</span> <span class="n">entity2</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-335"><a href="#AgentKnowledgeManager-335"><span class="linenos">335</span></a>                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager-336"><a href="#AgentKnowledgeManager-336"><span class="linenos">336</span></a>                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-337"><a href="#AgentKnowledgeManager-337"><span class="linenos">337</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-338"><a href="#AgentKnowledgeManager-338"><span class="linenos">338</span></a>            
</span><span id="AgentKnowledgeManager-339"><a href="#AgentKnowledgeManager-339"><span class="linenos">339</span></a>            <span class="c1"># Add to knowledge base</span>
</span><span id="AgentKnowledgeManager-340"><a href="#AgentKnowledgeManager-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;relationships&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel_obj</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-341"><a href="#AgentKnowledgeManager-341"><span class="linenos">341</span></a>            
</span><span id="AgentKnowledgeManager-342"><a href="#AgentKnowledgeManager-342"><span class="linenos">342</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager-343"><a href="#AgentKnowledgeManager-343"><span class="linenos">343</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-344"><a href="#AgentKnowledgeManager-344"><span class="linenos">344</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-345"><a href="#AgentKnowledgeManager-345"><span class="linenos">345</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding relationship: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-346"><a href="#AgentKnowledgeManager-346"><span class="linenos">346</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-347"><a href="#AgentKnowledgeManager-347"><span class="linenos">347</span></a>            
</span><span id="AgentKnowledgeManager-348"><a href="#AgentKnowledgeManager-348"><span class="linenos">348</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-349"><a href="#AgentKnowledgeManager-349"><span class="linenos">349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get relationships, optionally filtered by entity or relation type.</span>
</span><span id="AgentKnowledgeManager-350"><a href="#AgentKnowledgeManager-350"><span class="linenos">350</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-351"><a href="#AgentKnowledgeManager-351"><span class="linenos">351</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-352"><a href="#AgentKnowledgeManager-352"><span class="linenos">352</span></a><span class="sd">            entity: Optional entity to filter by (either entity1 or entity2)</span>
</span><span id="AgentKnowledgeManager-353"><a href="#AgentKnowledgeManager-353"><span class="linenos">353</span></a><span class="sd">            relation: Optional relation type to filter by</span>
</span><span id="AgentKnowledgeManager-354"><a href="#AgentKnowledgeManager-354"><span class="linenos">354</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-355"><a href="#AgentKnowledgeManager-355"><span class="linenos">355</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-356"><a href="#AgentKnowledgeManager-356"><span class="linenos">356</span></a><span class="sd">            List of relationship objects</span>
</span><span id="AgentKnowledgeManager-357"><a href="#AgentKnowledgeManager-357"><span class="linenos">357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-358"><a href="#AgentKnowledgeManager-358"><span class="linenos">358</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-359"><a href="#AgentKnowledgeManager-359"><span class="linenos">359</span></a>            <span class="n">relationships</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;relationships&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-360"><a href="#AgentKnowledgeManager-360"><span class="linenos">360</span></a>            
</span><span id="AgentKnowledgeManager-361"><a href="#AgentKnowledgeManager-361"><span class="linenos">361</span></a>            <span class="c1"># Apply filters</span>
</span><span id="AgentKnowledgeManager-362"><a href="#AgentKnowledgeManager-362"><span class="linenos">362</span></a>            <span class="k">if</span> <span class="n">entity</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-363"><a href="#AgentKnowledgeManager-363"><span class="linenos">363</span></a>                <span class="n">relationships</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentKnowledgeManager-364"><a href="#AgentKnowledgeManager-364"><span class="linenos">364</span></a>                    <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relationships</span> 
</span><span id="AgentKnowledgeManager-365"><a href="#AgentKnowledgeManager-365"><span class="linenos">365</span></a>                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entity1&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">entity</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entity2&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">entity</span>
</span><span id="AgentKnowledgeManager-366"><a href="#AgentKnowledgeManager-366"><span class="linenos">366</span></a>                <span class="p">]</span>
</span><span id="AgentKnowledgeManager-367"><a href="#AgentKnowledgeManager-367"><span class="linenos">367</span></a>                
</span><span id="AgentKnowledgeManager-368"><a href="#AgentKnowledgeManager-368"><span class="linenos">368</span></a>            <span class="k">if</span> <span class="n">relation</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-369"><a href="#AgentKnowledgeManager-369"><span class="linenos">369</span></a>                <span class="n">relationships</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relationships</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relation&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">relation</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-370"><a href="#AgentKnowledgeManager-370"><span class="linenos">370</span></a>                
</span><span id="AgentKnowledgeManager-371"><a href="#AgentKnowledgeManager-371"><span class="linenos">371</span></a>            <span class="k">return</span> <span class="n">relationships</span>
</span><span id="AgentKnowledgeManager-372"><a href="#AgentKnowledgeManager-372"><span class="linenos">372</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-373"><a href="#AgentKnowledgeManager-373"><span class="linenos">373</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting relationships: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-374"><a href="#AgentKnowledgeManager-374"><span class="linenos">374</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="AgentKnowledgeManager-375"><a href="#AgentKnowledgeManager-375"><span class="linenos">375</span></a>            
</span><span id="AgentKnowledgeManager-376"><a href="#AgentKnowledgeManager-376"><span class="linenos">376</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_knowledge_base</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-377"><a href="#AgentKnowledgeManager-377"><span class="linenos">377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the entire knowledge base.</span>
</span><span id="AgentKnowledgeManager-378"><a href="#AgentKnowledgeManager-378"><span class="linenos">378</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-379"><a href="#AgentKnowledgeManager-379"><span class="linenos">379</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-380"><a href="#AgentKnowledgeManager-380"><span class="linenos">380</span></a><span class="sd">            True if knowledge base was cleared successfully</span>
</span><span id="AgentKnowledgeManager-381"><a href="#AgentKnowledgeManager-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-382"><a href="#AgentKnowledgeManager-382"><span class="linenos">382</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-383"><a href="#AgentKnowledgeManager-383"><span class="linenos">383</span></a>            <span class="c1"># Reset to empty structure</span>
</span><span id="AgentKnowledgeManager-384"><a href="#AgentKnowledgeManager-384"><span class="linenos">384</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-385"><a href="#AgentKnowledgeManager-385"><span class="linenos">385</span></a>                <span class="s2">&quot;facts&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="AgentKnowledgeManager-386"><a href="#AgentKnowledgeManager-386"><span class="linenos">386</span></a>                <span class="s2">&quot;preferences&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager-387"><a href="#AgentKnowledgeManager-387"><span class="linenos">387</span></a>                <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager-388"><a href="#AgentKnowledgeManager-388"><span class="linenos">388</span></a>                <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="AgentKnowledgeManager-389"><a href="#AgentKnowledgeManager-389"><span class="linenos">389</span></a>                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-390"><a href="#AgentKnowledgeManager-390"><span class="linenos">390</span></a>                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-391"><a href="#AgentKnowledgeManager-391"><span class="linenos">391</span></a>                    <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="kc">None</span>
</span><span id="AgentKnowledgeManager-392"><a href="#AgentKnowledgeManager-392"><span class="linenos">392</span></a>                <span class="p">}</span>
</span><span id="AgentKnowledgeManager-393"><a href="#AgentKnowledgeManager-393"><span class="linenos">393</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-394"><a href="#AgentKnowledgeManager-394"><span class="linenos">394</span></a>            
</span><span id="AgentKnowledgeManager-395"><a href="#AgentKnowledgeManager-395"><span class="linenos">395</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager-396"><a href="#AgentKnowledgeManager-396"><span class="linenos">396</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-397"><a href="#AgentKnowledgeManager-397"><span class="linenos">397</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-398"><a href="#AgentKnowledgeManager-398"><span class="linenos">398</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error clearing knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-399"><a href="#AgentKnowledgeManager-399"><span class="linenos">399</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-400"><a href="#AgentKnowledgeManager-400"><span class="linenos">400</span></a>            
</span><span id="AgentKnowledgeManager-401"><a href="#AgentKnowledgeManager-401"><span class="linenos">401</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">sync_with_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-402"><a href="#AgentKnowledgeManager-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Synchronize the local knowledge base with the graph database.</span>
</span><span id="AgentKnowledgeManager-403"><a href="#AgentKnowledgeManager-403"><span class="linenos">403</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-404"><a href="#AgentKnowledgeManager-404"><span class="linenos">404</span></a><span class="sd">        This method syncs entities and relationships from the local knowledge base</span>
</span><span id="AgentKnowledgeManager-405"><a href="#AgentKnowledgeManager-405"><span class="linenos">405</span></a><span class="sd">        to the LightRAG graph database.</span>
</span><span id="AgentKnowledgeManager-406"><a href="#AgentKnowledgeManager-406"><span class="linenos">406</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-407"><a href="#AgentKnowledgeManager-407"><span class="linenos">407</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-408"><a href="#AgentKnowledgeManager-408"><span class="linenos">408</span></a><span class="sd">            Status message</span>
</span><span id="AgentKnowledgeManager-409"><a href="#AgentKnowledgeManager-409"><span class="linenos">409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-410"><a href="#AgentKnowledgeManager-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-411"><a href="#AgentKnowledgeManager-411"><span class="linenos">411</span></a>            <span class="k">return</span> <span class="s2">&quot;Graph sync not available: LightRAG memory URL not configured&quot;</span>
</span><span id="AgentKnowledgeManager-412"><a href="#AgentKnowledgeManager-412"><span class="linenos">412</span></a>            
</span><span id="AgentKnowledgeManager-413"><a href="#AgentKnowledgeManager-413"><span class="linenos">413</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-414"><a href="#AgentKnowledgeManager-414"><span class="linenos">414</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentKnowledgeManager-415"><a href="#AgentKnowledgeManager-415"><span class="linenos">415</span></a>            
</span><span id="AgentKnowledgeManager-416"><a href="#AgentKnowledgeManager-416"><span class="linenos">416</span></a>            <span class="c1"># 1. Sync entities</span>
</span><span id="AgentKnowledgeManager-417"><a href="#AgentKnowledgeManager-417"><span class="linenos">417</span></a>            <span class="k">for</span> <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentKnowledgeManager-418"><a href="#AgentKnowledgeManager-418"><span class="linenos">418</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-419"><a href="#AgentKnowledgeManager-419"><span class="linenos">419</span></a>                    <span class="c1"># Check if entity exists in graph</span>
</span><span id="AgentKnowledgeManager-420"><a href="#AgentKnowledgeManager-420"><span class="linenos">420</span></a>                    <span class="n">entity_exists</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_entity_exists</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-421"><a href="#AgentKnowledgeManager-421"><span class="linenos">421</span></a>                    
</span><span id="AgentKnowledgeManager-422"><a href="#AgentKnowledgeManager-422"><span class="linenos">422</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_exists</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-423"><a href="#AgentKnowledgeManager-423"><span class="linenos">423</span></a>                        <span class="c1"># Create entity in graph</span>
</span><span id="AgentKnowledgeManager-424"><a href="#AgentKnowledgeManager-424"><span class="linenos">424</span></a>                        <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_graph_entity</span><span class="p">(</span>
</span><span id="AgentKnowledgeManager-425"><a href="#AgentKnowledgeManager-425"><span class="linenos">425</span></a>                            <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-426"><a href="#AgentKnowledgeManager-426"><span class="linenos">426</span></a>                        <span class="p">)</span>
</span><span id="AgentKnowledgeManager-427"><a href="#AgentKnowledgeManager-427"><span class="linenos">427</span></a>                        
</span><span id="AgentKnowledgeManager-428"><a href="#AgentKnowledgeManager-428"><span class="linenos">428</span></a>                        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-429"><a href="#AgentKnowledgeManager-429"><span class="linenos">429</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-430"><a href="#AgentKnowledgeManager-430"><span class="linenos">430</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-431"><a href="#AgentKnowledgeManager-431"><span class="linenos">431</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-432"><a href="#AgentKnowledgeManager-432"><span class="linenos">432</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-433"><a href="#AgentKnowledgeManager-433"><span class="linenos">433</span></a>                        <span class="c1"># Update entity in graph</span>
</span><span id="AgentKnowledgeManager-434"><a href="#AgentKnowledgeManager-434"><span class="linenos">434</span></a>                        <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_graph_entity</span><span class="p">(</span>
</span><span id="AgentKnowledgeManager-435"><a href="#AgentKnowledgeManager-435"><span class="linenos">435</span></a>                            <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-436"><a href="#AgentKnowledgeManager-436"><span class="linenos">436</span></a>                        <span class="p">)</span>
</span><span id="AgentKnowledgeManager-437"><a href="#AgentKnowledgeManager-437"><span class="linenos">437</span></a>                        
</span><span id="AgentKnowledgeManager-438"><a href="#AgentKnowledgeManager-438"><span class="linenos">438</span></a>                        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-439"><a href="#AgentKnowledgeManager-439"><span class="linenos">439</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-440"><a href="#AgentKnowledgeManager-440"><span class="linenos">440</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-441"><a href="#AgentKnowledgeManager-441"><span class="linenos">441</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-442"><a href="#AgentKnowledgeManager-442"><span class="linenos">442</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-443"><a href="#AgentKnowledgeManager-443"><span class="linenos">443</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-444"><a href="#AgentKnowledgeManager-444"><span class="linenos">444</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-445"><a href="#AgentKnowledgeManager-445"><span class="linenos">445</span></a>                    
</span><span id="AgentKnowledgeManager-446"><a href="#AgentKnowledgeManager-446"><span class="linenos">446</span></a>            <span class="c1"># 2. Sync relationships</span>
</span><span id="AgentKnowledgeManager-447"><a href="#AgentKnowledgeManager-447"><span class="linenos">447</span></a>            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;relationships&quot;</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-448"><a href="#AgentKnowledgeManager-448"><span class="linenos">448</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-449"><a href="#AgentKnowledgeManager-449"><span class="linenos">449</span></a>                    <span class="c1"># Create relationship in graph</span>
</span><span id="AgentKnowledgeManager-450"><a href="#AgentKnowledgeManager-450"><span class="linenos">450</span></a>                    <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_graph_relationship</span><span class="p">(</span>
</span><span id="AgentKnowledgeManager-451"><a href="#AgentKnowledgeManager-451"><span class="linenos">451</span></a>                        <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;entity1&quot;</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;relation&quot;</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;entity2&quot;</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager-452"><a href="#AgentKnowledgeManager-452"><span class="linenos">452</span></a>                    <span class="p">)</span>
</span><span id="AgentKnowledgeManager-453"><a href="#AgentKnowledgeManager-453"><span class="linenos">453</span></a>                    
</span><span id="AgentKnowledgeManager-454"><a href="#AgentKnowledgeManager-454"><span class="linenos">454</span></a>                    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-455"><a href="#AgentKnowledgeManager-455"><span class="linenos">455</span></a>                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created relationship: </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;entity1&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;relation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;entity2&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-456"><a href="#AgentKnowledgeManager-456"><span class="linenos">456</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-457"><a href="#AgentKnowledgeManager-457"><span class="linenos">457</span></a>                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create relationship: </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;entity1&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;relation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;entity2&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-458"><a href="#AgentKnowledgeManager-458"><span class="linenos">458</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-459"><a href="#AgentKnowledgeManager-459"><span class="linenos">459</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing relationship: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-460"><a href="#AgentKnowledgeManager-460"><span class="linenos">460</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing relationship: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-461"><a href="#AgentKnowledgeManager-461"><span class="linenos">461</span></a>                    
</span><span id="AgentKnowledgeManager-462"><a href="#AgentKnowledgeManager-462"><span class="linenos">462</span></a>            <span class="c1"># Return combined results</span>
</span><span id="AgentKnowledgeManager-463"><a href="#AgentKnowledgeManager-463"><span class="linenos">463</span></a>            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-464"><a href="#AgentKnowledgeManager-464"><span class="linenos">464</span></a>            
</span><span id="AgentKnowledgeManager-465"><a href="#AgentKnowledgeManager-465"><span class="linenos">465</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-466"><a href="#AgentKnowledgeManager-466"><span class="linenos">466</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing with graph: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-467"><a href="#AgentKnowledgeManager-467"><span class="linenos">467</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error syncing with graph: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentKnowledgeManager-468"><a href="#AgentKnowledgeManager-468"><span class="linenos">468</span></a>            
</span><span id="AgentKnowledgeManager-469"><a href="#AgentKnowledgeManager-469"><span class="linenos">469</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_entity_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-470"><a href="#AgentKnowledgeManager-470"><span class="linenos">470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if entity exists in the graph.</span>
</span><span id="AgentKnowledgeManager-471"><a href="#AgentKnowledgeManager-471"><span class="linenos">471</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-472"><a href="#AgentKnowledgeManager-472"><span class="linenos">472</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-473"><a href="#AgentKnowledgeManager-473"><span class="linenos">473</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager-474"><a href="#AgentKnowledgeManager-474"><span class="linenos">474</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-475"><a href="#AgentKnowledgeManager-475"><span class="linenos">475</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-476"><a href="#AgentKnowledgeManager-476"><span class="linenos">476</span></a><span class="sd">            True if entity exists</span>
</span><span id="AgentKnowledgeManager-477"><a href="#AgentKnowledgeManager-477"><span class="linenos">477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-478"><a href="#AgentKnowledgeManager-478"><span class="linenos">478</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-479"><a href="#AgentKnowledgeManager-479"><span class="linenos">479</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/entity/exists&quot;</span>
</span><span id="AgentKnowledgeManager-480"><a href="#AgentKnowledgeManager-480"><span class="linenos">480</span></a>            
</span><span id="AgentKnowledgeManager-481"><a href="#AgentKnowledgeManager-481"><span class="linenos">481</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-482"><a href="#AgentKnowledgeManager-482"><span class="linenos">482</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;entity_name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-483"><a href="#AgentKnowledgeManager-483"><span class="linenos">483</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-484"><a href="#AgentKnowledgeManager-484"><span class="linenos">484</span></a>                        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-485"><a href="#AgentKnowledgeManager-485"><span class="linenos">485</span></a>                        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exists&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-486"><a href="#AgentKnowledgeManager-486"><span class="linenos">486</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-487"><a href="#AgentKnowledgeManager-487"><span class="linenos">487</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check entity existence: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-488"><a href="#AgentKnowledgeManager-488"><span class="linenos">488</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-489"><a href="#AgentKnowledgeManager-489"><span class="linenos">489</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-490"><a href="#AgentKnowledgeManager-490"><span class="linenos">490</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking entity existence: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-491"><a href="#AgentKnowledgeManager-491"><span class="linenos">491</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-492"><a href="#AgentKnowledgeManager-492"><span class="linenos">492</span></a>            
</span><span id="AgentKnowledgeManager-493"><a href="#AgentKnowledgeManager-493"><span class="linenos">493</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_create_graph_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-494"><a href="#AgentKnowledgeManager-494"><span class="linenos">494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an entity in the graph.</span>
</span><span id="AgentKnowledgeManager-495"><a href="#AgentKnowledgeManager-495"><span class="linenos">495</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-496"><a href="#AgentKnowledgeManager-496"><span class="linenos">496</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-497"><a href="#AgentKnowledgeManager-497"><span class="linenos">497</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager-498"><a href="#AgentKnowledgeManager-498"><span class="linenos">498</span></a><span class="sd">            entity_type: Type of the entity</span>
</span><span id="AgentKnowledgeManager-499"><a href="#AgentKnowledgeManager-499"><span class="linenos">499</span></a><span class="sd">            properties: Properties of the entity</span>
</span><span id="AgentKnowledgeManager-500"><a href="#AgentKnowledgeManager-500"><span class="linenos">500</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-501"><a href="#AgentKnowledgeManager-501"><span class="linenos">501</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-502"><a href="#AgentKnowledgeManager-502"><span class="linenos">502</span></a><span class="sd">            True if entity was created successfully</span>
</span><span id="AgentKnowledgeManager-503"><a href="#AgentKnowledgeManager-503"><span class="linenos">503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-504"><a href="#AgentKnowledgeManager-504"><span class="linenos">504</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-505"><a href="#AgentKnowledgeManager-505"><span class="linenos">505</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/entity/create&quot;</span>
</span><span id="AgentKnowledgeManager-506"><a href="#AgentKnowledgeManager-506"><span class="linenos">506</span></a>            
</span><span id="AgentKnowledgeManager-507"><a href="#AgentKnowledgeManager-507"><span class="linenos">507</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-508"><a href="#AgentKnowledgeManager-508"><span class="linenos">508</span></a>                <span class="s2">&quot;entity_name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-509"><a href="#AgentKnowledgeManager-509"><span class="linenos">509</span></a>                <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-510"><a href="#AgentKnowledgeManager-510"><span class="linenos">510</span></a>                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span>
</span><span id="AgentKnowledgeManager-511"><a href="#AgentKnowledgeManager-511"><span class="linenos">511</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-512"><a href="#AgentKnowledgeManager-512"><span class="linenos">512</span></a>            
</span><span id="AgentKnowledgeManager-513"><a href="#AgentKnowledgeManager-513"><span class="linenos">513</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-514"><a href="#AgentKnowledgeManager-514"><span class="linenos">514</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-515"><a href="#AgentKnowledgeManager-515"><span class="linenos">515</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-516"><a href="#AgentKnowledgeManager-516"><span class="linenos">516</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created entity in graph: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-517"><a href="#AgentKnowledgeManager-517"><span class="linenos">517</span></a>                        <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentKnowledgeManager-518"><a href="#AgentKnowledgeManager-518"><span class="linenos">518</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-519"><a href="#AgentKnowledgeManager-519"><span class="linenos">519</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-520"><a href="#AgentKnowledgeManager-520"><span class="linenos">520</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create entity in graph: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-521"><a href="#AgentKnowledgeManager-521"><span class="linenos">521</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-522"><a href="#AgentKnowledgeManager-522"><span class="linenos">522</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-523"><a href="#AgentKnowledgeManager-523"><span class="linenos">523</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating graph entity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-524"><a href="#AgentKnowledgeManager-524"><span class="linenos">524</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-525"><a href="#AgentKnowledgeManager-525"><span class="linenos">525</span></a>            
</span><span id="AgentKnowledgeManager-526"><a href="#AgentKnowledgeManager-526"><span class="linenos">526</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_update_graph_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-527"><a href="#AgentKnowledgeManager-527"><span class="linenos">527</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an entity in the graph.</span>
</span><span id="AgentKnowledgeManager-528"><a href="#AgentKnowledgeManager-528"><span class="linenos">528</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-529"><a href="#AgentKnowledgeManager-529"><span class="linenos">529</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-530"><a href="#AgentKnowledgeManager-530"><span class="linenos">530</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager-531"><a href="#AgentKnowledgeManager-531"><span class="linenos">531</span></a><span class="sd">            properties: Properties to update</span>
</span><span id="AgentKnowledgeManager-532"><a href="#AgentKnowledgeManager-532"><span class="linenos">532</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-533"><a href="#AgentKnowledgeManager-533"><span class="linenos">533</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-534"><a href="#AgentKnowledgeManager-534"><span class="linenos">534</span></a><span class="sd">            True if entity was updated successfully</span>
</span><span id="AgentKnowledgeManager-535"><a href="#AgentKnowledgeManager-535"><span class="linenos">535</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-536"><a href="#AgentKnowledgeManager-536"><span class="linenos">536</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-537"><a href="#AgentKnowledgeManager-537"><span class="linenos">537</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/entity/update&quot;</span>
</span><span id="AgentKnowledgeManager-538"><a href="#AgentKnowledgeManager-538"><span class="linenos">538</span></a>            
</span><span id="AgentKnowledgeManager-539"><a href="#AgentKnowledgeManager-539"><span class="linenos">539</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-540"><a href="#AgentKnowledgeManager-540"><span class="linenos">540</span></a>                <span class="s2">&quot;entity_name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-541"><a href="#AgentKnowledgeManager-541"><span class="linenos">541</span></a>                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span>
</span><span id="AgentKnowledgeManager-542"><a href="#AgentKnowledgeManager-542"><span class="linenos">542</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-543"><a href="#AgentKnowledgeManager-543"><span class="linenos">543</span></a>            
</span><span id="AgentKnowledgeManager-544"><a href="#AgentKnowledgeManager-544"><span class="linenos">544</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-545"><a href="#AgentKnowledgeManager-545"><span class="linenos">545</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-546"><a href="#AgentKnowledgeManager-546"><span class="linenos">546</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-547"><a href="#AgentKnowledgeManager-547"><span class="linenos">547</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated entity in graph: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-548"><a href="#AgentKnowledgeManager-548"><span class="linenos">548</span></a>                        <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentKnowledgeManager-549"><a href="#AgentKnowledgeManager-549"><span class="linenos">549</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-550"><a href="#AgentKnowledgeManager-550"><span class="linenos">550</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-551"><a href="#AgentKnowledgeManager-551"><span class="linenos">551</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update entity in graph: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-552"><a href="#AgentKnowledgeManager-552"><span class="linenos">552</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-553"><a href="#AgentKnowledgeManager-553"><span class="linenos">553</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-554"><a href="#AgentKnowledgeManager-554"><span class="linenos">554</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating graph entity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-555"><a href="#AgentKnowledgeManager-555"><span class="linenos">555</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-556"><a href="#AgentKnowledgeManager-556"><span class="linenos">556</span></a>            
</span><span id="AgentKnowledgeManager-557"><a href="#AgentKnowledgeManager-557"><span class="linenos">557</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_create_graph_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-558"><a href="#AgentKnowledgeManager-558"><span class="linenos">558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a relationship in the graph.</span>
</span><span id="AgentKnowledgeManager-559"><a href="#AgentKnowledgeManager-559"><span class="linenos">559</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-560"><a href="#AgentKnowledgeManager-560"><span class="linenos">560</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-561"><a href="#AgentKnowledgeManager-561"><span class="linenos">561</span></a><span class="sd">            entity1: First entity name</span>
</span><span id="AgentKnowledgeManager-562"><a href="#AgentKnowledgeManager-562"><span class="linenos">562</span></a><span class="sd">            relation: Relationship type</span>
</span><span id="AgentKnowledgeManager-563"><a href="#AgentKnowledgeManager-563"><span class="linenos">563</span></a><span class="sd">            entity2: Second entity name</span>
</span><span id="AgentKnowledgeManager-564"><a href="#AgentKnowledgeManager-564"><span class="linenos">564</span></a><span class="sd">            properties: Properties of the relationship</span>
</span><span id="AgentKnowledgeManager-565"><a href="#AgentKnowledgeManager-565"><span class="linenos">565</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-566"><a href="#AgentKnowledgeManager-566"><span class="linenos">566</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-567"><a href="#AgentKnowledgeManager-567"><span class="linenos">567</span></a><span class="sd">            True if relationship was created successfully</span>
</span><span id="AgentKnowledgeManager-568"><a href="#AgentKnowledgeManager-568"><span class="linenos">568</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-569"><a href="#AgentKnowledgeManager-569"><span class="linenos">569</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-570"><a href="#AgentKnowledgeManager-570"><span class="linenos">570</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/relationship/create&quot;</span>
</span><span id="AgentKnowledgeManager-571"><a href="#AgentKnowledgeManager-571"><span class="linenos">571</span></a>            
</span><span id="AgentKnowledgeManager-572"><a href="#AgentKnowledgeManager-572"><span class="linenos">572</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-573"><a href="#AgentKnowledgeManager-573"><span class="linenos">573</span></a>                <span class="s2">&quot;entity1&quot;</span><span class="p">:</span> <span class="n">entity1</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-574"><a href="#AgentKnowledgeManager-574"><span class="linenos">574</span></a>                <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-575"><a href="#AgentKnowledgeManager-575"><span class="linenos">575</span></a>                <span class="s2">&quot;entity2&quot;</span><span class="p">:</span> <span class="n">entity2</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager-576"><a href="#AgentKnowledgeManager-576"><span class="linenos">576</span></a>                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span>
</span><span id="AgentKnowledgeManager-577"><a href="#AgentKnowledgeManager-577"><span class="linenos">577</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-578"><a href="#AgentKnowledgeManager-578"><span class="linenos">578</span></a>            
</span><span id="AgentKnowledgeManager-579"><a href="#AgentKnowledgeManager-579"><span class="linenos">579</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-580"><a href="#AgentKnowledgeManager-580"><span class="linenos">580</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-581"><a href="#AgentKnowledgeManager-581"><span class="linenos">581</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager-582"><a href="#AgentKnowledgeManager-582"><span class="linenos">582</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created relationship in graph: </span><span class="si">{</span><span class="n">entity1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">relation</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">entity2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-583"><a href="#AgentKnowledgeManager-583"><span class="linenos">583</span></a>                        <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentKnowledgeManager-584"><a href="#AgentKnowledgeManager-584"><span class="linenos">584</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-585"><a href="#AgentKnowledgeManager-585"><span class="linenos">585</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-586"><a href="#AgentKnowledgeManager-586"><span class="linenos">586</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create relationship in graph: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-587"><a href="#AgentKnowledgeManager-587"><span class="linenos">587</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-588"><a href="#AgentKnowledgeManager-588"><span class="linenos">588</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-589"><a href="#AgentKnowledgeManager-589"><span class="linenos">589</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating graph relationship: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-590"><a href="#AgentKnowledgeManager-590"><span class="linenos">590</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager-591"><a href="#AgentKnowledgeManager-591"><span class="linenos">591</span></a>            
</span><span id="AgentKnowledgeManager-592"><a href="#AgentKnowledgeManager-592"><span class="linenos">592</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-593"><a href="#AgentKnowledgeManager-593"><span class="linenos">593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the graph database.</span>
</span><span id="AgentKnowledgeManager-594"><a href="#AgentKnowledgeManager-594"><span class="linenos">594</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager-595"><a href="#AgentKnowledgeManager-595"><span class="linenos">595</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager-596"><a href="#AgentKnowledgeManager-596"><span class="linenos">596</span></a><span class="sd">            query: Cypher query</span>
</span><span id="AgentKnowledgeManager-597"><a href="#AgentKnowledgeManager-597"><span class="linenos">597</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager-598"><a href="#AgentKnowledgeManager-598"><span class="linenos">598</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager-599"><a href="#AgentKnowledgeManager-599"><span class="linenos">599</span></a><span class="sd">            Query results</span>
</span><span id="AgentKnowledgeManager-600"><a href="#AgentKnowledgeManager-600"><span class="linenos">600</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager-601"><a href="#AgentKnowledgeManager-601"><span class="linenos">601</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-602"><a href="#AgentKnowledgeManager-602"><span class="linenos">602</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/query&quot;</span>
</span><span id="AgentKnowledgeManager-603"><a href="#AgentKnowledgeManager-603"><span class="linenos">603</span></a>            
</span><span id="AgentKnowledgeManager-604"><a href="#AgentKnowledgeManager-604"><span class="linenos">604</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager-605"><a href="#AgentKnowledgeManager-605"><span class="linenos">605</span></a>                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span>
</span><span id="AgentKnowledgeManager-606"><a href="#AgentKnowledgeManager-606"><span class="linenos">606</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager-607"><a href="#AgentKnowledgeManager-607"><span class="linenos">607</span></a>            
</span><span id="AgentKnowledgeManager-608"><a href="#AgentKnowledgeManager-608"><span class="linenos">608</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-609"><a href="#AgentKnowledgeManager-609"><span class="linenos">609</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-610"><a href="#AgentKnowledgeManager-610"><span class="linenos">610</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-611"><a href="#AgentKnowledgeManager-611"><span class="linenos">611</span></a>                        <span class="k">return</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-612"><a href="#AgentKnowledgeManager-612"><span class="linenos">612</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-613"><a href="#AgentKnowledgeManager-613"><span class="linenos">613</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager-614"><a href="#AgentKnowledgeManager-614"><span class="linenos">614</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to query graph: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-615"><a href="#AgentKnowledgeManager-615"><span class="linenos">615</span></a>                        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_text</span><span class="p">}</span>
</span><span id="AgentKnowledgeManager-616"><a href="#AgentKnowledgeManager-616"><span class="linenos">616</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager-617"><a href="#AgentKnowledgeManager-617"><span class="linenos">617</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying graph: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager-618"><a href="#AgentKnowledgeManager-618"><span class="linenos">618</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span></pre></div>


            <div class="docstring"><p>Manages knowledge operations including storage, retrieval, and updates.</p>
</div>


                            <div id="AgentKnowledgeManager.__init__" class="classattr">
                                        <input id="AgentKnowledgeManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AgentKnowledgeManager</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">lightrag_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="AgentKnowledgeManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.__init__-26"><a href="#AgentKnowledgeManager.__init__-26"><span class="linenos">26</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="AgentKnowledgeManager.__init__-27"><a href="#AgentKnowledgeManager.__init__-27"><span class="linenos">27</span></a>                 <span class="n">lightrag_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="AgentKnowledgeManager.__init__-28"><a href="#AgentKnowledgeManager.__init__-28"><span class="linenos">28</span></a>                 <span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AgentKnowledgeManager.__init__-29"><a href="#AgentKnowledgeManager.__init__-29"><span class="linenos">29</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the knowledge manager.</span>
</span><span id="AgentKnowledgeManager.__init__-30"><a href="#AgentKnowledgeManager.__init__-30"><span class="linenos">30</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.__init__-31"><a href="#AgentKnowledgeManager.__init__-31"><span class="linenos">31</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.__init__-32"><a href="#AgentKnowledgeManager.__init__-32"><span class="linenos">32</span></a><span class="sd">            user_id: User identifier for knowledge operations</span>
</span><span id="AgentKnowledgeManager.__init__-33"><a href="#AgentKnowledgeManager.__init__-33"><span class="linenos">33</span></a><span class="sd">            storage_dir: Directory for storage files</span>
</span><span id="AgentKnowledgeManager.__init__-34"><a href="#AgentKnowledgeManager.__init__-34"><span class="linenos">34</span></a><span class="sd">            lightrag_url: Optional URL for LightRAG API</span>
</span><span id="AgentKnowledgeManager.__init__-35"><a href="#AgentKnowledgeManager.__init__-35"><span class="linenos">35</span></a><span class="sd">            lightrag_memory_url: Optional URL for LightRAG Memory API</span>
</span><span id="AgentKnowledgeManager.__init__-36"><a href="#AgentKnowledgeManager.__init__-36"><span class="linenos">36</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.__init__-37"><a href="#AgentKnowledgeManager.__init__-37"><span class="linenos">37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgentKnowledgeManager.__init__-38"><a href="#AgentKnowledgeManager.__init__-38"><span class="linenos">38</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">storage_dir</span>
</span><span id="AgentKnowledgeManager.__init__-39"><a href="#AgentKnowledgeManager.__init__-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_url</span> <span class="o">=</span> <span class="n">lightrag_url</span>
</span><span id="AgentKnowledgeManager.__init__-40"><a href="#AgentKnowledgeManager.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span> <span class="o">=</span> <span class="n">lightrag_memory_url</span>
</span><span id="AgentKnowledgeManager.__init__-41"><a href="#AgentKnowledgeManager.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_knowledge.json&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.__init__-42"><a href="#AgentKnowledgeManager.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_knowledge_base</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the knowledge manager.</p>

<p>Args:
    user_id: User identifier for knowledge operations
    storage_dir: Directory for storage files
    lightrag_url: Optional URL for LightRAG API
    lightrag_memory_url: Optional URL for LightRAG Memory API</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.user_id" class="classattr">
                                <div class="attr variable">
            <span class="name">user_id</span>

        
    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.user_id"></a>
    
    

                            </div>
                            <div id="AgentKnowledgeManager.storage_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">storage_dir</span>

        
    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.storage_dir"></a>
    
    

                            </div>
                            <div id="AgentKnowledgeManager.lightrag_url" class="classattr">
                                <div class="attr variable">
            <span class="name">lightrag_url</span>

        
    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.lightrag_url"></a>
    
    

                            </div>
                            <div id="AgentKnowledgeManager.lightrag_memory_url" class="classattr">
                                <div class="attr variable">
            <span class="name">lightrag_memory_url</span>

        
    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.lightrag_memory_url"></a>
    
    

                            </div>
                            <div id="AgentKnowledgeManager.knowledge_base_file" class="classattr">
                                <div class="attr variable">
            <span class="name">knowledge_base_file</span>

        
    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.knowledge_base_file"></a>
    
    

                            </div>
                            <div id="AgentKnowledgeManager.knowledge_base" class="classattr">
                                <div class="attr variable">
            <span class="name">knowledge_base</span>

        
    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.knowledge_base"></a>
    
    

                            </div>
                            <div id="AgentKnowledgeManager.add_fact" class="classattr">
                                        <input id="AgentKnowledgeManager.add_fact-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_fact</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fact</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>, </span><span class="param"><span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.add_fact-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.add_fact"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.add_fact-110"><a href="#AgentKnowledgeManager.add_fact-110"><span class="linenos">110</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_fact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fact</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_fact-111"><a href="#AgentKnowledgeManager.add_fact-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a fact to the knowledge base.</span>
</span><span id="AgentKnowledgeManager.add_fact-112"><a href="#AgentKnowledgeManager.add_fact-112"><span class="linenos">112</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.add_fact-113"><a href="#AgentKnowledgeManager.add_fact-113"><span class="linenos">113</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.add_fact-114"><a href="#AgentKnowledgeManager.add_fact-114"><span class="linenos">114</span></a><span class="sd">            fact: The fact to add</span>
</span><span id="AgentKnowledgeManager.add_fact-115"><a href="#AgentKnowledgeManager.add_fact-115"><span class="linenos">115</span></a><span class="sd">            source: Source of the fact (user, inference, etc.)</span>
</span><span id="AgentKnowledgeManager.add_fact-116"><a href="#AgentKnowledgeManager.add_fact-116"><span class="linenos">116</span></a><span class="sd">            confidence: Confidence score (0.0-1.0)</span>
</span><span id="AgentKnowledgeManager.add_fact-117"><a href="#AgentKnowledgeManager.add_fact-117"><span class="linenos">117</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.add_fact-118"><a href="#AgentKnowledgeManager.add_fact-118"><span class="linenos">118</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.add_fact-119"><a href="#AgentKnowledgeManager.add_fact-119"><span class="linenos">119</span></a><span class="sd">            True if fact was added successfully</span>
</span><span id="AgentKnowledgeManager.add_fact-120"><a href="#AgentKnowledgeManager.add_fact-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.add_fact-121"><a href="#AgentKnowledgeManager.add_fact-121"><span class="linenos">121</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_fact-122"><a href="#AgentKnowledgeManager.add_fact-122"><span class="linenos">122</span></a>            <span class="c1"># Create a fact object</span>
</span><span id="AgentKnowledgeManager.add_fact-123"><a href="#AgentKnowledgeManager.add_fact-123"><span class="linenos">123</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager.add_fact-124"><a href="#AgentKnowledgeManager.add_fact-124"><span class="linenos">124</span></a>            <span class="n">fact_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager.add_fact-125"><a href="#AgentKnowledgeManager.add_fact-125"><span class="linenos">125</span></a>                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">fact</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_fact-126"><a href="#AgentKnowledgeManager.add_fact-126"><span class="linenos">126</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_fact-127"><a href="#AgentKnowledgeManager.add_fact-127"><span class="linenos">127</span></a>                <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">confidence</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_fact-128"><a href="#AgentKnowledgeManager.add_fact-128"><span class="linenos">128</span></a>                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="AgentKnowledgeManager.add_fact-129"><a href="#AgentKnowledgeManager.add_fact-129"><span class="linenos">129</span></a>                <span class="s2">&quot;last_accessed&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_fact-130"><a href="#AgentKnowledgeManager.add_fact-130"><span class="linenos">130</span></a>                <span class="s2">&quot;access_count&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="AgentKnowledgeManager.add_fact-131"><a href="#AgentKnowledgeManager.add_fact-131"><span class="linenos">131</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager.add_fact-132"><a href="#AgentKnowledgeManager.add_fact-132"><span class="linenos">132</span></a>            
</span><span id="AgentKnowledgeManager.add_fact-133"><a href="#AgentKnowledgeManager.add_fact-133"><span class="linenos">133</span></a>            <span class="c1"># Add to knowledge base</span>
</span><span id="AgentKnowledgeManager.add_fact-134"><a href="#AgentKnowledgeManager.add_fact-134"><span class="linenos">134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;facts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fact_obj</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.add_fact-135"><a href="#AgentKnowledgeManager.add_fact-135"><span class="linenos">135</span></a>            
</span><span id="AgentKnowledgeManager.add_fact-136"><a href="#AgentKnowledgeManager.add_fact-136"><span class="linenos">136</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager.add_fact-137"><a href="#AgentKnowledgeManager.add_fact-137"><span class="linenos">137</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.add_fact-138"><a href="#AgentKnowledgeManager.add_fact-138"><span class="linenos">138</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_fact-139"><a href="#AgentKnowledgeManager.add_fact-139"><span class="linenos">139</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding fact: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.add_fact-140"><a href="#AgentKnowledgeManager.add_fact-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Add a fact to the knowledge base.</p>

<p>Args:
    fact: The fact to add
    source: Source of the fact (user, inference, etc.)
    confidence: Confidence score (0.0-1.0)</p>

<p>Returns:
    True if fact was added successfully</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.get_facts" class="classattr">
                                        <input id="AgentKnowledgeManager.get_facts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_facts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filter_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.get_facts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.get_facts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.get_facts-142"><a href="#AgentKnowledgeManager.get_facts-142"><span class="linenos">142</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_facts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager.get_facts-143"><a href="#AgentKnowledgeManager.get_facts-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get facts from the knowledge base with optional filtering.</span>
</span><span id="AgentKnowledgeManager.get_facts-144"><a href="#AgentKnowledgeManager.get_facts-144"><span class="linenos">144</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.get_facts-145"><a href="#AgentKnowledgeManager.get_facts-145"><span class="linenos">145</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.get_facts-146"><a href="#AgentKnowledgeManager.get_facts-146"><span class="linenos">146</span></a><span class="sd">            filter_source: Optional source to filter by</span>
</span><span id="AgentKnowledgeManager.get_facts-147"><a href="#AgentKnowledgeManager.get_facts-147"><span class="linenos">147</span></a><span class="sd">            min_confidence: Minimum confidence threshold</span>
</span><span id="AgentKnowledgeManager.get_facts-148"><a href="#AgentKnowledgeManager.get_facts-148"><span class="linenos">148</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.get_facts-149"><a href="#AgentKnowledgeManager.get_facts-149"><span class="linenos">149</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.get_facts-150"><a href="#AgentKnowledgeManager.get_facts-150"><span class="linenos">150</span></a><span class="sd">            List of fact objects</span>
</span><span id="AgentKnowledgeManager.get_facts-151"><a href="#AgentKnowledgeManager.get_facts-151"><span class="linenos">151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.get_facts-152"><a href="#AgentKnowledgeManager.get_facts-152"><span class="linenos">152</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_facts-153"><a href="#AgentKnowledgeManager.get_facts-153"><span class="linenos">153</span></a>            <span class="n">facts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;facts&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.get_facts-154"><a href="#AgentKnowledgeManager.get_facts-154"><span class="linenos">154</span></a>            
</span><span id="AgentKnowledgeManager.get_facts-155"><a href="#AgentKnowledgeManager.get_facts-155"><span class="linenos">155</span></a>            <span class="c1"># Apply filters</span>
</span><span id="AgentKnowledgeManager.get_facts-156"><a href="#AgentKnowledgeManager.get_facts-156"><span class="linenos">156</span></a>            <span class="k">if</span> <span class="n">filter_source</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_facts-157"><a href="#AgentKnowledgeManager.get_facts-157"><span class="linenos">157</span></a>                <span class="n">facts</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">facts</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">filter_source</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.get_facts-158"><a href="#AgentKnowledgeManager.get_facts-158"><span class="linenos">158</span></a>                
</span><span id="AgentKnowledgeManager.get_facts-159"><a href="#AgentKnowledgeManager.get_facts-159"><span class="linenos">159</span></a>            <span class="n">facts</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">facts</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_confidence</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.get_facts-160"><a href="#AgentKnowledgeManager.get_facts-160"><span class="linenos">160</span></a>            
</span><span id="AgentKnowledgeManager.get_facts-161"><a href="#AgentKnowledgeManager.get_facts-161"><span class="linenos">161</span></a>            <span class="c1"># Update access metadata</span>
</span><span id="AgentKnowledgeManager.get_facts-162"><a href="#AgentKnowledgeManager.get_facts-162"><span class="linenos">162</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager.get_facts-163"><a href="#AgentKnowledgeManager.get_facts-163"><span class="linenos">163</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.get_facts-164"><a href="#AgentKnowledgeManager.get_facts-164"><span class="linenos">164</span></a>            
</span><span id="AgentKnowledgeManager.get_facts-165"><a href="#AgentKnowledgeManager.get_facts-165"><span class="linenos">165</span></a>            <span class="k">for</span> <span class="n">fact</span> <span class="ow">in</span> <span class="n">facts</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_facts-166"><a href="#AgentKnowledgeManager.get_facts-166"><span class="linenos">166</span></a>                <span class="c1"># Find the original fact in the knowledge base and update it</span>
</span><span id="AgentKnowledgeManager.get_facts-167"><a href="#AgentKnowledgeManager.get_facts-167"><span class="linenos">167</span></a>                <span class="k">for</span> <span class="n">kb_fact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;facts&quot;</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager.get_facts-168"><a href="#AgentKnowledgeManager.get_facts-168"><span class="linenos">168</span></a>                    <span class="k">if</span> <span class="n">kb_fact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">fact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">):</span>
</span><span id="AgentKnowledgeManager.get_facts-169"><a href="#AgentKnowledgeManager.get_facts-169"><span class="linenos">169</span></a>                        <span class="n">kb_fact</span><span class="p">[</span><span class="s2">&quot;last_accessed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>
</span><span id="AgentKnowledgeManager.get_facts-170"><a href="#AgentKnowledgeManager.get_facts-170"><span class="linenos">170</span></a>                        <span class="n">kb_fact</span><span class="p">[</span><span class="s2">&quot;access_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kb_fact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="AgentKnowledgeManager.get_facts-171"><a href="#AgentKnowledgeManager.get_facts-171"><span class="linenos">171</span></a>            
</span><span id="AgentKnowledgeManager.get_facts-172"><a href="#AgentKnowledgeManager.get_facts-172"><span class="linenos">172</span></a>            <span class="c1"># Save the updated knowledge base</span>
</span><span id="AgentKnowledgeManager.get_facts-173"><a href="#AgentKnowledgeManager.get_facts-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.get_facts-174"><a href="#AgentKnowledgeManager.get_facts-174"><span class="linenos">174</span></a>            
</span><span id="AgentKnowledgeManager.get_facts-175"><a href="#AgentKnowledgeManager.get_facts-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="n">facts</span>
</span><span id="AgentKnowledgeManager.get_facts-176"><a href="#AgentKnowledgeManager.get_facts-176"><span class="linenos">176</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_facts-177"><a href="#AgentKnowledgeManager.get_facts-177"><span class="linenos">177</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting facts: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.get_facts-178"><a href="#AgentKnowledgeManager.get_facts-178"><span class="linenos">178</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Get facts from the knowledge base with optional filtering.</p>

<p>Args:
    filter_source: Optional source to filter by
    min_confidence: Minimum confidence threshold</p>

<p>Returns:
    List of fact objects</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.set_preference" class="classattr">
                                        <input id="AgentKnowledgeManager.set_preference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_preference</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">category</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">key</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.set_preference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.set_preference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.set_preference-180"><a href="#AgentKnowledgeManager.set_preference-180"><span class="linenos">180</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.set_preference-181"><a href="#AgentKnowledgeManager.set_preference-181"><span class="linenos">181</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a user preference.</span>
</span><span id="AgentKnowledgeManager.set_preference-182"><a href="#AgentKnowledgeManager.set_preference-182"><span class="linenos">182</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.set_preference-183"><a href="#AgentKnowledgeManager.set_preference-183"><span class="linenos">183</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.set_preference-184"><a href="#AgentKnowledgeManager.set_preference-184"><span class="linenos">184</span></a><span class="sd">            category: Preference category (e.g., &#39;communication&#39;, &#39;interface&#39;)</span>
</span><span id="AgentKnowledgeManager.set_preference-185"><a href="#AgentKnowledgeManager.set_preference-185"><span class="linenos">185</span></a><span class="sd">            key: Preference key</span>
</span><span id="AgentKnowledgeManager.set_preference-186"><a href="#AgentKnowledgeManager.set_preference-186"><span class="linenos">186</span></a><span class="sd">            value: Preference value</span>
</span><span id="AgentKnowledgeManager.set_preference-187"><a href="#AgentKnowledgeManager.set_preference-187"><span class="linenos">187</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.set_preference-188"><a href="#AgentKnowledgeManager.set_preference-188"><span class="linenos">188</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.set_preference-189"><a href="#AgentKnowledgeManager.set_preference-189"><span class="linenos">189</span></a><span class="sd">            True if preference was set successfully</span>
</span><span id="AgentKnowledgeManager.set_preference-190"><a href="#AgentKnowledgeManager.set_preference-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.set_preference-191"><a href="#AgentKnowledgeManager.set_preference-191"><span class="linenos">191</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.set_preference-192"><a href="#AgentKnowledgeManager.set_preference-192"><span class="linenos">192</span></a>            <span class="c1"># Initialize category if it doesn&#39;t exist</span>
</span><span id="AgentKnowledgeManager.set_preference-193"><a href="#AgentKnowledgeManager.set_preference-193"><span class="linenos">193</span></a>            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager.set_preference-194"><a href="#AgentKnowledgeManager.set_preference-194"><span class="linenos">194</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentKnowledgeManager.set_preference-195"><a href="#AgentKnowledgeManager.set_preference-195"><span class="linenos">195</span></a>                
</span><span id="AgentKnowledgeManager.set_preference-196"><a href="#AgentKnowledgeManager.set_preference-196"><span class="linenos">196</span></a>            <span class="c1"># Set preference</span>
</span><span id="AgentKnowledgeManager.set_preference-197"><a href="#AgentKnowledgeManager.set_preference-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="AgentKnowledgeManager.set_preference-198"><a href="#AgentKnowledgeManager.set_preference-198"><span class="linenos">198</span></a>            
</span><span id="AgentKnowledgeManager.set_preference-199"><a href="#AgentKnowledgeManager.set_preference-199"><span class="linenos">199</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager.set_preference-200"><a href="#AgentKnowledgeManager.set_preference-200"><span class="linenos">200</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.set_preference-201"><a href="#AgentKnowledgeManager.set_preference-201"><span class="linenos">201</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.set_preference-202"><a href="#AgentKnowledgeManager.set_preference-202"><span class="linenos">202</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting preference: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.set_preference-203"><a href="#AgentKnowledgeManager.set_preference-203"><span class="linenos">203</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Set a user preference.</p>

<p>Args:
    category: Preference category (e.g., 'communication', 'interface')
    key: Preference key
    value: Preference value</p>

<p>Returns:
    True if preference was set successfully</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.get_preference" class="classattr">
                                        <input id="AgentKnowledgeManager.get_preference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_preference</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">category</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">key</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.get_preference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.get_preference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.get_preference-205"><a href="#AgentKnowledgeManager.get_preference-205"><span class="linenos">205</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_preference-206"><a href="#AgentKnowledgeManager.get_preference-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a user preference.</span>
</span><span id="AgentKnowledgeManager.get_preference-207"><a href="#AgentKnowledgeManager.get_preference-207"><span class="linenos">207</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.get_preference-208"><a href="#AgentKnowledgeManager.get_preference-208"><span class="linenos">208</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.get_preference-209"><a href="#AgentKnowledgeManager.get_preference-209"><span class="linenos">209</span></a><span class="sd">            category: Preference category</span>
</span><span id="AgentKnowledgeManager.get_preference-210"><a href="#AgentKnowledgeManager.get_preference-210"><span class="linenos">210</span></a><span class="sd">            key: Preference key</span>
</span><span id="AgentKnowledgeManager.get_preference-211"><a href="#AgentKnowledgeManager.get_preference-211"><span class="linenos">211</span></a><span class="sd">            default: Default value if preference doesn&#39;t exist</span>
</span><span id="AgentKnowledgeManager.get_preference-212"><a href="#AgentKnowledgeManager.get_preference-212"><span class="linenos">212</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.get_preference-213"><a href="#AgentKnowledgeManager.get_preference-213"><span class="linenos">213</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.get_preference-214"><a href="#AgentKnowledgeManager.get_preference-214"><span class="linenos">214</span></a><span class="sd">            Preference value or default</span>
</span><span id="AgentKnowledgeManager.get_preference-215"><a href="#AgentKnowledgeManager.get_preference-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.get_preference-216"><a href="#AgentKnowledgeManager.get_preference-216"><span class="linenos">216</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_preference-217"><a href="#AgentKnowledgeManager.get_preference-217"><span class="linenos">217</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.get_preference-218"><a href="#AgentKnowledgeManager.get_preference-218"><span class="linenos">218</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_preference-219"><a href="#AgentKnowledgeManager.get_preference-219"><span class="linenos">219</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting preference: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.get_preference-220"><a href="#AgentKnowledgeManager.get_preference-220"><span class="linenos">220</span></a>            <span class="k">return</span> <span class="n">default</span>
</span></pre></div>


            <div class="docstring"><p>Get a user preference.</p>

<p>Args:
    category: Preference category
    key: Preference key
    default: Default value if preference doesn't exist</p>

<p>Returns:
    Preference value or default</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.get_all_preferences" class="classattr">
                                        <input id="AgentKnowledgeManager.get_all_preferences-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_preferences</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.get_all_preferences-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.get_all_preferences"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.get_all_preferences-222"><a href="#AgentKnowledgeManager.get_all_preferences-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_preferences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-223"><a href="#AgentKnowledgeManager.get_all_preferences-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all preferences, optionally filtered by category.</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-224"><a href="#AgentKnowledgeManager.get_all_preferences-224"><span class="linenos">224</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.get_all_preferences-225"><a href="#AgentKnowledgeManager.get_all_preferences-225"><span class="linenos">225</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-226"><a href="#AgentKnowledgeManager.get_all_preferences-226"><span class="linenos">226</span></a><span class="sd">            category: Optional category to filter by</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-227"><a href="#AgentKnowledgeManager.get_all_preferences-227"><span class="linenos">227</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.get_all_preferences-228"><a href="#AgentKnowledgeManager.get_all_preferences-228"><span class="linenos">228</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-229"><a href="#AgentKnowledgeManager.get_all_preferences-229"><span class="linenos">229</span></a><span class="sd">            Dictionary of preferences</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-230"><a href="#AgentKnowledgeManager.get_all_preferences-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-231"><a href="#AgentKnowledgeManager.get_all_preferences-231"><span class="linenos">231</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-232"><a href="#AgentKnowledgeManager.get_all_preferences-232"><span class="linenos">232</span></a>            <span class="k">if</span> <span class="n">category</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-233"><a href="#AgentKnowledgeManager.get_all_preferences-233"><span class="linenos">233</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-234"><a href="#AgentKnowledgeManager.get_all_preferences-234"><span class="linenos">234</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-235"><a href="#AgentKnowledgeManager.get_all_preferences-235"><span class="linenos">235</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;preferences&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-236"><a href="#AgentKnowledgeManager.get_all_preferences-236"><span class="linenos">236</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-237"><a href="#AgentKnowledgeManager.get_all_preferences-237"><span class="linenos">237</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting all preferences: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.get_all_preferences-238"><a href="#AgentKnowledgeManager.get_all_preferences-238"><span class="linenos">238</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Get all preferences, optionally filtered by category.</p>

<p>Args:
    category: Optional category to filter by</p>

<p>Returns:
    Dictionary of preferences</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.add_entity" class="classattr">
                                        <input id="AgentKnowledgeManager.add_entity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_entity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.add_entity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.add_entity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.add_entity-240"><a href="#AgentKnowledgeManager.add_entity-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_entity-241"><a href="#AgentKnowledgeManager.add_entity-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an entity to the knowledge base.</span>
</span><span id="AgentKnowledgeManager.add_entity-242"><a href="#AgentKnowledgeManager.add_entity-242"><span class="linenos">242</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.add_entity-243"><a href="#AgentKnowledgeManager.add_entity-243"><span class="linenos">243</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.add_entity-244"><a href="#AgentKnowledgeManager.add_entity-244"><span class="linenos">244</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager.add_entity-245"><a href="#AgentKnowledgeManager.add_entity-245"><span class="linenos">245</span></a><span class="sd">            entity_type: Type of the entity (person, place, thing, etc.)</span>
</span><span id="AgentKnowledgeManager.add_entity-246"><a href="#AgentKnowledgeManager.add_entity-246"><span class="linenos">246</span></a><span class="sd">            properties: Optional properties of the entity</span>
</span><span id="AgentKnowledgeManager.add_entity-247"><a href="#AgentKnowledgeManager.add_entity-247"><span class="linenos">247</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.add_entity-248"><a href="#AgentKnowledgeManager.add_entity-248"><span class="linenos">248</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.add_entity-249"><a href="#AgentKnowledgeManager.add_entity-249"><span class="linenos">249</span></a><span class="sd">            True if entity was added successfully</span>
</span><span id="AgentKnowledgeManager.add_entity-250"><a href="#AgentKnowledgeManager.add_entity-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.add_entity-251"><a href="#AgentKnowledgeManager.add_entity-251"><span class="linenos">251</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_entity-252"><a href="#AgentKnowledgeManager.add_entity-252"><span class="linenos">252</span></a>            <span class="c1"># Create entity object</span>
</span><span id="AgentKnowledgeManager.add_entity-253"><a href="#AgentKnowledgeManager.add_entity-253"><span class="linenos">253</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager.add_entity-254"><a href="#AgentKnowledgeManager.add_entity-254"><span class="linenos">254</span></a>            <span class="n">entity_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager.add_entity-255"><a href="#AgentKnowledgeManager.add_entity-255"><span class="linenos">255</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_entity-256"><a href="#AgentKnowledgeManager.add_entity-256"><span class="linenos">256</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_entity-257"><a href="#AgentKnowledgeManager.add_entity-257"><span class="linenos">257</span></a>                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager.add_entity-258"><a href="#AgentKnowledgeManager.add_entity-258"><span class="linenos">258</span></a>                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="AgentKnowledgeManager.add_entity-259"><a href="#AgentKnowledgeManager.add_entity-259"><span class="linenos">259</span></a>                <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.add_entity-260"><a href="#AgentKnowledgeManager.add_entity-260"><span class="linenos">260</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager.add_entity-261"><a href="#AgentKnowledgeManager.add_entity-261"><span class="linenos">261</span></a>            
</span><span id="AgentKnowledgeManager.add_entity-262"><a href="#AgentKnowledgeManager.add_entity-262"><span class="linenos">262</span></a>            <span class="c1"># Add to knowledge base</span>
</span><span id="AgentKnowledgeManager.add_entity-263"><a href="#AgentKnowledgeManager.add_entity-263"><span class="linenos">263</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">][</span><span class="n">entity_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_obj</span>
</span><span id="AgentKnowledgeManager.add_entity-264"><a href="#AgentKnowledgeManager.add_entity-264"><span class="linenos">264</span></a>            
</span><span id="AgentKnowledgeManager.add_entity-265"><a href="#AgentKnowledgeManager.add_entity-265"><span class="linenos">265</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager.add_entity-266"><a href="#AgentKnowledgeManager.add_entity-266"><span class="linenos">266</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.add_entity-267"><a href="#AgentKnowledgeManager.add_entity-267"><span class="linenos">267</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_entity-268"><a href="#AgentKnowledgeManager.add_entity-268"><span class="linenos">268</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding entity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.add_entity-269"><a href="#AgentKnowledgeManager.add_entity-269"><span class="linenos">269</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Add an entity to the knowledge base.</p>

<p>Args:
    entity_name: Name of the entity
    entity_type: Type of the entity (person, place, thing, etc.)
    properties: Optional properties of the entity</p>

<p>Returns:
    True if entity was added successfully</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.get_entity" class="classattr">
                                        <input id="AgentKnowledgeManager.get_entity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_entity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.get_entity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.get_entity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.get_entity-271"><a href="#AgentKnowledgeManager.get_entity-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager.get_entity-272"><a href="#AgentKnowledgeManager.get_entity-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an entity from the knowledge base.</span>
</span><span id="AgentKnowledgeManager.get_entity-273"><a href="#AgentKnowledgeManager.get_entity-273"><span class="linenos">273</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.get_entity-274"><a href="#AgentKnowledgeManager.get_entity-274"><span class="linenos">274</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.get_entity-275"><a href="#AgentKnowledgeManager.get_entity-275"><span class="linenos">275</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager.get_entity-276"><a href="#AgentKnowledgeManager.get_entity-276"><span class="linenos">276</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.get_entity-277"><a href="#AgentKnowledgeManager.get_entity-277"><span class="linenos">277</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.get_entity-278"><a href="#AgentKnowledgeManager.get_entity-278"><span class="linenos">278</span></a><span class="sd">            Entity object or None if not found</span>
</span><span id="AgentKnowledgeManager.get_entity-279"><a href="#AgentKnowledgeManager.get_entity-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.get_entity-280"><a href="#AgentKnowledgeManager.get_entity-280"><span class="linenos">280</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_entity-281"><a href="#AgentKnowledgeManager.get_entity-281"><span class="linenos">281</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.get_entity-282"><a href="#AgentKnowledgeManager.get_entity-282"><span class="linenos">282</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_entity-283"><a href="#AgentKnowledgeManager.get_entity-283"><span class="linenos">283</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting entity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.get_entity-284"><a href="#AgentKnowledgeManager.get_entity-284"><span class="linenos">284</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get an entity from the knowledge base.</p>

<p>Args:
    entity_name: Name of the entity</p>

<p>Returns:
    Entity object or None if not found</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.update_entity" class="classattr">
                                        <input id="AgentKnowledgeManager.update_entity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_entity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.update_entity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.update_entity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.update_entity-286"><a href="#AgentKnowledgeManager.update_entity-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.update_entity-287"><a href="#AgentKnowledgeManager.update_entity-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an entity&#39;s properties.</span>
</span><span id="AgentKnowledgeManager.update_entity-288"><a href="#AgentKnowledgeManager.update_entity-288"><span class="linenos">288</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.update_entity-289"><a href="#AgentKnowledgeManager.update_entity-289"><span class="linenos">289</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.update_entity-290"><a href="#AgentKnowledgeManager.update_entity-290"><span class="linenos">290</span></a><span class="sd">            entity_name: Name of the entity</span>
</span><span id="AgentKnowledgeManager.update_entity-291"><a href="#AgentKnowledgeManager.update_entity-291"><span class="linenos">291</span></a><span class="sd">            properties: Properties to update</span>
</span><span id="AgentKnowledgeManager.update_entity-292"><a href="#AgentKnowledgeManager.update_entity-292"><span class="linenos">292</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.update_entity-293"><a href="#AgentKnowledgeManager.update_entity-293"><span class="linenos">293</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.update_entity-294"><a href="#AgentKnowledgeManager.update_entity-294"><span class="linenos">294</span></a><span class="sd">            True if entity was updated successfully</span>
</span><span id="AgentKnowledgeManager.update_entity-295"><a href="#AgentKnowledgeManager.update_entity-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.update_entity-296"><a href="#AgentKnowledgeManager.update_entity-296"><span class="linenos">296</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.update_entity-297"><a href="#AgentKnowledgeManager.update_entity-297"><span class="linenos">297</span></a>            <span class="c1"># Check if entity exists</span>
</span><span id="AgentKnowledgeManager.update_entity-298"><a href="#AgentKnowledgeManager.update_entity-298"><span class="linenos">298</span></a>            <span class="k">if</span> <span class="n">entity_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager.update_entity-299"><a href="#AgentKnowledgeManager.update_entity-299"><span class="linenos">299</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.update_entity-300"><a href="#AgentKnowledgeManager.update_entity-300"><span class="linenos">300</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentKnowledgeManager.update_entity-301"><a href="#AgentKnowledgeManager.update_entity-301"><span class="linenos">301</span></a>                
</span><span id="AgentKnowledgeManager.update_entity-302"><a href="#AgentKnowledgeManager.update_entity-302"><span class="linenos">302</span></a>            <span class="c1"># Update properties</span>
</span><span id="AgentKnowledgeManager.update_entity-303"><a href="#AgentKnowledgeManager.update_entity-303"><span class="linenos">303</span></a>            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">][</span><span class="n">entity_name</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.update_entity-304"><a href="#AgentKnowledgeManager.update_entity-304"><span class="linenos">304</span></a>            <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.update_entity-305"><a href="#AgentKnowledgeManager.update_entity-305"><span class="linenos">305</span></a>            
</span><span id="AgentKnowledgeManager.update_entity-306"><a href="#AgentKnowledgeManager.update_entity-306"><span class="linenos">306</span></a>            <span class="c1"># Update the last_updated timestamp</span>
</span><span id="AgentKnowledgeManager.update_entity-307"><a href="#AgentKnowledgeManager.update_entity-307"><span class="linenos">307</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager.update_entity-308"><a href="#AgentKnowledgeManager.update_entity-308"><span class="linenos">308</span></a>            <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.update_entity-309"><a href="#AgentKnowledgeManager.update_entity-309"><span class="linenos">309</span></a>            
</span><span id="AgentKnowledgeManager.update_entity-310"><a href="#AgentKnowledgeManager.update_entity-310"><span class="linenos">310</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager.update_entity-311"><a href="#AgentKnowledgeManager.update_entity-311"><span class="linenos">311</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.update_entity-312"><a href="#AgentKnowledgeManager.update_entity-312"><span class="linenos">312</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.update_entity-313"><a href="#AgentKnowledgeManager.update_entity-313"><span class="linenos">313</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating entity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.update_entity-314"><a href="#AgentKnowledgeManager.update_entity-314"><span class="linenos">314</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Update an entity's properties.</p>

<p>Args:
    entity_name: Name of the entity
    properties: Properties to update</p>

<p>Returns:
    True if entity was updated successfully</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.add_relationship" class="classattr">
                                        <input id="AgentKnowledgeManager.add_relationship-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_relationship</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">entity1</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">relation</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">entity2</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.add_relationship-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.add_relationship"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.add_relationship-316"><a href="#AgentKnowledgeManager.add_relationship-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_relationship-317"><a href="#AgentKnowledgeManager.add_relationship-317"><span class="linenos">317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a relationship between entities.</span>
</span><span id="AgentKnowledgeManager.add_relationship-318"><a href="#AgentKnowledgeManager.add_relationship-318"><span class="linenos">318</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.add_relationship-319"><a href="#AgentKnowledgeManager.add_relationship-319"><span class="linenos">319</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.add_relationship-320"><a href="#AgentKnowledgeManager.add_relationship-320"><span class="linenos">320</span></a><span class="sd">            entity1: First entity name</span>
</span><span id="AgentKnowledgeManager.add_relationship-321"><a href="#AgentKnowledgeManager.add_relationship-321"><span class="linenos">321</span></a><span class="sd">            relation: Relationship type</span>
</span><span id="AgentKnowledgeManager.add_relationship-322"><a href="#AgentKnowledgeManager.add_relationship-322"><span class="linenos">322</span></a><span class="sd">            entity2: Second entity name</span>
</span><span id="AgentKnowledgeManager.add_relationship-323"><a href="#AgentKnowledgeManager.add_relationship-323"><span class="linenos">323</span></a><span class="sd">            properties: Optional properties of the relationship</span>
</span><span id="AgentKnowledgeManager.add_relationship-324"><a href="#AgentKnowledgeManager.add_relationship-324"><span class="linenos">324</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.add_relationship-325"><a href="#AgentKnowledgeManager.add_relationship-325"><span class="linenos">325</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.add_relationship-326"><a href="#AgentKnowledgeManager.add_relationship-326"><span class="linenos">326</span></a><span class="sd">            True if relationship was added successfully</span>
</span><span id="AgentKnowledgeManager.add_relationship-327"><a href="#AgentKnowledgeManager.add_relationship-327"><span class="linenos">327</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.add_relationship-328"><a href="#AgentKnowledgeManager.add_relationship-328"><span class="linenos">328</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_relationship-329"><a href="#AgentKnowledgeManager.add_relationship-329"><span class="linenos">329</span></a>            <span class="c1"># Create relationship object</span>
</span><span id="AgentKnowledgeManager.add_relationship-330"><a href="#AgentKnowledgeManager.add_relationship-330"><span class="linenos">330</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="AgentKnowledgeManager.add_relationship-331"><a href="#AgentKnowledgeManager.add_relationship-331"><span class="linenos">331</span></a>            <span class="n">rel_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager.add_relationship-332"><a href="#AgentKnowledgeManager.add_relationship-332"><span class="linenos">332</span></a>                <span class="s2">&quot;entity1&quot;</span><span class="p">:</span> <span class="n">entity1</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_relationship-333"><a href="#AgentKnowledgeManager.add_relationship-333"><span class="linenos">333</span></a>                <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_relationship-334"><a href="#AgentKnowledgeManager.add_relationship-334"><span class="linenos">334</span></a>                <span class="s2">&quot;entity2&quot;</span><span class="p">:</span> <span class="n">entity2</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.add_relationship-335"><a href="#AgentKnowledgeManager.add_relationship-335"><span class="linenos">335</span></a>                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager.add_relationship-336"><a href="#AgentKnowledgeManager.add_relationship-336"><span class="linenos">336</span></a>                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.add_relationship-337"><a href="#AgentKnowledgeManager.add_relationship-337"><span class="linenos">337</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager.add_relationship-338"><a href="#AgentKnowledgeManager.add_relationship-338"><span class="linenos">338</span></a>            
</span><span id="AgentKnowledgeManager.add_relationship-339"><a href="#AgentKnowledgeManager.add_relationship-339"><span class="linenos">339</span></a>            <span class="c1"># Add to knowledge base</span>
</span><span id="AgentKnowledgeManager.add_relationship-340"><a href="#AgentKnowledgeManager.add_relationship-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;relationships&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel_obj</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.add_relationship-341"><a href="#AgentKnowledgeManager.add_relationship-341"><span class="linenos">341</span></a>            
</span><span id="AgentKnowledgeManager.add_relationship-342"><a href="#AgentKnowledgeManager.add_relationship-342"><span class="linenos">342</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager.add_relationship-343"><a href="#AgentKnowledgeManager.add_relationship-343"><span class="linenos">343</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.add_relationship-344"><a href="#AgentKnowledgeManager.add_relationship-344"><span class="linenos">344</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.add_relationship-345"><a href="#AgentKnowledgeManager.add_relationship-345"><span class="linenos">345</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding relationship: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.add_relationship-346"><a href="#AgentKnowledgeManager.add_relationship-346"><span class="linenos">346</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Add a relationship between entities.</p>

<p>Args:
    entity1: First entity name
    relation: Relationship type
    entity2: Second entity name
    properties: Optional properties of the relationship</p>

<p>Returns:
    True if relationship was added successfully</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.get_relationships" class="classattr">
                                        <input id="AgentKnowledgeManager.get_relationships-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_relationships</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">entity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">relation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.get_relationships-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.get_relationships"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.get_relationships-348"><a href="#AgentKnowledgeManager.get_relationships-348"><span class="linenos">348</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager.get_relationships-349"><a href="#AgentKnowledgeManager.get_relationships-349"><span class="linenos">349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get relationships, optionally filtered by entity or relation type.</span>
</span><span id="AgentKnowledgeManager.get_relationships-350"><a href="#AgentKnowledgeManager.get_relationships-350"><span class="linenos">350</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.get_relationships-351"><a href="#AgentKnowledgeManager.get_relationships-351"><span class="linenos">351</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.get_relationships-352"><a href="#AgentKnowledgeManager.get_relationships-352"><span class="linenos">352</span></a><span class="sd">            entity: Optional entity to filter by (either entity1 or entity2)</span>
</span><span id="AgentKnowledgeManager.get_relationships-353"><a href="#AgentKnowledgeManager.get_relationships-353"><span class="linenos">353</span></a><span class="sd">            relation: Optional relation type to filter by</span>
</span><span id="AgentKnowledgeManager.get_relationships-354"><a href="#AgentKnowledgeManager.get_relationships-354"><span class="linenos">354</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.get_relationships-355"><a href="#AgentKnowledgeManager.get_relationships-355"><span class="linenos">355</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.get_relationships-356"><a href="#AgentKnowledgeManager.get_relationships-356"><span class="linenos">356</span></a><span class="sd">            List of relationship objects</span>
</span><span id="AgentKnowledgeManager.get_relationships-357"><a href="#AgentKnowledgeManager.get_relationships-357"><span class="linenos">357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.get_relationships-358"><a href="#AgentKnowledgeManager.get_relationships-358"><span class="linenos">358</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_relationships-359"><a href="#AgentKnowledgeManager.get_relationships-359"><span class="linenos">359</span></a>            <span class="n">relationships</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;relationships&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.get_relationships-360"><a href="#AgentKnowledgeManager.get_relationships-360"><span class="linenos">360</span></a>            
</span><span id="AgentKnowledgeManager.get_relationships-361"><a href="#AgentKnowledgeManager.get_relationships-361"><span class="linenos">361</span></a>            <span class="c1"># Apply filters</span>
</span><span id="AgentKnowledgeManager.get_relationships-362"><a href="#AgentKnowledgeManager.get_relationships-362"><span class="linenos">362</span></a>            <span class="k">if</span> <span class="n">entity</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_relationships-363"><a href="#AgentKnowledgeManager.get_relationships-363"><span class="linenos">363</span></a>                <span class="n">relationships</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AgentKnowledgeManager.get_relationships-364"><a href="#AgentKnowledgeManager.get_relationships-364"><span class="linenos">364</span></a>                    <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relationships</span> 
</span><span id="AgentKnowledgeManager.get_relationships-365"><a href="#AgentKnowledgeManager.get_relationships-365"><span class="linenos">365</span></a>                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entity1&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">entity</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entity2&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">entity</span>
</span><span id="AgentKnowledgeManager.get_relationships-366"><a href="#AgentKnowledgeManager.get_relationships-366"><span class="linenos">366</span></a>                <span class="p">]</span>
</span><span id="AgentKnowledgeManager.get_relationships-367"><a href="#AgentKnowledgeManager.get_relationships-367"><span class="linenos">367</span></a>                
</span><span id="AgentKnowledgeManager.get_relationships-368"><a href="#AgentKnowledgeManager.get_relationships-368"><span class="linenos">368</span></a>            <span class="k">if</span> <span class="n">relation</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_relationships-369"><a href="#AgentKnowledgeManager.get_relationships-369"><span class="linenos">369</span></a>                <span class="n">relationships</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relationships</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relation&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">relation</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.get_relationships-370"><a href="#AgentKnowledgeManager.get_relationships-370"><span class="linenos">370</span></a>                
</span><span id="AgentKnowledgeManager.get_relationships-371"><a href="#AgentKnowledgeManager.get_relationships-371"><span class="linenos">371</span></a>            <span class="k">return</span> <span class="n">relationships</span>
</span><span id="AgentKnowledgeManager.get_relationships-372"><a href="#AgentKnowledgeManager.get_relationships-372"><span class="linenos">372</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.get_relationships-373"><a href="#AgentKnowledgeManager.get_relationships-373"><span class="linenos">373</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting relationships: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.get_relationships-374"><a href="#AgentKnowledgeManager.get_relationships-374"><span class="linenos">374</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Get relationships, optionally filtered by entity or relation type.</p>

<p>Args:
    entity: Optional entity to filter by (either entity1 or entity2)
    relation: Optional relation type to filter by</p>

<p>Returns:
    List of relationship objects</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.clear_knowledge_base" class="classattr">
                                        <input id="AgentKnowledgeManager.clear_knowledge_base-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clear_knowledge_base</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.clear_knowledge_base-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.clear_knowledge_base"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.clear_knowledge_base-376"><a href="#AgentKnowledgeManager.clear_knowledge_base-376"><span class="linenos">376</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_knowledge_base</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-377"><a href="#AgentKnowledgeManager.clear_knowledge_base-377"><span class="linenos">377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the entire knowledge base.</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-378"><a href="#AgentKnowledgeManager.clear_knowledge_base-378"><span class="linenos">378</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-379"><a href="#AgentKnowledgeManager.clear_knowledge_base-379"><span class="linenos">379</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-380"><a href="#AgentKnowledgeManager.clear_knowledge_base-380"><span class="linenos">380</span></a><span class="sd">            True if knowledge base was cleared successfully</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-381"><a href="#AgentKnowledgeManager.clear_knowledge_base-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-382"><a href="#AgentKnowledgeManager.clear_knowledge_base-382"><span class="linenos">382</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-383"><a href="#AgentKnowledgeManager.clear_knowledge_base-383"><span class="linenos">383</span></a>            <span class="c1"># Reset to empty structure</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-384"><a href="#AgentKnowledgeManager.clear_knowledge_base-384"><span class="linenos">384</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-385"><a href="#AgentKnowledgeManager.clear_knowledge_base-385"><span class="linenos">385</span></a>                <span class="s2">&quot;facts&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-386"><a href="#AgentKnowledgeManager.clear_knowledge_base-386"><span class="linenos">386</span></a>                <span class="s2">&quot;preferences&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-387"><a href="#AgentKnowledgeManager.clear_knowledge_base-387"><span class="linenos">387</span></a>                <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-388"><a href="#AgentKnowledgeManager.clear_knowledge_base-388"><span class="linenos">388</span></a>                <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-389"><a href="#AgentKnowledgeManager.clear_knowledge_base-389"><span class="linenos">389</span></a>                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-390"><a href="#AgentKnowledgeManager.clear_knowledge_base-390"><span class="linenos">390</span></a>                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-391"><a href="#AgentKnowledgeManager.clear_knowledge_base-391"><span class="linenos">391</span></a>                    <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="kc">None</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-392"><a href="#AgentKnowledgeManager.clear_knowledge_base-392"><span class="linenos">392</span></a>                <span class="p">}</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-393"><a href="#AgentKnowledgeManager.clear_knowledge_base-393"><span class="linenos">393</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-394"><a href="#AgentKnowledgeManager.clear_knowledge_base-394"><span class="linenos">394</span></a>            
</span><span id="AgentKnowledgeManager.clear_knowledge_base-395"><a href="#AgentKnowledgeManager.clear_knowledge_base-395"><span class="linenos">395</span></a>            <span class="c1"># Save knowledge base</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-396"><a href="#AgentKnowledgeManager.clear_knowledge_base-396"><span class="linenos">396</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_knowledge_base</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-397"><a href="#AgentKnowledgeManager.clear_knowledge_base-397"><span class="linenos">397</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-398"><a href="#AgentKnowledgeManager.clear_knowledge_base-398"><span class="linenos">398</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error clearing knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.clear_knowledge_base-399"><a href="#AgentKnowledgeManager.clear_knowledge_base-399"><span class="linenos">399</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Clear the entire knowledge base.</p>

<p>Returns:
    True if knowledge base was cleared successfully</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.sync_with_graph" class="classattr">
                                        <input id="AgentKnowledgeManager.sync_with_graph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">sync_with_graph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.sync_with_graph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.sync_with_graph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.sync_with_graph-401"><a href="#AgentKnowledgeManager.sync_with_graph-401"><span class="linenos">401</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">sync_with_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-402"><a href="#AgentKnowledgeManager.sync_with_graph-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Synchronize the local knowledge base with the graph database.</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-403"><a href="#AgentKnowledgeManager.sync_with_graph-403"><span class="linenos">403</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.sync_with_graph-404"><a href="#AgentKnowledgeManager.sync_with_graph-404"><span class="linenos">404</span></a><span class="sd">        This method syncs entities and relationships from the local knowledge base</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-405"><a href="#AgentKnowledgeManager.sync_with_graph-405"><span class="linenos">405</span></a><span class="sd">        to the LightRAG graph database.</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-406"><a href="#AgentKnowledgeManager.sync_with_graph-406"><span class="linenos">406</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.sync_with_graph-407"><a href="#AgentKnowledgeManager.sync_with_graph-407"><span class="linenos">407</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-408"><a href="#AgentKnowledgeManager.sync_with_graph-408"><span class="linenos">408</span></a><span class="sd">            Status message</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-409"><a href="#AgentKnowledgeManager.sync_with_graph-409"><span class="linenos">409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-410"><a href="#AgentKnowledgeManager.sync_with_graph-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-411"><a href="#AgentKnowledgeManager.sync_with_graph-411"><span class="linenos">411</span></a>            <span class="k">return</span> <span class="s2">&quot;Graph sync not available: LightRAG memory URL not configured&quot;</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-412"><a href="#AgentKnowledgeManager.sync_with_graph-412"><span class="linenos">412</span></a>            
</span><span id="AgentKnowledgeManager.sync_with_graph-413"><a href="#AgentKnowledgeManager.sync_with_graph-413"><span class="linenos">413</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-414"><a href="#AgentKnowledgeManager.sync_with_graph-414"><span class="linenos">414</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-415"><a href="#AgentKnowledgeManager.sync_with_graph-415"><span class="linenos">415</span></a>            
</span><span id="AgentKnowledgeManager.sync_with_graph-416"><a href="#AgentKnowledgeManager.sync_with_graph-416"><span class="linenos">416</span></a>            <span class="c1"># 1. Sync entities</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-417"><a href="#AgentKnowledgeManager.sync_with_graph-417"><span class="linenos">417</span></a>            <span class="k">for</span> <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-418"><a href="#AgentKnowledgeManager.sync_with_graph-418"><span class="linenos">418</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-419"><a href="#AgentKnowledgeManager.sync_with_graph-419"><span class="linenos">419</span></a>                    <span class="c1"># Check if entity exists in graph</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-420"><a href="#AgentKnowledgeManager.sync_with_graph-420"><span class="linenos">420</span></a>                    <span class="n">entity_exists</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_entity_exists</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-421"><a href="#AgentKnowledgeManager.sync_with_graph-421"><span class="linenos">421</span></a>                    
</span><span id="AgentKnowledgeManager.sync_with_graph-422"><a href="#AgentKnowledgeManager.sync_with_graph-422"><span class="linenos">422</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_exists</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-423"><a href="#AgentKnowledgeManager.sync_with_graph-423"><span class="linenos">423</span></a>                        <span class="c1"># Create entity in graph</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-424"><a href="#AgentKnowledgeManager.sync_with_graph-424"><span class="linenos">424</span></a>                        <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_graph_entity</span><span class="p">(</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-425"><a href="#AgentKnowledgeManager.sync_with_graph-425"><span class="linenos">425</span></a>                            <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-426"><a href="#AgentKnowledgeManager.sync_with_graph-426"><span class="linenos">426</span></a>                        <span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-427"><a href="#AgentKnowledgeManager.sync_with_graph-427"><span class="linenos">427</span></a>                        
</span><span id="AgentKnowledgeManager.sync_with_graph-428"><a href="#AgentKnowledgeManager.sync_with_graph-428"><span class="linenos">428</span></a>                        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-429"><a href="#AgentKnowledgeManager.sync_with_graph-429"><span class="linenos">429</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-430"><a href="#AgentKnowledgeManager.sync_with_graph-430"><span class="linenos">430</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-431"><a href="#AgentKnowledgeManager.sync_with_graph-431"><span class="linenos">431</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-432"><a href="#AgentKnowledgeManager.sync_with_graph-432"><span class="linenos">432</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-433"><a href="#AgentKnowledgeManager.sync_with_graph-433"><span class="linenos">433</span></a>                        <span class="c1"># Update entity in graph</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-434"><a href="#AgentKnowledgeManager.sync_with_graph-434"><span class="linenos">434</span></a>                        <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_graph_entity</span><span class="p">(</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-435"><a href="#AgentKnowledgeManager.sync_with_graph-435"><span class="linenos">435</span></a>                            <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-436"><a href="#AgentKnowledgeManager.sync_with_graph-436"><span class="linenos">436</span></a>                        <span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-437"><a href="#AgentKnowledgeManager.sync_with_graph-437"><span class="linenos">437</span></a>                        
</span><span id="AgentKnowledgeManager.sync_with_graph-438"><a href="#AgentKnowledgeManager.sync_with_graph-438"><span class="linenos">438</span></a>                        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-439"><a href="#AgentKnowledgeManager.sync_with_graph-439"><span class="linenos">439</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-440"><a href="#AgentKnowledgeManager.sync_with_graph-440"><span class="linenos">440</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-441"><a href="#AgentKnowledgeManager.sync_with_graph-441"><span class="linenos">441</span></a>                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update entity: </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-442"><a href="#AgentKnowledgeManager.sync_with_graph-442"><span class="linenos">442</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-443"><a href="#AgentKnowledgeManager.sync_with_graph-443"><span class="linenos">443</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-444"><a href="#AgentKnowledgeManager.sync_with_graph-444"><span class="linenos">444</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing entity </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-445"><a href="#AgentKnowledgeManager.sync_with_graph-445"><span class="linenos">445</span></a>                    
</span><span id="AgentKnowledgeManager.sync_with_graph-446"><a href="#AgentKnowledgeManager.sync_with_graph-446"><span class="linenos">446</span></a>            <span class="c1"># 2. Sync relationships</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-447"><a href="#AgentKnowledgeManager.sync_with_graph-447"><span class="linenos">447</span></a>            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">[</span><span class="s2">&quot;relationships&quot;</span><span class="p">]:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-448"><a href="#AgentKnowledgeManager.sync_with_graph-448"><span class="linenos">448</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-449"><a href="#AgentKnowledgeManager.sync_with_graph-449"><span class="linenos">449</span></a>                    <span class="c1"># Create relationship in graph</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-450"><a href="#AgentKnowledgeManager.sync_with_graph-450"><span class="linenos">450</span></a>                    <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_graph_relationship</span><span class="p">(</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-451"><a href="#AgentKnowledgeManager.sync_with_graph-451"><span class="linenos">451</span></a>                        <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;entity1&quot;</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;relation&quot;</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;entity2&quot;</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-452"><a href="#AgentKnowledgeManager.sync_with_graph-452"><span class="linenos">452</span></a>                    <span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-453"><a href="#AgentKnowledgeManager.sync_with_graph-453"><span class="linenos">453</span></a>                    
</span><span id="AgentKnowledgeManager.sync_with_graph-454"><a href="#AgentKnowledgeManager.sync_with_graph-454"><span class="linenos">454</span></a>                    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-455"><a href="#AgentKnowledgeManager.sync_with_graph-455"><span class="linenos">455</span></a>                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created relationship: </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;entity1&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;relation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;entity2&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-456"><a href="#AgentKnowledgeManager.sync_with_graph-456"><span class="linenos">456</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-457"><a href="#AgentKnowledgeManager.sync_with_graph-457"><span class="linenos">457</span></a>                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create relationship: </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;entity1&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;relation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;entity2&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-458"><a href="#AgentKnowledgeManager.sync_with_graph-458"><span class="linenos">458</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-459"><a href="#AgentKnowledgeManager.sync_with_graph-459"><span class="linenos">459</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing relationship: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-460"><a href="#AgentKnowledgeManager.sync_with_graph-460"><span class="linenos">460</span></a>                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing relationship: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-461"><a href="#AgentKnowledgeManager.sync_with_graph-461"><span class="linenos">461</span></a>                    
</span><span id="AgentKnowledgeManager.sync_with_graph-462"><a href="#AgentKnowledgeManager.sync_with_graph-462"><span class="linenos">462</span></a>            <span class="c1"># Return combined results</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-463"><a href="#AgentKnowledgeManager.sync_with_graph-463"><span class="linenos">463</span></a>            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-464"><a href="#AgentKnowledgeManager.sync_with_graph-464"><span class="linenos">464</span></a>            
</span><span id="AgentKnowledgeManager.sync_with_graph-465"><a href="#AgentKnowledgeManager.sync_with_graph-465"><span class="linenos">465</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-466"><a href="#AgentKnowledgeManager.sync_with_graph-466"><span class="linenos">466</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error syncing with graph: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.sync_with_graph-467"><a href="#AgentKnowledgeManager.sync_with_graph-467"><span class="linenos">467</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error syncing with graph: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Synchronize the local knowledge base with the graph database.</p>

<p>This method syncs entities and relationships from the local knowledge base
to the LightRAG graph database.</p>

<p>Returns:
    Status message</p>
</div>


                            </div>
                            <div id="AgentKnowledgeManager.query_graph" class="classattr">
                                        <input id="AgentKnowledgeManager.query_graph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">query_graph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="AgentKnowledgeManager.query_graph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentKnowledgeManager.query_graph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentKnowledgeManager.query_graph-592"><a href="#AgentKnowledgeManager.query_graph-592"><span class="linenos">592</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.query_graph-593"><a href="#AgentKnowledgeManager.query_graph-593"><span class="linenos">593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the graph database.</span>
</span><span id="AgentKnowledgeManager.query_graph-594"><a href="#AgentKnowledgeManager.query_graph-594"><span class="linenos">594</span></a><span class="sd">        </span>
</span><span id="AgentKnowledgeManager.query_graph-595"><a href="#AgentKnowledgeManager.query_graph-595"><span class="linenos">595</span></a><span class="sd">        Args:</span>
</span><span id="AgentKnowledgeManager.query_graph-596"><a href="#AgentKnowledgeManager.query_graph-596"><span class="linenos">596</span></a><span class="sd">            query: Cypher query</span>
</span><span id="AgentKnowledgeManager.query_graph-597"><a href="#AgentKnowledgeManager.query_graph-597"><span class="linenos">597</span></a><span class="sd">            </span>
</span><span id="AgentKnowledgeManager.query_graph-598"><a href="#AgentKnowledgeManager.query_graph-598"><span class="linenos">598</span></a><span class="sd">        Returns:</span>
</span><span id="AgentKnowledgeManager.query_graph-599"><a href="#AgentKnowledgeManager.query_graph-599"><span class="linenos">599</span></a><span class="sd">            Query results</span>
</span><span id="AgentKnowledgeManager.query_graph-600"><a href="#AgentKnowledgeManager.query_graph-600"><span class="linenos">600</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentKnowledgeManager.query_graph-601"><a href="#AgentKnowledgeManager.query_graph-601"><span class="linenos">601</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.query_graph-602"><a href="#AgentKnowledgeManager.query_graph-602"><span class="linenos">602</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/graph/query&quot;</span>
</span><span id="AgentKnowledgeManager.query_graph-603"><a href="#AgentKnowledgeManager.query_graph-603"><span class="linenos">603</span></a>            
</span><span id="AgentKnowledgeManager.query_graph-604"><a href="#AgentKnowledgeManager.query_graph-604"><span class="linenos">604</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentKnowledgeManager.query_graph-605"><a href="#AgentKnowledgeManager.query_graph-605"><span class="linenos">605</span></a>                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span>
</span><span id="AgentKnowledgeManager.query_graph-606"><a href="#AgentKnowledgeManager.query_graph-606"><span class="linenos">606</span></a>            <span class="p">}</span>
</span><span id="AgentKnowledgeManager.query_graph-607"><a href="#AgentKnowledgeManager.query_graph-607"><span class="linenos">607</span></a>            
</span><span id="AgentKnowledgeManager.query_graph-608"><a href="#AgentKnowledgeManager.query_graph-608"><span class="linenos">608</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.query_graph-609"><a href="#AgentKnowledgeManager.query_graph-609"><span class="linenos">609</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.query_graph-610"><a href="#AgentKnowledgeManager.query_graph-610"><span class="linenos">610</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.query_graph-611"><a href="#AgentKnowledgeManager.query_graph-611"><span class="linenos">611</span></a>                        <span class="k">return</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.query_graph-612"><a href="#AgentKnowledgeManager.query_graph-612"><span class="linenos">612</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.query_graph-613"><a href="#AgentKnowledgeManager.query_graph-613"><span class="linenos">613</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="AgentKnowledgeManager.query_graph-614"><a href="#AgentKnowledgeManager.query_graph-614"><span class="linenos">614</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to query graph: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.query_graph-615"><a href="#AgentKnowledgeManager.query_graph-615"><span class="linenos">615</span></a>                        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_text</span><span class="p">}</span>
</span><span id="AgentKnowledgeManager.query_graph-616"><a href="#AgentKnowledgeManager.query_graph-616"><span class="linenos">616</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentKnowledgeManager.query_graph-617"><a href="#AgentKnowledgeManager.query_graph-617"><span class="linenos">617</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying graph: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentKnowledgeManager.query_graph-618"><a href="#AgentKnowledgeManager.query_graph-618"><span class="linenos">618</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span></pre></div>


            <div class="docstring"><p>Query the graph database.</p>

<p>Args:
    query: Cypher query</p>

<p>Returns:
    Query results</p>
</div>


                            </div>
                </section>
                <section id="AgentToolManager">
                            <input id="AgentToolManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AgentToolManager</span>:

                <label class="view-source-button" for="AgentToolManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager-20"><a href="#AgentToolManager-20"><span class="linenos"> 20</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AgentToolManager</span><span class="p">:</span>
</span><span id="AgentToolManager-21"><a href="#AgentToolManager-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages tool operations including registration, validation, and execution.&quot;&quot;&quot;</span>
</span><span id="AgentToolManager-22"><a href="#AgentToolManager-22"><span class="linenos"> 22</span></a>    
</span><span id="AgentToolManager-23"><a href="#AgentToolManager-23"><span class="linenos"> 23</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentToolManager-24"><a href="#AgentToolManager-24"><span class="linenos"> 24</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the tool manager.</span>
</span><span id="AgentToolManager-25"><a href="#AgentToolManager-25"><span class="linenos"> 25</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-26"><a href="#AgentToolManager-26"><span class="linenos"> 26</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-27"><a href="#AgentToolManager-27"><span class="linenos"> 27</span></a><span class="sd">            user_id: User identifier for tool operations</span>
</span><span id="AgentToolManager-28"><a href="#AgentToolManager-28"><span class="linenos"> 28</span></a><span class="sd">            storage_dir: Directory for storage files</span>
</span><span id="AgentToolManager-29"><a href="#AgentToolManager-29"><span class="linenos"> 29</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-30"><a href="#AgentToolManager-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgentToolManager-31"><a href="#AgentToolManager-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">storage_dir</span>
</span><span id="AgentToolManager-32"><a href="#AgentToolManager-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager-33"><a href="#AgentToolManager-33"><span class="linenos"> 33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager-34"><a href="#AgentToolManager-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager-35"><a href="#AgentToolManager-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager-36"><a href="#AgentToolManager-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager-37"><a href="#AgentToolManager-37"><span class="linenos"> 37</span></a>        
</span><span id="AgentToolManager-38"><a href="#AgentToolManager-38"><span class="linenos"> 38</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="AgentToolManager-39"><a href="#AgentToolManager-39"><span class="linenos"> 39</span></a>                      <span class="n">tool_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> 
</span><span id="AgentToolManager-40"><a href="#AgentToolManager-40"><span class="linenos"> 40</span></a>                      <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="AgentToolManager-41"><a href="#AgentToolManager-41"><span class="linenos"> 41</span></a>                      <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentToolManager-42"><a href="#AgentToolManager-42"><span class="linenos"> 42</span></a>                      <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;general&quot;</span><span class="p">,</span>
</span><span id="AgentToolManager-43"><a href="#AgentToolManager-43"><span class="linenos"> 43</span></a>                      <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentToolManager-44"><a href="#AgentToolManager-44"><span class="linenos"> 44</span></a>                      <span class="n">examples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentToolManager-45"><a href="#AgentToolManager-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a tool function with the agent.</span>
</span><span id="AgentToolManager-46"><a href="#AgentToolManager-46"><span class="linenos"> 46</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-47"><a href="#AgentToolManager-47"><span class="linenos"> 47</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-48"><a href="#AgentToolManager-48"><span class="linenos"> 48</span></a><span class="sd">            tool_func: The function to register as a tool</span>
</span><span id="AgentToolManager-49"><a href="#AgentToolManager-49"><span class="linenos"> 49</span></a><span class="sd">            name: Optional custom name for the tool (defaults to function name)</span>
</span><span id="AgentToolManager-50"><a href="#AgentToolManager-50"><span class="linenos"> 50</span></a><span class="sd">            description: Optional description of the tool</span>
</span><span id="AgentToolManager-51"><a href="#AgentToolManager-51"><span class="linenos"> 51</span></a><span class="sd">            category: Category for the tool (e.g., &#39;general&#39;, &#39;memory&#39;, &#39;knowledge&#39;)</span>
</span><span id="AgentToolManager-52"><a href="#AgentToolManager-52"><span class="linenos"> 52</span></a><span class="sd">            parameters: Optional parameter descriptions</span>
</span><span id="AgentToolManager-53"><a href="#AgentToolManager-53"><span class="linenos"> 53</span></a><span class="sd">            examples: Optional examples of tool usage</span>
</span><span id="AgentToolManager-54"><a href="#AgentToolManager-54"><span class="linenos"> 54</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-55"><a href="#AgentToolManager-55"><span class="linenos"> 55</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-56"><a href="#AgentToolManager-56"><span class="linenos"> 56</span></a><span class="sd">            The registered tool name</span>
</span><span id="AgentToolManager-57"><a href="#AgentToolManager-57"><span class="linenos"> 57</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-58"><a href="#AgentToolManager-58"><span class="linenos"> 58</span></a>        <span class="c1"># Get function name if not provided</span>
</span><span id="AgentToolManager-59"><a href="#AgentToolManager-59"><span class="linenos"> 59</span></a>        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">tool_func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="AgentToolManager-60"><a href="#AgentToolManager-60"><span class="linenos"> 60</span></a>        
</span><span id="AgentToolManager-61"><a href="#AgentToolManager-61"><span class="linenos"> 61</span></a>        <span class="c1"># Get function signature and docstring</span>
</span><span id="AgentToolManager-62"><a href="#AgentToolManager-62"><span class="linenos"> 62</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span>
</span><span id="AgentToolManager-63"><a href="#AgentToolManager-63"><span class="linenos"> 63</span></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="AgentToolManager-64"><a href="#AgentToolManager-64"><span class="linenos"> 64</span></a>        
</span><span id="AgentToolManager-65"><a href="#AgentToolManager-65"><span class="linenos"> 65</span></a>        <span class="c1"># Extract parameter information</span>
</span><span id="AgentToolManager-66"><a href="#AgentToolManager-66"><span class="linenos"> 66</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager-67"><a href="#AgentToolManager-67"><span class="linenos"> 67</span></a>        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentToolManager-68"><a href="#AgentToolManager-68"><span class="linenos"> 68</span></a>            <span class="c1"># Skip &#39;self&#39; parameter</span>
</span><span id="AgentToolManager-69"><a href="#AgentToolManager-69"><span class="linenos"> 69</span></a>            <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span><span class="p">:</span>
</span><span id="AgentToolManager-70"><a href="#AgentToolManager-70"><span class="linenos"> 70</span></a>                <span class="k">continue</span>
</span><span id="AgentToolManager-71"><a href="#AgentToolManager-71"><span class="linenos"> 71</span></a>                
</span><span id="AgentToolManager-72"><a href="#AgentToolManager-72"><span class="linenos"> 72</span></a>            <span class="n">param_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentToolManager-73"><a href="#AgentToolManager-73"><span class="linenos"> 73</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span> <span class="o">!=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="s2">&quot;Any&quot;</span><span class="p">,</span>
</span><span id="AgentToolManager-74"><a href="#AgentToolManager-74"><span class="linenos"> 74</span></a>                <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span>
</span><span id="AgentToolManager-75"><a href="#AgentToolManager-75"><span class="linenos"> 75</span></a>            <span class="p">}</span>
</span><span id="AgentToolManager-76"><a href="#AgentToolManager-76"><span class="linenos"> 76</span></a>            
</span><span id="AgentToolManager-77"><a href="#AgentToolManager-77"><span class="linenos"> 77</span></a>            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">!=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="AgentToolManager-78"><a href="#AgentToolManager-78"><span class="linenos"> 78</span></a>                <span class="n">param_info</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
</span><span id="AgentToolManager-79"><a href="#AgentToolManager-79"><span class="linenos"> 79</span></a>                
</span><span id="AgentToolManager-80"><a href="#AgentToolManager-80"><span class="linenos"> 80</span></a>            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_info</span>
</span><span id="AgentToolManager-81"><a href="#AgentToolManager-81"><span class="linenos"> 81</span></a>            
</span><span id="AgentToolManager-82"><a href="#AgentToolManager-82"><span class="linenos"> 82</span></a>        <span class="c1"># Register the tool</span>
</span><span id="AgentToolManager-83"><a href="#AgentToolManager-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_func</span>
</span><span id="AgentToolManager-84"><a href="#AgentToolManager-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="n">doc</span>
</span><span id="AgentToolManager-85"><a href="#AgentToolManager-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>
</span><span id="AgentToolManager-86"><a href="#AgentToolManager-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span> <span class="ow">or</span> <span class="n">params</span>
</span><span id="AgentToolManager-87"><a href="#AgentToolManager-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">examples</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="AgentToolManager-88"><a href="#AgentToolManager-88"><span class="linenos"> 88</span></a>        
</span><span id="AgentToolManager-89"><a href="#AgentToolManager-89"><span class="linenos"> 89</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Registered tool: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2"> in category </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-90"><a href="#AgentToolManager-90"><span class="linenos"> 90</span></a>        <span class="k">return</span> <span class="n">tool_name</span>
</span><span id="AgentToolManager-91"><a href="#AgentToolManager-91"><span class="linenos"> 91</span></a>        
</span><span id="AgentToolManager-92"><a href="#AgentToolManager-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unregister_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentToolManager-93"><a href="#AgentToolManager-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unregister a tool.</span>
</span><span id="AgentToolManager-94"><a href="#AgentToolManager-94"><span class="linenos"> 94</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-95"><a href="#AgentToolManager-95"><span class="linenos"> 95</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-96"><a href="#AgentToolManager-96"><span class="linenos"> 96</span></a><span class="sd">            tool_name: Name of the tool to unregister</span>
</span><span id="AgentToolManager-97"><a href="#AgentToolManager-97"><span class="linenos"> 97</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-98"><a href="#AgentToolManager-98"><span class="linenos"> 98</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-99"><a href="#AgentToolManager-99"><span class="linenos"> 99</span></a><span class="sd">            True if tool was unregistered successfully</span>
</span><span id="AgentToolManager-100"><a href="#AgentToolManager-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-101"><a href="#AgentToolManager-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager-102"><a href="#AgentToolManager-102"><span class="linenos">102</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager-103"><a href="#AgentToolManager-103"><span class="linenos">103</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager-104"><a href="#AgentToolManager-104"><span class="linenos">104</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager-105"><a href="#AgentToolManager-105"><span class="linenos">105</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager-106"><a href="#AgentToolManager-106"><span class="linenos">106</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager-107"><a href="#AgentToolManager-107"><span class="linenos">107</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unregistered tool: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-108"><a href="#AgentToolManager-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentToolManager-109"><a href="#AgentToolManager-109"><span class="linenos">109</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentToolManager-110"><a href="#AgentToolManager-110"><span class="linenos">110</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-111"><a href="#AgentToolManager-111"><span class="linenos">111</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentToolManager-112"><a href="#AgentToolManager-112"><span class="linenos">112</span></a>            
</span><span id="AgentToolManager-113"><a href="#AgentToolManager-113"><span class="linenos">113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
</span><span id="AgentToolManager-114"><a href="#AgentToolManager-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a tool function by name.</span>
</span><span id="AgentToolManager-115"><a href="#AgentToolManager-115"><span class="linenos">115</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-116"><a href="#AgentToolManager-116"><span class="linenos">116</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-117"><a href="#AgentToolManager-117"><span class="linenos">117</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="AgentToolManager-118"><a href="#AgentToolManager-118"><span class="linenos">118</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-119"><a href="#AgentToolManager-119"><span class="linenos">119</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-120"><a href="#AgentToolManager-120"><span class="linenos">120</span></a><span class="sd">            Tool function or None if not found</span>
</span><span id="AgentToolManager-121"><a href="#AgentToolManager-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-122"><a href="#AgentToolManager-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="AgentToolManager-123"><a href="#AgentToolManager-123"><span class="linenos">123</span></a>        
</span><span id="AgentToolManager-124"><a href="#AgentToolManager-124"><span class="linenos">124</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tool_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentToolManager-125"><a href="#AgentToolManager-125"><span class="linenos">125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about a tool.</span>
</span><span id="AgentToolManager-126"><a href="#AgentToolManager-126"><span class="linenos">126</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-127"><a href="#AgentToolManager-127"><span class="linenos">127</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-128"><a href="#AgentToolManager-128"><span class="linenos">128</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="AgentToolManager-129"><a href="#AgentToolManager-129"><span class="linenos">129</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-130"><a href="#AgentToolManager-130"><span class="linenos">130</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-131"><a href="#AgentToolManager-131"><span class="linenos">131</span></a><span class="sd">            Dictionary with tool information</span>
</span><span id="AgentToolManager-132"><a href="#AgentToolManager-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-133"><a href="#AgentToolManager-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager-134"><a href="#AgentToolManager-134"><span class="linenos">134</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span id="AgentToolManager-135"><a href="#AgentToolManager-135"><span class="linenos">135</span></a>            
</span><span id="AgentToolManager-136"><a href="#AgentToolManager-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentToolManager-137"><a href="#AgentToolManager-137"><span class="linenos">137</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="AgentToolManager-138"><a href="#AgentToolManager-138"><span class="linenos">138</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager-139"><a href="#AgentToolManager-139"><span class="linenos">139</span></a>            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager-140"><a href="#AgentToolManager-140"><span class="linenos">140</span></a>            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="AgentToolManager-141"><a href="#AgentToolManager-141"><span class="linenos">141</span></a>            <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="AgentToolManager-142"><a href="#AgentToolManager-142"><span class="linenos">142</span></a>        <span class="p">}</span>
</span><span id="AgentToolManager-143"><a href="#AgentToolManager-143"><span class="linenos">143</span></a>        
</span><span id="AgentToolManager-144"><a href="#AgentToolManager-144"><span class="linenos">144</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentToolManager-145"><a href="#AgentToolManager-145"><span class="linenos">145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about all registered tools, optionally filtered by category.</span>
</span><span id="AgentToolManager-146"><a href="#AgentToolManager-146"><span class="linenos">146</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-147"><a href="#AgentToolManager-147"><span class="linenos">147</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-148"><a href="#AgentToolManager-148"><span class="linenos">148</span></a><span class="sd">            category: Optional category to filter by</span>
</span><span id="AgentToolManager-149"><a href="#AgentToolManager-149"><span class="linenos">149</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-150"><a href="#AgentToolManager-150"><span class="linenos">150</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-151"><a href="#AgentToolManager-151"><span class="linenos">151</span></a><span class="sd">            List of tool information dictionaries</span>
</span><span id="AgentToolManager-152"><a href="#AgentToolManager-152"><span class="linenos">152</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-153"><a href="#AgentToolManager-153"><span class="linenos">153</span></a>        <span class="n">tools_info</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentToolManager-154"><a href="#AgentToolManager-154"><span class="linenos">154</span></a>        
</span><span id="AgentToolManager-155"><a href="#AgentToolManager-155"><span class="linenos">155</span></a>        <span class="k">for</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager-156"><a href="#AgentToolManager-156"><span class="linenos">156</span></a>            <span class="c1"># Skip if category filter is applied and doesn&#39;t match</span>
</span><span id="AgentToolManager-157"><a href="#AgentToolManager-157"><span class="linenos">157</span></a>            <span class="k">if</span> <span class="n">category</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">category</span><span class="p">:</span>
</span><span id="AgentToolManager-158"><a href="#AgentToolManager-158"><span class="linenos">158</span></a>                <span class="k">continue</span>
</span><span id="AgentToolManager-159"><a href="#AgentToolManager-159"><span class="linenos">159</span></a>                
</span><span id="AgentToolManager-160"><a href="#AgentToolManager-160"><span class="linenos">160</span></a>            <span class="n">tools_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tool_info</span><span class="p">(</span><span class="n">tool_name</span><span class="p">))</span>
</span><span id="AgentToolManager-161"><a href="#AgentToolManager-161"><span class="linenos">161</span></a>            
</span><span id="AgentToolManager-162"><a href="#AgentToolManager-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="n">tools_info</span>
</span><span id="AgentToolManager-163"><a href="#AgentToolManager-163"><span class="linenos">163</span></a>        
</span><span id="AgentToolManager-164"><a href="#AgentToolManager-164"><span class="linenos">164</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tool_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="AgentToolManager-165"><a href="#AgentToolManager-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all tool categories.</span>
</span><span id="AgentToolManager-166"><a href="#AgentToolManager-166"><span class="linenos">166</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-167"><a href="#AgentToolManager-167"><span class="linenos">167</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-168"><a href="#AgentToolManager-168"><span class="linenos">168</span></a><span class="sd">            List of unique tool categories</span>
</span><span id="AgentToolManager-169"><a href="#AgentToolManager-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-170"><a href="#AgentToolManager-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="AgentToolManager-171"><a href="#AgentToolManager-171"><span class="linenos">171</span></a>        
</span><span id="AgentToolManager-172"><a href="#AgentToolManager-172"><span class="linenos">172</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="AgentToolManager-173"><a href="#AgentToolManager-173"><span class="linenos">173</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a tool by name with the provided arguments.</span>
</span><span id="AgentToolManager-174"><a href="#AgentToolManager-174"><span class="linenos">174</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-175"><a href="#AgentToolManager-175"><span class="linenos">175</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-176"><a href="#AgentToolManager-176"><span class="linenos">176</span></a><span class="sd">            tool_name: Name of the tool to execute</span>
</span><span id="AgentToolManager-177"><a href="#AgentToolManager-177"><span class="linenos">177</span></a><span class="sd">            **kwargs: Arguments to pass to the tool</span>
</span><span id="AgentToolManager-178"><a href="#AgentToolManager-178"><span class="linenos">178</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-179"><a href="#AgentToolManager-179"><span class="linenos">179</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-180"><a href="#AgentToolManager-180"><span class="linenos">180</span></a><span class="sd">            Result of the tool execution</span>
</span><span id="AgentToolManager-181"><a href="#AgentToolManager-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-182"><a href="#AgentToolManager-182"><span class="linenos">182</span></a>        <span class="n">tool_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="AgentToolManager-183"><a href="#AgentToolManager-183"><span class="linenos">183</span></a>        
</span><span id="AgentToolManager-184"><a href="#AgentToolManager-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_func</span><span class="p">:</span>
</span><span id="AgentToolManager-185"><a href="#AgentToolManager-185"><span class="linenos">185</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager-186"><a href="#AgentToolManager-186"><span class="linenos">186</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentToolManager-187"><a href="#AgentToolManager-187"><span class="linenos">187</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span>
</span><span id="AgentToolManager-188"><a href="#AgentToolManager-188"><span class="linenos">188</span></a>            
</span><span id="AgentToolManager-189"><a href="#AgentToolManager-189"><span class="linenos">189</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentToolManager-190"><a href="#AgentToolManager-190"><span class="linenos">190</span></a>            <span class="c1"># Check if the tool is a coroutine function</span>
</span><span id="AgentToolManager-191"><a href="#AgentToolManager-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">tool_func</span><span class="p">):</span>
</span><span id="AgentToolManager-192"><a href="#AgentToolManager-192"><span class="linenos">192</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AgentToolManager-193"><a href="#AgentToolManager-193"><span class="linenos">193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentToolManager-194"><a href="#AgentToolManager-194"><span class="linenos">194</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AgentToolManager-195"><a href="#AgentToolManager-195"><span class="linenos">195</span></a>                
</span><span id="AgentToolManager-196"><a href="#AgentToolManager-196"><span class="linenos">196</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentToolManager-197"><a href="#AgentToolManager-197"><span class="linenos">197</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentToolManager-198"><a href="#AgentToolManager-198"><span class="linenos">198</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error executing tool </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager-199"><a href="#AgentToolManager-199"><span class="linenos">199</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentToolManager-200"><a href="#AgentToolManager-200"><span class="linenos">200</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span>
</span><span id="AgentToolManager-201"><a href="#AgentToolManager-201"><span class="linenos">201</span></a>            
</span><span id="AgentToolManager-202"><a href="#AgentToolManager-202"><span class="linenos">202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_tool_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="AgentToolManager-203"><a href="#AgentToolManager-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate arguments for a tool.</span>
</span><span id="AgentToolManager-204"><a href="#AgentToolManager-204"><span class="linenos">204</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-205"><a href="#AgentToolManager-205"><span class="linenos">205</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-206"><a href="#AgentToolManager-206"><span class="linenos">206</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="AgentToolManager-207"><a href="#AgentToolManager-207"><span class="linenos">207</span></a><span class="sd">            args: Arguments to validate</span>
</span><span id="AgentToolManager-208"><a href="#AgentToolManager-208"><span class="linenos">208</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-209"><a href="#AgentToolManager-209"><span class="linenos">209</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-210"><a href="#AgentToolManager-210"><span class="linenos">210</span></a><span class="sd">            Tuple of (is_valid, error_message)</span>
</span><span id="AgentToolManager-211"><a href="#AgentToolManager-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-212"><a href="#AgentToolManager-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager-213"><a href="#AgentToolManager-213"><span class="linenos">213</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager-214"><a href="#AgentToolManager-214"><span class="linenos">214</span></a>            
</span><span id="AgentToolManager-215"><a href="#AgentToolManager-215"><span class="linenos">215</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="AgentToolManager-216"><a href="#AgentToolManager-216"><span class="linenos">216</span></a>        
</span><span id="AgentToolManager-217"><a href="#AgentToolManager-217"><span class="linenos">217</span></a>        <span class="c1"># Check for required parameters</span>
</span><span id="AgentToolManager-218"><a href="#AgentToolManager-218"><span class="linenos">218</span></a>        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_info</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentToolManager-219"><a href="#AgentToolManager-219"><span class="linenos">219</span></a>            <span class="k">if</span> <span class="n">param_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="AgentToolManager-220"><a href="#AgentToolManager-220"><span class="linenos">220</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Missing required parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager-221"><a href="#AgentToolManager-221"><span class="linenos">221</span></a>                
</span><span id="AgentToolManager-222"><a href="#AgentToolManager-222"><span class="linenos">222</span></a>        <span class="c1"># Check for unknown parameters</span>
</span><span id="AgentToolManager-223"><a href="#AgentToolManager-223"><span class="linenos">223</span></a>        <span class="k">for</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="AgentToolManager-224"><a href="#AgentToolManager-224"><span class="linenos">224</span></a>            <span class="k">if</span> <span class="n">arg_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
</span><span id="AgentToolManager-225"><a href="#AgentToolManager-225"><span class="linenos">225</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown parameter: </span><span class="si">{</span><span class="n">arg_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager-226"><a href="#AgentToolManager-226"><span class="linenos">226</span></a>                
</span><span id="AgentToolManager-227"><a href="#AgentToolManager-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="AgentToolManager-228"><a href="#AgentToolManager-228"><span class="linenos">228</span></a>        
</span><span id="AgentToolManager-229"><a href="#AgentToolManager-229"><span class="linenos">229</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">format_tool_for_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentToolManager-230"><a href="#AgentToolManager-230"><span class="linenos">230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Format tool information for LLM consumption.</span>
</span><span id="AgentToolManager-231"><a href="#AgentToolManager-231"><span class="linenos">231</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-232"><a href="#AgentToolManager-232"><span class="linenos">232</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-233"><a href="#AgentToolManager-233"><span class="linenos">233</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="AgentToolManager-234"><a href="#AgentToolManager-234"><span class="linenos">234</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-235"><a href="#AgentToolManager-235"><span class="linenos">235</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-236"><a href="#AgentToolManager-236"><span class="linenos">236</span></a><span class="sd">            Dictionary with formatted tool information</span>
</span><span id="AgentToolManager-237"><a href="#AgentToolManager-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-238"><a href="#AgentToolManager-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager-239"><a href="#AgentToolManager-239"><span class="linenos">239</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span id="AgentToolManager-240"><a href="#AgentToolManager-240"><span class="linenos">240</span></a>            
</span><span id="AgentToolManager-241"><a href="#AgentToolManager-241"><span class="linenos">241</span></a>        <span class="n">tool_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_info</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="AgentToolManager-242"><a href="#AgentToolManager-242"><span class="linenos">242</span></a>        
</span><span id="AgentToolManager-243"><a href="#AgentToolManager-243"><span class="linenos">243</span></a>        <span class="c1"># Format parameters for LLM</span>
</span><span id="AgentToolManager-244"><a href="#AgentToolManager-244"><span class="linenos">244</span></a>        <span class="n">formatted_params</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentToolManager-245"><a href="#AgentToolManager-245"><span class="linenos">245</span></a>        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_info</span> <span class="ow">in</span> <span class="n">tool_info</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentToolManager-246"><a href="#AgentToolManager-246"><span class="linenos">246</span></a>            <span class="n">param_desc</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentToolManager-247"><a href="#AgentToolManager-247"><span class="linenos">247</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">param_name</span><span class="p">,</span>
</span><span id="AgentToolManager-248"><a href="#AgentToolManager-248"><span class="linenos">248</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">param_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;Any&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager-249"><a href="#AgentToolManager-249"><span class="linenos">249</span></a>                <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="n">param_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="AgentToolManager-250"><a href="#AgentToolManager-250"><span class="linenos">250</span></a>            <span class="p">}</span>
</span><span id="AgentToolManager-251"><a href="#AgentToolManager-251"><span class="linenos">251</span></a>            
</span><span id="AgentToolManager-252"><a href="#AgentToolManager-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">param_info</span><span class="p">:</span>
</span><span id="AgentToolManager-253"><a href="#AgentToolManager-253"><span class="linenos">253</span></a>                <span class="n">param_desc</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_info</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
</span><span id="AgentToolManager-254"><a href="#AgentToolManager-254"><span class="linenos">254</span></a>                
</span><span id="AgentToolManager-255"><a href="#AgentToolManager-255"><span class="linenos">255</span></a>            <span class="n">formatted_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_desc</span><span class="p">)</span>
</span><span id="AgentToolManager-256"><a href="#AgentToolManager-256"><span class="linenos">256</span></a>            
</span><span id="AgentToolManager-257"><a href="#AgentToolManager-257"><span class="linenos">257</span></a>        <span class="c1"># Format examples for LLM</span>
</span><span id="AgentToolManager-258"><a href="#AgentToolManager-258"><span class="linenos">258</span></a>        <span class="n">formatted_examples</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentToolManager-259"><a href="#AgentToolManager-259"><span class="linenos">259</span></a>        <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">tool_info</span><span class="p">[</span><span class="s2">&quot;examples&quot;</span><span class="p">]:</span>
</span><span id="AgentToolManager-260"><a href="#AgentToolManager-260"><span class="linenos">260</span></a>            <span class="n">formatted_examples</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="AgentToolManager-261"><a href="#AgentToolManager-261"><span class="linenos">261</span></a>                <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="AgentToolManager-262"><a href="#AgentToolManager-262"><span class="linenos">262</span></a>                <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-263"><a href="#AgentToolManager-263"><span class="linenos">263</span></a>            <span class="p">})</span>
</span><span id="AgentToolManager-264"><a href="#AgentToolManager-264"><span class="linenos">264</span></a>            
</span><span id="AgentToolManager-265"><a href="#AgentToolManager-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentToolManager-266"><a href="#AgentToolManager-266"><span class="linenos">266</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="AgentToolManager-267"><a href="#AgentToolManager-267"><span class="linenos">267</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">tool_info</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
</span><span id="AgentToolManager-268"><a href="#AgentToolManager-268"><span class="linenos">268</span></a>            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">formatted_params</span><span class="p">,</span>
</span><span id="AgentToolManager-269"><a href="#AgentToolManager-269"><span class="linenos">269</span></a>            <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="n">formatted_examples</span>
</span><span id="AgentToolManager-270"><a href="#AgentToolManager-270"><span class="linenos">270</span></a>        <span class="p">}</span>
</span><span id="AgentToolManager-271"><a href="#AgentToolManager-271"><span class="linenos">271</span></a>        
</span><span id="AgentToolManager-272"><a href="#AgentToolManager-272"><span class="linenos">272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">format_all_tools_for_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentToolManager-273"><a href="#AgentToolManager-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Format all tools for LLM consumption, optionally filtered by category.</span>
</span><span id="AgentToolManager-274"><a href="#AgentToolManager-274"><span class="linenos">274</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-275"><a href="#AgentToolManager-275"><span class="linenos">275</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-276"><a href="#AgentToolManager-276"><span class="linenos">276</span></a><span class="sd">            category: Optional category to filter by</span>
</span><span id="AgentToolManager-277"><a href="#AgentToolManager-277"><span class="linenos">277</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-278"><a href="#AgentToolManager-278"><span class="linenos">278</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-279"><a href="#AgentToolManager-279"><span class="linenos">279</span></a><span class="sd">            List of formatted tool information dictionaries</span>
</span><span id="AgentToolManager-280"><a href="#AgentToolManager-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-281"><a href="#AgentToolManager-281"><span class="linenos">281</span></a>        <span class="n">formatted_tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentToolManager-282"><a href="#AgentToolManager-282"><span class="linenos">282</span></a>        
</span><span id="AgentToolManager-283"><a href="#AgentToolManager-283"><span class="linenos">283</span></a>        <span class="k">for</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager-284"><a href="#AgentToolManager-284"><span class="linenos">284</span></a>            <span class="c1"># Skip if category filter is applied and doesn&#39;t match</span>
</span><span id="AgentToolManager-285"><a href="#AgentToolManager-285"><span class="linenos">285</span></a>            <span class="k">if</span> <span class="n">category</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">category</span><span class="p">:</span>
</span><span id="AgentToolManager-286"><a href="#AgentToolManager-286"><span class="linenos">286</span></a>                <span class="k">continue</span>
</span><span id="AgentToolManager-287"><a href="#AgentToolManager-287"><span class="linenos">287</span></a>                
</span><span id="AgentToolManager-288"><a href="#AgentToolManager-288"><span class="linenos">288</span></a>            <span class="n">formatted_tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_tool_for_llm</span><span class="p">(</span><span class="n">tool_name</span><span class="p">))</span>
</span><span id="AgentToolManager-289"><a href="#AgentToolManager-289"><span class="linenos">289</span></a>            
</span><span id="AgentToolManager-290"><a href="#AgentToolManager-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="n">formatted_tools</span>
</span><span id="AgentToolManager-291"><a href="#AgentToolManager-291"><span class="linenos">291</span></a>        
</span><span id="AgentToolManager-292"><a href="#AgentToolManager-292"><span class="linenos">292</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_tools_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentToolManager-293"><a href="#AgentToolManager-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save tool configuration to a file.</span>
</span><span id="AgentToolManager-294"><a href="#AgentToolManager-294"><span class="linenos">294</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-295"><a href="#AgentToolManager-295"><span class="linenos">295</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-296"><a href="#AgentToolManager-296"><span class="linenos">296</span></a><span class="sd">            filename: Optional filename (defaults to user_id_tools.json)</span>
</span><span id="AgentToolManager-297"><a href="#AgentToolManager-297"><span class="linenos">297</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-298"><a href="#AgentToolManager-298"><span class="linenos">298</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-299"><a href="#AgentToolManager-299"><span class="linenos">299</span></a><span class="sd">            True if configuration was saved successfully</span>
</span><span id="AgentToolManager-300"><a href="#AgentToolManager-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-301"><a href="#AgentToolManager-301"><span class="linenos">301</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentToolManager-302"><a href="#AgentToolManager-302"><span class="linenos">302</span></a>            <span class="c1"># Use default filename if not provided</span>
</span><span id="AgentToolManager-303"><a href="#AgentToolManager-303"><span class="linenos">303</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="AgentToolManager-304"><a href="#AgentToolManager-304"><span class="linenos">304</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_tools.json&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-305"><a href="#AgentToolManager-305"><span class="linenos">305</span></a>                
</span><span id="AgentToolManager-306"><a href="#AgentToolManager-306"><span class="linenos">306</span></a>            <span class="c1"># Create directory if it doesn&#39;t exist</span>
</span><span id="AgentToolManager-307"><a href="#AgentToolManager-307"><span class="linenos">307</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AgentToolManager-308"><a href="#AgentToolManager-308"><span class="linenos">308</span></a>            
</span><span id="AgentToolManager-309"><a href="#AgentToolManager-309"><span class="linenos">309</span></a>            <span class="c1"># Prepare tool configuration</span>
</span><span id="AgentToolManager-310"><a href="#AgentToolManager-310"><span class="linenos">310</span></a>            <span class="n">tools_config</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager-311"><a href="#AgentToolManager-311"><span class="linenos">311</span></a>            
</span><span id="AgentToolManager-312"><a href="#AgentToolManager-312"><span class="linenos">312</span></a>            <span class="k">for</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager-313"><a href="#AgentToolManager-313"><span class="linenos">313</span></a>                <span class="c1"># Skip built-in tools that can&#39;t be serialized</span>
</span><span id="AgentToolManager-314"><a href="#AgentToolManager-314"><span class="linenos">314</span></a>                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isbuiltin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]):</span>
</span><span id="AgentToolManager-315"><a href="#AgentToolManager-315"><span class="linenos">315</span></a>                    <span class="k">continue</span>
</span><span id="AgentToolManager-316"><a href="#AgentToolManager-316"><span class="linenos">316</span></a>                    
</span><span id="AgentToolManager-317"><a href="#AgentToolManager-317"><span class="linenos">317</span></a>                <span class="n">tools_config</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentToolManager-318"><a href="#AgentToolManager-318"><span class="linenos">318</span></a>                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager-319"><a href="#AgentToolManager-319"><span class="linenos">319</span></a>                    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager-320"><a href="#AgentToolManager-320"><span class="linenos">320</span></a>                    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="AgentToolManager-321"><a href="#AgentToolManager-321"><span class="linenos">321</span></a>                    <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="AgentToolManager-322"><a href="#AgentToolManager-322"><span class="linenos">322</span></a>                <span class="p">}</span>
</span><span id="AgentToolManager-323"><a href="#AgentToolManager-323"><span class="linenos">323</span></a>                
</span><span id="AgentToolManager-324"><a href="#AgentToolManager-324"><span class="linenos">324</span></a>            <span class="c1"># Save to file</span>
</span><span id="AgentToolManager-325"><a href="#AgentToolManager-325"><span class="linenos">325</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="AgentToolManager-326"><a href="#AgentToolManager-326"><span class="linenos">326</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tools_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="AgentToolManager-327"><a href="#AgentToolManager-327"><span class="linenos">327</span></a>                
</span><span id="AgentToolManager-328"><a href="#AgentToolManager-328"><span class="linenos">328</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved tools configuration to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-329"><a href="#AgentToolManager-329"><span class="linenos">329</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentToolManager-330"><a href="#AgentToolManager-330"><span class="linenos">330</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentToolManager-331"><a href="#AgentToolManager-331"><span class="linenos">331</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving tools configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-332"><a href="#AgentToolManager-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentToolManager-333"><a href="#AgentToolManager-333"><span class="linenos">333</span></a>            
</span><span id="AgentToolManager-334"><a href="#AgentToolManager-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_tools_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentToolManager-335"><a href="#AgentToolManager-335"><span class="linenos">335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load tool configuration from a file.</span>
</span><span id="AgentToolManager-336"><a href="#AgentToolManager-336"><span class="linenos">336</span></a><span class="sd">        </span>
</span><span id="AgentToolManager-337"><a href="#AgentToolManager-337"><span class="linenos">337</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager-338"><a href="#AgentToolManager-338"><span class="linenos">338</span></a><span class="sd">            filename: Optional filename (defaults to user_id_tools.json)</span>
</span><span id="AgentToolManager-339"><a href="#AgentToolManager-339"><span class="linenos">339</span></a><span class="sd">            </span>
</span><span id="AgentToolManager-340"><a href="#AgentToolManager-340"><span class="linenos">340</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager-341"><a href="#AgentToolManager-341"><span class="linenos">341</span></a><span class="sd">            True if configuration was loaded successfully</span>
</span><span id="AgentToolManager-342"><a href="#AgentToolManager-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager-343"><a href="#AgentToolManager-343"><span class="linenos">343</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentToolManager-344"><a href="#AgentToolManager-344"><span class="linenos">344</span></a>            <span class="c1"># Use default filename if not provided</span>
</span><span id="AgentToolManager-345"><a href="#AgentToolManager-345"><span class="linenos">345</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="AgentToolManager-346"><a href="#AgentToolManager-346"><span class="linenos">346</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_tools.json&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-347"><a href="#AgentToolManager-347"><span class="linenos">347</span></a>                
</span><span id="AgentToolManager-348"><a href="#AgentToolManager-348"><span class="linenos">348</span></a>            <span class="c1"># Check if file exists</span>
</span><span id="AgentToolManager-349"><a href="#AgentToolManager-349"><span class="linenos">349</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="AgentToolManager-350"><a href="#AgentToolManager-350"><span class="linenos">350</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tools configuration file not found: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-351"><a href="#AgentToolManager-351"><span class="linenos">351</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentToolManager-352"><a href="#AgentToolManager-352"><span class="linenos">352</span></a>                
</span><span id="AgentToolManager-353"><a href="#AgentToolManager-353"><span class="linenos">353</span></a>            <span class="c1"># Load from file</span>
</span><span id="AgentToolManager-354"><a href="#AgentToolManager-354"><span class="linenos">354</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="AgentToolManager-355"><a href="#AgentToolManager-355"><span class="linenos">355</span></a>                <span class="n">tools_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="AgentToolManager-356"><a href="#AgentToolManager-356"><span class="linenos">356</span></a>                
</span><span id="AgentToolManager-357"><a href="#AgentToolManager-357"><span class="linenos">357</span></a>            <span class="c1"># Update tool configuration</span>
</span><span id="AgentToolManager-358"><a href="#AgentToolManager-358"><span class="linenos">358</span></a>            <span class="k">for</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">tools_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentToolManager-359"><a href="#AgentToolManager-359"><span class="linenos">359</span></a>                <span class="c1"># Skip if tool doesn&#39;t exist</span>
</span><span id="AgentToolManager-360"><a href="#AgentToolManager-360"><span class="linenos">360</span></a>                <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager-361"><a href="#AgentToolManager-361"><span class="linenos">361</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-362"><a href="#AgentToolManager-362"><span class="linenos">362</span></a>                    <span class="k">continue</span>
</span><span id="AgentToolManager-363"><a href="#AgentToolManager-363"><span class="linenos">363</span></a>                    
</span><span id="AgentToolManager-364"><a href="#AgentToolManager-364"><span class="linenos">364</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-365"><a href="#AgentToolManager-365"><span class="linenos">365</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-366"><a href="#AgentToolManager-366"><span class="linenos">366</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="AgentToolManager-367"><a href="#AgentToolManager-367"><span class="linenos">367</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;examples&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="AgentToolManager-368"><a href="#AgentToolManager-368"><span class="linenos">368</span></a>                
</span><span id="AgentToolManager-369"><a href="#AgentToolManager-369"><span class="linenos">369</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded tools configuration from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-370"><a href="#AgentToolManager-370"><span class="linenos">370</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentToolManager-371"><a href="#AgentToolManager-371"><span class="linenos">371</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentToolManager-372"><a href="#AgentToolManager-372"><span class="linenos">372</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading tools configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager-373"><a href="#AgentToolManager-373"><span class="linenos">373</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Manages tool operations including registration, validation, and execution.</p>
</div>


                            <div id="AgentToolManager.__init__" class="classattr">
                                        <input id="AgentToolManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AgentToolManager</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="AgentToolManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.__init__-23"><a href="#AgentToolManager.__init__-23"><span class="linenos">23</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AgentToolManager.__init__-24"><a href="#AgentToolManager.__init__-24"><span class="linenos">24</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the tool manager.</span>
</span><span id="AgentToolManager.__init__-25"><a href="#AgentToolManager.__init__-25"><span class="linenos">25</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.__init__-26"><a href="#AgentToolManager.__init__-26"><span class="linenos">26</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.__init__-27"><a href="#AgentToolManager.__init__-27"><span class="linenos">27</span></a><span class="sd">            user_id: User identifier for tool operations</span>
</span><span id="AgentToolManager.__init__-28"><a href="#AgentToolManager.__init__-28"><span class="linenos">28</span></a><span class="sd">            storage_dir: Directory for storage files</span>
</span><span id="AgentToolManager.__init__-29"><a href="#AgentToolManager.__init__-29"><span class="linenos">29</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.__init__-30"><a href="#AgentToolManager.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="AgentToolManager.__init__-31"><a href="#AgentToolManager.__init__-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">storage_dir</span>
</span><span id="AgentToolManager.__init__-32"><a href="#AgentToolManager.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager.__init__-33"><a href="#AgentToolManager.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager.__init__-34"><a href="#AgentToolManager.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager.__init__-35"><a href="#AgentToolManager.__init__-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager.__init__-36"><a href="#AgentToolManager.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the tool manager.</p>

<p>Args:
    user_id: User identifier for tool operations
    storage_dir: Directory for storage files</p>
</div>


                            </div>
                            <div id="AgentToolManager.user_id" class="classattr">
                                <div class="attr variable">
            <span class="name">user_id</span>

        
    </div>
    <a class="headerlink" href="#AgentToolManager.user_id"></a>
    
    

                            </div>
                            <div id="AgentToolManager.storage_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">storage_dir</span>

        
    </div>
    <a class="headerlink" href="#AgentToolManager.storage_dir"></a>
    
    

                            </div>
                            <div id="AgentToolManager.tools" class="classattr">
                                <div class="attr variable">
            <span class="name">tools</span>

        
    </div>
    <a class="headerlink" href="#AgentToolManager.tools"></a>
    
    

                            </div>
                            <div id="AgentToolManager.tool_categories" class="classattr">
                                <div class="attr variable">
            <span class="name">tool_categories</span>

        
    </div>
    <a class="headerlink" href="#AgentToolManager.tool_categories"></a>
    
    

                            </div>
                            <div id="AgentToolManager.tool_descriptions" class="classattr">
                                <div class="attr variable">
            <span class="name">tool_descriptions</span>

        
    </div>
    <a class="headerlink" href="#AgentToolManager.tool_descriptions"></a>
    
    

                            </div>
                            <div id="AgentToolManager.tool_parameters" class="classattr">
                                <div class="attr variable">
            <span class="name">tool_parameters</span>

        
    </div>
    <a class="headerlink" href="#AgentToolManager.tool_parameters"></a>
    
    

                            </div>
                            <div id="AgentToolManager.tool_examples" class="classattr">
                                <div class="attr variable">
            <span class="name">tool_examples</span>

        
    </div>
    <a class="headerlink" href="#AgentToolManager.tool_examples"></a>
    
    

                            </div>
                            <div id="AgentToolManager.register_tool" class="classattr">
                                        <input id="AgentToolManager.register_tool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_tool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tool_func</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;general&#39;</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">examples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.register_tool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.register_tool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.register_tool-38"><a href="#AgentToolManager.register_tool-38"><span class="linenos">38</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="AgentToolManager.register_tool-39"><a href="#AgentToolManager.register_tool-39"><span class="linenos">39</span></a>                      <span class="n">tool_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> 
</span><span id="AgentToolManager.register_tool-40"><a href="#AgentToolManager.register_tool-40"><span class="linenos">40</span></a>                      <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="AgentToolManager.register_tool-41"><a href="#AgentToolManager.register_tool-41"><span class="linenos">41</span></a>                      <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentToolManager.register_tool-42"><a href="#AgentToolManager.register_tool-42"><span class="linenos">42</span></a>                      <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;general&quot;</span><span class="p">,</span>
</span><span id="AgentToolManager.register_tool-43"><a href="#AgentToolManager.register_tool-43"><span class="linenos">43</span></a>                      <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AgentToolManager.register_tool-44"><a href="#AgentToolManager.register_tool-44"><span class="linenos">44</span></a>                      <span class="n">examples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AgentToolManager.register_tool-45"><a href="#AgentToolManager.register_tool-45"><span class="linenos">45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a tool function with the agent.</span>
</span><span id="AgentToolManager.register_tool-46"><a href="#AgentToolManager.register_tool-46"><span class="linenos">46</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.register_tool-47"><a href="#AgentToolManager.register_tool-47"><span class="linenos">47</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.register_tool-48"><a href="#AgentToolManager.register_tool-48"><span class="linenos">48</span></a><span class="sd">            tool_func: The function to register as a tool</span>
</span><span id="AgentToolManager.register_tool-49"><a href="#AgentToolManager.register_tool-49"><span class="linenos">49</span></a><span class="sd">            name: Optional custom name for the tool (defaults to function name)</span>
</span><span id="AgentToolManager.register_tool-50"><a href="#AgentToolManager.register_tool-50"><span class="linenos">50</span></a><span class="sd">            description: Optional description of the tool</span>
</span><span id="AgentToolManager.register_tool-51"><a href="#AgentToolManager.register_tool-51"><span class="linenos">51</span></a><span class="sd">            category: Category for the tool (e.g., &#39;general&#39;, &#39;memory&#39;, &#39;knowledge&#39;)</span>
</span><span id="AgentToolManager.register_tool-52"><a href="#AgentToolManager.register_tool-52"><span class="linenos">52</span></a><span class="sd">            parameters: Optional parameter descriptions</span>
</span><span id="AgentToolManager.register_tool-53"><a href="#AgentToolManager.register_tool-53"><span class="linenos">53</span></a><span class="sd">            examples: Optional examples of tool usage</span>
</span><span id="AgentToolManager.register_tool-54"><a href="#AgentToolManager.register_tool-54"><span class="linenos">54</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.register_tool-55"><a href="#AgentToolManager.register_tool-55"><span class="linenos">55</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.register_tool-56"><a href="#AgentToolManager.register_tool-56"><span class="linenos">56</span></a><span class="sd">            The registered tool name</span>
</span><span id="AgentToolManager.register_tool-57"><a href="#AgentToolManager.register_tool-57"><span class="linenos">57</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.register_tool-58"><a href="#AgentToolManager.register_tool-58"><span class="linenos">58</span></a>        <span class="c1"># Get function name if not provided</span>
</span><span id="AgentToolManager.register_tool-59"><a href="#AgentToolManager.register_tool-59"><span class="linenos">59</span></a>        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">tool_func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="AgentToolManager.register_tool-60"><a href="#AgentToolManager.register_tool-60"><span class="linenos">60</span></a>        
</span><span id="AgentToolManager.register_tool-61"><a href="#AgentToolManager.register_tool-61"><span class="linenos">61</span></a>        <span class="c1"># Get function signature and docstring</span>
</span><span id="AgentToolManager.register_tool-62"><a href="#AgentToolManager.register_tool-62"><span class="linenos">62</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span>
</span><span id="AgentToolManager.register_tool-63"><a href="#AgentToolManager.register_tool-63"><span class="linenos">63</span></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="AgentToolManager.register_tool-64"><a href="#AgentToolManager.register_tool-64"><span class="linenos">64</span></a>        
</span><span id="AgentToolManager.register_tool-65"><a href="#AgentToolManager.register_tool-65"><span class="linenos">65</span></a>        <span class="c1"># Extract parameter information</span>
</span><span id="AgentToolManager.register_tool-66"><a href="#AgentToolManager.register_tool-66"><span class="linenos">66</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager.register_tool-67"><a href="#AgentToolManager.register_tool-67"><span class="linenos">67</span></a>        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentToolManager.register_tool-68"><a href="#AgentToolManager.register_tool-68"><span class="linenos">68</span></a>            <span class="c1"># Skip &#39;self&#39; parameter</span>
</span><span id="AgentToolManager.register_tool-69"><a href="#AgentToolManager.register_tool-69"><span class="linenos">69</span></a>            <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span><span class="p">:</span>
</span><span id="AgentToolManager.register_tool-70"><a href="#AgentToolManager.register_tool-70"><span class="linenos">70</span></a>                <span class="k">continue</span>
</span><span id="AgentToolManager.register_tool-71"><a href="#AgentToolManager.register_tool-71"><span class="linenos">71</span></a>                
</span><span id="AgentToolManager.register_tool-72"><a href="#AgentToolManager.register_tool-72"><span class="linenos">72</span></a>            <span class="n">param_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentToolManager.register_tool-73"><a href="#AgentToolManager.register_tool-73"><span class="linenos">73</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span> <span class="o">!=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="s2">&quot;Any&quot;</span><span class="p">,</span>
</span><span id="AgentToolManager.register_tool-74"><a href="#AgentToolManager.register_tool-74"><span class="linenos">74</span></a>                <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span>
</span><span id="AgentToolManager.register_tool-75"><a href="#AgentToolManager.register_tool-75"><span class="linenos">75</span></a>            <span class="p">}</span>
</span><span id="AgentToolManager.register_tool-76"><a href="#AgentToolManager.register_tool-76"><span class="linenos">76</span></a>            
</span><span id="AgentToolManager.register_tool-77"><a href="#AgentToolManager.register_tool-77"><span class="linenos">77</span></a>            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">!=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="AgentToolManager.register_tool-78"><a href="#AgentToolManager.register_tool-78"><span class="linenos">78</span></a>                <span class="n">param_info</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
</span><span id="AgentToolManager.register_tool-79"><a href="#AgentToolManager.register_tool-79"><span class="linenos">79</span></a>                
</span><span id="AgentToolManager.register_tool-80"><a href="#AgentToolManager.register_tool-80"><span class="linenos">80</span></a>            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_info</span>
</span><span id="AgentToolManager.register_tool-81"><a href="#AgentToolManager.register_tool-81"><span class="linenos">81</span></a>            
</span><span id="AgentToolManager.register_tool-82"><a href="#AgentToolManager.register_tool-82"><span class="linenos">82</span></a>        <span class="c1"># Register the tool</span>
</span><span id="AgentToolManager.register_tool-83"><a href="#AgentToolManager.register_tool-83"><span class="linenos">83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_func</span>
</span><span id="AgentToolManager.register_tool-84"><a href="#AgentToolManager.register_tool-84"><span class="linenos">84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="n">doc</span>
</span><span id="AgentToolManager.register_tool-85"><a href="#AgentToolManager.register_tool-85"><span class="linenos">85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>
</span><span id="AgentToolManager.register_tool-86"><a href="#AgentToolManager.register_tool-86"><span class="linenos">86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span> <span class="ow">or</span> <span class="n">params</span>
</span><span id="AgentToolManager.register_tool-87"><a href="#AgentToolManager.register_tool-87"><span class="linenos">87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">examples</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="AgentToolManager.register_tool-88"><a href="#AgentToolManager.register_tool-88"><span class="linenos">88</span></a>        
</span><span id="AgentToolManager.register_tool-89"><a href="#AgentToolManager.register_tool-89"><span class="linenos">89</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Registered tool: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2"> in category </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.register_tool-90"><a href="#AgentToolManager.register_tool-90"><span class="linenos">90</span></a>        <span class="k">return</span> <span class="n">tool_name</span>
</span></pre></div>


            <div class="docstring"><p>Register a tool function with the agent.</p>

<p>Args:
    tool_func: The function to register as a tool
    name: Optional custom name for the tool (defaults to function name)
    description: Optional description of the tool
    category: Category for the tool (e.g., 'general', 'memory', 'knowledge')
    parameters: Optional parameter descriptions
    examples: Optional examples of tool usage</p>

<p>Returns:
    The registered tool name</p>
</div>


                            </div>
                            <div id="AgentToolManager.unregister_tool" class="classattr">
                                        <input id="AgentToolManager.unregister_tool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unregister_tool</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.unregister_tool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.unregister_tool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.unregister_tool-92"><a href="#AgentToolManager.unregister_tool-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unregister_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentToolManager.unregister_tool-93"><a href="#AgentToolManager.unregister_tool-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unregister a tool.</span>
</span><span id="AgentToolManager.unregister_tool-94"><a href="#AgentToolManager.unregister_tool-94"><span class="linenos"> 94</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.unregister_tool-95"><a href="#AgentToolManager.unregister_tool-95"><span class="linenos"> 95</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.unregister_tool-96"><a href="#AgentToolManager.unregister_tool-96"><span class="linenos"> 96</span></a><span class="sd">            tool_name: Name of the tool to unregister</span>
</span><span id="AgentToolManager.unregister_tool-97"><a href="#AgentToolManager.unregister_tool-97"><span class="linenos"> 97</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.unregister_tool-98"><a href="#AgentToolManager.unregister_tool-98"><span class="linenos"> 98</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.unregister_tool-99"><a href="#AgentToolManager.unregister_tool-99"><span class="linenos"> 99</span></a><span class="sd">            True if tool was unregistered successfully</span>
</span><span id="AgentToolManager.unregister_tool-100"><a href="#AgentToolManager.unregister_tool-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.unregister_tool-101"><a href="#AgentToolManager.unregister_tool-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager.unregister_tool-102"><a href="#AgentToolManager.unregister_tool-102"><span class="linenos">102</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager.unregister_tool-103"><a href="#AgentToolManager.unregister_tool-103"><span class="linenos">103</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager.unregister_tool-104"><a href="#AgentToolManager.unregister_tool-104"><span class="linenos">104</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager.unregister_tool-105"><a href="#AgentToolManager.unregister_tool-105"><span class="linenos">105</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager.unregister_tool-106"><a href="#AgentToolManager.unregister_tool-106"><span class="linenos">106</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
</span><span id="AgentToolManager.unregister_tool-107"><a href="#AgentToolManager.unregister_tool-107"><span class="linenos">107</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unregistered tool: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.unregister_tool-108"><a href="#AgentToolManager.unregister_tool-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentToolManager.unregister_tool-109"><a href="#AgentToolManager.unregister_tool-109"><span class="linenos">109</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentToolManager.unregister_tool-110"><a href="#AgentToolManager.unregister_tool-110"><span class="linenos">110</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.unregister_tool-111"><a href="#AgentToolManager.unregister_tool-111"><span class="linenos">111</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Unregister a tool.</p>

<p>Args:
    tool_name: Name of the tool to unregister</p>

<p>Returns:
    True if tool was unregistered successfully</p>
</div>


                            </div>
                            <div id="AgentToolManager.get_tool" class="classattr">
                                        <input id="AgentToolManager.get_tool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tool</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.get_tool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.get_tool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.get_tool-113"><a href="#AgentToolManager.get_tool-113"><span class="linenos">113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
</span><span id="AgentToolManager.get_tool-114"><a href="#AgentToolManager.get_tool-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a tool function by name.</span>
</span><span id="AgentToolManager.get_tool-115"><a href="#AgentToolManager.get_tool-115"><span class="linenos">115</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.get_tool-116"><a href="#AgentToolManager.get_tool-116"><span class="linenos">116</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.get_tool-117"><a href="#AgentToolManager.get_tool-117"><span class="linenos">117</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="AgentToolManager.get_tool-118"><a href="#AgentToolManager.get_tool-118"><span class="linenos">118</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.get_tool-119"><a href="#AgentToolManager.get_tool-119"><span class="linenos">119</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.get_tool-120"><a href="#AgentToolManager.get_tool-120"><span class="linenos">120</span></a><span class="sd">            Tool function or None if not found</span>
</span><span id="AgentToolManager.get_tool-121"><a href="#AgentToolManager.get_tool-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.get_tool-122"><a href="#AgentToolManager.get_tool-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get a tool function by name.</p>

<p>Args:
    tool_name: Name of the tool</p>

<p>Returns:
    Tool function or None if not found</p>
</div>


                            </div>
                            <div id="AgentToolManager.get_tool_info" class="classattr">
                                        <input id="AgentToolManager.get_tool_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tool_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.get_tool_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.get_tool_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.get_tool_info-124"><a href="#AgentToolManager.get_tool_info-124"><span class="linenos">124</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tool_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentToolManager.get_tool_info-125"><a href="#AgentToolManager.get_tool_info-125"><span class="linenos">125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about a tool.</span>
</span><span id="AgentToolManager.get_tool_info-126"><a href="#AgentToolManager.get_tool_info-126"><span class="linenos">126</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.get_tool_info-127"><a href="#AgentToolManager.get_tool_info-127"><span class="linenos">127</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.get_tool_info-128"><a href="#AgentToolManager.get_tool_info-128"><span class="linenos">128</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="AgentToolManager.get_tool_info-129"><a href="#AgentToolManager.get_tool_info-129"><span class="linenos">129</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.get_tool_info-130"><a href="#AgentToolManager.get_tool_info-130"><span class="linenos">130</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.get_tool_info-131"><a href="#AgentToolManager.get_tool_info-131"><span class="linenos">131</span></a><span class="sd">            Dictionary with tool information</span>
</span><span id="AgentToolManager.get_tool_info-132"><a href="#AgentToolManager.get_tool_info-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.get_tool_info-133"><a href="#AgentToolManager.get_tool_info-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager.get_tool_info-134"><a href="#AgentToolManager.get_tool_info-134"><span class="linenos">134</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span id="AgentToolManager.get_tool_info-135"><a href="#AgentToolManager.get_tool_info-135"><span class="linenos">135</span></a>            
</span><span id="AgentToolManager.get_tool_info-136"><a href="#AgentToolManager.get_tool_info-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentToolManager.get_tool_info-137"><a href="#AgentToolManager.get_tool_info-137"><span class="linenos">137</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="AgentToolManager.get_tool_info-138"><a href="#AgentToolManager.get_tool_info-138"><span class="linenos">138</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager.get_tool_info-139"><a href="#AgentToolManager.get_tool_info-139"><span class="linenos">139</span></a>            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager.get_tool_info-140"><a href="#AgentToolManager.get_tool_info-140"><span class="linenos">140</span></a>            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="AgentToolManager.get_tool_info-141"><a href="#AgentToolManager.get_tool_info-141"><span class="linenos">141</span></a>            <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="AgentToolManager.get_tool_info-142"><a href="#AgentToolManager.get_tool_info-142"><span class="linenos">142</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get information about a tool.</p>

<p>Args:
    tool_name: Name of the tool</p>

<p>Returns:
    Dictionary with tool information</p>
</div>


                            </div>
                            <div id="AgentToolManager.get_all_tools" class="classattr">
                                        <input id="AgentToolManager.get_all_tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_tools</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.get_all_tools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.get_all_tools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.get_all_tools-144"><a href="#AgentToolManager.get_all_tools-144"><span class="linenos">144</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentToolManager.get_all_tools-145"><a href="#AgentToolManager.get_all_tools-145"><span class="linenos">145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about all registered tools, optionally filtered by category.</span>
</span><span id="AgentToolManager.get_all_tools-146"><a href="#AgentToolManager.get_all_tools-146"><span class="linenos">146</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.get_all_tools-147"><a href="#AgentToolManager.get_all_tools-147"><span class="linenos">147</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.get_all_tools-148"><a href="#AgentToolManager.get_all_tools-148"><span class="linenos">148</span></a><span class="sd">            category: Optional category to filter by</span>
</span><span id="AgentToolManager.get_all_tools-149"><a href="#AgentToolManager.get_all_tools-149"><span class="linenos">149</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.get_all_tools-150"><a href="#AgentToolManager.get_all_tools-150"><span class="linenos">150</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.get_all_tools-151"><a href="#AgentToolManager.get_all_tools-151"><span class="linenos">151</span></a><span class="sd">            List of tool information dictionaries</span>
</span><span id="AgentToolManager.get_all_tools-152"><a href="#AgentToolManager.get_all_tools-152"><span class="linenos">152</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.get_all_tools-153"><a href="#AgentToolManager.get_all_tools-153"><span class="linenos">153</span></a>        <span class="n">tools_info</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentToolManager.get_all_tools-154"><a href="#AgentToolManager.get_all_tools-154"><span class="linenos">154</span></a>        
</span><span id="AgentToolManager.get_all_tools-155"><a href="#AgentToolManager.get_all_tools-155"><span class="linenos">155</span></a>        <span class="k">for</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager.get_all_tools-156"><a href="#AgentToolManager.get_all_tools-156"><span class="linenos">156</span></a>            <span class="c1"># Skip if category filter is applied and doesn&#39;t match</span>
</span><span id="AgentToolManager.get_all_tools-157"><a href="#AgentToolManager.get_all_tools-157"><span class="linenos">157</span></a>            <span class="k">if</span> <span class="n">category</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">category</span><span class="p">:</span>
</span><span id="AgentToolManager.get_all_tools-158"><a href="#AgentToolManager.get_all_tools-158"><span class="linenos">158</span></a>                <span class="k">continue</span>
</span><span id="AgentToolManager.get_all_tools-159"><a href="#AgentToolManager.get_all_tools-159"><span class="linenos">159</span></a>                
</span><span id="AgentToolManager.get_all_tools-160"><a href="#AgentToolManager.get_all_tools-160"><span class="linenos">160</span></a>            <span class="n">tools_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tool_info</span><span class="p">(</span><span class="n">tool_name</span><span class="p">))</span>
</span><span id="AgentToolManager.get_all_tools-161"><a href="#AgentToolManager.get_all_tools-161"><span class="linenos">161</span></a>            
</span><span id="AgentToolManager.get_all_tools-162"><a href="#AgentToolManager.get_all_tools-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="n">tools_info</span>
</span></pre></div>


            <div class="docstring"><p>Get information about all registered tools, optionally filtered by category.</p>

<p>Args:
    category: Optional category to filter by</p>

<p>Returns:
    List of tool information dictionaries</p>
</div>


                            </div>
                            <div id="AgentToolManager.get_tool_categories" class="classattr">
                                        <input id="AgentToolManager.get_tool_categories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tool_categories</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.get_tool_categories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.get_tool_categories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.get_tool_categories-164"><a href="#AgentToolManager.get_tool_categories-164"><span class="linenos">164</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tool_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="AgentToolManager.get_tool_categories-165"><a href="#AgentToolManager.get_tool_categories-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all tool categories.</span>
</span><span id="AgentToolManager.get_tool_categories-166"><a href="#AgentToolManager.get_tool_categories-166"><span class="linenos">166</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.get_tool_categories-167"><a href="#AgentToolManager.get_tool_categories-167"><span class="linenos">167</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.get_tool_categories-168"><a href="#AgentToolManager.get_tool_categories-168"><span class="linenos">168</span></a><span class="sd">            List of unique tool categories</span>
</span><span id="AgentToolManager.get_tool_categories-169"><a href="#AgentToolManager.get_tool_categories-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.get_tool_categories-170"><a href="#AgentToolManager.get_tool_categories-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></pre></div>


            <div class="docstring"><p>Get all tool categories.</p>

<p>Returns:
    List of unique tool categories</p>
</div>


                            </div>
                            <div id="AgentToolManager.execute_tool" class="classattr">
                                        <input id="AgentToolManager.execute_tool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">execute_tool</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.execute_tool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.execute_tool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.execute_tool-172"><a href="#AgentToolManager.execute_tool-172"><span class="linenos">172</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="AgentToolManager.execute_tool-173"><a href="#AgentToolManager.execute_tool-173"><span class="linenos">173</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a tool by name with the provided arguments.</span>
</span><span id="AgentToolManager.execute_tool-174"><a href="#AgentToolManager.execute_tool-174"><span class="linenos">174</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.execute_tool-175"><a href="#AgentToolManager.execute_tool-175"><span class="linenos">175</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.execute_tool-176"><a href="#AgentToolManager.execute_tool-176"><span class="linenos">176</span></a><span class="sd">            tool_name: Name of the tool to execute</span>
</span><span id="AgentToolManager.execute_tool-177"><a href="#AgentToolManager.execute_tool-177"><span class="linenos">177</span></a><span class="sd">            **kwargs: Arguments to pass to the tool</span>
</span><span id="AgentToolManager.execute_tool-178"><a href="#AgentToolManager.execute_tool-178"><span class="linenos">178</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.execute_tool-179"><a href="#AgentToolManager.execute_tool-179"><span class="linenos">179</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.execute_tool-180"><a href="#AgentToolManager.execute_tool-180"><span class="linenos">180</span></a><span class="sd">            Result of the tool execution</span>
</span><span id="AgentToolManager.execute_tool-181"><a href="#AgentToolManager.execute_tool-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.execute_tool-182"><a href="#AgentToolManager.execute_tool-182"><span class="linenos">182</span></a>        <span class="n">tool_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="AgentToolManager.execute_tool-183"><a href="#AgentToolManager.execute_tool-183"><span class="linenos">183</span></a>        
</span><span id="AgentToolManager.execute_tool-184"><a href="#AgentToolManager.execute_tool-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_func</span><span class="p">:</span>
</span><span id="AgentToolManager.execute_tool-185"><a href="#AgentToolManager.execute_tool-185"><span class="linenos">185</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager.execute_tool-186"><a href="#AgentToolManager.execute_tool-186"><span class="linenos">186</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentToolManager.execute_tool-187"><a href="#AgentToolManager.execute_tool-187"><span class="linenos">187</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span>
</span><span id="AgentToolManager.execute_tool-188"><a href="#AgentToolManager.execute_tool-188"><span class="linenos">188</span></a>            
</span><span id="AgentToolManager.execute_tool-189"><a href="#AgentToolManager.execute_tool-189"><span class="linenos">189</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentToolManager.execute_tool-190"><a href="#AgentToolManager.execute_tool-190"><span class="linenos">190</span></a>            <span class="c1"># Check if the tool is a coroutine function</span>
</span><span id="AgentToolManager.execute_tool-191"><a href="#AgentToolManager.execute_tool-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">tool_func</span><span class="p">):</span>
</span><span id="AgentToolManager.execute_tool-192"><a href="#AgentToolManager.execute_tool-192"><span class="linenos">192</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AgentToolManager.execute_tool-193"><a href="#AgentToolManager.execute_tool-193"><span class="linenos">193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AgentToolManager.execute_tool-194"><a href="#AgentToolManager.execute_tool-194"><span class="linenos">194</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AgentToolManager.execute_tool-195"><a href="#AgentToolManager.execute_tool-195"><span class="linenos">195</span></a>                
</span><span id="AgentToolManager.execute_tool-196"><a href="#AgentToolManager.execute_tool-196"><span class="linenos">196</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="AgentToolManager.execute_tool-197"><a href="#AgentToolManager.execute_tool-197"><span class="linenos">197</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentToolManager.execute_tool-198"><a href="#AgentToolManager.execute_tool-198"><span class="linenos">198</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error executing tool </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager.execute_tool-199"><a href="#AgentToolManager.execute_tool-199"><span class="linenos">199</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="AgentToolManager.execute_tool-200"><a href="#AgentToolManager.execute_tool-200"><span class="linenos">200</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Execute a tool by name with the provided arguments.</p>

<p>Args:
    tool_name: Name of the tool to execute
    **kwargs: Arguments to pass to the tool</p>

<p>Returns:
    Result of the tool execution</p>
</div>


                            </div>
                            <div id="AgentToolManager.validate_tool_args" class="classattr">
                                        <input id="AgentToolManager.validate_tool_args-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_tool_args</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">args</span><span class="p">:</span> <span class="n">Dict</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.validate_tool_args-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.validate_tool_args"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.validate_tool_args-202"><a href="#AgentToolManager.validate_tool_args-202"><span class="linenos">202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_tool_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="AgentToolManager.validate_tool_args-203"><a href="#AgentToolManager.validate_tool_args-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate arguments for a tool.</span>
</span><span id="AgentToolManager.validate_tool_args-204"><a href="#AgentToolManager.validate_tool_args-204"><span class="linenos">204</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.validate_tool_args-205"><a href="#AgentToolManager.validate_tool_args-205"><span class="linenos">205</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.validate_tool_args-206"><a href="#AgentToolManager.validate_tool_args-206"><span class="linenos">206</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="AgentToolManager.validate_tool_args-207"><a href="#AgentToolManager.validate_tool_args-207"><span class="linenos">207</span></a><span class="sd">            args: Arguments to validate</span>
</span><span id="AgentToolManager.validate_tool_args-208"><a href="#AgentToolManager.validate_tool_args-208"><span class="linenos">208</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.validate_tool_args-209"><a href="#AgentToolManager.validate_tool_args-209"><span class="linenos">209</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.validate_tool_args-210"><a href="#AgentToolManager.validate_tool_args-210"><span class="linenos">210</span></a><span class="sd">            Tuple of (is_valid, error_message)</span>
</span><span id="AgentToolManager.validate_tool_args-211"><a href="#AgentToolManager.validate_tool_args-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.validate_tool_args-212"><a href="#AgentToolManager.validate_tool_args-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager.validate_tool_args-213"><a href="#AgentToolManager.validate_tool_args-213"><span class="linenos">213</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager.validate_tool_args-214"><a href="#AgentToolManager.validate_tool_args-214"><span class="linenos">214</span></a>            
</span><span id="AgentToolManager.validate_tool_args-215"><a href="#AgentToolManager.validate_tool_args-215"><span class="linenos">215</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="AgentToolManager.validate_tool_args-216"><a href="#AgentToolManager.validate_tool_args-216"><span class="linenos">216</span></a>        
</span><span id="AgentToolManager.validate_tool_args-217"><a href="#AgentToolManager.validate_tool_args-217"><span class="linenos">217</span></a>        <span class="c1"># Check for required parameters</span>
</span><span id="AgentToolManager.validate_tool_args-218"><a href="#AgentToolManager.validate_tool_args-218"><span class="linenos">218</span></a>        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_info</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentToolManager.validate_tool_args-219"><a href="#AgentToolManager.validate_tool_args-219"><span class="linenos">219</span></a>            <span class="k">if</span> <span class="n">param_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="AgentToolManager.validate_tool_args-220"><a href="#AgentToolManager.validate_tool_args-220"><span class="linenos">220</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Missing required parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager.validate_tool_args-221"><a href="#AgentToolManager.validate_tool_args-221"><span class="linenos">221</span></a>                
</span><span id="AgentToolManager.validate_tool_args-222"><a href="#AgentToolManager.validate_tool_args-222"><span class="linenos">222</span></a>        <span class="c1"># Check for unknown parameters</span>
</span><span id="AgentToolManager.validate_tool_args-223"><a href="#AgentToolManager.validate_tool_args-223"><span class="linenos">223</span></a>        <span class="k">for</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="AgentToolManager.validate_tool_args-224"><a href="#AgentToolManager.validate_tool_args-224"><span class="linenos">224</span></a>            <span class="k">if</span> <span class="n">arg_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
</span><span id="AgentToolManager.validate_tool_args-225"><a href="#AgentToolManager.validate_tool_args-225"><span class="linenos">225</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown parameter: </span><span class="si">{</span><span class="n">arg_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AgentToolManager.validate_tool_args-226"><a href="#AgentToolManager.validate_tool_args-226"><span class="linenos">226</span></a>                
</span><span id="AgentToolManager.validate_tool_args-227"><a href="#AgentToolManager.validate_tool_args-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Validate arguments for a tool.</p>

<p>Args:
    tool_name: Name of the tool
    args: Arguments to validate</p>

<p>Returns:
    Tuple of (is_valid, error_message)</p>
</div>


                            </div>
                            <div id="AgentToolManager.format_tool_for_llm" class="classattr">
                                        <input id="AgentToolManager.format_tool_for_llm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">format_tool_for_llm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.format_tool_for_llm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.format_tool_for_llm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.format_tool_for_llm-229"><a href="#AgentToolManager.format_tool_for_llm-229"><span class="linenos">229</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">format_tool_for_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="AgentToolManager.format_tool_for_llm-230"><a href="#AgentToolManager.format_tool_for_llm-230"><span class="linenos">230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Format tool information for LLM consumption.</span>
</span><span id="AgentToolManager.format_tool_for_llm-231"><a href="#AgentToolManager.format_tool_for_llm-231"><span class="linenos">231</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.format_tool_for_llm-232"><a href="#AgentToolManager.format_tool_for_llm-232"><span class="linenos">232</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.format_tool_for_llm-233"><a href="#AgentToolManager.format_tool_for_llm-233"><span class="linenos">233</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="AgentToolManager.format_tool_for_llm-234"><a href="#AgentToolManager.format_tool_for_llm-234"><span class="linenos">234</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.format_tool_for_llm-235"><a href="#AgentToolManager.format_tool_for_llm-235"><span class="linenos">235</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.format_tool_for_llm-236"><a href="#AgentToolManager.format_tool_for_llm-236"><span class="linenos">236</span></a><span class="sd">            Dictionary with formatted tool information</span>
</span><span id="AgentToolManager.format_tool_for_llm-237"><a href="#AgentToolManager.format_tool_for_llm-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.format_tool_for_llm-238"><a href="#AgentToolManager.format_tool_for_llm-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager.format_tool_for_llm-239"><a href="#AgentToolManager.format_tool_for_llm-239"><span class="linenos">239</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span id="AgentToolManager.format_tool_for_llm-240"><a href="#AgentToolManager.format_tool_for_llm-240"><span class="linenos">240</span></a>            
</span><span id="AgentToolManager.format_tool_for_llm-241"><a href="#AgentToolManager.format_tool_for_llm-241"><span class="linenos">241</span></a>        <span class="n">tool_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_info</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="AgentToolManager.format_tool_for_llm-242"><a href="#AgentToolManager.format_tool_for_llm-242"><span class="linenos">242</span></a>        
</span><span id="AgentToolManager.format_tool_for_llm-243"><a href="#AgentToolManager.format_tool_for_llm-243"><span class="linenos">243</span></a>        <span class="c1"># Format parameters for LLM</span>
</span><span id="AgentToolManager.format_tool_for_llm-244"><a href="#AgentToolManager.format_tool_for_llm-244"><span class="linenos">244</span></a>        <span class="n">formatted_params</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentToolManager.format_tool_for_llm-245"><a href="#AgentToolManager.format_tool_for_llm-245"><span class="linenos">245</span></a>        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_info</span> <span class="ow">in</span> <span class="n">tool_info</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentToolManager.format_tool_for_llm-246"><a href="#AgentToolManager.format_tool_for_llm-246"><span class="linenos">246</span></a>            <span class="n">param_desc</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentToolManager.format_tool_for_llm-247"><a href="#AgentToolManager.format_tool_for_llm-247"><span class="linenos">247</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">param_name</span><span class="p">,</span>
</span><span id="AgentToolManager.format_tool_for_llm-248"><a href="#AgentToolManager.format_tool_for_llm-248"><span class="linenos">248</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">param_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;Any&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager.format_tool_for_llm-249"><a href="#AgentToolManager.format_tool_for_llm-249"><span class="linenos">249</span></a>                <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="n">param_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="AgentToolManager.format_tool_for_llm-250"><a href="#AgentToolManager.format_tool_for_llm-250"><span class="linenos">250</span></a>            <span class="p">}</span>
</span><span id="AgentToolManager.format_tool_for_llm-251"><a href="#AgentToolManager.format_tool_for_llm-251"><span class="linenos">251</span></a>            
</span><span id="AgentToolManager.format_tool_for_llm-252"><a href="#AgentToolManager.format_tool_for_llm-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">param_info</span><span class="p">:</span>
</span><span id="AgentToolManager.format_tool_for_llm-253"><a href="#AgentToolManager.format_tool_for_llm-253"><span class="linenos">253</span></a>                <span class="n">param_desc</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_info</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
</span><span id="AgentToolManager.format_tool_for_llm-254"><a href="#AgentToolManager.format_tool_for_llm-254"><span class="linenos">254</span></a>                
</span><span id="AgentToolManager.format_tool_for_llm-255"><a href="#AgentToolManager.format_tool_for_llm-255"><span class="linenos">255</span></a>            <span class="n">formatted_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_desc</span><span class="p">)</span>
</span><span id="AgentToolManager.format_tool_for_llm-256"><a href="#AgentToolManager.format_tool_for_llm-256"><span class="linenos">256</span></a>            
</span><span id="AgentToolManager.format_tool_for_llm-257"><a href="#AgentToolManager.format_tool_for_llm-257"><span class="linenos">257</span></a>        <span class="c1"># Format examples for LLM</span>
</span><span id="AgentToolManager.format_tool_for_llm-258"><a href="#AgentToolManager.format_tool_for_llm-258"><span class="linenos">258</span></a>        <span class="n">formatted_examples</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentToolManager.format_tool_for_llm-259"><a href="#AgentToolManager.format_tool_for_llm-259"><span class="linenos">259</span></a>        <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">tool_info</span><span class="p">[</span><span class="s2">&quot;examples&quot;</span><span class="p">]:</span>
</span><span id="AgentToolManager.format_tool_for_llm-260"><a href="#AgentToolManager.format_tool_for_llm-260"><span class="linenos">260</span></a>            <span class="n">formatted_examples</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="AgentToolManager.format_tool_for_llm-261"><a href="#AgentToolManager.format_tool_for_llm-261"><span class="linenos">261</span></a>                <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="AgentToolManager.format_tool_for_llm-262"><a href="#AgentToolManager.format_tool_for_llm-262"><span class="linenos">262</span></a>                <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.format_tool_for_llm-263"><a href="#AgentToolManager.format_tool_for_llm-263"><span class="linenos">263</span></a>            <span class="p">})</span>
</span><span id="AgentToolManager.format_tool_for_llm-264"><a href="#AgentToolManager.format_tool_for_llm-264"><span class="linenos">264</span></a>            
</span><span id="AgentToolManager.format_tool_for_llm-265"><a href="#AgentToolManager.format_tool_for_llm-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="AgentToolManager.format_tool_for_llm-266"><a href="#AgentToolManager.format_tool_for_llm-266"><span class="linenos">266</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="AgentToolManager.format_tool_for_llm-267"><a href="#AgentToolManager.format_tool_for_llm-267"><span class="linenos">267</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">tool_info</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
</span><span id="AgentToolManager.format_tool_for_llm-268"><a href="#AgentToolManager.format_tool_for_llm-268"><span class="linenos">268</span></a>            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">formatted_params</span><span class="p">,</span>
</span><span id="AgentToolManager.format_tool_for_llm-269"><a href="#AgentToolManager.format_tool_for_llm-269"><span class="linenos">269</span></a>            <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="n">formatted_examples</span>
</span><span id="AgentToolManager.format_tool_for_llm-270"><a href="#AgentToolManager.format_tool_for_llm-270"><span class="linenos">270</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Format tool information for LLM consumption.</p>

<p>Args:
    tool_name: Name of the tool</p>

<p>Returns:
    Dictionary with formatted tool information</p>
</div>


                            </div>
                            <div id="AgentToolManager.format_all_tools_for_llm" class="classattr">
                                        <input id="AgentToolManager.format_all_tools_for_llm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">format_all_tools_for_llm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.format_all_tools_for_llm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.format_all_tools_for_llm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.format_all_tools_for_llm-272"><a href="#AgentToolManager.format_all_tools_for_llm-272"><span class="linenos">272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">format_all_tools_for_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-273"><a href="#AgentToolManager.format_all_tools_for_llm-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Format all tools for LLM consumption, optionally filtered by category.</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-274"><a href="#AgentToolManager.format_all_tools_for_llm-274"><span class="linenos">274</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.format_all_tools_for_llm-275"><a href="#AgentToolManager.format_all_tools_for_llm-275"><span class="linenos">275</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-276"><a href="#AgentToolManager.format_all_tools_for_llm-276"><span class="linenos">276</span></a><span class="sd">            category: Optional category to filter by</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-277"><a href="#AgentToolManager.format_all_tools_for_llm-277"><span class="linenos">277</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.format_all_tools_for_llm-278"><a href="#AgentToolManager.format_all_tools_for_llm-278"><span class="linenos">278</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-279"><a href="#AgentToolManager.format_all_tools_for_llm-279"><span class="linenos">279</span></a><span class="sd">            List of formatted tool information dictionaries</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-280"><a href="#AgentToolManager.format_all_tools_for_llm-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-281"><a href="#AgentToolManager.format_all_tools_for_llm-281"><span class="linenos">281</span></a>        <span class="n">formatted_tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-282"><a href="#AgentToolManager.format_all_tools_for_llm-282"><span class="linenos">282</span></a>        
</span><span id="AgentToolManager.format_all_tools_for_llm-283"><a href="#AgentToolManager.format_all_tools_for_llm-283"><span class="linenos">283</span></a>        <span class="k">for</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-284"><a href="#AgentToolManager.format_all_tools_for_llm-284"><span class="linenos">284</span></a>            <span class="c1"># Skip if category filter is applied and doesn&#39;t match</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-285"><a href="#AgentToolManager.format_all_tools_for_llm-285"><span class="linenos">285</span></a>            <span class="k">if</span> <span class="n">category</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">category</span><span class="p">:</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-286"><a href="#AgentToolManager.format_all_tools_for_llm-286"><span class="linenos">286</span></a>                <span class="k">continue</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-287"><a href="#AgentToolManager.format_all_tools_for_llm-287"><span class="linenos">287</span></a>                
</span><span id="AgentToolManager.format_all_tools_for_llm-288"><a href="#AgentToolManager.format_all_tools_for_llm-288"><span class="linenos">288</span></a>            <span class="n">formatted_tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_tool_for_llm</span><span class="p">(</span><span class="n">tool_name</span><span class="p">))</span>
</span><span id="AgentToolManager.format_all_tools_for_llm-289"><a href="#AgentToolManager.format_all_tools_for_llm-289"><span class="linenos">289</span></a>            
</span><span id="AgentToolManager.format_all_tools_for_llm-290"><a href="#AgentToolManager.format_all_tools_for_llm-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="n">formatted_tools</span>
</span></pre></div>


            <div class="docstring"><p>Format all tools for LLM consumption, optionally filtered by category.</p>

<p>Args:
    category: Optional category to filter by</p>

<p>Returns:
    List of formatted tool information dictionaries</p>
</div>


                            </div>
                            <div id="AgentToolManager.save_tools_config" class="classattr">
                                        <input id="AgentToolManager.save_tools_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_tools_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.save_tools_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.save_tools_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.save_tools_config-292"><a href="#AgentToolManager.save_tools_config-292"><span class="linenos">292</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_tools_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentToolManager.save_tools_config-293"><a href="#AgentToolManager.save_tools_config-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save tool configuration to a file.</span>
</span><span id="AgentToolManager.save_tools_config-294"><a href="#AgentToolManager.save_tools_config-294"><span class="linenos">294</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.save_tools_config-295"><a href="#AgentToolManager.save_tools_config-295"><span class="linenos">295</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.save_tools_config-296"><a href="#AgentToolManager.save_tools_config-296"><span class="linenos">296</span></a><span class="sd">            filename: Optional filename (defaults to user_id_tools.json)</span>
</span><span id="AgentToolManager.save_tools_config-297"><a href="#AgentToolManager.save_tools_config-297"><span class="linenos">297</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.save_tools_config-298"><a href="#AgentToolManager.save_tools_config-298"><span class="linenos">298</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.save_tools_config-299"><a href="#AgentToolManager.save_tools_config-299"><span class="linenos">299</span></a><span class="sd">            True if configuration was saved successfully</span>
</span><span id="AgentToolManager.save_tools_config-300"><a href="#AgentToolManager.save_tools_config-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.save_tools_config-301"><a href="#AgentToolManager.save_tools_config-301"><span class="linenos">301</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentToolManager.save_tools_config-302"><a href="#AgentToolManager.save_tools_config-302"><span class="linenos">302</span></a>            <span class="c1"># Use default filename if not provided</span>
</span><span id="AgentToolManager.save_tools_config-303"><a href="#AgentToolManager.save_tools_config-303"><span class="linenos">303</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="AgentToolManager.save_tools_config-304"><a href="#AgentToolManager.save_tools_config-304"><span class="linenos">304</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_tools.json&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.save_tools_config-305"><a href="#AgentToolManager.save_tools_config-305"><span class="linenos">305</span></a>                
</span><span id="AgentToolManager.save_tools_config-306"><a href="#AgentToolManager.save_tools_config-306"><span class="linenos">306</span></a>            <span class="c1"># Create directory if it doesn&#39;t exist</span>
</span><span id="AgentToolManager.save_tools_config-307"><a href="#AgentToolManager.save_tools_config-307"><span class="linenos">307</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AgentToolManager.save_tools_config-308"><a href="#AgentToolManager.save_tools_config-308"><span class="linenos">308</span></a>            
</span><span id="AgentToolManager.save_tools_config-309"><a href="#AgentToolManager.save_tools_config-309"><span class="linenos">309</span></a>            <span class="c1"># Prepare tool configuration</span>
</span><span id="AgentToolManager.save_tools_config-310"><a href="#AgentToolManager.save_tools_config-310"><span class="linenos">310</span></a>            <span class="n">tools_config</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AgentToolManager.save_tools_config-311"><a href="#AgentToolManager.save_tools_config-311"><span class="linenos">311</span></a>            
</span><span id="AgentToolManager.save_tools_config-312"><a href="#AgentToolManager.save_tools_config-312"><span class="linenos">312</span></a>            <span class="k">for</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager.save_tools_config-313"><a href="#AgentToolManager.save_tools_config-313"><span class="linenos">313</span></a>                <span class="c1"># Skip built-in tools that can&#39;t be serialized</span>
</span><span id="AgentToolManager.save_tools_config-314"><a href="#AgentToolManager.save_tools_config-314"><span class="linenos">314</span></a>                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isbuiltin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]):</span>
</span><span id="AgentToolManager.save_tools_config-315"><a href="#AgentToolManager.save_tools_config-315"><span class="linenos">315</span></a>                    <span class="k">continue</span>
</span><span id="AgentToolManager.save_tools_config-316"><a href="#AgentToolManager.save_tools_config-316"><span class="linenos">316</span></a>                    
</span><span id="AgentToolManager.save_tools_config-317"><a href="#AgentToolManager.save_tools_config-317"><span class="linenos">317</span></a>                <span class="n">tools_config</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AgentToolManager.save_tools_config-318"><a href="#AgentToolManager.save_tools_config-318"><span class="linenos">318</span></a>                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager.save_tools_config-319"><a href="#AgentToolManager.save_tools_config-319"><span class="linenos">319</span></a>                    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">),</span>
</span><span id="AgentToolManager.save_tools_config-320"><a href="#AgentToolManager.save_tools_config-320"><span class="linenos">320</span></a>                    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="AgentToolManager.save_tools_config-321"><a href="#AgentToolManager.save_tools_config-321"><span class="linenos">321</span></a>                    <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="AgentToolManager.save_tools_config-322"><a href="#AgentToolManager.save_tools_config-322"><span class="linenos">322</span></a>                <span class="p">}</span>
</span><span id="AgentToolManager.save_tools_config-323"><a href="#AgentToolManager.save_tools_config-323"><span class="linenos">323</span></a>                
</span><span id="AgentToolManager.save_tools_config-324"><a href="#AgentToolManager.save_tools_config-324"><span class="linenos">324</span></a>            <span class="c1"># Save to file</span>
</span><span id="AgentToolManager.save_tools_config-325"><a href="#AgentToolManager.save_tools_config-325"><span class="linenos">325</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="AgentToolManager.save_tools_config-326"><a href="#AgentToolManager.save_tools_config-326"><span class="linenos">326</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tools_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="AgentToolManager.save_tools_config-327"><a href="#AgentToolManager.save_tools_config-327"><span class="linenos">327</span></a>                
</span><span id="AgentToolManager.save_tools_config-328"><a href="#AgentToolManager.save_tools_config-328"><span class="linenos">328</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved tools configuration to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.save_tools_config-329"><a href="#AgentToolManager.save_tools_config-329"><span class="linenos">329</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentToolManager.save_tools_config-330"><a href="#AgentToolManager.save_tools_config-330"><span class="linenos">330</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentToolManager.save_tools_config-331"><a href="#AgentToolManager.save_tools_config-331"><span class="linenos">331</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving tools configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.save_tools_config-332"><a href="#AgentToolManager.save_tools_config-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Save tool configuration to a file.</p>

<p>Args:
    filename: Optional filename (defaults to user_id_tools.json)</p>

<p>Returns:
    True if configuration was saved successfully</p>
</div>


                            </div>
                            <div id="AgentToolManager.load_tools_config" class="classattr">
                                        <input id="AgentToolManager.load_tools_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_tools_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="AgentToolManager.load_tools_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentToolManager.load_tools_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentToolManager.load_tools_config-334"><a href="#AgentToolManager.load_tools_config-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_tools_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AgentToolManager.load_tools_config-335"><a href="#AgentToolManager.load_tools_config-335"><span class="linenos">335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load tool configuration from a file.</span>
</span><span id="AgentToolManager.load_tools_config-336"><a href="#AgentToolManager.load_tools_config-336"><span class="linenos">336</span></a><span class="sd">        </span>
</span><span id="AgentToolManager.load_tools_config-337"><a href="#AgentToolManager.load_tools_config-337"><span class="linenos">337</span></a><span class="sd">        Args:</span>
</span><span id="AgentToolManager.load_tools_config-338"><a href="#AgentToolManager.load_tools_config-338"><span class="linenos">338</span></a><span class="sd">            filename: Optional filename (defaults to user_id_tools.json)</span>
</span><span id="AgentToolManager.load_tools_config-339"><a href="#AgentToolManager.load_tools_config-339"><span class="linenos">339</span></a><span class="sd">            </span>
</span><span id="AgentToolManager.load_tools_config-340"><a href="#AgentToolManager.load_tools_config-340"><span class="linenos">340</span></a><span class="sd">        Returns:</span>
</span><span id="AgentToolManager.load_tools_config-341"><a href="#AgentToolManager.load_tools_config-341"><span class="linenos">341</span></a><span class="sd">            True if configuration was loaded successfully</span>
</span><span id="AgentToolManager.load_tools_config-342"><a href="#AgentToolManager.load_tools_config-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentToolManager.load_tools_config-343"><a href="#AgentToolManager.load_tools_config-343"><span class="linenos">343</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AgentToolManager.load_tools_config-344"><a href="#AgentToolManager.load_tools_config-344"><span class="linenos">344</span></a>            <span class="c1"># Use default filename if not provided</span>
</span><span id="AgentToolManager.load_tools_config-345"><a href="#AgentToolManager.load_tools_config-345"><span class="linenos">345</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="AgentToolManager.load_tools_config-346"><a href="#AgentToolManager.load_tools_config-346"><span class="linenos">346</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_tools.json&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.load_tools_config-347"><a href="#AgentToolManager.load_tools_config-347"><span class="linenos">347</span></a>                
</span><span id="AgentToolManager.load_tools_config-348"><a href="#AgentToolManager.load_tools_config-348"><span class="linenos">348</span></a>            <span class="c1"># Check if file exists</span>
</span><span id="AgentToolManager.load_tools_config-349"><a href="#AgentToolManager.load_tools_config-349"><span class="linenos">349</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="AgentToolManager.load_tools_config-350"><a href="#AgentToolManager.load_tools_config-350"><span class="linenos">350</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tools configuration file not found: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.load_tools_config-351"><a href="#AgentToolManager.load_tools_config-351"><span class="linenos">351</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="AgentToolManager.load_tools_config-352"><a href="#AgentToolManager.load_tools_config-352"><span class="linenos">352</span></a>                
</span><span id="AgentToolManager.load_tools_config-353"><a href="#AgentToolManager.load_tools_config-353"><span class="linenos">353</span></a>            <span class="c1"># Load from file</span>
</span><span id="AgentToolManager.load_tools_config-354"><a href="#AgentToolManager.load_tools_config-354"><span class="linenos">354</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="AgentToolManager.load_tools_config-355"><a href="#AgentToolManager.load_tools_config-355"><span class="linenos">355</span></a>                <span class="n">tools_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="AgentToolManager.load_tools_config-356"><a href="#AgentToolManager.load_tools_config-356"><span class="linenos">356</span></a>                
</span><span id="AgentToolManager.load_tools_config-357"><a href="#AgentToolManager.load_tools_config-357"><span class="linenos">357</span></a>            <span class="c1"># Update tool configuration</span>
</span><span id="AgentToolManager.load_tools_config-358"><a href="#AgentToolManager.load_tools_config-358"><span class="linenos">358</span></a>            <span class="k">for</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">tools_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AgentToolManager.load_tools_config-359"><a href="#AgentToolManager.load_tools_config-359"><span class="linenos">359</span></a>                <span class="c1"># Skip if tool doesn&#39;t exist</span>
</span><span id="AgentToolManager.load_tools_config-360"><a href="#AgentToolManager.load_tools_config-360"><span class="linenos">360</span></a>                <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
</span><span id="AgentToolManager.load_tools_config-361"><a href="#AgentToolManager.load_tools_config-361"><span class="linenos">361</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool not found: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.load_tools_config-362"><a href="#AgentToolManager.load_tools_config-362"><span class="linenos">362</span></a>                    <span class="k">continue</span>
</span><span id="AgentToolManager.load_tools_config-363"><a href="#AgentToolManager.load_tools_config-363"><span class="linenos">363</span></a>                    
</span><span id="AgentToolManager.load_tools_config-364"><a href="#AgentToolManager.load_tools_config-364"><span class="linenos">364</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_descriptions</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.load_tools_config-365"><a href="#AgentToolManager.load_tools_config-365"><span class="linenos">365</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_categories</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.load_tools_config-366"><a href="#AgentToolManager.load_tools_config-366"><span class="linenos">366</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_parameters</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="AgentToolManager.load_tools_config-367"><a href="#AgentToolManager.load_tools_config-367"><span class="linenos">367</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tool_examples</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;examples&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="AgentToolManager.load_tools_config-368"><a href="#AgentToolManager.load_tools_config-368"><span class="linenos">368</span></a>                
</span><span id="AgentToolManager.load_tools_config-369"><a href="#AgentToolManager.load_tools_config-369"><span class="linenos">369</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded tools configuration from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.load_tools_config-370"><a href="#AgentToolManager.load_tools_config-370"><span class="linenos">370</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AgentToolManager.load_tools_config-371"><a href="#AgentToolManager.load_tools_config-371"><span class="linenos">371</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AgentToolManager.load_tools_config-372"><a href="#AgentToolManager.load_tools_config-372"><span class="linenos">372</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading tools configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AgentToolManager.load_tools_config-373"><a href="#AgentToolManager.load_tools_config-373"><span class="linenos">373</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Load tool configuration from a file.</p>

<p>Args:
    filename: Optional filename (defaults to user_id_tools.json)</p>

<p>Returns:
    True if configuration was loaded successfully</p>
</div>


                            </div>
                </section>
                <section id="AgentModelManager">
                            <input id="AgentModelManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AgentModelManager</span>:

                <label class="view-source-button" for="AgentModelManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentModelManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentModelManager-21"><a href="#AgentModelManager-21"><span class="linenos">21</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AgentModelManager</span><span class="p">:</span>
</span><span id="AgentModelManager-22"><a href="#AgentModelManager-22"><span class="linenos">22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages model creation and configuration.&quot;&quot;&quot;</span>
</span><span id="AgentModelManager-23"><a href="#AgentModelManager-23"><span class="linenos">23</span></a>    
</span><span id="AgentModelManager-24"><a href="#AgentModelManager-24"><span class="linenos">24</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ollama_base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AgentModelManager-25"><a href="#AgentModelManager-25"><span class="linenos">25</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the model manager.</span>
</span><span id="AgentModelManager-26"><a href="#AgentModelManager-26"><span class="linenos">26</span></a><span class="sd">        </span>
</span><span id="AgentModelManager-27"><a href="#AgentModelManager-27"><span class="linenos">27</span></a><span class="sd">        Args:</span>
</span><span id="AgentModelManager-28"><a href="#AgentModelManager-28"><span class="linenos">28</span></a><span class="sd">            model_provider: LLM provider (&#39;ollama&#39; or &#39;openai&#39;)</span>
</span><span id="AgentModelManager-29"><a href="#AgentModelManager-29"><span class="linenos">29</span></a><span class="sd">            model_name: Model name to use</span>
</span><span id="AgentModelManager-30"><a href="#AgentModelManager-30"><span class="linenos">30</span></a><span class="sd">            ollama_base_url: Base URL for Ollama API</span>
</span><span id="AgentModelManager-31"><a href="#AgentModelManager-31"><span class="linenos">31</span></a><span class="sd">            seed: Optional seed for model reproducibility</span>
</span><span id="AgentModelManager-32"><a href="#AgentModelManager-32"><span class="linenos">32</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentModelManager-33"><a href="#AgentModelManager-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span> <span class="o">=</span> <span class="n">model_provider</span>
</span><span id="AgentModelManager-34"><a href="#AgentModelManager-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="AgentModelManager-35"><a href="#AgentModelManager-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ollama_base_url</span> <span class="o">=</span> <span class="n">ollama_base_url</span>
</span><span id="AgentModelManager-36"><a href="#AgentModelManager-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
</span><span id="AgentModelManager-37"><a href="#AgentModelManager-37"><span class="linenos">37</span></a>        
</span><span id="AgentModelManager-38"><a href="#AgentModelManager-38"><span class="linenos">38</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">OpenAIChat</span><span class="p">,</span> <span class="n">Ollama</span><span class="p">]:</span>
</span><span id="AgentModelManager-39"><a href="#AgentModelManager-39"><span class="linenos">39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the appropriate model instance based on provider.</span>
</span><span id="AgentModelManager-40"><a href="#AgentModelManager-40"><span class="linenos">40</span></a>
</span><span id="AgentModelManager-41"><a href="#AgentModelManager-41"><span class="linenos">41</span></a><span class="sd">        Returns:</span>
</span><span id="AgentModelManager-42"><a href="#AgentModelManager-42"><span class="linenos">42</span></a><span class="sd">            Configured model instance</span>
</span><span id="AgentModelManager-43"><a href="#AgentModelManager-43"><span class="linenos">43</span></a><span class="sd">            </span>
</span><span id="AgentModelManager-44"><a href="#AgentModelManager-44"><span class="linenos">44</span></a><span class="sd">        Raises:</span>
</span><span id="AgentModelManager-45"><a href="#AgentModelManager-45"><span class="linenos">45</span></a><span class="sd">            ValueError: If unsupported model provider is specified</span>
</span><span id="AgentModelManager-46"><a href="#AgentModelManager-46"><span class="linenos">46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentModelManager-47"><a href="#AgentModelManager-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span> <span class="o">==</span> <span class="s2">&quot;openai&quot;</span><span class="p">:</span>
</span><span id="AgentModelManager-48"><a href="#AgentModelManager-48"><span class="linenos">48</span></a>            <span class="k">return</span> <span class="n">OpenAIChat</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="AgentModelManager-49"><a href="#AgentModelManager-49"><span class="linenos">49</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span> <span class="o">==</span> <span class="s2">&quot;ollama&quot;</span><span class="p">:</span>
</span><span id="AgentModelManager-50"><a href="#AgentModelManager-50"><span class="linenos">50</span></a>            <span class="c1"># Get dynamic context size for this model</span>
</span><span id="AgentModelManager-51"><a href="#AgentModelManager-51"><span class="linenos">51</span></a>            <span class="n">context_size</span><span class="p">,</span> <span class="n">detection_method</span> <span class="o">=</span> <span class="n">get_model_context_size_sync</span><span class="p">(</span>
</span><span id="AgentModelManager-52"><a href="#AgentModelManager-52"><span class="linenos">52</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ollama_base_url</span>
</span><span id="AgentModelManager-53"><a href="#AgentModelManager-53"><span class="linenos">53</span></a>            <span class="p">)</span>
</span><span id="AgentModelManager-54"><a href="#AgentModelManager-54"><span class="linenos">54</span></a>
</span><span id="AgentModelManager-55"><a href="#AgentModelManager-55"><span class="linenos">55</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentModelManager-56"><a href="#AgentModelManager-56"><span class="linenos">56</span></a>                <span class="s2">&quot;Using context size </span><span class="si">%d</span><span class="s2"> for model </span><span class="si">%s</span><span class="s2"> (detected via: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="AgentModelManager-57"><a href="#AgentModelManager-57"><span class="linenos">57</span></a>                <span class="n">context_size</span><span class="p">,</span>
</span><span id="AgentModelManager-58"><a href="#AgentModelManager-58"><span class="linenos">58</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
</span><span id="AgentModelManager-59"><a href="#AgentModelManager-59"><span class="linenos">59</span></a>                <span class="n">detection_method</span><span class="p">,</span>
</span><span id="AgentModelManager-60"><a href="#AgentModelManager-60"><span class="linenos">60</span></a>            <span class="p">)</span>
</span><span id="AgentModelManager-61"><a href="#AgentModelManager-61"><span class="linenos">61</span></a>
</span><span id="AgentModelManager-62"><a href="#AgentModelManager-62"><span class="linenos">62</span></a>            <span class="c1"># Use Ollama-compatible interface with optimized configuration</span>
</span><span id="AgentModelManager-63"><a href="#AgentModelManager-63"><span class="linenos">63</span></a>            <span class="k">return</span> <span class="n">Ollama</span><span class="p">(</span>
</span><span id="AgentModelManager-64"><a href="#AgentModelManager-64"><span class="linenos">64</span></a>                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
</span><span id="AgentModelManager-65"><a href="#AgentModelManager-65"><span class="linenos">65</span></a>                <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ollama_base_url</span><span class="p">,</span>  <span class="c1"># Use host parameter for Ollama</span>
</span><span id="AgentModelManager-66"><a href="#AgentModelManager-66"><span class="linenos">66</span></a>                <span class="n">options</span><span class="o">=</span><span class="p">{</span>
</span><span id="AgentModelManager-67"><a href="#AgentModelManager-67"><span class="linenos">67</span></a>                    <span class="s2">&quot;num_ctx&quot;</span><span class="p">:</span> <span class="n">context_size</span><span class="p">,</span>  <span class="c1"># Use dynamically detected context window</span>
</span><span id="AgentModelManager-68"><a href="#AgentModelManager-68"><span class="linenos">68</span></a>                    <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>  <span class="c1"># Optional: set temperature for consistency</span>
</span><span id="AgentModelManager-69"><a href="#AgentModelManager-69"><span class="linenos">69</span></a>                    <span class="s2">&quot;num_predict&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Allow unlimited prediction length</span>
</span><span id="AgentModelManager-70"><a href="#AgentModelManager-70"><span class="linenos">70</span></a>                    <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
</span><span id="AgentModelManager-71"><a href="#AgentModelManager-71"><span class="linenos">71</span></a>                    <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="AgentModelManager-72"><a href="#AgentModelManager-72"><span class="linenos">72</span></a>                    <span class="s2">&quot;repeat_penalty&quot;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
</span><span id="AgentModelManager-73"><a href="#AgentModelManager-73"><span class="linenos">73</span></a>                    <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
</span><span id="AgentModelManager-74"><a href="#AgentModelManager-74"><span class="linenos">74</span></a>                <span class="p">},</span>
</span><span id="AgentModelManager-75"><a href="#AgentModelManager-75"><span class="linenos">75</span></a>            <span class="p">)</span>
</span><span id="AgentModelManager-76"><a href="#AgentModelManager-76"><span class="linenos">76</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentModelManager-77"><a href="#AgentModelManager-77"><span class="linenos">77</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported model provider: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Manages model creation and configuration.</p>
</div>


                            <div id="AgentModelManager.__init__" class="classattr">
                                        <input id="AgentModelManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AgentModelManager</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">ollama_base_url</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="AgentModelManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentModelManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentModelManager.__init__-24"><a href="#AgentModelManager.__init__-24"><span class="linenos">24</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ollama_base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AgentModelManager.__init__-25"><a href="#AgentModelManager.__init__-25"><span class="linenos">25</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the model manager.</span>
</span><span id="AgentModelManager.__init__-26"><a href="#AgentModelManager.__init__-26"><span class="linenos">26</span></a><span class="sd">        </span>
</span><span id="AgentModelManager.__init__-27"><a href="#AgentModelManager.__init__-27"><span class="linenos">27</span></a><span class="sd">        Args:</span>
</span><span id="AgentModelManager.__init__-28"><a href="#AgentModelManager.__init__-28"><span class="linenos">28</span></a><span class="sd">            model_provider: LLM provider (&#39;ollama&#39; or &#39;openai&#39;)</span>
</span><span id="AgentModelManager.__init__-29"><a href="#AgentModelManager.__init__-29"><span class="linenos">29</span></a><span class="sd">            model_name: Model name to use</span>
</span><span id="AgentModelManager.__init__-30"><a href="#AgentModelManager.__init__-30"><span class="linenos">30</span></a><span class="sd">            ollama_base_url: Base URL for Ollama API</span>
</span><span id="AgentModelManager.__init__-31"><a href="#AgentModelManager.__init__-31"><span class="linenos">31</span></a><span class="sd">            seed: Optional seed for model reproducibility</span>
</span><span id="AgentModelManager.__init__-32"><a href="#AgentModelManager.__init__-32"><span class="linenos">32</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentModelManager.__init__-33"><a href="#AgentModelManager.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span> <span class="o">=</span> <span class="n">model_provider</span>
</span><span id="AgentModelManager.__init__-34"><a href="#AgentModelManager.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="AgentModelManager.__init__-35"><a href="#AgentModelManager.__init__-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ollama_base_url</span> <span class="o">=</span> <span class="n">ollama_base_url</span>
</span><span id="AgentModelManager.__init__-36"><a href="#AgentModelManager.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the model manager.</p>

<p>Args:
    model_provider: LLM provider ('ollama' or 'openai')
    model_name: Model name to use
    ollama_base_url: Base URL for Ollama API
    seed: Optional seed for model reproducibility</p>
</div>


                            </div>
                            <div id="AgentModelManager.model_provider" class="classattr">
                                <div class="attr variable">
            <span class="name">model_provider</span>

        
    </div>
    <a class="headerlink" href="#AgentModelManager.model_provider"></a>
    
    

                            </div>
                            <div id="AgentModelManager.model_name" class="classattr">
                                <div class="attr variable">
            <span class="name">model_name</span>

        
    </div>
    <a class="headerlink" href="#AgentModelManager.model_name"></a>
    
    

                            </div>
                            <div id="AgentModelManager.ollama_base_url" class="classattr">
                                <div class="attr variable">
            <span class="name">ollama_base_url</span>

        
    </div>
    <a class="headerlink" href="#AgentModelManager.ollama_base_url"></a>
    
    

                            </div>
                            <div id="AgentModelManager.seed" class="classattr">
                                <div class="attr variable">
            <span class="name">seed</span>

        
    </div>
    <a class="headerlink" href="#AgentModelManager.seed"></a>
    
    

                            </div>
                            <div id="AgentModelManager.create_model" class="classattr">
                                        <input id="AgentModelManager.create_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_model</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">agno</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">openai</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">OpenAIChat</span><span class="p">,</span> <span class="n">agno</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ollama</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">Ollama</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AgentModelManager.create_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AgentModelManager.create_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AgentModelManager.create_model-38"><a href="#AgentModelManager.create_model-38"><span class="linenos">38</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">OpenAIChat</span><span class="p">,</span> <span class="n">Ollama</span><span class="p">]:</span>
</span><span id="AgentModelManager.create_model-39"><a href="#AgentModelManager.create_model-39"><span class="linenos">39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the appropriate model instance based on provider.</span>
</span><span id="AgentModelManager.create_model-40"><a href="#AgentModelManager.create_model-40"><span class="linenos">40</span></a>
</span><span id="AgentModelManager.create_model-41"><a href="#AgentModelManager.create_model-41"><span class="linenos">41</span></a><span class="sd">        Returns:</span>
</span><span id="AgentModelManager.create_model-42"><a href="#AgentModelManager.create_model-42"><span class="linenos">42</span></a><span class="sd">            Configured model instance</span>
</span><span id="AgentModelManager.create_model-43"><a href="#AgentModelManager.create_model-43"><span class="linenos">43</span></a><span class="sd">            </span>
</span><span id="AgentModelManager.create_model-44"><a href="#AgentModelManager.create_model-44"><span class="linenos">44</span></a><span class="sd">        Raises:</span>
</span><span id="AgentModelManager.create_model-45"><a href="#AgentModelManager.create_model-45"><span class="linenos">45</span></a><span class="sd">            ValueError: If unsupported model provider is specified</span>
</span><span id="AgentModelManager.create_model-46"><a href="#AgentModelManager.create_model-46"><span class="linenos">46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AgentModelManager.create_model-47"><a href="#AgentModelManager.create_model-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span> <span class="o">==</span> <span class="s2">&quot;openai&quot;</span><span class="p">:</span>
</span><span id="AgentModelManager.create_model-48"><a href="#AgentModelManager.create_model-48"><span class="linenos">48</span></a>            <span class="k">return</span> <span class="n">OpenAIChat</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="AgentModelManager.create_model-49"><a href="#AgentModelManager.create_model-49"><span class="linenos">49</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span> <span class="o">==</span> <span class="s2">&quot;ollama&quot;</span><span class="p">:</span>
</span><span id="AgentModelManager.create_model-50"><a href="#AgentModelManager.create_model-50"><span class="linenos">50</span></a>            <span class="c1"># Get dynamic context size for this model</span>
</span><span id="AgentModelManager.create_model-51"><a href="#AgentModelManager.create_model-51"><span class="linenos">51</span></a>            <span class="n">context_size</span><span class="p">,</span> <span class="n">detection_method</span> <span class="o">=</span> <span class="n">get_model_context_size_sync</span><span class="p">(</span>
</span><span id="AgentModelManager.create_model-52"><a href="#AgentModelManager.create_model-52"><span class="linenos">52</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ollama_base_url</span>
</span><span id="AgentModelManager.create_model-53"><a href="#AgentModelManager.create_model-53"><span class="linenos">53</span></a>            <span class="p">)</span>
</span><span id="AgentModelManager.create_model-54"><a href="#AgentModelManager.create_model-54"><span class="linenos">54</span></a>
</span><span id="AgentModelManager.create_model-55"><a href="#AgentModelManager.create_model-55"><span class="linenos">55</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AgentModelManager.create_model-56"><a href="#AgentModelManager.create_model-56"><span class="linenos">56</span></a>                <span class="s2">&quot;Using context size </span><span class="si">%d</span><span class="s2"> for model </span><span class="si">%s</span><span class="s2"> (detected via: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-57"><a href="#AgentModelManager.create_model-57"><span class="linenos">57</span></a>                <span class="n">context_size</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-58"><a href="#AgentModelManager.create_model-58"><span class="linenos">58</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-59"><a href="#AgentModelManager.create_model-59"><span class="linenos">59</span></a>                <span class="n">detection_method</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-60"><a href="#AgentModelManager.create_model-60"><span class="linenos">60</span></a>            <span class="p">)</span>
</span><span id="AgentModelManager.create_model-61"><a href="#AgentModelManager.create_model-61"><span class="linenos">61</span></a>
</span><span id="AgentModelManager.create_model-62"><a href="#AgentModelManager.create_model-62"><span class="linenos">62</span></a>            <span class="c1"># Use Ollama-compatible interface with optimized configuration</span>
</span><span id="AgentModelManager.create_model-63"><a href="#AgentModelManager.create_model-63"><span class="linenos">63</span></a>            <span class="k">return</span> <span class="n">Ollama</span><span class="p">(</span>
</span><span id="AgentModelManager.create_model-64"><a href="#AgentModelManager.create_model-64"><span class="linenos">64</span></a>                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-65"><a href="#AgentModelManager.create_model-65"><span class="linenos">65</span></a>                <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ollama_base_url</span><span class="p">,</span>  <span class="c1"># Use host parameter for Ollama</span>
</span><span id="AgentModelManager.create_model-66"><a href="#AgentModelManager.create_model-66"><span class="linenos">66</span></a>                <span class="n">options</span><span class="o">=</span><span class="p">{</span>
</span><span id="AgentModelManager.create_model-67"><a href="#AgentModelManager.create_model-67"><span class="linenos">67</span></a>                    <span class="s2">&quot;num_ctx&quot;</span><span class="p">:</span> <span class="n">context_size</span><span class="p">,</span>  <span class="c1"># Use dynamically detected context window</span>
</span><span id="AgentModelManager.create_model-68"><a href="#AgentModelManager.create_model-68"><span class="linenos">68</span></a>                    <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>  <span class="c1"># Optional: set temperature for consistency</span>
</span><span id="AgentModelManager.create_model-69"><a href="#AgentModelManager.create_model-69"><span class="linenos">69</span></a>                    <span class="s2">&quot;num_predict&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Allow unlimited prediction length</span>
</span><span id="AgentModelManager.create_model-70"><a href="#AgentModelManager.create_model-70"><span class="linenos">70</span></a>                    <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-71"><a href="#AgentModelManager.create_model-71"><span class="linenos">71</span></a>                    <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-72"><a href="#AgentModelManager.create_model-72"><span class="linenos">72</span></a>                    <span class="s2">&quot;repeat_penalty&quot;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-73"><a href="#AgentModelManager.create_model-73"><span class="linenos">73</span></a>                    <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
</span><span id="AgentModelManager.create_model-74"><a href="#AgentModelManager.create_model-74"><span class="linenos">74</span></a>                <span class="p">},</span>
</span><span id="AgentModelManager.create_model-75"><a href="#AgentModelManager.create_model-75"><span class="linenos">75</span></a>            <span class="p">)</span>
</span><span id="AgentModelManager.create_model-76"><a href="#AgentModelManager.create_model-76"><span class="linenos">76</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AgentModelManager.create_model-77"><a href="#AgentModelManager.create_model-77"><span class="linenos">77</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported model provider: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create the appropriate model instance based on provider.</p>

<p>Returns:
    Configured model instance</p>

<p>Raises:
    ValueError: If unsupported model provider is specified</p>
</div>


                            </div>
                </section>
                <section id="USE_MCP">
                    <div class="attr variable">
            <span class="name">USE_MCP</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#USE_MCP"></a>
    
    

                </section>
                <section id="USE_WEAVIATE">
                    <div class="attr variable">
            <span class="name">USE_WEAVIATE</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#USE_WEAVIATE"></a>
    
    

                </section>
                <section id="get_mcp_servers">
                            <input id="get_mcp_servers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_mcp_servers</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_mcp_servers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_mcp_servers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_mcp_servers-54"><a href="#get_mcp_servers-54"><span class="linenos">54</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_mcp_servers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="get_mcp_servers-55"><a href="#get_mcp_servers-55"><span class="linenos">55</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get MCP server configurations.&quot;&quot;&quot;</span>
</span><span id="get_mcp_servers-56"><a href="#get_mcp_servers-56"><span class="linenos">56</span></a>    <span class="k">return</span> <span class="n">MCP_SERVERS</span>
</span></pre></div>


            <div class="docstring"><p>Get MCP server configurations.</p>
</div>


                </section>
                <section id="get_all_tools">
                            <input id="get_all_tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_tools</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">mcp_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">weaviate_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vector_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">langchain_core</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseTool</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_all_tools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_all_tools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_all_tools-50"><a href="#get_all_tools-50"><span class="linenos"> 50</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_all_tools</span><span class="p">(</span>
</span><span id="get_all_tools-51"><a href="#get_all_tools-51"><span class="linenos"> 51</span></a>    <span class="n">mcp_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_all_tools-52"><a href="#get_all_tools-52"><span class="linenos"> 52</span></a>    <span class="n">weaviate_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_all_tools-53"><a href="#get_all_tools-53"><span class="linenos"> 53</span></a>    <span class="n">vector_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_all_tools-54"><a href="#get_all_tools-54"><span class="linenos"> 54</span></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_all_tools-55"><a href="#get_all_tools-55"><span class="linenos"> 55</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;BaseTool&quot;</span><span class="p">]:</span>
</span><span id="get_all_tools-56"><a href="#get_all_tools-56"><span class="linenos"> 56</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_all_tools-57"><a href="#get_all_tools-57"><span class="linenos"> 57</span></a><span class="sd">    Get all available tools with injected dependencies.</span>
</span><span id="get_all_tools-58"><a href="#get_all_tools-58"><span class="linenos"> 58</span></a>
</span><span id="get_all_tools-59"><a href="#get_all_tools-59"><span class="linenos"> 59</span></a><span class="sd">    Args:</span>
</span><span id="get_all_tools-60"><a href="#get_all_tools-60"><span class="linenos"> 60</span></a><span class="sd">        mcp_client: MCP client for file operations and external tools</span>
</span><span id="get_all_tools-61"><a href="#get_all_tools-61"><span class="linenos"> 61</span></a><span class="sd">        weaviate_client: Weaviate client for vector operations</span>
</span><span id="get_all_tools-62"><a href="#get_all_tools-62"><span class="linenos"> 62</span></a><span class="sd">        vector_store: Vector store for knowledge base operations</span>
</span><span id="get_all_tools-63"><a href="#get_all_tools-63"><span class="linenos"> 63</span></a><span class="sd">        logger: Logger instance for tool operations</span>
</span><span id="get_all_tools-64"><a href="#get_all_tools-64"><span class="linenos"> 64</span></a>
</span><span id="get_all_tools-65"><a href="#get_all_tools-65"><span class="linenos"> 65</span></a><span class="sd">    Returns:</span>
</span><span id="get_all_tools-66"><a href="#get_all_tools-66"><span class="linenos"> 66</span></a><span class="sd">        List of initialized tools</span>
</span><span id="get_all_tools-67"><a href="#get_all_tools-67"><span class="linenos"> 67</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_all_tools-68"><a href="#get_all_tools-68"><span class="linenos"> 68</span></a>    <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="get_all_tools-69"><a href="#get_all_tools-69"><span class="linenos"> 69</span></a>
</span><span id="get_all_tools-70"><a href="#get_all_tools-70"><span class="linenos"> 70</span></a>    <span class="c1"># Import tools modules and inject dependencies</span>
</span><span id="get_all_tools-71"><a href="#get_all_tools-71"><span class="linenos"> 71</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">..config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">ROOT_DIR</span>
</span><span id="get_all_tools-72"><a href="#get_all_tools-72"><span class="linenos"> 72</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span><span class="p">,</span> <span class="n">memory_tools</span><span class="p">,</span> <span class="n">research</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">web</span>
</span><span id="get_all_tools-73"><a href="#get_all_tools-73"><span class="linenos"> 73</span></a>
</span><span id="get_all_tools-74"><a href="#get_all_tools-74"><span class="linenos"> 74</span></a>    <span class="c1"># Inject global dependencies into each module that needs them</span>
</span><span id="get_all_tools-75"><a href="#get_all_tools-75"><span class="linenos"> 75</span></a>    <span class="k">if</span> <span class="n">mcp_client</span><span class="p">:</span>
</span><span id="get_all_tools-76"><a href="#get_all_tools-76"><span class="linenos"> 76</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="get_all_tools-77"><a href="#get_all_tools-77"><span class="linenos"> 77</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-78"><a href="#get_all_tools-78"><span class="linenos"> 78</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">ROOT_DIR</span> <span class="o">=</span> <span class="n">ROOT_DIR</span>
</span><span id="get_all_tools-79"><a href="#get_all_tools-79"><span class="linenos"> 79</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">DATA_DIR</span>
</span><span id="get_all_tools-80"><a href="#get_all_tools-80"><span class="linenos"> 80</span></a>
</span><span id="get_all_tools-81"><a href="#get_all_tools-81"><span class="linenos"> 81</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="get_all_tools-82"><a href="#get_all_tools-82"><span class="linenos"> 82</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-83"><a href="#get_all_tools-83"><span class="linenos"> 83</span></a>
</span><span id="get_all_tools-84"><a href="#get_all_tools-84"><span class="linenos"> 84</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="get_all_tools-85"><a href="#get_all_tools-85"><span class="linenos"> 85</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-86"><a href="#get_all_tools-86"><span class="linenos"> 86</span></a>
</span><span id="get_all_tools-87"><a href="#get_all_tools-87"><span class="linenos"> 87</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="get_all_tools-88"><a href="#get_all_tools-88"><span class="linenos"> 88</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-89"><a href="#get_all_tools-89"><span class="linenos"> 89</span></a>
</span><span id="get_all_tools-90"><a href="#get_all_tools-90"><span class="linenos"> 90</span></a>    <span class="c1"># Inject logger into all modules</span>
</span><span id="get_all_tools-91"><a href="#get_all_tools-91"><span class="linenos"> 91</span></a>    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
</span><span id="get_all_tools-92"><a href="#get_all_tools-92"><span class="linenos"> 92</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-93"><a href="#get_all_tools-93"><span class="linenos"> 93</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-94"><a href="#get_all_tools-94"><span class="linenos"> 94</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-95"><a href="#get_all_tools-95"><span class="linenos"> 95</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-96"><a href="#get_all_tools-96"><span class="linenos"> 96</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-97"><a href="#get_all_tools-97"><span class="linenos"> 97</span></a>
</span><span id="get_all_tools-98"><a href="#get_all_tools-98"><span class="linenos"> 98</span></a>    <span class="k">if</span> <span class="n">weaviate_client</span> <span class="ow">and</span> <span class="n">vector_store</span><span class="p">:</span>
</span><span id="get_all_tools-99"><a href="#get_all_tools-99"><span class="linenos"> 99</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">weaviate_client</span> <span class="o">=</span> <span class="n">weaviate_client</span>
</span><span id="get_all_tools-100"><a href="#get_all_tools-100"><span class="linenos">100</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-101"><a href="#get_all_tools-101"><span class="linenos">101</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-102"><a href="#get_all_tools-102"><span class="linenos">102</span></a>
</span><span id="get_all_tools-103"><a href="#get_all_tools-103"><span class="linenos">103</span></a>        <span class="c1"># Inject Weaviate dependencies into other modules</span>
</span><span id="get_all_tools-104"><a href="#get_all_tools-104"><span class="linenos">104</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-105"><a href="#get_all_tools-105"><span class="linenos">105</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-106"><a href="#get_all_tools-106"><span class="linenos">106</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="get_all_tools-107"><a href="#get_all_tools-107"><span class="linenos">107</span></a>
</span><span id="get_all_tools-108"><a href="#get_all_tools-108"><span class="linenos">108</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-109"><a href="#get_all_tools-109"><span class="linenos">109</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-110"><a href="#get_all_tools-110"><span class="linenos">110</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="get_all_tools-111"><a href="#get_all_tools-111"><span class="linenos">111</span></a>
</span><span id="get_all_tools-112"><a href="#get_all_tools-112"><span class="linenos">112</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-113"><a href="#get_all_tools-113"><span class="linenos">113</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-114"><a href="#get_all_tools-114"><span class="linenos">114</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="get_all_tools-115"><a href="#get_all_tools-115"><span class="linenos">115</span></a>
</span><span id="get_all_tools-116"><a href="#get_all_tools-116"><span class="linenos">116</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-117"><a href="#get_all_tools-117"><span class="linenos">117</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-118"><a href="#get_all_tools-118"><span class="linenos">118</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="get_all_tools-119"><a href="#get_all_tools-119"><span class="linenos">119</span></a>
</span><span id="get_all_tools-120"><a href="#get_all_tools-120"><span class="linenos">120</span></a>    <span class="c1"># Memory tools (require Weaviate)</span>
</span><span id="get_all_tools-121"><a href="#get_all_tools-121"><span class="linenos">121</span></a>    <span class="k">if</span> <span class="n">weaviate_client</span> <span class="ow">and</span> <span class="n">vector_store</span><span class="p">:</span>
</span><span id="get_all_tools-122"><a href="#get_all_tools-122"><span class="linenos">122</span></a>        <span class="n">memory_tools_list</span> <span class="o">=</span> <span class="n">create_memory_tools</span><span class="p">(</span><span class="n">weaviate_client</span><span class="p">,</span> <span class="n">vector_store</span><span class="p">)</span>
</span><span id="get_all_tools-123"><a href="#get_all_tools-123"><span class="linenos">123</span></a>        <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">memory_tools_list</span><span class="p">)</span>
</span><span id="get_all_tools-124"><a href="#get_all_tools-124"><span class="linenos">124</span></a>
</span><span id="get_all_tools-125"><a href="#get_all_tools-125"><span class="linenos">125</span></a>    <span class="c1"># MCP-based tools (require MCP client)</span>
</span><span id="get_all_tools-126"><a href="#get_all_tools-126"><span class="linenos">126</span></a>    <span class="k">if</span> <span class="n">mcp_client</span><span class="p">:</span>
</span><span id="get_all_tools-127"><a href="#get_all_tools-127"><span class="linenos">127</span></a>        <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="get_all_tools-128"><a href="#get_all_tools-128"><span class="linenos">128</span></a>            <span class="p">[</span>
</span><span id="get_all_tools-129"><a href="#get_all_tools-129"><span class="linenos">129</span></a>                <span class="c1"># Filesystem tools</span>
</span><span id="get_all_tools-130"><a href="#get_all_tools-130"><span class="linenos">130</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_read_file</span><span class="p">,</span>
</span><span id="get_all_tools-131"><a href="#get_all_tools-131"><span class="linenos">131</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_write_file</span><span class="p">,</span>
</span><span id="get_all_tools-132"><a href="#get_all_tools-132"><span class="linenos">132</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_list_directory</span><span class="p">,</span>
</span><span id="get_all_tools-133"><a href="#get_all_tools-133"><span class="linenos">133</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">intelligent_file_search</span><span class="p">,</span>
</span><span id="get_all_tools-134"><a href="#get_all_tools-134"><span class="linenos">134</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">create_and_save_file</span><span class="p">,</span>
</span><span id="get_all_tools-135"><a href="#get_all_tools-135"><span class="linenos">135</span></a>                <span class="c1"># Web tools</span>
</span><span id="get_all_tools-136"><a href="#get_all_tools-136"><span class="linenos">136</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_github_search</span><span class="p">,</span>
</span><span id="get_all_tools-137"><a href="#get_all_tools-137"><span class="linenos">137</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_brave_search</span><span class="p">,</span>
</span><span id="get_all_tools-138"><a href="#get_all_tools-138"><span class="linenos">138</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_fetch_url</span><span class="p">,</span>
</span><span id="get_all_tools-139"><a href="#get_all_tools-139"><span class="linenos">139</span></a>                <span class="c1"># System tools</span>
</span><span id="get_all_tools-140"><a href="#get_all_tools-140"><span class="linenos">140</span></a>                <span class="n">system</span><span class="o">.</span><span class="n">mcp_shell_command</span><span class="p">,</span>
</span><span id="get_all_tools-141"><a href="#get_all_tools-141"><span class="linenos">141</span></a>                <span class="c1"># Research tools</span>
</span><span id="get_all_tools-142"><a href="#get_all_tools-142"><span class="linenos">142</span></a>                <span class="n">research</span><span class="o">.</span><span class="n">comprehensive_research</span><span class="p">,</span>
</span><span id="get_all_tools-143"><a href="#get_all_tools-143"><span class="linenos">143</span></a>            <span class="p">]</span>
</span><span id="get_all_tools-144"><a href="#get_all_tools-144"><span class="linenos">144</span></a>        <span class="p">)</span>
</span><span id="get_all_tools-145"><a href="#get_all_tools-145"><span class="linenos">145</span></a>
</span><span id="get_all_tools-146"><a href="#get_all_tools-146"><span class="linenos">146</span></a>    <span class="k">return</span> <span class="n">tools</span>
</span></pre></div>


            <div class="docstring"><p>Get all available tools with injected dependencies.</p>

<p>Args:
    mcp_client: MCP client for file operations and external tools
    weaviate_client: Weaviate client for vector operations
    vector_store: Vector store for knowledge base operations
    logger: Logger instance for tool operations</p>

<p>Returns:
    List of initialized tools</p>
</div>


                </section>
                <section id="cleanup">
                            <input id="cleanup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cleanup</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="cleanup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cleanup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cleanup-41"><a href="#cleanup-41"><span class="linenos">41</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">():</span>
</span><span id="cleanup-42"><a href="#cleanup-42"><span class="linenos">42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean up resources on shutdown.&quot;&quot;&quot;</span>
</span><span id="cleanup-43"><a href="#cleanup-43"><span class="linenos">43</span></a>    <span class="k">global</span> <span class="n">weaviate_client</span><span class="p">,</span> <span class="n">vector_store</span>
</span><span id="cleanup-44"><a href="#cleanup-44"><span class="linenos">44</span></a>
</span><span id="cleanup-45"><a href="#cleanup-45"><span class="linenos">45</span></a>    <span class="c1"># Prevent multiple cleanup calls</span>
</span><span id="cleanup-46"><a href="#cleanup-46"><span class="linenos">46</span></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cleanup</span><span class="p">,</span> <span class="s2">&quot;called&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cleanup</span><span class="o">.</span><span class="n">called</span><span class="p">:</span>
</span><span id="cleanup-47"><a href="#cleanup-47"><span class="linenos">47</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleanup already called, skipping...&quot;</span><span class="p">)</span>
</span><span id="cleanup-48"><a href="#cleanup-48"><span class="linenos">48</span></a>        <span class="k">return</span>
</span><span id="cleanup-49"><a href="#cleanup-49"><span class="linenos">49</span></a>    <span class="n">cleanup</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="cleanup-50"><a href="#cleanup-50"><span class="linenos">50</span></a>
</span><span id="cleanup-51"><a href="#cleanup-51"><span class="linenos">51</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting cleanup process...&quot;</span><span class="p">)</span>
</span><span id="cleanup-52"><a href="#cleanup-52"><span class="linenos">52</span></a>
</span><span id="cleanup-53"><a href="#cleanup-53"><span class="linenos">53</span></a>    <span class="c1"># Clean up MCP servers</span>
</span><span id="cleanup-54"><a href="#cleanup-54"><span class="linenos">54</span></a>    <span class="k">if</span> <span class="n">mcp_client</span><span class="p">:</span>
</span><span id="cleanup-55"><a href="#cleanup-55"><span class="linenos">55</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="cleanup-56"><a href="#cleanup-56"><span class="linenos">56</span></a>            <span class="c1"># Use stop_all_servers method (no need for individual stops)</span>
</span><span id="cleanup-57"><a href="#cleanup-57"><span class="linenos">57</span></a>            <span class="n">mcp_client</span><span class="o">.</span><span class="n">stop_all_servers</span><span class="p">()</span>
</span><span id="cleanup-58"><a href="#cleanup-58"><span class="linenos">58</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MCP servers stopped successfully&quot;</span><span class="p">)</span>
</span><span id="cleanup-59"><a href="#cleanup-59"><span class="linenos">59</span></a>
</span><span id="cleanup-60"><a href="#cleanup-60"><span class="linenos">60</span></a>            <span class="c1"># Give servers time to shutdown properly</span>
</span><span id="cleanup-61"><a href="#cleanup-61"><span class="linenos">61</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="cleanup-62"><a href="#cleanup-62"><span class="linenos">62</span></a>
</span><span id="cleanup-63"><a href="#cleanup-63"><span class="linenos">63</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="cleanup-64"><a href="#cleanup-64"><span class="linenos">64</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error stopping MCP servers: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="cleanup-65"><a href="#cleanup-65"><span class="linenos">65</span></a>
</span><span id="cleanup-66"><a href="#cleanup-66"><span class="linenos">66</span></a>    <span class="c1"># Clean up Weaviate vector store and client</span>
</span><span id="cleanup-67"><a href="#cleanup-67"><span class="linenos">67</span></a>    <span class="k">if</span> <span class="n">vector_store</span><span class="p">:</span>
</span><span id="cleanup-68"><a href="#cleanup-68"><span class="linenos">68</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="cleanup-69"><a href="#cleanup-69"><span class="linenos">69</span></a>            <span class="c1"># Clean up the vector store first</span>
</span><span id="cleanup-70"><a href="#cleanup-70"><span class="linenos">70</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">vector_store</span><span class="p">,</span> <span class="s2">&quot;client&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">vector_store</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
</span><span id="cleanup-71"><a href="#cleanup-71"><span class="linenos">71</span></a>                <span class="n">vector_store</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="cleanup-72"><a href="#cleanup-72"><span class="linenos">72</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Vector store client closed&quot;</span><span class="p">)</span>
</span><span id="cleanup-73"><a href="#cleanup-73"><span class="linenos">73</span></a>            <span class="n">vector_store</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="cleanup-74"><a href="#cleanup-74"><span class="linenos">74</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="cleanup-75"><a href="#cleanup-75"><span class="linenos">75</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error closing vector store: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="cleanup-76"><a href="#cleanup-76"><span class="linenos">76</span></a>
</span><span id="cleanup-77"><a href="#cleanup-77"><span class="linenos">77</span></a>    <span class="k">if</span> <span class="n">weaviate_client</span><span class="p">:</span>
</span><span id="cleanup-78"><a href="#cleanup-78"><span class="linenos">78</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="cleanup-79"><a href="#cleanup-79"><span class="linenos">79</span></a>            <span class="c1"># Ensure the client is properly disconnected</span>
</span><span id="cleanup-80"><a href="#cleanup-80"><span class="linenos">80</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="cleanup-81"><a href="#cleanup-81"><span class="linenos">81</span></a>                <span class="nb">hasattr</span><span class="p">(</span><span class="n">weaviate_client</span><span class="p">,</span> <span class="s2">&quot;is_connected&quot;</span><span class="p">)</span>
</span><span id="cleanup-82"><a href="#cleanup-82"><span class="linenos">82</span></a>                <span class="ow">and</span> <span class="n">weaviate_client</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span>
</span><span id="cleanup-83"><a href="#cleanup-83"><span class="linenos">83</span></a>            <span class="p">):</span>
</span><span id="cleanup-84"><a href="#cleanup-84"><span class="linenos">84</span></a>                <span class="n">weaviate_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="cleanup-85"><a href="#cleanup-85"><span class="linenos">85</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Weaviate client closed successfully&quot;</span><span class="p">)</span>
</span><span id="cleanup-86"><a href="#cleanup-86"><span class="linenos">86</span></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">weaviate_client</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
</span><span id="cleanup-87"><a href="#cleanup-87"><span class="linenos">87</span></a>                <span class="n">weaviate_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="cleanup-88"><a href="#cleanup-88"><span class="linenos">88</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Weaviate client closed successfully&quot;</span><span class="p">)</span>
</span><span id="cleanup-89"><a href="#cleanup-89"><span class="linenos">89</span></a>            <span class="n">weaviate_client</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="cleanup-90"><a href="#cleanup-90"><span class="linenos">90</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="cleanup-91"><a href="#cleanup-91"><span class="linenos">91</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error closing Weaviate client: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="cleanup-92"><a href="#cleanup-92"><span class="linenos">92</span></a>
</span><span id="cleanup-93"><a href="#cleanup-93"><span class="linenos">93</span></a>    <span class="c1"># Force garbage collection to help with cleanup</span>
</span><span id="cleanup-94"><a href="#cleanup-94"><span class="linenos">94</span></a>    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="cleanup-95"><a href="#cleanup-95"><span class="linenos">95</span></a>
</span><span id="cleanup-96"><a href="#cleanup-96"><span class="linenos">96</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleanup process completed&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Clean up resources on shutdown.</p>
</div>


                </section>
                <section id="inject_dependencies">
                            <input id="inject_dependencies-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">inject_dependencies</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">weaviate_cli</span>, </span><span class="param"><span class="n">vec_store</span>, </span><span class="param"><span class="n">mcp_cli</span>, </span><span class="param"><span class="n">log</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="inject_dependencies-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#inject_dependencies"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="inject_dependencies-32"><a href="#inject_dependencies-32"><span class="linenos">32</span></a><span class="k">def</span><span class="w"> </span><span class="nf">inject_dependencies</span><span class="p">(</span><span class="n">weaviate_cli</span><span class="p">,</span> <span class="n">vec_store</span><span class="p">,</span> <span class="n">mcp_cli</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
</span><span id="inject_dependencies-33"><a href="#inject_dependencies-33"><span class="linenos">33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Inject dependencies for cleanup functions.&quot;&quot;&quot;</span>
</span><span id="inject_dependencies-34"><a href="#inject_dependencies-34"><span class="linenos">34</span></a>    <span class="k">global</span> <span class="n">weaviate_client</span><span class="p">,</span> <span class="n">vector_store</span><span class="p">,</span> <span class="n">mcp_client</span><span class="p">,</span> <span class="n">logger</span>
</span><span id="inject_dependencies-35"><a href="#inject_dependencies-35"><span class="linenos">35</span></a>    <span class="n">weaviate_client</span> <span class="o">=</span> <span class="n">weaviate_cli</span>
</span><span id="inject_dependencies-36"><a href="#inject_dependencies-36"><span class="linenos">36</span></a>    <span class="n">vector_store</span> <span class="o">=</span> <span class="n">vec_store</span>
</span><span id="inject_dependencies-37"><a href="#inject_dependencies-37"><span class="linenos">37</span></a>    <span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_cli</span>
</span><span id="inject_dependencies-38"><a href="#inject_dependencies-38"><span class="linenos">38</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">log</span>
</span></pre></div>


            <div class="docstring"><p>Inject dependencies for cleanup functions.</p>
</div>


                </section>
                <section id="register_cleanup_handlers">
                            <input id="register_cleanup_handlers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_cleanup_handlers</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="register_cleanup_handlers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#register_cleanup_handlers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="register_cleanup_handlers-106"><a href="#register_cleanup_handlers-106"><span class="linenos">106</span></a><span class="k">def</span><span class="w"> </span><span class="nf">register_cleanup_handlers</span><span class="p">():</span>
</span><span id="register_cleanup_handlers-107"><a href="#register_cleanup_handlers-107"><span class="linenos">107</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Register cleanup functions and signal handlers.&quot;&quot;&quot;</span>
</span><span id="register_cleanup_handlers-108"><a href="#register_cleanup_handlers-108"><span class="linenos">108</span></a>    <span class="c1"># Register cleanup function for normal exit</span>
</span><span id="register_cleanup_handlers-109"><a href="#register_cleanup_handlers-109"><span class="linenos">109</span></a>    <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>
</span><span id="register_cleanup_handlers-110"><a href="#register_cleanup_handlers-110"><span class="linenos">110</span></a>
</span><span id="register_cleanup_handlers-111"><a href="#register_cleanup_handlers-111"><span class="linenos">111</span></a>    <span class="c1"># Register signal handlers for graceful shutdown</span>
</span><span id="register_cleanup_handlers-112"><a href="#register_cleanup_handlers-112"><span class="linenos">112</span></a>    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
</span><span id="register_cleanup_handlers-113"><a href="#register_cleanup_handlers-113"><span class="linenos">113</span></a>    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Register cleanup functions and signal handlers.</p>
</div>


                </section>
                <section id="configure_all_rich_logging">
                            <input id="configure_all_rich_logging-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">configure_all_rich_logging</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="configure_all_rich_logging-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#configure_all_rich_logging"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="configure_all_rich_logging-414"><a href="#configure_all_rich_logging-414"><span class="linenos">414</span></a><span class="k">def</span><span class="w"> </span><span class="nf">configure_all_rich_logging</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">LOG_LEVEL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="configure_all_rich_logging-415"><a href="#configure_all_rich_logging-415"><span class="linenos">415</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="configure_all_rich_logging-416"><a href="#configure_all_rich_logging-416"><span class="linenos">416</span></a><span class="sd">    Configure all logging in the application to use Rich handlers.</span>
</span><span id="configure_all_rich_logging-417"><a href="#configure_all_rich_logging-417"><span class="linenos">417</span></a>
</span><span id="configure_all_rich_logging-418"><a href="#configure_all_rich_logging-418"><span class="linenos">418</span></a><span class="sd">    This includes both personal agent loggers and agno framework loggers.</span>
</span><span id="configure_all_rich_logging-419"><a href="#configure_all_rich_logging-419"><span class="linenos">419</span></a>
</span><span id="configure_all_rich_logging-420"><a href="#configure_all_rich_logging-420"><span class="linenos">420</span></a><span class="sd">    :param level: The logging level to set</span>
</span><span id="configure_all_rich_logging-421"><a href="#configure_all_rich_logging-421"><span class="linenos">421</span></a><span class="sd">    :type level: int</span>
</span><span id="configure_all_rich_logging-422"><a href="#configure_all_rich_logging-422"><span class="linenos">422</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="configure_all_rich_logging-423"><a href="#configure_all_rich_logging-423"><span class="linenos">423</span></a>    <span class="c1"># Set up Rich logging filters first</span>
</span><span id="configure_all_rich_logging-424"><a href="#configure_all_rich_logging-424"><span class="linenos">424</span></a>    <span class="n">setup_logging_filters</span><span class="p">()</span>
</span><span id="configure_all_rich_logging-425"><a href="#configure_all_rich_logging-425"><span class="linenos">425</span></a>
</span><span id="configure_all_rich_logging-426"><a href="#configure_all_rich_logging-426"><span class="linenos">426</span></a>    <span class="c1"># Configure agno framework logging</span>
</span><span id="configure_all_rich_logging-427"><a href="#configure_all_rich_logging-427"><span class="linenos">427</span></a>    <span class="n">setup_agno_rich_logging</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="configure_all_rich_logging-428"><a href="#configure_all_rich_logging-428"><span class="linenos">428</span></a>
</span><span id="configure_all_rich_logging-429"><a href="#configure_all_rich_logging-429"><span class="linenos">429</span></a>    <span class="c1"># Configure root logger with Rich handler</span>
</span><span id="configure_all_rich_logging-430"><a href="#configure_all_rich_logging-430"><span class="linenos">430</span></a>    <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="configure_all_rich_logging-431"><a href="#configure_all_rich_logging-431"><span class="linenos">431</span></a>
</span><span id="configure_all_rich_logging-432"><a href="#configure_all_rich_logging-432"><span class="linenos">432</span></a>    <span class="c1"># Clear existing handlers</span>
</span><span id="configure_all_rich_logging-433"><a href="#configure_all_rich_logging-433"><span class="linenos">433</span></a>    <span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="configure_all_rich_logging-434"><a href="#configure_all_rich_logging-434"><span class="linenos">434</span></a>
</span><span id="configure_all_rich_logging-435"><a href="#configure_all_rich_logging-435"><span class="linenos">435</span></a>    <span class="c1"># Add Rich handler to root logger</span>
</span><span id="configure_all_rich_logging-436"><a href="#configure_all_rich_logging-436"><span class="linenos">436</span></a>    <span class="n">rich_handler</span> <span class="o">=</span> <span class="n">RichHandler</span><span class="p">(</span><span class="n">rich_tracebacks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="configure_all_rich_logging-437"><a href="#configure_all_rich_logging-437"><span class="linenos">437</span></a>    <span class="n">rich_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
</span><span id="configure_all_rich_logging-438"><a href="#configure_all_rich_logging-438"><span class="linenos">438</span></a>        <span class="s2">&quot;PersonalAgent: </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(name)s</span><span class="s2">.</span><span class="si">%(funcName)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
</span><span id="configure_all_rich_logging-439"><a href="#configure_all_rich_logging-439"><span class="linenos">439</span></a>    <span class="p">)</span>
</span><span id="configure_all_rich_logging-440"><a href="#configure_all_rich_logging-440"><span class="linenos">440</span></a>    <span class="n">rich_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="configure_all_rich_logging-441"><a href="#configure_all_rich_logging-441"><span class="linenos">441</span></a>    <span class="n">rich_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">rich_formatter</span><span class="p">)</span>
</span><span id="configure_all_rich_logging-442"><a href="#configure_all_rich_logging-442"><span class="linenos">442</span></a>    <span class="n">root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">rich_handler</span><span class="p">)</span>
</span><span id="configure_all_rich_logging-443"><a href="#configure_all_rich_logging-443"><span class="linenos">443</span></a>    <span class="n">root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Configure all logging in the application to use Rich handlers.</p>

<p>This includes both personal agent loggers and agno framework loggers.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>level</strong>:  The logging level to set</li>
</ul>
</div>


                </section>
                <section id="configure_master_logger">
                            <input id="configure_master_logger-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">configure_master_logger</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">log_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span>, </span><span class="param"><span class="n">disabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="configure_master_logger-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#configure_master_logger"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="configure_master_logger-77"><a href="#configure_master_logger-77"><span class="linenos">77</span></a><span class="k">def</span><span class="w"> </span><span class="nf">configure_master_logger</span><span class="p">(</span>
</span><span id="configure_master_logger-78"><a href="#configure_master_logger-78"><span class="linenos">78</span></a>    <span class="n">log_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
</span><span id="configure_master_logger-79"><a href="#configure_master_logger-79"><span class="linenos">79</span></a>    <span class="n">disabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="configure_master_logger-80"><a href="#configure_master_logger-80"><span class="linenos">80</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="configure_master_logger-81"><a href="#configure_master_logger-81"><span class="linenos">81</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="configure_master_logger-82"><a href="#configure_master_logger-82"><span class="linenos">82</span></a><span class="sd">    Configures the root logger with the specified settings.</span>
</span><span id="configure_master_logger-83"><a href="#configure_master_logger-83"><span class="linenos">83</span></a>
</span><span id="configure_master_logger-84"><a href="#configure_master_logger-84"><span class="linenos">84</span></a><span class="sd">    :param log_level: The logging level to set. Defaults to logging.ERROR.</span>
</span><span id="configure_master_logger-85"><a href="#configure_master_logger-85"><span class="linenos">85</span></a><span class="sd">    :type log_level: int</span>
</span><span id="configure_master_logger-86"><a href="#configure_master_logger-86"><span class="linenos">86</span></a><span class="sd">    :param disabled: If True, the logger will be disabled. Defaults to False.</span>
</span><span id="configure_master_logger-87"><a href="#configure_master_logger-87"><span class="linenos">87</span></a><span class="sd">    :type disabled: bool</span>
</span><span id="configure_master_logger-88"><a href="#configure_master_logger-88"><span class="linenos">88</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="configure_master_logger-89"><a href="#configure_master_logger-89"><span class="linenos">89</span></a>
</span><span id="configure_master_logger-90"><a href="#configure_master_logger-90"><span class="linenos">90</span></a>    <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="configure_master_logger-91"><a href="#configure_master_logger-91"><span class="linenos">91</span></a>    <span class="n">root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>
</span><span id="configure_master_logger-92"><a href="#configure_master_logger-92"><span class="linenos">92</span></a>
</span><span id="configure_master_logger-93"><a href="#configure_master_logger-93"><span class="linenos">93</span></a>    <span class="c1"># Remove all existing handlers</span>
</span><span id="configure_master_logger-94"><a href="#configure_master_logger-94"><span class="linenos">94</span></a>    <span class="c1"># root_logger.handlers.clear()</span>
</span><span id="configure_master_logger-95"><a href="#configure_master_logger-95"><span class="linenos">95</span></a>    <span class="n">root_logger</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">disabled</span>
</span></pre></div>


            <div class="docstring"><p>Configures the root logger with the specified settings.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>log_level</strong>:  The logging level to set. Defaults to logging.ERROR.</li>
<li><strong>disabled</strong>:  If True, the logger will be disabled. Defaults to False.</li>
</ul>
</div>


                </section>
                <section id="disable_stream_handlers_for_namespace">
                            <input id="disable_stream_handlers_for_namespace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_stream_handlers_for_namespace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="disable_stream_handlers_for_namespace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#disable_stream_handlers_for_namespace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="disable_stream_handlers_for_namespace-57"><a href="#disable_stream_handlers_for_namespace-57"><span class="linenos">57</span></a><span class="k">def</span><span class="w"> </span><span class="nf">disable_stream_handlers_for_namespace</span><span class="p">(</span><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="disable_stream_handlers_for_namespace-58"><a href="#disable_stream_handlers_for_namespace-58"><span class="linenos">58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="disable_stream_handlers_for_namespace-59"><a href="#disable_stream_handlers_for_namespace-59"><span class="linenos">59</span></a><span class="sd">    Disables all stream handlers for all loggers under the specified namespace.</span>
</span><span id="disable_stream_handlers_for_namespace-60"><a href="#disable_stream_handlers_for_namespace-60"><span class="linenos">60</span></a>
</span><span id="disable_stream_handlers_for_namespace-61"><a href="#disable_stream_handlers_for_namespace-61"><span class="linenos">61</span></a><span class="sd">    :param namespace: The namespace whose stream handlers should be disabled.</span>
</span><span id="disable_stream_handlers_for_namespace-62"><a href="#disable_stream_handlers_for_namespace-62"><span class="linenos">62</span></a><span class="sd">    :type namespace: str</span>
</span><span id="disable_stream_handlers_for_namespace-63"><a href="#disable_stream_handlers_for_namespace-63"><span class="linenos">63</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="disable_stream_handlers_for_namespace-64"><a href="#disable_stream_handlers_for_namespace-64"><span class="linenos">64</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
</span><span id="disable_stream_handlers_for_namespace-65"><a href="#disable_stream_handlers_for_namespace-65"><span class="linenos">65</span></a>    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
</span><span id="disable_stream_handlers_for_namespace-66"><a href="#disable_stream_handlers_for_namespace-66"><span class="linenos">66</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">):</span>
</span><span id="disable_stream_handlers_for_namespace-67"><a href="#disable_stream_handlers_for_namespace-67"><span class="linenos">67</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</span><span id="disable_stream_handlers_for_namespace-68"><a href="#disable_stream_handlers_for_namespace-68"><span class="linenos">68</span></a>
</span><span id="disable_stream_handlers_for_namespace-69"><a href="#disable_stream_handlers_for_namespace-69"><span class="linenos">69</span></a>    <span class="k">for</span> <span class="n">logger_name</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loggerDict</span><span class="p">:</span>
</span><span id="disable_stream_handlers_for_namespace-70"><a href="#disable_stream_handlers_for_namespace-70"><span class="linenos">70</span></a>        <span class="k">if</span> <span class="n">logger_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">namespace</span><span class="p">):</span>
</span><span id="disable_stream_handlers_for_namespace-71"><a href="#disable_stream_handlers_for_namespace-71"><span class="linenos">71</span></a>            <span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="disable_stream_handlers_for_namespace-72"><a href="#disable_stream_handlers_for_namespace-72"><span class="linenos">72</span></a>            <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
</span><span id="disable_stream_handlers_for_namespace-73"><a href="#disable_stream_handlers_for_namespace-73"><span class="linenos">73</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">):</span>
</span><span id="disable_stream_handlers_for_namespace-74"><a href="#disable_stream_handlers_for_namespace-74"><span class="linenos">74</span></a>                    <span class="n">_logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Disables all stream handlers for all loggers under the specified namespace.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>namespace</strong>:  The namespace whose stream handlers should be disabled.</li>
</ul>
</div>


                </section>
                <section id="list_all_loggers">
                            <input id="list_all_loggers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_all_loggers</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="list_all_loggers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#list_all_loggers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="list_all_loggers-286"><a href="#list_all_loggers-286"><span class="linenos">286</span></a><span class="k">def</span><span class="w"> </span><span class="nf">list_all_loggers</span><span class="p">():</span>
</span><span id="list_all_loggers-287"><a href="#list_all_loggers-287"><span class="linenos">287</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="list_all_loggers-288"><a href="#list_all_loggers-288"><span class="linenos">288</span></a><span class="sd">    Lists all loggers that have been created in the application.</span>
</span><span id="list_all_loggers-289"><a href="#list_all_loggers-289"><span class="linenos">289</span></a>
</span><span id="list_all_loggers-290"><a href="#list_all_loggers-290"><span class="linenos">290</span></a><span class="sd">    :return: List of logger names.</span>
</span><span id="list_all_loggers-291"><a href="#list_all_loggers-291"><span class="linenos">291</span></a><span class="sd">    :rtype: list</span>
</span><span id="list_all_loggers-292"><a href="#list_all_loggers-292"><span class="linenos">292</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="list_all_loggers-293"><a href="#list_all_loggers-293"><span class="linenos">293</span></a>    <span class="n">logger_dict</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loggerDict</span>
</span><span id="list_all_loggers-294"><a href="#list_all_loggers-294"><span class="linenos">294</span></a>    <span class="n">loggers</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="list_all_loggers-295"><a href="#list_all_loggers-295"><span class="linenos">295</span></a>        <span class="n">name</span>
</span><span id="list_all_loggers-296"><a href="#list_all_loggers-296"><span class="linenos">296</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">logger</span> <span class="ow">in</span> <span class="n">logger_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="list_all_loggers-297"><a href="#list_all_loggers-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">)</span>
</span><span id="list_all_loggers-298"><a href="#list_all_loggers-298"><span class="linenos">298</span></a>    <span class="p">]</span>
</span><span id="list_all_loggers-299"><a href="#list_all_loggers-299"><span class="linenos">299</span></a>    <span class="k">return</span> <span class="n">loggers</span>
</span></pre></div>


            <div class="docstring"><p>Lists all loggers that have been created in the application.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>List of logger names.</p>
</blockquote>
</div>


                </section>
                <section id="list_handlers">
                            <input id="list_handlers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_handlers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="list_handlers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#list_handlers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="list_handlers-302"><a href="#list_handlers-302"><span class="linenos">302</span></a><span class="k">def</span><span class="w"> </span><span class="nf">list_handlers</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="list_handlers-303"><a href="#list_handlers-303"><span class="linenos">303</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="list_handlers-304"><a href="#list_handlers-304"><span class="linenos">304</span></a><span class="sd">    Lists the handlers for the logger with the specified name.</span>
</span><span id="list_handlers-305"><a href="#list_handlers-305"><span class="linenos">305</span></a>
</span><span id="list_handlers-306"><a href="#list_handlers-306"><span class="linenos">306</span></a><span class="sd">    :param name: The name of the logger.</span>
</span><span id="list_handlers-307"><a href="#list_handlers-307"><span class="linenos">307</span></a><span class="sd">    :type name: str</span>
</span><span id="list_handlers-308"><a href="#list_handlers-308"><span class="linenos">308</span></a><span class="sd">    :return: List of handler types and their configurations.</span>
</span><span id="list_handlers-309"><a href="#list_handlers-309"><span class="linenos">309</span></a><span class="sd">    :rtype: list</span>
</span><span id="list_handlers-310"><a href="#list_handlers-310"><span class="linenos">310</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="list_handlers-311"><a href="#list_handlers-311"><span class="linenos">311</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="list_handlers-312"><a href="#list_handlers-312"><span class="linenos">312</span></a>    <span class="n">handlers_info</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="list_handlers-313"><a href="#list_handlers-313"><span class="linenos">313</span></a>
</span><span id="list_handlers-314"><a href="#list_handlers-314"><span class="linenos">314</span></a>    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
</span><span id="list_handlers-315"><a href="#list_handlers-315"><span class="linenos">315</span></a>        <span class="n">handler_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="list_handlers-316"><a href="#list_handlers-316"><span class="linenos">316</span></a>        <span class="n">handler_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="list_handlers-317"><a href="#list_handlers-317"><span class="linenos">317</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">handler_type</span><span class="p">,</span>
</span><span id="list_handlers-318"><a href="#list_handlers-318"><span class="linenos">318</span></a>            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLevelName</span><span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">level</span><span class="p">),</span>
</span><span id="list_handlers-319"><a href="#list_handlers-319"><span class="linenos">319</span></a>            <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="n">handler</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_fmt</span> <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">formatter</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="list_handlers-320"><a href="#list_handlers-320"><span class="linenos">320</span></a>        <span class="p">}</span>
</span><span id="list_handlers-321"><a href="#list_handlers-321"><span class="linenos">321</span></a>        <span class="n">handlers_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handler_info</span><span class="p">)</span>
</span><span id="list_handlers-322"><a href="#list_handlers-322"><span class="linenos">322</span></a>
</span><span id="list_handlers-323"><a href="#list_handlers-323"><span class="linenos">323</span></a>    <span class="k">return</span> <span class="n">handlers_info</span>
</span></pre></div>


            <div class="docstring"><p>Lists the handlers for the logger with the specified name.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>name</strong>:  The name of the logger.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>List of handler types and their configurations.</p>
</blockquote>
</div>


                </section>
                <section id="set_logger_level">
                            <input id="set_logger_level-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_logger_level</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">level</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="set_logger_level-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#set_logger_level"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="set_logger_level-225"><a href="#set_logger_level-225"><span class="linenos">225</span></a><span class="k">def</span><span class="w"> </span><span class="nf">set_logger_level</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
</span><span id="set_logger_level-226"><a href="#set_logger_level-226"><span class="linenos">226</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="set_logger_level-227"><a href="#set_logger_level-227"><span class="linenos">227</span></a><span class="sd">    Sets the logging level for the logger with the specified name.</span>
</span><span id="set_logger_level-228"><a href="#set_logger_level-228"><span class="linenos">228</span></a>
</span><span id="set_logger_level-229"><a href="#set_logger_level-229"><span class="linenos">229</span></a><span class="sd">    :param name: The name of the logger.</span>
</span><span id="set_logger_level-230"><a href="#set_logger_level-230"><span class="linenos">230</span></a><span class="sd">    :type name: str</span>
</span><span id="set_logger_level-231"><a href="#set_logger_level-231"><span class="linenos">231</span></a><span class="sd">    :param level: The logging level to set. Must be one of [&quot;WARNING&quot;, &quot;ERROR&quot;, &quot;INFO&quot;, &quot;DEBUG&quot;].</span>
</span><span id="set_logger_level-232"><a href="#set_logger_level-232"><span class="linenos">232</span></a><span class="sd">    :type level: str</span>
</span><span id="set_logger_level-233"><a href="#set_logger_level-233"><span class="linenos">233</span></a><span class="sd">    :raises ValueError: If the provided level is not one of the allowed values.</span>
</span><span id="set_logger_level-234"><a href="#set_logger_level-234"><span class="linenos">234</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="set_logger_level-235"><a href="#set_logger_level-235"><span class="linenos">235</span></a>    <span class="n">level_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="set_logger_level-236"><a href="#set_logger_level-236"><span class="linenos">236</span></a>        <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
</span><span id="set_logger_level-237"><a href="#set_logger_level-237"><span class="linenos">237</span></a>        <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
</span><span id="set_logger_level-238"><a href="#set_logger_level-238"><span class="linenos">238</span></a>        <span class="s2">&quot;INFO&quot;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span id="set_logger_level-239"><a href="#set_logger_level-239"><span class="linenos">239</span></a>        <span class="s2">&quot;DEBUG&quot;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
</span><span id="set_logger_level-240"><a href="#set_logger_level-240"><span class="linenos">240</span></a>    <span class="p">}</span>
</span><span id="set_logger_level-241"><a href="#set_logger_level-241"><span class="linenos">241</span></a>
</span><span id="set_logger_level-242"><a href="#set_logger_level-242"><span class="linenos">242</span></a>    <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">level_dict</span><span class="p">:</span>
</span><span id="set_logger_level-243"><a href="#set_logger_level-243"><span class="linenos">243</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="set_logger_level-244"><a href="#set_logger_level-244"><span class="linenos">244</span></a>            <span class="sa">f</span><span class="s2">&quot;set_logger_level(): Invalid logging level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="set_logger_level-245"><a href="#set_logger_level-245"><span class="linenos">245</span></a>            <span class="s2">&quot;Must be one of [&#39;WARNING&#39;, &#39;ERROR&#39;, &#39;INFO&#39;, &#39;DEBUG&#39;]&quot;</span>
</span><span id="set_logger_level-246"><a href="#set_logger_level-246"><span class="linenos">246</span></a>        <span class="p">)</span>
</span><span id="set_logger_level-247"><a href="#set_logger_level-247"><span class="linenos">247</span></a>
</span><span id="set_logger_level-248"><a href="#set_logger_level-248"><span class="linenos">248</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="set_logger_level-249"><a href="#set_logger_level-249"><span class="linenos">249</span></a>    <span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level_dict</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
</span><span id="set_logger_level-250"><a href="#set_logger_level-250"><span class="linenos">250</span></a>
</span><span id="set_logger_level-251"><a href="#set_logger_level-251"><span class="linenos">251</span></a>    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
</span><span id="set_logger_level-252"><a href="#set_logger_level-252"><span class="linenos">252</span></a>        <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level_dict</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Sets the logging level for the logger with the specified name.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>name</strong>:  The name of the logger.</li>
<li><strong>level</strong>:  The logging level to set. Must be one of ["WARNING", "ERROR", "INFO", "DEBUG"].</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>:  If the provided level is not one of the allowed values.</li>
</ul>
</div>


                </section>
                <section id="set_logger_level_for_module">
                            <input id="set_logger_level_for_module-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_logger_level_for_module</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pkg_name</span>, </span><span class="param"><span class="n">level</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="set_logger_level_for_module-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#set_logger_level_for_module"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="set_logger_level_for_module-326"><a href="#set_logger_level_for_module-326"><span class="linenos">326</span></a><span class="k">def</span><span class="w"> </span><span class="nf">set_logger_level_for_module</span><span class="p">(</span><span class="n">pkg_name</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="set_logger_level_for_module-327"><a href="#set_logger_level_for_module-327"><span class="linenos">327</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="set_logger_level_for_module-328"><a href="#set_logger_level_for_module-328"><span class="linenos">328</span></a><span class="sd">    Set the logging level for all loggers within a specified package.</span>
</span><span id="set_logger_level_for_module-329"><a href="#set_logger_level_for_module-329"><span class="linenos">329</span></a>
</span><span id="set_logger_level_for_module-330"><a href="#set_logger_level_for_module-330"><span class="linenos">330</span></a><span class="sd">    This function iterates through all registered loggers and sets the logging</span>
</span><span id="set_logger_level_for_module-331"><a href="#set_logger_level_for_module-331"><span class="linenos">331</span></a><span class="sd">    level for those that belong to the specified package.</span>
</span><span id="set_logger_level_for_module-332"><a href="#set_logger_level_for_module-332"><span class="linenos">332</span></a>
</span><span id="set_logger_level_for_module-333"><a href="#set_logger_level_for_module-333"><span class="linenos">333</span></a><span class="sd">    :param pkg_name: The name of the package for which to set the logging level.</span>
</span><span id="set_logger_level_for_module-334"><a href="#set_logger_level_for_module-334"><span class="linenos">334</span></a><span class="sd">    :type pkg_name: str</span>
</span><span id="set_logger_level_for_module-335"><a href="#set_logger_level_for_module-335"><span class="linenos">335</span></a><span class="sd">    :param level: The logging level to set (e.g., &#39;DEBUG&#39;, &#39;INFO&#39;, &#39;WARNING&#39;, &#39;ERROR&#39;, &#39;CRITICAL&#39;).</span>
</span><span id="set_logger_level_for_module-336"><a href="#set_logger_level_for_module-336"><span class="linenos">336</span></a><span class="sd">                  If not specified, the logging level will not be changed.</span>
</span><span id="set_logger_level_for_module-337"><a href="#set_logger_level_for_module-337"><span class="linenos">337</span></a><span class="sd">    :type level: str, optional</span>
</span><span id="set_logger_level_for_module-338"><a href="#set_logger_level_for_module-338"><span class="linenos">338</span></a><span class="sd">    :return: A list of logger names that were found and had their levels set.</span>
</span><span id="set_logger_level_for_module-339"><a href="#set_logger_level_for_module-339"><span class="linenos">339</span></a><span class="sd">    :rtype: list</span>
</span><span id="set_logger_level_for_module-340"><a href="#set_logger_level_for_module-340"><span class="linenos">340</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="set_logger_level_for_module-341"><a href="#set_logger_level_for_module-341"><span class="linenos">341</span></a>    <span class="n">logger_dict</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loggerDict</span>
</span><span id="set_logger_level_for_module-342"><a href="#set_logger_level_for_module-342"><span class="linenos">342</span></a>    <span class="n">registered_loggers</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="set_logger_level_for_module-343"><a href="#set_logger_level_for_module-343"><span class="linenos">343</span></a>        <span class="n">name</span>
</span><span id="set_logger_level_for_module-344"><a href="#set_logger_level_for_module-344"><span class="linenos">344</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">logger</span> <span class="ow">in</span> <span class="n">logger_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="set_logger_level_for_module-345"><a href="#set_logger_level_for_module-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">pkg_name</span><span class="p">)</span>
</span><span id="set_logger_level_for_module-346"><a href="#set_logger_level_for_module-346"><span class="linenos">346</span></a>    <span class="p">]</span>
</span><span id="set_logger_level_for_module-347"><a href="#set_logger_level_for_module-347"><span class="linenos">347</span></a>    <span class="k">for</span> <span class="n">logger_name</span> <span class="ow">in</span> <span class="n">registered_loggers</span><span class="p">:</span>
</span><span id="set_logger_level_for_module-348"><a href="#set_logger_level_for_module-348"><span class="linenos">348</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="set_logger_level_for_module-349"><a href="#set_logger_level_for_module-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="n">level</span><span class="p">:</span>
</span><span id="set_logger_level_for_module-350"><a href="#set_logger_level_for_module-350"><span class="linenos">350</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="set_logger_level_for_module-351"><a href="#set_logger_level_for_module-351"><span class="linenos">351</span></a>
</span><span id="set_logger_level_for_module-352"><a href="#set_logger_level_for_module-352"><span class="linenos">352</span></a>    <span class="k">return</span> <span class="n">registered_loggers</span>
</span></pre></div>


            <div class="docstring"><p>Set the logging level for all loggers within a specified package.</p>

<p>This function iterates through all registered loggers and sets the logging
level for those that belong to the specified package.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>pkg_name</strong>:  The name of the package for which to set the logging level.</li>
<li><strong>level</strong>:  The logging level to set (e.g., 'DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL').
If not specified, the logging level will not be changed.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A list of logger names that were found and had their levels set.</p>
</blockquote>
</div>


                </section>
                <section id="set_logging_level_for_all_handlers">
                            <input id="set_logging_level_for_all_handlers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_logging_level_for_all_handlers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">log_level</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="set_logging_level_for_all_handlers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#set_logging_level_for_all_handlers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="set_logging_level_for_all_handlers-40"><a href="#set_logging_level_for_all_handlers-40"><span class="linenos">40</span></a><span class="k">def</span><span class="w"> </span><span class="nf">set_logging_level_for_all_handlers</span><span class="p">(</span><span class="n">log_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="set_logging_level_for_all_handlers-41"><a href="#set_logging_level_for_all_handlers-41"><span class="linenos">41</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="set_logging_level_for_all_handlers-42"><a href="#set_logging_level_for_all_handlers-42"><span class="linenos">42</span></a><span class="sd">    Sets the logging level for all handlers of all loggers in the proteusPy package.</span>
</span><span id="set_logging_level_for_all_handlers-43"><a href="#set_logging_level_for_all_handlers-43"><span class="linenos">43</span></a>
</span><span id="set_logging_level_for_all_handlers-44"><a href="#set_logging_level_for_all_handlers-44"><span class="linenos">44</span></a><span class="sd">    :param log_level: The logging level to set.</span>
</span><span id="set_logging_level_for_all_handlers-45"><a href="#set_logging_level_for_all_handlers-45"><span class="linenos">45</span></a><span class="sd">    :type log_level: int</span>
</span><span id="set_logging_level_for_all_handlers-46"><a href="#set_logging_level_for_all_handlers-46"><span class="linenos">46</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="set_logging_level_for_all_handlers-47"><a href="#set_logging_level_for_all_handlers-47"><span class="linenos">47</span></a>    <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="set_logging_level_for_all_handlers-48"><a href="#set_logging_level_for_all_handlers-48"><span class="linenos">48</span></a>    <span class="n">root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>
</span><span id="set_logging_level_for_all_handlers-49"><a href="#set_logging_level_for_all_handlers-49"><span class="linenos">49</span></a>
</span><span id="set_logging_level_for_all_handlers-50"><a href="#set_logging_level_for_all_handlers-50"><span class="linenos">50</span></a>    <span class="k">for</span> <span class="n">logger_name</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loggerDict</span><span class="p">:</span>
</span><span id="set_logging_level_for_all_handlers-51"><a href="#set_logging_level_for_all_handlers-51"><span class="linenos">51</span></a>        <span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="set_logging_level_for_all_handlers-52"><a href="#set_logging_level_for_all_handlers-52"><span class="linenos">52</span></a>        <span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>
</span><span id="set_logging_level_for_all_handlers-53"><a href="#set_logging_level_for_all_handlers-53"><span class="linenos">53</span></a>        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
</span><span id="set_logging_level_for_all_handlers-54"><a href="#set_logging_level_for_all_handlers-54"><span class="linenos">54</span></a>            <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets the logging level for all handlers of all loggers in the proteusPy package.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>log_level</strong>:  The logging level to set.</li>
</ul>
</div>


                </section>
                <section id="setup_agno_rich_logging">
                            <input id="setup_agno_rich_logging-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup_agno_rich_logging</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="setup_agno_rich_logging-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#setup_agno_rich_logging"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="setup_agno_rich_logging-355"><a href="#setup_agno_rich_logging-355"><span class="linenos">355</span></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_agno_rich_logging</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">LOG_LEVEL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="setup_agno_rich_logging-356"><a href="#setup_agno_rich_logging-356"><span class="linenos">356</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="setup_agno_rich_logging-357"><a href="#setup_agno_rich_logging-357"><span class="linenos">357</span></a><span class="sd">    Configure agno framework loggers to use Rich handlers.</span>
</span><span id="setup_agno_rich_logging-358"><a href="#setup_agno_rich_logging-358"><span class="linenos">358</span></a>
</span><span id="setup_agno_rich_logging-359"><a href="#setup_agno_rich_logging-359"><span class="linenos">359</span></a><span class="sd">    This function applies Rich logging configuration to all agno-related loggers</span>
</span><span id="setup_agno_rich_logging-360"><a href="#setup_agno_rich_logging-360"><span class="linenos">360</span></a><span class="sd">    to ensure consistent formatting and styling throughout the application.</span>
</span><span id="setup_agno_rich_logging-361"><a href="#setup_agno_rich_logging-361"><span class="linenos">361</span></a>
</span><span id="setup_agno_rich_logging-362"><a href="#setup_agno_rich_logging-362"><span class="linenos">362</span></a><span class="sd">    :param level: The logging level to set for agno loggers</span>
</span><span id="setup_agno_rich_logging-363"><a href="#setup_agno_rich_logging-363"><span class="linenos">363</span></a><span class="sd">    :type level: int</span>
</span><span id="setup_agno_rich_logging-364"><a href="#setup_agno_rich_logging-364"><span class="linenos">364</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="setup_agno_rich_logging-365"><a href="#setup_agno_rich_logging-365"><span class="linenos">365</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">rich.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">RichHandler</span>
</span><span id="setup_agno_rich_logging-366"><a href="#setup_agno_rich_logging-366"><span class="linenos">366</span></a>
</span><span id="setup_agno_rich_logging-367"><a href="#setup_agno_rich_logging-367"><span class="linenos">367</span></a>    <span class="c1"># List of agno-related logger namespaces</span>
</span><span id="setup_agno_rich_logging-368"><a href="#setup_agno_rich_logging-368"><span class="linenos">368</span></a>    <span class="n">agno_namespaces</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="setup_agno_rich_logging-369"><a href="#setup_agno_rich_logging-369"><span class="linenos">369</span></a>        <span class="s2">&quot;agno&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-370"><a href="#setup_agno_rich_logging-370"><span class="linenos">370</span></a>        <span class="s2">&quot;agno.agent&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-371"><a href="#setup_agno_rich_logging-371"><span class="linenos">371</span></a>        <span class="s2">&quot;agno.models&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-372"><a href="#setup_agno_rich_logging-372"><span class="linenos">372</span></a>        <span class="s2">&quot;agno.tools&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-373"><a href="#setup_agno_rich_logging-373"><span class="linenos">373</span></a>        <span class="s2">&quot;agno.knowledge&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-374"><a href="#setup_agno_rich_logging-374"><span class="linenos">374</span></a>        <span class="s2">&quot;agno.memory&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-375"><a href="#setup_agno_rich_logging-375"><span class="linenos">375</span></a>        <span class="s2">&quot;agno.storage&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-376"><a href="#setup_agno_rich_logging-376"><span class="linenos">376</span></a>        <span class="s2">&quot;agno.vectordb&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-377"><a href="#setup_agno_rich_logging-377"><span class="linenos">377</span></a>        <span class="s2">&quot;agno.embedder&quot;</span><span class="p">,</span>
</span><span id="setup_agno_rich_logging-378"><a href="#setup_agno_rich_logging-378"><span class="linenos">378</span></a>    <span class="p">]</span>
</span><span id="setup_agno_rich_logging-379"><a href="#setup_agno_rich_logging-379"><span class="linenos">379</span></a>
</span><span id="setup_agno_rich_logging-380"><a href="#setup_agno_rich_logging-380"><span class="linenos">380</span></a>    <span class="c1"># Rich formatter for agno logs</span>
</span><span id="setup_agno_rich_logging-381"><a href="#setup_agno_rich_logging-381"><span class="linenos">381</span></a>    <span class="n">rich_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
</span><span id="setup_agno_rich_logging-382"><a href="#setup_agno_rich_logging-382"><span class="linenos">382</span></a>        <span class="s2">&quot;PersonalAgent: </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(name)s</span><span class="s2">.</span><span class="si">%(funcName)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
</span><span id="setup_agno_rich_logging-383"><a href="#setup_agno_rich_logging-383"><span class="linenos">383</span></a>    <span class="p">)</span>
</span><span id="setup_agno_rich_logging-384"><a href="#setup_agno_rich_logging-384"><span class="linenos">384</span></a>
</span><span id="setup_agno_rich_logging-385"><a href="#setup_agno_rich_logging-385"><span class="linenos">385</span></a>    <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">agno_namespaces</span><span class="p">:</span>
</span><span id="setup_agno_rich_logging-386"><a href="#setup_agno_rich_logging-386"><span class="linenos">386</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-387"><a href="#setup_agno_rich_logging-387"><span class="linenos">387</span></a>
</span><span id="setup_agno_rich_logging-388"><a href="#setup_agno_rich_logging-388"><span class="linenos">388</span></a>        <span class="c1"># Clear existing handlers to avoid duplicates</span>
</span><span id="setup_agno_rich_logging-389"><a href="#setup_agno_rich_logging-389"><span class="linenos">389</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="setup_agno_rich_logging-390"><a href="#setup_agno_rich_logging-390"><span class="linenos">390</span></a>
</span><span id="setup_agno_rich_logging-391"><a href="#setup_agno_rich_logging-391"><span class="linenos">391</span></a>        <span class="c1"># Add Rich handler</span>
</span><span id="setup_agno_rich_logging-392"><a href="#setup_agno_rich_logging-392"><span class="linenos">392</span></a>        <span class="n">rich_handler</span> <span class="o">=</span> <span class="n">RichHandler</span><span class="p">(</span><span class="n">rich_tracebacks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-393"><a href="#setup_agno_rich_logging-393"><span class="linenos">393</span></a>        <span class="n">rich_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-394"><a href="#setup_agno_rich_logging-394"><span class="linenos">394</span></a>        <span class="n">rich_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">rich_formatter</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-395"><a href="#setup_agno_rich_logging-395"><span class="linenos">395</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">rich_handler</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-396"><a href="#setup_agno_rich_logging-396"><span class="linenos">396</span></a>
</span><span id="setup_agno_rich_logging-397"><a href="#setup_agno_rich_logging-397"><span class="linenos">397</span></a>        <span class="c1"># Set logger level</span>
</span><span id="setup_agno_rich_logging-398"><a href="#setup_agno_rich_logging-398"><span class="linenos">398</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-399"><a href="#setup_agno_rich_logging-399"><span class="linenos">399</span></a>
</span><span id="setup_agno_rich_logging-400"><a href="#setup_agno_rich_logging-400"><span class="linenos">400</span></a>        <span class="c1"># Prevent propagation to avoid duplicate logs</span>
</span><span id="setup_agno_rich_logging-401"><a href="#setup_agno_rich_logging-401"><span class="linenos">401</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="setup_agno_rich_logging-402"><a href="#setup_agno_rich_logging-402"><span class="linenos">402</span></a>
</span><span id="setup_agno_rich_logging-403"><a href="#setup_agno_rich_logging-403"><span class="linenos">403</span></a>    <span class="c1"># Also configure the root agno logger</span>
</span><span id="setup_agno_rich_logging-404"><a href="#setup_agno_rich_logging-404"><span class="linenos">404</span></a>    <span class="n">agno_root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;agno&quot;</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-405"><a href="#setup_agno_rich_logging-405"><span class="linenos">405</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">agno_root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
</span><span id="setup_agno_rich_logging-406"><a href="#setup_agno_rich_logging-406"><span class="linenos">406</span></a>        <span class="n">rich_handler</span> <span class="o">=</span> <span class="n">RichHandler</span><span class="p">(</span><span class="n">rich_tracebacks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-407"><a href="#setup_agno_rich_logging-407"><span class="linenos">407</span></a>        <span class="n">rich_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-408"><a href="#setup_agno_rich_logging-408"><span class="linenos">408</span></a>        <span class="n">rich_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">rich_formatter</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-409"><a href="#setup_agno_rich_logging-409"><span class="linenos">409</span></a>        <span class="n">agno_root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">rich_handler</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-410"><a href="#setup_agno_rich_logging-410"><span class="linenos">410</span></a>        <span class="n">agno_root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="setup_agno_rich_logging-411"><a href="#setup_agno_rich_logging-411"><span class="linenos">411</span></a>        <span class="n">agno_root_logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Configure agno framework loggers to use Rich handlers.</p>

<p>This function applies Rich logging configuration to all agno-related loggers
to ensure consistent formatting and styling throughout the application.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>level</strong>:  The logging level to set for agno loggers</li>
</ul>
</div>


                </section>
                <section id="setup_logging">
                            <input id="setup_logging-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup_logging</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;personal_agent.utils.pag_logging&#39;</span>,</span><span class="param">	<span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>,</span><span class="param">	<span class="n">propagate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span>:</span></span>

                <label class="view-source-button" for="setup_logging-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#setup_logging"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="setup_logging-182"><a href="#setup_logging-182"><span class="linenos">182</span></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">(</span>
</span><span id="setup_logging-183"><a href="#setup_logging-183"><span class="linenos">183</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="vm">__name__</span><span class="p">,</span>
</span><span id="setup_logging-184"><a href="#setup_logging-184"><span class="linenos">184</span></a>    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">LOG_LEVEL</span><span class="p">,</span>
</span><span id="setup_logging-185"><a href="#setup_logging-185"><span class="linenos">185</span></a>    <span class="n">propagate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Default to False to avoid duplicates</span>
</span><span id="setup_logging-186"><a href="#setup_logging-186"><span class="linenos">186</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
</span><span id="setup_logging-187"><a href="#setup_logging-187"><span class="linenos">187</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="setup_logging-188"><a href="#setup_logging-188"><span class="linenos">188</span></a><span class="sd">    Returns a logger with the specified name, configured to use a RichHandler for console output.</span>
</span><span id="setup_logging-189"><a href="#setup_logging-189"><span class="linenos">189</span></a>
</span><span id="setup_logging-190"><a href="#setup_logging-190"><span class="linenos">190</span></a><span class="sd">    :param name: The name of the logger.</span>
</span><span id="setup_logging-191"><a href="#setup_logging-191"><span class="linenos">191</span></a><span class="sd">    :type name: str</span>
</span><span id="setup_logging-192"><a href="#setup_logging-192"><span class="linenos">192</span></a><span class="sd">    :param level: The logging level, defaults to LOG_LEVEL from config</span>
</span><span id="setup_logging-193"><a href="#setup_logging-193"><span class="linenos">193</span></a><span class="sd">    :type level: int</span>
</span><span id="setup_logging-194"><a href="#setup_logging-194"><span class="linenos">194</span></a><span class="sd">    :param propagate: Whether to propagate messages to parent loggers, defaults to False</span>
</span><span id="setup_logging-195"><a href="#setup_logging-195"><span class="linenos">195</span></a><span class="sd">    :type propagate: bool</span>
</span><span id="setup_logging-196"><a href="#setup_logging-196"><span class="linenos">196</span></a><span class="sd">    :return: Configured logger instance.</span>
</span><span id="setup_logging-197"><a href="#setup_logging-197"><span class="linenos">197</span></a><span class="sd">    :rtype: logging.Logger</span>
</span><span id="setup_logging-198"><a href="#setup_logging-198"><span class="linenos">198</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="setup_logging-199"><a href="#setup_logging-199"><span class="linenos">199</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="setup_logging-200"><a href="#setup_logging-200"><span class="linenos">200</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="setup_logging-201"><a href="#setup_logging-201"><span class="linenos">201</span></a>    <span class="n">rust_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;rust&quot;</span><span class="p">)</span>
</span><span id="setup_logging-202"><a href="#setup_logging-202"><span class="linenos">202</span></a>    <span class="n">rust_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</span><span id="setup_logging-203"><a href="#setup_logging-203"><span class="linenos">203</span></a>    <span class="c1"># Suppress warnings from the Rust library</span>
</span><span id="setup_logging-204"><a href="#setup_logging-204"><span class="linenos">204</span></a>    <span class="k">if</span> <span class="s2">&quot;RUST_LOG&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="setup_logging-205"><a href="#setup_logging-205"><span class="linenos">205</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;RUST_LOG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span>
</span><span id="setup_logging-206"><a href="#setup_logging-206"><span class="linenos">206</span></a>
</span><span id="setup_logging-207"><a href="#setup_logging-207"><span class="linenos">207</span></a>    <span class="c1"># Clear existing handlers</span>
</span><span id="setup_logging-208"><a href="#setup_logging-208"><span class="linenos">208</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="setup_logging-209"><a href="#setup_logging-209"><span class="linenos">209</span></a>
</span><span id="setup_logging-210"><a href="#setup_logging-210"><span class="linenos">210</span></a>    <span class="c1"># Add RichHandler for console output</span>
</span><span id="setup_logging-211"><a href="#setup_logging-211"><span class="linenos">211</span></a>    <span class="n">rich_handler</span> <span class="o">=</span> <span class="n">RichHandler</span><span class="p">(</span><span class="n">rich_tracebacks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="setup_logging-212"><a href="#setup_logging-212"><span class="linenos">212</span></a>    <span class="n">rich_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
</span><span id="setup_logging-213"><a href="#setup_logging-213"><span class="linenos">213</span></a>        <span class="s2">&quot;PersonalAgent: </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(name)s</span><span class="s2">.</span><span class="si">%(funcName)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
</span><span id="setup_logging-214"><a href="#setup_logging-214"><span class="linenos">214</span></a>    <span class="p">)</span>
</span><span id="setup_logging-215"><a href="#setup_logging-215"><span class="linenos">215</span></a>    <span class="n">rich_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="setup_logging-216"><a href="#setup_logging-216"><span class="linenos">216</span></a>    <span class="n">rich_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">rich_formatter</span><span class="p">)</span>
</span><span id="setup_logging-217"><a href="#setup_logging-217"><span class="linenos">217</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">rich_handler</span><span class="p">)</span>
</span><span id="setup_logging-218"><a href="#setup_logging-218"><span class="linenos">218</span></a>
</span><span id="setup_logging-219"><a href="#setup_logging-219"><span class="linenos">219</span></a>    <span class="c1"># Set propagation</span>
</span><span id="setup_logging-220"><a href="#setup_logging-220"><span class="linenos">220</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="n">propagate</span>
</span><span id="setup_logging-221"><a href="#setup_logging-221"><span class="linenos">221</span></a>
</span><span id="setup_logging-222"><a href="#setup_logging-222"><span class="linenos">222</span></a>    <span class="k">return</span> <span class="n">logger</span>
</span></pre></div>


            <div class="docstring"><p>Returns a logger with the specified name, configured to use a RichHandler for console output.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>name</strong>:  The name of the logger.</li>
<li><strong>level</strong>:  The logging level, defaults to LOG_LEVEL from config</li>
<li><strong>propagate</strong>:  Whether to propagate messages to parent loggers, defaults to False</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Configured logger instance.</p>
</blockquote>
</div>


                </section>
                <section id="toggle_stream_handler">
                            <input id="toggle_stream_handler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">toggle_stream_handler</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">enable</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="toggle_stream_handler-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#toggle_stream_handler"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="toggle_stream_handler-255"><a href="#toggle_stream_handler-255"><span class="linenos">255</span></a><span class="k">def</span><span class="w"> </span><span class="nf">toggle_stream_handler</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
</span><span id="toggle_stream_handler-256"><a href="#toggle_stream_handler-256"><span class="linenos">256</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="toggle_stream_handler-257"><a href="#toggle_stream_handler-257"><span class="linenos">257</span></a><span class="sd">    Enables or disables the StreamHandler for the logger with the specified name.</span>
</span><span id="toggle_stream_handler-258"><a href="#toggle_stream_handler-258"><span class="linenos">258</span></a>
</span><span id="toggle_stream_handler-259"><a href="#toggle_stream_handler-259"><span class="linenos">259</span></a><span class="sd">    :param name: The name of the logger.</span>
</span><span id="toggle_stream_handler-260"><a href="#toggle_stream_handler-260"><span class="linenos">260</span></a><span class="sd">    :type name: str</span>
</span><span id="toggle_stream_handler-261"><a href="#toggle_stream_handler-261"><span class="linenos">261</span></a><span class="sd">    :param enable: If True, enables the StreamHandler; if False, disables it.</span>
</span><span id="toggle_stream_handler-262"><a href="#toggle_stream_handler-262"><span class="linenos">262</span></a><span class="sd">    :type enable: bool</span>
</span><span id="toggle_stream_handler-263"><a href="#toggle_stream_handler-263"><span class="linenos">263</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="toggle_stream_handler-264"><a href="#toggle_stream_handler-264"><span class="linenos">264</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="toggle_stream_handler-265"><a href="#toggle_stream_handler-265"><span class="linenos">265</span></a>    <span class="n">stream_handler</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="toggle_stream_handler-266"><a href="#toggle_stream_handler-266"><span class="linenos">266</span></a>
</span><span id="toggle_stream_handler-267"><a href="#toggle_stream_handler-267"><span class="linenos">267</span></a>    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
</span><span id="toggle_stream_handler-268"><a href="#toggle_stream_handler-268"><span class="linenos">268</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">):</span>
</span><span id="toggle_stream_handler-269"><a href="#toggle_stream_handler-269"><span class="linenos">269</span></a>            <span class="n">stream_handler</span> <span class="o">=</span> <span class="n">handler</span>
</span><span id="toggle_stream_handler-270"><a href="#toggle_stream_handler-270"><span class="linenos">270</span></a>            <span class="k">break</span>
</span><span id="toggle_stream_handler-271"><a href="#toggle_stream_handler-271"><span class="linenos">271</span></a>
</span><span id="toggle_stream_handler-272"><a href="#toggle_stream_handler-272"><span class="linenos">272</span></a>    <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
</span><span id="toggle_stream_handler-273"><a href="#toggle_stream_handler-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="n">stream_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="toggle_stream_handler-274"><a href="#toggle_stream_handler-274"><span class="linenos">274</span></a>            <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
</span><span id="toggle_stream_handler-275"><a href="#toggle_stream_handler-275"><span class="linenos">275</span></a>                <span class="s2">&quot;PersonalAgent: </span><span class="si">%(levelname)-7s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(name)s</span><span class="s2">.</span><span class="si">%(funcName)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
</span><span id="toggle_stream_handler-276"><a href="#toggle_stream_handler-276"><span class="linenos">276</span></a>            <span class="p">)</span>
</span><span id="toggle_stream_handler-277"><a href="#toggle_stream_handler-277"><span class="linenos">277</span></a>            <span class="n">stream_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span><span id="toggle_stream_handler-278"><a href="#toggle_stream_handler-278"><span class="linenos">278</span></a>            <span class="n">stream_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
</span><span id="toggle_stream_handler-279"><a href="#toggle_stream_handler-279"><span class="linenos">279</span></a>            <span class="n">stream_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="toggle_stream_handler-280"><a href="#toggle_stream_handler-280"><span class="linenos">280</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">stream_handler</span><span class="p">)</span>
</span><span id="toggle_stream_handler-281"><a href="#toggle_stream_handler-281"><span class="linenos">281</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="toggle_stream_handler-282"><a href="#toggle_stream_handler-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">stream_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="toggle_stream_handler-283"><a href="#toggle_stream_handler-283"><span class="linenos">283</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">stream_handler</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enables or disables the StreamHandler for the logger with the specified name.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>name</strong>:  The name of the logger.</li>
<li><strong>enable</strong>:  If True, enables the StreamHandler; if False, disables it.</li>
</ul>
</div>


                </section>
                <section id="setup_logging_filters">
                            <input id="setup_logging_filters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup_logging_filters</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="setup_logging_filters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#setup_logging_filters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="setup_logging_filters-98"><a href="#setup_logging_filters-98"><span class="linenos"> 98</span></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_logging_filters</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="setup_logging_filters-99"><a href="#setup_logging_filters-99"><span class="linenos"> 99</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up logging configuration with Rich handler and configure agno loggers.&quot;&quot;&quot;</span>
</span><span id="setup_logging_filters-100"><a href="#setup_logging_filters-100"><span class="linenos">100</span></a>    <span class="c1"># Suppress warnings from specific modules (non-spacy/click warnings)</span>
</span><span id="setup_logging_filters-101"><a href="#setup_logging_filters-101"><span class="linenos">101</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ollama&quot;</span><span class="p">)</span>
</span><span id="setup_logging_filters-102"><a href="#setup_logging_filters-102"><span class="linenos">102</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
</span><span id="setup_logging_filters-103"><a href="#setup_logging_filters-103"><span class="linenos">103</span></a>        <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*model_fields.*&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span>
</span><span id="setup_logging_filters-104"><a href="#setup_logging_filters-104"><span class="linenos">104</span></a>    <span class="p">)</span>
</span><span id="setup_logging_filters-105"><a href="#setup_logging_filters-105"><span class="linenos">105</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">ResourceWarning</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*unclosed.*&quot;</span><span class="p">)</span>
</span><span id="setup_logging_filters-106"><a href="#setup_logging_filters-106"><span class="linenos">106</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
</span><span id="setup_logging_filters-107"><a href="#setup_logging_filters-107"><span class="linenos">107</span></a>        <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">ResourceWarning</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*subprocess.*&quot;</span>
</span><span id="setup_logging_filters-108"><a href="#setup_logging_filters-108"><span class="linenos">108</span></a>    <span class="p">)</span>
</span><span id="setup_logging_filters-109"><a href="#setup_logging_filters-109"><span class="linenos">109</span></a>
</span><span id="setup_logging_filters-110"><a href="#setup_logging_filters-110"><span class="linenos">110</span></a>    <span class="c1"># Note: Click, spacy, weasel, and thinc warnings are now handled by the virtual environment</span>
</span><span id="setup_logging_filters-111"><a href="#setup_logging_filters-111"><span class="linenos">111</span></a>    <span class="c1"># via PYTHONWARNINGS environment variable set in .venv/bin/activate</span>
</span><span id="setup_logging_filters-112"><a href="#setup_logging_filters-112"><span class="linenos">112</span></a>
</span><span id="setup_logging_filters-113"><a href="#setup_logging_filters-113"><span class="linenos">113</span></a>    <span class="c1"># Reduce httpx logging verbosity to WARNING to reduce noise</span>
</span><span id="setup_logging_filters-114"><a href="#setup_logging_filters-114"><span class="linenos">114</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;httpx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-115"><a href="#setup_logging_filters-115"><span class="linenos">115</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;httpcore&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-116"><a href="#setup_logging_filters-116"><span class="linenos">116</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;httpcore.connection&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-117"><a href="#setup_logging_filters-117"><span class="linenos">117</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;httpcore.http11&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-118"><a href="#setup_logging_filters-118"><span class="linenos">118</span></a>
</span><span id="setup_logging_filters-119"><a href="#setup_logging_filters-119"><span class="linenos">119</span></a>    <span class="c1"># Reduce Flask/Werkzeug logging verbosity to WARNING to reduce noise</span>
</span><span id="setup_logging_filters-120"><a href="#setup_logging_filters-120"><span class="linenos">120</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;werkzeug&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-121"><a href="#setup_logging_filters-121"><span class="linenos">121</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;flask&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-122"><a href="#setup_logging_filters-122"><span class="linenos">122</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;flask.app&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-123"><a href="#setup_logging_filters-123"><span class="linenos">123</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;werkzeug._internal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-124"><a href="#setup_logging_filters-124"><span class="linenos">124</span></a>
</span><span id="setup_logging_filters-125"><a href="#setup_logging_filters-125"><span class="linenos">125</span></a>    <span class="c1"># Also suppress other common noisy loggers</span>
</span><span id="setup_logging_filters-126"><a href="#setup_logging_filters-126"><span class="linenos">126</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;urllib3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-127"><a href="#setup_logging_filters-127"><span class="linenos">127</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;requests&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-128"><a href="#setup_logging_filters-128"><span class="linenos">128</span></a>
</span><span id="setup_logging_filters-129"><a href="#setup_logging_filters-129"><span class="linenos">129</span></a>    <span class="c1"># Suppress LanceDB/Lance warnings (these come from Rust library)</span>
</span><span id="setup_logging_filters-130"><a href="#setup_logging_filters-130"><span class="linenos">130</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;rust&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span><span id="setup_logging_filters-131"><a href="#setup_logging_filters-131"><span class="linenos">131</span></a>
</span><span id="setup_logging_filters-132"><a href="#setup_logging_filters-132"><span class="linenos">132</span></a>    <span class="c1"># Configure agno framework loggers to use Rich handlers</span>
</span><span id="setup_logging_filters-133"><a href="#setup_logging_filters-133"><span class="linenos">133</span></a>    <span class="n">agno_loggers</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="setup_logging_filters-134"><a href="#setup_logging_filters-134"><span class="linenos">134</span></a>        <span class="s2">&quot;agno&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-135"><a href="#setup_logging_filters-135"><span class="linenos">135</span></a>        <span class="s2">&quot;agno.agent&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-136"><a href="#setup_logging_filters-136"><span class="linenos">136</span></a>        <span class="s2">&quot;agno.models&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-137"><a href="#setup_logging_filters-137"><span class="linenos">137</span></a>        <span class="s2">&quot;agno.tools&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-138"><a href="#setup_logging_filters-138"><span class="linenos">138</span></a>        <span class="s2">&quot;agno.knowledge&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-139"><a href="#setup_logging_filters-139"><span class="linenos">139</span></a>        <span class="s2">&quot;agno.knowledge.text&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-140"><a href="#setup_logging_filters-140"><span class="linenos">140</span></a>        <span class="s2">&quot;agno.knowledge.pdf&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-141"><a href="#setup_logging_filters-141"><span class="linenos">141</span></a>        <span class="s2">&quot;agno.knowledge.combined&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-142"><a href="#setup_logging_filters-142"><span class="linenos">142</span></a>        <span class="s2">&quot;agno.memory&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-143"><a href="#setup_logging_filters-143"><span class="linenos">143</span></a>        <span class="s2">&quot;agno.storage&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-144"><a href="#setup_logging_filters-144"><span class="linenos">144</span></a>        <span class="s2">&quot;agno.vectordb&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-145"><a href="#setup_logging_filters-145"><span class="linenos">145</span></a>        <span class="s2">&quot;agno.vectordb.lancedb&quot;</span><span class="p">,</span>  <span class="c1"># Add specific LanceDB logger</span>
</span><span id="setup_logging_filters-146"><a href="#setup_logging_filters-146"><span class="linenos">146</span></a>        <span class="s2">&quot;agno.embedder&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-147"><a href="#setup_logging_filters-147"><span class="linenos">147</span></a>        <span class="s2">&quot;agno.info&quot;</span><span class="p">,</span>  <span class="c1"># This handles the INFO messages we&#39;re seeing</span>
</span><span id="setup_logging_filters-148"><a href="#setup_logging_filters-148"><span class="linenos">148</span></a>        <span class="c1"># Add Lance loggers to get Rich formatting</span>
</span><span id="setup_logging_filters-149"><a href="#setup_logging_filters-149"><span class="linenos">149</span></a>        <span class="s2">&quot;lance&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-150"><a href="#setup_logging_filters-150"><span class="linenos">150</span></a>        <span class="s2">&quot;lance.dataset&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-151"><a href="#setup_logging_filters-151"><span class="linenos">151</span></a>        <span class="s2">&quot;lance.dataset.scanner&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-152"><a href="#setup_logging_filters-152"><span class="linenos">152</span></a>        <span class="s2">&quot;lancedb&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-153"><a href="#setup_logging_filters-153"><span class="linenos">153</span></a>        <span class="s2">&quot;rust&quot;</span><span class="p">,</span>
</span><span id="setup_logging_filters-154"><a href="#setup_logging_filters-154"><span class="linenos">154</span></a>    <span class="p">]</span>
</span><span id="setup_logging_filters-155"><a href="#setup_logging_filters-155"><span class="linenos">155</span></a>
</span><span id="setup_logging_filters-156"><a href="#setup_logging_filters-156"><span class="linenos">156</span></a>    <span class="c1"># Rich formatter for agno logs</span>
</span><span id="setup_logging_filters-157"><a href="#setup_logging_filters-157"><span class="linenos">157</span></a>    <span class="n">rich_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
</span><span id="setup_logging_filters-158"><a href="#setup_logging_filters-158"><span class="linenos">158</span></a>        <span class="s2">&quot;PersonalAgent: </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(name)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
</span><span id="setup_logging_filters-159"><a href="#setup_logging_filters-159"><span class="linenos">159</span></a>    <span class="p">)</span>
</span><span id="setup_logging_filters-160"><a href="#setup_logging_filters-160"><span class="linenos">160</span></a>
</span><span id="setup_logging_filters-161"><a href="#setup_logging_filters-161"><span class="linenos">161</span></a>    <span class="k">for</span> <span class="n">logger_name</span> <span class="ow">in</span> <span class="n">agno_loggers</span><span class="p">:</span>
</span><span id="setup_logging_filters-162"><a href="#setup_logging_filters-162"><span class="linenos">162</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="setup_logging_filters-163"><a href="#setup_logging_filters-163"><span class="linenos">163</span></a>
</span><span id="setup_logging_filters-164"><a href="#setup_logging_filters-164"><span class="linenos">164</span></a>        <span class="c1"># Clear existing handlers to avoid duplicates</span>
</span><span id="setup_logging_filters-165"><a href="#setup_logging_filters-165"><span class="linenos">165</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="setup_logging_filters-166"><a href="#setup_logging_filters-166"><span class="linenos">166</span></a>
</span><span id="setup_logging_filters-167"><a href="#setup_logging_filters-167"><span class="linenos">167</span></a>        <span class="c1"># Add Rich handler</span>
</span><span id="setup_logging_filters-168"><a href="#setup_logging_filters-168"><span class="linenos">168</span></a>        <span class="n">rich_handler</span> <span class="o">=</span> <span class="n">RichHandler</span><span class="p">(</span><span class="n">rich_tracebacks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="setup_logging_filters-169"><a href="#setup_logging_filters-169"><span class="linenos">169</span></a>        <span class="n">rich_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">LOG_LEVEL</span><span class="p">)</span>
</span><span id="setup_logging_filters-170"><a href="#setup_logging_filters-170"><span class="linenos">170</span></a>        <span class="n">rich_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">rich_formatter</span><span class="p">)</span>
</span><span id="setup_logging_filters-171"><a href="#setup_logging_filters-171"><span class="linenos">171</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">rich_handler</span><span class="p">)</span>
</span><span id="setup_logging_filters-172"><a href="#setup_logging_filters-172"><span class="linenos">172</span></a>
</span><span id="setup_logging_filters-173"><a href="#setup_logging_filters-173"><span class="linenos">173</span></a>        <span class="c1"># Set logger level</span>
</span><span id="setup_logging_filters-174"><a href="#setup_logging_filters-174"><span class="linenos">174</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">LOG_LEVEL</span><span class="p">)</span>
</span><span id="setup_logging_filters-175"><a href="#setup_logging_filters-175"><span class="linenos">175</span></a>
</span><span id="setup_logging_filters-176"><a href="#setup_logging_filters-176"><span class="linenos">176</span></a>        <span class="c1"># Prevent propagation to avoid duplicate logs</span>
</span><span id="setup_logging_filters-177"><a href="#setup_logging_filters-177"><span class="linenos">177</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="setup_logging_filters-178"><a href="#setup_logging_filters-178"><span class="linenos">178</span></a>
</span><span id="setup_logging_filters-179"><a href="#setup_logging_filters-179"><span class="linenos">179</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Set up logging configuration with Rich handler and configure agno loggers.</p>
</div>


                </section>
                <section id="create_app">
                            <input id="create_app-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_app</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="n">flask</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">Flask</span>:</span></span>

                <label class="view-source-button" for="create_app-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_app"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_app-75"><a href="#create_app-75"><span class="linenos">75</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_app</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Flask</span><span class="p">:</span>
</span><span id="create_app-76"><a href="#create_app-76"><span class="linenos">76</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_app-77"><a href="#create_app-77"><span class="linenos">77</span></a><span class="sd">    Create and configure the Flask application.</span>
</span><span id="create_app-78"><a href="#create_app-78"><span class="linenos">78</span></a>
</span><span id="create_app-79"><a href="#create_app-79"><span class="linenos">79</span></a><span class="sd">    :return: Configured Flask application</span>
</span><span id="create_app-80"><a href="#create_app-80"><span class="linenos">80</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_app-81"><a href="#create_app-81"><span class="linenos">81</span></a>    <span class="n">flask_app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="create_app-82"><a href="#create_app-82"><span class="linenos">82</span></a>    <span class="k">return</span> <span class="n">flask_app</span>
</span></pre></div>


            <div class="docstring"><p>Create and configure the Flask application.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Configured Flask application</p>
</blockquote>
</div>


                </section>
                <section id="register_routes">
                            <input id="register_routes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_routes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">flask_app</span><span class="p">:</span> <span class="n">flask</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">Flask</span>,</span><span class="param">	<span class="n">executor</span>,</span><span class="param">	<span class="n">log</span>,</span><span class="param">	<span class="n">query_kb_func</span>,</span><span class="param">	<span class="n">store_int_func</span>,</span><span class="param">	<span class="n">clear_kb_func</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="register_routes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#register_routes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="register_routes-145"><a href="#register_routes-145"><span class="linenos">145</span></a><span class="k">def</span><span class="w"> </span><span class="nf">register_routes</span><span class="p">(</span>
</span><span id="register_routes-146"><a href="#register_routes-146"><span class="linenos">146</span></a>    <span class="n">flask_app</span><span class="p">:</span> <span class="n">Flask</span><span class="p">,</span>
</span><span id="register_routes-147"><a href="#register_routes-147"><span class="linenos">147</span></a>    <span class="n">executor</span><span class="p">,</span>
</span><span id="register_routes-148"><a href="#register_routes-148"><span class="linenos">148</span></a>    <span class="n">log</span><span class="p">,</span>
</span><span id="register_routes-149"><a href="#register_routes-149"><span class="linenos">149</span></a>    <span class="n">query_kb_func</span><span class="p">,</span>
</span><span id="register_routes-150"><a href="#register_routes-150"><span class="linenos">150</span></a>    <span class="n">store_int_func</span><span class="p">,</span>
</span><span id="register_routes-151"><a href="#register_routes-151"><span class="linenos">151</span></a>    <span class="n">clear_kb_func</span><span class="p">,</span>
</span><span id="register_routes-152"><a href="#register_routes-152"><span class="linenos">152</span></a><span class="p">):</span>
</span><span id="register_routes-153"><a href="#register_routes-153"><span class="linenos">153</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="register_routes-154"><a href="#register_routes-154"><span class="linenos">154</span></a><span class="sd">    Register Flask routes with the LangChain-compatible application.</span>
</span><span id="register_routes-155"><a href="#register_routes-155"><span class="linenos">155</span></a>
</span><span id="register_routes-156"><a href="#register_routes-156"><span class="linenos">156</span></a><span class="sd">    :param flask_app: Flask application instance</span>
</span><span id="register_routes-157"><a href="#register_routes-157"><span class="linenos">157</span></a><span class="sd">    :param executor: LangChain agent executor</span>
</span><span id="register_routes-158"><a href="#register_routes-158"><span class="linenos">158</span></a><span class="sd">    :param log: Logger instance</span>
</span><span id="register_routes-159"><a href="#register_routes-159"><span class="linenos">159</span></a><span class="sd">    :param query_kb_func: Function to query knowledge base</span>
</span><span id="register_routes-160"><a href="#register_routes-160"><span class="linenos">160</span></a><span class="sd">    :param store_int_func: Function to store interactions</span>
</span><span id="register_routes-161"><a href="#register_routes-161"><span class="linenos">161</span></a><span class="sd">    :param clear_kb_func: Function to clear knowledge base</span>
</span><span id="register_routes-162"><a href="#register_routes-162"><span class="linenos">162</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="register_routes-163"><a href="#register_routes-163"><span class="linenos">163</span></a>    <span class="k">global</span> <span class="n">app</span><span class="p">,</span> <span class="n">agent_executor</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">query_knowledge_base_func</span><span class="p">,</span> <span class="n">store_interaction_func</span><span class="p">,</span> <span class="n">clear_knowledge_base_func</span>
</span><span id="register_routes-164"><a href="#register_routes-164"><span class="linenos">164</span></a>
</span><span id="register_routes-165"><a href="#register_routes-165"><span class="linenos">165</span></a>    <span class="n">app</span> <span class="o">=</span> <span class="n">flask_app</span>
</span><span id="register_routes-166"><a href="#register_routes-166"><span class="linenos">166</span></a>    <span class="n">agent_executor</span> <span class="o">=</span> <span class="n">executor</span>
</span><span id="register_routes-167"><a href="#register_routes-167"><span class="linenos">167</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">log</span>
</span><span id="register_routes-168"><a href="#register_routes-168"><span class="linenos">168</span></a>    <span class="n">query_knowledge_base_func</span> <span class="o">=</span> <span class="n">query_kb_func</span>
</span><span id="register_routes-169"><a href="#register_routes-169"><span class="linenos">169</span></a>    <span class="n">store_interaction_func</span> <span class="o">=</span> <span class="n">store_int_func</span>
</span><span id="register_routes-170"><a href="#register_routes-170"><span class="linenos">170</span></a>    <span class="n">clear_knowledge_base_func</span> <span class="o">=</span> <span class="n">clear_kb_func</span>
</span><span id="register_routes-171"><a href="#register_routes-171"><span class="linenos">171</span></a>
</span><span id="register_routes-172"><a href="#register_routes-172"><span class="linenos">172</span></a>    <span class="c1"># Add initial system ready thought</span>
</span><span id="register_routes-173"><a href="#register_routes-173"><span class="linenos">173</span></a>    <span class="n">add_thought</span><span class="p">(</span><span class="s2">&quot;🟢 System Ready&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
</span><span id="register_routes-174"><a href="#register_routes-174"><span class="linenos">174</span></a>
</span><span id="register_routes-175"><a href="#register_routes-175"><span class="linenos">175</span></a>    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
</span><span id="register_routes-176"><a href="#register_routes-176"><span class="linenos">176</span></a>    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/clear&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_kb&quot;</span><span class="p">,</span> <span class="n">clear_kb_route</span><span class="p">)</span>
</span><span id="register_routes-177"><a href="#register_routes-177"><span class="linenos">177</span></a>    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/agent_info&quot;</span><span class="p">,</span> <span class="s2">&quot;agent_info&quot;</span><span class="p">,</span> <span class="n">agent_info_route</span><span class="p">)</span>
</span><span id="register_routes-178"><a href="#register_routes-178"><span class="linenos">178</span></a>    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/stream_thoughts&quot;</span><span class="p">,</span> <span class="s2">&quot;stream_thoughts&quot;</span><span class="p">,</span> <span class="n">stream_thoughts_route</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Register Flask routes with the LangChain-compatible application.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>flask_app</strong>:  Flask application instance</li>
<li><strong>executor</strong>:  LangChain agent executor</li>
<li><strong>log</strong>:  Logger instance</li>
<li><strong>query_kb_func</strong>:  Function to query knowledge base</li>
<li><strong>store_int_func</strong>:  Function to store interactions</li>
<li><strong>clear_kb_func</strong>:  Function to clear knowledge base</li>
</ul>
</div>


                </section>
                <section id="cli_main">
                            <input id="cli_main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cli_main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="cli_main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cli_main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cli_main-54"><a href="#cli_main-54"><span class="linenos">54</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cli_main</span><span class="p">():</span>
</span><span id="cli_main-55"><a href="#cli_main-55"><span class="linenos">55</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="cli_main-56"><a href="#cli_main-56"><span class="linenos">56</span></a><span class="sd">    Main entry point for CLI mode (used by poetry scripts).</span>
</span><span id="cli_main-57"><a href="#cli_main-57"><span class="linenos">57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="cli_main-58"><a href="#cli_main-58"><span class="linenos">58</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
</span><span id="cli_main-59"><a href="#cli_main-59"><span class="linenos">59</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Run the Personal AI Agent with Agno Framework&quot;</span>
</span><span id="cli_main-60"><a href="#cli_main-60"><span class="linenos">60</span></a>    <span class="p">)</span>
</span><span id="cli_main-61"><a href="#cli_main-61"><span class="linenos">61</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli_main-62"><a href="#cli_main-62"><span class="linenos">62</span></a>        <span class="s2">&quot;--remote&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use remote Ollama server&quot;</span>
</span><span id="cli_main-63"><a href="#cli_main-63"><span class="linenos">63</span></a>    <span class="p">)</span>
</span><span id="cli_main-64"><a href="#cli_main-64"><span class="linenos">64</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli_main-65"><a href="#cli_main-65"><span class="linenos">65</span></a>        <span class="s2">&quot;--recreate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Recreate the knowledge base&quot;</span>
</span><span id="cli_main-66"><a href="#cli_main-66"><span class="linenos">66</span></a>    <span class="p">)</span>
</span><span id="cli_main-67"><a href="#cli_main-67"><span class="linenos">67</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="cli_main-68"><a href="#cli_main-68"><span class="linenos">68</span></a>
</span><span id="cli_main-69"><a href="#cli_main-69"><span class="linenos">69</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Personal AI Agent in CLI mode...&quot;</span><span class="p">)</span>
</span><span id="cli_main-70"><a href="#cli_main-70"><span class="linenos">70</span></a>    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_agno_cli_wrapper</span><span class="p">(</span><span class="n">use_remote_ollama</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">remote</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">recreate</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Main entry point for CLI mode (used by poetry scripts).</p>
</div>


                </section>
                <section id="run_agno_cli">
                            <input id="run_agno_cli-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run_agno_cli</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">agent</span><span class="p">:</span> <span class="n"><a href="#AgnoPersonalAgent">AgnoPersonalAgent</a></span>,</span><span class="param">	<span class="n">ollama_url</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">console</span><span class="p">:</span> <span class="n">rich</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">Console</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="run_agno_cli-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#run_agno_cli"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="run_agno_cli-19"><a href="#run_agno_cli-19"><span class="linenos"> 19</span></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_agno_cli</span><span class="p">(</span>
</span><span id="run_agno_cli-20"><a href="#run_agno_cli-20"><span class="linenos"> 20</span></a>    <span class="n">agent</span><span class="p">:</span> <span class="s2">&quot;AgnoPersonalAgent&quot;</span><span class="p">,</span> 
</span><span id="run_agno_cli-21"><a href="#run_agno_cli-21"><span class="linenos"> 21</span></a>    <span class="n">ollama_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="run_agno_cli-22"><a href="#run_agno_cli-22"><span class="linenos"> 22</span></a>    <span class="n">console</span><span class="p">:</span> <span class="n">Console</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="run_agno_cli-23"><a href="#run_agno_cli-23"><span class="linenos"> 23</span></a><span class="p">):</span>
</span><span id="run_agno_cli-24"><a href="#run_agno_cli-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="run_agno_cli-25"><a href="#run_agno_cli-25"><span class="linenos"> 25</span></a><span class="sd">    Run agno agent in CLI mode with enhanced interface.</span>
</span><span id="run_agno_cli-26"><a href="#run_agno_cli-26"><span class="linenos"> 26</span></a>
</span><span id="run_agno_cli-27"><a href="#run_agno_cli-27"><span class="linenos"> 27</span></a><span class="sd">    :param agent: The initialized AgnoPersonalAgent instance</span>
</span><span id="run_agno_cli-28"><a href="#run_agno_cli-28"><span class="linenos"> 28</span></a><span class="sd">    :param ollama_url: The Ollama server URL being used</span>
</span><span id="run_agno_cli-29"><a href="#run_agno_cli-29"><span class="linenos"> 29</span></a><span class="sd">    :param console: Optional Rich console instance</span>
</span><span id="run_agno_cli-30"><a href="#run_agno_cli-30"><span class="linenos"> 30</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="run_agno_cli-31"><a href="#run_agno_cli-31"><span class="linenos"> 31</span></a>    <span class="k">if</span> <span class="n">console</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="run_agno_cli-32"><a href="#run_agno_cli-32"><span class="linenos"> 32</span></a>        <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">(</span><span class="n">force_terminal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="run_agno_cli-33"><a href="#run_agno_cli-33"><span class="linenos"> 33</span></a>    
</span><span id="run_agno_cli-34"><a href="#run_agno_cli-34"><span class="linenos"> 34</span></a>    <span class="c1"># Initialize command parser</span>
</span><span id="run_agno_cli-35"><a href="#run_agno_cli-35"><span class="linenos"> 35</span></a>    <span class="n">command_parser</span> <span class="o">=</span> <span class="n">CommandParser</span><span class="p">()</span>
</span><span id="run_agno_cli-36"><a href="#run_agno_cli-36"><span class="linenos"> 36</span></a>
</span><span id="run_agno_cli-37"><a href="#run_agno_cli-37"><span class="linenos"> 37</span></a>    <span class="c1"># Print formatted agent info first</span>
</span><span id="run_agno_cli-38"><a href="#run_agno_cli-38"><span class="linenos"> 38</span></a>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;✅ [bold green]Agent Successfully Initialized![/bold green]&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-39"><a href="#run_agno_cli-39"><span class="linenos"> 39</span></a>    <span class="n">agent</span><span class="o">.</span><span class="n">print_agent_info</span><span class="p">(</span><span class="n">console</span><span class="p">)</span>
</span><span id="run_agno_cli-40"><a href="#run_agno_cli-40"><span class="linenos"> 40</span></a>
</span><span id="run_agno_cli-41"><a href="#run_agno_cli-41"><span class="linenos"> 41</span></a>    <span class="c1"># Display the welcome panel</span>
</span><span id="run_agno_cli-42"><a href="#run_agno_cli-42"><span class="linenos"> 42</span></a>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Add some space</span>
</span><span id="run_agno_cli-43"><a href="#run_agno_cli-43"><span class="linenos"> 43</span></a>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
</span><span id="run_agno_cli-44"><a href="#run_agno_cli-44"><span class="linenos"> 44</span></a>        <span class="n">Panel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
</span><span id="run_agno_cli-45"><a href="#run_agno_cli-45"><span class="linenos"> 45</span></a>            <span class="s2">&quot;🚀 Enhanced Personal AI Agent with Agno Framework</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="run_agno_cli-46"><a href="#run_agno_cli-46"><span class="linenos"> 46</span></a>            <span class="s2">&quot;This CLI provides an enhanced chat interface with memory management.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="run_agno_cli-47"><a href="#run_agno_cli-47"><span class="linenos"> 47</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">command_parser</span><span class="o">.</span><span class="n">get_help_text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="run_agno_cli-48"><a href="#run_agno_cli-48"><span class="linenos"> 48</span></a>            <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold blue&quot;</span><span class="p">,</span>
</span><span id="run_agno_cli-49"><a href="#run_agno_cli-49"><span class="linenos"> 49</span></a>        <span class="p">)</span>
</span><span id="run_agno_cli-50"><a href="#run_agno_cli-50"><span class="linenos"> 50</span></a>    <span class="p">)</span>
</span><span id="run_agno_cli-51"><a href="#run_agno_cli-51"><span class="linenos"> 51</span></a>
</span><span id="run_agno_cli-52"><a href="#run_agno_cli-52"><span class="linenos"> 52</span></a>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🖥️  Using Ollama at: </span><span class="si">{</span><span class="n">ollama_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-53"><a href="#run_agno_cli-53"><span class="linenos"> 53</span></a>
</span><span id="run_agno_cli-54"><a href="#run_agno_cli-54"><span class="linenos"> 54</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="run_agno_cli-55"><a href="#run_agno_cli-55"><span class="linenos"> 55</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="run_agno_cli-56"><a href="#run_agno_cli-56"><span class="linenos"> 56</span></a>            <span class="c1"># Get user input</span>
</span><span id="run_agno_cli-57"><a href="#run_agno_cli-57"><span class="linenos"> 57</span></a>            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">💬 You: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="run_agno_cli-58"><a href="#run_agno_cli-58"><span class="linenos"> 58</span></a>
</span><span id="run_agno_cli-59"><a href="#run_agno_cli-59"><span class="linenos"> 59</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_input</span><span class="p">:</span>
</span><span id="run_agno_cli-60"><a href="#run_agno_cli-60"><span class="linenos"> 60</span></a>                <span class="k">continue</span>
</span><span id="run_agno_cli-61"><a href="#run_agno_cli-61"><span class="linenos"> 61</span></a>
</span><span id="run_agno_cli-62"><a href="#run_agno_cli-62"><span class="linenos"> 62</span></a>            <span class="c1"># Parse the command</span>
</span><span id="run_agno_cli-63"><a href="#run_agno_cli-63"><span class="linenos"> 63</span></a>            <span class="n">command_handler</span><span class="p">,</span> <span class="n">remaining_text</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">command_parser</span><span class="o">.</span><span class="n">parse_command</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>
</span><span id="run_agno_cli-64"><a href="#run_agno_cli-64"><span class="linenos"> 64</span></a>            
</span><span id="run_agno_cli-65"><a href="#run_agno_cli-65"><span class="linenos"> 65</span></a>            <span class="c1"># Handle quit command specially</span>
</span><span id="run_agno_cli-66"><a href="#run_agno_cli-66"><span class="linenos"> 66</span></a>            <span class="k">if</span> <span class="n">command_handler</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">command_handler</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;_handle_quit&#39;</span><span class="p">:</span>
</span><span id="run_agno_cli-67"><a href="#run_agno_cli-67"><span class="linenos"> 67</span></a>                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;👋 Goodbye!&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-68"><a href="#run_agno_cli-68"><span class="linenos"> 68</span></a>                <span class="k">break</span>
</span><span id="run_agno_cli-69"><a href="#run_agno_cli-69"><span class="linenos"> 69</span></a>            
</span><span id="run_agno_cli-70"><a href="#run_agno_cli-70"><span class="linenos"> 70</span></a>            <span class="c1"># If it&#39;s a command, execute it</span>
</span><span id="run_agno_cli-71"><a href="#run_agno_cli-71"><span class="linenos"> 71</span></a>            <span class="k">if</span> <span class="n">command_handler</span><span class="p">:</span>
</span><span id="run_agno_cli-72"><a href="#run_agno_cli-72"><span class="linenos"> 72</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="run_agno_cli-73"><a href="#run_agno_cli-73"><span class="linenos"> 73</span></a>                    <span class="k">if</span> <span class="n">remaining_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="run_agno_cli-74"><a href="#run_agno_cli-74"><span class="linenos"> 74</span></a>                        <span class="k">await</span> <span class="n">command_handler</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">remaining_text</span><span class="p">,</span> <span class="n">console</span><span class="p">)</span>
</span><span id="run_agno_cli-75"><a href="#run_agno_cli-75"><span class="linenos"> 75</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="run_agno_cli-76"><a href="#run_agno_cli-76"><span class="linenos"> 76</span></a>                        <span class="k">await</span> <span class="n">command_handler</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">console</span><span class="p">)</span>
</span><span id="run_agno_cli-77"><a href="#run_agno_cli-77"><span class="linenos"> 77</span></a>                    <span class="k">continue</span>
</span><span id="run_agno_cli-78"><a href="#run_agno_cli-78"><span class="linenos"> 78</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="run_agno_cli-79"><a href="#run_agno_cli-79"><span class="linenos"> 79</span></a>                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💥 Error executing command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-80"><a href="#run_agno_cli-80"><span class="linenos"> 80</span></a>                    <span class="k">continue</span>
</span><span id="run_agno_cli-81"><a href="#run_agno_cli-81"><span class="linenos"> 81</span></a>
</span><span id="run_agno_cli-82"><a href="#run_agno_cli-82"><span class="linenos"> 82</span></a>            <span class="c1"># If not a command, treat as regular chat</span>
</span><span id="run_agno_cli-83"><a href="#run_agno_cli-83"><span class="linenos"> 83</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="run_agno_cli-84"><a href="#run_agno_cli-84"><span class="linenos"> 84</span></a>                <span class="c1"># Get response from agent</span>
</span><span id="run_agno_cli-85"><a href="#run_agno_cli-85"><span class="linenos"> 85</span></a>                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;🤖 Assistant:&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-86"><a href="#run_agno_cli-86"><span class="linenos"> 86</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span>
</span><span id="run_agno_cli-87"><a href="#run_agno_cli-87"><span class="linenos"> 87</span></a>                    <span class="n">user_input</span><span class="p">,</span>
</span><span id="run_agno_cli-88"><a href="#run_agno_cli-88"><span class="linenos"> 88</span></a>                    <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Disable streaming for cleaner CLI output</span>
</span><span id="run_agno_cli-89"><a href="#run_agno_cli-89"><span class="linenos"> 89</span></a>                    <span class="n">show_tool_calls</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>  <span class="c1"># Show tool calls in debug mode</span>
</span><span id="run_agno_cli-90"><a href="#run_agno_cli-90"><span class="linenos"> 90</span></a>                <span class="p">)</span>
</span><span id="run_agno_cli-91"><a href="#run_agno_cli-91"><span class="linenos"> 91</span></a>
</span><span id="run_agno_cli-92"><a href="#run_agno_cli-92"><span class="linenos"> 92</span></a>                <span class="c1"># Print the final response content</span>
</span><span id="run_agno_cli-93"><a href="#run_agno_cli-93"><span class="linenos"> 93</span></a>                <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="run_agno_cli-94"><a href="#run_agno_cli-94"><span class="linenos"> 94</span></a>                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span id="run_agno_cli-95"><a href="#run_agno_cli-95"><span class="linenos"> 95</span></a>                <span class="k">elif</span> <span class="n">response</span><span class="p">:</span>
</span><span id="run_agno_cli-96"><a href="#run_agno_cli-96"><span class="linenos"> 96</span></a>                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response received but no content: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-97"><a href="#run_agno_cli-97"><span class="linenos"> 97</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="run_agno_cli-98"><a href="#run_agno_cli-98"><span class="linenos"> 98</span></a>                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;No response generated.&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-99"><a href="#run_agno_cli-99"><span class="linenos"> 99</span></a>
</span><span id="run_agno_cli-100"><a href="#run_agno_cli-100"><span class="linenos">100</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="run_agno_cli-101"><a href="#run_agno_cli-101"><span class="linenos">101</span></a>                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💥 Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-102"><a href="#run_agno_cli-102"><span class="linenos">102</span></a>
</span><span id="run_agno_cli-103"><a href="#run_agno_cli-103"><span class="linenos">103</span></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="run_agno_cli-104"><a href="#run_agno_cli-104"><span class="linenos">104</span></a>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">👋 Goodbye!&quot;</span><span class="p">)</span>
</span><span id="run_agno_cli-105"><a href="#run_agno_cli-105"><span class="linenos">105</span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="run_agno_cli-106"><a href="#run_agno_cli-106"><span class="linenos">106</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="run_agno_cli-107"><a href="#run_agno_cli-107"><span class="linenos">107</span></a>            <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><span id="run_agno_cli-108"><a href="#run_agno_cli-108"><span class="linenos">108</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="run_agno_cli-109"><a href="#run_agno_cli-109"><span class="linenos">109</span></a>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning during cleanup: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run agno agent in CLI mode with enhanced interface.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>agent</strong>:  The initialized AgnoPersonalAgent instance</li>
<li><strong>ollama_url</strong>:  The Ollama server URL being used</li>
<li><strong>console</strong>:  Optional Rich console instance</li>
</ul>
</div>


                </section>
                <section id="langchain_main">
                            <input id="langchain_main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">langchain_main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="langchain_main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#langchain_main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="langchain_main-188"><a href="#langchain_main-188"><span class="linenos">188</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="langchain_main-189"><a href="#langchain_main-189"><span class="linenos">189</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for the Personal AI Agent.&quot;&quot;&quot;</span>
</span><span id="langchain_main-190"><a href="#langchain_main-190"><span class="linenos">190</span></a>    <span class="c1"># Register cleanup handlers</span>
</span><span id="langchain_main-191"><a href="#langchain_main-191"><span class="linenos">191</span></a>    <span class="n">register_cleanup_handlers</span><span class="p">()</span>
</span><span id="langchain_main-192"><a href="#langchain_main-192"><span class="linenos">192</span></a>
</span><span id="langchain_main-193"><a href="#langchain_main-193"><span class="linenos">193</span></a>    <span class="n">logger_instance</span> <span class="o">=</span> <span class="n">setup_logging</span><span class="p">()</span>
</span><span id="langchain_main-194"><a href="#langchain_main-194"><span class="linenos">194</span></a>    <span class="n">logger_instance</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Web interface will be available at: http://127.0.0.1:5001&quot;</span><span class="p">)</span>
</span><span id="langchain_main-195"><a href="#langchain_main-195"><span class="linenos">195</span></a>
</span><span id="langchain_main-196"><a href="#langchain_main-196"><span class="linenos">196</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="langchain_main-197"><a href="#langchain_main-197"><span class="linenos">197</span></a>        <span class="c1"># Create and run the web application</span>
</span><span id="langchain_main-198"><a href="#langchain_main-198"><span class="linenos">198</span></a>        <span class="n">app</span> <span class="o">=</span> <span class="n">create_web_app</span><span class="p">()</span>
</span><span id="langchain_main-199"><a href="#langchain_main-199"><span class="linenos">199</span></a>
</span><span id="langchain_main-200"><a href="#langchain_main-200"><span class="linenos">200</span></a>        <span class="c1"># Disable Flask&#39;s reloader in production to avoid resource leaks</span>
</span><span id="langchain_main-201"><a href="#langchain_main-201"><span class="linenos">201</span></a>        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5001</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_reloader</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="langchain_main-202"><a href="#langchain_main-202"><span class="linenos">202</span></a>
</span><span id="langchain_main-203"><a href="#langchain_main-203"><span class="linenos">203</span></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="langchain_main-204"><a href="#langchain_main-204"><span class="linenos">204</span></a>        <span class="n">logger_instance</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received keyboard interrupt&quot;</span><span class="p">)</span>
</span><span id="langchain_main-205"><a href="#langchain_main-205"><span class="linenos">205</span></a>        <span class="c1"># cleanup() will be called by atexit, no need to call here</span>
</span><span id="langchain_main-206"><a href="#langchain_main-206"><span class="linenos">206</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="langchain_main-207"><a href="#langchain_main-207"><span class="linenos">207</span></a>        <span class="n">logger_instance</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error running Flask app: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="langchain_main-208"><a href="#langchain_main-208"><span class="linenos">208</span></a>
</span><span id="langchain_main-209"><a href="#langchain_main-209"><span class="linenos">209</span></a>        <span class="n">cleanup</span><span class="p">()</span>
</span><span id="langchain_main-210"><a href="#langchain_main-210"><span class="linenos">210</span></a>        <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Main entry point for the Personal AI Agent.</p>
</div>


                </section>
                <section id="langchain_cli_main">
                            <input id="langchain_cli_main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">langchain_cli_main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="langchain_cli_main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#langchain_cli_main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="langchain_cli_main-123"><a href="#langchain_cli_main-123"><span class="linenos">123</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cli_main</span><span class="p">():</span>
</span><span id="langchain_cli_main-124"><a href="#langchain_cli_main-124"><span class="linenos">124</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;CLI entry point for the Personal AI Agent.&quot;&quot;&quot;</span>
</span><span id="langchain_cli_main-125"><a href="#langchain_cli_main-125"><span class="linenos">125</span></a>    <span class="c1"># Register cleanup handlers</span>
</span><span id="langchain_cli_main-126"><a href="#langchain_cli_main-126"><span class="linenos">126</span></a>    <span class="n">register_cleanup_handlers</span><span class="p">()</span>
</span><span id="langchain_cli_main-127"><a href="#langchain_cli_main-127"><span class="linenos">127</span></a>
</span><span id="langchain_cli_main-128"><a href="#langchain_cli_main-128"><span class="linenos">128</span></a>    <span class="n">logger_instance</span> <span class="o">=</span> <span class="n">setup_logging</span><span class="p">()</span>
</span><span id="langchain_cli_main-129"><a href="#langchain_cli_main-129"><span class="linenos">129</span></a>    <span class="n">logger_instance</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting Personal AI Agent CLI...&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-130"><a href="#langchain_cli_main-130"><span class="linenos">130</span></a>
</span><span id="langchain_cli_main-131"><a href="#langchain_cli_main-131"><span class="linenos">131</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="langchain_cli_main-132"><a href="#langchain_cli_main-132"><span class="linenos">132</span></a>        <span class="c1"># Initialize the system</span>
</span><span id="langchain_cli_main-133"><a href="#langchain_cli_main-133"><span class="linenos">133</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="n">initialize_system</span><span class="p">()</span>
</span><span id="langchain_cli_main-134"><a href="#langchain_cli_main-134"><span class="linenos">134</span></a>
</span><span id="langchain_cli_main-135"><a href="#langchain_cli_main-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">agent_executor</span><span class="p">:</span>
</span><span id="langchain_cli_main-136"><a href="#langchain_cli_main-136"><span class="linenos">136</span></a>            <span class="n">logger_instance</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to initialize agent executor&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-137"><a href="#langchain_cli_main-137"><span class="linenos">137</span></a>            <span class="k">return</span>
</span><span id="langchain_cli_main-138"><a href="#langchain_cli_main-138"><span class="linenos">138</span></a>
</span><span id="langchain_cli_main-139"><a href="#langchain_cli_main-139"><span class="linenos">139</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🤖 Personal AI Agent CLI&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-140"><a href="#langchain_cli_main-140"><span class="linenos">140</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type &#39;quit&#39;, &#39;exit&#39;, or press Ctrl+C to stop&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-141"><a href="#langchain_cli_main-141"><span class="linenos">141</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="langchain_cli_main-142"><a href="#langchain_cli_main-142"><span class="linenos">142</span></a>
</span><span id="langchain_cli_main-143"><a href="#langchain_cli_main-143"><span class="linenos">143</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="langchain_cli_main-144"><a href="#langchain_cli_main-144"><span class="linenos">144</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="langchain_cli_main-145"><a href="#langchain_cli_main-145"><span class="linenos">145</span></a>                <span class="c1"># Get user input</span>
</span><span id="langchain_cli_main-146"><a href="#langchain_cli_main-146"><span class="linenos">146</span></a>                <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">💬 You: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="langchain_cli_main-147"><a href="#langchain_cli_main-147"><span class="linenos">147</span></a>
</span><span id="langchain_cli_main-148"><a href="#langchain_cli_main-148"><span class="linenos">148</span></a>                <span class="k">if</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;quit&quot;</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">]:</span>
</span><span id="langchain_cli_main-149"><a href="#langchain_cli_main-149"><span class="linenos">149</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;👋 Goodbye!&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-150"><a href="#langchain_cli_main-150"><span class="linenos">150</span></a>                    <span class="k">break</span>
</span><span id="langchain_cli_main-151"><a href="#langchain_cli_main-151"><span class="linenos">151</span></a>
</span><span id="langchain_cli_main-152"><a href="#langchain_cli_main-152"><span class="linenos">152</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">user_input</span><span class="p">:</span>
</span><span id="langchain_cli_main-153"><a href="#langchain_cli_main-153"><span class="linenos">153</span></a>                    <span class="k">continue</span>
</span><span id="langchain_cli_main-154"><a href="#langchain_cli_main-154"><span class="linenos">154</span></a>
</span><span id="langchain_cli_main-155"><a href="#langchain_cli_main-155"><span class="linenos">155</span></a>                <span class="c1"># Process the query using the agent executor</span>
</span><span id="langchain_cli_main-156"><a href="#langchain_cli_main-156"><span class="linenos">156</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔍 Agent: &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="langchain_cli_main-157"><a href="#langchain_cli_main-157"><span class="linenos">157</span></a>
</span><span id="langchain_cli_main-158"><a href="#langchain_cli_main-158"><span class="linenos">158</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="langchain_cli_main-159"><a href="#langchain_cli_main-159"><span class="linenos">159</span></a>                    <span class="c1"># Execute the agent with the user&#39;s input</span>
</span><span id="langchain_cli_main-160"><a href="#langchain_cli_main-160"><span class="linenos">160</span></a>                    <span class="n">response</span> <span class="o">=</span> <span class="n">agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">user_input</span><span class="p">})</span>
</span><span id="langchain_cli_main-161"><a href="#langchain_cli_main-161"><span class="linenos">161</span></a>
</span><span id="langchain_cli_main-162"><a href="#langchain_cli_main-162"><span class="linenos">162</span></a>                    <span class="c1"># Extract the output from the response</span>
</span><span id="langchain_cli_main-163"><a href="#langchain_cli_main-163"><span class="linenos">163</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;output&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="langchain_cli_main-164"><a href="#langchain_cli_main-164"><span class="linenos">164</span></a>                        <span class="n">answer</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</span><span id="langchain_cli_main-165"><a href="#langchain_cli_main-165"><span class="linenos">165</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="langchain_cli_main-166"><a href="#langchain_cli_main-166"><span class="linenos">166</span></a>                        <span class="n">answer</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="langchain_cli_main-167"><a href="#langchain_cli_main-167"><span class="linenos">167</span></a>
</span><span id="langchain_cli_main-168"><a href="#langchain_cli_main-168"><span class="linenos">168</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span><span id="langchain_cli_main-169"><a href="#langchain_cli_main-169"><span class="linenos">169</span></a>
</span><span id="langchain_cli_main-170"><a href="#langchain_cli_main-170"><span class="linenos">170</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="langchain_cli_main-171"><a href="#langchain_cli_main-171"><span class="linenos">171</span></a>                    <span class="n">logger_instance</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error processing query: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="langchain_cli_main-172"><a href="#langchain_cli_main-172"><span class="linenos">172</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Sorry, I encountered an error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-173"><a href="#langchain_cli_main-173"><span class="linenos">173</span></a>
</span><span id="langchain_cli_main-174"><a href="#langchain_cli_main-174"><span class="linenos">174</span></a>            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="langchain_cli_main-175"><a href="#langchain_cli_main-175"><span class="linenos">175</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">👋 Goodbye!&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-176"><a href="#langchain_cli_main-176"><span class="linenos">176</span></a>                <span class="k">break</span>
</span><span id="langchain_cli_main-177"><a href="#langchain_cli_main-177"><span class="linenos">177</span></a>            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
</span><span id="langchain_cli_main-178"><a href="#langchain_cli_main-178"><span class="linenos">178</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">👋 Goodbye!&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-179"><a href="#langchain_cli_main-179"><span class="linenos">179</span></a>                <span class="k">break</span>
</span><span id="langchain_cli_main-180"><a href="#langchain_cli_main-180"><span class="linenos">180</span></a>
</span><span id="langchain_cli_main-181"><a href="#langchain_cli_main-181"><span class="linenos">181</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="langchain_cli_main-182"><a href="#langchain_cli_main-182"><span class="linenos">182</span></a>        <span class="n">logger_instance</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in CLI: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="langchain_cli_main-183"><a href="#langchain_cli_main-183"><span class="linenos">183</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Fatal error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="langchain_cli_main-184"><a href="#langchain_cli_main-184"><span class="linenos">184</span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="langchain_cli_main-185"><a href="#langchain_cli_main-185"><span class="linenos">185</span></a>        <span class="n">cleanup</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>CLI entry point for the Personal AI Agent.</p>
</div>


                </section>
                <section id="run_smolagents_web">
                            <input id="run_smolagents_web-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_smolagents_web</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="run_smolagents_web-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#run_smolagents_web"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="run_smolagents_web-155"><a href="#run_smolagents_web-155"><span class="linenos">155</span></a><span class="k">def</span><span class="w"> </span><span class="nf">run_smolagents_web</span><span class="p">():</span>
</span><span id="run_smolagents_web-156"><a href="#run_smolagents_web-156"><span class="linenos">156</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="run_smolagents_web-157"><a href="#run_smolagents_web-157"><span class="linenos">157</span></a><span class="sd">    Run the smolagents web application.</span>
</span><span id="run_smolagents_web-158"><a href="#run_smolagents_web-158"><span class="linenos">158</span></a>
</span><span id="run_smolagents_web-159"><a href="#run_smolagents_web-159"><span class="linenos">159</span></a><span class="sd">    :return: None</span>
</span><span id="run_smolagents_web-160"><a href="#run_smolagents_web-160"><span class="linenos">160</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="run_smolagents_web-161"><a href="#run_smolagents_web-161"><span class="linenos">161</span></a>    <span class="n">app</span> <span class="o">=</span> <span class="n">create_smolagents_web_app</span><span class="p">()</span>
</span><span id="run_smolagents_web-162"><a href="#run_smolagents_web-162"><span class="linenos">162</span></a>
</span><span id="run_smolagents_web-163"><a href="#run_smolagents_web-163"><span class="linenos">163</span></a>    <span class="c1"># Run the app</span>
</span><span id="run_smolagents_web-164"><a href="#run_smolagents_web-164"><span class="linenos">164</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🚀 Starting Personal AI Agent with Smolagents...&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_web-165"><a href="#run_smolagents_web-165"><span class="linenos">165</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🌐 Web interface will be available at: http://127.0.0.1:5001&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_web-166"><a href="#run_smolagents_web-166"><span class="linenos">166</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📚 Features: MCP integration, Web search, GitHub, Memory, File operations&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_web-167"><a href="#run_smolagents_web-167"><span class="linenos">167</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚡ Framework: Smolagents with LiteLLM + Ollama&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_web-168"><a href="#run_smolagents_web-168"><span class="linenos">168</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Press Ctrl+C to stop the server.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_web-169"><a href="#run_smolagents_web-169"><span class="linenos">169</span></a>
</span><span id="run_smolagents_web-170"><a href="#run_smolagents_web-170"><span class="linenos">170</span></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5001</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run the smolagents web application.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="run_smolagents_cli">
                            <input id="run_smolagents_cli-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_smolagents_cli</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="run_smolagents_cli-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#run_smolagents_cli"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="run_smolagents_cli-173"><a href="#run_smolagents_cli-173"><span class="linenos">173</span></a><span class="k">def</span><span class="w"> </span><span class="nf">run_smolagents_cli</span><span class="p">():</span>
</span><span id="run_smolagents_cli-174"><a href="#run_smolagents_cli-174"><span class="linenos">174</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="run_smolagents_cli-175"><a href="#run_smolagents_cli-175"><span class="linenos">175</span></a><span class="sd">    Run smolagents agent in CLI mode with interactive chat.</span>
</span><span id="run_smolagents_cli-176"><a href="#run_smolagents_cli-176"><span class="linenos">176</span></a>
</span><span id="run_smolagents_cli-177"><a href="#run_smolagents_cli-177"><span class="linenos">177</span></a><span class="sd">    :return: None</span>
</span><span id="run_smolagents_cli-178"><a href="#run_smolagents_cli-178"><span class="linenos">178</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="run_smolagents_cli-179"><a href="#run_smolagents_cli-179"><span class="linenos">179</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🤖 Personal AI Agent - Smolagents CLI Mode&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_cli-180"><a href="#run_smolagents_cli-180"><span class="linenos">180</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="run_smolagents_cli-181"><a href="#run_smolagents_cli-181"><span class="linenos">181</span></a>
</span><span id="run_smolagents_cli-182"><a href="#run_smolagents_cli-182"><span class="linenos">182</span></a>    <span class="c1"># Initialize system</span>
</span><span id="run_smolagents_cli-183"><a href="#run_smolagents_cli-183"><span class="linenos">183</span></a>    <span class="n">multi_agent</span><span class="p">,</span> <span class="n">single_agent</span><span class="p">,</span> <span class="n">query_kb</span><span class="p">,</span> <span class="n">store_int</span><span class="p">,</span> <span class="n">clear_kb</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="run_smolagents_cli-184"><a href="#run_smolagents_cli-184"><span class="linenos">184</span></a>        <span class="n">initialize_smolagents_system</span><span class="p">()</span>
</span><span id="run_smolagents_cli-185"><a href="#run_smolagents_cli-185"><span class="linenos">185</span></a>    <span class="p">)</span>
</span><span id="run_smolagents_cli-186"><a href="#run_smolagents_cli-186"><span class="linenos">186</span></a>
</span><span id="run_smolagents_cli-187"><a href="#run_smolagents_cli-187"><span class="linenos">187</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">multi_agent</span><span class="p">:</span>
</span><span id="run_smolagents_cli-188"><a href="#run_smolagents_cli-188"><span class="linenos">188</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Failed to initialize agent system&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_cli-189"><a href="#run_smolagents_cli-189"><span class="linenos">189</span></a>        <span class="k">return</span>
</span><span id="run_smolagents_cli-190"><a href="#run_smolagents_cli-190"><span class="linenos">190</span></a>
</span><span id="run_smolagents_cli-191"><a href="#run_smolagents_cli-191"><span class="linenos">191</span></a>    <span class="n">agent_info</span> <span class="o">=</span> <span class="n">multi_agent</span><span class="o">.</span><span class="n">get_agent_info</span><span class="p">()</span>
</span><span id="run_smolagents_cli-192"><a href="#run_smolagents_cli-192"><span class="linenos">192</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Agent initialized with specialists: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">agent_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_cli-193"><a href="#run_smolagents_cli-193"><span class="linenos">193</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter your queries (type &#39;quit&#39; to exit):&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_cli-194"><a href="#run_smolagents_cli-194"><span class="linenos">194</span></a>
</span><span id="run_smolagents_cli-195"><a href="#run_smolagents_cli-195"><span class="linenos">195</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="run_smolagents_cli-196"><a href="#run_smolagents_cli-196"><span class="linenos">196</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="run_smolagents_cli-197"><a href="#run_smolagents_cli-197"><span class="linenos">197</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">👤 You: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="run_smolagents_cli-198"><a href="#run_smolagents_cli-198"><span class="linenos">198</span></a>            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;quit&quot;</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">]:</span>
</span><span id="run_smolagents_cli-199"><a href="#run_smolagents_cli-199"><span class="linenos">199</span></a>                <span class="k">break</span>
</span><span id="run_smolagents_cli-200"><a href="#run_smolagents_cli-200"><span class="linenos">200</span></a>
</span><span id="run_smolagents_cli-201"><a href="#run_smolagents_cli-201"><span class="linenos">201</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="p">:</span>
</span><span id="run_smolagents_cli-202"><a href="#run_smolagents_cli-202"><span class="linenos">202</span></a>                <span class="k">continue</span>
</span><span id="run_smolagents_cli-203"><a href="#run_smolagents_cli-203"><span class="linenos">203</span></a>
</span><span id="run_smolagents_cli-204"><a href="#run_smolagents_cli-204"><span class="linenos">204</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🤖 Assistant: &quot;</span><span class="p">)</span>
</span><span id="run_smolagents_cli-205"><a href="#run_smolagents_cli-205"><span class="linenos">205</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="run_smolagents_cli-206"><a href="#run_smolagents_cli-206"><span class="linenos">206</span></a>                <span class="c1"># Use the multi-agent system to process the query</span>
</span><span id="run_smolagents_cli-207"><a href="#run_smolagents_cli-207"><span class="linenos">207</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">multi_agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="run_smolagents_cli-208"><a href="#run_smolagents_cli-208"><span class="linenos">208</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="run_smolagents_cli-209"><a href="#run_smolagents_cli-209"><span class="linenos">209</span></a>
</span><span id="run_smolagents_cli-210"><a href="#run_smolagents_cli-210"><span class="linenos">210</span></a>                <span class="c1"># Store interaction in memory</span>
</span><span id="run_smolagents_cli-211"><a href="#run_smolagents_cli-211"><span class="linenos">211</span></a>                <span class="n">store_success</span> <span class="o">=</span> <span class="n">store_int</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</span><span id="run_smolagents_cli-212"><a href="#run_smolagents_cli-212"><span class="linenos">212</span></a>                <span class="k">if</span> <span class="n">store_success</span><span class="p">:</span>
</span><span id="run_smolagents_cli-213"><a href="#run_smolagents_cli-213"><span class="linenos">213</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💾 Interaction stored in memory&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_cli-214"><a href="#run_smolagents_cli-214"><span class="linenos">214</span></a>
</span><span id="run_smolagents_cli-215"><a href="#run_smolagents_cli-215"><span class="linenos">215</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="run_smolagents_cli-216"><a href="#run_smolagents_cli-216"><span class="linenos">216</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_cli-217"><a href="#run_smolagents_cli-217"><span class="linenos">217</span></a>
</span><span id="run_smolagents_cli-218"><a href="#run_smolagents_cli-218"><span class="linenos">218</span></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="run_smolagents_cli-219"><a href="#run_smolagents_cli-219"><span class="linenos">219</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">👋 Goodbye!&quot;</span><span class="p">)</span>
</span><span id="run_smolagents_cli-220"><a href="#run_smolagents_cli-220"><span class="linenos">220</span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="run_smolagents_cli-221"><a href="#run_smolagents_cli-221"><span class="linenos">221</span></a>        <span class="c1"># Cleanup would be handled by the cleanup handlers</span>
</span><span id="run_smolagents_cli-222"><a href="#run_smolagents_cli-222"><span class="linenos">222</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🧹 Cleaning up...&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run smolagents agent in CLI mode with interactive chat.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="print_configuration">
                            <input id="print_configuration-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_configuration</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="print_configuration-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#print_configuration"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="print_configuration-181"><a href="#print_configuration-181"><span class="linenos">181</span></a><span class="k">def</span><span class="w"> </span><span class="nf">print_configuration</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="print_configuration-182"><a href="#print_configuration-182"><span class="linenos">182</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Print comprehensive configuration information for the Personal AI Agent.</span>
</span><span id="print_configuration-183"><a href="#print_configuration-183"><span class="linenos">183</span></a>
</span><span id="print_configuration-184"><a href="#print_configuration-184"><span class="linenos">184</span></a><span class="sd">    Uses the enhanced configuration display method from the module&#39;s tools.</span>
</span><span id="print_configuration-185"><a href="#print_configuration-185"><span class="linenos">185</span></a>
</span><span id="print_configuration-186"><a href="#print_configuration-186"><span class="linenos">186</span></a><span class="sd">    :return: Configuration information as formatted string</span>
</span><span id="print_configuration-187"><a href="#print_configuration-187"><span class="linenos">187</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="print_configuration-188"><a href="#print_configuration-188"><span class="linenos">188</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="print_configuration-189"><a href="#print_configuration-189"><span class="linenos">189</span></a>        <span class="c1"># Import and use the enhanced display function from the module&#39;s tools</span>
</span><span id="print_configuration-190"><a href="#print_configuration-190"><span class="linenos">190</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.tools.show_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_config</span>
</span><span id="print_configuration-191"><a href="#print_configuration-191"><span class="linenos">191</span></a>
</span><span id="print_configuration-192"><a href="#print_configuration-192"><span class="linenos">192</span></a>        <span class="c1"># Call the show_config function with default colored output</span>
</span><span id="print_configuration-193"><a href="#print_configuration-193"><span class="linenos">193</span></a>        <span class="n">show_config</span><span class="p">()</span>
</span><span id="print_configuration-194"><a href="#print_configuration-194"><span class="linenos">194</span></a>
</span><span id="print_configuration-195"><a href="#print_configuration-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="s2">&quot;Configuration displayed successfully using module tools.show_config method.&quot;</span>
</span><span id="print_configuration-196"><a href="#print_configuration-196"><span class="linenos">196</span></a>
</span><span id="print_configuration-197"><a href="#print_configuration-197"><span class="linenos">197</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="print_configuration-198"><a href="#print_configuration-198"><span class="linenos">198</span></a>        <span class="c1"># Fallback to the settings.print_config() method if enhanced method fails</span>
</span><span id="print_configuration-199"><a href="#print_configuration-199"><span class="linenos">199</span></a>        <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not use module tools.show_config display: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="print_configuration-200"><a href="#print_configuration-200"><span class="linenos">200</span></a>
</span><span id="print_configuration-201"><a href="#print_configuration-201"><span class="linenos">201</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="print_configuration-202"><a href="#print_configuration-202"><span class="linenos">202</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_config</span>
</span><span id="print_configuration-203"><a href="#print_configuration-203"><span class="linenos">203</span></a>
</span><span id="print_configuration-204"><a href="#print_configuration-204"><span class="linenos">204</span></a>            <span class="n">print_config</span><span class="p">()</span>
</span><span id="print_configuration-205"><a href="#print_configuration-205"><span class="linenos">205</span></a>            <span class="k">return</span> <span class="s2">&quot;Configuration displayed successfully using settings.print_config() fallback.&quot;</span>
</span><span id="print_configuration-206"><a href="#print_configuration-206"><span class="linenos">206</span></a>        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">fallback_error</span><span class="p">:</span>
</span><span id="print_configuration-207"><a href="#print_configuration-207"><span class="linenos">207</span></a>            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="print_configuration-208"><a href="#print_configuration-208"><span class="linenos">208</span></a>                <span class="s2">&quot;Could not import settings.print_config: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fallback_error</span>
</span><span id="print_configuration-209"><a href="#print_configuration-209"><span class="linenos">209</span></a>            <span class="p">)</span>
</span><span id="print_configuration-210"><a href="#print_configuration-210"><span class="linenos">210</span></a>
</span><span id="print_configuration-211"><a href="#print_configuration-211"><span class="linenos">211</span></a>            <span class="c1"># Final fallback to basic configuration display</span>
</span><span id="print_configuration-212"><a href="#print_configuration-212"><span class="linenos">212</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_mcp_servers</span>
</span><span id="print_configuration-213"><a href="#print_configuration-213"><span class="linenos">213</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="print_configuration-214"><a href="#print_configuration-214"><span class="linenos">214</span></a>                <span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">,</span>
</span><span id="print_configuration-215"><a href="#print_configuration-215"><span class="linenos">215</span></a>                <span class="n">AGNO_STORAGE_DIR</span><span class="p">,</span>
</span><span id="print_configuration-216"><a href="#print_configuration-216"><span class="linenos">216</span></a>                <span class="n">DATA_DIR</span><span class="p">,</span>
</span><span id="print_configuration-217"><a href="#print_configuration-217"><span class="linenos">217</span></a>                <span class="n">HOME_DIR</span><span class="p">,</span>
</span><span id="print_configuration-218"><a href="#print_configuration-218"><span class="linenos">218</span></a>                <span class="n">LLM_MODEL</span><span class="p">,</span>
</span><span id="print_configuration-219"><a href="#print_configuration-219"><span class="linenos">219</span></a>                <span class="n">LOG_LEVEL_STR</span><span class="p">,</span>
</span><span id="print_configuration-220"><a href="#print_configuration-220"><span class="linenos">220</span></a>                <span class="n">OLLAMA_URL</span><span class="p">,</span>
</span><span id="print_configuration-221"><a href="#print_configuration-221"><span class="linenos">221</span></a>                <span class="n">REPO_DIR</span><span class="p">,</span>
</span><span id="print_configuration-222"><a href="#print_configuration-222"><span class="linenos">222</span></a>                <span class="n">ROOT_DIR</span><span class="p">,</span>
</span><span id="print_configuration-223"><a href="#print_configuration-223"><span class="linenos">223</span></a>                <span class="n">STORAGE_BACKEND</span><span class="p">,</span>
</span><span id="print_configuration-224"><a href="#print_configuration-224"><span class="linenos">224</span></a>                <span class="n">USE_MCP</span><span class="p">,</span>
</span><span id="print_configuration-225"><a href="#print_configuration-225"><span class="linenos">225</span></a>                <span class="n">USE_WEAVIATE</span><span class="p">,</span>
</span><span id="print_configuration-226"><a href="#print_configuration-226"><span class="linenos">226</span></a>                <span class="n">WEAVIATE_URL</span><span class="p">,</span>
</span><span id="print_configuration-227"><a href="#print_configuration-227"><span class="linenos">227</span></a>            <span class="p">)</span>
</span><span id="print_configuration-228"><a href="#print_configuration-228"><span class="linenos">228</span></a>
</span><span id="print_configuration-229"><a href="#print_configuration-229"><span class="linenos">229</span></a>            <span class="n">config_lines</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="print_configuration-230"><a href="#print_configuration-230"><span class="linenos">230</span></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">,</span>
</span><span id="print_configuration-231"><a href="#print_configuration-231"><span class="linenos">231</span></a>                <span class="s2">&quot;🤖 PERSONAL AI AGENT CONFIGURATION&quot;</span><span class="p">,</span>
</span><span id="print_configuration-232"><a href="#print_configuration-232"><span class="linenos">232</span></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">,</span>
</span><span id="print_configuration-233"><a href="#print_configuration-233"><span class="linenos">233</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="print_configuration-234"><a href="#print_configuration-234"><span class="linenos">234</span></a>                <span class="s2">&quot;📊 CORE SETTINGS:&quot;</span><span class="p">,</span>
</span><span id="print_configuration-235"><a href="#print_configuration-235"><span class="linenos">235</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Package Version: </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-236"><a href="#print_configuration-236"><span class="linenos">236</span></a>                <span class="sa">f</span><span class="s2">&quot;  • LLM Model: </span><span class="si">{</span><span class="n">LLM_MODEL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-237"><a href="#print_configuration-237"><span class="linenos">237</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Storage Backend: </span><span class="si">{</span><span class="n">STORAGE_BACKEND</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-238"><a href="#print_configuration-238"><span class="linenos">238</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Log Level: </span><span class="si">{</span><span class="n">LOG_LEVEL_STR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-239"><a href="#print_configuration-239"><span class="linenos">239</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="print_configuration-240"><a href="#print_configuration-240"><span class="linenos">240</span></a>                <span class="s2">&quot;🌐 SERVICE ENDPOINTS:&quot;</span><span class="p">,</span>
</span><span id="print_configuration-241"><a href="#print_configuration-241"><span class="linenos">241</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Ollama URL: </span><span class="si">{</span><span class="n">OLLAMA_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-242"><a href="#print_configuration-242"><span class="linenos">242</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Weaviate URL: </span><span class="si">{</span><span class="n">WEAVIATE_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-243"><a href="#print_configuration-243"><span class="linenos">243</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="print_configuration-244"><a href="#print_configuration-244"><span class="linenos">244</span></a>                <span class="s2">&quot;🔧 FEATURE FLAGS:&quot;</span><span class="p">,</span>
</span><span id="print_configuration-245"><a href="#print_configuration-245"><span class="linenos">245</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Weaviate Enabled: </span><span class="si">{</span><span class="s1">&#39;✅&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">USE_WEAVIATE</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;❌&#39;</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">USE_WEAVIATE</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="print_configuration-246"><a href="#print_configuration-246"><span class="linenos">246</span></a>                <span class="sa">f</span><span class="s2">&quot;  • MCP Enabled: </span><span class="si">{</span><span class="s1">&#39;✅&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">USE_MCP</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;❌&#39;</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">USE_MCP</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="print_configuration-247"><a href="#print_configuration-247"><span class="linenos">247</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="print_configuration-248"><a href="#print_configuration-248"><span class="linenos">248</span></a>                <span class="s2">&quot;📁 DIRECTORY CONFIGURATION:&quot;</span><span class="p">,</span>
</span><span id="print_configuration-249"><a href="#print_configuration-249"><span class="linenos">249</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Root Directory: </span><span class="si">{</span><span class="n">ROOT_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-250"><a href="#print_configuration-250"><span class="linenos">250</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Home Directory: </span><span class="si">{</span><span class="n">HOME_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-251"><a href="#print_configuration-251"><span class="linenos">251</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Data Directory: </span><span class="si">{</span><span class="n">DATA_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-252"><a href="#print_configuration-252"><span class="linenos">252</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Repository Directory: </span><span class="si">{</span><span class="n">REPO_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-253"><a href="#print_configuration-253"><span class="linenos">253</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Agno Storage Directory: </span><span class="si">{</span><span class="n">AGNO_STORAGE_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-254"><a href="#print_configuration-254"><span class="linenos">254</span></a>                <span class="sa">f</span><span class="s2">&quot;  • Agno Knowledge Directory: </span><span class="si">{</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="print_configuration-255"><a href="#print_configuration-255"><span class="linenos">255</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="print_configuration-256"><a href="#print_configuration-256"><span class="linenos">256</span></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">,</span>
</span><span id="print_configuration-257"><a href="#print_configuration-257"><span class="linenos">257</span></a>                <span class="s2">&quot;🚀 Configuration loaded successfully!&quot;</span><span class="p">,</span>
</span><span id="print_configuration-258"><a href="#print_configuration-258"><span class="linenos">258</span></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">,</span>
</span><span id="print_configuration-259"><a href="#print_configuration-259"><span class="linenos">259</span></a>            <span class="p">]</span>
</span><span id="print_configuration-260"><a href="#print_configuration-260"><span class="linenos">260</span></a>
</span><span id="print_configuration-261"><a href="#print_configuration-261"><span class="linenos">261</span></a>            <span class="c1"># Join and print</span>
</span><span id="print_configuration-262"><a href="#print_configuration-262"><span class="linenos">262</span></a>            <span class="n">config_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_lines</span><span class="p">)</span>
</span><span id="print_configuration-263"><a href="#print_configuration-263"><span class="linenos">263</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">config_text</span><span class="p">)</span>
</span><span id="print_configuration-264"><a href="#print_configuration-264"><span class="linenos">264</span></a>            <span class="k">return</span> <span class="n">config_text</span>
</span></pre></div>


            <div class="docstring"><p>Print comprehensive configuration information for the Personal AI Agent.</p>

<p>Uses the enhanced configuration display method from the module's tools.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Configuration information as formatted string</p>
</blockquote>
</div>


                </section>
                <section id="__version__">
                    <div class="attr variable">
            <span class="name">__version__</span>        =
<span class="default_value">&#39;0.9.2dev&#39;</span>

        
    </div>
    <a class="headerlink" href="#__version__"></a>
    
    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>