<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>src.personal_agent.tools API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../personal_agent.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;src.personal_agent</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="tools/show_config.html">show_config</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#store_interaction">store_interaction</a>
            </li>
            <li>
                    <a class="variable" href="#query_knowledge_base">query_knowledge_base</a>
            </li>
            <li>
                    <a class="variable" href="#clear_knowledge_base">clear_knowledge_base</a>
            </li>
            <li>
                    <a class="function" href="#create_memory_tools">create_memory_tools</a>
            </li>
            <li>
                    <a class="class" href="#KnowledgeIngestionTools">KnowledgeIngestionTools</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#KnowledgeIngestionTools.__init__">KnowledgeIngestionTools</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeIngestionTools.ingest_knowledge_file">ingest_knowledge_file</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeIngestionTools.ingest_knowledge_text">ingest_knowledge_text</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeIngestionTools.ingest_knowledge_from_url">ingest_knowledge_from_url</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeIngestionTools.batch_ingest_directory">batch_ingest_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeIngestionTools.query_knowledge_base">query_knowledge_base</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SemanticKnowledgeIngestionTools">SemanticKnowledgeIngestionTools</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SemanticKnowledgeIngestionTools.__init__">SemanticKnowledgeIngestionTools</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticKnowledgeIngestionTools.ingest_semantic_file">ingest_semantic_file</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticKnowledgeIngestionTools.ingest_semantic_text">ingest_semantic_text</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url">ingest_semantic_from_url</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory">batch_ingest_semantic_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge">query_semantic_knowledge</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#KnowledgeTools">KnowledgeTools</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#KnowledgeTools.__init__">KnowledgeTools</a>
                        </li>
                        <li>
                                <a class="variable" href="#KnowledgeTools.knowledge_manager">knowledge_manager</a>
                        </li>
                        <li>
                                <a class="variable" href="#KnowledgeTools.agno_knowledge">agno_knowledge</a>
                        </li>
                        <li>
                                <a class="variable" href="#KnowledgeTools.knowledge_coordinator">knowledge_coordinator</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeTools.ingest_knowledge_file">ingest_knowledge_file</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeTools.ingest_knowledge_text">ingest_knowledge_text</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeTools.ingest_knowledge_from_url">ingest_knowledge_from_url</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeTools.batch_ingest_directory">batch_ingest_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeTools.query_knowledge_base">query_knowledge_base</a>
                        </li>
                        <li>
                                <a class="function" href="#KnowledgeTools.query_lightrag_knowledge_direct">query_lightrag_knowledge_direct</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#mcp_read_file">mcp_read_file</a>
            </li>
            <li>
                    <a class="variable" href="#mcp_write_file">mcp_write_file</a>
            </li>
            <li>
                    <a class="variable" href="#mcp_list_directory">mcp_list_directory</a>
            </li>
            <li>
                    <a class="variable" href="#intelligent_file_search">intelligent_file_search</a>
            </li>
            <li>
                    <a class="variable" href="#create_and_save_file">create_and_save_file</a>
            </li>
            <li>
                    <a class="variable" href="#mcp_github_search">mcp_github_search</a>
            </li>
            <li>
                    <a class="variable" href="#mcp_brave_search">mcp_brave_search</a>
            </li>
            <li>
                    <a class="variable" href="#mcp_fetch_url">mcp_fetch_url</a>
            </li>
            <li>
                    <a class="variable" href="#mcp_shell_command">mcp_shell_command</a>
            </li>
            <li>
                    <a class="variable" href="#comprehensive_research">comprehensive_research</a>
            </li>
            <li>
                    <a class="class" href="#LightRAGDocumentManager">LightRAGDocumentManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.__init__">LightRAGDocumentManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#LightRAGDocumentManager.server_url">server_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#LightRAGDocumentManager.storage_dir">storage_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#LightRAGDocumentManager.status_file_path">status_file_path</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.check_server_status">check_server_status</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.get_all_docs">get_all_docs</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.delete_documents">delete_documents</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.retry_documents">retry_documents</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.finalize">finalize</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.get_status_summary">get_status_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.filter_documents_by_status">filter_documents_by_status</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.filter_documents_by_ids">filter_documents_by_ids</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.filter_documents_by_name_pattern">filter_documents_by_name_pattern</a>
                        </li>
                        <li>
                                <a class="function" href="#LightRAGDocumentManager.verify_deletion">verify_deletion</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MemoryClearingManager">MemoryClearingManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MemoryClearingManager.__init__">MemoryClearingManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryClearingManager.user_id">user_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryClearingManager.storage_dir">storage_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryClearingManager.lightrag_memory_url">lightrag_memory_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryClearingManager.verbose">verbose</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryClearingManager.semantic_db_path">semantic_db_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryClearingManager.memory_db">memory_db</a>
                        </li>
                        <li>
                                <a class="variable" href="#MemoryClearingManager.memory_manager">memory_manager</a>
                        </li>
                        <li>
                                <a class="function" href="#MemoryClearingManager.get_memory_status">get_memory_status</a>
                        </li>
                        <li>
                                <a class="function" href="#MemoryClearingManager.clear_all_memories">clear_all_memories</a>
                        </li>
                        <li>
                                <a class="function" href="#MemoryClearingManager.verify_clearing">verify_clearing</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#show_config">show_config</a>
            </li>
            <li>
                    <a class="function" href="#get_all_tools">get_all_tools</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
src<wbr>.<a href="./../personal_agent.html">personal_agent</a><wbr>.tools    </h1>

                        <div class="docstring"><p>Tools package for Personal Agent.</p>
</div>

                        <input id="mod-tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-tools-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Tools package for Personal Agent.&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">langchain.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseTool</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.filesystem</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>    <span class="n">create_and_save_file</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>    <span class="n">intelligent_file_search</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>    <span class="n">mcp_list_directory</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="n">mcp_read_file</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>    <span class="n">mcp_write_file</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="p">)</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.memory_tools</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="n">clear_knowledge_base</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>    <span class="n">create_memory_tools</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="n">query_knowledge_base</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    <span class="n">store_interaction</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="p">)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.knowledge_ingestion_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">KnowledgeIngestionTools</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.knowledge_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">KnowledgeTools</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.semantic_knowledge_ingestion_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">SemanticKnowledgeIngestionTools</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.lightrag_document_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">LightRAGDocumentManager</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.memory_cleaner</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemoryClearingManager</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.research</span><span class="w"> </span><span class="kn">import</span> <span class="n">comprehensive_research</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.show_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_config</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.system</span><span class="w"> </span><span class="kn">import</span> <span class="n">mcp_shell_command</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.web</span><span class="w"> </span><span class="kn">import</span> <span class="n">mcp_brave_search</span><span class="p">,</span> <span class="n">mcp_fetch_url</span><span class="p">,</span> <span class="n">mcp_github_search</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="c1"># Memory tools</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>    <span class="s2">&quot;store_interaction&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="s2">&quot;query_knowledge_base&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="s2">&quot;clear_knowledge_base&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="s2">&quot;create_memory_tools&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="c1"># Knowledge ingestion tools</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>    <span class="s2">&quot;KnowledgeIngestionTools&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="c1"># Semantic knowledge ingestion tools</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="s2">&quot;SemanticKnowledgeIngestionTools&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    <span class="c1"># Knowledge tools</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="s2">&quot;KnowledgeTools&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="c1"># Filesystem tools</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="s2">&quot;mcp_read_file&quot;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="s2">&quot;mcp_write_file&quot;</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="s2">&quot;mcp_list_directory&quot;</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="s2">&quot;intelligent_file_search&quot;</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="s2">&quot;create_and_save_file&quot;</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="c1"># Web tools</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="s2">&quot;mcp_github_search&quot;</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="s2">&quot;mcp_brave_search&quot;</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="s2">&quot;mcp_fetch_url&quot;</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="c1"># System tools</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="s2">&quot;mcp_shell_command&quot;</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="c1"># Research tools</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="s2">&quot;comprehensive_research&quot;</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="c1"># Document management tools</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    <span class="s2">&quot;LightRAGDocumentManager&quot;</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="c1"># Memory management tools</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="s2">&quot;MemoryClearingManager&quot;</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="c1"># Configuration tools</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="s2">&quot;show_config&quot;</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="c1"># Tool collection</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    <span class="s2">&quot;get_all_tools&quot;</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="p">]</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_all_tools</span><span class="p">(</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="n">mcp_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">weaviate_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="n">vector_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;BaseTool&quot;</span><span class="p">]:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    Get all available tools with injected dependencies.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    Args:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        mcp_client: MCP client for file operations and external tools</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        weaviate_client: Weaviate client for vector operations</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        vector_store: Vector store for knowledge base operations</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        logger: Logger instance for tool operations</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    Returns:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        List of initialized tools</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="c1"># Import tools modules and inject dependencies</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">..config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">ROOT_DIR</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span><span class="p">,</span> <span class="n">memory_tools</span><span class="p">,</span> <span class="n">research</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">web</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    <span class="c1"># Inject global dependencies into each module that needs them</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="k">if</span> <span class="n">mcp_client</span><span class="p">:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">ROOT_DIR</span> <span class="o">=</span> <span class="n">ROOT_DIR</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">DATA_DIR</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="c1"># Inject logger into all modules</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="k">if</span> <span class="n">weaviate_client</span> <span class="ow">and</span> <span class="n">vector_store</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">weaviate_client</span> <span class="o">=</span> <span class="n">weaviate_client</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="c1"># Inject Weaviate dependencies into other modules</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="c1"># Memory tools (require Weaviate)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="k">if</span> <span class="n">weaviate_client</span> <span class="ow">and</span> <span class="n">vector_store</span><span class="p">:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="n">memory_tools_list</span> <span class="o">=</span> <span class="n">create_memory_tools</span><span class="p">(</span><span class="n">weaviate_client</span><span class="p">,</span> <span class="n">vector_store</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">memory_tools_list</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="c1"># MCP-based tools (require MCP client)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    <span class="k">if</span> <span class="n">mcp_client</span><span class="p">:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="p">[</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>                <span class="c1"># Filesystem tools</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_read_file</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_write_file</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_list_directory</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">intelligent_file_search</span><span class="p">,</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">create_and_save_file</span><span class="p">,</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                <span class="c1"># Web tools</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_github_search</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_brave_search</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_fetch_url</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="c1"># System tools</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                <span class="n">system</span><span class="o">.</span><span class="n">mcp_shell_command</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                <span class="c1"># Research tools</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>                <span class="n">research</span><span class="o">.</span><span class="n">comprehensive_research</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="p">]</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="k">return</span> <span class="n">tools</span>
</span></pre></div>


            </section>
                <section id="store_interaction">
                    <div class="attr variable">
            <span class="name">store_interaction</span>        =
<input id="store_interaction-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="store_interaction-view-value"></label><span class="default_value">StructuredTool(name=&#39;store_interaction&#39;, description=&#39;Store user interaction in Weaviate.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.store_interaction&#39;&gt;, func=&lt;function create_memory_tools.&lt;locals&gt;<a href="#store_interaction">store_interaction</a>&gt;)</span>

        
    </div>
    <a class="headerlink" href="#store_interaction"></a>
    
    

                </section>
                <section id="query_knowledge_base">
                    <div class="attr variable">
            <span class="name">query_knowledge_base</span>        =
<input id="query_knowledge_base-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="query_knowledge_base-view-value"></label><span class="default_value">StructuredTool(name=&#39;query_knowledge_base&#39;, description=&#39;Query Weaviate for relevant context.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.query_knowledge_base&#39;&gt;, func=&lt;function create_memory_tools.&lt;locals&gt;<a href="#query_knowledge_base">query_knowledge_base</a>&gt;)</span>

        
    </div>
    <a class="headerlink" href="#query_knowledge_base"></a>
    
    

                </section>
                <section id="clear_knowledge_base">
                    <div class="attr variable">
            <span class="name">clear_knowledge_base</span>        =
<input id="clear_knowledge_base-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="clear_knowledge_base-view-value"></label><span class="default_value">StructuredTool(name=&#39;clear_knowledge_base&#39;, description=&#39;Clear all data from Weaviate.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.clear_knowledge_base&#39;&gt;, func=&lt;function create_memory_tools.&lt;locals&gt;<a href="#clear_knowledge_base">clear_knowledge_base</a>&gt;)</span>

        
    </div>
    <a class="headerlink" href="#clear_knowledge_base"></a>
    
    

                </section>
                <section id="create_memory_tools">
                            <input id="create_memory_tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_memory_tools</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">weaviate_client_instance</span>, </span><span class="param"><span class="n">vector_store_instance</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="create_memory_tools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_memory_tools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_memory_tools-16"><a href="#create_memory_tools-16"><span class="linenos"> 16</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_memory_tools</span><span class="p">(</span><span class="n">weaviate_client_instance</span><span class="p">,</span> <span class="n">vector_store_instance</span><span class="p">):</span>
</span><span id="create_memory_tools-17"><a href="#create_memory_tools-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create memory tools with injected dependencies.&quot;&quot;&quot;</span>
</span><span id="create_memory_tools-18"><a href="#create_memory_tools-18"><span class="linenos"> 18</span></a>
</span><span id="create_memory_tools-19"><a href="#create_memory_tools-19"><span class="linenos"> 19</span></a>    <span class="nd">@tool</span>
</span><span id="create_memory_tools-20"><a href="#create_memory_tools-20"><span class="linenos"> 20</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">store_interaction</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;general&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="create_memory_tools-21"><a href="#create_memory_tools-21"><span class="linenos"> 21</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store user interaction in Weaviate.&quot;&quot;&quot;</span>
</span><span id="create_memory_tools-22"><a href="#create_memory_tools-22"><span class="linenos"> 22</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">USE_WEAVIATE</span> <span class="ow">or</span> <span class="n">vector_store_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="create_memory_tools-23"><a href="#create_memory_tools-23"><span class="linenos"> 23</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Weaviate is disabled, interaction not stored.&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-24"><a href="#create_memory_tools-24"><span class="linenos"> 24</span></a>            <span class="k">return</span> <span class="s2">&quot;Weaviate is disabled, interaction not stored.&quot;</span>
</span><span id="create_memory_tools-25"><a href="#create_memory_tools-25"><span class="linenos"> 25</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="create_memory_tools-26"><a href="#create_memory_tools-26"><span class="linenos"> 26</span></a>            <span class="c1"># Format timestamp as RFC3339 (with &#39;Z&#39; for UTC)</span>
</span><span id="create_memory_tools-27"><a href="#create_memory_tools-27"><span class="linenos"> 27</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-28"><a href="#create_memory_tools-28"><span class="linenos"> 28</span></a>            <span class="n">vector_store_instance</span><span class="o">.</span><span class="n">add_texts</span><span class="p">(</span>
</span><span id="create_memory_tools-29"><a href="#create_memory_tools-29"><span class="linenos"> 29</span></a>                <span class="n">texts</span><span class="o">=</span><span class="p">[</span><span class="n">text</span><span class="p">],</span>
</span><span id="create_memory_tools-30"><a href="#create_memory_tools-30"><span class="linenos"> 30</span></a>                <span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span> <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">topic</span><span class="p">}],</span>
</span><span id="create_memory_tools-31"><a href="#create_memory_tools-31"><span class="linenos"> 31</span></a>                <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">text</span><span class="p">)],</span>
</span><span id="create_memory_tools-32"><a href="#create_memory_tools-32"><span class="linenos"> 32</span></a>            <span class="p">)</span>
</span><span id="create_memory_tools-33"><a href="#create_memory_tools-33"><span class="linenos"> 33</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stored interaction: </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">[:</span><span class="mi">50</span><span class="p">])</span>
</span><span id="create_memory_tools-34"><a href="#create_memory_tools-34"><span class="linenos"> 34</span></a>            <span class="k">return</span> <span class="s2">&quot;Interaction stored successfully.&quot;</span>
</span><span id="create_memory_tools-35"><a href="#create_memory_tools-35"><span class="linenos"> 35</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="create_memory_tools-36"><a href="#create_memory_tools-36"><span class="linenos"> 36</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="create_memory_tools-37"><a href="#create_memory_tools-37"><span class="linenos"> 37</span></a>
</span><span id="create_memory_tools-38"><a href="#create_memory_tools-38"><span class="linenos"> 38</span></a>            <span class="c1"># Check for corruption indicators and attempt recovery</span>
</span><span id="create_memory_tools-39"><a href="#create_memory_tools-39"><span class="linenos"> 39</span></a>            <span class="n">corruption_indicators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="create_memory_tools-40"><a href="#create_memory_tools-40"><span class="linenos"> 40</span></a>                <span class="s2">&quot;no such file or directory&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-41"><a href="#create_memory_tools-41"><span class="linenos"> 41</span></a>                <span class="s2">&quot;wal&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-42"><a href="#create_memory_tools-42"><span class="linenos"> 42</span></a>                <span class="s2">&quot;segment-&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-43"><a href="#create_memory_tools-43"><span class="linenos"> 43</span></a>                <span class="s2">&quot;commit log&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-44"><a href="#create_memory_tools-44"><span class="linenos"> 44</span></a>                <span class="s2">&quot;failed to send all objects&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-45"><a href="#create_memory_tools-45"><span class="linenos"> 45</span></a>                <span class="s2">&quot;weaviateinsertmanyallfailederror&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-46"><a href="#create_memory_tools-46"><span class="linenos"> 46</span></a>            <span class="p">]</span>
</span><span id="create_memory_tools-47"><a href="#create_memory_tools-47"><span class="linenos"> 47</span></a>
</span><span id="create_memory_tools-48"><a href="#create_memory_tools-48"><span class="linenos"> 48</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">indicator</span> <span class="ow">in</span> <span class="n">error_msg</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">corruption_indicators</span><span class="p">):</span>
</span><span id="create_memory_tools-49"><a href="#create_memory_tools-49"><span class="linenos"> 49</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Database corruption detected during storage: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="create_memory_tools-50"><a href="#create_memory_tools-50"><span class="linenos"> 50</span></a>
</span><span id="create_memory_tools-51"><a href="#create_memory_tools-51"><span class="linenos"> 51</span></a>                <span class="c1"># Attempt recovery by importing and using the reset function</span>
</span><span id="create_memory_tools-52"><a href="#create_memory_tools-52"><span class="linenos"> 52</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="create_memory_tools-53"><a href="#create_memory_tools-53"><span class="linenos"> 53</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">..core.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">reset_weaviate_if_corrupted</span>
</span><span id="create_memory_tools-54"><a href="#create_memory_tools-54"><span class="linenos"> 54</span></a>
</span><span id="create_memory_tools-55"><a href="#create_memory_tools-55"><span class="linenos"> 55</span></a>                    <span class="k">if</span> <span class="n">reset_weaviate_if_corrupted</span><span class="p">():</span>
</span><span id="create_memory_tools-56"><a href="#create_memory_tools-56"><span class="linenos"> 56</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Weaviate recovery successful, retrying storage...&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-57"><a href="#create_memory_tools-57"><span class="linenos"> 57</span></a>                        <span class="c1"># Retry the operation once</span>
</span><span id="create_memory_tools-58"><a href="#create_memory_tools-58"><span class="linenos"> 58</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="create_memory_tools-59"><a href="#create_memory_tools-59"><span class="linenos"> 59</span></a>                            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-60"><a href="#create_memory_tools-60"><span class="linenos"> 60</span></a>                            <span class="n">vector_store_instance</span><span class="o">.</span><span class="n">add_texts</span><span class="p">(</span>
</span><span id="create_memory_tools-61"><a href="#create_memory_tools-61"><span class="linenos"> 61</span></a>                                <span class="n">texts</span><span class="o">=</span><span class="p">[</span><span class="n">text</span><span class="p">],</span>
</span><span id="create_memory_tools-62"><a href="#create_memory_tools-62"><span class="linenos"> 62</span></a>                                <span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span> <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">topic</span><span class="p">}],</span>
</span><span id="create_memory_tools-63"><a href="#create_memory_tools-63"><span class="linenos"> 63</span></a>                                <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">generate_uuid5</span><span class="p">(</span><span class="n">text</span><span class="p">)],</span>
</span><span id="create_memory_tools-64"><a href="#create_memory_tools-64"><span class="linenos"> 64</span></a>                            <span class="p">)</span>
</span><span id="create_memory_tools-65"><a href="#create_memory_tools-65"><span class="linenos"> 65</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="create_memory_tools-66"><a href="#create_memory_tools-66"><span class="linenos"> 66</span></a>                                <span class="s2">&quot;Stored interaction after recovery: </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
</span><span id="create_memory_tools-67"><a href="#create_memory_tools-67"><span class="linenos"> 67</span></a>                            <span class="p">)</span>
</span><span id="create_memory_tools-68"><a href="#create_memory_tools-68"><span class="linenos"> 68</span></a>                            <span class="k">return</span> <span class="s2">&quot;Interaction stored successfully after database recovery.&quot;</span>
</span><span id="create_memory_tools-69"><a href="#create_memory_tools-69"><span class="linenos"> 69</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">retry_error</span><span class="p">:</span>
</span><span id="create_memory_tools-70"><a href="#create_memory_tools-70"><span class="linenos"> 70</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="create_memory_tools-71"><a href="#create_memory_tools-71"><span class="linenos"> 71</span></a>                                <span class="s2">&quot;Failed to store after recovery: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">retry_error</span>
</span><span id="create_memory_tools-72"><a href="#create_memory_tools-72"><span class="linenos"> 72</span></a>                            <span class="p">)</span>
</span><span id="create_memory_tools-73"><a href="#create_memory_tools-73"><span class="linenos"> 73</span></a>                            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error storing interaction after recovery: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">retry_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="create_memory_tools-74"><a href="#create_memory_tools-74"><span class="linenos"> 74</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="create_memory_tools-75"><a href="#create_memory_tools-75"><span class="linenos"> 75</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Weaviate recovery failed&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-76"><a href="#create_memory_tools-76"><span class="linenos"> 76</span></a>                        <span class="k">return</span> <span class="s2">&quot;Database corruption detected, recovery failed.&quot;</span>
</span><span id="create_memory_tools-77"><a href="#create_memory_tools-77"><span class="linenos"> 77</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="create_memory_tools-78"><a href="#create_memory_tools-78"><span class="linenos"> 78</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not import recovery function&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-79"><a href="#create_memory_tools-79"><span class="linenos"> 79</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Database corruption detected: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="create_memory_tools-80"><a href="#create_memory_tools-80"><span class="linenos"> 80</span></a>
</span><span id="create_memory_tools-81"><a href="#create_memory_tools-81"><span class="linenos"> 81</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error storing interaction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="create_memory_tools-82"><a href="#create_memory_tools-82"><span class="linenos"> 82</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error storing interaction: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="create_memory_tools-83"><a href="#create_memory_tools-83"><span class="linenos"> 83</span></a>
</span><span id="create_memory_tools-84"><a href="#create_memory_tools-84"><span class="linenos"> 84</span></a>    <span class="nd">@tool</span>
</span><span id="create_memory_tools-85"><a href="#create_memory_tools-85"><span class="linenos"> 85</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query_knowledge_base</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="create_memory_tools-86"><a href="#create_memory_tools-86"><span class="linenos"> 86</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query Weaviate for relevant context.&quot;&quot;&quot;</span>
</span><span id="create_memory_tools-87"><a href="#create_memory_tools-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">USE_WEAVIATE</span> <span class="ow">or</span> <span class="n">vector_store_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="create_memory_tools-88"><a href="#create_memory_tools-88"><span class="linenos"> 88</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Weaviate is disabled, no context available.&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-89"><a href="#create_memory_tools-89"><span class="linenos"> 89</span></a>            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Weaviate is disabled, no context available.&quot;</span><span class="p">]</span>
</span><span id="create_memory_tools-90"><a href="#create_memory_tools-90"><span class="linenos"> 90</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="create_memory_tools-91"><a href="#create_memory_tools-91"><span class="linenos"> 91</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">vector_store_instance</span><span class="o">.</span><span class="n">similarity_search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span><span id="create_memory_tools-92"><a href="#create_memory_tools-92"><span class="linenos"> 92</span></a>            <span class="n">context_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="create_memory_tools-93"><a href="#create_memory_tools-93"><span class="linenos"> 93</span></a>            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="create_memory_tools-94"><a href="#create_memory_tools-94"><span class="linenos"> 94</span></a>                <span class="n">metadata</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="create_memory_tools-95"><a href="#create_memory_tools-95"><span class="linenos"> 95</span></a>                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-96"><a href="#create_memory_tools-96"><span class="linenos"> 96</span></a>                <span class="n">topic</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;topic&quot;</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-97"><a href="#create_memory_tools-97"><span class="linenos"> 97</span></a>                <span class="n">context_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] [</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-98"><a href="#create_memory_tools-98"><span class="linenos"> 98</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="create_memory_tools-99"><a href="#create_memory_tools-99"><span class="linenos"> 99</span></a>                <span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> relevant items for query: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">context_list</span><span class="p">),</span> <span class="n">query</span>
</span><span id="create_memory_tools-100"><a href="#create_memory_tools-100"><span class="linenos">100</span></a>            <span class="p">)</span>
</span><span id="create_memory_tools-101"><a href="#create_memory_tools-101"><span class="linenos">101</span></a>            <span class="k">return</span> <span class="n">context_list</span>
</span><span id="create_memory_tools-102"><a href="#create_memory_tools-102"><span class="linenos">102</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="create_memory_tools-103"><a href="#create_memory_tools-103"><span class="linenos">103</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="create_memory_tools-104"><a href="#create_memory_tools-104"><span class="linenos">104</span></a>
</span><span id="create_memory_tools-105"><a href="#create_memory_tools-105"><span class="linenos">105</span></a>            <span class="c1"># Check for corruption indicators and attempt recovery</span>
</span><span id="create_memory_tools-106"><a href="#create_memory_tools-106"><span class="linenos">106</span></a>            <span class="n">corruption_indicators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="create_memory_tools-107"><a href="#create_memory_tools-107"><span class="linenos">107</span></a>                <span class="s2">&quot;no such file or directory&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-108"><a href="#create_memory_tools-108"><span class="linenos">108</span></a>                <span class="s2">&quot;wal&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-109"><a href="#create_memory_tools-109"><span class="linenos">109</span></a>                <span class="s2">&quot;segment-&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-110"><a href="#create_memory_tools-110"><span class="linenos">110</span></a>                <span class="s2">&quot;commit log&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-111"><a href="#create_memory_tools-111"><span class="linenos">111</span></a>                <span class="s2">&quot;failed to send all objects&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-112"><a href="#create_memory_tools-112"><span class="linenos">112</span></a>                <span class="s2">&quot;weaviateinsertmanyallfailederror&quot;</span><span class="p">,</span>
</span><span id="create_memory_tools-113"><a href="#create_memory_tools-113"><span class="linenos">113</span></a>            <span class="p">]</span>
</span><span id="create_memory_tools-114"><a href="#create_memory_tools-114"><span class="linenos">114</span></a>
</span><span id="create_memory_tools-115"><a href="#create_memory_tools-115"><span class="linenos">115</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">indicator</span> <span class="ow">in</span> <span class="n">error_msg</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">corruption_indicators</span><span class="p">):</span>
</span><span id="create_memory_tools-116"><a href="#create_memory_tools-116"><span class="linenos">116</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Database corruption detected during query: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="create_memory_tools-117"><a href="#create_memory_tools-117"><span class="linenos">117</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="create_memory_tools-118"><a href="#create_memory_tools-118"><span class="linenos">118</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">..core.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">reset_weaviate_if_corrupted</span>
</span><span id="create_memory_tools-119"><a href="#create_memory_tools-119"><span class="linenos">119</span></a>
</span><span id="create_memory_tools-120"><a href="#create_memory_tools-120"><span class="linenos">120</span></a>                    <span class="k">if</span> <span class="n">reset_weaviate_if_corrupted</span><span class="p">():</span>
</span><span id="create_memory_tools-121"><a href="#create_memory_tools-121"><span class="linenos">121</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Weaviate recovery successful, retrying query...&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-122"><a href="#create_memory_tools-122"><span class="linenos">122</span></a>                        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Database was recovered, please retry your query.&quot;</span><span class="p">]</span>
</span><span id="create_memory_tools-123"><a href="#create_memory_tools-123"><span class="linenos">123</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="create_memory_tools-124"><a href="#create_memory_tools-124"><span class="linenos">124</span></a>                        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Database corruption detected, recovery failed.&quot;</span><span class="p">]</span>
</span><span id="create_memory_tools-125"><a href="#create_memory_tools-125"><span class="linenos">125</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="create_memory_tools-126"><a href="#create_memory_tools-126"><span class="linenos">126</span></a>                    <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Database corruption detected: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="create_memory_tools-127"><a href="#create_memory_tools-127"><span class="linenos">127</span></a>
</span><span id="create_memory_tools-128"><a href="#create_memory_tools-128"><span class="linenos">128</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error querying knowledge base: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="create_memory_tools-129"><a href="#create_memory_tools-129"><span class="linenos">129</span></a>            <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Error querying knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="create_memory_tools-130"><a href="#create_memory_tools-130"><span class="linenos">130</span></a>
</span><span id="create_memory_tools-131"><a href="#create_memory_tools-131"><span class="linenos">131</span></a>    <span class="nd">@tool</span>
</span><span id="create_memory_tools-132"><a href="#create_memory_tools-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_knowledge_base</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="create_memory_tools-133"><a href="#create_memory_tools-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all data from Weaviate.&quot;&quot;&quot;</span>
</span><span id="create_memory_tools-134"><a href="#create_memory_tools-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">USE_WEAVIATE</span> <span class="ow">or</span> <span class="n">weaviate_client_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="create_memory_tools-135"><a href="#create_memory_tools-135"><span class="linenos">135</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Weaviate is disabled, cannot clear.&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-136"><a href="#create_memory_tools-136"><span class="linenos">136</span></a>            <span class="k">return</span> <span class="s2">&quot;Weaviate is disabled, cannot clear.&quot;</span>
</span><span id="create_memory_tools-137"><a href="#create_memory_tools-137"><span class="linenos">137</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="create_memory_tools-138"><a href="#create_memory_tools-138"><span class="linenos">138</span></a>            <span class="n">collection_name</span> <span class="o">=</span> <span class="s2">&quot;UserKnowledgeBase&quot;</span>
</span><span id="create_memory_tools-139"><a href="#create_memory_tools-139"><span class="linenos">139</span></a>            <span class="k">if</span> <span class="n">weaviate_client_instance</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
</span><span id="create_memory_tools-140"><a href="#create_memory_tools-140"><span class="linenos">140</span></a>                <span class="n">collection</span> <span class="o">=</span> <span class="n">weaviate_client_instance</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
</span><span id="create_memory_tools-141"><a href="#create_memory_tools-141"><span class="linenos">141</span></a>                <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>
</span><span id="create_memory_tools-142"><a href="#create_memory_tools-142"><span class="linenos">142</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleared all data from Weaviate&quot;</span><span class="p">)</span>
</span><span id="create_memory_tools-143"><a href="#create_memory_tools-143"><span class="linenos">143</span></a>                <span class="k">return</span> <span class="s2">&quot;Successfully cleared all data from knowledge base.&quot;</span>
</span><span id="create_memory_tools-144"><a href="#create_memory_tools-144"><span class="linenos">144</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="create_memory_tools-145"><a href="#create_memory_tools-145"><span class="linenos">145</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Collection </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">)</span>
</span><span id="create_memory_tools-146"><a href="#create_memory_tools-146"><span class="linenos">146</span></a>                <span class="k">return</span> <span class="s2">&quot;Collection does not exist.&quot;</span>
</span><span id="create_memory_tools-147"><a href="#create_memory_tools-147"><span class="linenos">147</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="create_memory_tools-148"><a href="#create_memory_tools-148"><span class="linenos">148</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error clearing knowledge base: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="create_memory_tools-149"><a href="#create_memory_tools-149"><span class="linenos">149</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error clearing knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="create_memory_tools-150"><a href="#create_memory_tools-150"><span class="linenos">150</span></a>
</span><span id="create_memory_tools-151"><a href="#create_memory_tools-151"><span class="linenos">151</span></a>    <span class="k">return</span> <span class="p">[</span><span class="n">store_interaction</span><span class="p">,</span> <span class="n">query_knowledge_base</span><span class="p">,</span> <span class="n">clear_knowledge_base</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Create memory tools with injected dependencies.</p>
</div>


                </section>
                <section id="KnowledgeIngestionTools">
                            <input id="KnowledgeIngestionTools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KnowledgeIngestionTools</span><wbr>(<span class="base">agno.tools.toolkit.Toolkit</span>):

                <label class="view-source-button" for="KnowledgeIngestionTools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeIngestionTools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeIngestionTools-31"><a href="#KnowledgeIngestionTools-31"><span class="linenos"> 31</span></a><span class="k">class</span><span class="w"> </span><span class="nc">KnowledgeIngestionTools</span><span class="p">(</span><span class="n">Toolkit</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-32"><a href="#KnowledgeIngestionTools-32"><span class="linenos"> 32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools-33"><a href="#KnowledgeIngestionTools-33"><span class="linenos"> 33</span></a><span class="sd">    Knowledge ingestion tools for adding files and content to the knowledge base.</span>
</span><span id="KnowledgeIngestionTools-34"><a href="#KnowledgeIngestionTools-34"><span class="linenos"> 34</span></a>
</span><span id="KnowledgeIngestionTools-35"><a href="#KnowledgeIngestionTools-35"><span class="linenos"> 35</span></a><span class="sd">    Args:</span>
</span><span id="KnowledgeIngestionTools-36"><a href="#KnowledgeIngestionTools-36"><span class="linenos"> 36</span></a><span class="sd">        ingest_file (bool): Enable file ingestion functionality.</span>
</span><span id="KnowledgeIngestionTools-37"><a href="#KnowledgeIngestionTools-37"><span class="linenos"> 37</span></a><span class="sd">        ingest_text (bool): Enable direct text ingestion functionality.</span>
</span><span id="KnowledgeIngestionTools-38"><a href="#KnowledgeIngestionTools-38"><span class="linenos"> 38</span></a><span class="sd">        ingest_url (bool): Enable URL content ingestion functionality.</span>
</span><span id="KnowledgeIngestionTools-39"><a href="#KnowledgeIngestionTools-39"><span class="linenos"> 39</span></a><span class="sd">        batch_ingest (bool): Enable batch directory ingestion functionality.</span>
</span><span id="KnowledgeIngestionTools-40"><a href="#KnowledgeIngestionTools-40"><span class="linenos"> 40</span></a><span class="sd">        query_knowledge (bool): Enable unified knowledge querying functionality.</span>
</span><span id="KnowledgeIngestionTools-41"><a href="#KnowledgeIngestionTools-41"><span class="linenos"> 41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools-42"><a href="#KnowledgeIngestionTools-42"><span class="linenos"> 42</span></a>
</span><span id="KnowledgeIngestionTools-43"><a href="#KnowledgeIngestionTools-43"><span class="linenos"> 43</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-44"><a href="#KnowledgeIngestionTools-44"><span class="linenos"> 44</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-45"><a href="#KnowledgeIngestionTools-45"><span class="linenos"> 45</span></a>        <span class="n">ingest_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-46"><a href="#KnowledgeIngestionTools-46"><span class="linenos"> 46</span></a>        <span class="n">ingest_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-47"><a href="#KnowledgeIngestionTools-47"><span class="linenos"> 47</span></a>        <span class="n">ingest_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-48"><a href="#KnowledgeIngestionTools-48"><span class="linenos"> 48</span></a>        <span class="n">batch_ingest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-49"><a href="#KnowledgeIngestionTools-49"><span class="linenos"> 49</span></a>        <span class="n">query_knowledge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-50"><a href="#KnowledgeIngestionTools-50"><span class="linenos"> 50</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-51"><a href="#KnowledgeIngestionTools-51"><span class="linenos"> 51</span></a>    <span class="p">):</span>
</span><span id="KnowledgeIngestionTools-52"><a href="#KnowledgeIngestionTools-52"><span class="linenos"> 52</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KnowledgeIngestionTools-53"><a href="#KnowledgeIngestionTools-53"><span class="linenos"> 53</span></a>
</span><span id="KnowledgeIngestionTools-54"><a href="#KnowledgeIngestionTools-54"><span class="linenos"> 54</span></a>        <span class="k">if</span> <span class="n">ingest_file</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-55"><a href="#KnowledgeIngestionTools-55"><span class="linenos"> 55</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_file</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-56"><a href="#KnowledgeIngestionTools-56"><span class="linenos"> 56</span></a>        <span class="k">if</span> <span class="n">ingest_text</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-57"><a href="#KnowledgeIngestionTools-57"><span class="linenos"> 57</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_text</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-58"><a href="#KnowledgeIngestionTools-58"><span class="linenos"> 58</span></a>        <span class="k">if</span> <span class="n">ingest_url</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-59"><a href="#KnowledgeIngestionTools-59"><span class="linenos"> 59</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_from_url</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-60"><a href="#KnowledgeIngestionTools-60"><span class="linenos"> 60</span></a>        <span class="k">if</span> <span class="n">batch_ingest</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-61"><a href="#KnowledgeIngestionTools-61"><span class="linenos"> 61</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_ingest_directory</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-62"><a href="#KnowledgeIngestionTools-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="n">query_knowledge</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-63"><a href="#KnowledgeIngestionTools-63"><span class="linenos"> 63</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_knowledge_base</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-64"><a href="#KnowledgeIngestionTools-64"><span class="linenos"> 64</span></a>
</span><span id="KnowledgeIngestionTools-65"><a href="#KnowledgeIngestionTools-65"><span class="linenos"> 65</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;knowledge_ingestion&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-66"><a href="#KnowledgeIngestionTools-66"><span class="linenos"> 66</span></a>
</span><span id="KnowledgeIngestionTools-67"><a href="#KnowledgeIngestionTools-67"><span class="linenos"> 67</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-68"><a href="#KnowledgeIngestionTools-68"><span class="linenos"> 68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest a file into the knowledge base.</span>
</span><span id="KnowledgeIngestionTools-69"><a href="#KnowledgeIngestionTools-69"><span class="linenos"> 69</span></a>
</span><span id="KnowledgeIngestionTools-70"><a href="#KnowledgeIngestionTools-70"><span class="linenos"> 70</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools-71"><a href="#KnowledgeIngestionTools-71"><span class="linenos"> 71</span></a><span class="sd">            file_path: Path to the file to ingest</span>
</span><span id="KnowledgeIngestionTools-72"><a href="#KnowledgeIngestionTools-72"><span class="linenos"> 72</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to filename)</span>
</span><span id="KnowledgeIngestionTools-73"><a href="#KnowledgeIngestionTools-73"><span class="linenos"> 73</span></a>
</span><span id="KnowledgeIngestionTools-74"><a href="#KnowledgeIngestionTools-74"><span class="linenos"> 74</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools-75"><a href="#KnowledgeIngestionTools-75"><span class="linenos"> 75</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeIngestionTools-76"><a href="#KnowledgeIngestionTools-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools-77"><a href="#KnowledgeIngestionTools-77"><span class="linenos"> 77</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-78"><a href="#KnowledgeIngestionTools-78"><span class="linenos"> 78</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="KnowledgeIngestionTools-79"><a href="#KnowledgeIngestionTools-79"><span class="linenos"> 79</span></a>            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-80"><a href="#KnowledgeIngestionTools-80"><span class="linenos"> 80</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-81"><a href="#KnowledgeIngestionTools-81"><span class="linenos"> 81</span></a>            <span class="k">elif</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-82"><a href="#KnowledgeIngestionTools-82"><span class="linenos"> 82</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-83"><a href="#KnowledgeIngestionTools-83"><span class="linenos"> 83</span></a>
</span><span id="KnowledgeIngestionTools-84"><a href="#KnowledgeIngestionTools-84"><span class="linenos"> 84</span></a>            <span class="c1"># Validate file exists</span>
</span><span id="KnowledgeIngestionTools-85"><a href="#KnowledgeIngestionTools-85"><span class="linenos"> 85</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-86"><a href="#KnowledgeIngestionTools-86"><span class="linenos"> 86</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File not found at &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeIngestionTools-87"><a href="#KnowledgeIngestionTools-87"><span class="linenos"> 87</span></a>
</span><span id="KnowledgeIngestionTools-88"><a href="#KnowledgeIngestionTools-88"><span class="linenos"> 88</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-89"><a href="#KnowledgeIngestionTools-89"><span class="linenos"> 89</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; is not a file&quot;</span>
</span><span id="KnowledgeIngestionTools-90"><a href="#KnowledgeIngestionTools-90"><span class="linenos"> 90</span></a>
</span><span id="KnowledgeIngestionTools-91"><a href="#KnowledgeIngestionTools-91"><span class="linenos"> 91</span></a>            <span class="c1"># Get file info</span>
</span><span id="KnowledgeIngestionTools-92"><a href="#KnowledgeIngestionTools-92"><span class="linenos"> 92</span></a>            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-93"><a href="#KnowledgeIngestionTools-93"><span class="linenos"> 93</span></a>            <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 50MB limit</span>
</span><span id="KnowledgeIngestionTools-94"><a href="#KnowledgeIngestionTools-94"><span class="linenos"> 94</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File too large (</span><span class="si">{</span><span class="n">file_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB). Maximum size is 50MB.&quot;</span>
</span><span id="KnowledgeIngestionTools-95"><a href="#KnowledgeIngestionTools-95"><span class="linenos"> 95</span></a>
</span><span id="KnowledgeIngestionTools-96"><a href="#KnowledgeIngestionTools-96"><span class="linenos"> 96</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-97"><a href="#KnowledgeIngestionTools-97"><span class="linenos"> 97</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-98"><a href="#KnowledgeIngestionTools-98"><span class="linenos"> 98</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools-99"><a href="#KnowledgeIngestionTools-99"><span class="linenos"> 99</span></a>
</span><span id="KnowledgeIngestionTools-100"><a href="#KnowledgeIngestionTools-100"><span class="linenos">100</span></a>            <span class="c1"># Check file type</span>
</span><span id="KnowledgeIngestionTools-101"><a href="#KnowledgeIngestionTools-101"><span class="linenos">101</span></a>            <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-102"><a href="#KnowledgeIngestionTools-102"><span class="linenos">102</span></a>            <span class="n">supported_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeIngestionTools-103"><a href="#KnowledgeIngestionTools-103"><span class="linenos">103</span></a>                <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-104"><a href="#KnowledgeIngestionTools-104"><span class="linenos">104</span></a>                <span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-105"><a href="#KnowledgeIngestionTools-105"><span class="linenos">105</span></a>                <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-106"><a href="#KnowledgeIngestionTools-106"><span class="linenos">106</span></a>                <span class="s2">&quot;text/csv&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-107"><a href="#KnowledgeIngestionTools-107"><span class="linenos">107</span></a>                <span class="s2">&quot;application/pdf&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-108"><a href="#KnowledgeIngestionTools-108"><span class="linenos">108</span></a>                <span class="s2">&quot;application/msword&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-109"><a href="#KnowledgeIngestionTools-109"><span class="linenos">109</span></a>                <span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-110"><a href="#KnowledgeIngestionTools-110"><span class="linenos">110</span></a>            <span class="p">]</span>
</span><span id="KnowledgeIngestionTools-111"><a href="#KnowledgeIngestionTools-111"><span class="linenos">111</span></a>
</span><span id="KnowledgeIngestionTools-112"><a href="#KnowledgeIngestionTools-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="n">mime_type</span> <span class="ow">and</span> <span class="n">mime_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_types</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-113"><a href="#KnowledgeIngestionTools-113"><span class="linenos">113</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File type </span><span class="si">{</span><span class="n">mime_type</span><span class="si">}</span><span class="s2"> may not be fully supported&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-114"><a href="#KnowledgeIngestionTools-114"><span class="linenos">114</span></a>
</span><span id="KnowledgeIngestionTools-115"><a href="#KnowledgeIngestionTools-115"><span class="linenos">115</span></a>            <span class="c1"># Copy file to knowledge directory</span>
</span><span id="KnowledgeIngestionTools-116"><a href="#KnowledgeIngestionTools-116"><span class="linenos">116</span></a>            <span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-117"><a href="#KnowledgeIngestionTools-117"><span class="linenos">117</span></a>            <span class="n">knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-118"><a href="#KnowledgeIngestionTools-118"><span class="linenos">118</span></a>
</span><span id="KnowledgeIngestionTools-119"><a href="#KnowledgeIngestionTools-119"><span class="linenos">119</span></a>            <span class="c1"># Create unique filename to avoid conflicts</span>
</span><span id="KnowledgeIngestionTools-120"><a href="#KnowledgeIngestionTools-120"><span class="linenos">120</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="KnowledgeIngestionTools-121"><a href="#KnowledgeIngestionTools-121"><span class="linenos">121</span></a>            <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools-122"><a href="#KnowledgeIngestionTools-122"><span class="linenos">122</span></a>            <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-123"><a href="#KnowledgeIngestionTools-123"><span class="linenos">123</span></a>            <span class="n">unique_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-124"><a href="#KnowledgeIngestionTools-124"><span class="linenos">124</span></a>
</span><span id="KnowledgeIngestionTools-125"><a href="#KnowledgeIngestionTools-125"><span class="linenos">125</span></a>            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">knowledge_dir</span> <span class="o">/</span> <span class="n">unique_filename</span>
</span><span id="KnowledgeIngestionTools-126"><a href="#KnowledgeIngestionTools-126"><span class="linenos">126</span></a>
</span><span id="KnowledgeIngestionTools-127"><a href="#KnowledgeIngestionTools-127"><span class="linenos">127</span></a>            <span class="c1"># Copy the file</span>
</span><span id="KnowledgeIngestionTools-128"><a href="#KnowledgeIngestionTools-128"><span class="linenos">128</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-129"><a href="#KnowledgeIngestionTools-129"><span class="linenos">129</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied file to knowledge directory: </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-130"><a href="#KnowledgeIngestionTools-130"><span class="linenos">130</span></a>
</span><span id="KnowledgeIngestionTools-131"><a href="#KnowledgeIngestionTools-131"><span class="linenos">131</span></a>            <span class="c1"># Upload to LightRAG server</span>
</span><span id="KnowledgeIngestionTools-132"><a href="#KnowledgeIngestionTools-132"><span class="linenos">132</span></a>            <span class="n">upload_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-133"><a href="#KnowledgeIngestionTools-133"><span class="linenos">133</span></a>                <span class="n">dest_path</span><span class="p">,</span> <span class="n">unique_filename</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeIngestionTools-134"><a href="#KnowledgeIngestionTools-134"><span class="linenos">134</span></a>            <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-135"><a href="#KnowledgeIngestionTools-135"><span class="linenos">135</span></a>
</span><span id="KnowledgeIngestionTools-136"><a href="#KnowledgeIngestionTools-136"><span class="linenos">136</span></a>            <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-137"><a href="#KnowledgeIngestionTools-137"><span class="linenos">137</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested knowledge file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-138"><a href="#KnowledgeIngestionTools-138"><span class="linenos">138</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; into knowledge base. </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-139"><a href="#KnowledgeIngestionTools-139"><span class="linenos">139</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-140"><a href="#KnowledgeIngestionTools-140"><span class="linenos">140</span></a>                <span class="c1"># Clean up the copied file if upload failed</span>
</span><span id="KnowledgeIngestionTools-141"><a href="#KnowledgeIngestionTools-141"><span class="linenos">141</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-142"><a href="#KnowledgeIngestionTools-142"><span class="linenos">142</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-143"><a href="#KnowledgeIngestionTools-143"><span class="linenos">143</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-144"><a href="#KnowledgeIngestionTools-144"><span class="linenos">144</span></a>                    <span class="k">pass</span>
</span><span id="KnowledgeIngestionTools-145"><a href="#KnowledgeIngestionTools-145"><span class="linenos">145</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-146"><a href="#KnowledgeIngestionTools-146"><span class="linenos">146</span></a>
</span><span id="KnowledgeIngestionTools-147"><a href="#KnowledgeIngestionTools-147"><span class="linenos">147</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-148"><a href="#KnowledgeIngestionTools-148"><span class="linenos">148</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-149"><a href="#KnowledgeIngestionTools-149"><span class="linenos">149</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-150"><a href="#KnowledgeIngestionTools-150"><span class="linenos">150</span></a>
</span><span id="KnowledgeIngestionTools-151"><a href="#KnowledgeIngestionTools-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_text</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-152"><a href="#KnowledgeIngestionTools-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</span><span id="KnowledgeIngestionTools-153"><a href="#KnowledgeIngestionTools-153"><span class="linenos">153</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-154"><a href="#KnowledgeIngestionTools-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest text content directly into the knowledge base.</span>
</span><span id="KnowledgeIngestionTools-155"><a href="#KnowledgeIngestionTools-155"><span class="linenos">155</span></a>
</span><span id="KnowledgeIngestionTools-156"><a href="#KnowledgeIngestionTools-156"><span class="linenos">156</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools-157"><a href="#KnowledgeIngestionTools-157"><span class="linenos">157</span></a><span class="sd">            content: The text content to ingest</span>
</span><span id="KnowledgeIngestionTools-158"><a href="#KnowledgeIngestionTools-158"><span class="linenos">158</span></a><span class="sd">            title: Title for the knowledge entry</span>
</span><span id="KnowledgeIngestionTools-159"><a href="#KnowledgeIngestionTools-159"><span class="linenos">159</span></a><span class="sd">            file_type: File extension to use (txt, md, html, etc.)</span>
</span><span id="KnowledgeIngestionTools-160"><a href="#KnowledgeIngestionTools-160"><span class="linenos">160</span></a>
</span><span id="KnowledgeIngestionTools-161"><a href="#KnowledgeIngestionTools-161"><span class="linenos">161</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools-162"><a href="#KnowledgeIngestionTools-162"><span class="linenos">162</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeIngestionTools-163"><a href="#KnowledgeIngestionTools-163"><span class="linenos">163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools-164"><a href="#KnowledgeIngestionTools-164"><span class="linenos">164</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-165"><a href="#KnowledgeIngestionTools-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeIngestionTools-166"><a href="#KnowledgeIngestionTools-166"><span class="linenos">166</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Content cannot be empty&quot;</span>
</span><span id="KnowledgeIngestionTools-167"><a href="#KnowledgeIngestionTools-167"><span class="linenos">167</span></a>
</span><span id="KnowledgeIngestionTools-168"><a href="#KnowledgeIngestionTools-168"><span class="linenos">168</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeIngestionTools-169"><a href="#KnowledgeIngestionTools-169"><span class="linenos">169</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Title is required&quot;</span>
</span><span id="KnowledgeIngestionTools-170"><a href="#KnowledgeIngestionTools-170"><span class="linenos">170</span></a>
</span><span id="KnowledgeIngestionTools-171"><a href="#KnowledgeIngestionTools-171"><span class="linenos">171</span></a>            <span class="c1"># Validate file_type</span>
</span><span id="KnowledgeIngestionTools-172"><a href="#KnowledgeIngestionTools-172"><span class="linenos">172</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-173"><a href="#KnowledgeIngestionTools-173"><span class="linenos">173</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-174"><a href="#KnowledgeIngestionTools-174"><span class="linenos">174</span></a>
</span><span id="KnowledgeIngestionTools-175"><a href="#KnowledgeIngestionTools-175"><span class="linenos">175</span></a>            <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;.md&quot;</span><span class="p">,</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools-176"><a href="#KnowledgeIngestionTools-176"><span class="linenos">176</span></a>            <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-177"><a href="#KnowledgeIngestionTools-177"><span class="linenos">177</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;.txt&quot;</span>  <span class="c1"># Default to txt</span>
</span><span id="KnowledgeIngestionTools-178"><a href="#KnowledgeIngestionTools-178"><span class="linenos">178</span></a>
</span><span id="KnowledgeIngestionTools-179"><a href="#KnowledgeIngestionTools-179"><span class="linenos">179</span></a>            <span class="c1"># Create knowledge directory</span>
</span><span id="KnowledgeIngestionTools-180"><a href="#KnowledgeIngestionTools-180"><span class="linenos">180</span></a>            <span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-181"><a href="#KnowledgeIngestionTools-181"><span class="linenos">181</span></a>            <span class="n">knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-182"><a href="#KnowledgeIngestionTools-182"><span class="linenos">182</span></a>
</span><span id="KnowledgeIngestionTools-183"><a href="#KnowledgeIngestionTools-183"><span class="linenos">183</span></a>            <span class="c1"># Create unique filename</span>
</span><span id="KnowledgeIngestionTools-184"><a href="#KnowledgeIngestionTools-184"><span class="linenos">184</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="KnowledgeIngestionTools-185"><a href="#KnowledgeIngestionTools-185"><span class="linenos">185</span></a>            <span class="n">content_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-186"><a href="#KnowledgeIngestionTools-186"><span class="linenos">186</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-187"><a href="#KnowledgeIngestionTools-187"><span class="linenos">187</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools-188"><a href="#KnowledgeIngestionTools-188"><span class="linenos">188</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-189"><a href="#KnowledgeIngestionTools-189"><span class="linenos">189</span></a>                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">title</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-190"><a href="#KnowledgeIngestionTools-190"><span class="linenos">190</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-191"><a href="#KnowledgeIngestionTools-191"><span class="linenos">191</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="n">safe_title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>  <span class="c1"># Limit length</span>
</span><span id="KnowledgeIngestionTools-192"><a href="#KnowledgeIngestionTools-192"><span class="linenos">192</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content_hash</span><span class="si">}{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-193"><a href="#KnowledgeIngestionTools-193"><span class="linenos">193</span></a>
</span><span id="KnowledgeIngestionTools-194"><a href="#KnowledgeIngestionTools-194"><span class="linenos">194</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">knowledge_dir</span> <span class="o">/</span> <span class="n">filename</span>
</span><span id="KnowledgeIngestionTools-195"><a href="#KnowledgeIngestionTools-195"><span class="linenos">195</span></a>
</span><span id="KnowledgeIngestionTools-196"><a href="#KnowledgeIngestionTools-196"><span class="linenos">196</span></a>            <span class="c1"># Write content to file</span>
</span><span id="KnowledgeIngestionTools-197"><a href="#KnowledgeIngestionTools-197"><span class="linenos">197</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-198"><a href="#KnowledgeIngestionTools-198"><span class="linenos">198</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-199"><a href="#KnowledgeIngestionTools-199"><span class="linenos">199</span></a>
</span><span id="KnowledgeIngestionTools-200"><a href="#KnowledgeIngestionTools-200"><span class="linenos">200</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created knowledge file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-201"><a href="#KnowledgeIngestionTools-201"><span class="linenos">201</span></a>
</span><span id="KnowledgeIngestionTools-202"><a href="#KnowledgeIngestionTools-202"><span class="linenos">202</span></a>            <span class="c1"># Upload to LightRAG server</span>
</span><span id="KnowledgeIngestionTools-203"><a href="#KnowledgeIngestionTools-203"><span class="linenos">203</span></a>            <span class="n">upload_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-204"><a href="#KnowledgeIngestionTools-204"><span class="linenos">204</span></a>                <span class="n">file_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeIngestionTools-205"><a href="#KnowledgeIngestionTools-205"><span class="linenos">205</span></a>            <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-206"><a href="#KnowledgeIngestionTools-206"><span class="linenos">206</span></a>
</span><span id="KnowledgeIngestionTools-207"><a href="#KnowledgeIngestionTools-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-208"><a href="#KnowledgeIngestionTools-208"><span class="linenos">208</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested knowledge text: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-209"><a href="#KnowledgeIngestionTools-209"><span class="linenos">209</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39; into knowledge base. </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-210"><a href="#KnowledgeIngestionTools-210"><span class="linenos">210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-211"><a href="#KnowledgeIngestionTools-211"><span class="linenos">211</span></a>                <span class="c1"># Clean up the created file if upload failed</span>
</span><span id="KnowledgeIngestionTools-212"><a href="#KnowledgeIngestionTools-212"><span class="linenos">212</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-213"><a href="#KnowledgeIngestionTools-213"><span class="linenos">213</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-214"><a href="#KnowledgeIngestionTools-214"><span class="linenos">214</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-215"><a href="#KnowledgeIngestionTools-215"><span class="linenos">215</span></a>                    <span class="k">pass</span>
</span><span id="KnowledgeIngestionTools-216"><a href="#KnowledgeIngestionTools-216"><span class="linenos">216</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-217"><a href="#KnowledgeIngestionTools-217"><span class="linenos">217</span></a>
</span><span id="KnowledgeIngestionTools-218"><a href="#KnowledgeIngestionTools-218"><span class="linenos">218</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-219"><a href="#KnowledgeIngestionTools-219"><span class="linenos">219</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting text content: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-220"><a href="#KnowledgeIngestionTools-220"><span class="linenos">220</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting text content: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-221"><a href="#KnowledgeIngestionTools-221"><span class="linenos">221</span></a>
</span><span id="KnowledgeIngestionTools-222"><a href="#KnowledgeIngestionTools-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-223"><a href="#KnowledgeIngestionTools-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest content from a URL into the knowledge base.</span>
</span><span id="KnowledgeIngestionTools-224"><a href="#KnowledgeIngestionTools-224"><span class="linenos">224</span></a>
</span><span id="KnowledgeIngestionTools-225"><a href="#KnowledgeIngestionTools-225"><span class="linenos">225</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools-226"><a href="#KnowledgeIngestionTools-226"><span class="linenos">226</span></a><span class="sd">            url: URL to fetch content from</span>
</span><span id="KnowledgeIngestionTools-227"><a href="#KnowledgeIngestionTools-227"><span class="linenos">227</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to page title or URL)</span>
</span><span id="KnowledgeIngestionTools-228"><a href="#KnowledgeIngestionTools-228"><span class="linenos">228</span></a>
</span><span id="KnowledgeIngestionTools-229"><a href="#KnowledgeIngestionTools-229"><span class="linenos">229</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools-230"><a href="#KnowledgeIngestionTools-230"><span class="linenos">230</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeIngestionTools-231"><a href="#KnowledgeIngestionTools-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools-232"><a href="#KnowledgeIngestionTools-232"><span class="linenos">232</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-233"><a href="#KnowledgeIngestionTools-233"><span class="linenos">233</span></a>            <span class="c1"># Validate URL</span>
</span><span id="KnowledgeIngestionTools-234"><a href="#KnowledgeIngestionTools-234"><span class="linenos">234</span></a>            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-235"><a href="#KnowledgeIngestionTools-235"><span class="linenos">235</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-236"><a href="#KnowledgeIngestionTools-236"><span class="linenos">236</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Invalid URL format: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-237"><a href="#KnowledgeIngestionTools-237"><span class="linenos">237</span></a>
</span><span id="KnowledgeIngestionTools-238"><a href="#KnowledgeIngestionTools-238"><span class="linenos">238</span></a>            <span class="c1"># Fetch content</span>
</span><span id="KnowledgeIngestionTools-239"><a href="#KnowledgeIngestionTools-239"><span class="linenos">239</span></a>            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KnowledgeIngestionTools-240"><a href="#KnowledgeIngestionTools-240"><span class="linenos">240</span></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36&quot;</span>
</span><span id="KnowledgeIngestionTools-241"><a href="#KnowledgeIngestionTools-241"><span class="linenos">241</span></a>            <span class="p">}</span>
</span><span id="KnowledgeIngestionTools-242"><a href="#KnowledgeIngestionTools-242"><span class="linenos">242</span></a>
</span><span id="KnowledgeIngestionTools-243"><a href="#KnowledgeIngestionTools-243"><span class="linenos">243</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-244"><a href="#KnowledgeIngestionTools-244"><span class="linenos">244</span></a>            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-245"><a href="#KnowledgeIngestionTools-245"><span class="linenos">245</span></a>
</span><span id="KnowledgeIngestionTools-246"><a href="#KnowledgeIngestionTools-246"><span class="linenos">246</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-247"><a href="#KnowledgeIngestionTools-247"><span class="linenos">247</span></a>
</span><span id="KnowledgeIngestionTools-248"><a href="#KnowledgeIngestionTools-248"><span class="linenos">248</span></a>            <span class="c1"># Handle different content types</span>
</span><span id="KnowledgeIngestionTools-249"><a href="#KnowledgeIngestionTools-249"><span class="linenos">249</span></a>            <span class="k">if</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-250"><a href="#KnowledgeIngestionTools-250"><span class="linenos">250</span></a>                <span class="c1"># For HTML, try to extract text content</span>
</span><span id="KnowledgeIngestionTools-251"><a href="#KnowledgeIngestionTools-251"><span class="linenos">251</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-252"><a href="#KnowledgeIngestionTools-252"><span class="linenos">252</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span id="KnowledgeIngestionTools-253"><a href="#KnowledgeIngestionTools-253"><span class="linenos">253</span></a>
</span><span id="KnowledgeIngestionTools-254"><a href="#KnowledgeIngestionTools-254"><span class="linenos">254</span></a>                    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-255"><a href="#KnowledgeIngestionTools-255"><span class="linenos">255</span></a>
</span><span id="KnowledgeIngestionTools-256"><a href="#KnowledgeIngestionTools-256"><span class="linenos">256</span></a>                    <span class="c1"># Remove script and style elements</span>
</span><span id="KnowledgeIngestionTools-257"><a href="#KnowledgeIngestionTools-257"><span class="linenos">257</span></a>                    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
</span><span id="KnowledgeIngestionTools-258"><a href="#KnowledgeIngestionTools-258"><span class="linenos">258</span></a>                        <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-259"><a href="#KnowledgeIngestionTools-259"><span class="linenos">259</span></a>
</span><span id="KnowledgeIngestionTools-260"><a href="#KnowledgeIngestionTools-260"><span class="linenos">260</span></a>                    <span class="c1"># Get text content</span>
</span><span id="KnowledgeIngestionTools-261"><a href="#KnowledgeIngestionTools-261"><span class="linenos">261</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-262"><a href="#KnowledgeIngestionTools-262"><span class="linenos">262</span></a>
</span><span id="KnowledgeIngestionTools-263"><a href="#KnowledgeIngestionTools-263"><span class="linenos">263</span></a>                    <span class="c1"># Get title if not provided</span>
</span><span id="KnowledgeIngestionTools-264"><a href="#KnowledgeIngestionTools-264"><span class="linenos">264</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-265"><a href="#KnowledgeIngestionTools-265"><span class="linenos">265</span></a>                        <span class="n">title_tag</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-266"><a href="#KnowledgeIngestionTools-266"><span class="linenos">266</span></a>                        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="KnowledgeIngestionTools-267"><a href="#KnowledgeIngestionTools-267"><span class="linenos">267</span></a>                            <span class="n">title_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-268"><a href="#KnowledgeIngestionTools-268"><span class="linenos">268</span></a>                            <span class="k">if</span> <span class="n">title_tag</span>
</span><span id="KnowledgeIngestionTools-269"><a href="#KnowledgeIngestionTools-269"><span class="linenos">269</span></a>                            <span class="k">else</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeIngestionTools-270"><a href="#KnowledgeIngestionTools-270"><span class="linenos">270</span></a>                        <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-271"><a href="#KnowledgeIngestionTools-271"><span class="linenos">271</span></a>
</span><span id="KnowledgeIngestionTools-272"><a href="#KnowledgeIngestionTools-272"><span class="linenos">272</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="KnowledgeIngestionTools-273"><a href="#KnowledgeIngestionTools-273"><span class="linenos">273</span></a>
</span><span id="KnowledgeIngestionTools-274"><a href="#KnowledgeIngestionTools-274"><span class="linenos">274</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-275"><a href="#KnowledgeIngestionTools-275"><span class="linenos">275</span></a>                    <span class="c1"># Fallback if BeautifulSoup not available</span>
</span><span id="KnowledgeIngestionTools-276"><a href="#KnowledgeIngestionTools-276"><span class="linenos">276</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeIngestionTools-277"><a href="#KnowledgeIngestionTools-277"><span class="linenos">277</span></a>                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeIngestionTools-278"><a href="#KnowledgeIngestionTools-278"><span class="linenos">278</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="KnowledgeIngestionTools-279"><a href="#KnowledgeIngestionTools-279"><span class="linenos">279</span></a>
</span><span id="KnowledgeIngestionTools-280"><a href="#KnowledgeIngestionTools-280"><span class="linenos">280</span></a>            <span class="k">elif</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/json&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-281"><a href="#KnowledgeIngestionTools-281"><span class="linenos">281</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeIngestionTools-282"><a href="#KnowledgeIngestionTools-282"><span class="linenos">282</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeIngestionTools-283"><a href="#KnowledgeIngestionTools-283"><span class="linenos">283</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span> <span class="k">if</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="k">else</span> <span class="s2">&quot;json&quot;</span>
</span><span id="KnowledgeIngestionTools-284"><a href="#KnowledgeIngestionTools-284"><span class="linenos">284</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-285"><a href="#KnowledgeIngestionTools-285"><span class="linenos">285</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Unsupported content type: </span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-286"><a href="#KnowledgeIngestionTools-286"><span class="linenos">286</span></a>
</span><span id="KnowledgeIngestionTools-287"><a href="#KnowledgeIngestionTools-287"><span class="linenos">287</span></a>            <span class="c1"># Clean up content</span>
</span><span id="KnowledgeIngestionTools-288"><a href="#KnowledgeIngestionTools-288"><span class="linenos">288</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-289"><a href="#KnowledgeIngestionTools-289"><span class="linenos">289</span></a>                <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-290"><a href="#KnowledgeIngestionTools-290"><span class="linenos">290</span></a>            <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-291"><a href="#KnowledgeIngestionTools-291"><span class="linenos">291</span></a>
</span><span id="KnowledgeIngestionTools-292"><a href="#KnowledgeIngestionTools-292"><span class="linenos">292</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-293"><a href="#KnowledgeIngestionTools-293"><span class="linenos">293</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: No content extracted from URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-294"><a href="#KnowledgeIngestionTools-294"><span class="linenos">294</span></a>
</span><span id="KnowledgeIngestionTools-295"><a href="#KnowledgeIngestionTools-295"><span class="linenos">295</span></a>            <span class="c1"># Add source URL to content</span>
</span><span id="KnowledgeIngestionTools-296"><a href="#KnowledgeIngestionTools-296"><span class="linenos">296</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-297"><a href="#KnowledgeIngestionTools-297"><span class="linenos">297</span></a>
</span><span id="KnowledgeIngestionTools-298"><a href="#KnowledgeIngestionTools-298"><span class="linenos">298</span></a>            <span class="c1"># Ingest the content</span>
</span><span id="KnowledgeIngestionTools-299"><a href="#KnowledgeIngestionTools-299"><span class="linenos">299</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-300"><a href="#KnowledgeIngestionTools-300"><span class="linenos">300</span></a>
</span><span id="KnowledgeIngestionTools-301"><a href="#KnowledgeIngestionTools-301"><span class="linenos">301</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-302"><a href="#KnowledgeIngestionTools-302"><span class="linenos">302</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-303"><a href="#KnowledgeIngestionTools-303"><span class="linenos">303</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error fetching URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-304"><a href="#KnowledgeIngestionTools-304"><span class="linenos">304</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-305"><a href="#KnowledgeIngestionTools-305"><span class="linenos">305</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting from URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-306"><a href="#KnowledgeIngestionTools-306"><span class="linenos">306</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting from URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-307"><a href="#KnowledgeIngestionTools-307"><span class="linenos">307</span></a>
</span><span id="KnowledgeIngestionTools-308"><a href="#KnowledgeIngestionTools-308"><span class="linenos">308</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_ingest_directory</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-309"><a href="#KnowledgeIngestionTools-309"><span class="linenos">309</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KnowledgeIngestionTools-310"><a href="#KnowledgeIngestionTools-310"><span class="linenos">310</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-311"><a href="#KnowledgeIngestionTools-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest multiple files from a directory into the knowledge base.</span>
</span><span id="KnowledgeIngestionTools-312"><a href="#KnowledgeIngestionTools-312"><span class="linenos">312</span></a>
</span><span id="KnowledgeIngestionTools-313"><a href="#KnowledgeIngestionTools-313"><span class="linenos">313</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools-314"><a href="#KnowledgeIngestionTools-314"><span class="linenos">314</span></a><span class="sd">            directory_path: Path to the directory containing files</span>
</span><span id="KnowledgeIngestionTools-315"><a href="#KnowledgeIngestionTools-315"><span class="linenos">315</span></a><span class="sd">            file_pattern: Glob pattern to match files (e.g., &quot;*.txt&quot;, &quot;*.md&quot;)</span>
</span><span id="KnowledgeIngestionTools-316"><a href="#KnowledgeIngestionTools-316"><span class="linenos">316</span></a><span class="sd">            recursive: Whether to search subdirectories recursively</span>
</span><span id="KnowledgeIngestionTools-317"><a href="#KnowledgeIngestionTools-317"><span class="linenos">317</span></a>
</span><span id="KnowledgeIngestionTools-318"><a href="#KnowledgeIngestionTools-318"><span class="linenos">318</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools-319"><a href="#KnowledgeIngestionTools-319"><span class="linenos">319</span></a><span class="sd">            Summary of ingestion results.</span>
</span><span id="KnowledgeIngestionTools-320"><a href="#KnowledgeIngestionTools-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools-321"><a href="#KnowledgeIngestionTools-321"><span class="linenos">321</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-322"><a href="#KnowledgeIngestionTools-322"><span class="linenos">322</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="KnowledgeIngestionTools-323"><a href="#KnowledgeIngestionTools-323"><span class="linenos">323</span></a>            <span class="k">if</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-324"><a href="#KnowledgeIngestionTools-324"><span class="linenos">324</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-325"><a href="#KnowledgeIngestionTools-325"><span class="linenos">325</span></a>            <span class="k">elif</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-326"><a href="#KnowledgeIngestionTools-326"><span class="linenos">326</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-327"><a href="#KnowledgeIngestionTools-327"><span class="linenos">327</span></a>
</span><span id="KnowledgeIngestionTools-328"><a href="#KnowledgeIngestionTools-328"><span class="linenos">328</span></a>            <span class="c1"># Validate directory exists</span>
</span><span id="KnowledgeIngestionTools-329"><a href="#KnowledgeIngestionTools-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-330"><a href="#KnowledgeIngestionTools-330"><span class="linenos">330</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Directory not found at &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeIngestionTools-331"><a href="#KnowledgeIngestionTools-331"><span class="linenos">331</span></a>
</span><span id="KnowledgeIngestionTools-332"><a href="#KnowledgeIngestionTools-332"><span class="linenos">332</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-333"><a href="#KnowledgeIngestionTools-333"><span class="linenos">333</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39; is not a directory&quot;</span>
</span><span id="KnowledgeIngestionTools-334"><a href="#KnowledgeIngestionTools-334"><span class="linenos">334</span></a>
</span><span id="KnowledgeIngestionTools-335"><a href="#KnowledgeIngestionTools-335"><span class="linenos">335</span></a>            <span class="c1"># Find files matching pattern</span>
</span><span id="KnowledgeIngestionTools-336"><a href="#KnowledgeIngestionTools-336"><span class="linenos">336</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-337"><a href="#KnowledgeIngestionTools-337"><span class="linenos">337</span></a>            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-338"><a href="#KnowledgeIngestionTools-338"><span class="linenos">338</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="KnowledgeIngestionTools-339"><a href="#KnowledgeIngestionTools-339"><span class="linenos">339</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-340"><a href="#KnowledgeIngestionTools-340"><span class="linenos">340</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="KnowledgeIngestionTools-341"><a href="#KnowledgeIngestionTools-341"><span class="linenos">341</span></a>
</span><span id="KnowledgeIngestionTools-342"><a href="#KnowledgeIngestionTools-342"><span class="linenos">342</span></a>            <span class="c1"># Filter to only include files (not directories)</span>
</span><span id="KnowledgeIngestionTools-343"><a href="#KnowledgeIngestionTools-343"><span class="linenos">343</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
</span><span id="KnowledgeIngestionTools-344"><a href="#KnowledgeIngestionTools-344"><span class="linenos">344</span></a>
</span><span id="KnowledgeIngestionTools-345"><a href="#KnowledgeIngestionTools-345"><span class="linenos">345</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-346"><a href="#KnowledgeIngestionTools-346"><span class="linenos">346</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No files found matching pattern &#39;</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeIngestionTools-347"><a href="#KnowledgeIngestionTools-347"><span class="linenos">347</span></a>
</span><span id="KnowledgeIngestionTools-348"><a href="#KnowledgeIngestionTools-348"><span class="linenos">348</span></a>            <span class="c1"># Limit batch size to prevent overwhelming the system</span>
</span><span id="KnowledgeIngestionTools-349"><a href="#KnowledgeIngestionTools-349"><span class="linenos">349</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-350"><a href="#KnowledgeIngestionTools-350"><span class="linenos">350</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Too many files (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">). Please process in smaller batches (max 50 files).&quot;</span>
</span><span id="KnowledgeIngestionTools-351"><a href="#KnowledgeIngestionTools-351"><span class="linenos">351</span></a>
</span><span id="KnowledgeIngestionTools-352"><a href="#KnowledgeIngestionTools-352"><span class="linenos">352</span></a>            <span class="c1"># Process files</span>
</span><span id="KnowledgeIngestionTools-353"><a href="#KnowledgeIngestionTools-353"><span class="linenos">353</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="KnowledgeIngestionTools-354"><a href="#KnowledgeIngestionTools-354"><span class="linenos">354</span></a>
</span><span id="KnowledgeIngestionTools-355"><a href="#KnowledgeIngestionTools-355"><span class="linenos">355</span></a>            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-356"><a href="#KnowledgeIngestionTools-356"><span class="linenos">356</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-357"><a href="#KnowledgeIngestionTools-357"><span class="linenos">357</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="KnowledgeIngestionTools-358"><a href="#KnowledgeIngestionTools-358"><span class="linenos">358</span></a>                    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-359"><a href="#KnowledgeIngestionTools-359"><span class="linenos">359</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeIngestionTools-360"><a href="#KnowledgeIngestionTools-360"><span class="linenos">360</span></a>                        <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-361"><a href="#KnowledgeIngestionTools-361"><span class="linenos">361</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-362"><a href="#KnowledgeIngestionTools-362"><span class="linenos">362</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeIngestionTools-363"><a href="#KnowledgeIngestionTools-363"><span class="linenos">363</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-364"><a href="#KnowledgeIngestionTools-364"><span class="linenos">364</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to ingest </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-365"><a href="#KnowledgeIngestionTools-365"><span class="linenos">365</span></a>
</span><span id="KnowledgeIngestionTools-366"><a href="#KnowledgeIngestionTools-366"><span class="linenos">366</span></a>                    <span class="c1"># Small delay to avoid overwhelming the server</span>
</span><span id="KnowledgeIngestionTools-367"><a href="#KnowledgeIngestionTools-367"><span class="linenos">367</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-368"><a href="#KnowledgeIngestionTools-368"><span class="linenos">368</span></a>
</span><span id="KnowledgeIngestionTools-369"><a href="#KnowledgeIngestionTools-369"><span class="linenos">369</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-370"><a href="#KnowledgeIngestionTools-370"><span class="linenos">370</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeIngestionTools-371"><a href="#KnowledgeIngestionTools-371"><span class="linenos">371</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-372"><a href="#KnowledgeIngestionTools-372"><span class="linenos">372</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-373"><a href="#KnowledgeIngestionTools-373"><span class="linenos">373</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-374"><a href="#KnowledgeIngestionTools-374"><span class="linenos">374</span></a>
</span><span id="KnowledgeIngestionTools-375"><a href="#KnowledgeIngestionTools-375"><span class="linenos">375</span></a>            <span class="c1"># Format results</span>
</span><span id="KnowledgeIngestionTools-376"><a href="#KnowledgeIngestionTools-376"><span class="linenos">376</span></a>            <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Batch ingestion complete: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> successful, </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> failed&quot;</span>
</span><span id="KnowledgeIngestionTools-377"><a href="#KnowledgeIngestionTools-377"><span class="linenos">377</span></a>
</span><span id="KnowledgeIngestionTools-378"><a href="#KnowledgeIngestionTools-378"><span class="linenos">378</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]:</span>
</span><span id="KnowledgeIngestionTools-379"><a href="#KnowledgeIngestionTools-379"><span class="linenos">379</span></a>                <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Errors:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-380"><a href="#KnowledgeIngestionTools-380"><span class="linenos">380</span></a>                    <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools-381"><a href="#KnowledgeIngestionTools-381"><span class="linenos">381</span></a>                <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-382"><a href="#KnowledgeIngestionTools-382"><span class="linenos">382</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-383"><a href="#KnowledgeIngestionTools-383"><span class="linenos">383</span></a>                    <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more errors&quot;</span>
</span><span id="KnowledgeIngestionTools-384"><a href="#KnowledgeIngestionTools-384"><span class="linenos">384</span></a>
</span><span id="KnowledgeIngestionTools-385"><a href="#KnowledgeIngestionTools-385"><span class="linenos">385</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-386"><a href="#KnowledgeIngestionTools-386"><span class="linenos">386</span></a>                <span class="sa">f</span><span class="s2">&quot;Batch ingestion completed: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files successful&quot;</span>
</span><span id="KnowledgeIngestionTools-387"><a href="#KnowledgeIngestionTools-387"><span class="linenos">387</span></a>            <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-388"><a href="#KnowledgeIngestionTools-388"><span class="linenos">388</span></a>            <span class="k">return</span> <span class="n">summary</span>
</span><span id="KnowledgeIngestionTools-389"><a href="#KnowledgeIngestionTools-389"><span class="linenos">389</span></a>
</span><span id="KnowledgeIngestionTools-390"><a href="#KnowledgeIngestionTools-390"><span class="linenos">390</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-391"><a href="#KnowledgeIngestionTools-391"><span class="linenos">391</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in batch ingestion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-392"><a href="#KnowledgeIngestionTools-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error in batch ingestion: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-393"><a href="#KnowledgeIngestionTools-393"><span class="linenos">393</span></a>
</span><span id="KnowledgeIngestionTools-394"><a href="#KnowledgeIngestionTools-394"><span class="linenos">394</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query_knowledge_base</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-395"><a href="#KnowledgeIngestionTools-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-396"><a href="#KnowledgeIngestionTools-396"><span class="linenos">396</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-397"><a href="#KnowledgeIngestionTools-397"><span class="linenos">397</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hybrid&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-398"><a href="#KnowledgeIngestionTools-398"><span class="linenos">398</span></a>        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-399"><a href="#KnowledgeIngestionTools-399"><span class="linenos">399</span></a>        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-400"><a href="#KnowledgeIngestionTools-400"><span class="linenos">400</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-401"><a href="#KnowledgeIngestionTools-401"><span class="linenos">401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the unified knowledge base to retrieve stored factual information and documents.</span>
</span><span id="KnowledgeIngestionTools-402"><a href="#KnowledgeIngestionTools-402"><span class="linenos">402</span></a>
</span><span id="KnowledgeIngestionTools-403"><a href="#KnowledgeIngestionTools-403"><span class="linenos">403</span></a><span class="sd">        This tool is for SEARCHING existing knowledge, NOT for creative tasks like writing stories,</span>
</span><span id="KnowledgeIngestionTools-404"><a href="#KnowledgeIngestionTools-404"><span class="linenos">404</span></a><span class="sd">        generating content, or answering general questions. Use this only when you need to find</span>
</span><span id="KnowledgeIngestionTools-405"><a href="#KnowledgeIngestionTools-405"><span class="linenos">405</span></a><span class="sd">        specific information that was previously stored in the knowledge base.</span>
</span><span id="KnowledgeIngestionTools-406"><a href="#KnowledgeIngestionTools-406"><span class="linenos">406</span></a>
</span><span id="KnowledgeIngestionTools-407"><a href="#KnowledgeIngestionTools-407"><span class="linenos">407</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools-408"><a href="#KnowledgeIngestionTools-408"><span class="linenos">408</span></a><span class="sd">            query: The search query for finding existing knowledge/documents</span>
</span><span id="KnowledgeIngestionTools-409"><a href="#KnowledgeIngestionTools-409"><span class="linenos">409</span></a><span class="sd">            mode: Query mode - &quot;local&quot; (semantic), &quot;global&quot; (graph), &quot;hybrid&quot;, &quot;mix&quot;, &quot;auto&quot;</span>
</span><span id="KnowledgeIngestionTools-410"><a href="#KnowledgeIngestionTools-410"><span class="linenos">410</span></a><span class="sd">            limit: Maximum number of results to return</span>
</span><span id="KnowledgeIngestionTools-411"><a href="#KnowledgeIngestionTools-411"><span class="linenos">411</span></a>
</span><span id="KnowledgeIngestionTools-412"><a href="#KnowledgeIngestionTools-412"><span class="linenos">412</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools-413"><a href="#KnowledgeIngestionTools-413"><span class="linenos">413</span></a><span class="sd">            Search results from the knowledge base, or rejection message for inappropriate requests.</span>
</span><span id="KnowledgeIngestionTools-414"><a href="#KnowledgeIngestionTools-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools-415"><a href="#KnowledgeIngestionTools-415"><span class="linenos">415</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-416"><a href="#KnowledgeIngestionTools-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeIngestionTools-417"><a href="#KnowledgeIngestionTools-417"><span class="linenos">417</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Query cannot be empty&quot;</span>
</span><span id="KnowledgeIngestionTools-418"><a href="#KnowledgeIngestionTools-418"><span class="linenos">418</span></a>
</span><span id="KnowledgeIngestionTools-419"><a href="#KnowledgeIngestionTools-419"><span class="linenos">419</span></a>            <span class="c1"># Filter out inappropriate creative requests</span>
</span><span id="KnowledgeIngestionTools-420"><a href="#KnowledgeIngestionTools-420"><span class="linenos">420</span></a>            <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-421"><a href="#KnowledgeIngestionTools-421"><span class="linenos">421</span></a>
</span><span id="KnowledgeIngestionTools-422"><a href="#KnowledgeIngestionTools-422"><span class="linenos">422</span></a>            <span class="c1"># Creative/generative request patterns that should NOT use knowledge search</span>
</span><span id="KnowledgeIngestionTools-423"><a href="#KnowledgeIngestionTools-423"><span class="linenos">423</span></a>            <span class="n">creative_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeIngestionTools-424"><a href="#KnowledgeIngestionTools-424"><span class="linenos">424</span></a>                <span class="s2">&quot;write&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-425"><a href="#KnowledgeIngestionTools-425"><span class="linenos">425</span></a>                <span class="s2">&quot;create&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-426"><a href="#KnowledgeIngestionTools-426"><span class="linenos">426</span></a>                <span class="s2">&quot;generate&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-427"><a href="#KnowledgeIngestionTools-427"><span class="linenos">427</span></a>                <span class="s2">&quot;make&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-428"><a href="#KnowledgeIngestionTools-428"><span class="linenos">428</span></a>                <span class="s2">&quot;compose&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-429"><a href="#KnowledgeIngestionTools-429"><span class="linenos">429</span></a>                <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-430"><a href="#KnowledgeIngestionTools-430"><span class="linenos">430</span></a>                <span class="s2">&quot;tell me a&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-431"><a href="#KnowledgeIngestionTools-431"><span class="linenos">431</span></a>                <span class="s2">&quot;give me a&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-432"><a href="#KnowledgeIngestionTools-432"><span class="linenos">432</span></a>                <span class="s2">&quot;come up with&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-433"><a href="#KnowledgeIngestionTools-433"><span class="linenos">433</span></a>                <span class="s2">&quot;think of&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-434"><a href="#KnowledgeIngestionTools-434"><span class="linenos">434</span></a>                <span class="s2">&quot;story&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-435"><a href="#KnowledgeIngestionTools-435"><span class="linenos">435</span></a>                <span class="s2">&quot;poem&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-436"><a href="#KnowledgeIngestionTools-436"><span class="linenos">436</span></a>                <span class="s2">&quot;joke&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-437"><a href="#KnowledgeIngestionTools-437"><span class="linenos">437</span></a>                <span class="s2">&quot;song&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-438"><a href="#KnowledgeIngestionTools-438"><span class="linenos">438</span></a>                <span class="s2">&quot;essay&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-439"><a href="#KnowledgeIngestionTools-439"><span class="linenos">439</span></a>                <span class="s2">&quot;article&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-440"><a href="#KnowledgeIngestionTools-440"><span class="linenos">440</span></a>                <span class="s2">&quot;funny&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-441"><a href="#KnowledgeIngestionTools-441"><span class="linenos">441</span></a>                <span class="s2">&quot;creative&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-442"><a href="#KnowledgeIngestionTools-442"><span class="linenos">442</span></a>                <span class="s2">&quot;imagine&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-443"><a href="#KnowledgeIngestionTools-443"><span class="linenos">443</span></a>                <span class="s2">&quot;pretend&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-444"><a href="#KnowledgeIngestionTools-444"><span class="linenos">444</span></a>            <span class="p">]</span>
</span><span id="KnowledgeIngestionTools-445"><a href="#KnowledgeIngestionTools-445"><span class="linenos">445</span></a>
</span><span id="KnowledgeIngestionTools-446"><a href="#KnowledgeIngestionTools-446"><span class="linenos">446</span></a>            <span class="c1"># Check if this looks like a creative request</span>
</span><span id="KnowledgeIngestionTools-447"><a href="#KnowledgeIngestionTools-447"><span class="linenos">447</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">creative_patterns</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-448"><a href="#KnowledgeIngestionTools-448"><span class="linenos">448</span></a>                <span class="c1"># Additional check: if it&#39;s asking for factual info WITH creative words, allow it</span>
</span><span id="KnowledgeIngestionTools-449"><a href="#KnowledgeIngestionTools-449"><span class="linenos">449</span></a>                <span class="n">factual_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeIngestionTools-450"><a href="#KnowledgeIngestionTools-450"><span class="linenos">450</span></a>                    <span class="s2">&quot;what is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-451"><a href="#KnowledgeIngestionTools-451"><span class="linenos">451</span></a>                    <span class="s2">&quot;who is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-452"><a href="#KnowledgeIngestionTools-452"><span class="linenos">452</span></a>                    <span class="s2">&quot;when did&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-453"><a href="#KnowledgeIngestionTools-453"><span class="linenos">453</span></a>                    <span class="s2">&quot;where is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-454"><a href="#KnowledgeIngestionTools-454"><span class="linenos">454</span></a>                    <span class="s2">&quot;how does&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-455"><a href="#KnowledgeIngestionTools-455"><span class="linenos">455</span></a>                    <span class="s2">&quot;definition of&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-456"><a href="#KnowledgeIngestionTools-456"><span class="linenos">456</span></a>                    <span class="s2">&quot;information about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-457"><a href="#KnowledgeIngestionTools-457"><span class="linenos">457</span></a>                    <span class="s2">&quot;facts about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-458"><a href="#KnowledgeIngestionTools-458"><span class="linenos">458</span></a>                    <span class="s2">&quot;details about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-459"><a href="#KnowledgeIngestionTools-459"><span class="linenos">459</span></a>                    <span class="s2">&quot;explain&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-460"><a href="#KnowledgeIngestionTools-460"><span class="linenos">460</span></a>                    <span class="s2">&quot;describe&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-461"><a href="#KnowledgeIngestionTools-461"><span class="linenos">461</span></a>                <span class="p">]</span>
</span><span id="KnowledgeIngestionTools-462"><a href="#KnowledgeIngestionTools-462"><span class="linenos">462</span></a>
</span><span id="KnowledgeIngestionTools-463"><a href="#KnowledgeIngestionTools-463"><span class="linenos">463</span></a>                <span class="c1"># If it has factual patterns, it might be legitimate</span>
</span><span id="KnowledgeIngestionTools-464"><a href="#KnowledgeIngestionTools-464"><span class="linenos">464</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">factual</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">factual</span> <span class="ow">in</span> <span class="n">factual_patterns</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-465"><a href="#KnowledgeIngestionTools-465"><span class="linenos">465</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-466"><a href="#KnowledgeIngestionTools-466"><span class="linenos">466</span></a>                        <span class="sa">f</span><span class="s2">&quot;Rejected creative request for knowledge search: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="KnowledgeIngestionTools-467"><a href="#KnowledgeIngestionTools-467"><span class="linenos">467</span></a>                    <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-468"><a href="#KnowledgeIngestionTools-468"><span class="linenos">468</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; This appears to be a creative request (&#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;). The knowledge base is for searching existing stored information, not for generating new content. Please rephrase as a search for existing knowledge, or ask me to create content directly without using knowledge tools.&quot;</span>
</span><span id="KnowledgeIngestionTools-469"><a href="#KnowledgeIngestionTools-469"><span class="linenos">469</span></a>
</span><span id="KnowledgeIngestionTools-470"><a href="#KnowledgeIngestionTools-470"><span class="linenos">470</span></a>            <span class="c1"># Validate mode</span>
</span><span id="KnowledgeIngestionTools-471"><a href="#KnowledgeIngestionTools-471"><span class="linenos">471</span></a>            <span class="n">valid_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="s2">&quot;hybrid&quot;</span><span class="p">,</span> <span class="s2">&quot;naive&quot;</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools-472"><a href="#KnowledgeIngestionTools-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modes</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-473"><a href="#KnowledgeIngestionTools-473"><span class="linenos">473</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;hybrid&quot;</span>
</span><span id="KnowledgeIngestionTools-474"><a href="#KnowledgeIngestionTools-474"><span class="linenos">474</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mode not recognized, defaulting to &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-475"><a href="#KnowledgeIngestionTools-475"><span class="linenos">475</span></a>
</span><span id="KnowledgeIngestionTools-476"><a href="#KnowledgeIngestionTools-476"><span class="linenos">476</span></a>            <span class="c1"># Query LightRAG server</span>
</span><span id="KnowledgeIngestionTools-477"><a href="#KnowledgeIngestionTools-477"><span class="linenos">477</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-478"><a href="#KnowledgeIngestionTools-478"><span class="linenos">478</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span><span class="si">}</span><span class="s2">/query&quot;</span>
</span><span id="KnowledgeIngestionTools-479"><a href="#KnowledgeIngestionTools-479"><span class="linenos">479</span></a>                <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KnowledgeIngestionTools-480"><a href="#KnowledgeIngestionTools-480"><span class="linenos">480</span></a>                    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="KnowledgeIngestionTools-481"><a href="#KnowledgeIngestionTools-481"><span class="linenos">481</span></a>                    <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-482"><a href="#KnowledgeIngestionTools-482"><span class="linenos">482</span></a>                    <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-483"><a href="#KnowledgeIngestionTools-483"><span class="linenos">483</span></a>                    <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools-484"><a href="#KnowledgeIngestionTools-484"><span class="linenos">484</span></a>                <span class="p">}</span>
</span><span id="KnowledgeIngestionTools-485"><a href="#KnowledgeIngestionTools-485"><span class="linenos">485</span></a>
</span><span id="KnowledgeIngestionTools-486"><a href="#KnowledgeIngestionTools-486"><span class="linenos">486</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-487"><a href="#KnowledgeIngestionTools-487"><span class="linenos">487</span></a>
</span><span id="KnowledgeIngestionTools-488"><a href="#KnowledgeIngestionTools-488"><span class="linenos">488</span></a>                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-489"><a href="#KnowledgeIngestionTools-489"><span class="linenos">489</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-490"><a href="#KnowledgeIngestionTools-490"><span class="linenos">490</span></a>
</span><span id="KnowledgeIngestionTools-491"><a href="#KnowledgeIngestionTools-491"><span class="linenos">491</span></a>                    <span class="c1"># Extract the response content</span>
</span><span id="KnowledgeIngestionTools-492"><a href="#KnowledgeIngestionTools-492"><span class="linenos">492</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools-493"><a href="#KnowledgeIngestionTools-493"><span class="linenos">493</span></a>                        <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-494"><a href="#KnowledgeIngestionTools-494"><span class="linenos">494</span></a>                            <span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</span><span id="KnowledgeIngestionTools-495"><a href="#KnowledgeIngestionTools-495"><span class="linenos">495</span></a>                        <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-496"><a href="#KnowledgeIngestionTools-496"><span class="linenos">496</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-497"><a href="#KnowledgeIngestionTools-497"><span class="linenos">497</span></a>                        <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-498"><a href="#KnowledgeIngestionTools-498"><span class="linenos">498</span></a>
</span><span id="KnowledgeIngestionTools-499"><a href="#KnowledgeIngestionTools-499"><span class="linenos">499</span></a>                    <span class="k">if</span> <span class="n">content</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeIngestionTools-500"><a href="#KnowledgeIngestionTools-500"><span class="linenos">500</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Knowledge query successful: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-501"><a href="#KnowledgeIngestionTools-501"><span class="linenos">501</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; KNOWLEDGE BASE QUERY (mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">):</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-502"><a href="#KnowledgeIngestionTools-502"><span class="linenos">502</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-503"><a href="#KnowledgeIngestionTools-503"><span class="linenos">503</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No relevant knowledge found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. Try different keywords or add more knowledge to your base.&quot;</span>
</span><span id="KnowledgeIngestionTools-504"><a href="#KnowledgeIngestionTools-504"><span class="linenos">504</span></a>
</span><span id="KnowledgeIngestionTools-505"><a href="#KnowledgeIngestionTools-505"><span class="linenos">505</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-506"><a href="#KnowledgeIngestionTools-506"><span class="linenos">506</span></a>                    <span class="n">error_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeIngestionTools-507"><a href="#KnowledgeIngestionTools-507"><span class="linenos">507</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LightRAG query failed: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-508"><a href="#KnowledgeIngestionTools-508"><span class="linenos">508</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-509"><a href="#KnowledgeIngestionTools-509"><span class="linenos">509</span></a>
</span><span id="KnowledgeIngestionTools-510"><a href="#KnowledgeIngestionTools-510"><span class="linenos">510</span></a>            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-511"><a href="#KnowledgeIngestionTools-511"><span class="linenos">511</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error connecting to LightRAG server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-512"><a href="#KnowledgeIngestionTools-512"><span class="linenos">512</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error connecting to knowledge base server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-513"><a href="#KnowledgeIngestionTools-513"><span class="linenos">513</span></a>
</span><span id="KnowledgeIngestionTools-514"><a href="#KnowledgeIngestionTools-514"><span class="linenos">514</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-515"><a href="#KnowledgeIngestionTools-515"><span class="linenos">515</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-516"><a href="#KnowledgeIngestionTools-516"><span class="linenos">516</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-517"><a href="#KnowledgeIngestionTools-517"><span class="linenos">517</span></a>
</span><span id="KnowledgeIngestionTools-518"><a href="#KnowledgeIngestionTools-518"><span class="linenos">518</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-519"><a href="#KnowledgeIngestionTools-519"><span class="linenos">519</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeIngestionTools-520"><a href="#KnowledgeIngestionTools-520"><span class="linenos">520</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-521"><a href="#KnowledgeIngestionTools-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload a file to the LightRAG server.</span>
</span><span id="KnowledgeIngestionTools-522"><a href="#KnowledgeIngestionTools-522"><span class="linenos">522</span></a>
</span><span id="KnowledgeIngestionTools-523"><a href="#KnowledgeIngestionTools-523"><span class="linenos">523</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools-524"><a href="#KnowledgeIngestionTools-524"><span class="linenos">524</span></a><span class="sd">            file_path: Path to the file to upload</span>
</span><span id="KnowledgeIngestionTools-525"><a href="#KnowledgeIngestionTools-525"><span class="linenos">525</span></a><span class="sd">            filename: Name to use for the uploaded file</span>
</span><span id="KnowledgeIngestionTools-526"><a href="#KnowledgeIngestionTools-526"><span class="linenos">526</span></a><span class="sd">            url: LightRAG server URL to upload to</span>
</span><span id="KnowledgeIngestionTools-527"><a href="#KnowledgeIngestionTools-527"><span class="linenos">527</span></a>
</span><span id="KnowledgeIngestionTools-528"><a href="#KnowledgeIngestionTools-528"><span class="linenos">528</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools-529"><a href="#KnowledgeIngestionTools-529"><span class="linenos">529</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeIngestionTools-530"><a href="#KnowledgeIngestionTools-530"><span class="linenos">530</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools-531"><a href="#KnowledgeIngestionTools-531"><span class="linenos">531</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-532"><a href="#KnowledgeIngestionTools-532"><span class="linenos">532</span></a>            <span class="n">final_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/documents/upload&quot;</span>
</span><span id="KnowledgeIngestionTools-533"><a href="#KnowledgeIngestionTools-533"><span class="linenos">533</span></a>
</span><span id="KnowledgeIngestionTools-534"><a href="#KnowledgeIngestionTools-534"><span class="linenos">534</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-535"><a href="#KnowledgeIngestionTools-535"><span class="linenos">535</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">)}</span>
</span><span id="KnowledgeIngestionTools-536"><a href="#KnowledgeIngestionTools-536"><span class="linenos">536</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">final_url</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-537"><a href="#KnowledgeIngestionTools-537"><span class="linenos">537</span></a>
</span><span id="KnowledgeIngestionTools-538"><a href="#KnowledgeIngestionTools-538"><span class="linenos">538</span></a>                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
</span><span id="KnowledgeIngestionTools-539"><a href="#KnowledgeIngestionTools-539"><span class="linenos">539</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools-540"><a href="#KnowledgeIngestionTools-540"><span class="linenos">540</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools-541"><a href="#KnowledgeIngestionTools-541"><span class="linenos">541</span></a>                        <span class="sa">f</span><span class="s2">&quot;Successfully uploaded to LightRAG server </span><span class="si">{</span><span class="n">final_url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-542"><a href="#KnowledgeIngestionTools-542"><span class="linenos">542</span></a>                    <span class="p">)</span>
</span><span id="KnowledgeIngestionTools-543"><a href="#KnowledgeIngestionTools-543"><span class="linenos">543</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; File uploaded and processing started&quot;</span>
</span><span id="KnowledgeIngestionTools-544"><a href="#KnowledgeIngestionTools-544"><span class="linenos">544</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-545"><a href="#KnowledgeIngestionTools-545"><span class="linenos">545</span></a>                    <span class="n">error_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeIngestionTools-546"><a href="#KnowledgeIngestionTools-546"><span class="linenos">546</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LightRAG upload failed: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-547"><a href="#KnowledgeIngestionTools-547"><span class="linenos">547</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Upload failed: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-548"><a href="#KnowledgeIngestionTools-548"><span class="linenos">548</span></a>
</span><span id="KnowledgeIngestionTools-549"><a href="#KnowledgeIngestionTools-549"><span class="linenos">549</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-550"><a href="#KnowledgeIngestionTools-550"><span class="linenos">550</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error uploading to LightRAG: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-551"><a href="#KnowledgeIngestionTools-551"><span class="linenos">551</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Upload error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools-552"><a href="#KnowledgeIngestionTools-552"><span class="linenos">552</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools-553"><a href="#KnowledgeIngestionTools-553"><span class="linenos">553</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error during upload: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools-554"><a href="#KnowledgeIngestionTools-554"><span class="linenos">554</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Unexpected upload error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Knowledge ingestion tools for adding files and content to the knowledge base.</p>

<p>Args:
    ingest_file (bool): Enable file ingestion functionality.
    ingest_text (bool): Enable direct text ingestion functionality.
    ingest_url (bool): Enable URL content ingestion functionality.
    batch_ingest (bool): Enable batch directory ingestion functionality.
    query_knowledge (bool): Enable unified knowledge querying functionality.</p>
</div>


                            <div id="KnowledgeIngestionTools.__init__" class="classattr">
                                        <input id="KnowledgeIngestionTools.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">KnowledgeIngestionTools</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">ingest_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">ingest_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">ingest_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">batch_ingest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">query_knowledge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="KnowledgeIngestionTools.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeIngestionTools.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeIngestionTools.__init__-43"><a href="#KnowledgeIngestionTools.__init__-43"><span class="linenos">43</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.__init__-44"><a href="#KnowledgeIngestionTools.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.__init__-45"><a href="#KnowledgeIngestionTools.__init__-45"><span class="linenos">45</span></a>        <span class="n">ingest_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.__init__-46"><a href="#KnowledgeIngestionTools.__init__-46"><span class="linenos">46</span></a>        <span class="n">ingest_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.__init__-47"><a href="#KnowledgeIngestionTools.__init__-47"><span class="linenos">47</span></a>        <span class="n">ingest_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.__init__-48"><a href="#KnowledgeIngestionTools.__init__-48"><span class="linenos">48</span></a>        <span class="n">batch_ingest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.__init__-49"><a href="#KnowledgeIngestionTools.__init__-49"><span class="linenos">49</span></a>        <span class="n">query_knowledge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.__init__-50"><a href="#KnowledgeIngestionTools.__init__-50"><span class="linenos">50</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.__init__-51"><a href="#KnowledgeIngestionTools.__init__-51"><span class="linenos">51</span></a>    <span class="p">):</span>
</span><span id="KnowledgeIngestionTools.__init__-52"><a href="#KnowledgeIngestionTools.__init__-52"><span class="linenos">52</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KnowledgeIngestionTools.__init__-53"><a href="#KnowledgeIngestionTools.__init__-53"><span class="linenos">53</span></a>
</span><span id="KnowledgeIngestionTools.__init__-54"><a href="#KnowledgeIngestionTools.__init__-54"><span class="linenos">54</span></a>        <span class="k">if</span> <span class="n">ingest_file</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.__init__-55"><a href="#KnowledgeIngestionTools.__init__-55"><span class="linenos">55</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_file</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.__init__-56"><a href="#KnowledgeIngestionTools.__init__-56"><span class="linenos">56</span></a>        <span class="k">if</span> <span class="n">ingest_text</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.__init__-57"><a href="#KnowledgeIngestionTools.__init__-57"><span class="linenos">57</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_text</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.__init__-58"><a href="#KnowledgeIngestionTools.__init__-58"><span class="linenos">58</span></a>        <span class="k">if</span> <span class="n">ingest_url</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.__init__-59"><a href="#KnowledgeIngestionTools.__init__-59"><span class="linenos">59</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_from_url</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.__init__-60"><a href="#KnowledgeIngestionTools.__init__-60"><span class="linenos">60</span></a>        <span class="k">if</span> <span class="n">batch_ingest</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.__init__-61"><a href="#KnowledgeIngestionTools.__init__-61"><span class="linenos">61</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_ingest_directory</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.__init__-62"><a href="#KnowledgeIngestionTools.__init__-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="n">query_knowledge</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.__init__-63"><a href="#KnowledgeIngestionTools.__init__-63"><span class="linenos">63</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_knowledge_base</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.__init__-64"><a href="#KnowledgeIngestionTools.__init__-64"><span class="linenos">64</span></a>
</span><span id="KnowledgeIngestionTools.__init__-65"><a href="#KnowledgeIngestionTools.__init__-65"><span class="linenos">65</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;knowledge_ingestion&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new Toolkit.</p>

<p>Args:
    name: A descriptive name for the toolkit
    tools: List of tools to include in the toolkit
    instructions: Instructions for the toolkit
    add_instructions: Whether to add instructions to the toolkit
    include_tools: List of tool names to include in the toolkit
    exclude_tools: List of tool names to exclude from the toolkit
    requires_confirmation_tools: List of tool names that require user confirmation
    external_execution_required_tools: List of tool names that will be executed outside of the agent loop
    cache_results (bool): Enable in-memory caching of function results.
    cache_ttl (int): Time-to-live for cached results in seconds.
    cache_dir (Optional[str]): Directory to store cache files. Defaults to system temp dir.
    auto_register (bool): Whether to automatically register all methods in the class.
    stop_after_tool_call_tools (Optional[List[str]]): List of function names that should stop the agent after execution.
    show_result_tools (Optional[List[str]]): List of function names whose results should be shown.</p>
</div>


                            </div>
                            <div id="KnowledgeIngestionTools.ingest_knowledge_file" class="classattr">
                                        <input id="KnowledgeIngestionTools.ingest_knowledge_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_knowledge_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeIngestionTools.ingest_knowledge_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeIngestionTools.ingest_knowledge_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeIngestionTools.ingest_knowledge_file-67"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-67"><span class="linenos"> 67</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-68"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-68"><span class="linenos"> 68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest a file into the knowledge base.</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-69"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-69"><span class="linenos"> 69</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-70"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-70"><span class="linenos"> 70</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-71"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-71"><span class="linenos"> 71</span></a><span class="sd">            file_path: Path to the file to ingest</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-72"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-72"><span class="linenos"> 72</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to filename)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-73"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-73"><span class="linenos"> 73</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-74"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-74"><span class="linenos"> 74</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-75"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-75"><span class="linenos"> 75</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-76"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-77"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-77"><span class="linenos"> 77</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-78"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-78"><span class="linenos"> 78</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-79"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-79"><span class="linenos"> 79</span></a>            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-80"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-80"><span class="linenos"> 80</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-81"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-81"><span class="linenos"> 81</span></a>            <span class="k">elif</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-82"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-82"><span class="linenos"> 82</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-83"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-83"><span class="linenos"> 83</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-84"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-84"><span class="linenos"> 84</span></a>            <span class="c1"># Validate file exists</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-85"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-85"><span class="linenos"> 85</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-86"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-86"><span class="linenos"> 86</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File not found at &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-87"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-87"><span class="linenos"> 87</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-88"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-88"><span class="linenos"> 88</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-89"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-89"><span class="linenos"> 89</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; is not a file&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-90"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-90"><span class="linenos"> 90</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-91"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-91"><span class="linenos"> 91</span></a>            <span class="c1"># Get file info</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-92"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-92"><span class="linenos"> 92</span></a>            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-93"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-93"><span class="linenos"> 93</span></a>            <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 50MB limit</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-94"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-94"><span class="linenos"> 94</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File too large (</span><span class="si">{</span><span class="n">file_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB). Maximum size is 50MB.&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-95"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-95"><span class="linenos"> 95</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-96"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-96"><span class="linenos"> 96</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-97"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-97"><span class="linenos"> 97</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-98"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-98"><span class="linenos"> 98</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-99"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-99"><span class="linenos"> 99</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-100"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-100"><span class="linenos">100</span></a>            <span class="c1"># Check file type</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-101"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-101"><span class="linenos">101</span></a>            <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-102"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-102"><span class="linenos">102</span></a>            <span class="n">supported_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-103"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-103"><span class="linenos">103</span></a>                <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-104"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-104"><span class="linenos">104</span></a>                <span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-105"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-105"><span class="linenos">105</span></a>                <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-106"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-106"><span class="linenos">106</span></a>                <span class="s2">&quot;text/csv&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-107"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-107"><span class="linenos">107</span></a>                <span class="s2">&quot;application/pdf&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-108"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-108"><span class="linenos">108</span></a>                <span class="s2">&quot;application/msword&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-109"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-109"><span class="linenos">109</span></a>                <span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-110"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-110"><span class="linenos">110</span></a>            <span class="p">]</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-111"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-111"><span class="linenos">111</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-112"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="n">mime_type</span> <span class="ow">and</span> <span class="n">mime_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_types</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-113"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-113"><span class="linenos">113</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File type </span><span class="si">{</span><span class="n">mime_type</span><span class="si">}</span><span class="s2"> may not be fully supported&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-114"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-114"><span class="linenos">114</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-115"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-115"><span class="linenos">115</span></a>            <span class="c1"># Copy file to knowledge directory</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-116"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-116"><span class="linenos">116</span></a>            <span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-117"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-117"><span class="linenos">117</span></a>            <span class="n">knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-118"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-118"><span class="linenos">118</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-119"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-119"><span class="linenos">119</span></a>            <span class="c1"># Create unique filename to avoid conflicts</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-120"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-120"><span class="linenos">120</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-121"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-121"><span class="linenos">121</span></a>            <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-122"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-122"><span class="linenos">122</span></a>            <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-123"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-123"><span class="linenos">123</span></a>            <span class="n">unique_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-124"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-124"><span class="linenos">124</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-125"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-125"><span class="linenos">125</span></a>            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">knowledge_dir</span> <span class="o">/</span> <span class="n">unique_filename</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-126"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-126"><span class="linenos">126</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-127"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-127"><span class="linenos">127</span></a>            <span class="c1"># Copy the file</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-128"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-128"><span class="linenos">128</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-129"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-129"><span class="linenos">129</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied file to knowledge directory: </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-130"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-130"><span class="linenos">130</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-131"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-131"><span class="linenos">131</span></a>            <span class="c1"># Upload to LightRAG server</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-132"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-132"><span class="linenos">132</span></a>            <span class="n">upload_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-133"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-133"><span class="linenos">133</span></a>                <span class="n">dest_path</span><span class="p">,</span> <span class="n">unique_filename</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-134"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-134"><span class="linenos">134</span></a>            <span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-135"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-135"><span class="linenos">135</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-136"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-136"><span class="linenos">136</span></a>            <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-137"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-137"><span class="linenos">137</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested knowledge file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-138"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-138"><span class="linenos">138</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; into knowledge base. </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-139"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-139"><span class="linenos">139</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-140"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-140"><span class="linenos">140</span></a>                <span class="c1"># Clean up the copied file if upload failed</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-141"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-141"><span class="linenos">141</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-142"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-142"><span class="linenos">142</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-143"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-143"><span class="linenos">143</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-144"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-144"><span class="linenos">144</span></a>                    <span class="k">pass</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-145"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-145"><span class="linenos">145</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-146"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-146"><span class="linenos">146</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-147"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-147"><span class="linenos">147</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-148"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-148"><span class="linenos">148</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_file-149"><a href="#KnowledgeIngestionTools.ingest_knowledge_file-149"><span class="linenos">149</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest a file into the knowledge base.</p>

<p>Args:
    file_path: Path to the file to ingest
    title: Optional title for the knowledge entry (defaults to filename)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="KnowledgeIngestionTools.ingest_knowledge_text" class="classattr">
                                        <input id="KnowledgeIngestionTools.ingest_knowledge_text-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_knowledge_text</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">content</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;txt&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeIngestionTools.ingest_knowledge_text-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeIngestionTools.ingest_knowledge_text"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeIngestionTools.ingest_knowledge_text-151"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_text</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-152"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-153"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-153"><span class="linenos">153</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-154"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest text content directly into the knowledge base.</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-155"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-155"><span class="linenos">155</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-156"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-156"><span class="linenos">156</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-157"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-157"><span class="linenos">157</span></a><span class="sd">            content: The text content to ingest</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-158"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-158"><span class="linenos">158</span></a><span class="sd">            title: Title for the knowledge entry</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-159"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-159"><span class="linenos">159</span></a><span class="sd">            file_type: File extension to use (txt, md, html, etc.)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-160"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-160"><span class="linenos">160</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-161"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-161"><span class="linenos">161</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-162"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-162"><span class="linenos">162</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-163"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-163"><span class="linenos">163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-164"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-164"><span class="linenos">164</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-165"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-166"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-166"><span class="linenos">166</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Content cannot be empty&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-167"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-167"><span class="linenos">167</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-168"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-168"><span class="linenos">168</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-169"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-169"><span class="linenos">169</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Title is required&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-170"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-170"><span class="linenos">170</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-171"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-171"><span class="linenos">171</span></a>            <span class="c1"># Validate file_type</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-172"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-172"><span class="linenos">172</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-173"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-173"><span class="linenos">173</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-174"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-174"><span class="linenos">174</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-175"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-175"><span class="linenos">175</span></a>            <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;.md&quot;</span><span class="p">,</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-176"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-176"><span class="linenos">176</span></a>            <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-177"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-177"><span class="linenos">177</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;.txt&quot;</span>  <span class="c1"># Default to txt</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-178"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-178"><span class="linenos">178</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-179"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-179"><span class="linenos">179</span></a>            <span class="c1"># Create knowledge directory</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-180"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-180"><span class="linenos">180</span></a>            <span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-181"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-181"><span class="linenos">181</span></a>            <span class="n">knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-182"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-182"><span class="linenos">182</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-183"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-183"><span class="linenos">183</span></a>            <span class="c1"># Create unique filename</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-184"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-184"><span class="linenos">184</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-185"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-185"><span class="linenos">185</span></a>            <span class="n">content_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-186"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-186"><span class="linenos">186</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-187"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-187"><span class="linenos">187</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-188"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-188"><span class="linenos">188</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-189"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-189"><span class="linenos">189</span></a>                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">title</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-190"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-190"><span class="linenos">190</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-191"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-191"><span class="linenos">191</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="n">safe_title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>  <span class="c1"># Limit length</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-192"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-192"><span class="linenos">192</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content_hash</span><span class="si">}{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-193"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-193"><span class="linenos">193</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-194"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-194"><span class="linenos">194</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">knowledge_dir</span> <span class="o">/</span> <span class="n">filename</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-195"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-195"><span class="linenos">195</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-196"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-196"><span class="linenos">196</span></a>            <span class="c1"># Write content to file</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-197"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-197"><span class="linenos">197</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-198"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-198"><span class="linenos">198</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-199"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-199"><span class="linenos">199</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-200"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-200"><span class="linenos">200</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created knowledge file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-201"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-201"><span class="linenos">201</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-202"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-202"><span class="linenos">202</span></a>            <span class="c1"># Upload to LightRAG server</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-203"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-203"><span class="linenos">203</span></a>            <span class="n">upload_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-204"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-204"><span class="linenos">204</span></a>                <span class="n">file_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-205"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-205"><span class="linenos">205</span></a>            <span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-206"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-206"><span class="linenos">206</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-207"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-208"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-208"><span class="linenos">208</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested knowledge text: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-209"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-209"><span class="linenos">209</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39; into knowledge base. </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-210"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-210"><span class="linenos">210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-211"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-211"><span class="linenos">211</span></a>                <span class="c1"># Clean up the created file if upload failed</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-212"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-212"><span class="linenos">212</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-213"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-213"><span class="linenos">213</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-214"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-214"><span class="linenos">214</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-215"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-215"><span class="linenos">215</span></a>                    <span class="k">pass</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-216"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-216"><span class="linenos">216</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-217"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-217"><span class="linenos">217</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-218"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-218"><span class="linenos">218</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-219"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-219"><span class="linenos">219</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting text content: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_text-220"><a href="#KnowledgeIngestionTools.ingest_knowledge_text-220"><span class="linenos">220</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting text content: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest text content directly into the knowledge base.</p>

<p>Args:
    content: The text content to ingest
    title: Title for the knowledge entry
    file_type: File extension to use (txt, md, html, etc.)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="KnowledgeIngestionTools.ingest_knowledge_from_url" class="classattr">
                                        <input id="KnowledgeIngestionTools.ingest_knowledge_from_url-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_knowledge_from_url</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeIngestionTools.ingest_knowledge_from_url-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeIngestionTools.ingest_knowledge_from_url"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-222"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-223"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest content from a URL into the knowledge base.</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-224"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-224"><span class="linenos">224</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-225"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-225"><span class="linenos">225</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-226"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-226"><span class="linenos">226</span></a><span class="sd">            url: URL to fetch content from</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-227"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-227"><span class="linenos">227</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to page title or URL)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-228"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-228"><span class="linenos">228</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-229"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-229"><span class="linenos">229</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-230"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-230"><span class="linenos">230</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-231"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-232"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-232"><span class="linenos">232</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-233"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-233"><span class="linenos">233</span></a>            <span class="c1"># Validate URL</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-234"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-234"><span class="linenos">234</span></a>            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-235"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-235"><span class="linenos">235</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-236"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-236"><span class="linenos">236</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Invalid URL format: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-237"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-237"><span class="linenos">237</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-238"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-238"><span class="linenos">238</span></a>            <span class="c1"># Fetch content</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-239"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-239"><span class="linenos">239</span></a>            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-240"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-240"><span class="linenos">240</span></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-241"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-241"><span class="linenos">241</span></a>            <span class="p">}</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-242"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-242"><span class="linenos">242</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-243"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-243"><span class="linenos">243</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-244"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-244"><span class="linenos">244</span></a>            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-245"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-245"><span class="linenos">245</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-246"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-246"><span class="linenos">246</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-247"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-247"><span class="linenos">247</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-248"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-248"><span class="linenos">248</span></a>            <span class="c1"># Handle different content types</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-249"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-249"><span class="linenos">249</span></a>            <span class="k">if</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-250"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-250"><span class="linenos">250</span></a>                <span class="c1"># For HTML, try to extract text content</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-251"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-251"><span class="linenos">251</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-252"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-252"><span class="linenos">252</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-253"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-253"><span class="linenos">253</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-254"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-254"><span class="linenos">254</span></a>                    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-255"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-255"><span class="linenos">255</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-256"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-256"><span class="linenos">256</span></a>                    <span class="c1"># Remove script and style elements</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-257"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-257"><span class="linenos">257</span></a>                    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-258"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-258"><span class="linenos">258</span></a>                        <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-259"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-259"><span class="linenos">259</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-260"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-260"><span class="linenos">260</span></a>                    <span class="c1"># Get text content</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-261"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-261"><span class="linenos">261</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-262"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-262"><span class="linenos">262</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-263"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-263"><span class="linenos">263</span></a>                    <span class="c1"># Get title if not provided</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-264"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-264"><span class="linenos">264</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-265"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-265"><span class="linenos">265</span></a>                        <span class="n">title_tag</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-266"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-266"><span class="linenos">266</span></a>                        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-267"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-267"><span class="linenos">267</span></a>                            <span class="n">title_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-268"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-268"><span class="linenos">268</span></a>                            <span class="k">if</span> <span class="n">title_tag</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-269"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-269"><span class="linenos">269</span></a>                            <span class="k">else</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-270"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-270"><span class="linenos">270</span></a>                        <span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-271"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-271"><span class="linenos">271</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-272"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-272"><span class="linenos">272</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-273"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-273"><span class="linenos">273</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-274"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-274"><span class="linenos">274</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-275"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-275"><span class="linenos">275</span></a>                    <span class="c1"># Fallback if BeautifulSoup not available</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-276"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-276"><span class="linenos">276</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-277"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-277"><span class="linenos">277</span></a>                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-278"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-278"><span class="linenos">278</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-279"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-279"><span class="linenos">279</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-280"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-280"><span class="linenos">280</span></a>            <span class="k">elif</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/json&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-281"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-281"><span class="linenos">281</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-282"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-282"><span class="linenos">282</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-283"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-283"><span class="linenos">283</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span> <span class="k">if</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="k">else</span> <span class="s2">&quot;json&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-284"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-284"><span class="linenos">284</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-285"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-285"><span class="linenos">285</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Unsupported content type: </span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-286"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-286"><span class="linenos">286</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-287"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-287"><span class="linenos">287</span></a>            <span class="c1"># Clean up content</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-288"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-288"><span class="linenos">288</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-289"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-289"><span class="linenos">289</span></a>                <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-290"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-290"><span class="linenos">290</span></a>            <span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-291"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-291"><span class="linenos">291</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-292"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-292"><span class="linenos">292</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-293"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-293"><span class="linenos">293</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: No content extracted from URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-294"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-294"><span class="linenos">294</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-295"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-295"><span class="linenos">295</span></a>            <span class="c1"># Add source URL to content</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-296"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-296"><span class="linenos">296</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-297"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-297"><span class="linenos">297</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-298"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-298"><span class="linenos">298</span></a>            <span class="c1"># Ingest the content</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-299"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-299"><span class="linenos">299</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-300"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-300"><span class="linenos">300</span></a>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-301"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-301"><span class="linenos">301</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-302"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-302"><span class="linenos">302</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-303"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-303"><span class="linenos">303</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error fetching URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-304"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-304"><span class="linenos">304</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-305"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-305"><span class="linenos">305</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting from URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.ingest_knowledge_from_url-306"><a href="#KnowledgeIngestionTools.ingest_knowledge_from_url-306"><span class="linenos">306</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting from URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest content from a URL into the knowledge base.</p>

<p>Args:
    url: URL to fetch content from
    title: Optional title for the knowledge entry (defaults to page title or URL)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="KnowledgeIngestionTools.batch_ingest_directory" class="classattr">
                                        <input id="KnowledgeIngestionTools.batch_ingest_directory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch_ingest_directory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeIngestionTools.batch_ingest_directory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeIngestionTools.batch_ingest_directory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeIngestionTools.batch_ingest_directory-308"><a href="#KnowledgeIngestionTools.batch_ingest_directory-308"><span class="linenos">308</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_ingest_directory</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-309"><a href="#KnowledgeIngestionTools.batch_ingest_directory-309"><span class="linenos">309</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-310"><a href="#KnowledgeIngestionTools.batch_ingest_directory-310"><span class="linenos">310</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-311"><a href="#KnowledgeIngestionTools.batch_ingest_directory-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest multiple files from a directory into the knowledge base.</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-312"><a href="#KnowledgeIngestionTools.batch_ingest_directory-312"><span class="linenos">312</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-313"><a href="#KnowledgeIngestionTools.batch_ingest_directory-313"><span class="linenos">313</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-314"><a href="#KnowledgeIngestionTools.batch_ingest_directory-314"><span class="linenos">314</span></a><span class="sd">            directory_path: Path to the directory containing files</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-315"><a href="#KnowledgeIngestionTools.batch_ingest_directory-315"><span class="linenos">315</span></a><span class="sd">            file_pattern: Glob pattern to match files (e.g., &quot;*.txt&quot;, &quot;*.md&quot;)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-316"><a href="#KnowledgeIngestionTools.batch_ingest_directory-316"><span class="linenos">316</span></a><span class="sd">            recursive: Whether to search subdirectories recursively</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-317"><a href="#KnowledgeIngestionTools.batch_ingest_directory-317"><span class="linenos">317</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-318"><a href="#KnowledgeIngestionTools.batch_ingest_directory-318"><span class="linenos">318</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-319"><a href="#KnowledgeIngestionTools.batch_ingest_directory-319"><span class="linenos">319</span></a><span class="sd">            Summary of ingestion results.</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-320"><a href="#KnowledgeIngestionTools.batch_ingest_directory-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-321"><a href="#KnowledgeIngestionTools.batch_ingest_directory-321"><span class="linenos">321</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-322"><a href="#KnowledgeIngestionTools.batch_ingest_directory-322"><span class="linenos">322</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-323"><a href="#KnowledgeIngestionTools.batch_ingest_directory-323"><span class="linenos">323</span></a>            <span class="k">if</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-324"><a href="#KnowledgeIngestionTools.batch_ingest_directory-324"><span class="linenos">324</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-325"><a href="#KnowledgeIngestionTools.batch_ingest_directory-325"><span class="linenos">325</span></a>            <span class="k">elif</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-326"><a href="#KnowledgeIngestionTools.batch_ingest_directory-326"><span class="linenos">326</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-327"><a href="#KnowledgeIngestionTools.batch_ingest_directory-327"><span class="linenos">327</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-328"><a href="#KnowledgeIngestionTools.batch_ingest_directory-328"><span class="linenos">328</span></a>            <span class="c1"># Validate directory exists</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-329"><a href="#KnowledgeIngestionTools.batch_ingest_directory-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-330"><a href="#KnowledgeIngestionTools.batch_ingest_directory-330"><span class="linenos">330</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Directory not found at &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-331"><a href="#KnowledgeIngestionTools.batch_ingest_directory-331"><span class="linenos">331</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-332"><a href="#KnowledgeIngestionTools.batch_ingest_directory-332"><span class="linenos">332</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-333"><a href="#KnowledgeIngestionTools.batch_ingest_directory-333"><span class="linenos">333</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39; is not a directory&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-334"><a href="#KnowledgeIngestionTools.batch_ingest_directory-334"><span class="linenos">334</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-335"><a href="#KnowledgeIngestionTools.batch_ingest_directory-335"><span class="linenos">335</span></a>            <span class="c1"># Find files matching pattern</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-336"><a href="#KnowledgeIngestionTools.batch_ingest_directory-336"><span class="linenos">336</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-337"><a href="#KnowledgeIngestionTools.batch_ingest_directory-337"><span class="linenos">337</span></a>            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-338"><a href="#KnowledgeIngestionTools.batch_ingest_directory-338"><span class="linenos">338</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-339"><a href="#KnowledgeIngestionTools.batch_ingest_directory-339"><span class="linenos">339</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-340"><a href="#KnowledgeIngestionTools.batch_ingest_directory-340"><span class="linenos">340</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-341"><a href="#KnowledgeIngestionTools.batch_ingest_directory-341"><span class="linenos">341</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-342"><a href="#KnowledgeIngestionTools.batch_ingest_directory-342"><span class="linenos">342</span></a>            <span class="c1"># Filter to only include files (not directories)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-343"><a href="#KnowledgeIngestionTools.batch_ingest_directory-343"><span class="linenos">343</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-344"><a href="#KnowledgeIngestionTools.batch_ingest_directory-344"><span class="linenos">344</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-345"><a href="#KnowledgeIngestionTools.batch_ingest_directory-345"><span class="linenos">345</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-346"><a href="#KnowledgeIngestionTools.batch_ingest_directory-346"><span class="linenos">346</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No files found matching pattern &#39;</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-347"><a href="#KnowledgeIngestionTools.batch_ingest_directory-347"><span class="linenos">347</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-348"><a href="#KnowledgeIngestionTools.batch_ingest_directory-348"><span class="linenos">348</span></a>            <span class="c1"># Limit batch size to prevent overwhelming the system</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-349"><a href="#KnowledgeIngestionTools.batch_ingest_directory-349"><span class="linenos">349</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-350"><a href="#KnowledgeIngestionTools.batch_ingest_directory-350"><span class="linenos">350</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Too many files (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">). Please process in smaller batches (max 50 files).&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-351"><a href="#KnowledgeIngestionTools.batch_ingest_directory-351"><span class="linenos">351</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-352"><a href="#KnowledgeIngestionTools.batch_ingest_directory-352"><span class="linenos">352</span></a>            <span class="c1"># Process files</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-353"><a href="#KnowledgeIngestionTools.batch_ingest_directory-353"><span class="linenos">353</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-354"><a href="#KnowledgeIngestionTools.batch_ingest_directory-354"><span class="linenos">354</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-355"><a href="#KnowledgeIngestionTools.batch_ingest_directory-355"><span class="linenos">355</span></a>            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-356"><a href="#KnowledgeIngestionTools.batch_ingest_directory-356"><span class="linenos">356</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-357"><a href="#KnowledgeIngestionTools.batch_ingest_directory-357"><span class="linenos">357</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-358"><a href="#KnowledgeIngestionTools.batch_ingest_directory-358"><span class="linenos">358</span></a>                    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-359"><a href="#KnowledgeIngestionTools.batch_ingest_directory-359"><span class="linenos">359</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-360"><a href="#KnowledgeIngestionTools.batch_ingest_directory-360"><span class="linenos">360</span></a>                        <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-361"><a href="#KnowledgeIngestionTools.batch_ingest_directory-361"><span class="linenos">361</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-362"><a href="#KnowledgeIngestionTools.batch_ingest_directory-362"><span class="linenos">362</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-363"><a href="#KnowledgeIngestionTools.batch_ingest_directory-363"><span class="linenos">363</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-364"><a href="#KnowledgeIngestionTools.batch_ingest_directory-364"><span class="linenos">364</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to ingest </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-365"><a href="#KnowledgeIngestionTools.batch_ingest_directory-365"><span class="linenos">365</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-366"><a href="#KnowledgeIngestionTools.batch_ingest_directory-366"><span class="linenos">366</span></a>                    <span class="c1"># Small delay to avoid overwhelming the server</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-367"><a href="#KnowledgeIngestionTools.batch_ingest_directory-367"><span class="linenos">367</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-368"><a href="#KnowledgeIngestionTools.batch_ingest_directory-368"><span class="linenos">368</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-369"><a href="#KnowledgeIngestionTools.batch_ingest_directory-369"><span class="linenos">369</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-370"><a href="#KnowledgeIngestionTools.batch_ingest_directory-370"><span class="linenos">370</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-371"><a href="#KnowledgeIngestionTools.batch_ingest_directory-371"><span class="linenos">371</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-372"><a href="#KnowledgeIngestionTools.batch_ingest_directory-372"><span class="linenos">372</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-373"><a href="#KnowledgeIngestionTools.batch_ingest_directory-373"><span class="linenos">373</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-374"><a href="#KnowledgeIngestionTools.batch_ingest_directory-374"><span class="linenos">374</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-375"><a href="#KnowledgeIngestionTools.batch_ingest_directory-375"><span class="linenos">375</span></a>            <span class="c1"># Format results</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-376"><a href="#KnowledgeIngestionTools.batch_ingest_directory-376"><span class="linenos">376</span></a>            <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Batch ingestion complete: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> successful, </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> failed&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-377"><a href="#KnowledgeIngestionTools.batch_ingest_directory-377"><span class="linenos">377</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-378"><a href="#KnowledgeIngestionTools.batch_ingest_directory-378"><span class="linenos">378</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-379"><a href="#KnowledgeIngestionTools.batch_ingest_directory-379"><span class="linenos">379</span></a>                <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Errors:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-380"><a href="#KnowledgeIngestionTools.batch_ingest_directory-380"><span class="linenos">380</span></a>                    <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-381"><a href="#KnowledgeIngestionTools.batch_ingest_directory-381"><span class="linenos">381</span></a>                <span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-382"><a href="#KnowledgeIngestionTools.batch_ingest_directory-382"><span class="linenos">382</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-383"><a href="#KnowledgeIngestionTools.batch_ingest_directory-383"><span class="linenos">383</span></a>                    <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more errors&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-384"><a href="#KnowledgeIngestionTools.batch_ingest_directory-384"><span class="linenos">384</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-385"><a href="#KnowledgeIngestionTools.batch_ingest_directory-385"><span class="linenos">385</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-386"><a href="#KnowledgeIngestionTools.batch_ingest_directory-386"><span class="linenos">386</span></a>                <span class="sa">f</span><span class="s2">&quot;Batch ingestion completed: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files successful&quot;</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-387"><a href="#KnowledgeIngestionTools.batch_ingest_directory-387"><span class="linenos">387</span></a>            <span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-388"><a href="#KnowledgeIngestionTools.batch_ingest_directory-388"><span class="linenos">388</span></a>            <span class="k">return</span> <span class="n">summary</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-389"><a href="#KnowledgeIngestionTools.batch_ingest_directory-389"><span class="linenos">389</span></a>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-390"><a href="#KnowledgeIngestionTools.batch_ingest_directory-390"><span class="linenos">390</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-391"><a href="#KnowledgeIngestionTools.batch_ingest_directory-391"><span class="linenos">391</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in batch ingestion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.batch_ingest_directory-392"><a href="#KnowledgeIngestionTools.batch_ingest_directory-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error in batch ingestion: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest multiple files from a directory into the knowledge base.</p>

<p>Args:
    directory_path: Path to the directory containing files
    file_pattern: Glob pattern to match files (e.g., "<em>.txt", "</em>.md")
    recursive: Whether to search subdirectories recursively</p>

<p>Returns:
    Summary of ingestion results.</p>
</div>


                            </div>
                            <div id="KnowledgeIngestionTools.query_knowledge_base" class="classattr">
                                        <input id="KnowledgeIngestionTools.query_knowledge_base-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">query_knowledge_base</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;hybrid&#39;</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:9621&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeIngestionTools.query_knowledge_base-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeIngestionTools.query_knowledge_base"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeIngestionTools.query_knowledge_base-394"><a href="#KnowledgeIngestionTools.query_knowledge_base-394"><span class="linenos">394</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query_knowledge_base</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-395"><a href="#KnowledgeIngestionTools.query_knowledge_base-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-396"><a href="#KnowledgeIngestionTools.query_knowledge_base-396"><span class="linenos">396</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-397"><a href="#KnowledgeIngestionTools.query_knowledge_base-397"><span class="linenos">397</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hybrid&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-398"><a href="#KnowledgeIngestionTools.query_knowledge_base-398"><span class="linenos">398</span></a>        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-399"><a href="#KnowledgeIngestionTools.query_knowledge_base-399"><span class="linenos">399</span></a>        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-400"><a href="#KnowledgeIngestionTools.query_knowledge_base-400"><span class="linenos">400</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-401"><a href="#KnowledgeIngestionTools.query_knowledge_base-401"><span class="linenos">401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the unified knowledge base to retrieve stored factual information and documents.</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-402"><a href="#KnowledgeIngestionTools.query_knowledge_base-402"><span class="linenos">402</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-403"><a href="#KnowledgeIngestionTools.query_knowledge_base-403"><span class="linenos">403</span></a><span class="sd">        This tool is for SEARCHING existing knowledge, NOT for creative tasks like writing stories,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-404"><a href="#KnowledgeIngestionTools.query_knowledge_base-404"><span class="linenos">404</span></a><span class="sd">        generating content, or answering general questions. Use this only when you need to find</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-405"><a href="#KnowledgeIngestionTools.query_knowledge_base-405"><span class="linenos">405</span></a><span class="sd">        specific information that was previously stored in the knowledge base.</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-406"><a href="#KnowledgeIngestionTools.query_knowledge_base-406"><span class="linenos">406</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-407"><a href="#KnowledgeIngestionTools.query_knowledge_base-407"><span class="linenos">407</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-408"><a href="#KnowledgeIngestionTools.query_knowledge_base-408"><span class="linenos">408</span></a><span class="sd">            query: The search query for finding existing knowledge/documents</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-409"><a href="#KnowledgeIngestionTools.query_knowledge_base-409"><span class="linenos">409</span></a><span class="sd">            mode: Query mode - &quot;local&quot; (semantic), &quot;global&quot; (graph), &quot;hybrid&quot;, &quot;mix&quot;, &quot;auto&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-410"><a href="#KnowledgeIngestionTools.query_knowledge_base-410"><span class="linenos">410</span></a><span class="sd">            limit: Maximum number of results to return</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-411"><a href="#KnowledgeIngestionTools.query_knowledge_base-411"><span class="linenos">411</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-412"><a href="#KnowledgeIngestionTools.query_knowledge_base-412"><span class="linenos">412</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-413"><a href="#KnowledgeIngestionTools.query_knowledge_base-413"><span class="linenos">413</span></a><span class="sd">            Search results from the knowledge base, or rejection message for inappropriate requests.</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-414"><a href="#KnowledgeIngestionTools.query_knowledge_base-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-415"><a href="#KnowledgeIngestionTools.query_knowledge_base-415"><span class="linenos">415</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-416"><a href="#KnowledgeIngestionTools.query_knowledge_base-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-417"><a href="#KnowledgeIngestionTools.query_knowledge_base-417"><span class="linenos">417</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Query cannot be empty&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-418"><a href="#KnowledgeIngestionTools.query_knowledge_base-418"><span class="linenos">418</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-419"><a href="#KnowledgeIngestionTools.query_knowledge_base-419"><span class="linenos">419</span></a>            <span class="c1"># Filter out inappropriate creative requests</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-420"><a href="#KnowledgeIngestionTools.query_knowledge_base-420"><span class="linenos">420</span></a>            <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-421"><a href="#KnowledgeIngestionTools.query_knowledge_base-421"><span class="linenos">421</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-422"><a href="#KnowledgeIngestionTools.query_knowledge_base-422"><span class="linenos">422</span></a>            <span class="c1"># Creative/generative request patterns that should NOT use knowledge search</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-423"><a href="#KnowledgeIngestionTools.query_knowledge_base-423"><span class="linenos">423</span></a>            <span class="n">creative_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-424"><a href="#KnowledgeIngestionTools.query_knowledge_base-424"><span class="linenos">424</span></a>                <span class="s2">&quot;write&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-425"><a href="#KnowledgeIngestionTools.query_knowledge_base-425"><span class="linenos">425</span></a>                <span class="s2">&quot;create&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-426"><a href="#KnowledgeIngestionTools.query_knowledge_base-426"><span class="linenos">426</span></a>                <span class="s2">&quot;generate&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-427"><a href="#KnowledgeIngestionTools.query_knowledge_base-427"><span class="linenos">427</span></a>                <span class="s2">&quot;make&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-428"><a href="#KnowledgeIngestionTools.query_knowledge_base-428"><span class="linenos">428</span></a>                <span class="s2">&quot;compose&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-429"><a href="#KnowledgeIngestionTools.query_knowledge_base-429"><span class="linenos">429</span></a>                <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-430"><a href="#KnowledgeIngestionTools.query_knowledge_base-430"><span class="linenos">430</span></a>                <span class="s2">&quot;tell me a&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-431"><a href="#KnowledgeIngestionTools.query_knowledge_base-431"><span class="linenos">431</span></a>                <span class="s2">&quot;give me a&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-432"><a href="#KnowledgeIngestionTools.query_knowledge_base-432"><span class="linenos">432</span></a>                <span class="s2">&quot;come up with&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-433"><a href="#KnowledgeIngestionTools.query_knowledge_base-433"><span class="linenos">433</span></a>                <span class="s2">&quot;think of&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-434"><a href="#KnowledgeIngestionTools.query_knowledge_base-434"><span class="linenos">434</span></a>                <span class="s2">&quot;story&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-435"><a href="#KnowledgeIngestionTools.query_knowledge_base-435"><span class="linenos">435</span></a>                <span class="s2">&quot;poem&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-436"><a href="#KnowledgeIngestionTools.query_knowledge_base-436"><span class="linenos">436</span></a>                <span class="s2">&quot;joke&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-437"><a href="#KnowledgeIngestionTools.query_knowledge_base-437"><span class="linenos">437</span></a>                <span class="s2">&quot;song&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-438"><a href="#KnowledgeIngestionTools.query_knowledge_base-438"><span class="linenos">438</span></a>                <span class="s2">&quot;essay&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-439"><a href="#KnowledgeIngestionTools.query_knowledge_base-439"><span class="linenos">439</span></a>                <span class="s2">&quot;article&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-440"><a href="#KnowledgeIngestionTools.query_knowledge_base-440"><span class="linenos">440</span></a>                <span class="s2">&quot;funny&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-441"><a href="#KnowledgeIngestionTools.query_knowledge_base-441"><span class="linenos">441</span></a>                <span class="s2">&quot;creative&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-442"><a href="#KnowledgeIngestionTools.query_knowledge_base-442"><span class="linenos">442</span></a>                <span class="s2">&quot;imagine&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-443"><a href="#KnowledgeIngestionTools.query_knowledge_base-443"><span class="linenos">443</span></a>                <span class="s2">&quot;pretend&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-444"><a href="#KnowledgeIngestionTools.query_knowledge_base-444"><span class="linenos">444</span></a>            <span class="p">]</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-445"><a href="#KnowledgeIngestionTools.query_knowledge_base-445"><span class="linenos">445</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-446"><a href="#KnowledgeIngestionTools.query_knowledge_base-446"><span class="linenos">446</span></a>            <span class="c1"># Check if this looks like a creative request</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-447"><a href="#KnowledgeIngestionTools.query_knowledge_base-447"><span class="linenos">447</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">creative_patterns</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-448"><a href="#KnowledgeIngestionTools.query_knowledge_base-448"><span class="linenos">448</span></a>                <span class="c1"># Additional check: if it&#39;s asking for factual info WITH creative words, allow it</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-449"><a href="#KnowledgeIngestionTools.query_knowledge_base-449"><span class="linenos">449</span></a>                <span class="n">factual_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-450"><a href="#KnowledgeIngestionTools.query_knowledge_base-450"><span class="linenos">450</span></a>                    <span class="s2">&quot;what is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-451"><a href="#KnowledgeIngestionTools.query_knowledge_base-451"><span class="linenos">451</span></a>                    <span class="s2">&quot;who is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-452"><a href="#KnowledgeIngestionTools.query_knowledge_base-452"><span class="linenos">452</span></a>                    <span class="s2">&quot;when did&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-453"><a href="#KnowledgeIngestionTools.query_knowledge_base-453"><span class="linenos">453</span></a>                    <span class="s2">&quot;where is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-454"><a href="#KnowledgeIngestionTools.query_knowledge_base-454"><span class="linenos">454</span></a>                    <span class="s2">&quot;how does&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-455"><a href="#KnowledgeIngestionTools.query_knowledge_base-455"><span class="linenos">455</span></a>                    <span class="s2">&quot;definition of&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-456"><a href="#KnowledgeIngestionTools.query_knowledge_base-456"><span class="linenos">456</span></a>                    <span class="s2">&quot;information about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-457"><a href="#KnowledgeIngestionTools.query_knowledge_base-457"><span class="linenos">457</span></a>                    <span class="s2">&quot;facts about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-458"><a href="#KnowledgeIngestionTools.query_knowledge_base-458"><span class="linenos">458</span></a>                    <span class="s2">&quot;details about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-459"><a href="#KnowledgeIngestionTools.query_knowledge_base-459"><span class="linenos">459</span></a>                    <span class="s2">&quot;explain&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-460"><a href="#KnowledgeIngestionTools.query_knowledge_base-460"><span class="linenos">460</span></a>                    <span class="s2">&quot;describe&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-461"><a href="#KnowledgeIngestionTools.query_knowledge_base-461"><span class="linenos">461</span></a>                <span class="p">]</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-462"><a href="#KnowledgeIngestionTools.query_knowledge_base-462"><span class="linenos">462</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-463"><a href="#KnowledgeIngestionTools.query_knowledge_base-463"><span class="linenos">463</span></a>                <span class="c1"># If it has factual patterns, it might be legitimate</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-464"><a href="#KnowledgeIngestionTools.query_knowledge_base-464"><span class="linenos">464</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">factual</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">factual</span> <span class="ow">in</span> <span class="n">factual_patterns</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-465"><a href="#KnowledgeIngestionTools.query_knowledge_base-465"><span class="linenos">465</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-466"><a href="#KnowledgeIngestionTools.query_knowledge_base-466"><span class="linenos">466</span></a>                        <span class="sa">f</span><span class="s2">&quot;Rejected creative request for knowledge search: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-467"><a href="#KnowledgeIngestionTools.query_knowledge_base-467"><span class="linenos">467</span></a>                    <span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-468"><a href="#KnowledgeIngestionTools.query_knowledge_base-468"><span class="linenos">468</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; This appears to be a creative request (&#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;). The knowledge base is for searching existing stored information, not for generating new content. Please rephrase as a search for existing knowledge, or ask me to create content directly without using knowledge tools.&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-469"><a href="#KnowledgeIngestionTools.query_knowledge_base-469"><span class="linenos">469</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-470"><a href="#KnowledgeIngestionTools.query_knowledge_base-470"><span class="linenos">470</span></a>            <span class="c1"># Validate mode</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-471"><a href="#KnowledgeIngestionTools.query_knowledge_base-471"><span class="linenos">471</span></a>            <span class="n">valid_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="s2">&quot;hybrid&quot;</span><span class="p">,</span> <span class="s2">&quot;naive&quot;</span><span class="p">]</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-472"><a href="#KnowledgeIngestionTools.query_knowledge_base-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modes</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-473"><a href="#KnowledgeIngestionTools.query_knowledge_base-473"><span class="linenos">473</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;hybrid&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-474"><a href="#KnowledgeIngestionTools.query_knowledge_base-474"><span class="linenos">474</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mode not recognized, defaulting to &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-475"><a href="#KnowledgeIngestionTools.query_knowledge_base-475"><span class="linenos">475</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-476"><a href="#KnowledgeIngestionTools.query_knowledge_base-476"><span class="linenos">476</span></a>            <span class="c1"># Query LightRAG server</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-477"><a href="#KnowledgeIngestionTools.query_knowledge_base-477"><span class="linenos">477</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-478"><a href="#KnowledgeIngestionTools.query_knowledge_base-478"><span class="linenos">478</span></a>                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span><span class="si">}</span><span class="s2">/query&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-479"><a href="#KnowledgeIngestionTools.query_knowledge_base-479"><span class="linenos">479</span></a>                <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-480"><a href="#KnowledgeIngestionTools.query_knowledge_base-480"><span class="linenos">480</span></a>                    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-481"><a href="#KnowledgeIngestionTools.query_knowledge_base-481"><span class="linenos">481</span></a>                    <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-482"><a href="#KnowledgeIngestionTools.query_knowledge_base-482"><span class="linenos">482</span></a>                    <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-483"><a href="#KnowledgeIngestionTools.query_knowledge_base-483"><span class="linenos">483</span></a>                    <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">,</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-484"><a href="#KnowledgeIngestionTools.query_knowledge_base-484"><span class="linenos">484</span></a>                <span class="p">}</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-485"><a href="#KnowledgeIngestionTools.query_knowledge_base-485"><span class="linenos">485</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-486"><a href="#KnowledgeIngestionTools.query_knowledge_base-486"><span class="linenos">486</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-487"><a href="#KnowledgeIngestionTools.query_knowledge_base-487"><span class="linenos">487</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-488"><a href="#KnowledgeIngestionTools.query_knowledge_base-488"><span class="linenos">488</span></a>                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-489"><a href="#KnowledgeIngestionTools.query_knowledge_base-489"><span class="linenos">489</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-490"><a href="#KnowledgeIngestionTools.query_knowledge_base-490"><span class="linenos">490</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-491"><a href="#KnowledgeIngestionTools.query_knowledge_base-491"><span class="linenos">491</span></a>                    <span class="c1"># Extract the response content</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-492"><a href="#KnowledgeIngestionTools.query_knowledge_base-492"><span class="linenos">492</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-493"><a href="#KnowledgeIngestionTools.query_knowledge_base-493"><span class="linenos">493</span></a>                        <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-494"><a href="#KnowledgeIngestionTools.query_knowledge_base-494"><span class="linenos">494</span></a>                            <span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-495"><a href="#KnowledgeIngestionTools.query_knowledge_base-495"><span class="linenos">495</span></a>                        <span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-496"><a href="#KnowledgeIngestionTools.query_knowledge_base-496"><span class="linenos">496</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-497"><a href="#KnowledgeIngestionTools.query_knowledge_base-497"><span class="linenos">497</span></a>                        <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-498"><a href="#KnowledgeIngestionTools.query_knowledge_base-498"><span class="linenos">498</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-499"><a href="#KnowledgeIngestionTools.query_knowledge_base-499"><span class="linenos">499</span></a>                    <span class="k">if</span> <span class="n">content</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-500"><a href="#KnowledgeIngestionTools.query_knowledge_base-500"><span class="linenos">500</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Knowledge query successful: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-501"><a href="#KnowledgeIngestionTools.query_knowledge_base-501"><span class="linenos">501</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; KNOWLEDGE BASE QUERY (mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">):</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-502"><a href="#KnowledgeIngestionTools.query_knowledge_base-502"><span class="linenos">502</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-503"><a href="#KnowledgeIngestionTools.query_knowledge_base-503"><span class="linenos">503</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No relevant knowledge found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. Try different keywords or add more knowledge to your base.&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-504"><a href="#KnowledgeIngestionTools.query_knowledge_base-504"><span class="linenos">504</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-505"><a href="#KnowledgeIngestionTools.query_knowledge_base-505"><span class="linenos">505</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-506"><a href="#KnowledgeIngestionTools.query_knowledge_base-506"><span class="linenos">506</span></a>                    <span class="n">error_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-507"><a href="#KnowledgeIngestionTools.query_knowledge_base-507"><span class="linenos">507</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LightRAG query failed: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-508"><a href="#KnowledgeIngestionTools.query_knowledge_base-508"><span class="linenos">508</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-509"><a href="#KnowledgeIngestionTools.query_knowledge_base-509"><span class="linenos">509</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-510"><a href="#KnowledgeIngestionTools.query_knowledge_base-510"><span class="linenos">510</span></a>            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-511"><a href="#KnowledgeIngestionTools.query_knowledge_base-511"><span class="linenos">511</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error connecting to LightRAG server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-512"><a href="#KnowledgeIngestionTools.query_knowledge_base-512"><span class="linenos">512</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error connecting to knowledge base server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-513"><a href="#KnowledgeIngestionTools.query_knowledge_base-513"><span class="linenos">513</span></a>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-514"><a href="#KnowledgeIngestionTools.query_knowledge_base-514"><span class="linenos">514</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-515"><a href="#KnowledgeIngestionTools.query_knowledge_base-515"><span class="linenos">515</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeIngestionTools.query_knowledge_base-516"><a href="#KnowledgeIngestionTools.query_knowledge_base-516"><span class="linenos">516</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Query the unified knowledge base to retrieve stored factual information and documents.</p>

<p>This tool is for SEARCHING existing knowledge, NOT for creative tasks like writing stories,
generating content, or answering general questions. Use this only when you need to find
specific information that was previously stored in the knowledge base.</p>

<p>Args:
    query: The search query for finding existing knowledge/documents
    mode: Query mode - "local" (semantic), "global" (graph), "hybrid", "mix", "auto"
    limit: Maximum number of results to return</p>

<p>Returns:
    Search results from the knowledge base, or rejection message for inappropriate requests.</p>
</div>


                            </div>
                </section>
                <section id="SemanticKnowledgeIngestionTools">
                            <input id="SemanticKnowledgeIngestionTools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SemanticKnowledgeIngestionTools</span><wbr>(<span class="base">agno.tools.toolkit.Toolkit</span>):

                <label class="view-source-button" for="SemanticKnowledgeIngestionTools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticKnowledgeIngestionTools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticKnowledgeIngestionTools-35"><a href="#SemanticKnowledgeIngestionTools-35"><span class="linenos"> 35</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SemanticKnowledgeIngestionTools</span><span class="p">(</span><span class="n">Toolkit</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-36"><a href="#SemanticKnowledgeIngestionTools-36"><span class="linenos"> 36</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-37"><a href="#SemanticKnowledgeIngestionTools-37"><span class="linenos"> 37</span></a><span class="sd">    Semantic knowledge ingestion tools for adding files and content to the local LanceDB knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools-38"><a href="#SemanticKnowledgeIngestionTools-38"><span class="linenos"> 38</span></a>
</span><span id="SemanticKnowledgeIngestionTools-39"><a href="#SemanticKnowledgeIngestionTools-39"><span class="linenos"> 39</span></a><span class="sd">    Args:</span>
</span><span id="SemanticKnowledgeIngestionTools-40"><a href="#SemanticKnowledgeIngestionTools-40"><span class="linenos"> 40</span></a><span class="sd">        ingest_file (bool): Enable file ingestion functionality.</span>
</span><span id="SemanticKnowledgeIngestionTools-41"><a href="#SemanticKnowledgeIngestionTools-41"><span class="linenos"> 41</span></a><span class="sd">        ingest_text (bool): Enable direct text ingestion functionality.</span>
</span><span id="SemanticKnowledgeIngestionTools-42"><a href="#SemanticKnowledgeIngestionTools-42"><span class="linenos"> 42</span></a><span class="sd">        ingest_url (bool): Enable URL content ingestion functionality.</span>
</span><span id="SemanticKnowledgeIngestionTools-43"><a href="#SemanticKnowledgeIngestionTools-43"><span class="linenos"> 43</span></a><span class="sd">        batch_ingest (bool): Enable batch directory ingestion functionality.</span>
</span><span id="SemanticKnowledgeIngestionTools-44"><a href="#SemanticKnowledgeIngestionTools-44"><span class="linenos"> 44</span></a><span class="sd">        query_knowledge (bool): Enable semantic knowledge querying functionality.</span>
</span><span id="SemanticKnowledgeIngestionTools-45"><a href="#SemanticKnowledgeIngestionTools-45"><span class="linenos"> 45</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-46"><a href="#SemanticKnowledgeIngestionTools-46"><span class="linenos"> 46</span></a>
</span><span id="SemanticKnowledgeIngestionTools-47"><a href="#SemanticKnowledgeIngestionTools-47"><span class="linenos"> 47</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-48"><a href="#SemanticKnowledgeIngestionTools-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-49"><a href="#SemanticKnowledgeIngestionTools-49"><span class="linenos"> 49</span></a>        <span class="n">ingest_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-50"><a href="#SemanticKnowledgeIngestionTools-50"><span class="linenos"> 50</span></a>        <span class="n">ingest_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-51"><a href="#SemanticKnowledgeIngestionTools-51"><span class="linenos"> 51</span></a>        <span class="n">ingest_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-52"><a href="#SemanticKnowledgeIngestionTools-52"><span class="linenos"> 52</span></a>        <span class="n">batch_ingest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-53"><a href="#SemanticKnowledgeIngestionTools-53"><span class="linenos"> 53</span></a>        <span class="n">query_knowledge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-54"><a href="#SemanticKnowledgeIngestionTools-54"><span class="linenos"> 54</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-55"><a href="#SemanticKnowledgeIngestionTools-55"><span class="linenos"> 55</span></a>    <span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-56"><a href="#SemanticKnowledgeIngestionTools-56"><span class="linenos"> 56</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticKnowledgeIngestionTools-57"><a href="#SemanticKnowledgeIngestionTools-57"><span class="linenos"> 57</span></a>
</span><span id="SemanticKnowledgeIngestionTools-58"><a href="#SemanticKnowledgeIngestionTools-58"><span class="linenos"> 58</span></a>        <span class="k">if</span> <span class="n">ingest_file</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-59"><a href="#SemanticKnowledgeIngestionTools-59"><span class="linenos"> 59</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_file</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-60"><a href="#SemanticKnowledgeIngestionTools-60"><span class="linenos"> 60</span></a>        <span class="k">if</span> <span class="n">ingest_text</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-61"><a href="#SemanticKnowledgeIngestionTools-61"><span class="linenos"> 61</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_text</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-62"><a href="#SemanticKnowledgeIngestionTools-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="n">ingest_url</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-63"><a href="#SemanticKnowledgeIngestionTools-63"><span class="linenos"> 63</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_from_url</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-64"><a href="#SemanticKnowledgeIngestionTools-64"><span class="linenos"> 64</span></a>        <span class="k">if</span> <span class="n">batch_ingest</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-65"><a href="#SemanticKnowledgeIngestionTools-65"><span class="linenos"> 65</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_ingest_semantic_directory</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-66"><a href="#SemanticKnowledgeIngestionTools-66"><span class="linenos"> 66</span></a>        <span class="k">if</span> <span class="n">query_knowledge</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-67"><a href="#SemanticKnowledgeIngestionTools-67"><span class="linenos"> 67</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_semantic_knowledge</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-68"><a href="#SemanticKnowledgeIngestionTools-68"><span class="linenos"> 68</span></a>
</span><span id="SemanticKnowledgeIngestionTools-69"><a href="#SemanticKnowledgeIngestionTools-69"><span class="linenos"> 69</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;semantic_knowledge_ingestion&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-70"><a href="#SemanticKnowledgeIngestionTools-70"><span class="linenos"> 70</span></a>
</span><span id="SemanticKnowledgeIngestionTools-71"><a href="#SemanticKnowledgeIngestionTools-71"><span class="linenos"> 71</span></a>        <span class="c1"># Initialize knowledge base reference</span>
</span><span id="SemanticKnowledgeIngestionTools-72"><a href="#SemanticKnowledgeIngestionTools-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_knowledge_base</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SemanticKnowledgeIngestionTools-73"><a href="#SemanticKnowledgeIngestionTools-73"><span class="linenos"> 73</span></a>
</span><span id="SemanticKnowledgeIngestionTools-74"><a href="#SemanticKnowledgeIngestionTools-74"><span class="linenos"> 74</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_knowledge_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-75"><a href="#SemanticKnowledgeIngestionTools-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or create the semantic knowledge base instance.&quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-76"><a href="#SemanticKnowledgeIngestionTools-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_knowledge_base</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-77"><a href="#SemanticKnowledgeIngestionTools-77"><span class="linenos"> 77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_knowledge_base</span> <span class="o">=</span> <span class="n">create_combined_knowledge_base</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-78"><a href="#SemanticKnowledgeIngestionTools-78"><span class="linenos"> 78</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_knowledge_base</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-79"><a href="#SemanticKnowledgeIngestionTools-79"><span class="linenos"> 79</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to create semantic knowledge base&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-80"><a href="#SemanticKnowledgeIngestionTools-80"><span class="linenos"> 80</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_knowledge_base</span>
</span><span id="SemanticKnowledgeIngestionTools-81"><a href="#SemanticKnowledgeIngestionTools-81"><span class="linenos"> 81</span></a>
</span><span id="SemanticKnowledgeIngestionTools-82"><a href="#SemanticKnowledgeIngestionTools-82"><span class="linenos"> 82</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_reload_knowledge_base_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledge_base</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-83"><a href="#SemanticKnowledgeIngestionTools-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the knowledge base synchronously to avoid event loop issues.&quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-84"><a href="#SemanticKnowledgeIngestionTools-84"><span class="linenos"> 84</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-85"><a href="#SemanticKnowledgeIngestionTools-85"><span class="linenos"> 85</span></a>            <span class="c1"># Use the synchronous load method instead of async</span>
</span><span id="SemanticKnowledgeIngestionTools-86"><a href="#SemanticKnowledgeIngestionTools-86"><span class="linenos"> 86</span></a>            <span class="n">knowledge_base</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-87"><a href="#SemanticKnowledgeIngestionTools-87"><span class="linenos"> 87</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully reloaded semantic knowledge base&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-88"><a href="#SemanticKnowledgeIngestionTools-88"><span class="linenos"> 88</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-89"><a href="#SemanticKnowledgeIngestionTools-89"><span class="linenos"> 89</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reloading knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-90"><a href="#SemanticKnowledgeIngestionTools-90"><span class="linenos"> 90</span></a>            <span class="k">raise</span>
</span><span id="SemanticKnowledgeIngestionTools-91"><a href="#SemanticKnowledgeIngestionTools-91"><span class="linenos"> 91</span></a>
</span><span id="SemanticKnowledgeIngestionTools-92"><a href="#SemanticKnowledgeIngestionTools-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_semantic_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-93"><a href="#SemanticKnowledgeIngestionTools-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest a file into the local semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools-94"><a href="#SemanticKnowledgeIngestionTools-94"><span class="linenos"> 94</span></a>
</span><span id="SemanticKnowledgeIngestionTools-95"><a href="#SemanticKnowledgeIngestionTools-95"><span class="linenos"> 95</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools-96"><a href="#SemanticKnowledgeIngestionTools-96"><span class="linenos"> 96</span></a><span class="sd">            file_path: Path to the file to ingest</span>
</span><span id="SemanticKnowledgeIngestionTools-97"><a href="#SemanticKnowledgeIngestionTools-97"><span class="linenos"> 97</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to filename)</span>
</span><span id="SemanticKnowledgeIngestionTools-98"><a href="#SemanticKnowledgeIngestionTools-98"><span class="linenos"> 98</span></a>
</span><span id="SemanticKnowledgeIngestionTools-99"><a href="#SemanticKnowledgeIngestionTools-99"><span class="linenos"> 99</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools-100"><a href="#SemanticKnowledgeIngestionTools-100"><span class="linenos">100</span></a><span class="sd">            Success message or error details.</span>
</span><span id="SemanticKnowledgeIngestionTools-101"><a href="#SemanticKnowledgeIngestionTools-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-102"><a href="#SemanticKnowledgeIngestionTools-102"><span class="linenos">102</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-103"><a href="#SemanticKnowledgeIngestionTools-103"><span class="linenos">103</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="SemanticKnowledgeIngestionTools-104"><a href="#SemanticKnowledgeIngestionTools-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-105"><a href="#SemanticKnowledgeIngestionTools-105"><span class="linenos">105</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-106"><a href="#SemanticKnowledgeIngestionTools-106"><span class="linenos">106</span></a>            <span class="k">elif</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-107"><a href="#SemanticKnowledgeIngestionTools-107"><span class="linenos">107</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-108"><a href="#SemanticKnowledgeIngestionTools-108"><span class="linenos">108</span></a>
</span><span id="SemanticKnowledgeIngestionTools-109"><a href="#SemanticKnowledgeIngestionTools-109"><span class="linenos">109</span></a>            <span class="c1"># Validate file exists</span>
</span><span id="SemanticKnowledgeIngestionTools-110"><a href="#SemanticKnowledgeIngestionTools-110"><span class="linenos">110</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-111"><a href="#SemanticKnowledgeIngestionTools-111"><span class="linenos">111</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File not found at &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-112"><a href="#SemanticKnowledgeIngestionTools-112"><span class="linenos">112</span></a>
</span><span id="SemanticKnowledgeIngestionTools-113"><a href="#SemanticKnowledgeIngestionTools-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-114"><a href="#SemanticKnowledgeIngestionTools-114"><span class="linenos">114</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; is not a file&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-115"><a href="#SemanticKnowledgeIngestionTools-115"><span class="linenos">115</span></a>
</span><span id="SemanticKnowledgeIngestionTools-116"><a href="#SemanticKnowledgeIngestionTools-116"><span class="linenos">116</span></a>            <span class="c1"># Get file info</span>
</span><span id="SemanticKnowledgeIngestionTools-117"><a href="#SemanticKnowledgeIngestionTools-117"><span class="linenos">117</span></a>            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-118"><a href="#SemanticKnowledgeIngestionTools-118"><span class="linenos">118</span></a>            <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 50MB limit</span>
</span><span id="SemanticKnowledgeIngestionTools-119"><a href="#SemanticKnowledgeIngestionTools-119"><span class="linenos">119</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File too large (</span><span class="si">{</span><span class="n">file_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB). Maximum size is 50MB.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-120"><a href="#SemanticKnowledgeIngestionTools-120"><span class="linenos">120</span></a>
</span><span id="SemanticKnowledgeIngestionTools-121"><a href="#SemanticKnowledgeIngestionTools-121"><span class="linenos">121</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-122"><a href="#SemanticKnowledgeIngestionTools-122"><span class="linenos">122</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-123"><a href="#SemanticKnowledgeIngestionTools-123"><span class="linenos">123</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools-124"><a href="#SemanticKnowledgeIngestionTools-124"><span class="linenos">124</span></a>
</span><span id="SemanticKnowledgeIngestionTools-125"><a href="#SemanticKnowledgeIngestionTools-125"><span class="linenos">125</span></a>            <span class="c1"># Check file type</span>
</span><span id="SemanticKnowledgeIngestionTools-126"><a href="#SemanticKnowledgeIngestionTools-126"><span class="linenos">126</span></a>            <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-127"><a href="#SemanticKnowledgeIngestionTools-127"><span class="linenos">127</span></a>            <span class="n">supported_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticKnowledgeIngestionTools-128"><a href="#SemanticKnowledgeIngestionTools-128"><span class="linenos">128</span></a>                <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-129"><a href="#SemanticKnowledgeIngestionTools-129"><span class="linenos">129</span></a>                <span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-130"><a href="#SemanticKnowledgeIngestionTools-130"><span class="linenos">130</span></a>                <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-131"><a href="#SemanticKnowledgeIngestionTools-131"><span class="linenos">131</span></a>                <span class="s2">&quot;text/csv&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-132"><a href="#SemanticKnowledgeIngestionTools-132"><span class="linenos">132</span></a>                <span class="s2">&quot;application/pdf&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-133"><a href="#SemanticKnowledgeIngestionTools-133"><span class="linenos">133</span></a>                <span class="s2">&quot;application/msword&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-134"><a href="#SemanticKnowledgeIngestionTools-134"><span class="linenos">134</span></a>                <span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-135"><a href="#SemanticKnowledgeIngestionTools-135"><span class="linenos">135</span></a>            <span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools-136"><a href="#SemanticKnowledgeIngestionTools-136"><span class="linenos">136</span></a>
</span><span id="SemanticKnowledgeIngestionTools-137"><a href="#SemanticKnowledgeIngestionTools-137"><span class="linenos">137</span></a>            <span class="k">if</span> <span class="n">mime_type</span> <span class="ow">and</span> <span class="n">mime_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_types</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-138"><a href="#SemanticKnowledgeIngestionTools-138"><span class="linenos">138</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File type </span><span class="si">{</span><span class="n">mime_type</span><span class="si">}</span><span class="s2"> may not be fully supported&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-139"><a href="#SemanticKnowledgeIngestionTools-139"><span class="linenos">139</span></a>
</span><span id="SemanticKnowledgeIngestionTools-140"><a href="#SemanticKnowledgeIngestionTools-140"><span class="linenos">140</span></a>            <span class="c1"># Copy file to semantic knowledge directory</span>
</span><span id="SemanticKnowledgeIngestionTools-141"><a href="#SemanticKnowledgeIngestionTools-141"><span class="linenos">141</span></a>            <span class="n">semantic_knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATA_DIR</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;knowledge&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-142"><a href="#SemanticKnowledgeIngestionTools-142"><span class="linenos">142</span></a>            <span class="n">semantic_knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-143"><a href="#SemanticKnowledgeIngestionTools-143"><span class="linenos">143</span></a>
</span><span id="SemanticKnowledgeIngestionTools-144"><a href="#SemanticKnowledgeIngestionTools-144"><span class="linenos">144</span></a>            <span class="c1"># Create unique filename to avoid conflicts</span>
</span><span id="SemanticKnowledgeIngestionTools-145"><a href="#SemanticKnowledgeIngestionTools-145"><span class="linenos">145</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="SemanticKnowledgeIngestionTools-146"><a href="#SemanticKnowledgeIngestionTools-146"><span class="linenos">146</span></a>            <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools-147"><a href="#SemanticKnowledgeIngestionTools-147"><span class="linenos">147</span></a>            <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-148"><a href="#SemanticKnowledgeIngestionTools-148"><span class="linenos">148</span></a>            <span class="n">unique_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-149"><a href="#SemanticKnowledgeIngestionTools-149"><span class="linenos">149</span></a>
</span><span id="SemanticKnowledgeIngestionTools-150"><a href="#SemanticKnowledgeIngestionTools-150"><span class="linenos">150</span></a>            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">semantic_knowledge_dir</span> <span class="o">/</span> <span class="n">unique_filename</span>
</span><span id="SemanticKnowledgeIngestionTools-151"><a href="#SemanticKnowledgeIngestionTools-151"><span class="linenos">151</span></a>
</span><span id="SemanticKnowledgeIngestionTools-152"><a href="#SemanticKnowledgeIngestionTools-152"><span class="linenos">152</span></a>            <span class="c1"># Copy the file</span>
</span><span id="SemanticKnowledgeIngestionTools-153"><a href="#SemanticKnowledgeIngestionTools-153"><span class="linenos">153</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-154"><a href="#SemanticKnowledgeIngestionTools-154"><span class="linenos">154</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied file to semantic knowledge directory: </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-155"><a href="#SemanticKnowledgeIngestionTools-155"><span class="linenos">155</span></a>
</span><span id="SemanticKnowledgeIngestionTools-156"><a href="#SemanticKnowledgeIngestionTools-156"><span class="linenos">156</span></a>            <span class="c1"># Reload the knowledge base to include the new file</span>
</span><span id="SemanticKnowledgeIngestionTools-157"><a href="#SemanticKnowledgeIngestionTools-157"><span class="linenos">157</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-158"><a href="#SemanticKnowledgeIngestionTools-158"><span class="linenos">158</span></a>                <span class="n">knowledge_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_knowledge_base</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-159"><a href="#SemanticKnowledgeIngestionTools-159"><span class="linenos">159</span></a>                <span class="c1"># Recreate the knowledge base to include new files</span>
</span><span id="SemanticKnowledgeIngestionTools-160"><a href="#SemanticKnowledgeIngestionTools-160"><span class="linenos">160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_reload_knowledge_base_sync</span><span class="p">(</span><span class="n">knowledge_base</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-161"><a href="#SemanticKnowledgeIngestionTools-161"><span class="linenos">161</span></a>                
</span><span id="SemanticKnowledgeIngestionTools-162"><a href="#SemanticKnowledgeIngestionTools-162"><span class="linenos">162</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested semantic knowledge file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-163"><a href="#SemanticKnowledgeIngestionTools-163"><span class="linenos">163</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; into semantic knowledge base and reloaded vector embeddings.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-164"><a href="#SemanticKnowledgeIngestionTools-164"><span class="linenos">164</span></a>                
</span><span id="SemanticKnowledgeIngestionTools-165"><a href="#SemanticKnowledgeIngestionTools-165"><span class="linenos">165</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-166"><a href="#SemanticKnowledgeIngestionTools-166"><span class="linenos">166</span></a>                <span class="c1"># Clean up the copied file if knowledge base reload failed</span>
</span><span id="SemanticKnowledgeIngestionTools-167"><a href="#SemanticKnowledgeIngestionTools-167"><span class="linenos">167</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-168"><a href="#SemanticKnowledgeIngestionTools-168"><span class="linenos">168</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-169"><a href="#SemanticKnowledgeIngestionTools-169"><span class="linenos">169</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-170"><a href="#SemanticKnowledgeIngestionTools-170"><span class="linenos">170</span></a>                    <span class="k">pass</span>
</span><span id="SemanticKnowledgeIngestionTools-171"><a href="#SemanticKnowledgeIngestionTools-171"><span class="linenos">171</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to reload knowledge base after adding </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-172"><a href="#SemanticKnowledgeIngestionTools-172"><span class="linenos">172</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;: Error reloading knowledge base - </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-173"><a href="#SemanticKnowledgeIngestionTools-173"><span class="linenos">173</span></a>
</span><span id="SemanticKnowledgeIngestionTools-174"><a href="#SemanticKnowledgeIngestionTools-174"><span class="linenos">174</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-175"><a href="#SemanticKnowledgeIngestionTools-175"><span class="linenos">175</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting semantic file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-176"><a href="#SemanticKnowledgeIngestionTools-176"><span class="linenos">176</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-177"><a href="#SemanticKnowledgeIngestionTools-177"><span class="linenos">177</span></a>
</span><span id="SemanticKnowledgeIngestionTools-178"><a href="#SemanticKnowledgeIngestionTools-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_semantic_text</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-179"><a href="#SemanticKnowledgeIngestionTools-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-180"><a href="#SemanticKnowledgeIngestionTools-180"><span class="linenos">180</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-181"><a href="#SemanticKnowledgeIngestionTools-181"><span class="linenos">181</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest text content directly into the local semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools-182"><a href="#SemanticKnowledgeIngestionTools-182"><span class="linenos">182</span></a>
</span><span id="SemanticKnowledgeIngestionTools-183"><a href="#SemanticKnowledgeIngestionTools-183"><span class="linenos">183</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools-184"><a href="#SemanticKnowledgeIngestionTools-184"><span class="linenos">184</span></a><span class="sd">            content: The text content to ingest</span>
</span><span id="SemanticKnowledgeIngestionTools-185"><a href="#SemanticKnowledgeIngestionTools-185"><span class="linenos">185</span></a><span class="sd">            title: Title for the knowledge entry</span>
</span><span id="SemanticKnowledgeIngestionTools-186"><a href="#SemanticKnowledgeIngestionTools-186"><span class="linenos">186</span></a><span class="sd">            file_type: File extension to use (txt, md, html, etc.)</span>
</span><span id="SemanticKnowledgeIngestionTools-187"><a href="#SemanticKnowledgeIngestionTools-187"><span class="linenos">187</span></a>
</span><span id="SemanticKnowledgeIngestionTools-188"><a href="#SemanticKnowledgeIngestionTools-188"><span class="linenos">188</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools-189"><a href="#SemanticKnowledgeIngestionTools-189"><span class="linenos">189</span></a><span class="sd">            Success message or error details.</span>
</span><span id="SemanticKnowledgeIngestionTools-190"><a href="#SemanticKnowledgeIngestionTools-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-191"><a href="#SemanticKnowledgeIngestionTools-191"><span class="linenos">191</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-192"><a href="#SemanticKnowledgeIngestionTools-192"><span class="linenos">192</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="SemanticKnowledgeIngestionTools-193"><a href="#SemanticKnowledgeIngestionTools-193"><span class="linenos">193</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Content cannot be empty&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-194"><a href="#SemanticKnowledgeIngestionTools-194"><span class="linenos">194</span></a>
</span><span id="SemanticKnowledgeIngestionTools-195"><a href="#SemanticKnowledgeIngestionTools-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="SemanticKnowledgeIngestionTools-196"><a href="#SemanticKnowledgeIngestionTools-196"><span class="linenos">196</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Title is required&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-197"><a href="#SemanticKnowledgeIngestionTools-197"><span class="linenos">197</span></a>
</span><span id="SemanticKnowledgeIngestionTools-198"><a href="#SemanticKnowledgeIngestionTools-198"><span class="linenos">198</span></a>            <span class="c1"># Validate file_type</span>
</span><span id="SemanticKnowledgeIngestionTools-199"><a href="#SemanticKnowledgeIngestionTools-199"><span class="linenos">199</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-200"><a href="#SemanticKnowledgeIngestionTools-200"><span class="linenos">200</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-201"><a href="#SemanticKnowledgeIngestionTools-201"><span class="linenos">201</span></a>
</span><span id="SemanticKnowledgeIngestionTools-202"><a href="#SemanticKnowledgeIngestionTools-202"><span class="linenos">202</span></a>            <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;.md&quot;</span><span class="p">,</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools-203"><a href="#SemanticKnowledgeIngestionTools-203"><span class="linenos">203</span></a>            <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-204"><a href="#SemanticKnowledgeIngestionTools-204"><span class="linenos">204</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;.txt&quot;</span>  <span class="c1"># Default to txt</span>
</span><span id="SemanticKnowledgeIngestionTools-205"><a href="#SemanticKnowledgeIngestionTools-205"><span class="linenos">205</span></a>
</span><span id="SemanticKnowledgeIngestionTools-206"><a href="#SemanticKnowledgeIngestionTools-206"><span class="linenos">206</span></a>            <span class="c1"># Create semantic knowledge directory</span>
</span><span id="SemanticKnowledgeIngestionTools-207"><a href="#SemanticKnowledgeIngestionTools-207"><span class="linenos">207</span></a>            <span class="n">semantic_knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATA_DIR</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;knowledge&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-208"><a href="#SemanticKnowledgeIngestionTools-208"><span class="linenos">208</span></a>            <span class="n">semantic_knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-209"><a href="#SemanticKnowledgeIngestionTools-209"><span class="linenos">209</span></a>
</span><span id="SemanticKnowledgeIngestionTools-210"><a href="#SemanticKnowledgeIngestionTools-210"><span class="linenos">210</span></a>            <span class="c1"># Create unique filename</span>
</span><span id="SemanticKnowledgeIngestionTools-211"><a href="#SemanticKnowledgeIngestionTools-211"><span class="linenos">211</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="SemanticKnowledgeIngestionTools-212"><a href="#SemanticKnowledgeIngestionTools-212"><span class="linenos">212</span></a>            <span class="n">content_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-213"><a href="#SemanticKnowledgeIngestionTools-213"><span class="linenos">213</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-214"><a href="#SemanticKnowledgeIngestionTools-214"><span class="linenos">214</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools-215"><a href="#SemanticKnowledgeIngestionTools-215"><span class="linenos">215</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-216"><a href="#SemanticKnowledgeIngestionTools-216"><span class="linenos">216</span></a>                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">title</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-217"><a href="#SemanticKnowledgeIngestionTools-217"><span class="linenos">217</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-218"><a href="#SemanticKnowledgeIngestionTools-218"><span class="linenos">218</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="n">safe_title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>  <span class="c1"># Limit length</span>
</span><span id="SemanticKnowledgeIngestionTools-219"><a href="#SemanticKnowledgeIngestionTools-219"><span class="linenos">219</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content_hash</span><span class="si">}{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-220"><a href="#SemanticKnowledgeIngestionTools-220"><span class="linenos">220</span></a>
</span><span id="SemanticKnowledgeIngestionTools-221"><a href="#SemanticKnowledgeIngestionTools-221"><span class="linenos">221</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">semantic_knowledge_dir</span> <span class="o">/</span> <span class="n">filename</span>
</span><span id="SemanticKnowledgeIngestionTools-222"><a href="#SemanticKnowledgeIngestionTools-222"><span class="linenos">222</span></a>
</span><span id="SemanticKnowledgeIngestionTools-223"><a href="#SemanticKnowledgeIngestionTools-223"><span class="linenos">223</span></a>            <span class="c1"># Write content to file</span>
</span><span id="SemanticKnowledgeIngestionTools-224"><a href="#SemanticKnowledgeIngestionTools-224"><span class="linenos">224</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-225"><a href="#SemanticKnowledgeIngestionTools-225"><span class="linenos">225</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-226"><a href="#SemanticKnowledgeIngestionTools-226"><span class="linenos">226</span></a>
</span><span id="SemanticKnowledgeIngestionTools-227"><a href="#SemanticKnowledgeIngestionTools-227"><span class="linenos">227</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created semantic knowledge file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-228"><a href="#SemanticKnowledgeIngestionTools-228"><span class="linenos">228</span></a>
</span><span id="SemanticKnowledgeIngestionTools-229"><a href="#SemanticKnowledgeIngestionTools-229"><span class="linenos">229</span></a>            <span class="c1"># Reload the knowledge base to include the new content</span>
</span><span id="SemanticKnowledgeIngestionTools-230"><a href="#SemanticKnowledgeIngestionTools-230"><span class="linenos">230</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-231"><a href="#SemanticKnowledgeIngestionTools-231"><span class="linenos">231</span></a>                <span class="n">knowledge_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_knowledge_base</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-232"><a href="#SemanticKnowledgeIngestionTools-232"><span class="linenos">232</span></a>                <span class="c1"># Recreate the knowledge base to include new files</span>
</span><span id="SemanticKnowledgeIngestionTools-233"><a href="#SemanticKnowledgeIngestionTools-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_reload_knowledge_base_sync</span><span class="p">(</span><span class="n">knowledge_base</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-234"><a href="#SemanticKnowledgeIngestionTools-234"><span class="linenos">234</span></a>                
</span><span id="SemanticKnowledgeIngestionTools-235"><a href="#SemanticKnowledgeIngestionTools-235"><span class="linenos">235</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested semantic knowledge text: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-236"><a href="#SemanticKnowledgeIngestionTools-236"><span class="linenos">236</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39; into semantic knowledge base and reloaded vector embeddings.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-237"><a href="#SemanticKnowledgeIngestionTools-237"><span class="linenos">237</span></a>                
</span><span id="SemanticKnowledgeIngestionTools-238"><a href="#SemanticKnowledgeIngestionTools-238"><span class="linenos">238</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-239"><a href="#SemanticKnowledgeIngestionTools-239"><span class="linenos">239</span></a>                <span class="c1"># Clean up the created file if knowledge base reload failed</span>
</span><span id="SemanticKnowledgeIngestionTools-240"><a href="#SemanticKnowledgeIngestionTools-240"><span class="linenos">240</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-241"><a href="#SemanticKnowledgeIngestionTools-241"><span class="linenos">241</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-242"><a href="#SemanticKnowledgeIngestionTools-242"><span class="linenos">242</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-243"><a href="#SemanticKnowledgeIngestionTools-243"><span class="linenos">243</span></a>                    <span class="k">pass</span>
</span><span id="SemanticKnowledgeIngestionTools-244"><a href="#SemanticKnowledgeIngestionTools-244"><span class="linenos">244</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to reload knowledge base after adding </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-245"><a href="#SemanticKnowledgeIngestionTools-245"><span class="linenos">245</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;: Error reloading knowledge base - </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-246"><a href="#SemanticKnowledgeIngestionTools-246"><span class="linenos">246</span></a>
</span><span id="SemanticKnowledgeIngestionTools-247"><a href="#SemanticKnowledgeIngestionTools-247"><span class="linenos">247</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-248"><a href="#SemanticKnowledgeIngestionTools-248"><span class="linenos">248</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting semantic text content: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-249"><a href="#SemanticKnowledgeIngestionTools-249"><span class="linenos">249</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting text content: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-250"><a href="#SemanticKnowledgeIngestionTools-250"><span class="linenos">250</span></a>
</span><span id="SemanticKnowledgeIngestionTools-251"><a href="#SemanticKnowledgeIngestionTools-251"><span class="linenos">251</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_semantic_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-252"><a href="#SemanticKnowledgeIngestionTools-252"><span class="linenos">252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest content from a URL into the local semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools-253"><a href="#SemanticKnowledgeIngestionTools-253"><span class="linenos">253</span></a>
</span><span id="SemanticKnowledgeIngestionTools-254"><a href="#SemanticKnowledgeIngestionTools-254"><span class="linenos">254</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools-255"><a href="#SemanticKnowledgeIngestionTools-255"><span class="linenos">255</span></a><span class="sd">            url: URL to fetch content from</span>
</span><span id="SemanticKnowledgeIngestionTools-256"><a href="#SemanticKnowledgeIngestionTools-256"><span class="linenos">256</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to page title or URL)</span>
</span><span id="SemanticKnowledgeIngestionTools-257"><a href="#SemanticKnowledgeIngestionTools-257"><span class="linenos">257</span></a>
</span><span id="SemanticKnowledgeIngestionTools-258"><a href="#SemanticKnowledgeIngestionTools-258"><span class="linenos">258</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools-259"><a href="#SemanticKnowledgeIngestionTools-259"><span class="linenos">259</span></a><span class="sd">            Success message or error details.</span>
</span><span id="SemanticKnowledgeIngestionTools-260"><a href="#SemanticKnowledgeIngestionTools-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-261"><a href="#SemanticKnowledgeIngestionTools-261"><span class="linenos">261</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-262"><a href="#SemanticKnowledgeIngestionTools-262"><span class="linenos">262</span></a>            <span class="c1"># Validate URL</span>
</span><span id="SemanticKnowledgeIngestionTools-263"><a href="#SemanticKnowledgeIngestionTools-263"><span class="linenos">263</span></a>            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-264"><a href="#SemanticKnowledgeIngestionTools-264"><span class="linenos">264</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-265"><a href="#SemanticKnowledgeIngestionTools-265"><span class="linenos">265</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Invalid URL format: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-266"><a href="#SemanticKnowledgeIngestionTools-266"><span class="linenos">266</span></a>
</span><span id="SemanticKnowledgeIngestionTools-267"><a href="#SemanticKnowledgeIngestionTools-267"><span class="linenos">267</span></a>            <span class="c1"># Fetch content</span>
</span><span id="SemanticKnowledgeIngestionTools-268"><a href="#SemanticKnowledgeIngestionTools-268"><span class="linenos">268</span></a>            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SemanticKnowledgeIngestionTools-269"><a href="#SemanticKnowledgeIngestionTools-269"><span class="linenos">269</span></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-270"><a href="#SemanticKnowledgeIngestionTools-270"><span class="linenos">270</span></a>            <span class="p">}</span>
</span><span id="SemanticKnowledgeIngestionTools-271"><a href="#SemanticKnowledgeIngestionTools-271"><span class="linenos">271</span></a>
</span><span id="SemanticKnowledgeIngestionTools-272"><a href="#SemanticKnowledgeIngestionTools-272"><span class="linenos">272</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-273"><a href="#SemanticKnowledgeIngestionTools-273"><span class="linenos">273</span></a>            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-274"><a href="#SemanticKnowledgeIngestionTools-274"><span class="linenos">274</span></a>
</span><span id="SemanticKnowledgeIngestionTools-275"><a href="#SemanticKnowledgeIngestionTools-275"><span class="linenos">275</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-276"><a href="#SemanticKnowledgeIngestionTools-276"><span class="linenos">276</span></a>
</span><span id="SemanticKnowledgeIngestionTools-277"><a href="#SemanticKnowledgeIngestionTools-277"><span class="linenos">277</span></a>            <span class="c1"># Handle different content types</span>
</span><span id="SemanticKnowledgeIngestionTools-278"><a href="#SemanticKnowledgeIngestionTools-278"><span class="linenos">278</span></a>            <span class="k">if</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-279"><a href="#SemanticKnowledgeIngestionTools-279"><span class="linenos">279</span></a>                <span class="c1"># For HTML, try to extract text content</span>
</span><span id="SemanticKnowledgeIngestionTools-280"><a href="#SemanticKnowledgeIngestionTools-280"><span class="linenos">280</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-281"><a href="#SemanticKnowledgeIngestionTools-281"><span class="linenos">281</span></a>                    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-282"><a href="#SemanticKnowledgeIngestionTools-282"><span class="linenos">282</span></a>
</span><span id="SemanticKnowledgeIngestionTools-283"><a href="#SemanticKnowledgeIngestionTools-283"><span class="linenos">283</span></a>                    <span class="c1"># Remove script and style elements</span>
</span><span id="SemanticKnowledgeIngestionTools-284"><a href="#SemanticKnowledgeIngestionTools-284"><span class="linenos">284</span></a>                    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
</span><span id="SemanticKnowledgeIngestionTools-285"><a href="#SemanticKnowledgeIngestionTools-285"><span class="linenos">285</span></a>                        <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-286"><a href="#SemanticKnowledgeIngestionTools-286"><span class="linenos">286</span></a>
</span><span id="SemanticKnowledgeIngestionTools-287"><a href="#SemanticKnowledgeIngestionTools-287"><span class="linenos">287</span></a>                    <span class="c1"># Get text content</span>
</span><span id="SemanticKnowledgeIngestionTools-288"><a href="#SemanticKnowledgeIngestionTools-288"><span class="linenos">288</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-289"><a href="#SemanticKnowledgeIngestionTools-289"><span class="linenos">289</span></a>
</span><span id="SemanticKnowledgeIngestionTools-290"><a href="#SemanticKnowledgeIngestionTools-290"><span class="linenos">290</span></a>                    <span class="c1"># Get title if not provided</span>
</span><span id="SemanticKnowledgeIngestionTools-291"><a href="#SemanticKnowledgeIngestionTools-291"><span class="linenos">291</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-292"><a href="#SemanticKnowledgeIngestionTools-292"><span class="linenos">292</span></a>                        <span class="n">title_tag</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-293"><a href="#SemanticKnowledgeIngestionTools-293"><span class="linenos">293</span></a>                        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-294"><a href="#SemanticKnowledgeIngestionTools-294"><span class="linenos">294</span></a>                            <span class="n">title_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-295"><a href="#SemanticKnowledgeIngestionTools-295"><span class="linenos">295</span></a>                            <span class="k">if</span> <span class="n">title_tag</span>
</span><span id="SemanticKnowledgeIngestionTools-296"><a href="#SemanticKnowledgeIngestionTools-296"><span class="linenos">296</span></a>                            <span class="k">else</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="SemanticKnowledgeIngestionTools-297"><a href="#SemanticKnowledgeIngestionTools-297"><span class="linenos">297</span></a>                        <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-298"><a href="#SemanticKnowledgeIngestionTools-298"><span class="linenos">298</span></a>
</span><span id="SemanticKnowledgeIngestionTools-299"><a href="#SemanticKnowledgeIngestionTools-299"><span class="linenos">299</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-300"><a href="#SemanticKnowledgeIngestionTools-300"><span class="linenos">300</span></a>
</span><span id="SemanticKnowledgeIngestionTools-301"><a href="#SemanticKnowledgeIngestionTools-301"><span class="linenos">301</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-302"><a href="#SemanticKnowledgeIngestionTools-302"><span class="linenos">302</span></a>                    <span class="c1"># Fallback if BeautifulSoup not available</span>
</span><span id="SemanticKnowledgeIngestionTools-303"><a href="#SemanticKnowledgeIngestionTools-303"><span class="linenos">303</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="SemanticKnowledgeIngestionTools-304"><a href="#SemanticKnowledgeIngestionTools-304"><span class="linenos">304</span></a>                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="SemanticKnowledgeIngestionTools-305"><a href="#SemanticKnowledgeIngestionTools-305"><span class="linenos">305</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-306"><a href="#SemanticKnowledgeIngestionTools-306"><span class="linenos">306</span></a>
</span><span id="SemanticKnowledgeIngestionTools-307"><a href="#SemanticKnowledgeIngestionTools-307"><span class="linenos">307</span></a>            <span class="k">elif</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/json&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-308"><a href="#SemanticKnowledgeIngestionTools-308"><span class="linenos">308</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="SemanticKnowledgeIngestionTools-309"><a href="#SemanticKnowledgeIngestionTools-309"><span class="linenos">309</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="SemanticKnowledgeIngestionTools-310"><a href="#SemanticKnowledgeIngestionTools-310"><span class="linenos">310</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span> <span class="k">if</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="k">else</span> <span class="s2">&quot;json&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-311"><a href="#SemanticKnowledgeIngestionTools-311"><span class="linenos">311</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-312"><a href="#SemanticKnowledgeIngestionTools-312"><span class="linenos">312</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Unsupported content type: </span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-313"><a href="#SemanticKnowledgeIngestionTools-313"><span class="linenos">313</span></a>
</span><span id="SemanticKnowledgeIngestionTools-314"><a href="#SemanticKnowledgeIngestionTools-314"><span class="linenos">314</span></a>            <span class="c1"># Clean up content</span>
</span><span id="SemanticKnowledgeIngestionTools-315"><a href="#SemanticKnowledgeIngestionTools-315"><span class="linenos">315</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-316"><a href="#SemanticKnowledgeIngestionTools-316"><span class="linenos">316</span></a>                <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-317"><a href="#SemanticKnowledgeIngestionTools-317"><span class="linenos">317</span></a>            <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-318"><a href="#SemanticKnowledgeIngestionTools-318"><span class="linenos">318</span></a>
</span><span id="SemanticKnowledgeIngestionTools-319"><a href="#SemanticKnowledgeIngestionTools-319"><span class="linenos">319</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-320"><a href="#SemanticKnowledgeIngestionTools-320"><span class="linenos">320</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: No content extracted from URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-321"><a href="#SemanticKnowledgeIngestionTools-321"><span class="linenos">321</span></a>
</span><span id="SemanticKnowledgeIngestionTools-322"><a href="#SemanticKnowledgeIngestionTools-322"><span class="linenos">322</span></a>            <span class="c1"># Add source URL to content</span>
</span><span id="SemanticKnowledgeIngestionTools-323"><a href="#SemanticKnowledgeIngestionTools-323"><span class="linenos">323</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-324"><a href="#SemanticKnowledgeIngestionTools-324"><span class="linenos">324</span></a>
</span><span id="SemanticKnowledgeIngestionTools-325"><a href="#SemanticKnowledgeIngestionTools-325"><span class="linenos">325</span></a>            <span class="c1"># Ingest the content</span>
</span><span id="SemanticKnowledgeIngestionTools-326"><a href="#SemanticKnowledgeIngestionTools-326"><span class="linenos">326</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-327"><a href="#SemanticKnowledgeIngestionTools-327"><span class="linenos">327</span></a>
</span><span id="SemanticKnowledgeIngestionTools-328"><a href="#SemanticKnowledgeIngestionTools-328"><span class="linenos">328</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-329"><a href="#SemanticKnowledgeIngestionTools-329"><span class="linenos">329</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-330"><a href="#SemanticKnowledgeIngestionTools-330"><span class="linenos">330</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error fetching URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-331"><a href="#SemanticKnowledgeIngestionTools-331"><span class="linenos">331</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-332"><a href="#SemanticKnowledgeIngestionTools-332"><span class="linenos">332</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting from URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-333"><a href="#SemanticKnowledgeIngestionTools-333"><span class="linenos">333</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting from URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-334"><a href="#SemanticKnowledgeIngestionTools-334"><span class="linenos">334</span></a>
</span><span id="SemanticKnowledgeIngestionTools-335"><a href="#SemanticKnowledgeIngestionTools-335"><span class="linenos">335</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_ingest_semantic_directory</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-336"><a href="#SemanticKnowledgeIngestionTools-336"><span class="linenos">336</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SemanticKnowledgeIngestionTools-337"><a href="#SemanticKnowledgeIngestionTools-337"><span class="linenos">337</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-338"><a href="#SemanticKnowledgeIngestionTools-338"><span class="linenos">338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest multiple files from a directory into the local semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools-339"><a href="#SemanticKnowledgeIngestionTools-339"><span class="linenos">339</span></a>
</span><span id="SemanticKnowledgeIngestionTools-340"><a href="#SemanticKnowledgeIngestionTools-340"><span class="linenos">340</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools-341"><a href="#SemanticKnowledgeIngestionTools-341"><span class="linenos">341</span></a><span class="sd">            directory_path: Path to the directory containing files</span>
</span><span id="SemanticKnowledgeIngestionTools-342"><a href="#SemanticKnowledgeIngestionTools-342"><span class="linenos">342</span></a><span class="sd">            file_pattern: Glob pattern to match files (e.g., &quot;*.txt&quot;, &quot;*.md&quot;)</span>
</span><span id="SemanticKnowledgeIngestionTools-343"><a href="#SemanticKnowledgeIngestionTools-343"><span class="linenos">343</span></a><span class="sd">            recursive: Whether to search subdirectories recursively</span>
</span><span id="SemanticKnowledgeIngestionTools-344"><a href="#SemanticKnowledgeIngestionTools-344"><span class="linenos">344</span></a>
</span><span id="SemanticKnowledgeIngestionTools-345"><a href="#SemanticKnowledgeIngestionTools-345"><span class="linenos">345</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools-346"><a href="#SemanticKnowledgeIngestionTools-346"><span class="linenos">346</span></a><span class="sd">            Summary of ingestion results.</span>
</span><span id="SemanticKnowledgeIngestionTools-347"><a href="#SemanticKnowledgeIngestionTools-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-348"><a href="#SemanticKnowledgeIngestionTools-348"><span class="linenos">348</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-349"><a href="#SemanticKnowledgeIngestionTools-349"><span class="linenos">349</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="SemanticKnowledgeIngestionTools-350"><a href="#SemanticKnowledgeIngestionTools-350"><span class="linenos">350</span></a>            <span class="k">if</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-351"><a href="#SemanticKnowledgeIngestionTools-351"><span class="linenos">351</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-352"><a href="#SemanticKnowledgeIngestionTools-352"><span class="linenos">352</span></a>            <span class="k">elif</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-353"><a href="#SemanticKnowledgeIngestionTools-353"><span class="linenos">353</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-354"><a href="#SemanticKnowledgeIngestionTools-354"><span class="linenos">354</span></a>
</span><span id="SemanticKnowledgeIngestionTools-355"><a href="#SemanticKnowledgeIngestionTools-355"><span class="linenos">355</span></a>            <span class="c1"># Validate directory exists</span>
</span><span id="SemanticKnowledgeIngestionTools-356"><a href="#SemanticKnowledgeIngestionTools-356"><span class="linenos">356</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-357"><a href="#SemanticKnowledgeIngestionTools-357"><span class="linenos">357</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Directory not found at &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-358"><a href="#SemanticKnowledgeIngestionTools-358"><span class="linenos">358</span></a>
</span><span id="SemanticKnowledgeIngestionTools-359"><a href="#SemanticKnowledgeIngestionTools-359"><span class="linenos">359</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-360"><a href="#SemanticKnowledgeIngestionTools-360"><span class="linenos">360</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39; is not a directory&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-361"><a href="#SemanticKnowledgeIngestionTools-361"><span class="linenos">361</span></a>
</span><span id="SemanticKnowledgeIngestionTools-362"><a href="#SemanticKnowledgeIngestionTools-362"><span class="linenos">362</span></a>            <span class="c1"># Find files matching pattern</span>
</span><span id="SemanticKnowledgeIngestionTools-363"><a href="#SemanticKnowledgeIngestionTools-363"><span class="linenos">363</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-364"><a href="#SemanticKnowledgeIngestionTools-364"><span class="linenos">364</span></a>            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-365"><a href="#SemanticKnowledgeIngestionTools-365"><span class="linenos">365</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="SemanticKnowledgeIngestionTools-366"><a href="#SemanticKnowledgeIngestionTools-366"><span class="linenos">366</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-367"><a href="#SemanticKnowledgeIngestionTools-367"><span class="linenos">367</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="SemanticKnowledgeIngestionTools-368"><a href="#SemanticKnowledgeIngestionTools-368"><span class="linenos">368</span></a>
</span><span id="SemanticKnowledgeIngestionTools-369"><a href="#SemanticKnowledgeIngestionTools-369"><span class="linenos">369</span></a>            <span class="c1"># Filter to only include files (not directories)</span>
</span><span id="SemanticKnowledgeIngestionTools-370"><a href="#SemanticKnowledgeIngestionTools-370"><span class="linenos">370</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
</span><span id="SemanticKnowledgeIngestionTools-371"><a href="#SemanticKnowledgeIngestionTools-371"><span class="linenos">371</span></a>
</span><span id="SemanticKnowledgeIngestionTools-372"><a href="#SemanticKnowledgeIngestionTools-372"><span class="linenos">372</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-373"><a href="#SemanticKnowledgeIngestionTools-373"><span class="linenos">373</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No files found matching pattern &#39;</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-374"><a href="#SemanticKnowledgeIngestionTools-374"><span class="linenos">374</span></a>
</span><span id="SemanticKnowledgeIngestionTools-375"><a href="#SemanticKnowledgeIngestionTools-375"><span class="linenos">375</span></a>            <span class="c1"># Limit batch size to prevent overwhelming the system</span>
</span><span id="SemanticKnowledgeIngestionTools-376"><a href="#SemanticKnowledgeIngestionTools-376"><span class="linenos">376</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-377"><a href="#SemanticKnowledgeIngestionTools-377"><span class="linenos">377</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Too many files (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">). Please process in smaller batches (max 50 files).&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-378"><a href="#SemanticKnowledgeIngestionTools-378"><span class="linenos">378</span></a>
</span><span id="SemanticKnowledgeIngestionTools-379"><a href="#SemanticKnowledgeIngestionTools-379"><span class="linenos">379</span></a>            <span class="c1"># Process files</span>
</span><span id="SemanticKnowledgeIngestionTools-380"><a href="#SemanticKnowledgeIngestionTools-380"><span class="linenos">380</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="SemanticKnowledgeIngestionTools-381"><a href="#SemanticKnowledgeIngestionTools-381"><span class="linenos">381</span></a>
</span><span id="SemanticKnowledgeIngestionTools-382"><a href="#SemanticKnowledgeIngestionTools-382"><span class="linenos">382</span></a>            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-383"><a href="#SemanticKnowledgeIngestionTools-383"><span class="linenos">383</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-384"><a href="#SemanticKnowledgeIngestionTools-384"><span class="linenos">384</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="SemanticKnowledgeIngestionTools-385"><a href="#SemanticKnowledgeIngestionTools-385"><span class="linenos">385</span></a>                    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-386"><a href="#SemanticKnowledgeIngestionTools-386"><span class="linenos">386</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticKnowledgeIngestionTools-387"><a href="#SemanticKnowledgeIngestionTools-387"><span class="linenos">387</span></a>                        <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-388"><a href="#SemanticKnowledgeIngestionTools-388"><span class="linenos">388</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-389"><a href="#SemanticKnowledgeIngestionTools-389"><span class="linenos">389</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticKnowledgeIngestionTools-390"><a href="#SemanticKnowledgeIngestionTools-390"><span class="linenos">390</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-391"><a href="#SemanticKnowledgeIngestionTools-391"><span class="linenos">391</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to ingest </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-392"><a href="#SemanticKnowledgeIngestionTools-392"><span class="linenos">392</span></a>
</span><span id="SemanticKnowledgeIngestionTools-393"><a href="#SemanticKnowledgeIngestionTools-393"><span class="linenos">393</span></a>                    <span class="c1"># Small delay to avoid overwhelming the system</span>
</span><span id="SemanticKnowledgeIngestionTools-394"><a href="#SemanticKnowledgeIngestionTools-394"><span class="linenos">394</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-395"><a href="#SemanticKnowledgeIngestionTools-395"><span class="linenos">395</span></a>
</span><span id="SemanticKnowledgeIngestionTools-396"><a href="#SemanticKnowledgeIngestionTools-396"><span class="linenos">396</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-397"><a href="#SemanticKnowledgeIngestionTools-397"><span class="linenos">397</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticKnowledgeIngestionTools-398"><a href="#SemanticKnowledgeIngestionTools-398"><span class="linenos">398</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-399"><a href="#SemanticKnowledgeIngestionTools-399"><span class="linenos">399</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-400"><a href="#SemanticKnowledgeIngestionTools-400"><span class="linenos">400</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-401"><a href="#SemanticKnowledgeIngestionTools-401"><span class="linenos">401</span></a>
</span><span id="SemanticKnowledgeIngestionTools-402"><a href="#SemanticKnowledgeIngestionTools-402"><span class="linenos">402</span></a>            <span class="c1"># Format results</span>
</span><span id="SemanticKnowledgeIngestionTools-403"><a href="#SemanticKnowledgeIngestionTools-403"><span class="linenos">403</span></a>            <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Batch semantic ingestion complete: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> successful, </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> failed&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-404"><a href="#SemanticKnowledgeIngestionTools-404"><span class="linenos">404</span></a>
</span><span id="SemanticKnowledgeIngestionTools-405"><a href="#SemanticKnowledgeIngestionTools-405"><span class="linenos">405</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]:</span>
</span><span id="SemanticKnowledgeIngestionTools-406"><a href="#SemanticKnowledgeIngestionTools-406"><span class="linenos">406</span></a>                <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Errors:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-407"><a href="#SemanticKnowledgeIngestionTools-407"><span class="linenos">407</span></a>                    <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools-408"><a href="#SemanticKnowledgeIngestionTools-408"><span class="linenos">408</span></a>                <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-409"><a href="#SemanticKnowledgeIngestionTools-409"><span class="linenos">409</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-410"><a href="#SemanticKnowledgeIngestionTools-410"><span class="linenos">410</span></a>                    <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more errors&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-411"><a href="#SemanticKnowledgeIngestionTools-411"><span class="linenos">411</span></a>
</span><span id="SemanticKnowledgeIngestionTools-412"><a href="#SemanticKnowledgeIngestionTools-412"><span class="linenos">412</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-413"><a href="#SemanticKnowledgeIngestionTools-413"><span class="linenos">413</span></a>                <span class="sa">f</span><span class="s2">&quot;Batch semantic ingestion completed: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files successful&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-414"><a href="#SemanticKnowledgeIngestionTools-414"><span class="linenos">414</span></a>            <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-415"><a href="#SemanticKnowledgeIngestionTools-415"><span class="linenos">415</span></a>            <span class="k">return</span> <span class="n">summary</span>
</span><span id="SemanticKnowledgeIngestionTools-416"><a href="#SemanticKnowledgeIngestionTools-416"><span class="linenos">416</span></a>
</span><span id="SemanticKnowledgeIngestionTools-417"><a href="#SemanticKnowledgeIngestionTools-417"><span class="linenos">417</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-418"><a href="#SemanticKnowledgeIngestionTools-418"><span class="linenos">418</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in batch semantic ingestion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-419"><a href="#SemanticKnowledgeIngestionTools-419"><span class="linenos">419</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error in batch semantic ingestion: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-420"><a href="#SemanticKnowledgeIngestionTools-420"><span class="linenos">420</span></a>
</span><span id="SemanticKnowledgeIngestionTools-421"><a href="#SemanticKnowledgeIngestionTools-421"><span class="linenos">421</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query_semantic_knowledge</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-422"><a href="#SemanticKnowledgeIngestionTools-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SemanticKnowledgeIngestionTools-423"><a href="#SemanticKnowledgeIngestionTools-423"><span class="linenos">423</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-424"><a href="#SemanticKnowledgeIngestionTools-424"><span class="linenos">424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the local semantic knowledge base to retrieve stored information.</span>
</span><span id="SemanticKnowledgeIngestionTools-425"><a href="#SemanticKnowledgeIngestionTools-425"><span class="linenos">425</span></a>
</span><span id="SemanticKnowledgeIngestionTools-426"><a href="#SemanticKnowledgeIngestionTools-426"><span class="linenos">426</span></a><span class="sd">        This tool searches the local LanceDB-based semantic knowledge base using vector</span>
</span><span id="SemanticKnowledgeIngestionTools-427"><a href="#SemanticKnowledgeIngestionTools-427"><span class="linenos">427</span></a><span class="sd">        similarity search. It&#39;s designed for finding factual information and documents</span>
</span><span id="SemanticKnowledgeIngestionTools-428"><a href="#SemanticKnowledgeIngestionTools-428"><span class="linenos">428</span></a><span class="sd">        that were previously ingested into the semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools-429"><a href="#SemanticKnowledgeIngestionTools-429"><span class="linenos">429</span></a>
</span><span id="SemanticKnowledgeIngestionTools-430"><a href="#SemanticKnowledgeIngestionTools-430"><span class="linenos">430</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools-431"><a href="#SemanticKnowledgeIngestionTools-431"><span class="linenos">431</span></a><span class="sd">            query: The search query for finding existing knowledge/documents</span>
</span><span id="SemanticKnowledgeIngestionTools-432"><a href="#SemanticKnowledgeIngestionTools-432"><span class="linenos">432</span></a><span class="sd">            limit: Maximum number of results to return</span>
</span><span id="SemanticKnowledgeIngestionTools-433"><a href="#SemanticKnowledgeIngestionTools-433"><span class="linenos">433</span></a>
</span><span id="SemanticKnowledgeIngestionTools-434"><a href="#SemanticKnowledgeIngestionTools-434"><span class="linenos">434</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools-435"><a href="#SemanticKnowledgeIngestionTools-435"><span class="linenos">435</span></a><span class="sd">            Search results from the semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools-436"><a href="#SemanticKnowledgeIngestionTools-436"><span class="linenos">436</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-437"><a href="#SemanticKnowledgeIngestionTools-437"><span class="linenos">437</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-438"><a href="#SemanticKnowledgeIngestionTools-438"><span class="linenos">438</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="SemanticKnowledgeIngestionTools-439"><a href="#SemanticKnowledgeIngestionTools-439"><span class="linenos">439</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Query cannot be empty&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-440"><a href="#SemanticKnowledgeIngestionTools-440"><span class="linenos">440</span></a>
</span><span id="SemanticKnowledgeIngestionTools-441"><a href="#SemanticKnowledgeIngestionTools-441"><span class="linenos">441</span></a>            <span class="c1"># Filter out inappropriate creative requests</span>
</span><span id="SemanticKnowledgeIngestionTools-442"><a href="#SemanticKnowledgeIngestionTools-442"><span class="linenos">442</span></a>            <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-443"><a href="#SemanticKnowledgeIngestionTools-443"><span class="linenos">443</span></a>
</span><span id="SemanticKnowledgeIngestionTools-444"><a href="#SemanticKnowledgeIngestionTools-444"><span class="linenos">444</span></a>            <span class="c1"># Creative/generative request patterns that should NOT use knowledge search</span>
</span><span id="SemanticKnowledgeIngestionTools-445"><a href="#SemanticKnowledgeIngestionTools-445"><span class="linenos">445</span></a>            <span class="n">creative_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticKnowledgeIngestionTools-446"><a href="#SemanticKnowledgeIngestionTools-446"><span class="linenos">446</span></a>                <span class="s2">&quot;write&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-447"><a href="#SemanticKnowledgeIngestionTools-447"><span class="linenos">447</span></a>                <span class="s2">&quot;create&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-448"><a href="#SemanticKnowledgeIngestionTools-448"><span class="linenos">448</span></a>                <span class="s2">&quot;generate&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-449"><a href="#SemanticKnowledgeIngestionTools-449"><span class="linenos">449</span></a>                <span class="s2">&quot;make&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-450"><a href="#SemanticKnowledgeIngestionTools-450"><span class="linenos">450</span></a>                <span class="s2">&quot;compose&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-451"><a href="#SemanticKnowledgeIngestionTools-451"><span class="linenos">451</span></a>                <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-452"><a href="#SemanticKnowledgeIngestionTools-452"><span class="linenos">452</span></a>                <span class="s2">&quot;tell me a&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-453"><a href="#SemanticKnowledgeIngestionTools-453"><span class="linenos">453</span></a>                <span class="s2">&quot;give me a&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-454"><a href="#SemanticKnowledgeIngestionTools-454"><span class="linenos">454</span></a>                <span class="s2">&quot;come up with&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-455"><a href="#SemanticKnowledgeIngestionTools-455"><span class="linenos">455</span></a>                <span class="s2">&quot;think of&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-456"><a href="#SemanticKnowledgeIngestionTools-456"><span class="linenos">456</span></a>                <span class="s2">&quot;story&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-457"><a href="#SemanticKnowledgeIngestionTools-457"><span class="linenos">457</span></a>                <span class="s2">&quot;poem&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-458"><a href="#SemanticKnowledgeIngestionTools-458"><span class="linenos">458</span></a>                <span class="s2">&quot;joke&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-459"><a href="#SemanticKnowledgeIngestionTools-459"><span class="linenos">459</span></a>                <span class="s2">&quot;song&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-460"><a href="#SemanticKnowledgeIngestionTools-460"><span class="linenos">460</span></a>                <span class="s2">&quot;essay&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-461"><a href="#SemanticKnowledgeIngestionTools-461"><span class="linenos">461</span></a>                <span class="s2">&quot;article&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-462"><a href="#SemanticKnowledgeIngestionTools-462"><span class="linenos">462</span></a>                <span class="s2">&quot;funny&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-463"><a href="#SemanticKnowledgeIngestionTools-463"><span class="linenos">463</span></a>                <span class="s2">&quot;creative&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-464"><a href="#SemanticKnowledgeIngestionTools-464"><span class="linenos">464</span></a>                <span class="s2">&quot;imagine&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-465"><a href="#SemanticKnowledgeIngestionTools-465"><span class="linenos">465</span></a>                <span class="s2">&quot;pretend&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-466"><a href="#SemanticKnowledgeIngestionTools-466"><span class="linenos">466</span></a>            <span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools-467"><a href="#SemanticKnowledgeIngestionTools-467"><span class="linenos">467</span></a>
</span><span id="SemanticKnowledgeIngestionTools-468"><a href="#SemanticKnowledgeIngestionTools-468"><span class="linenos">468</span></a>            <span class="c1"># Check if this looks like a creative request</span>
</span><span id="SemanticKnowledgeIngestionTools-469"><a href="#SemanticKnowledgeIngestionTools-469"><span class="linenos">469</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">creative_patterns</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-470"><a href="#SemanticKnowledgeIngestionTools-470"><span class="linenos">470</span></a>                <span class="c1"># Additional check: if it&#39;s asking for factual info WITH creative words, allow it</span>
</span><span id="SemanticKnowledgeIngestionTools-471"><a href="#SemanticKnowledgeIngestionTools-471"><span class="linenos">471</span></a>                <span class="n">factual_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticKnowledgeIngestionTools-472"><a href="#SemanticKnowledgeIngestionTools-472"><span class="linenos">472</span></a>                    <span class="s2">&quot;what is&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-473"><a href="#SemanticKnowledgeIngestionTools-473"><span class="linenos">473</span></a>                    <span class="s2">&quot;who is&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-474"><a href="#SemanticKnowledgeIngestionTools-474"><span class="linenos">474</span></a>                    <span class="s2">&quot;when did&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-475"><a href="#SemanticKnowledgeIngestionTools-475"><span class="linenos">475</span></a>                    <span class="s2">&quot;where is&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-476"><a href="#SemanticKnowledgeIngestionTools-476"><span class="linenos">476</span></a>                    <span class="s2">&quot;how does&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-477"><a href="#SemanticKnowledgeIngestionTools-477"><span class="linenos">477</span></a>                    <span class="s2">&quot;definition of&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-478"><a href="#SemanticKnowledgeIngestionTools-478"><span class="linenos">478</span></a>                    <span class="s2">&quot;information about&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-479"><a href="#SemanticKnowledgeIngestionTools-479"><span class="linenos">479</span></a>                    <span class="s2">&quot;facts about&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-480"><a href="#SemanticKnowledgeIngestionTools-480"><span class="linenos">480</span></a>                    <span class="s2">&quot;details about&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-481"><a href="#SemanticKnowledgeIngestionTools-481"><span class="linenos">481</span></a>                    <span class="s2">&quot;explain&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-482"><a href="#SemanticKnowledgeIngestionTools-482"><span class="linenos">482</span></a>                    <span class="s2">&quot;describe&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools-483"><a href="#SemanticKnowledgeIngestionTools-483"><span class="linenos">483</span></a>                <span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools-484"><a href="#SemanticKnowledgeIngestionTools-484"><span class="linenos">484</span></a>
</span><span id="SemanticKnowledgeIngestionTools-485"><a href="#SemanticKnowledgeIngestionTools-485"><span class="linenos">485</span></a>                <span class="c1"># If it has factual patterns, it might be legitimate</span>
</span><span id="SemanticKnowledgeIngestionTools-486"><a href="#SemanticKnowledgeIngestionTools-486"><span class="linenos">486</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">factual</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">factual</span> <span class="ow">in</span> <span class="n">factual_patterns</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-487"><a href="#SemanticKnowledgeIngestionTools-487"><span class="linenos">487</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools-488"><a href="#SemanticKnowledgeIngestionTools-488"><span class="linenos">488</span></a>                        <span class="sa">f</span><span class="s2">&quot;Rejected creative request for semantic knowledge search: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-489"><a href="#SemanticKnowledgeIngestionTools-489"><span class="linenos">489</span></a>                    <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-490"><a href="#SemanticKnowledgeIngestionTools-490"><span class="linenos">490</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; This appears to be a creative request (&#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;). The semantic knowledge base is for searching existing stored information, not for generating new content. Please rephrase as a search for existing knowledge, or ask me to create content directly without using knowledge tools.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-491"><a href="#SemanticKnowledgeIngestionTools-491"><span class="linenos">491</span></a>
</span><span id="SemanticKnowledgeIngestionTools-492"><a href="#SemanticKnowledgeIngestionTools-492"><span class="linenos">492</span></a>            <span class="c1"># Get the knowledge base</span>
</span><span id="SemanticKnowledgeIngestionTools-493"><a href="#SemanticKnowledgeIngestionTools-493"><span class="linenos">493</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-494"><a href="#SemanticKnowledgeIngestionTools-494"><span class="linenos">494</span></a>                <span class="n">knowledge_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_knowledge_base</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools-495"><a href="#SemanticKnowledgeIngestionTools-495"><span class="linenos">495</span></a>                
</span><span id="SemanticKnowledgeIngestionTools-496"><a href="#SemanticKnowledgeIngestionTools-496"><span class="linenos">496</span></a>                <span class="c1"># Perform semantic search</span>
</span><span id="SemanticKnowledgeIngestionTools-497"><a href="#SemanticKnowledgeIngestionTools-497"><span class="linenos">497</span></a>                <span class="n">search_results</span> <span class="o">=</span> <span class="n">knowledge_base</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">num_documents</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-498"><a href="#SemanticKnowledgeIngestionTools-498"><span class="linenos">498</span></a>                
</span><span id="SemanticKnowledgeIngestionTools-499"><a href="#SemanticKnowledgeIngestionTools-499"><span class="linenos">499</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">search_results</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-500"><a href="#SemanticKnowledgeIngestionTools-500"><span class="linenos">500</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No semantic search results found for: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-501"><a href="#SemanticKnowledgeIngestionTools-501"><span class="linenos">501</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No relevant knowledge found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. Try different keywords or add more knowledge to your semantic knowledge base.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-502"><a href="#SemanticKnowledgeIngestionTools-502"><span class="linenos">502</span></a>
</span><span id="SemanticKnowledgeIngestionTools-503"><a href="#SemanticKnowledgeIngestionTools-503"><span class="linenos">503</span></a>                <span class="c1"># Format results</span>
</span><span id="SemanticKnowledgeIngestionTools-504"><a href="#SemanticKnowledgeIngestionTools-504"><span class="linenos">504</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; SEMANTIC KNOWLEDGE SEARCH (found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-505"><a href="#SemanticKnowledgeIngestionTools-505"><span class="linenos">505</span></a>                
</span><span id="SemanticKnowledgeIngestionTools-506"><a href="#SemanticKnowledgeIngestionTools-506"><span class="linenos">506</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">search_results</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools-507"><a href="#SemanticKnowledgeIngestionTools-507"><span class="linenos">507</span></a>                    <span class="c1"># Extract content from the document</span>
</span><span id="SemanticKnowledgeIngestionTools-508"><a href="#SemanticKnowledgeIngestionTools-508"><span class="linenos">508</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-509"><a href="#SemanticKnowledgeIngestionTools-509"><span class="linenos">509</span></a>                    <span class="c1"># Truncate long content for display</span>
</span><span id="SemanticKnowledgeIngestionTools-510"><a href="#SemanticKnowledgeIngestionTools-510"><span class="linenos">510</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-511"><a href="#SemanticKnowledgeIngestionTools-511"><span class="linenos">511</span></a>                        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-512"><a href="#SemanticKnowledgeIngestionTools-512"><span class="linenos">512</span></a>                    
</span><span id="SemanticKnowledgeIngestionTools-513"><a href="#SemanticKnowledgeIngestionTools-513"><span class="linenos">513</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-514"><a href="#SemanticKnowledgeIngestionTools-514"><span class="linenos">514</span></a>
</span><span id="SemanticKnowledgeIngestionTools-515"><a href="#SemanticKnowledgeIngestionTools-515"><span class="linenos">515</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Semantic knowledge search successful: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-516"><a href="#SemanticKnowledgeIngestionTools-516"><span class="linenos">516</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="SemanticKnowledgeIngestionTools-517"><a href="#SemanticKnowledgeIngestionTools-517"><span class="linenos">517</span></a>
</span><span id="SemanticKnowledgeIngestionTools-518"><a href="#SemanticKnowledgeIngestionTools-518"><span class="linenos">518</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-519"><a href="#SemanticKnowledgeIngestionTools-519"><span class="linenos">519</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying semantic knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-520"><a href="#SemanticKnowledgeIngestionTools-520"><span class="linenos">520</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying semantic knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools-521"><a href="#SemanticKnowledgeIngestionTools-521"><span class="linenos">521</span></a>
</span><span id="SemanticKnowledgeIngestionTools-522"><a href="#SemanticKnowledgeIngestionTools-522"><span class="linenos">522</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools-523"><a href="#SemanticKnowledgeIngestionTools-523"><span class="linenos">523</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in semantic knowledge query: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools-524"><a href="#SemanticKnowledgeIngestionTools-524"><span class="linenos">524</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error in semantic knowledge query: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Semantic knowledge ingestion tools for adding files and content to the local LanceDB knowledge base.</p>

<p>Args:
    ingest_file (bool): Enable file ingestion functionality.
    ingest_text (bool): Enable direct text ingestion functionality.
    ingest_url (bool): Enable URL content ingestion functionality.
    batch_ingest (bool): Enable batch directory ingestion functionality.
    query_knowledge (bool): Enable semantic knowledge querying functionality.</p>
</div>


                            <div id="SemanticKnowledgeIngestionTools.__init__" class="classattr">
                                        <input id="SemanticKnowledgeIngestionTools.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SemanticKnowledgeIngestionTools</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">ingest_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">ingest_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">ingest_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">batch_ingest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">query_knowledge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="SemanticKnowledgeIngestionTools.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticKnowledgeIngestionTools.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticKnowledgeIngestionTools.__init__-47"><a href="#SemanticKnowledgeIngestionTools.__init__-47"><span class="linenos">47</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-48"><a href="#SemanticKnowledgeIngestionTools.__init__-48"><span class="linenos">48</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-49"><a href="#SemanticKnowledgeIngestionTools.__init__-49"><span class="linenos">49</span></a>        <span class="n">ingest_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-50"><a href="#SemanticKnowledgeIngestionTools.__init__-50"><span class="linenos">50</span></a>        <span class="n">ingest_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-51"><a href="#SemanticKnowledgeIngestionTools.__init__-51"><span class="linenos">51</span></a>        <span class="n">ingest_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-52"><a href="#SemanticKnowledgeIngestionTools.__init__-52"><span class="linenos">52</span></a>        <span class="n">batch_ingest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-53"><a href="#SemanticKnowledgeIngestionTools.__init__-53"><span class="linenos">53</span></a>        <span class="n">query_knowledge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-54"><a href="#SemanticKnowledgeIngestionTools.__init__-54"><span class="linenos">54</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-55"><a href="#SemanticKnowledgeIngestionTools.__init__-55"><span class="linenos">55</span></a>    <span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-56"><a href="#SemanticKnowledgeIngestionTools.__init__-56"><span class="linenos">56</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-57"><a href="#SemanticKnowledgeIngestionTools.__init__-57"><span class="linenos">57</span></a>
</span><span id="SemanticKnowledgeIngestionTools.__init__-58"><a href="#SemanticKnowledgeIngestionTools.__init__-58"><span class="linenos">58</span></a>        <span class="k">if</span> <span class="n">ingest_file</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-59"><a href="#SemanticKnowledgeIngestionTools.__init__-59"><span class="linenos">59</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_file</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-60"><a href="#SemanticKnowledgeIngestionTools.__init__-60"><span class="linenos">60</span></a>        <span class="k">if</span> <span class="n">ingest_text</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-61"><a href="#SemanticKnowledgeIngestionTools.__init__-61"><span class="linenos">61</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_text</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-62"><a href="#SemanticKnowledgeIngestionTools.__init__-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="n">ingest_url</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-63"><a href="#SemanticKnowledgeIngestionTools.__init__-63"><span class="linenos">63</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_from_url</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-64"><a href="#SemanticKnowledgeIngestionTools.__init__-64"><span class="linenos">64</span></a>        <span class="k">if</span> <span class="n">batch_ingest</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-65"><a href="#SemanticKnowledgeIngestionTools.__init__-65"><span class="linenos">65</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_ingest_semantic_directory</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-66"><a href="#SemanticKnowledgeIngestionTools.__init__-66"><span class="linenos">66</span></a>        <span class="k">if</span> <span class="n">query_knowledge</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-67"><a href="#SemanticKnowledgeIngestionTools.__init__-67"><span class="linenos">67</span></a>            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_semantic_knowledge</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-68"><a href="#SemanticKnowledgeIngestionTools.__init__-68"><span class="linenos">68</span></a>
</span><span id="SemanticKnowledgeIngestionTools.__init__-69"><a href="#SemanticKnowledgeIngestionTools.__init__-69"><span class="linenos">69</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;semantic_knowledge_ingestion&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-70"><a href="#SemanticKnowledgeIngestionTools.__init__-70"><span class="linenos">70</span></a>
</span><span id="SemanticKnowledgeIngestionTools.__init__-71"><a href="#SemanticKnowledgeIngestionTools.__init__-71"><span class="linenos">71</span></a>        <span class="c1"># Initialize knowledge base reference</span>
</span><span id="SemanticKnowledgeIngestionTools.__init__-72"><a href="#SemanticKnowledgeIngestionTools.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_knowledge_base</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new Toolkit.</p>

<p>Args:
    name: A descriptive name for the toolkit
    tools: List of tools to include in the toolkit
    instructions: Instructions for the toolkit
    add_instructions: Whether to add instructions to the toolkit
    include_tools: List of tool names to include in the toolkit
    exclude_tools: List of tool names to exclude from the toolkit
    requires_confirmation_tools: List of tool names that require user confirmation
    external_execution_required_tools: List of tool names that will be executed outside of the agent loop
    cache_results (bool): Enable in-memory caching of function results.
    cache_ttl (int): Time-to-live for cached results in seconds.
    cache_dir (Optional[str]): Directory to store cache files. Defaults to system temp dir.
    auto_register (bool): Whether to automatically register all methods in the class.
    stop_after_tool_call_tools (Optional[List[str]]): List of function names that should stop the agent after execution.
    show_result_tools (Optional[List[str]]): List of function names whose results should be shown.</p>
</div>


                            </div>
                            <div id="SemanticKnowledgeIngestionTools.ingest_semantic_file" class="classattr">
                                        <input id="SemanticKnowledgeIngestionTools.ingest_semantic_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_semantic_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticKnowledgeIngestionTools.ingest_semantic_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticKnowledgeIngestionTools.ingest_semantic_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-92"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_semantic_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-93"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest a file into the local semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-94"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-94"><span class="linenos"> 94</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-95"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-95"><span class="linenos"> 95</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-96"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-96"><span class="linenos"> 96</span></a><span class="sd">            file_path: Path to the file to ingest</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-97"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-97"><span class="linenos"> 97</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to filename)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-98"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-98"><span class="linenos"> 98</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-99"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-99"><span class="linenos"> 99</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-100"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-100"><span class="linenos">100</span></a><span class="sd">            Success message or error details.</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-101"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-102"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-102"><span class="linenos">102</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-103"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-103"><span class="linenos">103</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-104"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-105"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-105"><span class="linenos">105</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-106"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-106"><span class="linenos">106</span></a>            <span class="k">elif</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-107"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-107"><span class="linenos">107</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-108"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-108"><span class="linenos">108</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-109"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-109"><span class="linenos">109</span></a>            <span class="c1"># Validate file exists</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-110"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-110"><span class="linenos">110</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-111"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-111"><span class="linenos">111</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File not found at &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-112"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-112"><span class="linenos">112</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-113"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-114"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-114"><span class="linenos">114</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; is not a file&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-115"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-115"><span class="linenos">115</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-116"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-116"><span class="linenos">116</span></a>            <span class="c1"># Get file info</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-117"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-117"><span class="linenos">117</span></a>            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-118"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-118"><span class="linenos">118</span></a>            <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 50MB limit</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-119"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-119"><span class="linenos">119</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File too large (</span><span class="si">{</span><span class="n">file_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB). Maximum size is 50MB.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-120"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-120"><span class="linenos">120</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-121"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-121"><span class="linenos">121</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-122"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-122"><span class="linenos">122</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-123"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-123"><span class="linenos">123</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-124"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-124"><span class="linenos">124</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-125"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-125"><span class="linenos">125</span></a>            <span class="c1"># Check file type</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-126"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-126"><span class="linenos">126</span></a>            <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-127"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-127"><span class="linenos">127</span></a>            <span class="n">supported_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-128"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-128"><span class="linenos">128</span></a>                <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-129"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-129"><span class="linenos">129</span></a>                <span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-130"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-130"><span class="linenos">130</span></a>                <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-131"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-131"><span class="linenos">131</span></a>                <span class="s2">&quot;text/csv&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-132"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-132"><span class="linenos">132</span></a>                <span class="s2">&quot;application/pdf&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-133"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-133"><span class="linenos">133</span></a>                <span class="s2">&quot;application/msword&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-134"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-134"><span class="linenos">134</span></a>                <span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-135"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-135"><span class="linenos">135</span></a>            <span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-136"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-136"><span class="linenos">136</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-137"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-137"><span class="linenos">137</span></a>            <span class="k">if</span> <span class="n">mime_type</span> <span class="ow">and</span> <span class="n">mime_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_types</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-138"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-138"><span class="linenos">138</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File type </span><span class="si">{</span><span class="n">mime_type</span><span class="si">}</span><span class="s2"> may not be fully supported&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-139"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-139"><span class="linenos">139</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-140"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-140"><span class="linenos">140</span></a>            <span class="c1"># Copy file to semantic knowledge directory</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-141"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-141"><span class="linenos">141</span></a>            <span class="n">semantic_knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATA_DIR</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;knowledge&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-142"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-142"><span class="linenos">142</span></a>            <span class="n">semantic_knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-143"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-143"><span class="linenos">143</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-144"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-144"><span class="linenos">144</span></a>            <span class="c1"># Create unique filename to avoid conflicts</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-145"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-145"><span class="linenos">145</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-146"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-146"><span class="linenos">146</span></a>            <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-147"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-147"><span class="linenos">147</span></a>            <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-148"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-148"><span class="linenos">148</span></a>            <span class="n">unique_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-149"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-149"><span class="linenos">149</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-150"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-150"><span class="linenos">150</span></a>            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">semantic_knowledge_dir</span> <span class="o">/</span> <span class="n">unique_filename</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-151"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-151"><span class="linenos">151</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-152"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-152"><span class="linenos">152</span></a>            <span class="c1"># Copy the file</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-153"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-153"><span class="linenos">153</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-154"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-154"><span class="linenos">154</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied file to semantic knowledge directory: </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-155"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-155"><span class="linenos">155</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-156"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-156"><span class="linenos">156</span></a>            <span class="c1"># Reload the knowledge base to include the new file</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-157"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-157"><span class="linenos">157</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-158"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-158"><span class="linenos">158</span></a>                <span class="n">knowledge_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_knowledge_base</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-159"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-159"><span class="linenos">159</span></a>                <span class="c1"># Recreate the knowledge base to include new files</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-160"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-160"><span class="linenos">160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_reload_knowledge_base_sync</span><span class="p">(</span><span class="n">knowledge_base</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-161"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-161"><span class="linenos">161</span></a>                
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-162"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-162"><span class="linenos">162</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested semantic knowledge file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-163"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-163"><span class="linenos">163</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; into semantic knowledge base and reloaded vector embeddings.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-164"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-164"><span class="linenos">164</span></a>                
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-165"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-165"><span class="linenos">165</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-166"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-166"><span class="linenos">166</span></a>                <span class="c1"># Clean up the copied file if knowledge base reload failed</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-167"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-167"><span class="linenos">167</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-168"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-168"><span class="linenos">168</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-169"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-169"><span class="linenos">169</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-170"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-170"><span class="linenos">170</span></a>                    <span class="k">pass</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-171"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-171"><span class="linenos">171</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to reload knowledge base after adding </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-172"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-172"><span class="linenos">172</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;: Error reloading knowledge base - </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-173"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-173"><span class="linenos">173</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-174"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-174"><span class="linenos">174</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-175"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-175"><span class="linenos">175</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting semantic file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_file-176"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_file-176"><span class="linenos">176</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest a file into the local semantic knowledge base.</p>

<p>Args:
    file_path: Path to the file to ingest
    title: Optional title for the knowledge entry (defaults to filename)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="SemanticKnowledgeIngestionTools.ingest_semantic_text" class="classattr">
                                        <input id="SemanticKnowledgeIngestionTools.ingest_semantic_text-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_semantic_text</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">content</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;txt&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticKnowledgeIngestionTools.ingest_semantic_text-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticKnowledgeIngestionTools.ingest_semantic_text"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-178"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_semantic_text</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-179"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-180"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-180"><span class="linenos">180</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-181"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-181"><span class="linenos">181</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest text content directly into the local semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-182"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-182"><span class="linenos">182</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-183"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-183"><span class="linenos">183</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-184"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-184"><span class="linenos">184</span></a><span class="sd">            content: The text content to ingest</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-185"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-185"><span class="linenos">185</span></a><span class="sd">            title: Title for the knowledge entry</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-186"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-186"><span class="linenos">186</span></a><span class="sd">            file_type: File extension to use (txt, md, html, etc.)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-187"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-187"><span class="linenos">187</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-188"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-188"><span class="linenos">188</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-189"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-189"><span class="linenos">189</span></a><span class="sd">            Success message or error details.</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-190"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-191"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-191"><span class="linenos">191</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-192"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-192"><span class="linenos">192</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-193"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-193"><span class="linenos">193</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Content cannot be empty&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-194"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-194"><span class="linenos">194</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-195"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-196"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-196"><span class="linenos">196</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Title is required&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-197"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-197"><span class="linenos">197</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-198"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-198"><span class="linenos">198</span></a>            <span class="c1"># Validate file_type</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-199"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-199"><span class="linenos">199</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-200"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-200"><span class="linenos">200</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-201"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-201"><span class="linenos">201</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-202"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-202"><span class="linenos">202</span></a>            <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;.md&quot;</span><span class="p">,</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-203"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-203"><span class="linenos">203</span></a>            <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-204"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-204"><span class="linenos">204</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;.txt&quot;</span>  <span class="c1"># Default to txt</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-205"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-205"><span class="linenos">205</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-206"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-206"><span class="linenos">206</span></a>            <span class="c1"># Create semantic knowledge directory</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-207"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-207"><span class="linenos">207</span></a>            <span class="n">semantic_knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATA_DIR</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;knowledge&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-208"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-208"><span class="linenos">208</span></a>            <span class="n">semantic_knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-209"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-209"><span class="linenos">209</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-210"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-210"><span class="linenos">210</span></a>            <span class="c1"># Create unique filename</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-211"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-211"><span class="linenos">211</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-212"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-212"><span class="linenos">212</span></a>            <span class="n">content_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-213"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-213"><span class="linenos">213</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-214"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-214"><span class="linenos">214</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-215"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-215"><span class="linenos">215</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-216"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-216"><span class="linenos">216</span></a>                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">title</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-217"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-217"><span class="linenos">217</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-218"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-218"><span class="linenos">218</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="n">safe_title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>  <span class="c1"># Limit length</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-219"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-219"><span class="linenos">219</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content_hash</span><span class="si">}{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-220"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-220"><span class="linenos">220</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-221"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-221"><span class="linenos">221</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">semantic_knowledge_dir</span> <span class="o">/</span> <span class="n">filename</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-222"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-222"><span class="linenos">222</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-223"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-223"><span class="linenos">223</span></a>            <span class="c1"># Write content to file</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-224"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-224"><span class="linenos">224</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-225"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-225"><span class="linenos">225</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-226"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-226"><span class="linenos">226</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-227"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-227"><span class="linenos">227</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created semantic knowledge file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-228"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-228"><span class="linenos">228</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-229"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-229"><span class="linenos">229</span></a>            <span class="c1"># Reload the knowledge base to include the new content</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-230"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-230"><span class="linenos">230</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-231"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-231"><span class="linenos">231</span></a>                <span class="n">knowledge_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_knowledge_base</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-232"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-232"><span class="linenos">232</span></a>                <span class="c1"># Recreate the knowledge base to include new files</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-233"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_reload_knowledge_base_sync</span><span class="p">(</span><span class="n">knowledge_base</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-234"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-234"><span class="linenos">234</span></a>                
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-235"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-235"><span class="linenos">235</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested semantic knowledge text: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-236"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-236"><span class="linenos">236</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39; into semantic knowledge base and reloaded vector embeddings.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-237"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-237"><span class="linenos">237</span></a>                
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-238"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-238"><span class="linenos">238</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-239"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-239"><span class="linenos">239</span></a>                <span class="c1"># Clean up the created file if knowledge base reload failed</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-240"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-240"><span class="linenos">240</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-241"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-241"><span class="linenos">241</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-242"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-242"><span class="linenos">242</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-243"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-243"><span class="linenos">243</span></a>                    <span class="k">pass</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-244"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-244"><span class="linenos">244</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to reload knowledge base after adding </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-245"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-245"><span class="linenos">245</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;: Error reloading knowledge base - </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-246"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-246"><span class="linenos">246</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-247"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-247"><span class="linenos">247</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-248"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-248"><span class="linenos">248</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting semantic text content: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_text-249"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_text-249"><span class="linenos">249</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting text content: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest text content directly into the local semantic knowledge base.</p>

<p>Args:
    content: The text content to ingest
    title: Title for the knowledge entry
    file_type: File extension to use (txt, md, html, etc.)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url" class="classattr">
                                        <input id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_semantic_from_url</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-251"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-251"><span class="linenos">251</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_semantic_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-252"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-252"><span class="linenos">252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest content from a URL into the local semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-253"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-253"><span class="linenos">253</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-254"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-254"><span class="linenos">254</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-255"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-255"><span class="linenos">255</span></a><span class="sd">            url: URL to fetch content from</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-256"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-256"><span class="linenos">256</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to page title or URL)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-257"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-257"><span class="linenos">257</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-258"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-258"><span class="linenos">258</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-259"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-259"><span class="linenos">259</span></a><span class="sd">            Success message or error details.</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-260"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-261"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-261"><span class="linenos">261</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-262"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-262"><span class="linenos">262</span></a>            <span class="c1"># Validate URL</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-263"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-263"><span class="linenos">263</span></a>            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-264"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-264"><span class="linenos">264</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-265"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-265"><span class="linenos">265</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Invalid URL format: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-266"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-266"><span class="linenos">266</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-267"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-267"><span class="linenos">267</span></a>            <span class="c1"># Fetch content</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-268"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-268"><span class="linenos">268</span></a>            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-269"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-269"><span class="linenos">269</span></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-270"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-270"><span class="linenos">270</span></a>            <span class="p">}</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-271"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-271"><span class="linenos">271</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-272"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-272"><span class="linenos">272</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-273"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-273"><span class="linenos">273</span></a>            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-274"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-274"><span class="linenos">274</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-275"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-275"><span class="linenos">275</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-276"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-276"><span class="linenos">276</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-277"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-277"><span class="linenos">277</span></a>            <span class="c1"># Handle different content types</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-278"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-278"><span class="linenos">278</span></a>            <span class="k">if</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-279"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-279"><span class="linenos">279</span></a>                <span class="c1"># For HTML, try to extract text content</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-280"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-280"><span class="linenos">280</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-281"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-281"><span class="linenos">281</span></a>                    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-282"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-282"><span class="linenos">282</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-283"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-283"><span class="linenos">283</span></a>                    <span class="c1"># Remove script and style elements</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-284"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-284"><span class="linenos">284</span></a>                    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-285"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-285"><span class="linenos">285</span></a>                        <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-286"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-286"><span class="linenos">286</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-287"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-287"><span class="linenos">287</span></a>                    <span class="c1"># Get text content</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-288"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-288"><span class="linenos">288</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-289"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-289"><span class="linenos">289</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-290"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-290"><span class="linenos">290</span></a>                    <span class="c1"># Get title if not provided</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-291"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-291"><span class="linenos">291</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-292"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-292"><span class="linenos">292</span></a>                        <span class="n">title_tag</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-293"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-293"><span class="linenos">293</span></a>                        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-294"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-294"><span class="linenos">294</span></a>                            <span class="n">title_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-295"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-295"><span class="linenos">295</span></a>                            <span class="k">if</span> <span class="n">title_tag</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-296"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-296"><span class="linenos">296</span></a>                            <span class="k">else</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-297"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-297"><span class="linenos">297</span></a>                        <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-298"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-298"><span class="linenos">298</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-299"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-299"><span class="linenos">299</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-300"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-300"><span class="linenos">300</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-301"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-301"><span class="linenos">301</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-302"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-302"><span class="linenos">302</span></a>                    <span class="c1"># Fallback if BeautifulSoup not available</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-303"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-303"><span class="linenos">303</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-304"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-304"><span class="linenos">304</span></a>                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-305"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-305"><span class="linenos">305</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-306"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-306"><span class="linenos">306</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-307"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-307"><span class="linenos">307</span></a>            <span class="k">elif</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/json&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-308"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-308"><span class="linenos">308</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-309"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-309"><span class="linenos">309</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-310"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-310"><span class="linenos">310</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span> <span class="k">if</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="k">else</span> <span class="s2">&quot;json&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-311"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-311"><span class="linenos">311</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-312"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-312"><span class="linenos">312</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Unsupported content type: </span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-313"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-313"><span class="linenos">313</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-314"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-314"><span class="linenos">314</span></a>            <span class="c1"># Clean up content</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-315"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-315"><span class="linenos">315</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-316"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-316"><span class="linenos">316</span></a>                <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-317"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-317"><span class="linenos">317</span></a>            <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-318"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-318"><span class="linenos">318</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-319"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-319"><span class="linenos">319</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-320"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-320"><span class="linenos">320</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: No content extracted from URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-321"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-321"><span class="linenos">321</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-322"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-322"><span class="linenos">322</span></a>            <span class="c1"># Add source URL to content</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-323"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-323"><span class="linenos">323</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-324"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-324"><span class="linenos">324</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-325"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-325"><span class="linenos">325</span></a>            <span class="c1"># Ingest the content</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-326"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-326"><span class="linenos">326</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-327"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-327"><span class="linenos">327</span></a>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-328"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-328"><span class="linenos">328</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-329"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-329"><span class="linenos">329</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-330"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-330"><span class="linenos">330</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error fetching URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-331"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-331"><span class="linenos">331</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-332"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-332"><span class="linenos">332</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting from URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.ingest_semantic_from_url-333"><a href="#SemanticKnowledgeIngestionTools.ingest_semantic_from_url-333"><span class="linenos">333</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting from URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest content from a URL into the local semantic knowledge base.</p>

<p>Args:
    url: URL to fetch content from
    title: Optional title for the knowledge entry (defaults to page title or URL)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory" class="classattr">
                                        <input id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch_ingest_semantic_directory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-335"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-335"><span class="linenos">335</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_ingest_semantic_directory</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-336"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-336"><span class="linenos">336</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-337"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-337"><span class="linenos">337</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-338"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-338"><span class="linenos">338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest multiple files from a directory into the local semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-339"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-339"><span class="linenos">339</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-340"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-340"><span class="linenos">340</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-341"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-341"><span class="linenos">341</span></a><span class="sd">            directory_path: Path to the directory containing files</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-342"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-342"><span class="linenos">342</span></a><span class="sd">            file_pattern: Glob pattern to match files (e.g., &quot;*.txt&quot;, &quot;*.md&quot;)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-343"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-343"><span class="linenos">343</span></a><span class="sd">            recursive: Whether to search subdirectories recursively</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-344"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-344"><span class="linenos">344</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-345"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-345"><span class="linenos">345</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-346"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-346"><span class="linenos">346</span></a><span class="sd">            Summary of ingestion results.</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-347"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-348"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-348"><span class="linenos">348</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-349"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-349"><span class="linenos">349</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-350"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-350"><span class="linenos">350</span></a>            <span class="k">if</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-351"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-351"><span class="linenos">351</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-352"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-352"><span class="linenos">352</span></a>            <span class="k">elif</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-353"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-353"><span class="linenos">353</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-354"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-354"><span class="linenos">354</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-355"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-355"><span class="linenos">355</span></a>            <span class="c1"># Validate directory exists</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-356"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-356"><span class="linenos">356</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-357"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-357"><span class="linenos">357</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Directory not found at &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-358"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-358"><span class="linenos">358</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-359"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-359"><span class="linenos">359</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-360"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-360"><span class="linenos">360</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39; is not a directory&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-361"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-361"><span class="linenos">361</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-362"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-362"><span class="linenos">362</span></a>            <span class="c1"># Find files matching pattern</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-363"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-363"><span class="linenos">363</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-364"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-364"><span class="linenos">364</span></a>            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-365"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-365"><span class="linenos">365</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-366"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-366"><span class="linenos">366</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-367"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-367"><span class="linenos">367</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-368"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-368"><span class="linenos">368</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-369"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-369"><span class="linenos">369</span></a>            <span class="c1"># Filter to only include files (not directories)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-370"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-370"><span class="linenos">370</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-371"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-371"><span class="linenos">371</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-372"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-372"><span class="linenos">372</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-373"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-373"><span class="linenos">373</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No files found matching pattern &#39;</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-374"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-374"><span class="linenos">374</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-375"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-375"><span class="linenos">375</span></a>            <span class="c1"># Limit batch size to prevent overwhelming the system</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-376"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-376"><span class="linenos">376</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-377"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-377"><span class="linenos">377</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Too many files (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">). Please process in smaller batches (max 50 files).&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-378"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-378"><span class="linenos">378</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-379"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-379"><span class="linenos">379</span></a>            <span class="c1"># Process files</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-380"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-380"><span class="linenos">380</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-381"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-381"><span class="linenos">381</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-382"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-382"><span class="linenos">382</span></a>            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-383"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-383"><span class="linenos">383</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-384"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-384"><span class="linenos">384</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_semantic_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-385"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-385"><span class="linenos">385</span></a>                    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-386"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-386"><span class="linenos">386</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-387"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-387"><span class="linenos">387</span></a>                        <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-388"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-388"><span class="linenos">388</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-389"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-389"><span class="linenos">389</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-390"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-390"><span class="linenos">390</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-391"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-391"><span class="linenos">391</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to ingest </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-392"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-392"><span class="linenos">392</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-393"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-393"><span class="linenos">393</span></a>                    <span class="c1"># Small delay to avoid overwhelming the system</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-394"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-394"><span class="linenos">394</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-395"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-395"><span class="linenos">395</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-396"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-396"><span class="linenos">396</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-397"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-397"><span class="linenos">397</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-398"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-398"><span class="linenos">398</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-399"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-399"><span class="linenos">399</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-400"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-400"><span class="linenos">400</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-401"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-401"><span class="linenos">401</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-402"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-402"><span class="linenos">402</span></a>            <span class="c1"># Format results</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-403"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-403"><span class="linenos">403</span></a>            <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Batch semantic ingestion complete: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> successful, </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> failed&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-404"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-404"><span class="linenos">404</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-405"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-405"><span class="linenos">405</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-406"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-406"><span class="linenos">406</span></a>                <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Errors:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-407"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-407"><span class="linenos">407</span></a>                    <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-408"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-408"><span class="linenos">408</span></a>                <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-409"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-409"><span class="linenos">409</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-410"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-410"><span class="linenos">410</span></a>                    <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more errors&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-411"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-411"><span class="linenos">411</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-412"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-412"><span class="linenos">412</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-413"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-413"><span class="linenos">413</span></a>                <span class="sa">f</span><span class="s2">&quot;Batch semantic ingestion completed: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files successful&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-414"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-414"><span class="linenos">414</span></a>            <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-415"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-415"><span class="linenos">415</span></a>            <span class="k">return</span> <span class="n">summary</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-416"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-416"><span class="linenos">416</span></a>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-417"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-417"><span class="linenos">417</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-418"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-418"><span class="linenos">418</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in batch semantic ingestion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-419"><a href="#SemanticKnowledgeIngestionTools.batch_ingest_semantic_directory-419"><span class="linenos">419</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error in batch semantic ingestion: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest multiple files from a directory into the local semantic knowledge base.</p>

<p>Args:
    directory_path: Path to the directory containing files
    file_pattern: Glob pattern to match files (e.g., "<em>.txt", "</em>.md")
    recursive: Whether to search subdirectories recursively</p>

<p>Returns:
    Summary of ingestion results.</p>
</div>


                            </div>
                            <div id="SemanticKnowledgeIngestionTools.query_semantic_knowledge" class="classattr">
                                        <input id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">query_semantic_knowledge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SemanticKnowledgeIngestionTools.query_semantic_knowledge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-421"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-421"><span class="linenos">421</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query_semantic_knowledge</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-422"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-423"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-423"><span class="linenos">423</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-424"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-424"><span class="linenos">424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the local semantic knowledge base to retrieve stored information.</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-425"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-425"><span class="linenos">425</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-426"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-426"><span class="linenos">426</span></a><span class="sd">        This tool searches the local LanceDB-based semantic knowledge base using vector</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-427"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-427"><span class="linenos">427</span></a><span class="sd">        similarity search. It&#39;s designed for finding factual information and documents</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-428"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-428"><span class="linenos">428</span></a><span class="sd">        that were previously ingested into the semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-429"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-429"><span class="linenos">429</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-430"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-430"><span class="linenos">430</span></a><span class="sd">        Args:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-431"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-431"><span class="linenos">431</span></a><span class="sd">            query: The search query for finding existing knowledge/documents</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-432"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-432"><span class="linenos">432</span></a><span class="sd">            limit: Maximum number of results to return</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-433"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-433"><span class="linenos">433</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-434"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-434"><span class="linenos">434</span></a><span class="sd">        Returns:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-435"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-435"><span class="linenos">435</span></a><span class="sd">            Search results from the semantic knowledge base.</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-436"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-436"><span class="linenos">436</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-437"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-437"><span class="linenos">437</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-438"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-438"><span class="linenos">438</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-439"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-439"><span class="linenos">439</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Query cannot be empty&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-440"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-440"><span class="linenos">440</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-441"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-441"><span class="linenos">441</span></a>            <span class="c1"># Filter out inappropriate creative requests</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-442"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-442"><span class="linenos">442</span></a>            <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-443"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-443"><span class="linenos">443</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-444"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-444"><span class="linenos">444</span></a>            <span class="c1"># Creative/generative request patterns that should NOT use knowledge search</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-445"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-445"><span class="linenos">445</span></a>            <span class="n">creative_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-446"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-446"><span class="linenos">446</span></a>                <span class="s2">&quot;write&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-447"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-447"><span class="linenos">447</span></a>                <span class="s2">&quot;create&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-448"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-448"><span class="linenos">448</span></a>                <span class="s2">&quot;generate&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-449"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-449"><span class="linenos">449</span></a>                <span class="s2">&quot;make&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-450"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-450"><span class="linenos">450</span></a>                <span class="s2">&quot;compose&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-451"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-451"><span class="linenos">451</span></a>                <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-452"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-452"><span class="linenos">452</span></a>                <span class="s2">&quot;tell me a&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-453"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-453"><span class="linenos">453</span></a>                <span class="s2">&quot;give me a&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-454"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-454"><span class="linenos">454</span></a>                <span class="s2">&quot;come up with&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-455"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-455"><span class="linenos">455</span></a>                <span class="s2">&quot;think of&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-456"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-456"><span class="linenos">456</span></a>                <span class="s2">&quot;story&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-457"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-457"><span class="linenos">457</span></a>                <span class="s2">&quot;poem&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-458"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-458"><span class="linenos">458</span></a>                <span class="s2">&quot;joke&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-459"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-459"><span class="linenos">459</span></a>                <span class="s2">&quot;song&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-460"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-460"><span class="linenos">460</span></a>                <span class="s2">&quot;essay&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-461"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-461"><span class="linenos">461</span></a>                <span class="s2">&quot;article&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-462"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-462"><span class="linenos">462</span></a>                <span class="s2">&quot;funny&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-463"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-463"><span class="linenos">463</span></a>                <span class="s2">&quot;creative&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-464"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-464"><span class="linenos">464</span></a>                <span class="s2">&quot;imagine&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-465"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-465"><span class="linenos">465</span></a>                <span class="s2">&quot;pretend&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-466"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-466"><span class="linenos">466</span></a>            <span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-467"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-467"><span class="linenos">467</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-468"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-468"><span class="linenos">468</span></a>            <span class="c1"># Check if this looks like a creative request</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-469"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-469"><span class="linenos">469</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">creative_patterns</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-470"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-470"><span class="linenos">470</span></a>                <span class="c1"># Additional check: if it&#39;s asking for factual info WITH creative words, allow it</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-471"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-471"><span class="linenos">471</span></a>                <span class="n">factual_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-472"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-472"><span class="linenos">472</span></a>                    <span class="s2">&quot;what is&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-473"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-473"><span class="linenos">473</span></a>                    <span class="s2">&quot;who is&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-474"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-474"><span class="linenos">474</span></a>                    <span class="s2">&quot;when did&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-475"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-475"><span class="linenos">475</span></a>                    <span class="s2">&quot;where is&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-476"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-476"><span class="linenos">476</span></a>                    <span class="s2">&quot;how does&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-477"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-477"><span class="linenos">477</span></a>                    <span class="s2">&quot;definition of&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-478"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-478"><span class="linenos">478</span></a>                    <span class="s2">&quot;information about&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-479"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-479"><span class="linenos">479</span></a>                    <span class="s2">&quot;facts about&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-480"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-480"><span class="linenos">480</span></a>                    <span class="s2">&quot;details about&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-481"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-481"><span class="linenos">481</span></a>                    <span class="s2">&quot;explain&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-482"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-482"><span class="linenos">482</span></a>                    <span class="s2">&quot;describe&quot;</span><span class="p">,</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-483"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-483"><span class="linenos">483</span></a>                <span class="p">]</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-484"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-484"><span class="linenos">484</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-485"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-485"><span class="linenos">485</span></a>                <span class="c1"># If it has factual patterns, it might be legitimate</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-486"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-486"><span class="linenos">486</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">factual</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">factual</span> <span class="ow">in</span> <span class="n">factual_patterns</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-487"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-487"><span class="linenos">487</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-488"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-488"><span class="linenos">488</span></a>                        <span class="sa">f</span><span class="s2">&quot;Rejected creative request for semantic knowledge search: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-489"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-489"><span class="linenos">489</span></a>                    <span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-490"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-490"><span class="linenos">490</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; This appears to be a creative request (&#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;). The semantic knowledge base is for searching existing stored information, not for generating new content. Please rephrase as a search for existing knowledge, or ask me to create content directly without using knowledge tools.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-491"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-491"><span class="linenos">491</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-492"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-492"><span class="linenos">492</span></a>            <span class="c1"># Get the knowledge base</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-493"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-493"><span class="linenos">493</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-494"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-494"><span class="linenos">494</span></a>                <span class="n">knowledge_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_knowledge_base</span><span class="p">()</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-495"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-495"><span class="linenos">495</span></a>                
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-496"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-496"><span class="linenos">496</span></a>                <span class="c1"># Perform semantic search</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-497"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-497"><span class="linenos">497</span></a>                <span class="n">search_results</span> <span class="o">=</span> <span class="n">knowledge_base</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">num_documents</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-498"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-498"><span class="linenos">498</span></a>                
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-499"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-499"><span class="linenos">499</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">search_results</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-500"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-500"><span class="linenos">500</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No semantic search results found for: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-501"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-501"><span class="linenos">501</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No relevant knowledge found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. Try different keywords or add more knowledge to your semantic knowledge base.&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-502"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-502"><span class="linenos">502</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-503"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-503"><span class="linenos">503</span></a>                <span class="c1"># Format results</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-504"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-504"><span class="linenos">504</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; SEMANTIC KNOWLEDGE SEARCH (found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-505"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-505"><span class="linenos">505</span></a>                
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-506"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-506"><span class="linenos">506</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">search_results</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-507"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-507"><span class="linenos">507</span></a>                    <span class="c1"># Extract content from the document</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-508"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-508"><span class="linenos">508</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-509"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-509"><span class="linenos">509</span></a>                    <span class="c1"># Truncate long content for display</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-510"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-510"><span class="linenos">510</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-511"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-511"><span class="linenos">511</span></a>                        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-512"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-512"><span class="linenos">512</span></a>                    
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-513"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-513"><span class="linenos">513</span></a>                    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-514"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-514"><span class="linenos">514</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-515"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-515"><span class="linenos">515</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Semantic knowledge search successful: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-516"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-516"><span class="linenos">516</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-517"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-517"><span class="linenos">517</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-518"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-518"><span class="linenos">518</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-519"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-519"><span class="linenos">519</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying semantic knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-520"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-520"><span class="linenos">520</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying semantic knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-521"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-521"><span class="linenos">521</span></a>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-522"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-522"><span class="linenos">522</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-523"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-523"><span class="linenos">523</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in semantic knowledge query: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SemanticKnowledgeIngestionTools.query_semantic_knowledge-524"><a href="#SemanticKnowledgeIngestionTools.query_semantic_knowledge-524"><span class="linenos">524</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error in semantic knowledge query: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Query the local semantic knowledge base to retrieve stored information.</p>

<p>This tool searches the local LanceDB-based semantic knowledge base using vector
similarity search. It's designed for finding factual information and documents
that were previously ingested into the semantic knowledge base.</p>

<p>Args:
    query: The search query for finding existing knowledge/documents
    limit: Maximum number of results to return</p>

<p>Returns:
    Search results from the semantic knowledge base.</p>
</div>


                            </div>
                </section>
                <section id="KnowledgeTools">
                            <input id="KnowledgeTools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KnowledgeTools</span><wbr>(<span class="base">agno.tools.toolkit.Toolkit</span>):

                <label class="view-source-button" for="KnowledgeTools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeTools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeTools-124"><a href="#KnowledgeTools-124"><span class="linenos">124</span></a><span class="k">class</span><span class="w"> </span><span class="nc">KnowledgeTools</span><span class="p">(</span><span class="n">Toolkit</span><span class="p">):</span>
</span><span id="KnowledgeTools-125"><a href="#KnowledgeTools-125"><span class="linenos">125</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Knowledge Base Management Tools for Factual Information Storage and Retrieval.</span>
</span><span id="KnowledgeTools-126"><a href="#KnowledgeTools-126"><span class="linenos">126</span></a><span class="sd">    Use these tools when you need to:</span>
</span><span id="KnowledgeTools-127"><a href="#KnowledgeTools-127"><span class="linenos">127</span></a><span class="sd">    - Store factual information, documents, or reference materials for future retrieval</span>
</span><span id="KnowledgeTools-128"><a href="#KnowledgeTools-128"><span class="linenos">128</span></a><span class="sd">    - Search for previously stored knowledge, facts, or documents</span>
</span><span id="KnowledgeTools-129"><a href="#KnowledgeTools-129"><span class="linenos">129</span></a><span class="sd">    - Ingest content from files, URLs, or text into the knowledge base</span>
</span><span id="KnowledgeTools-130"><a href="#KnowledgeTools-130"><span class="linenos">130</span></a><span class="sd">    - Find information that was previously added to the knowledge base</span>
</span><span id="KnowledgeTools-131"><a href="#KnowledgeTools-131"><span class="linenos">131</span></a>
</span><span id="KnowledgeTools-132"><a href="#KnowledgeTools-132"><span class="linenos">132</span></a><span class="sd">    DO NOT use these tools for:</span>
</span><span id="KnowledgeTools-133"><a href="#KnowledgeTools-133"><span class="linenos">133</span></a><span class="sd">    - Storing personal information about the user (use memory tools instead)</span>
</span><span id="KnowledgeTools-134"><a href="#KnowledgeTools-134"><span class="linenos">134</span></a><span class="sd">    - Creative requests like writing stories or poems</span>
</span><span id="KnowledgeTools-135"><a href="#KnowledgeTools-135"><span class="linenos">135</span></a><span class="sd">    - General questions that don&#39;t require stored knowledge</span>
</span><span id="KnowledgeTools-136"><a href="#KnowledgeTools-136"><span class="linenos">136</span></a>
</span><span id="KnowledgeTools-137"><a href="#KnowledgeTools-137"><span class="linenos">137</span></a><span class="sd">    The knowledge base is separate from memory - it&#39;s for factual information that doesn&#39;t change,</span>
</span><span id="KnowledgeTools-138"><a href="#KnowledgeTools-138"><span class="linenos">138</span></a><span class="sd">    while memory is for personal information about the user that evolves over time.</span>
</span><span id="KnowledgeTools-139"><a href="#KnowledgeTools-139"><span class="linenos">139</span></a>
</span><span id="KnowledgeTools-140"><a href="#KnowledgeTools-140"><span class="linenos">140</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools-141"><a href="#KnowledgeTools-141"><span class="linenos">141</span></a>
</span><span id="KnowledgeTools-142"><a href="#KnowledgeTools-142"><span class="linenos">142</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledge_manager</span><span class="p">:</span> <span class="n">KnowledgeManager</span><span class="p">,</span> <span class="n">agno_knowledge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="KnowledgeTools-143"><a href="#KnowledgeTools-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span> <span class="o">=</span> <span class="n">knowledge_manager</span>
</span><span id="KnowledgeTools-144"><a href="#KnowledgeTools-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="n">agno_knowledge</span>
</span><span id="KnowledgeTools-145"><a href="#KnowledgeTools-145"><span class="linenos">145</span></a>        
</span><span id="KnowledgeTools-146"><a href="#KnowledgeTools-146"><span class="linenos">146</span></a>        <span class="c1"># Initialize knowledge coordinator for unified querying</span>
</span><span id="KnowledgeTools-147"><a href="#KnowledgeTools-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KnowledgeTools-148"><a href="#KnowledgeTools-148"><span class="linenos">148</span></a>
</span><span id="KnowledgeTools-149"><a href="#KnowledgeTools-149"><span class="linenos">149</span></a>        <span class="c1"># Collect knowledge tool methods</span>
</span><span id="KnowledgeTools-150"><a href="#KnowledgeTools-150"><span class="linenos">150</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeTools-151"><a href="#KnowledgeTools-151"><span class="linenos">151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_file</span><span class="p">,</span>
</span><span id="KnowledgeTools-152"><a href="#KnowledgeTools-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_text</span><span class="p">,</span>
</span><span id="KnowledgeTools-153"><a href="#KnowledgeTools-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_from_url</span><span class="p">,</span>
</span><span id="KnowledgeTools-154"><a href="#KnowledgeTools-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">batch_ingest_directory</span><span class="p">,</span>
</span><span id="KnowledgeTools-155"><a href="#KnowledgeTools-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">query_knowledge_base</span><span class="p">,</span>
</span><span id="KnowledgeTools-156"><a href="#KnowledgeTools-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">query_lightrag_knowledge_direct</span><span class="p">,</span>
</span><span id="KnowledgeTools-157"><a href="#KnowledgeTools-157"><span class="linenos">157</span></a>        <span class="p">]</span>
</span><span id="KnowledgeTools-158"><a href="#KnowledgeTools-158"><span class="linenos">158</span></a>
</span><span id="KnowledgeTools-159"><a href="#KnowledgeTools-159"><span class="linenos">159</span></a>        <span class="c1"># Initialize the Toolkit</span>
</span><span id="KnowledgeTools-160"><a href="#KnowledgeTools-160"><span class="linenos">160</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KnowledgeTools-161"><a href="#KnowledgeTools-161"><span class="linenos">161</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;knowledge_tools&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-162"><a href="#KnowledgeTools-162"><span class="linenos">162</span></a>            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span><span id="KnowledgeTools-163"><a href="#KnowledgeTools-163"><span class="linenos">163</span></a>            <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Use these tools to manage factual information and documents in the knowledge base.</span>
</span><span id="KnowledgeTools-164"><a href="#KnowledgeTools-164"><span class="linenos">164</span></a><span class="s2">            Store reference materials, facts, and documents that don&#39;t change.</span>
</span><span id="KnowledgeTools-165"><a href="#KnowledgeTools-165"><span class="linenos">165</span></a><span class="s2">            Query when you need to find previously stored factual information.</span>
</span><span id="KnowledgeTools-166"><a href="#KnowledgeTools-166"><span class="linenos">166</span></a><span class="s2">            Do NOT use for personal user information - use memory tools for that.&quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-167"><a href="#KnowledgeTools-167"><span class="linenos">167</span></a>        <span class="p">)</span>
</span><span id="KnowledgeTools-168"><a href="#KnowledgeTools-168"><span class="linenos">168</span></a>
</span><span id="KnowledgeTools-169"><a href="#KnowledgeTools-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools-170"><a href="#KnowledgeTools-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest a file into the knowledge base.</span>
</span><span id="KnowledgeTools-171"><a href="#KnowledgeTools-171"><span class="linenos">171</span></a>
</span><span id="KnowledgeTools-172"><a href="#KnowledgeTools-172"><span class="linenos">172</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools-173"><a href="#KnowledgeTools-173"><span class="linenos">173</span></a><span class="sd">            file_path: Path to the file to ingest</span>
</span><span id="KnowledgeTools-174"><a href="#KnowledgeTools-174"><span class="linenos">174</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to filename)</span>
</span><span id="KnowledgeTools-175"><a href="#KnowledgeTools-175"><span class="linenos">175</span></a>
</span><span id="KnowledgeTools-176"><a href="#KnowledgeTools-176"><span class="linenos">176</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools-177"><a href="#KnowledgeTools-177"><span class="linenos">177</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeTools-178"><a href="#KnowledgeTools-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools-179"><a href="#KnowledgeTools-179"><span class="linenos">179</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-180"><a href="#KnowledgeTools-180"><span class="linenos">180</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="KnowledgeTools-181"><a href="#KnowledgeTools-181"><span class="linenos">181</span></a>            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools-182"><a href="#KnowledgeTools-182"><span class="linenos">182</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-183"><a href="#KnowledgeTools-183"><span class="linenos">183</span></a>            <span class="k">elif</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools-184"><a href="#KnowledgeTools-184"><span class="linenos">184</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-185"><a href="#KnowledgeTools-185"><span class="linenos">185</span></a>
</span><span id="KnowledgeTools-186"><a href="#KnowledgeTools-186"><span class="linenos">186</span></a>            <span class="c1"># Validate file exists</span>
</span><span id="KnowledgeTools-187"><a href="#KnowledgeTools-187"><span class="linenos">187</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="KnowledgeTools-188"><a href="#KnowledgeTools-188"><span class="linenos">188</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File not found at &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeTools-189"><a href="#KnowledgeTools-189"><span class="linenos">189</span></a>
</span><span id="KnowledgeTools-190"><a href="#KnowledgeTools-190"><span class="linenos">190</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="KnowledgeTools-191"><a href="#KnowledgeTools-191"><span class="linenos">191</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; is not a file&quot;</span>
</span><span id="KnowledgeTools-192"><a href="#KnowledgeTools-192"><span class="linenos">192</span></a>
</span><span id="KnowledgeTools-193"><a href="#KnowledgeTools-193"><span class="linenos">193</span></a>            <span class="c1"># Get file info</span>
</span><span id="KnowledgeTools-194"><a href="#KnowledgeTools-194"><span class="linenos">194</span></a>            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-195"><a href="#KnowledgeTools-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 50MB limit</span>
</span><span id="KnowledgeTools-196"><a href="#KnowledgeTools-196"><span class="linenos">196</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File too large (</span><span class="si">{</span><span class="n">file_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB). Maximum size is 50MB.&quot;</span>
</span><span id="KnowledgeTools-197"><a href="#KnowledgeTools-197"><span class="linenos">197</span></a>
</span><span id="KnowledgeTools-198"><a href="#KnowledgeTools-198"><span class="linenos">198</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-199"><a href="#KnowledgeTools-199"><span class="linenos">199</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="KnowledgeTools-200"><a href="#KnowledgeTools-200"><span class="linenos">200</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="KnowledgeTools-201"><a href="#KnowledgeTools-201"><span class="linenos">201</span></a>
</span><span id="KnowledgeTools-202"><a href="#KnowledgeTools-202"><span class="linenos">202</span></a>            <span class="c1"># Check file type</span>
</span><span id="KnowledgeTools-203"><a href="#KnowledgeTools-203"><span class="linenos">203</span></a>            <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-204"><a href="#KnowledgeTools-204"><span class="linenos">204</span></a>            <span class="n">supported_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeTools-205"><a href="#KnowledgeTools-205"><span class="linenos">205</span></a>                <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-206"><a href="#KnowledgeTools-206"><span class="linenos">206</span></a>                <span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-207"><a href="#KnowledgeTools-207"><span class="linenos">207</span></a>                <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-208"><a href="#KnowledgeTools-208"><span class="linenos">208</span></a>                <span class="s2">&quot;text/csv&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-209"><a href="#KnowledgeTools-209"><span class="linenos">209</span></a>                <span class="s2">&quot;application/pdf&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-210"><a href="#KnowledgeTools-210"><span class="linenos">210</span></a>                <span class="s2">&quot;application/msword&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-211"><a href="#KnowledgeTools-211"><span class="linenos">211</span></a>                <span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-212"><a href="#KnowledgeTools-212"><span class="linenos">212</span></a>            <span class="p">]</span>
</span><span id="KnowledgeTools-213"><a href="#KnowledgeTools-213"><span class="linenos">213</span></a>
</span><span id="KnowledgeTools-214"><a href="#KnowledgeTools-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="n">mime_type</span> <span class="ow">and</span> <span class="n">mime_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_types</span><span class="p">:</span>
</span><span id="KnowledgeTools-215"><a href="#KnowledgeTools-215"><span class="linenos">215</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File type </span><span class="si">{</span><span class="n">mime_type</span><span class="si">}</span><span class="s2"> may not be fully supported&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-216"><a href="#KnowledgeTools-216"><span class="linenos">216</span></a>
</span><span id="KnowledgeTools-217"><a href="#KnowledgeTools-217"><span class="linenos">217</span></a>            <span class="c1"># Copy file to knowledge directory</span>
</span><span id="KnowledgeTools-218"><a href="#KnowledgeTools-218"><span class="linenos">218</span></a>            <span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">)</span>
</span><span id="KnowledgeTools-219"><a href="#KnowledgeTools-219"><span class="linenos">219</span></a>            <span class="n">knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="KnowledgeTools-220"><a href="#KnowledgeTools-220"><span class="linenos">220</span></a>
</span><span id="KnowledgeTools-221"><a href="#KnowledgeTools-221"><span class="linenos">221</span></a>            <span class="c1"># Create unique filename to avoid conflicts</span>
</span><span id="KnowledgeTools-222"><a href="#KnowledgeTools-222"><span class="linenos">222</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="KnowledgeTools-223"><a href="#KnowledgeTools-223"><span class="linenos">223</span></a>            <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="KnowledgeTools-224"><a href="#KnowledgeTools-224"><span class="linenos">224</span></a>            <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="KnowledgeTools-225"><a href="#KnowledgeTools-225"><span class="linenos">225</span></a>            <span class="n">unique_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-226"><a href="#KnowledgeTools-226"><span class="linenos">226</span></a>
</span><span id="KnowledgeTools-227"><a href="#KnowledgeTools-227"><span class="linenos">227</span></a>            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">knowledge_dir</span> <span class="o">/</span> <span class="n">unique_filename</span>
</span><span id="KnowledgeTools-228"><a href="#KnowledgeTools-228"><span class="linenos">228</span></a>
</span><span id="KnowledgeTools-229"><a href="#KnowledgeTools-229"><span class="linenos">229</span></a>            <span class="c1"># Copy the file</span>
</span><span id="KnowledgeTools-230"><a href="#KnowledgeTools-230"><span class="linenos">230</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-231"><a href="#KnowledgeTools-231"><span class="linenos">231</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied file to knowledge directory: </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-232"><a href="#KnowledgeTools-232"><span class="linenos">232</span></a>
</span><span id="KnowledgeTools-233"><a href="#KnowledgeTools-233"><span class="linenos">233</span></a>            <span class="c1"># Upload to LightRAG server</span>
</span><span id="KnowledgeTools-234"><a href="#KnowledgeTools-234"><span class="linenos">234</span></a>            <span class="n">upload_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeTools-235"><a href="#KnowledgeTools-235"><span class="linenos">235</span></a>                <span class="n">dest_path</span><span class="p">,</span> <span class="n">unique_filename</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeTools-236"><a href="#KnowledgeTools-236"><span class="linenos">236</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools-237"><a href="#KnowledgeTools-237"><span class="linenos">237</span></a>
</span><span id="KnowledgeTools-238"><a href="#KnowledgeTools-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="p">:</span>
</span><span id="KnowledgeTools-239"><a href="#KnowledgeTools-239"><span class="linenos">239</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested knowledge file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-240"><a href="#KnowledgeTools-240"><span class="linenos">240</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; into knowledge base. </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-241"><a href="#KnowledgeTools-241"><span class="linenos">241</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-242"><a href="#KnowledgeTools-242"><span class="linenos">242</span></a>                <span class="c1"># Clean up the copied file if upload failed</span>
</span><span id="KnowledgeTools-243"><a href="#KnowledgeTools-243"><span class="linenos">243</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-244"><a href="#KnowledgeTools-244"><span class="linenos">244</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-245"><a href="#KnowledgeTools-245"><span class="linenos">245</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="KnowledgeTools-246"><a href="#KnowledgeTools-246"><span class="linenos">246</span></a>                    <span class="k">pass</span>
</span><span id="KnowledgeTools-247"><a href="#KnowledgeTools-247"><span class="linenos">247</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-248"><a href="#KnowledgeTools-248"><span class="linenos">248</span></a>
</span><span id="KnowledgeTools-249"><a href="#KnowledgeTools-249"><span class="linenos">249</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-250"><a href="#KnowledgeTools-250"><span class="linenos">250</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-251"><a href="#KnowledgeTools-251"><span class="linenos">251</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-252"><a href="#KnowledgeTools-252"><span class="linenos">252</span></a>
</span><span id="KnowledgeTools-253"><a href="#KnowledgeTools-253"><span class="linenos">253</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_text</span><span class="p">(</span>
</span><span id="KnowledgeTools-254"><a href="#KnowledgeTools-254"><span class="linenos">254</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</span><span id="KnowledgeTools-255"><a href="#KnowledgeTools-255"><span class="linenos">255</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools-256"><a href="#KnowledgeTools-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest text content directly into the knowledge base.</span>
</span><span id="KnowledgeTools-257"><a href="#KnowledgeTools-257"><span class="linenos">257</span></a>
</span><span id="KnowledgeTools-258"><a href="#KnowledgeTools-258"><span class="linenos">258</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools-259"><a href="#KnowledgeTools-259"><span class="linenos">259</span></a><span class="sd">            content: The text content to ingest</span>
</span><span id="KnowledgeTools-260"><a href="#KnowledgeTools-260"><span class="linenos">260</span></a><span class="sd">            title: Title for the knowledge entry</span>
</span><span id="KnowledgeTools-261"><a href="#KnowledgeTools-261"><span class="linenos">261</span></a><span class="sd">            file_type: File extension to use (txt, md, html, etc.)</span>
</span><span id="KnowledgeTools-262"><a href="#KnowledgeTools-262"><span class="linenos">262</span></a>
</span><span id="KnowledgeTools-263"><a href="#KnowledgeTools-263"><span class="linenos">263</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools-264"><a href="#KnowledgeTools-264"><span class="linenos">264</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeTools-265"><a href="#KnowledgeTools-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools-266"><a href="#KnowledgeTools-266"><span class="linenos">266</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-267"><a href="#KnowledgeTools-267"><span class="linenos">267</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools-268"><a href="#KnowledgeTools-268"><span class="linenos">268</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Content cannot be empty&quot;</span>
</span><span id="KnowledgeTools-269"><a href="#KnowledgeTools-269"><span class="linenos">269</span></a>
</span><span id="KnowledgeTools-270"><a href="#KnowledgeTools-270"><span class="linenos">270</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools-271"><a href="#KnowledgeTools-271"><span class="linenos">271</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Title is required&quot;</span>
</span><span id="KnowledgeTools-272"><a href="#KnowledgeTools-272"><span class="linenos">272</span></a>
</span><span id="KnowledgeTools-273"><a href="#KnowledgeTools-273"><span class="linenos">273</span></a>            <span class="c1"># Validate file_type</span>
</span><span id="KnowledgeTools-274"><a href="#KnowledgeTools-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools-275"><a href="#KnowledgeTools-275"><span class="linenos">275</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-276"><a href="#KnowledgeTools-276"><span class="linenos">276</span></a>
</span><span id="KnowledgeTools-277"><a href="#KnowledgeTools-277"><span class="linenos">277</span></a>            <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;.md&quot;</span><span class="p">,</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools-278"><a href="#KnowledgeTools-278"><span class="linenos">278</span></a>            <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">:</span>
</span><span id="KnowledgeTools-279"><a href="#KnowledgeTools-279"><span class="linenos">279</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;.txt&quot;</span>  <span class="c1"># Default to txt</span>
</span><span id="KnowledgeTools-280"><a href="#KnowledgeTools-280"><span class="linenos">280</span></a>
</span><span id="KnowledgeTools-281"><a href="#KnowledgeTools-281"><span class="linenos">281</span></a>            <span class="c1"># Create knowledge directory</span>
</span><span id="KnowledgeTools-282"><a href="#KnowledgeTools-282"><span class="linenos">282</span></a>            <span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">)</span>
</span><span id="KnowledgeTools-283"><a href="#KnowledgeTools-283"><span class="linenos">283</span></a>            <span class="n">knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="KnowledgeTools-284"><a href="#KnowledgeTools-284"><span class="linenos">284</span></a>
</span><span id="KnowledgeTools-285"><a href="#KnowledgeTools-285"><span class="linenos">285</span></a>            <span class="c1"># Create unique filename</span>
</span><span id="KnowledgeTools-286"><a href="#KnowledgeTools-286"><span class="linenos">286</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="KnowledgeTools-287"><a href="#KnowledgeTools-287"><span class="linenos">287</span></a>            <span class="n">content_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
</span><span id="KnowledgeTools-288"><a href="#KnowledgeTools-288"><span class="linenos">288</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="KnowledgeTools-289"><a href="#KnowledgeTools-289"><span class="linenos">289</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="KnowledgeTools-290"><a href="#KnowledgeTools-290"><span class="linenos">290</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeTools-291"><a href="#KnowledgeTools-291"><span class="linenos">291</span></a>                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">title</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-292"><a href="#KnowledgeTools-292"><span class="linenos">292</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="KnowledgeTools-293"><a href="#KnowledgeTools-293"><span class="linenos">293</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="n">safe_title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>  <span class="c1"># Limit length</span>
</span><span id="KnowledgeTools-294"><a href="#KnowledgeTools-294"><span class="linenos">294</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content_hash</span><span class="si">}{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-295"><a href="#KnowledgeTools-295"><span class="linenos">295</span></a>
</span><span id="KnowledgeTools-296"><a href="#KnowledgeTools-296"><span class="linenos">296</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">knowledge_dir</span> <span class="o">/</span> <span class="n">filename</span>
</span><span id="KnowledgeTools-297"><a href="#KnowledgeTools-297"><span class="linenos">297</span></a>
</span><span id="KnowledgeTools-298"><a href="#KnowledgeTools-298"><span class="linenos">298</span></a>            <span class="c1"># Write content to file</span>
</span><span id="KnowledgeTools-299"><a href="#KnowledgeTools-299"><span class="linenos">299</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="KnowledgeTools-300"><a href="#KnowledgeTools-300"><span class="linenos">300</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="KnowledgeTools-301"><a href="#KnowledgeTools-301"><span class="linenos">301</span></a>
</span><span id="KnowledgeTools-302"><a href="#KnowledgeTools-302"><span class="linenos">302</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created knowledge file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-303"><a href="#KnowledgeTools-303"><span class="linenos">303</span></a>
</span><span id="KnowledgeTools-304"><a href="#KnowledgeTools-304"><span class="linenos">304</span></a>            <span class="c1"># Upload to LightRAG server</span>
</span><span id="KnowledgeTools-305"><a href="#KnowledgeTools-305"><span class="linenos">305</span></a>            <span class="n">upload_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeTools-306"><a href="#KnowledgeTools-306"><span class="linenos">306</span></a>                <span class="n">file_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeTools-307"><a href="#KnowledgeTools-307"><span class="linenos">307</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools-308"><a href="#KnowledgeTools-308"><span class="linenos">308</span></a>
</span><span id="KnowledgeTools-309"><a href="#KnowledgeTools-309"><span class="linenos">309</span></a>            <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="p">:</span>
</span><span id="KnowledgeTools-310"><a href="#KnowledgeTools-310"><span class="linenos">310</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested knowledge text: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-311"><a href="#KnowledgeTools-311"><span class="linenos">311</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39; into knowledge base. </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-312"><a href="#KnowledgeTools-312"><span class="linenos">312</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-313"><a href="#KnowledgeTools-313"><span class="linenos">313</span></a>                <span class="c1"># Clean up the created file if upload failed</span>
</span><span id="KnowledgeTools-314"><a href="#KnowledgeTools-314"><span class="linenos">314</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-315"><a href="#KnowledgeTools-315"><span class="linenos">315</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-316"><a href="#KnowledgeTools-316"><span class="linenos">316</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="KnowledgeTools-317"><a href="#KnowledgeTools-317"><span class="linenos">317</span></a>                    <span class="k">pass</span>
</span><span id="KnowledgeTools-318"><a href="#KnowledgeTools-318"><span class="linenos">318</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-319"><a href="#KnowledgeTools-319"><span class="linenos">319</span></a>
</span><span id="KnowledgeTools-320"><a href="#KnowledgeTools-320"><span class="linenos">320</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-321"><a href="#KnowledgeTools-321"><span class="linenos">321</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting text content: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-322"><a href="#KnowledgeTools-322"><span class="linenos">322</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting text content: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-323"><a href="#KnowledgeTools-323"><span class="linenos">323</span></a>
</span><span id="KnowledgeTools-324"><a href="#KnowledgeTools-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools-325"><a href="#KnowledgeTools-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest content from a URL into the knowledge base.</span>
</span><span id="KnowledgeTools-326"><a href="#KnowledgeTools-326"><span class="linenos">326</span></a>
</span><span id="KnowledgeTools-327"><a href="#KnowledgeTools-327"><span class="linenos">327</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools-328"><a href="#KnowledgeTools-328"><span class="linenos">328</span></a><span class="sd">            url: URL to fetch content from</span>
</span><span id="KnowledgeTools-329"><a href="#KnowledgeTools-329"><span class="linenos">329</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to page title or URL)</span>
</span><span id="KnowledgeTools-330"><a href="#KnowledgeTools-330"><span class="linenos">330</span></a>
</span><span id="KnowledgeTools-331"><a href="#KnowledgeTools-331"><span class="linenos">331</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools-332"><a href="#KnowledgeTools-332"><span class="linenos">332</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeTools-333"><a href="#KnowledgeTools-333"><span class="linenos">333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools-334"><a href="#KnowledgeTools-334"><span class="linenos">334</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-335"><a href="#KnowledgeTools-335"><span class="linenos">335</span></a>            <span class="c1"># Validate URL</span>
</span><span id="KnowledgeTools-336"><a href="#KnowledgeTools-336"><span class="linenos">336</span></a>            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="KnowledgeTools-337"><a href="#KnowledgeTools-337"><span class="linenos">337</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
</span><span id="KnowledgeTools-338"><a href="#KnowledgeTools-338"><span class="linenos">338</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Invalid URL format: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-339"><a href="#KnowledgeTools-339"><span class="linenos">339</span></a>
</span><span id="KnowledgeTools-340"><a href="#KnowledgeTools-340"><span class="linenos">340</span></a>            <span class="c1"># Fetch content</span>
</span><span id="KnowledgeTools-341"><a href="#KnowledgeTools-341"><span class="linenos">341</span></a>            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KnowledgeTools-342"><a href="#KnowledgeTools-342"><span class="linenos">342</span></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36&quot;</span>
</span><span id="KnowledgeTools-343"><a href="#KnowledgeTools-343"><span class="linenos">343</span></a>            <span class="p">}</span>
</span><span id="KnowledgeTools-344"><a href="#KnowledgeTools-344"><span class="linenos">344</span></a>
</span><span id="KnowledgeTools-345"><a href="#KnowledgeTools-345"><span class="linenos">345</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span id="KnowledgeTools-346"><a href="#KnowledgeTools-346"><span class="linenos">346</span></a>            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="KnowledgeTools-347"><a href="#KnowledgeTools-347"><span class="linenos">347</span></a>
</span><span id="KnowledgeTools-348"><a href="#KnowledgeTools-348"><span class="linenos">348</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="KnowledgeTools-349"><a href="#KnowledgeTools-349"><span class="linenos">349</span></a>
</span><span id="KnowledgeTools-350"><a href="#KnowledgeTools-350"><span class="linenos">350</span></a>            <span class="c1"># Handle different content types</span>
</span><span id="KnowledgeTools-351"><a href="#KnowledgeTools-351"><span class="linenos">351</span></a>            <span class="k">if</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="KnowledgeTools-352"><a href="#KnowledgeTools-352"><span class="linenos">352</span></a>                <span class="c1"># For HTML, try to extract text content</span>
</span><span id="KnowledgeTools-353"><a href="#KnowledgeTools-353"><span class="linenos">353</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-354"><a href="#KnowledgeTools-354"><span class="linenos">354</span></a>
</span><span id="KnowledgeTools-355"><a href="#KnowledgeTools-355"><span class="linenos">355</span></a>                    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-356"><a href="#KnowledgeTools-356"><span class="linenos">356</span></a>
</span><span id="KnowledgeTools-357"><a href="#KnowledgeTools-357"><span class="linenos">357</span></a>                    <span class="c1"># Remove script and style elements</span>
</span><span id="KnowledgeTools-358"><a href="#KnowledgeTools-358"><span class="linenos">358</span></a>                    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
</span><span id="KnowledgeTools-359"><a href="#KnowledgeTools-359"><span class="linenos">359</span></a>                        <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</span><span id="KnowledgeTools-360"><a href="#KnowledgeTools-360"><span class="linenos">360</span></a>
</span><span id="KnowledgeTools-361"><a href="#KnowledgeTools-361"><span class="linenos">361</span></a>                    <span class="c1"># Get text content</span>
</span><span id="KnowledgeTools-362"><a href="#KnowledgeTools-362"><span class="linenos">362</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</span><span id="KnowledgeTools-363"><a href="#KnowledgeTools-363"><span class="linenos">363</span></a>
</span><span id="KnowledgeTools-364"><a href="#KnowledgeTools-364"><span class="linenos">364</span></a>                    <span class="c1"># Get title if not provided</span>
</span><span id="KnowledgeTools-365"><a href="#KnowledgeTools-365"><span class="linenos">365</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="KnowledgeTools-366"><a href="#KnowledgeTools-366"><span class="linenos">366</span></a>                        <span class="n">title_tag</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-367"><a href="#KnowledgeTools-367"><span class="linenos">367</span></a>                        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="KnowledgeTools-368"><a href="#KnowledgeTools-368"><span class="linenos">368</span></a>                            <span class="n">title_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeTools-369"><a href="#KnowledgeTools-369"><span class="linenos">369</span></a>                            <span class="k">if</span> <span class="n">title_tag</span>
</span><span id="KnowledgeTools-370"><a href="#KnowledgeTools-370"><span class="linenos">370</span></a>                            <span class="k">else</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeTools-371"><a href="#KnowledgeTools-371"><span class="linenos">371</span></a>                        <span class="p">)</span>
</span><span id="KnowledgeTools-372"><a href="#KnowledgeTools-372"><span class="linenos">372</span></a>
</span><span id="KnowledgeTools-373"><a href="#KnowledgeTools-373"><span class="linenos">373</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="KnowledgeTools-374"><a href="#KnowledgeTools-374"><span class="linenos">374</span></a>
</span><span id="KnowledgeTools-375"><a href="#KnowledgeTools-375"><span class="linenos">375</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="KnowledgeTools-376"><a href="#KnowledgeTools-376"><span class="linenos">376</span></a>                    <span class="c1"># Fallback if BeautifulSoup not available</span>
</span><span id="KnowledgeTools-377"><a href="#KnowledgeTools-377"><span class="linenos">377</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeTools-378"><a href="#KnowledgeTools-378"><span class="linenos">378</span></a>                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeTools-379"><a href="#KnowledgeTools-379"><span class="linenos">379</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="KnowledgeTools-380"><a href="#KnowledgeTools-380"><span class="linenos">380</span></a>
</span><span id="KnowledgeTools-381"><a href="#KnowledgeTools-381"><span class="linenos">381</span></a>            <span class="k">elif</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/json&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="KnowledgeTools-382"><a href="#KnowledgeTools-382"><span class="linenos">382</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeTools-383"><a href="#KnowledgeTools-383"><span class="linenos">383</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeTools-384"><a href="#KnowledgeTools-384"><span class="linenos">384</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span> <span class="k">if</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="k">else</span> <span class="s2">&quot;json&quot;</span>
</span><span id="KnowledgeTools-385"><a href="#KnowledgeTools-385"><span class="linenos">385</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-386"><a href="#KnowledgeTools-386"><span class="linenos">386</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Unsupported content type: </span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-387"><a href="#KnowledgeTools-387"><span class="linenos">387</span></a>
</span><span id="KnowledgeTools-388"><a href="#KnowledgeTools-388"><span class="linenos">388</span></a>            <span class="c1"># Clean up content</span>
</span><span id="KnowledgeTools-389"><a href="#KnowledgeTools-389"><span class="linenos">389</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeTools-390"><a href="#KnowledgeTools-390"><span class="linenos">390</span></a>                <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeTools-391"><a href="#KnowledgeTools-391"><span class="linenos">391</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools-392"><a href="#KnowledgeTools-392"><span class="linenos">392</span></a>
</span><span id="KnowledgeTools-393"><a href="#KnowledgeTools-393"><span class="linenos">393</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
</span><span id="KnowledgeTools-394"><a href="#KnowledgeTools-394"><span class="linenos">394</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: No content extracted from URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-395"><a href="#KnowledgeTools-395"><span class="linenos">395</span></a>
</span><span id="KnowledgeTools-396"><a href="#KnowledgeTools-396"><span class="linenos">396</span></a>            <span class="c1"># Add source URL to content</span>
</span><span id="KnowledgeTools-397"><a href="#KnowledgeTools-397"><span class="linenos">397</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-398"><a href="#KnowledgeTools-398"><span class="linenos">398</span></a>
</span><span id="KnowledgeTools-399"><a href="#KnowledgeTools-399"><span class="linenos">399</span></a>            <span class="c1"># Ingest the content</span>
</span><span id="KnowledgeTools-400"><a href="#KnowledgeTools-400"><span class="linenos">400</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</span><span id="KnowledgeTools-401"><a href="#KnowledgeTools-401"><span class="linenos">401</span></a>
</span><span id="KnowledgeTools-402"><a href="#KnowledgeTools-402"><span class="linenos">402</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-403"><a href="#KnowledgeTools-403"><span class="linenos">403</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-404"><a href="#KnowledgeTools-404"><span class="linenos">404</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error fetching URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-405"><a href="#KnowledgeTools-405"><span class="linenos">405</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-406"><a href="#KnowledgeTools-406"><span class="linenos">406</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting from URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-407"><a href="#KnowledgeTools-407"><span class="linenos">407</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting from URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-408"><a href="#KnowledgeTools-408"><span class="linenos">408</span></a>
</span><span id="KnowledgeTools-409"><a href="#KnowledgeTools-409"><span class="linenos">409</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_ingest_directory</span><span class="p">(</span>
</span><span id="KnowledgeTools-410"><a href="#KnowledgeTools-410"><span class="linenos">410</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KnowledgeTools-411"><a href="#KnowledgeTools-411"><span class="linenos">411</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools-412"><a href="#KnowledgeTools-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest multiple files from a directory into the knowledge base.</span>
</span><span id="KnowledgeTools-413"><a href="#KnowledgeTools-413"><span class="linenos">413</span></a>
</span><span id="KnowledgeTools-414"><a href="#KnowledgeTools-414"><span class="linenos">414</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools-415"><a href="#KnowledgeTools-415"><span class="linenos">415</span></a><span class="sd">            directory_path: Path to the directory containing files</span>
</span><span id="KnowledgeTools-416"><a href="#KnowledgeTools-416"><span class="linenos">416</span></a><span class="sd">            file_pattern: Glob pattern to match files (e.g., &quot;*.txt&quot;, &quot;*.md&quot;)</span>
</span><span id="KnowledgeTools-417"><a href="#KnowledgeTools-417"><span class="linenos">417</span></a><span class="sd">            recursive: Whether to search subdirectories recursively</span>
</span><span id="KnowledgeTools-418"><a href="#KnowledgeTools-418"><span class="linenos">418</span></a>
</span><span id="KnowledgeTools-419"><a href="#KnowledgeTools-419"><span class="linenos">419</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools-420"><a href="#KnowledgeTools-420"><span class="linenos">420</span></a><span class="sd">            Summary of ingestion results.</span>
</span><span id="KnowledgeTools-421"><a href="#KnowledgeTools-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools-422"><a href="#KnowledgeTools-422"><span class="linenos">422</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-423"><a href="#KnowledgeTools-423"><span class="linenos">423</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="KnowledgeTools-424"><a href="#KnowledgeTools-424"><span class="linenos">424</span></a>            <span class="k">if</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools-425"><a href="#KnowledgeTools-425"><span class="linenos">425</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-426"><a href="#KnowledgeTools-426"><span class="linenos">426</span></a>            <span class="k">elif</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools-427"><a href="#KnowledgeTools-427"><span class="linenos">427</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-428"><a href="#KnowledgeTools-428"><span class="linenos">428</span></a>
</span><span id="KnowledgeTools-429"><a href="#KnowledgeTools-429"><span class="linenos">429</span></a>            <span class="c1"># Validate directory exists</span>
</span><span id="KnowledgeTools-430"><a href="#KnowledgeTools-430"><span class="linenos">430</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="KnowledgeTools-431"><a href="#KnowledgeTools-431"><span class="linenos">431</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Directory not found at &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeTools-432"><a href="#KnowledgeTools-432"><span class="linenos">432</span></a>
</span><span id="KnowledgeTools-433"><a href="#KnowledgeTools-433"><span class="linenos">433</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="KnowledgeTools-434"><a href="#KnowledgeTools-434"><span class="linenos">434</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39; is not a directory&quot;</span>
</span><span id="KnowledgeTools-435"><a href="#KnowledgeTools-435"><span class="linenos">435</span></a>
</span><span id="KnowledgeTools-436"><a href="#KnowledgeTools-436"><span class="linenos">436</span></a>            <span class="c1"># Find files matching pattern</span>
</span><span id="KnowledgeTools-437"><a href="#KnowledgeTools-437"><span class="linenos">437</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeTools-438"><a href="#KnowledgeTools-438"><span class="linenos">438</span></a>            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="KnowledgeTools-439"><a href="#KnowledgeTools-439"><span class="linenos">439</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="KnowledgeTools-440"><a href="#KnowledgeTools-440"><span class="linenos">440</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-441"><a href="#KnowledgeTools-441"><span class="linenos">441</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="KnowledgeTools-442"><a href="#KnowledgeTools-442"><span class="linenos">442</span></a>
</span><span id="KnowledgeTools-443"><a href="#KnowledgeTools-443"><span class="linenos">443</span></a>            <span class="c1"># Filter to only include files (not directories)</span>
</span><span id="KnowledgeTools-444"><a href="#KnowledgeTools-444"><span class="linenos">444</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
</span><span id="KnowledgeTools-445"><a href="#KnowledgeTools-445"><span class="linenos">445</span></a>
</span><span id="KnowledgeTools-446"><a href="#KnowledgeTools-446"><span class="linenos">446</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
</span><span id="KnowledgeTools-447"><a href="#KnowledgeTools-447"><span class="linenos">447</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No files found matching pattern &#39;</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeTools-448"><a href="#KnowledgeTools-448"><span class="linenos">448</span></a>
</span><span id="KnowledgeTools-449"><a href="#KnowledgeTools-449"><span class="linenos">449</span></a>            <span class="c1"># Limit batch size to prevent overwhelming the system</span>
</span><span id="KnowledgeTools-450"><a href="#KnowledgeTools-450"><span class="linenos">450</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="KnowledgeTools-451"><a href="#KnowledgeTools-451"><span class="linenos">451</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Too many files (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">). Please process in smaller batches (max 50 files).&quot;</span>
</span><span id="KnowledgeTools-452"><a href="#KnowledgeTools-452"><span class="linenos">452</span></a>
</span><span id="KnowledgeTools-453"><a href="#KnowledgeTools-453"><span class="linenos">453</span></a>            <span class="c1"># Process files</span>
</span><span id="KnowledgeTools-454"><a href="#KnowledgeTools-454"><span class="linenos">454</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="KnowledgeTools-455"><a href="#KnowledgeTools-455"><span class="linenos">455</span></a>
</span><span id="KnowledgeTools-456"><a href="#KnowledgeTools-456"><span class="linenos">456</span></a>            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="KnowledgeTools-457"><a href="#KnowledgeTools-457"><span class="linenos">457</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-458"><a href="#KnowledgeTools-458"><span class="linenos">458</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="KnowledgeTools-459"><a href="#KnowledgeTools-459"><span class="linenos">459</span></a>                    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="KnowledgeTools-460"><a href="#KnowledgeTools-460"><span class="linenos">460</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeTools-461"><a href="#KnowledgeTools-461"><span class="linenos">461</span></a>                        <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-462"><a href="#KnowledgeTools-462"><span class="linenos">462</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-463"><a href="#KnowledgeTools-463"><span class="linenos">463</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeTools-464"><a href="#KnowledgeTools-464"><span class="linenos">464</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-465"><a href="#KnowledgeTools-465"><span class="linenos">465</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to ingest </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-466"><a href="#KnowledgeTools-466"><span class="linenos">466</span></a>
</span><span id="KnowledgeTools-467"><a href="#KnowledgeTools-467"><span class="linenos">467</span></a>                    <span class="c1"># Small delay to avoid overwhelming the server</span>
</span><span id="KnowledgeTools-468"><a href="#KnowledgeTools-468"><span class="linenos">468</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="KnowledgeTools-469"><a href="#KnowledgeTools-469"><span class="linenos">469</span></a>
</span><span id="KnowledgeTools-470"><a href="#KnowledgeTools-470"><span class="linenos">470</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-471"><a href="#KnowledgeTools-471"><span class="linenos">471</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeTools-472"><a href="#KnowledgeTools-472"><span class="linenos">472</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-473"><a href="#KnowledgeTools-473"><span class="linenos">473</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="KnowledgeTools-474"><a href="#KnowledgeTools-474"><span class="linenos">474</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-475"><a href="#KnowledgeTools-475"><span class="linenos">475</span></a>
</span><span id="KnowledgeTools-476"><a href="#KnowledgeTools-476"><span class="linenos">476</span></a>            <span class="c1"># Format results</span>
</span><span id="KnowledgeTools-477"><a href="#KnowledgeTools-477"><span class="linenos">477</span></a>            <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Batch ingestion complete: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> successful, </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> failed&quot;</span>
</span><span id="KnowledgeTools-478"><a href="#KnowledgeTools-478"><span class="linenos">478</span></a>
</span><span id="KnowledgeTools-479"><a href="#KnowledgeTools-479"><span class="linenos">479</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]:</span>
</span><span id="KnowledgeTools-480"><a href="#KnowledgeTools-480"><span class="linenos">480</span></a>                <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Errors:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeTools-481"><a href="#KnowledgeTools-481"><span class="linenos">481</span></a>                    <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</span><span id="KnowledgeTools-482"><a href="#KnowledgeTools-482"><span class="linenos">482</span></a>                <span class="p">)</span>
</span><span id="KnowledgeTools-483"><a href="#KnowledgeTools-483"><span class="linenos">483</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="KnowledgeTools-484"><a href="#KnowledgeTools-484"><span class="linenos">484</span></a>                    <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more errors&quot;</span>
</span><span id="KnowledgeTools-485"><a href="#KnowledgeTools-485"><span class="linenos">485</span></a>
</span><span id="KnowledgeTools-486"><a href="#KnowledgeTools-486"><span class="linenos">486</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeTools-487"><a href="#KnowledgeTools-487"><span class="linenos">487</span></a>                <span class="sa">f</span><span class="s2">&quot;Batch ingestion completed: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files successful&quot;</span>
</span><span id="KnowledgeTools-488"><a href="#KnowledgeTools-488"><span class="linenos">488</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools-489"><a href="#KnowledgeTools-489"><span class="linenos">489</span></a>            <span class="k">return</span> <span class="n">summary</span>
</span><span id="KnowledgeTools-490"><a href="#KnowledgeTools-490"><span class="linenos">490</span></a>
</span><span id="KnowledgeTools-491"><a href="#KnowledgeTools-491"><span class="linenos">491</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-492"><a href="#KnowledgeTools-492"><span class="linenos">492</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in batch ingestion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-493"><a href="#KnowledgeTools-493"><span class="linenos">493</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error in batch ingestion: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-494"><a href="#KnowledgeTools-494"><span class="linenos">494</span></a>
</span><span id="KnowledgeTools-495"><a href="#KnowledgeTools-495"><span class="linenos">495</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_knowledge_base</span><span class="p">(</span>
</span><span id="KnowledgeTools-496"><a href="#KnowledgeTools-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="KnowledgeTools-497"><a href="#KnowledgeTools-497"><span class="linenos">497</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools-498"><a href="#KnowledgeTools-498"><span class="linenos">498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the unified knowledge base to retrieve stored factual information and documents.</span>
</span><span id="KnowledgeTools-499"><a href="#KnowledgeTools-499"><span class="linenos">499</span></a>
</span><span id="KnowledgeTools-500"><a href="#KnowledgeTools-500"><span class="linenos">500</span></a><span class="sd">        This tool is for SEARCHING existing knowledge, NOT for creative tasks like writing stories,</span>
</span><span id="KnowledgeTools-501"><a href="#KnowledgeTools-501"><span class="linenos">501</span></a><span class="sd">        generating content, or answering general questions. Use this only when you need to find</span>
</span><span id="KnowledgeTools-502"><a href="#KnowledgeTools-502"><span class="linenos">502</span></a><span class="sd">        specific information that was previously stored in the knowledge base.</span>
</span><span id="KnowledgeTools-503"><a href="#KnowledgeTools-503"><span class="linenos">503</span></a>
</span><span id="KnowledgeTools-504"><a href="#KnowledgeTools-504"><span class="linenos">504</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools-505"><a href="#KnowledgeTools-505"><span class="linenos">505</span></a><span class="sd">            query: The search query for finding existing knowledge/documents</span>
</span><span id="KnowledgeTools-506"><a href="#KnowledgeTools-506"><span class="linenos">506</span></a><span class="sd">            mode: Query mode - &quot;local&quot; (semantic), &quot;global&quot; (graph), &quot;hybrid&quot;, &quot;mix&quot;, &quot;auto&quot;</span>
</span><span id="KnowledgeTools-507"><a href="#KnowledgeTools-507"><span class="linenos">507</span></a><span class="sd">            limit: Maximum number of results to return (defaults to 5 if None)</span>
</span><span id="KnowledgeTools-508"><a href="#KnowledgeTools-508"><span class="linenos">508</span></a>
</span><span id="KnowledgeTools-509"><a href="#KnowledgeTools-509"><span class="linenos">509</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools-510"><a href="#KnowledgeTools-510"><span class="linenos">510</span></a><span class="sd">            Search results from the knowledge base, or rejection message for inappropriate requests.</span>
</span><span id="KnowledgeTools-511"><a href="#KnowledgeTools-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools-512"><a href="#KnowledgeTools-512"><span class="linenos">512</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-513"><a href="#KnowledgeTools-513"><span class="linenos">513</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools-514"><a href="#KnowledgeTools-514"><span class="linenos">514</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Query cannot be empty&quot;</span>
</span><span id="KnowledgeTools-515"><a href="#KnowledgeTools-515"><span class="linenos">515</span></a>
</span><span id="KnowledgeTools-516"><a href="#KnowledgeTools-516"><span class="linenos">516</span></a>            <span class="c1"># Filter out inappropriate creative requests</span>
</span><span id="KnowledgeTools-517"><a href="#KnowledgeTools-517"><span class="linenos">517</span></a>            <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeTools-518"><a href="#KnowledgeTools-518"><span class="linenos">518</span></a>
</span><span id="KnowledgeTools-519"><a href="#KnowledgeTools-519"><span class="linenos">519</span></a>            <span class="c1"># Creative/generative request patterns that should NOT use knowledge search</span>
</span><span id="KnowledgeTools-520"><a href="#KnowledgeTools-520"><span class="linenos">520</span></a>            <span class="n">creative_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeTools-521"><a href="#KnowledgeTools-521"><span class="linenos">521</span></a>                <span class="s2">&quot;write&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-522"><a href="#KnowledgeTools-522"><span class="linenos">522</span></a>                <span class="s2">&quot;create&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-523"><a href="#KnowledgeTools-523"><span class="linenos">523</span></a>                <span class="s2">&quot;generate&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-524"><a href="#KnowledgeTools-524"><span class="linenos">524</span></a>                <span class="s2">&quot;make&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-525"><a href="#KnowledgeTools-525"><span class="linenos">525</span></a>                <span class="s2">&quot;compose&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-526"><a href="#KnowledgeTools-526"><span class="linenos">526</span></a>                <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-527"><a href="#KnowledgeTools-527"><span class="linenos">527</span></a>                <span class="s2">&quot;tell me a&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-528"><a href="#KnowledgeTools-528"><span class="linenos">528</span></a>                <span class="s2">&quot;give me a&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-529"><a href="#KnowledgeTools-529"><span class="linenos">529</span></a>                <span class="s2">&quot;come up with&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-530"><a href="#KnowledgeTools-530"><span class="linenos">530</span></a>                <span class="s2">&quot;think of&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-531"><a href="#KnowledgeTools-531"><span class="linenos">531</span></a>                <span class="s2">&quot;story&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-532"><a href="#KnowledgeTools-532"><span class="linenos">532</span></a>                <span class="s2">&quot;poem&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-533"><a href="#KnowledgeTools-533"><span class="linenos">533</span></a>                <span class="s2">&quot;joke&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-534"><a href="#KnowledgeTools-534"><span class="linenos">534</span></a>                <span class="s2">&quot;song&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-535"><a href="#KnowledgeTools-535"><span class="linenos">535</span></a>                <span class="s2">&quot;essay&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-536"><a href="#KnowledgeTools-536"><span class="linenos">536</span></a>                <span class="s2">&quot;article&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-537"><a href="#KnowledgeTools-537"><span class="linenos">537</span></a>                <span class="s2">&quot;funny&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-538"><a href="#KnowledgeTools-538"><span class="linenos">538</span></a>                <span class="s2">&quot;creative&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-539"><a href="#KnowledgeTools-539"><span class="linenos">539</span></a>                <span class="s2">&quot;imagine&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-540"><a href="#KnowledgeTools-540"><span class="linenos">540</span></a>                <span class="s2">&quot;pretend&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-541"><a href="#KnowledgeTools-541"><span class="linenos">541</span></a>            <span class="p">]</span>
</span><span id="KnowledgeTools-542"><a href="#KnowledgeTools-542"><span class="linenos">542</span></a>
</span><span id="KnowledgeTools-543"><a href="#KnowledgeTools-543"><span class="linenos">543</span></a>            <span class="c1"># Check if this looks like a creative request</span>
</span><span id="KnowledgeTools-544"><a href="#KnowledgeTools-544"><span class="linenos">544</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">creative_patterns</span><span class="p">):</span>
</span><span id="KnowledgeTools-545"><a href="#KnowledgeTools-545"><span class="linenos">545</span></a>                <span class="c1"># Additional check: if it&#39;s asking for factual info WITH creative words, allow it</span>
</span><span id="KnowledgeTools-546"><a href="#KnowledgeTools-546"><span class="linenos">546</span></a>                <span class="n">factual_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeTools-547"><a href="#KnowledgeTools-547"><span class="linenos">547</span></a>                    <span class="s2">&quot;what is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-548"><a href="#KnowledgeTools-548"><span class="linenos">548</span></a>                    <span class="s2">&quot;who is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-549"><a href="#KnowledgeTools-549"><span class="linenos">549</span></a>                    <span class="s2">&quot;when did&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-550"><a href="#KnowledgeTools-550"><span class="linenos">550</span></a>                    <span class="s2">&quot;where is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-551"><a href="#KnowledgeTools-551"><span class="linenos">551</span></a>                    <span class="s2">&quot;how does&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-552"><a href="#KnowledgeTools-552"><span class="linenos">552</span></a>                    <span class="s2">&quot;definition of&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-553"><a href="#KnowledgeTools-553"><span class="linenos">553</span></a>                    <span class="s2">&quot;information about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-554"><a href="#KnowledgeTools-554"><span class="linenos">554</span></a>                    <span class="s2">&quot;facts about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-555"><a href="#KnowledgeTools-555"><span class="linenos">555</span></a>                    <span class="s2">&quot;details about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-556"><a href="#KnowledgeTools-556"><span class="linenos">556</span></a>                    <span class="s2">&quot;explain&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-557"><a href="#KnowledgeTools-557"><span class="linenos">557</span></a>                    <span class="s2">&quot;describe&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools-558"><a href="#KnowledgeTools-558"><span class="linenos">558</span></a>                <span class="p">]</span>
</span><span id="KnowledgeTools-559"><a href="#KnowledgeTools-559"><span class="linenos">559</span></a>
</span><span id="KnowledgeTools-560"><a href="#KnowledgeTools-560"><span class="linenos">560</span></a>                <span class="c1"># If it has factual patterns, it might be legitimate</span>
</span><span id="KnowledgeTools-561"><a href="#KnowledgeTools-561"><span class="linenos">561</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">factual</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">factual</span> <span class="ow">in</span> <span class="n">factual_patterns</span><span class="p">):</span>
</span><span id="KnowledgeTools-562"><a href="#KnowledgeTools-562"><span class="linenos">562</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeTools-563"><a href="#KnowledgeTools-563"><span class="linenos">563</span></a>                        <span class="sa">f</span><span class="s2">&quot;Rejected creative request for knowledge search: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="KnowledgeTools-564"><a href="#KnowledgeTools-564"><span class="linenos">564</span></a>                    <span class="p">)</span>
</span><span id="KnowledgeTools-565"><a href="#KnowledgeTools-565"><span class="linenos">565</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; This appears to be a creative request (&#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;). The knowledge base is for searching existing stored information, not for generating new content. Please rephrase as a search for existing knowledge, or ask me to create content directly without using knowledge tools.&quot;</span>
</span><span id="KnowledgeTools-566"><a href="#KnowledgeTools-566"><span class="linenos">566</span></a>
</span><span id="KnowledgeTools-567"><a href="#KnowledgeTools-567"><span class="linenos">567</span></a>            <span class="c1"># Validate mode</span>
</span><span id="KnowledgeTools-568"><a href="#KnowledgeTools-568"><span class="linenos">568</span></a>            <span class="n">valid_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="s2">&quot;hybrid&quot;</span><span class="p">,</span> <span class="s2">&quot;naive&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools-569"><a href="#KnowledgeTools-569"><span class="linenos">569</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modes</span><span class="p">:</span>
</span><span id="KnowledgeTools-570"><a href="#KnowledgeTools-570"><span class="linenos">570</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
</span><span id="KnowledgeTools-571"><a href="#KnowledgeTools-571"><span class="linenos">571</span></a>
</span><span id="KnowledgeTools-572"><a href="#KnowledgeTools-572"><span class="linenos">572</span></a>            <span class="c1"># Handle None limit</span>
</span><span id="KnowledgeTools-573"><a href="#KnowledgeTools-573"><span class="linenos">573</span></a>            <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KnowledgeTools-574"><a href="#KnowledgeTools-574"><span class="linenos">574</span></a>                <span class="n">limit</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="KnowledgeTools-575"><a href="#KnowledgeTools-575"><span class="linenos">575</span></a>
</span><span id="KnowledgeTools-576"><a href="#KnowledgeTools-576"><span class="linenos">576</span></a>            <span class="c1"># Initialize knowledge coordinator if not already done</span>
</span><span id="KnowledgeTools-577"><a href="#KnowledgeTools-577"><span class="linenos">577</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KnowledgeTools-578"><a href="#KnowledgeTools-578"><span class="linenos">578</span></a>                <span class="c1"># Use the agno_knowledge passed to the constructor</span>
</span><span id="KnowledgeTools-579"><a href="#KnowledgeTools-579"><span class="linenos">579</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="n">create_knowledge_coordinator</span><span class="p">(</span>
</span><span id="KnowledgeTools-580"><a href="#KnowledgeTools-580"><span class="linenos">580</span></a>                    <span class="n">agno_knowledge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">,</span>
</span><span id="KnowledgeTools-581"><a href="#KnowledgeTools-581"><span class="linenos">581</span></a>                    <span class="n">lightrag_url</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="KnowledgeTools-582"><a href="#KnowledgeTools-582"><span class="linenos">582</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
</span><span id="KnowledgeTools-583"><a href="#KnowledgeTools-583"><span class="linenos">583</span></a>                <span class="p">)</span>
</span><span id="KnowledgeTools-584"><a href="#KnowledgeTools-584"><span class="linenos">584</span></a>
</span><span id="KnowledgeTools-585"><a href="#KnowledgeTools-585"><span class="linenos">585</span></a>            <span class="c1"># Use the knowledge coordinator for unified querying - now properly async</span>
</span><span id="KnowledgeTools-586"><a href="#KnowledgeTools-586"><span class="linenos">586</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span><span class="o">.</span><span class="n">query_knowledge_base</span><span class="p">(</span>
</span><span id="KnowledgeTools-587"><a href="#KnowledgeTools-587"><span class="linenos">587</span></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="KnowledgeTools-588"><a href="#KnowledgeTools-588"><span class="linenos">588</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="KnowledgeTools-589"><a href="#KnowledgeTools-589"><span class="linenos">589</span></a>                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span id="KnowledgeTools-590"><a href="#KnowledgeTools-590"><span class="linenos">590</span></a>                <span class="n">response_type</span><span class="o">=</span><span class="s2">&quot;Multiple Paragraphs&quot;</span>
</span><span id="KnowledgeTools-591"><a href="#KnowledgeTools-591"><span class="linenos">591</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools-592"><a href="#KnowledgeTools-592"><span class="linenos">592</span></a>            
</span><span id="KnowledgeTools-593"><a href="#KnowledgeTools-593"><span class="linenos">593</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Knowledge query completed: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-594"><a href="#KnowledgeTools-594"><span class="linenos">594</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="KnowledgeTools-595"><a href="#KnowledgeTools-595"><span class="linenos">595</span></a>
</span><span id="KnowledgeTools-596"><a href="#KnowledgeTools-596"><span class="linenos">596</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-597"><a href="#KnowledgeTools-597"><span class="linenos">597</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-598"><a href="#KnowledgeTools-598"><span class="linenos">598</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-599"><a href="#KnowledgeTools-599"><span class="linenos">599</span></a>
</span><span id="KnowledgeTools-600"><a href="#KnowledgeTools-600"><span class="linenos">600</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_lightrag_knowledge_direct</span><span class="p">(</span>
</span><span id="KnowledgeTools-601"><a href="#KnowledgeTools-601"><span class="linenos">601</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KnowledgeTools-602"><a href="#KnowledgeTools-602"><span class="linenos">602</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="KnowledgeTools-603"><a href="#KnowledgeTools-603"><span class="linenos">603</span></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KnowledgeTools-604"><a href="#KnowledgeTools-604"><span class="linenos">604</span></a>        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="KnowledgeTools-605"><a href="#KnowledgeTools-605"><span class="linenos">605</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools-606"><a href="#KnowledgeTools-606"><span class="linenos">606</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Directly query the LightRAG knowledge base and return the raw response.</span>
</span><span id="KnowledgeTools-607"><a href="#KnowledgeTools-607"><span class="linenos">607</span></a>
</span><span id="KnowledgeTools-608"><a href="#KnowledgeTools-608"><span class="linenos">608</span></a><span class="sd">        This method provides direct, unfiltered access to the LightRAG knowledge base,</span>
</span><span id="KnowledgeTools-609"><a href="#KnowledgeTools-609"><span class="linenos">609</span></a><span class="sd">        bypassing the intelligent filtering and processing of query_knowledge_base().</span>
</span><span id="KnowledgeTools-610"><a href="#KnowledgeTools-610"><span class="linenos">610</span></a><span class="sd">        Use this when you need raw access to the knowledge base with custom parameters.</span>
</span><span id="KnowledgeTools-611"><a href="#KnowledgeTools-611"><span class="linenos">611</span></a>
</span><span id="KnowledgeTools-612"><a href="#KnowledgeTools-612"><span class="linenos">612</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools-613"><a href="#KnowledgeTools-613"><span class="linenos">613</span></a><span class="sd">            query: The query string to search in the knowledge base</span>
</span><span id="KnowledgeTools-614"><a href="#KnowledgeTools-614"><span class="linenos">614</span></a><span class="sd">            params: A dictionary of query parameters (mode, response_type, top_k, etc.)</span>
</span><span id="KnowledgeTools-615"><a href="#KnowledgeTools-615"><span class="linenos">615</span></a><span class="sd">            url: LightRAG server URL (defaults to settings.LIGHTRAG_URL)</span>
</span><span id="KnowledgeTools-616"><a href="#KnowledgeTools-616"><span class="linenos">616</span></a>
</span><span id="KnowledgeTools-617"><a href="#KnowledgeTools-617"><span class="linenos">617</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools-618"><a href="#KnowledgeTools-618"><span class="linenos">618</span></a><span class="sd">            String with query results exactly as LightRAG returns them</span>
</span><span id="KnowledgeTools-619"><a href="#KnowledgeTools-619"><span class="linenos">619</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools-620"><a href="#KnowledgeTools-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools-621"><a href="#KnowledgeTools-621"><span class="linenos">621</span></a>            <span class="k">return</span> <span class="s2">&quot; Error: Query cannot be empty&quot;</span>
</span><span id="KnowledgeTools-622"><a href="#KnowledgeTools-622"><span class="linenos">622</span></a>
</span><span id="KnowledgeTools-623"><a href="#KnowledgeTools-623"><span class="linenos">623</span></a>        <span class="c1"># Use default parameters if none provided</span>
</span><span id="KnowledgeTools-624"><a href="#KnowledgeTools-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KnowledgeTools-625"><a href="#KnowledgeTools-625"><span class="linenos">625</span></a>            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="KnowledgeTools-626"><a href="#KnowledgeTools-626"><span class="linenos">626</span></a>
</span><span id="KnowledgeTools-627"><a href="#KnowledgeTools-627"><span class="linenos">627</span></a>        <span class="c1"># Set up the query parameters with defaults</span>
</span><span id="KnowledgeTools-628"><a href="#KnowledgeTools-628"><span class="linenos">628</span></a>        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KnowledgeTools-629"><a href="#KnowledgeTools-629"><span class="linenos">629</span></a>            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="KnowledgeTools-630"><a href="#KnowledgeTools-630"><span class="linenos">630</span></a>            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">),</span>
</span><span id="KnowledgeTools-631"><a href="#KnowledgeTools-631"><span class="linenos">631</span></a>            <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;response_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">),</span>
</span><span id="KnowledgeTools-632"><a href="#KnowledgeTools-632"><span class="linenos">632</span></a>            <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top_k&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="KnowledgeTools-633"><a href="#KnowledgeTools-633"><span class="linenos">633</span></a>            <span class="s2">&quot;only_need_context&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;only_need_context&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="KnowledgeTools-634"><a href="#KnowledgeTools-634"><span class="linenos">634</span></a>            <span class="s2">&quot;only_need_prompt&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;only_need_prompt&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="KnowledgeTools-635"><a href="#KnowledgeTools-635"><span class="linenos">635</span></a>            <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stream&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="KnowledgeTools-636"><a href="#KnowledgeTools-636"><span class="linenos">636</span></a>        <span class="p">}</span>
</span><span id="KnowledgeTools-637"><a href="#KnowledgeTools-637"><span class="linenos">637</span></a>
</span><span id="KnowledgeTools-638"><a href="#KnowledgeTools-638"><span class="linenos">638</span></a>        <span class="c1"># Add optional parameters if provided</span>
</span><span id="KnowledgeTools-639"><a href="#KnowledgeTools-639"><span class="linenos">639</span></a>        <span class="k">if</span> <span class="s2">&quot;max_token_for_text_unit&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools-640"><a href="#KnowledgeTools-640"><span class="linenos">640</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;max_token_for_text_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_token_for_text_unit&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools-641"><a href="#KnowledgeTools-641"><span class="linenos">641</span></a>        <span class="k">if</span> <span class="s2">&quot;max_token_for_global_context&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools-642"><a href="#KnowledgeTools-642"><span class="linenos">642</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;max_token_for_global_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span>
</span><span id="KnowledgeTools-643"><a href="#KnowledgeTools-643"><span class="linenos">643</span></a>                <span class="s2">&quot;max_token_for_global_context&quot;</span>
</span><span id="KnowledgeTools-644"><a href="#KnowledgeTools-644"><span class="linenos">644</span></a>            <span class="p">]</span>
</span><span id="KnowledgeTools-645"><a href="#KnowledgeTools-645"><span class="linenos">645</span></a>        <span class="k">if</span> <span class="s2">&quot;max_token_for_local_context&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools-646"><a href="#KnowledgeTools-646"><span class="linenos">646</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;max_token_for_local_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span>
</span><span id="KnowledgeTools-647"><a href="#KnowledgeTools-647"><span class="linenos">647</span></a>                <span class="s2">&quot;max_token_for_local_context&quot;</span>
</span><span id="KnowledgeTools-648"><a href="#KnowledgeTools-648"><span class="linenos">648</span></a>            <span class="p">]</span>
</span><span id="KnowledgeTools-649"><a href="#KnowledgeTools-649"><span class="linenos">649</span></a>        <span class="k">if</span> <span class="s2">&quot;conversation_history&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools-650"><a href="#KnowledgeTools-650"><span class="linenos">650</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;conversation_history&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;conversation_history&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools-651"><a href="#KnowledgeTools-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="s2">&quot;history_turns&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools-652"><a href="#KnowledgeTools-652"><span class="linenos">652</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;history_turns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;history_turns&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools-653"><a href="#KnowledgeTools-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="s2">&quot;ids&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools-654"><a href="#KnowledgeTools-654"><span class="linenos">654</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools-655"><a href="#KnowledgeTools-655"><span class="linenos">655</span></a>
</span><span id="KnowledgeTools-656"><a href="#KnowledgeTools-656"><span class="linenos">656</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-657"><a href="#KnowledgeTools-657"><span class="linenos">657</span></a>            <span class="c1"># Use the correct LightRAG URL and endpoint for RAG queries</span>
</span><span id="KnowledgeTools-658"><a href="#KnowledgeTools-658"><span class="linenos">658</span></a>            <span class="n">final_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/query&quot;</span>
</span><span id="KnowledgeTools-659"><a href="#KnowledgeTools-659"><span class="linenos">659</span></a>
</span><span id="KnowledgeTools-660"><a href="#KnowledgeTools-660"><span class="linenos">660</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="KnowledgeTools-661"><a href="#KnowledgeTools-661"><span class="linenos">661</span></a>                <span class="sa">f</span><span class="s2">&quot;Querying KnowledgeBase at </span><span class="si">{</span><span class="n">final_url</span><span class="si">}</span><span class="s2"> with params: </span><span class="si">{</span><span class="n">query_params</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-662"><a href="#KnowledgeTools-662"><span class="linenos">662</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools-663"><a href="#KnowledgeTools-663"><span class="linenos">663</span></a>
</span><span id="KnowledgeTools-664"><a href="#KnowledgeTools-664"><span class="linenos">664</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="KnowledgeTools-665"><a href="#KnowledgeTools-665"><span class="linenos">665</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="KnowledgeTools-666"><a href="#KnowledgeTools-666"><span class="linenos">666</span></a>                    <span class="n">final_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="KnowledgeTools-667"><a href="#KnowledgeTools-667"><span class="linenos">667</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="KnowledgeTools-668"><a href="#KnowledgeTools-668"><span class="linenos">668</span></a>                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="KnowledgeTools-669"><a href="#KnowledgeTools-669"><span class="linenos">669</span></a>                        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="KnowledgeTools-670"><a href="#KnowledgeTools-670"><span class="linenos">670</span></a>
</span><span id="KnowledgeTools-671"><a href="#KnowledgeTools-671"><span class="linenos">671</span></a>                        <span class="c1"># Extract the response content</span>
</span><span id="KnowledgeTools-672"><a href="#KnowledgeTools-672"><span class="linenos">672</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="KnowledgeTools-673"><a href="#KnowledgeTools-673"><span class="linenos">673</span></a>                            <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="KnowledgeTools-674"><a href="#KnowledgeTools-674"><span class="linenos">674</span></a>                                <span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</span><span id="KnowledgeTools-675"><a href="#KnowledgeTools-675"><span class="linenos">675</span></a>                            <span class="p">)</span>
</span><span id="KnowledgeTools-676"><a href="#KnowledgeTools-676"><span class="linenos">676</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-677"><a href="#KnowledgeTools-677"><span class="linenos">677</span></a>                            <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="KnowledgeTools-678"><a href="#KnowledgeTools-678"><span class="linenos">678</span></a>
</span><span id="KnowledgeTools-679"><a href="#KnowledgeTools-679"><span class="linenos">679</span></a>                        <span class="k">if</span> <span class="n">content</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools-680"><a href="#KnowledgeTools-680"><span class="linenos">680</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KB direct query successful: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-681"><a href="#KnowledgeTools-681"><span class="linenos">681</span></a>                            <span class="k">return</span> <span class="n">content</span>
</span><span id="KnowledgeTools-682"><a href="#KnowledgeTools-682"><span class="linenos">682</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-683"><a href="#KnowledgeTools-683"><span class="linenos">683</span></a>                            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No relevant knowledge found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. Try different keywords or add more knowledge to your base.&quot;</span>
</span><span id="KnowledgeTools-684"><a href="#KnowledgeTools-684"><span class="linenos">684</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-685"><a href="#KnowledgeTools-685"><span class="linenos">685</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="KnowledgeTools-686"><a href="#KnowledgeTools-686"><span class="linenos">686</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="KnowledgeTools-687"><a href="#KnowledgeTools-687"><span class="linenos">687</span></a>                            <span class="sa">f</span><span class="s2">&quot;KnowledgeBase direct query failed with status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-688"><a href="#KnowledgeTools-688"><span class="linenos">688</span></a>                        <span class="p">)</span>
</span><span id="KnowledgeTools-689"><a href="#KnowledgeTools-689"><span class="linenos">689</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base (status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-690"><a href="#KnowledgeTools-690"><span class="linenos">690</span></a>
</span><span id="KnowledgeTools-691"><a href="#KnowledgeTools-691"><span class="linenos">691</span></a>        <span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-692"><a href="#KnowledgeTools-692"><span class="linenos">692</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error connecting to KnowledgeBase server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-693"><a href="#KnowledgeTools-693"><span class="linenos">693</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error connecting to knowledge base server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-694"><a href="#KnowledgeTools-694"><span class="linenos">694</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-695"><a href="#KnowledgeTools-695"><span class="linenos">695</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying KnowledgeBase knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-696"><a href="#KnowledgeTools-696"><span class="linenos">696</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-697"><a href="#KnowledgeTools-697"><span class="linenos">697</span></a>
</span><span id="KnowledgeTools-698"><a href="#KnowledgeTools-698"><span class="linenos">698</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeTools-699"><a href="#KnowledgeTools-699"><span class="linenos">699</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeTools-700"><a href="#KnowledgeTools-700"><span class="linenos">700</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools-701"><a href="#KnowledgeTools-701"><span class="linenos">701</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload a file to the LightRAG server.</span>
</span><span id="KnowledgeTools-702"><a href="#KnowledgeTools-702"><span class="linenos">702</span></a>
</span><span id="KnowledgeTools-703"><a href="#KnowledgeTools-703"><span class="linenos">703</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools-704"><a href="#KnowledgeTools-704"><span class="linenos">704</span></a><span class="sd">            file_path: Path to the file to upload</span>
</span><span id="KnowledgeTools-705"><a href="#KnowledgeTools-705"><span class="linenos">705</span></a><span class="sd">            filename: Name to use for the uploaded file</span>
</span><span id="KnowledgeTools-706"><a href="#KnowledgeTools-706"><span class="linenos">706</span></a><span class="sd">            url: LightRAG server URL to upload to</span>
</span><span id="KnowledgeTools-707"><a href="#KnowledgeTools-707"><span class="linenos">707</span></a>
</span><span id="KnowledgeTools-708"><a href="#KnowledgeTools-708"><span class="linenos">708</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools-709"><a href="#KnowledgeTools-709"><span class="linenos">709</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeTools-710"><a href="#KnowledgeTools-710"><span class="linenos">710</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools-711"><a href="#KnowledgeTools-711"><span class="linenos">711</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools-712"><a href="#KnowledgeTools-712"><span class="linenos">712</span></a>            <span class="n">final_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/documents/upload&quot;</span>
</span><span id="KnowledgeTools-713"><a href="#KnowledgeTools-713"><span class="linenos">713</span></a>
</span><span id="KnowledgeTools-714"><a href="#KnowledgeTools-714"><span class="linenos">714</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="KnowledgeTools-715"><a href="#KnowledgeTools-715"><span class="linenos">715</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">)}</span>
</span><span id="KnowledgeTools-716"><a href="#KnowledgeTools-716"><span class="linenos">716</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">final_url</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span id="KnowledgeTools-717"><a href="#KnowledgeTools-717"><span class="linenos">717</span></a>
</span><span id="KnowledgeTools-718"><a href="#KnowledgeTools-718"><span class="linenos">718</span></a>                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
</span><span id="KnowledgeTools-719"><a href="#KnowledgeTools-719"><span class="linenos">719</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="KnowledgeTools-720"><a href="#KnowledgeTools-720"><span class="linenos">720</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully uploaded to KnowledgeBase: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-721"><a href="#KnowledgeTools-721"><span class="linenos">721</span></a>                    <span class="k">return</span> <span class="s2">&quot; File uploaded and processing started&quot;</span>
</span><span id="KnowledgeTools-722"><a href="#KnowledgeTools-722"><span class="linenos">722</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools-723"><a href="#KnowledgeTools-723"><span class="linenos">723</span></a>                    <span class="n">error_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeTools-724"><a href="#KnowledgeTools-724"><span class="linenos">724</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KnowledgeBase upload failed: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-725"><a href="#KnowledgeTools-725"><span class="linenos">725</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Upload failed: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-726"><a href="#KnowledgeTools-726"><span class="linenos">726</span></a>
</span><span id="KnowledgeTools-727"><a href="#KnowledgeTools-727"><span class="linenos">727</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-728"><a href="#KnowledgeTools-728"><span class="linenos">728</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error uploading to KnowledgeBase: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-729"><a href="#KnowledgeTools-729"><span class="linenos">729</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Upload error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools-730"><a href="#KnowledgeTools-730"><span class="linenos">730</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools-731"><a href="#KnowledgeTools-731"><span class="linenos">731</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error during upload: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools-732"><a href="#KnowledgeTools-732"><span class="linenos">732</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Unexpected upload error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Knowledge Base Management Tools for Factual Information Storage and Retrieval.
Use these tools when you need to:</p>

<ul>
<li>Store factual information, documents, or reference materials for future retrieval</li>
<li>Search for previously stored knowledge, facts, or documents</li>
<li>Ingest content from files, URLs, or text into the knowledge base</li>
<li>Find information that was previously added to the knowledge base</li>
</ul>

<p>DO NOT use these tools for:</p>

<ul>
<li>Storing personal information about the user (use memory tools instead)</li>
<li>Creative requests like writing stories or poems</li>
<li>General questions that don't require stored knowledge</li>
</ul>

<p>The knowledge base is separate from memory - it's for factual information that doesn't change,
while memory is for personal information about the user that evolves over time.</p>
</div>


                            <div id="KnowledgeTools.__init__" class="classattr">
                                        <input id="KnowledgeTools.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">KnowledgeTools</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">knowledge_manager</span><span class="p">:</span> <span class="n">src</span><span class="o">.</span><span class="n">personal_agent</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">knowledge_manager</span><span class="o">.</span><span class="n">KnowledgeManager</span>,</span><span class="param">	<span class="n">agno_knowledge</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="KnowledgeTools.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeTools.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeTools.__init__-142"><a href="#KnowledgeTools.__init__-142"><span class="linenos">142</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledge_manager</span><span class="p">:</span> <span class="n">KnowledgeManager</span><span class="p">,</span> <span class="n">agno_knowledge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="KnowledgeTools.__init__-143"><a href="#KnowledgeTools.__init__-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_manager</span> <span class="o">=</span> <span class="n">knowledge_manager</span>
</span><span id="KnowledgeTools.__init__-144"><a href="#KnowledgeTools.__init__-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span> <span class="o">=</span> <span class="n">agno_knowledge</span>
</span><span id="KnowledgeTools.__init__-145"><a href="#KnowledgeTools.__init__-145"><span class="linenos">145</span></a>        
</span><span id="KnowledgeTools.__init__-146"><a href="#KnowledgeTools.__init__-146"><span class="linenos">146</span></a>        <span class="c1"># Initialize knowledge coordinator for unified querying</span>
</span><span id="KnowledgeTools.__init__-147"><a href="#KnowledgeTools.__init__-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KnowledgeTools.__init__-148"><a href="#KnowledgeTools.__init__-148"><span class="linenos">148</span></a>
</span><span id="KnowledgeTools.__init__-149"><a href="#KnowledgeTools.__init__-149"><span class="linenos">149</span></a>        <span class="c1"># Collect knowledge tool methods</span>
</span><span id="KnowledgeTools.__init__-150"><a href="#KnowledgeTools.__init__-150"><span class="linenos">150</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeTools.__init__-151"><a href="#KnowledgeTools.__init__-151"><span class="linenos">151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_file</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-152"><a href="#KnowledgeTools.__init__-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_text</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-153"><a href="#KnowledgeTools.__init__-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_from_url</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-154"><a href="#KnowledgeTools.__init__-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">batch_ingest_directory</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-155"><a href="#KnowledgeTools.__init__-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">query_knowledge_base</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-156"><a href="#KnowledgeTools.__init__-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">query_lightrag_knowledge_direct</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-157"><a href="#KnowledgeTools.__init__-157"><span class="linenos">157</span></a>        <span class="p">]</span>
</span><span id="KnowledgeTools.__init__-158"><a href="#KnowledgeTools.__init__-158"><span class="linenos">158</span></a>
</span><span id="KnowledgeTools.__init__-159"><a href="#KnowledgeTools.__init__-159"><span class="linenos">159</span></a>        <span class="c1"># Initialize the Toolkit</span>
</span><span id="KnowledgeTools.__init__-160"><a href="#KnowledgeTools.__init__-160"><span class="linenos">160</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KnowledgeTools.__init__-161"><a href="#KnowledgeTools.__init__-161"><span class="linenos">161</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;knowledge_tools&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-162"><a href="#KnowledgeTools.__init__-162"><span class="linenos">162</span></a>            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-163"><a href="#KnowledgeTools.__init__-163"><span class="linenos">163</span></a>            <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Use these tools to manage factual information and documents in the knowledge base.</span>
</span><span id="KnowledgeTools.__init__-164"><a href="#KnowledgeTools.__init__-164"><span class="linenos">164</span></a><span class="s2">            Store reference materials, facts, and documents that don&#39;t change.</span>
</span><span id="KnowledgeTools.__init__-165"><a href="#KnowledgeTools.__init__-165"><span class="linenos">165</span></a><span class="s2">            Query when you need to find previously stored factual information.</span>
</span><span id="KnowledgeTools.__init__-166"><a href="#KnowledgeTools.__init__-166"><span class="linenos">166</span></a><span class="s2">            Do NOT use for personal user information - use memory tools for that.&quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.__init__-167"><a href="#KnowledgeTools.__init__-167"><span class="linenos">167</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new Toolkit.</p>

<p>Args:
    name: A descriptive name for the toolkit
    tools: List of tools to include in the toolkit
    instructions: Instructions for the toolkit
    add_instructions: Whether to add instructions to the toolkit
    include_tools: List of tool names to include in the toolkit
    exclude_tools: List of tool names to exclude from the toolkit
    requires_confirmation_tools: List of tool names that require user confirmation
    external_execution_required_tools: List of tool names that will be executed outside of the agent loop
    cache_results (bool): Enable in-memory caching of function results.
    cache_ttl (int): Time-to-live for cached results in seconds.
    cache_dir (Optional[str]): Directory to store cache files. Defaults to system temp dir.
    auto_register (bool): Whether to automatically register all methods in the class.
    stop_after_tool_call_tools (Optional[List[str]]): List of function names that should stop the agent after execution.
    show_result_tools (Optional[List[str]]): List of function names whose results should be shown.</p>
</div>


                            </div>
                            <div id="KnowledgeTools.knowledge_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">knowledge_manager</span>

        
    </div>
    <a class="headerlink" href="#KnowledgeTools.knowledge_manager"></a>
    
    

                            </div>
                            <div id="KnowledgeTools.agno_knowledge" class="classattr">
                                <div class="attr variable">
            <span class="name">agno_knowledge</span>

        
    </div>
    <a class="headerlink" href="#KnowledgeTools.agno_knowledge"></a>
    
    

                            </div>
                            <div id="KnowledgeTools.knowledge_coordinator" class="classattr">
                                <div class="attr variable">
            <span class="name">knowledge_coordinator</span>

        
    </div>
    <a class="headerlink" href="#KnowledgeTools.knowledge_coordinator"></a>
    
    

                            </div>
                            <div id="KnowledgeTools.ingest_knowledge_file" class="classattr">
                                        <input id="KnowledgeTools.ingest_knowledge_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_knowledge_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeTools.ingest_knowledge_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeTools.ingest_knowledge_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeTools.ingest_knowledge_file-169"><a href="#KnowledgeTools.ingest_knowledge_file-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-170"><a href="#KnowledgeTools.ingest_knowledge_file-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest a file into the knowledge base.</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-171"><a href="#KnowledgeTools.ingest_knowledge_file-171"><span class="linenos">171</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-172"><a href="#KnowledgeTools.ingest_knowledge_file-172"><span class="linenos">172</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-173"><a href="#KnowledgeTools.ingest_knowledge_file-173"><span class="linenos">173</span></a><span class="sd">            file_path: Path to the file to ingest</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-174"><a href="#KnowledgeTools.ingest_knowledge_file-174"><span class="linenos">174</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to filename)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-175"><a href="#KnowledgeTools.ingest_knowledge_file-175"><span class="linenos">175</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-176"><a href="#KnowledgeTools.ingest_knowledge_file-176"><span class="linenos">176</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-177"><a href="#KnowledgeTools.ingest_knowledge_file-177"><span class="linenos">177</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-178"><a href="#KnowledgeTools.ingest_knowledge_file-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-179"><a href="#KnowledgeTools.ingest_knowledge_file-179"><span class="linenos">179</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-180"><a href="#KnowledgeTools.ingest_knowledge_file-180"><span class="linenos">180</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-181"><a href="#KnowledgeTools.ingest_knowledge_file-181"><span class="linenos">181</span></a>            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-182"><a href="#KnowledgeTools.ingest_knowledge_file-182"><span class="linenos">182</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-183"><a href="#KnowledgeTools.ingest_knowledge_file-183"><span class="linenos">183</span></a>            <span class="k">elif</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-184"><a href="#KnowledgeTools.ingest_knowledge_file-184"><span class="linenos">184</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-185"><a href="#KnowledgeTools.ingest_knowledge_file-185"><span class="linenos">185</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-186"><a href="#KnowledgeTools.ingest_knowledge_file-186"><span class="linenos">186</span></a>            <span class="c1"># Validate file exists</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-187"><a href="#KnowledgeTools.ingest_knowledge_file-187"><span class="linenos">187</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-188"><a href="#KnowledgeTools.ingest_knowledge_file-188"><span class="linenos">188</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File not found at &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-189"><a href="#KnowledgeTools.ingest_knowledge_file-189"><span class="linenos">189</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-190"><a href="#KnowledgeTools.ingest_knowledge_file-190"><span class="linenos">190</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-191"><a href="#KnowledgeTools.ingest_knowledge_file-191"><span class="linenos">191</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; is not a file&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-192"><a href="#KnowledgeTools.ingest_knowledge_file-192"><span class="linenos">192</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-193"><a href="#KnowledgeTools.ingest_knowledge_file-193"><span class="linenos">193</span></a>            <span class="c1"># Get file info</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-194"><a href="#KnowledgeTools.ingest_knowledge_file-194"><span class="linenos">194</span></a>            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-195"><a href="#KnowledgeTools.ingest_knowledge_file-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 50MB limit</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-196"><a href="#KnowledgeTools.ingest_knowledge_file-196"><span class="linenos">196</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: File too large (</span><span class="si">{</span><span class="n">file_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB). Maximum size is 50MB.&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-197"><a href="#KnowledgeTools.ingest_knowledge_file-197"><span class="linenos">197</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-198"><a href="#KnowledgeTools.ingest_knowledge_file-198"><span class="linenos">198</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-199"><a href="#KnowledgeTools.ingest_knowledge_file-199"><span class="linenos">199</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-200"><a href="#KnowledgeTools.ingest_knowledge_file-200"><span class="linenos">200</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-201"><a href="#KnowledgeTools.ingest_knowledge_file-201"><span class="linenos">201</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-202"><a href="#KnowledgeTools.ingest_knowledge_file-202"><span class="linenos">202</span></a>            <span class="c1"># Check file type</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-203"><a href="#KnowledgeTools.ingest_knowledge_file-203"><span class="linenos">203</span></a>            <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-204"><a href="#KnowledgeTools.ingest_knowledge_file-204"><span class="linenos">204</span></a>            <span class="n">supported_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-205"><a href="#KnowledgeTools.ingest_knowledge_file-205"><span class="linenos">205</span></a>                <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-206"><a href="#KnowledgeTools.ingest_knowledge_file-206"><span class="linenos">206</span></a>                <span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-207"><a href="#KnowledgeTools.ingest_knowledge_file-207"><span class="linenos">207</span></a>                <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-208"><a href="#KnowledgeTools.ingest_knowledge_file-208"><span class="linenos">208</span></a>                <span class="s2">&quot;text/csv&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-209"><a href="#KnowledgeTools.ingest_knowledge_file-209"><span class="linenos">209</span></a>                <span class="s2">&quot;application/pdf&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-210"><a href="#KnowledgeTools.ingest_knowledge_file-210"><span class="linenos">210</span></a>                <span class="s2">&quot;application/msword&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-211"><a href="#KnowledgeTools.ingest_knowledge_file-211"><span class="linenos">211</span></a>                <span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-212"><a href="#KnowledgeTools.ingest_knowledge_file-212"><span class="linenos">212</span></a>            <span class="p">]</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-213"><a href="#KnowledgeTools.ingest_knowledge_file-213"><span class="linenos">213</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-214"><a href="#KnowledgeTools.ingest_knowledge_file-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="n">mime_type</span> <span class="ow">and</span> <span class="n">mime_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_types</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-215"><a href="#KnowledgeTools.ingest_knowledge_file-215"><span class="linenos">215</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File type </span><span class="si">{</span><span class="n">mime_type</span><span class="si">}</span><span class="s2"> may not be fully supported&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-216"><a href="#KnowledgeTools.ingest_knowledge_file-216"><span class="linenos">216</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-217"><a href="#KnowledgeTools.ingest_knowledge_file-217"><span class="linenos">217</span></a>            <span class="c1"># Copy file to knowledge directory</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-218"><a href="#KnowledgeTools.ingest_knowledge_file-218"><span class="linenos">218</span></a>            <span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-219"><a href="#KnowledgeTools.ingest_knowledge_file-219"><span class="linenos">219</span></a>            <span class="n">knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-220"><a href="#KnowledgeTools.ingest_knowledge_file-220"><span class="linenos">220</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-221"><a href="#KnowledgeTools.ingest_knowledge_file-221"><span class="linenos">221</span></a>            <span class="c1"># Create unique filename to avoid conflicts</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-222"><a href="#KnowledgeTools.ingest_knowledge_file-222"><span class="linenos">222</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-223"><a href="#KnowledgeTools.ingest_knowledge_file-223"><span class="linenos">223</span></a>            <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-224"><a href="#KnowledgeTools.ingest_knowledge_file-224"><span class="linenos">224</span></a>            <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-225"><a href="#KnowledgeTools.ingest_knowledge_file-225"><span class="linenos">225</span></a>            <span class="n">unique_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-226"><a href="#KnowledgeTools.ingest_knowledge_file-226"><span class="linenos">226</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-227"><a href="#KnowledgeTools.ingest_knowledge_file-227"><span class="linenos">227</span></a>            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">knowledge_dir</span> <span class="o">/</span> <span class="n">unique_filename</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-228"><a href="#KnowledgeTools.ingest_knowledge_file-228"><span class="linenos">228</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-229"><a href="#KnowledgeTools.ingest_knowledge_file-229"><span class="linenos">229</span></a>            <span class="c1"># Copy the file</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-230"><a href="#KnowledgeTools.ingest_knowledge_file-230"><span class="linenos">230</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-231"><a href="#KnowledgeTools.ingest_knowledge_file-231"><span class="linenos">231</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied file to knowledge directory: </span><span class="si">{</span><span class="n">dest_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-232"><a href="#KnowledgeTools.ingest_knowledge_file-232"><span class="linenos">232</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-233"><a href="#KnowledgeTools.ingest_knowledge_file-233"><span class="linenos">233</span></a>            <span class="c1"># Upload to LightRAG server</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-234"><a href="#KnowledgeTools.ingest_knowledge_file-234"><span class="linenos">234</span></a>            <span class="n">upload_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-235"><a href="#KnowledgeTools.ingest_knowledge_file-235"><span class="linenos">235</span></a>                <span class="n">dest_path</span><span class="p">,</span> <span class="n">unique_filename</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-236"><a href="#KnowledgeTools.ingest_knowledge_file-236"><span class="linenos">236</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-237"><a href="#KnowledgeTools.ingest_knowledge_file-237"><span class="linenos">237</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-238"><a href="#KnowledgeTools.ingest_knowledge_file-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-239"><a href="#KnowledgeTools.ingest_knowledge_file-239"><span class="linenos">239</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested knowledge file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-240"><a href="#KnowledgeTools.ingest_knowledge_file-240"><span class="linenos">240</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; into knowledge base. </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-241"><a href="#KnowledgeTools.ingest_knowledge_file-241"><span class="linenos">241</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-242"><a href="#KnowledgeTools.ingest_knowledge_file-242"><span class="linenos">242</span></a>                <span class="c1"># Clean up the copied file if upload failed</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-243"><a href="#KnowledgeTools.ingest_knowledge_file-243"><span class="linenos">243</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-244"><a href="#KnowledgeTools.ingest_knowledge_file-244"><span class="linenos">244</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-245"><a href="#KnowledgeTools.ingest_knowledge_file-245"><span class="linenos">245</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-246"><a href="#KnowledgeTools.ingest_knowledge_file-246"><span class="linenos">246</span></a>                    <span class="k">pass</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-247"><a href="#KnowledgeTools.ingest_knowledge_file-247"><span class="linenos">247</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-248"><a href="#KnowledgeTools.ingest_knowledge_file-248"><span class="linenos">248</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_file-249"><a href="#KnowledgeTools.ingest_knowledge_file-249"><span class="linenos">249</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-250"><a href="#KnowledgeTools.ingest_knowledge_file-250"><span class="linenos">250</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_file-251"><a href="#KnowledgeTools.ingest_knowledge_file-251"><span class="linenos">251</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest a file into the knowledge base.</p>

<p>Args:
    file_path: Path to the file to ingest
    title: Optional title for the knowledge entry (defaults to filename)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="KnowledgeTools.ingest_knowledge_text" class="classattr">
                                        <input id="KnowledgeTools.ingest_knowledge_text-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_knowledge_text</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">content</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;txt&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeTools.ingest_knowledge_text-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeTools.ingest_knowledge_text"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeTools.ingest_knowledge_text-253"><a href="#KnowledgeTools.ingest_knowledge_text-253"><span class="linenos">253</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_text</span><span class="p">(</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-254"><a href="#KnowledgeTools.ingest_knowledge_text-254"><span class="linenos">254</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-255"><a href="#KnowledgeTools.ingest_knowledge_text-255"><span class="linenos">255</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-256"><a href="#KnowledgeTools.ingest_knowledge_text-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest text content directly into the knowledge base.</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-257"><a href="#KnowledgeTools.ingest_knowledge_text-257"><span class="linenos">257</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-258"><a href="#KnowledgeTools.ingest_knowledge_text-258"><span class="linenos">258</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-259"><a href="#KnowledgeTools.ingest_knowledge_text-259"><span class="linenos">259</span></a><span class="sd">            content: The text content to ingest</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-260"><a href="#KnowledgeTools.ingest_knowledge_text-260"><span class="linenos">260</span></a><span class="sd">            title: Title for the knowledge entry</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-261"><a href="#KnowledgeTools.ingest_knowledge_text-261"><span class="linenos">261</span></a><span class="sd">            file_type: File extension to use (txt, md, html, etc.)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-262"><a href="#KnowledgeTools.ingest_knowledge_text-262"><span class="linenos">262</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-263"><a href="#KnowledgeTools.ingest_knowledge_text-263"><span class="linenos">263</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-264"><a href="#KnowledgeTools.ingest_knowledge_text-264"><span class="linenos">264</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-265"><a href="#KnowledgeTools.ingest_knowledge_text-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-266"><a href="#KnowledgeTools.ingest_knowledge_text-266"><span class="linenos">266</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-267"><a href="#KnowledgeTools.ingest_knowledge_text-267"><span class="linenos">267</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-268"><a href="#KnowledgeTools.ingest_knowledge_text-268"><span class="linenos">268</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Content cannot be empty&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-269"><a href="#KnowledgeTools.ingest_knowledge_text-269"><span class="linenos">269</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-270"><a href="#KnowledgeTools.ingest_knowledge_text-270"><span class="linenos">270</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-271"><a href="#KnowledgeTools.ingest_knowledge_text-271"><span class="linenos">271</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Title is required&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-272"><a href="#KnowledgeTools.ingest_knowledge_text-272"><span class="linenos">272</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-273"><a href="#KnowledgeTools.ingest_knowledge_text-273"><span class="linenos">273</span></a>            <span class="c1"># Validate file_type</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-274"><a href="#KnowledgeTools.ingest_knowledge_text-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-275"><a href="#KnowledgeTools.ingest_knowledge_text-275"><span class="linenos">275</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-276"><a href="#KnowledgeTools.ingest_knowledge_text-276"><span class="linenos">276</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-277"><a href="#KnowledgeTools.ingest_knowledge_text-277"><span class="linenos">277</span></a>            <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;.md&quot;</span><span class="p">,</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-278"><a href="#KnowledgeTools.ingest_knowledge_text-278"><span class="linenos">278</span></a>            <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-279"><a href="#KnowledgeTools.ingest_knowledge_text-279"><span class="linenos">279</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;.txt&quot;</span>  <span class="c1"># Default to txt</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-280"><a href="#KnowledgeTools.ingest_knowledge_text-280"><span class="linenos">280</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-281"><a href="#KnowledgeTools.ingest_knowledge_text-281"><span class="linenos">281</span></a>            <span class="c1"># Create knowledge directory</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-282"><a href="#KnowledgeTools.ingest_knowledge_text-282"><span class="linenos">282</span></a>            <span class="n">knowledge_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_KNOWLEDGE_DIR</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-283"><a href="#KnowledgeTools.ingest_knowledge_text-283"><span class="linenos">283</span></a>            <span class="n">knowledge_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-284"><a href="#KnowledgeTools.ingest_knowledge_text-284"><span class="linenos">284</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-285"><a href="#KnowledgeTools.ingest_knowledge_text-285"><span class="linenos">285</span></a>            <span class="c1"># Create unique filename</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-286"><a href="#KnowledgeTools.ingest_knowledge_text-286"><span class="linenos">286</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-287"><a href="#KnowledgeTools.ingest_knowledge_text-287"><span class="linenos">287</span></a>            <span class="n">content_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-288"><a href="#KnowledgeTools.ingest_knowledge_text-288"><span class="linenos">288</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-289"><a href="#KnowledgeTools.ingest_knowledge_text-289"><span class="linenos">289</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-290"><a href="#KnowledgeTools.ingest_knowledge_text-290"><span class="linenos">290</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-291"><a href="#KnowledgeTools.ingest_knowledge_text-291"><span class="linenos">291</span></a>                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">title</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-292"><a href="#KnowledgeTools.ingest_knowledge_text-292"><span class="linenos">292</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-293"><a href="#KnowledgeTools.ingest_knowledge_text-293"><span class="linenos">293</span></a>            <span class="n">safe_title</span> <span class="o">=</span> <span class="n">safe_title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>  <span class="c1"># Limit length</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-294"><a href="#KnowledgeTools.ingest_knowledge_text-294"><span class="linenos">294</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_title</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">content_hash</span><span class="si">}{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-295"><a href="#KnowledgeTools.ingest_knowledge_text-295"><span class="linenos">295</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-296"><a href="#KnowledgeTools.ingest_knowledge_text-296"><span class="linenos">296</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">knowledge_dir</span> <span class="o">/</span> <span class="n">filename</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-297"><a href="#KnowledgeTools.ingest_knowledge_text-297"><span class="linenos">297</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-298"><a href="#KnowledgeTools.ingest_knowledge_text-298"><span class="linenos">298</span></a>            <span class="c1"># Write content to file</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-299"><a href="#KnowledgeTools.ingest_knowledge_text-299"><span class="linenos">299</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-300"><a href="#KnowledgeTools.ingest_knowledge_text-300"><span class="linenos">300</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-301"><a href="#KnowledgeTools.ingest_knowledge_text-301"><span class="linenos">301</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-302"><a href="#KnowledgeTools.ingest_knowledge_text-302"><span class="linenos">302</span></a>            <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created knowledge file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-303"><a href="#KnowledgeTools.ingest_knowledge_text-303"><span class="linenos">303</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-304"><a href="#KnowledgeTools.ingest_knowledge_text-304"><span class="linenos">304</span></a>            <span class="c1"># Upload to LightRAG server</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-305"><a href="#KnowledgeTools.ingest_knowledge_text-305"><span class="linenos">305</span></a>            <span class="n">upload_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_lightrag</span><span class="p">(</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-306"><a href="#KnowledgeTools.ingest_knowledge_text-306"><span class="linenos">306</span></a>                <span class="n">file_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-307"><a href="#KnowledgeTools.ingest_knowledge_text-307"><span class="linenos">307</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-308"><a href="#KnowledgeTools.ingest_knowledge_text-308"><span class="linenos">308</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-309"><a href="#KnowledgeTools.ingest_knowledge_text-309"><span class="linenos">309</span></a>            <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-310"><a href="#KnowledgeTools.ingest_knowledge_text-310"><span class="linenos">310</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested knowledge text: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-311"><a href="#KnowledgeTools.ingest_knowledge_text-311"><span class="linenos">311</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Successfully ingested &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39; into knowledge base. </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-312"><a href="#KnowledgeTools.ingest_knowledge_text-312"><span class="linenos">312</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-313"><a href="#KnowledgeTools.ingest_knowledge_text-313"><span class="linenos">313</span></a>                <span class="c1"># Clean up the created file if upload failed</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-314"><a href="#KnowledgeTools.ingest_knowledge_text-314"><span class="linenos">314</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-315"><a href="#KnowledgeTools.ingest_knowledge_text-315"><span class="linenos">315</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-316"><a href="#KnowledgeTools.ingest_knowledge_text-316"><span class="linenos">316</span></a>                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-317"><a href="#KnowledgeTools.ingest_knowledge_text-317"><span class="linenos">317</span></a>                    <span class="k">pass</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-318"><a href="#KnowledgeTools.ingest_knowledge_text-318"><span class="linenos">318</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Failed to ingest &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">upload_result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-319"><a href="#KnowledgeTools.ingest_knowledge_text-319"><span class="linenos">319</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_text-320"><a href="#KnowledgeTools.ingest_knowledge_text-320"><span class="linenos">320</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-321"><a href="#KnowledgeTools.ingest_knowledge_text-321"><span class="linenos">321</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting text content: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_text-322"><a href="#KnowledgeTools.ingest_knowledge_text-322"><span class="linenos">322</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting text content: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest text content directly into the knowledge base.</p>

<p>Args:
    content: The text content to ingest
    title: Title for the knowledge entry
    file_type: File extension to use (txt, md, html, etc.)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="KnowledgeTools.ingest_knowledge_from_url" class="classattr">
                                        <input id="KnowledgeTools.ingest_knowledge_from_url-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ingest_knowledge_from_url</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeTools.ingest_knowledge_from_url-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeTools.ingest_knowledge_from_url"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeTools.ingest_knowledge_from_url-324"><a href="#KnowledgeTools.ingest_knowledge_from_url-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_knowledge_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-325"><a href="#KnowledgeTools.ingest_knowledge_from_url-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest content from a URL into the knowledge base.</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-326"><a href="#KnowledgeTools.ingest_knowledge_from_url-326"><span class="linenos">326</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-327"><a href="#KnowledgeTools.ingest_knowledge_from_url-327"><span class="linenos">327</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-328"><a href="#KnowledgeTools.ingest_knowledge_from_url-328"><span class="linenos">328</span></a><span class="sd">            url: URL to fetch content from</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-329"><a href="#KnowledgeTools.ingest_knowledge_from_url-329"><span class="linenos">329</span></a><span class="sd">            title: Optional title for the knowledge entry (defaults to page title or URL)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-330"><a href="#KnowledgeTools.ingest_knowledge_from_url-330"><span class="linenos">330</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-331"><a href="#KnowledgeTools.ingest_knowledge_from_url-331"><span class="linenos">331</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-332"><a href="#KnowledgeTools.ingest_knowledge_from_url-332"><span class="linenos">332</span></a><span class="sd">            Success message or error details.</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-333"><a href="#KnowledgeTools.ingest_knowledge_from_url-333"><span class="linenos">333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-334"><a href="#KnowledgeTools.ingest_knowledge_from_url-334"><span class="linenos">334</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-335"><a href="#KnowledgeTools.ingest_knowledge_from_url-335"><span class="linenos">335</span></a>            <span class="c1"># Validate URL</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-336"><a href="#KnowledgeTools.ingest_knowledge_from_url-336"><span class="linenos">336</span></a>            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-337"><a href="#KnowledgeTools.ingest_knowledge_from_url-337"><span class="linenos">337</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-338"><a href="#KnowledgeTools.ingest_knowledge_from_url-338"><span class="linenos">338</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Invalid URL format: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-339"><a href="#KnowledgeTools.ingest_knowledge_from_url-339"><span class="linenos">339</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-340"><a href="#KnowledgeTools.ingest_knowledge_from_url-340"><span class="linenos">340</span></a>            <span class="c1"># Fetch content</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-341"><a href="#KnowledgeTools.ingest_knowledge_from_url-341"><span class="linenos">341</span></a>            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-342"><a href="#KnowledgeTools.ingest_knowledge_from_url-342"><span class="linenos">342</span></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-343"><a href="#KnowledgeTools.ingest_knowledge_from_url-343"><span class="linenos">343</span></a>            <span class="p">}</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-344"><a href="#KnowledgeTools.ingest_knowledge_from_url-344"><span class="linenos">344</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-345"><a href="#KnowledgeTools.ingest_knowledge_from_url-345"><span class="linenos">345</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-346"><a href="#KnowledgeTools.ingest_knowledge_from_url-346"><span class="linenos">346</span></a>            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-347"><a href="#KnowledgeTools.ingest_knowledge_from_url-347"><span class="linenos">347</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-348"><a href="#KnowledgeTools.ingest_knowledge_from_url-348"><span class="linenos">348</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-349"><a href="#KnowledgeTools.ingest_knowledge_from_url-349"><span class="linenos">349</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-350"><a href="#KnowledgeTools.ingest_knowledge_from_url-350"><span class="linenos">350</span></a>            <span class="c1"># Handle different content types</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-351"><a href="#KnowledgeTools.ingest_knowledge_from_url-351"><span class="linenos">351</span></a>            <span class="k">if</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-352"><a href="#KnowledgeTools.ingest_knowledge_from_url-352"><span class="linenos">352</span></a>                <span class="c1"># For HTML, try to extract text content</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-353"><a href="#KnowledgeTools.ingest_knowledge_from_url-353"><span class="linenos">353</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-354"><a href="#KnowledgeTools.ingest_knowledge_from_url-354"><span class="linenos">354</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-355"><a href="#KnowledgeTools.ingest_knowledge_from_url-355"><span class="linenos">355</span></a>                    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-356"><a href="#KnowledgeTools.ingest_knowledge_from_url-356"><span class="linenos">356</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-357"><a href="#KnowledgeTools.ingest_knowledge_from_url-357"><span class="linenos">357</span></a>                    <span class="c1"># Remove script and style elements</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-358"><a href="#KnowledgeTools.ingest_knowledge_from_url-358"><span class="linenos">358</span></a>                    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-359"><a href="#KnowledgeTools.ingest_knowledge_from_url-359"><span class="linenos">359</span></a>                        <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-360"><a href="#KnowledgeTools.ingest_knowledge_from_url-360"><span class="linenos">360</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-361"><a href="#KnowledgeTools.ingest_knowledge_from_url-361"><span class="linenos">361</span></a>                    <span class="c1"># Get text content</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-362"><a href="#KnowledgeTools.ingest_knowledge_from_url-362"><span class="linenos">362</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-363"><a href="#KnowledgeTools.ingest_knowledge_from_url-363"><span class="linenos">363</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-364"><a href="#KnowledgeTools.ingest_knowledge_from_url-364"><span class="linenos">364</span></a>                    <span class="c1"># Get title if not provided</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-365"><a href="#KnowledgeTools.ingest_knowledge_from_url-365"><span class="linenos">365</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-366"><a href="#KnowledgeTools.ingest_knowledge_from_url-366"><span class="linenos">366</span></a>                        <span class="n">title_tag</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-367"><a href="#KnowledgeTools.ingest_knowledge_from_url-367"><span class="linenos">367</span></a>                        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-368"><a href="#KnowledgeTools.ingest_knowledge_from_url-368"><span class="linenos">368</span></a>                            <span class="n">title_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-369"><a href="#KnowledgeTools.ingest_knowledge_from_url-369"><span class="linenos">369</span></a>                            <span class="k">if</span> <span class="n">title_tag</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-370"><a href="#KnowledgeTools.ingest_knowledge_from_url-370"><span class="linenos">370</span></a>                            <span class="k">else</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-371"><a href="#KnowledgeTools.ingest_knowledge_from_url-371"><span class="linenos">371</span></a>                        <span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-372"><a href="#KnowledgeTools.ingest_knowledge_from_url-372"><span class="linenos">372</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-373"><a href="#KnowledgeTools.ingest_knowledge_from_url-373"><span class="linenos">373</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-374"><a href="#KnowledgeTools.ingest_knowledge_from_url-374"><span class="linenos">374</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-375"><a href="#KnowledgeTools.ingest_knowledge_from_url-375"><span class="linenos">375</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-376"><a href="#KnowledgeTools.ingest_knowledge_from_url-376"><span class="linenos">376</span></a>                    <span class="c1"># Fallback if BeautifulSoup not available</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-377"><a href="#KnowledgeTools.ingest_knowledge_from_url-377"><span class="linenos">377</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-378"><a href="#KnowledgeTools.ingest_knowledge_from_url-378"><span class="linenos">378</span></a>                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-379"><a href="#KnowledgeTools.ingest_knowledge_from_url-379"><span class="linenos">379</span></a>                    <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-380"><a href="#KnowledgeTools.ingest_knowledge_from_url-380"><span class="linenos">380</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-381"><a href="#KnowledgeTools.ingest_knowledge_from_url-381"><span class="linenos">381</span></a>            <span class="k">elif</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/json&quot;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-382"><a href="#KnowledgeTools.ingest_knowledge_from_url-382"><span class="linenos">382</span></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-383"><a href="#KnowledgeTools.ingest_knowledge_from_url-383"><span class="linenos">383</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="ow">or</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-384"><a href="#KnowledgeTools.ingest_knowledge_from_url-384"><span class="linenos">384</span></a>                <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span> <span class="k">if</span> <span class="s2">&quot;text/&quot;</span> <span class="ow">in</span> <span class="n">content_type</span> <span class="k">else</span> <span class="s2">&quot;json&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-385"><a href="#KnowledgeTools.ingest_knowledge_from_url-385"><span class="linenos">385</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-386"><a href="#KnowledgeTools.ingest_knowledge_from_url-386"><span class="linenos">386</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Unsupported content type: </span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-387"><a href="#KnowledgeTools.ingest_knowledge_from_url-387"><span class="linenos">387</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-388"><a href="#KnowledgeTools.ingest_knowledge_from_url-388"><span class="linenos">388</span></a>            <span class="c1"># Clean up content</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-389"><a href="#KnowledgeTools.ingest_knowledge_from_url-389"><span class="linenos">389</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-390"><a href="#KnowledgeTools.ingest_knowledge_from_url-390"><span class="linenos">390</span></a>                <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-391"><a href="#KnowledgeTools.ingest_knowledge_from_url-391"><span class="linenos">391</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-392"><a href="#KnowledgeTools.ingest_knowledge_from_url-392"><span class="linenos">392</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-393"><a href="#KnowledgeTools.ingest_knowledge_from_url-393"><span class="linenos">393</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-394"><a href="#KnowledgeTools.ingest_knowledge_from_url-394"><span class="linenos">394</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: No content extracted from URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-395"><a href="#KnowledgeTools.ingest_knowledge_from_url-395"><span class="linenos">395</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-396"><a href="#KnowledgeTools.ingest_knowledge_from_url-396"><span class="linenos">396</span></a>            <span class="c1"># Add source URL to content</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-397"><a href="#KnowledgeTools.ingest_knowledge_from_url-397"><span class="linenos">397</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-398"><a href="#KnowledgeTools.ingest_knowledge_from_url-398"><span class="linenos">398</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-399"><a href="#KnowledgeTools.ingest_knowledge_from_url-399"><span class="linenos">399</span></a>            <span class="c1"># Ingest the content</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-400"><a href="#KnowledgeTools.ingest_knowledge_from_url-400"><span class="linenos">400</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-401"><a href="#KnowledgeTools.ingest_knowledge_from_url-401"><span class="linenos">401</span></a>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-402"><a href="#KnowledgeTools.ingest_knowledge_from_url-402"><span class="linenos">402</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-403"><a href="#KnowledgeTools.ingest_knowledge_from_url-403"><span class="linenos">403</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-404"><a href="#KnowledgeTools.ingest_knowledge_from_url-404"><span class="linenos">404</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error fetching URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-405"><a href="#KnowledgeTools.ingest_knowledge_from_url-405"><span class="linenos">405</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-406"><a href="#KnowledgeTools.ingest_knowledge_from_url-406"><span class="linenos">406</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ingesting from URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.ingest_knowledge_from_url-407"><a href="#KnowledgeTools.ingest_knowledge_from_url-407"><span class="linenos">407</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error ingesting from URL: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest content from a URL into the knowledge base.</p>

<p>Args:
    url: URL to fetch content from
    title: Optional title for the knowledge entry (defaults to page title or URL)</p>

<p>Returns:
    Success message or error details.</p>
</div>


                            </div>
                            <div id="KnowledgeTools.batch_ingest_directory" class="classattr">
                                        <input id="KnowledgeTools.batch_ingest_directory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch_ingest_directory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeTools.batch_ingest_directory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeTools.batch_ingest_directory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeTools.batch_ingest_directory-409"><a href="#KnowledgeTools.batch_ingest_directory-409"><span class="linenos">409</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_ingest_directory</span><span class="p">(</span>
</span><span id="KnowledgeTools.batch_ingest_directory-410"><a href="#KnowledgeTools.batch_ingest_directory-410"><span class="linenos">410</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KnowledgeTools.batch_ingest_directory-411"><a href="#KnowledgeTools.batch_ingest_directory-411"><span class="linenos">411</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-412"><a href="#KnowledgeTools.batch_ingest_directory-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ingest multiple files from a directory into the knowledge base.</span>
</span><span id="KnowledgeTools.batch_ingest_directory-413"><a href="#KnowledgeTools.batch_ingest_directory-413"><span class="linenos">413</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-414"><a href="#KnowledgeTools.batch_ingest_directory-414"><span class="linenos">414</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-415"><a href="#KnowledgeTools.batch_ingest_directory-415"><span class="linenos">415</span></a><span class="sd">            directory_path: Path to the directory containing files</span>
</span><span id="KnowledgeTools.batch_ingest_directory-416"><a href="#KnowledgeTools.batch_ingest_directory-416"><span class="linenos">416</span></a><span class="sd">            file_pattern: Glob pattern to match files (e.g., &quot;*.txt&quot;, &quot;*.md&quot;)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-417"><a href="#KnowledgeTools.batch_ingest_directory-417"><span class="linenos">417</span></a><span class="sd">            recursive: Whether to search subdirectories recursively</span>
</span><span id="KnowledgeTools.batch_ingest_directory-418"><a href="#KnowledgeTools.batch_ingest_directory-418"><span class="linenos">418</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-419"><a href="#KnowledgeTools.batch_ingest_directory-419"><span class="linenos">419</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-420"><a href="#KnowledgeTools.batch_ingest_directory-420"><span class="linenos">420</span></a><span class="sd">            Summary of ingestion results.</span>
</span><span id="KnowledgeTools.batch_ingest_directory-421"><a href="#KnowledgeTools.batch_ingest_directory-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-422"><a href="#KnowledgeTools.batch_ingest_directory-422"><span class="linenos">422</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-423"><a href="#KnowledgeTools.batch_ingest_directory-423"><span class="linenos">423</span></a>            <span class="c1"># Expand path shortcuts</span>
</span><span id="KnowledgeTools.batch_ingest_directory-424"><a href="#KnowledgeTools.batch_ingest_directory-424"><span class="linenos">424</span></a>            <span class="k">if</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools.batch_ingest_directory-425"><a href="#KnowledgeTools.batch_ingest_directory-425"><span class="linenos">425</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-426"><a href="#KnowledgeTools.batch_ingest_directory-426"><span class="linenos">426</span></a>            <span class="k">elif</span> <span class="n">directory_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
</span><span id="KnowledgeTools.batch_ingest_directory-427"><a href="#KnowledgeTools.batch_ingest_directory-427"><span class="linenos">427</span></a>                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-428"><a href="#KnowledgeTools.batch_ingest_directory-428"><span class="linenos">428</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-429"><a href="#KnowledgeTools.batch_ingest_directory-429"><span class="linenos">429</span></a>            <span class="c1"># Validate directory exists</span>
</span><span id="KnowledgeTools.batch_ingest_directory-430"><a href="#KnowledgeTools.batch_ingest_directory-430"><span class="linenos">430</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="KnowledgeTools.batch_ingest_directory-431"><a href="#KnowledgeTools.batch_ingest_directory-431"><span class="linenos">431</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: Directory not found at &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-432"><a href="#KnowledgeTools.batch_ingest_directory-432"><span class="linenos">432</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-433"><a href="#KnowledgeTools.batch_ingest_directory-433"><span class="linenos">433</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
</span><span id="KnowledgeTools.batch_ingest_directory-434"><a href="#KnowledgeTools.batch_ingest_directory-434"><span class="linenos">434</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error: &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39; is not a directory&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-435"><a href="#KnowledgeTools.batch_ingest_directory-435"><span class="linenos">435</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-436"><a href="#KnowledgeTools.batch_ingest_directory-436"><span class="linenos">436</span></a>            <span class="c1"># Find files matching pattern</span>
</span><span id="KnowledgeTools.batch_ingest_directory-437"><a href="#KnowledgeTools.batch_ingest_directory-437"><span class="linenos">437</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-438"><a href="#KnowledgeTools.batch_ingest_directory-438"><span class="linenos">438</span></a>            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-439"><a href="#KnowledgeTools.batch_ingest_directory-439"><span class="linenos">439</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="KnowledgeTools.batch_ingest_directory-440"><a href="#KnowledgeTools.batch_ingest_directory-440"><span class="linenos">440</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-441"><a href="#KnowledgeTools.batch_ingest_directory-441"><span class="linenos">441</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span id="KnowledgeTools.batch_ingest_directory-442"><a href="#KnowledgeTools.batch_ingest_directory-442"><span class="linenos">442</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-443"><a href="#KnowledgeTools.batch_ingest_directory-443"><span class="linenos">443</span></a>            <span class="c1"># Filter to only include files (not directories)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-444"><a href="#KnowledgeTools.batch_ingest_directory-444"><span class="linenos">444</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
</span><span id="KnowledgeTools.batch_ingest_directory-445"><a href="#KnowledgeTools.batch_ingest_directory-445"><span class="linenos">445</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-446"><a href="#KnowledgeTools.batch_ingest_directory-446"><span class="linenos">446</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-447"><a href="#KnowledgeTools.batch_ingest_directory-447"><span class="linenos">447</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No files found matching pattern &#39;</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-448"><a href="#KnowledgeTools.batch_ingest_directory-448"><span class="linenos">448</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-449"><a href="#KnowledgeTools.batch_ingest_directory-449"><span class="linenos">449</span></a>            <span class="c1"># Limit batch size to prevent overwhelming the system</span>
</span><span id="KnowledgeTools.batch_ingest_directory-450"><a href="#KnowledgeTools.batch_ingest_directory-450"><span class="linenos">450</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-451"><a href="#KnowledgeTools.batch_ingest_directory-451"><span class="linenos">451</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Too many files (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">). Please process in smaller batches (max 50 files).&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-452"><a href="#KnowledgeTools.batch_ingest_directory-452"><span class="linenos">452</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-453"><a href="#KnowledgeTools.batch_ingest_directory-453"><span class="linenos">453</span></a>            <span class="c1"># Process files</span>
</span><span id="KnowledgeTools.batch_ingest_directory-454"><a href="#KnowledgeTools.batch_ingest_directory-454"><span class="linenos">454</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="KnowledgeTools.batch_ingest_directory-455"><a href="#KnowledgeTools.batch_ingest_directory-455"><span class="linenos">455</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-456"><a href="#KnowledgeTools.batch_ingest_directory-456"><span class="linenos">456</span></a>            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-457"><a href="#KnowledgeTools.batch_ingest_directory-457"><span class="linenos">457</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-458"><a href="#KnowledgeTools.batch_ingest_directory-458"><span class="linenos">458</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest_knowledge_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="KnowledgeTools.batch_ingest_directory-459"><a href="#KnowledgeTools.batch_ingest_directory-459"><span class="linenos">459</span></a>                    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-460"><a href="#KnowledgeTools.batch_ingest_directory-460"><span class="linenos">460</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeTools.batch_ingest_directory-461"><a href="#KnowledgeTools.batch_ingest_directory-461"><span class="linenos">461</span></a>                        <span class="n">log_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully ingested: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-462"><a href="#KnowledgeTools.batch_ingest_directory-462"><span class="linenos">462</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-463"><a href="#KnowledgeTools.batch_ingest_directory-463"><span class="linenos">463</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeTools.batch_ingest_directory-464"><a href="#KnowledgeTools.batch_ingest_directory-464"><span class="linenos">464</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-465"><a href="#KnowledgeTools.batch_ingest_directory-465"><span class="linenos">465</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to ingest </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-466"><a href="#KnowledgeTools.batch_ingest_directory-466"><span class="linenos">466</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-467"><a href="#KnowledgeTools.batch_ingest_directory-467"><span class="linenos">467</span></a>                    <span class="c1"># Small delay to avoid overwhelming the server</span>
</span><span id="KnowledgeTools.batch_ingest_directory-468"><a href="#KnowledgeTools.batch_ingest_directory-468"><span class="linenos">468</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-469"><a href="#KnowledgeTools.batch_ingest_directory-469"><span class="linenos">469</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-470"><a href="#KnowledgeTools.batch_ingest_directory-470"><span class="linenos">470</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-471"><a href="#KnowledgeTools.batch_ingest_directory-471"><span class="linenos">471</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="KnowledgeTools.batch_ingest_directory-472"><a href="#KnowledgeTools.batch_ingest_directory-472"><span class="linenos">472</span></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-473"><a href="#KnowledgeTools.batch_ingest_directory-473"><span class="linenos">473</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-474"><a href="#KnowledgeTools.batch_ingest_directory-474"><span class="linenos">474</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-475"><a href="#KnowledgeTools.batch_ingest_directory-475"><span class="linenos">475</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-476"><a href="#KnowledgeTools.batch_ingest_directory-476"><span class="linenos">476</span></a>            <span class="c1"># Format results</span>
</span><span id="KnowledgeTools.batch_ingest_directory-477"><a href="#KnowledgeTools.batch_ingest_directory-477"><span class="linenos">477</span></a>            <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Batch ingestion complete: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> successful, </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> failed&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-478"><a href="#KnowledgeTools.batch_ingest_directory-478"><span class="linenos">478</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-479"><a href="#KnowledgeTools.batch_ingest_directory-479"><span class="linenos">479</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-480"><a href="#KnowledgeTools.batch_ingest_directory-480"><span class="linenos">480</span></a>                <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Errors:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="KnowledgeTools.batch_ingest_directory-481"><a href="#KnowledgeTools.batch_ingest_directory-481"><span class="linenos">481</span></a>                    <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</span><span id="KnowledgeTools.batch_ingest_directory-482"><a href="#KnowledgeTools.batch_ingest_directory-482"><span class="linenos">482</span></a>                <span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-483"><a href="#KnowledgeTools.batch_ingest_directory-483"><span class="linenos">483</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-484"><a href="#KnowledgeTools.batch_ingest_directory-484"><span class="linenos">484</span></a>                    <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more errors&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-485"><a href="#KnowledgeTools.batch_ingest_directory-485"><span class="linenos">485</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-486"><a href="#KnowledgeTools.batch_ingest_directory-486"><span class="linenos">486</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeTools.batch_ingest_directory-487"><a href="#KnowledgeTools.batch_ingest_directory-487"><span class="linenos">487</span></a>                <span class="sa">f</span><span class="s2">&quot;Batch ingestion completed: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files successful&quot;</span>
</span><span id="KnowledgeTools.batch_ingest_directory-488"><a href="#KnowledgeTools.batch_ingest_directory-488"><span class="linenos">488</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-489"><a href="#KnowledgeTools.batch_ingest_directory-489"><span class="linenos">489</span></a>            <span class="k">return</span> <span class="n">summary</span>
</span><span id="KnowledgeTools.batch_ingest_directory-490"><a href="#KnowledgeTools.batch_ingest_directory-490"><span class="linenos">490</span></a>
</span><span id="KnowledgeTools.batch_ingest_directory-491"><a href="#KnowledgeTools.batch_ingest_directory-491"><span class="linenos">491</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.batch_ingest_directory-492"><a href="#KnowledgeTools.batch_ingest_directory-492"><span class="linenos">492</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in batch ingestion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.batch_ingest_directory-493"><a href="#KnowledgeTools.batch_ingest_directory-493"><span class="linenos">493</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error in batch ingestion: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Ingest multiple files from a directory into the knowledge base.</p>

<p>Args:
    directory_path: Path to the directory containing files
    file_pattern: Glob pattern to match files (e.g., "<em>.txt", "</em>.md")
    recursive: Whether to search subdirectories recursively</p>

<p>Returns:
    Summary of ingestion results.</p>
</div>


                            </div>
                            <div id="KnowledgeTools.query_knowledge_base" class="classattr">
                                        <input id="KnowledgeTools.query_knowledge_base-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">query_knowledge_base</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>, </span><span class="param"><span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeTools.query_knowledge_base-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeTools.query_knowledge_base"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeTools.query_knowledge_base-495"><a href="#KnowledgeTools.query_knowledge_base-495"><span class="linenos">495</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_knowledge_base</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_knowledge_base-496"><a href="#KnowledgeTools.query_knowledge_base-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="KnowledgeTools.query_knowledge_base-497"><a href="#KnowledgeTools.query_knowledge_base-497"><span class="linenos">497</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_knowledge_base-498"><a href="#KnowledgeTools.query_knowledge_base-498"><span class="linenos">498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the unified knowledge base to retrieve stored factual information and documents.</span>
</span><span id="KnowledgeTools.query_knowledge_base-499"><a href="#KnowledgeTools.query_knowledge_base-499"><span class="linenos">499</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-500"><a href="#KnowledgeTools.query_knowledge_base-500"><span class="linenos">500</span></a><span class="sd">        This tool is for SEARCHING existing knowledge, NOT for creative tasks like writing stories,</span>
</span><span id="KnowledgeTools.query_knowledge_base-501"><a href="#KnowledgeTools.query_knowledge_base-501"><span class="linenos">501</span></a><span class="sd">        generating content, or answering general questions. Use this only when you need to find</span>
</span><span id="KnowledgeTools.query_knowledge_base-502"><a href="#KnowledgeTools.query_knowledge_base-502"><span class="linenos">502</span></a><span class="sd">        specific information that was previously stored in the knowledge base.</span>
</span><span id="KnowledgeTools.query_knowledge_base-503"><a href="#KnowledgeTools.query_knowledge_base-503"><span class="linenos">503</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-504"><a href="#KnowledgeTools.query_knowledge_base-504"><span class="linenos">504</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools.query_knowledge_base-505"><a href="#KnowledgeTools.query_knowledge_base-505"><span class="linenos">505</span></a><span class="sd">            query: The search query for finding existing knowledge/documents</span>
</span><span id="KnowledgeTools.query_knowledge_base-506"><a href="#KnowledgeTools.query_knowledge_base-506"><span class="linenos">506</span></a><span class="sd">            mode: Query mode - &quot;local&quot; (semantic), &quot;global&quot; (graph), &quot;hybrid&quot;, &quot;mix&quot;, &quot;auto&quot;</span>
</span><span id="KnowledgeTools.query_knowledge_base-507"><a href="#KnowledgeTools.query_knowledge_base-507"><span class="linenos">507</span></a><span class="sd">            limit: Maximum number of results to return (defaults to 5 if None)</span>
</span><span id="KnowledgeTools.query_knowledge_base-508"><a href="#KnowledgeTools.query_knowledge_base-508"><span class="linenos">508</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-509"><a href="#KnowledgeTools.query_knowledge_base-509"><span class="linenos">509</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools.query_knowledge_base-510"><a href="#KnowledgeTools.query_knowledge_base-510"><span class="linenos">510</span></a><span class="sd">            Search results from the knowledge base, or rejection message for inappropriate requests.</span>
</span><span id="KnowledgeTools.query_knowledge_base-511"><a href="#KnowledgeTools.query_knowledge_base-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools.query_knowledge_base-512"><a href="#KnowledgeTools.query_knowledge_base-512"><span class="linenos">512</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_knowledge_base-513"><a href="#KnowledgeTools.query_knowledge_base-513"><span class="linenos">513</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools.query_knowledge_base-514"><a href="#KnowledgeTools.query_knowledge_base-514"><span class="linenos">514</span></a>                <span class="k">return</span> <span class="s2">&quot; Error: Query cannot be empty&quot;</span>
</span><span id="KnowledgeTools.query_knowledge_base-515"><a href="#KnowledgeTools.query_knowledge_base-515"><span class="linenos">515</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-516"><a href="#KnowledgeTools.query_knowledge_base-516"><span class="linenos">516</span></a>            <span class="c1"># Filter out inappropriate creative requests</span>
</span><span id="KnowledgeTools.query_knowledge_base-517"><a href="#KnowledgeTools.query_knowledge_base-517"><span class="linenos">517</span></a>            <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="KnowledgeTools.query_knowledge_base-518"><a href="#KnowledgeTools.query_knowledge_base-518"><span class="linenos">518</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-519"><a href="#KnowledgeTools.query_knowledge_base-519"><span class="linenos">519</span></a>            <span class="c1"># Creative/generative request patterns that should NOT use knowledge search</span>
</span><span id="KnowledgeTools.query_knowledge_base-520"><a href="#KnowledgeTools.query_knowledge_base-520"><span class="linenos">520</span></a>            <span class="n">creative_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeTools.query_knowledge_base-521"><a href="#KnowledgeTools.query_knowledge_base-521"><span class="linenos">521</span></a>                <span class="s2">&quot;write&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-522"><a href="#KnowledgeTools.query_knowledge_base-522"><span class="linenos">522</span></a>                <span class="s2">&quot;create&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-523"><a href="#KnowledgeTools.query_knowledge_base-523"><span class="linenos">523</span></a>                <span class="s2">&quot;generate&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-524"><a href="#KnowledgeTools.query_knowledge_base-524"><span class="linenos">524</span></a>                <span class="s2">&quot;make&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-525"><a href="#KnowledgeTools.query_knowledge_base-525"><span class="linenos">525</span></a>                <span class="s2">&quot;compose&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-526"><a href="#KnowledgeTools.query_knowledge_base-526"><span class="linenos">526</span></a>                <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-527"><a href="#KnowledgeTools.query_knowledge_base-527"><span class="linenos">527</span></a>                <span class="s2">&quot;tell me a&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-528"><a href="#KnowledgeTools.query_knowledge_base-528"><span class="linenos">528</span></a>                <span class="s2">&quot;give me a&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-529"><a href="#KnowledgeTools.query_knowledge_base-529"><span class="linenos">529</span></a>                <span class="s2">&quot;come up with&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-530"><a href="#KnowledgeTools.query_knowledge_base-530"><span class="linenos">530</span></a>                <span class="s2">&quot;think of&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-531"><a href="#KnowledgeTools.query_knowledge_base-531"><span class="linenos">531</span></a>                <span class="s2">&quot;story&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-532"><a href="#KnowledgeTools.query_knowledge_base-532"><span class="linenos">532</span></a>                <span class="s2">&quot;poem&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-533"><a href="#KnowledgeTools.query_knowledge_base-533"><span class="linenos">533</span></a>                <span class="s2">&quot;joke&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-534"><a href="#KnowledgeTools.query_knowledge_base-534"><span class="linenos">534</span></a>                <span class="s2">&quot;song&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-535"><a href="#KnowledgeTools.query_knowledge_base-535"><span class="linenos">535</span></a>                <span class="s2">&quot;essay&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-536"><a href="#KnowledgeTools.query_knowledge_base-536"><span class="linenos">536</span></a>                <span class="s2">&quot;article&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-537"><a href="#KnowledgeTools.query_knowledge_base-537"><span class="linenos">537</span></a>                <span class="s2">&quot;funny&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-538"><a href="#KnowledgeTools.query_knowledge_base-538"><span class="linenos">538</span></a>                <span class="s2">&quot;creative&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-539"><a href="#KnowledgeTools.query_knowledge_base-539"><span class="linenos">539</span></a>                <span class="s2">&quot;imagine&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-540"><a href="#KnowledgeTools.query_knowledge_base-540"><span class="linenos">540</span></a>                <span class="s2">&quot;pretend&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-541"><a href="#KnowledgeTools.query_knowledge_base-541"><span class="linenos">541</span></a>            <span class="p">]</span>
</span><span id="KnowledgeTools.query_knowledge_base-542"><a href="#KnowledgeTools.query_knowledge_base-542"><span class="linenos">542</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-543"><a href="#KnowledgeTools.query_knowledge_base-543"><span class="linenos">543</span></a>            <span class="c1"># Check if this looks like a creative request</span>
</span><span id="KnowledgeTools.query_knowledge_base-544"><a href="#KnowledgeTools.query_knowledge_base-544"><span class="linenos">544</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">creative_patterns</span><span class="p">):</span>
</span><span id="KnowledgeTools.query_knowledge_base-545"><a href="#KnowledgeTools.query_knowledge_base-545"><span class="linenos">545</span></a>                <span class="c1"># Additional check: if it&#39;s asking for factual info WITH creative words, allow it</span>
</span><span id="KnowledgeTools.query_knowledge_base-546"><a href="#KnowledgeTools.query_knowledge_base-546"><span class="linenos">546</span></a>                <span class="n">factual_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="KnowledgeTools.query_knowledge_base-547"><a href="#KnowledgeTools.query_knowledge_base-547"><span class="linenos">547</span></a>                    <span class="s2">&quot;what is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-548"><a href="#KnowledgeTools.query_knowledge_base-548"><span class="linenos">548</span></a>                    <span class="s2">&quot;who is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-549"><a href="#KnowledgeTools.query_knowledge_base-549"><span class="linenos">549</span></a>                    <span class="s2">&quot;when did&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-550"><a href="#KnowledgeTools.query_knowledge_base-550"><span class="linenos">550</span></a>                    <span class="s2">&quot;where is&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-551"><a href="#KnowledgeTools.query_knowledge_base-551"><span class="linenos">551</span></a>                    <span class="s2">&quot;how does&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-552"><a href="#KnowledgeTools.query_knowledge_base-552"><span class="linenos">552</span></a>                    <span class="s2">&quot;definition of&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-553"><a href="#KnowledgeTools.query_knowledge_base-553"><span class="linenos">553</span></a>                    <span class="s2">&quot;information about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-554"><a href="#KnowledgeTools.query_knowledge_base-554"><span class="linenos">554</span></a>                    <span class="s2">&quot;facts about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-555"><a href="#KnowledgeTools.query_knowledge_base-555"><span class="linenos">555</span></a>                    <span class="s2">&quot;details about&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-556"><a href="#KnowledgeTools.query_knowledge_base-556"><span class="linenos">556</span></a>                    <span class="s2">&quot;explain&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-557"><a href="#KnowledgeTools.query_knowledge_base-557"><span class="linenos">557</span></a>                    <span class="s2">&quot;describe&quot;</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-558"><a href="#KnowledgeTools.query_knowledge_base-558"><span class="linenos">558</span></a>                <span class="p">]</span>
</span><span id="KnowledgeTools.query_knowledge_base-559"><a href="#KnowledgeTools.query_knowledge_base-559"><span class="linenos">559</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-560"><a href="#KnowledgeTools.query_knowledge_base-560"><span class="linenos">560</span></a>                <span class="c1"># If it has factual patterns, it might be legitimate</span>
</span><span id="KnowledgeTools.query_knowledge_base-561"><a href="#KnowledgeTools.query_knowledge_base-561"><span class="linenos">561</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">factual</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">factual</span> <span class="ow">in</span> <span class="n">factual_patterns</span><span class="p">):</span>
</span><span id="KnowledgeTools.query_knowledge_base-562"><a href="#KnowledgeTools.query_knowledge_base-562"><span class="linenos">562</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_knowledge_base-563"><a href="#KnowledgeTools.query_knowledge_base-563"><span class="linenos">563</span></a>                        <span class="sa">f</span><span class="s2">&quot;Rejected creative request for knowledge search: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>
</span><span id="KnowledgeTools.query_knowledge_base-564"><a href="#KnowledgeTools.query_knowledge_base-564"><span class="linenos">564</span></a>                    <span class="p">)</span>
</span><span id="KnowledgeTools.query_knowledge_base-565"><a href="#KnowledgeTools.query_knowledge_base-565"><span class="linenos">565</span></a>                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; This appears to be a creative request (&#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;). The knowledge base is for searching existing stored information, not for generating new content. Please rephrase as a search for existing knowledge, or ask me to create content directly without using knowledge tools.&quot;</span>
</span><span id="KnowledgeTools.query_knowledge_base-566"><a href="#KnowledgeTools.query_knowledge_base-566"><span class="linenos">566</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-567"><a href="#KnowledgeTools.query_knowledge_base-567"><span class="linenos">567</span></a>            <span class="c1"># Validate mode</span>
</span><span id="KnowledgeTools.query_knowledge_base-568"><a href="#KnowledgeTools.query_knowledge_base-568"><span class="linenos">568</span></a>            <span class="n">valid_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="s2">&quot;hybrid&quot;</span><span class="p">,</span> <span class="s2">&quot;naive&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools.query_knowledge_base-569"><a href="#KnowledgeTools.query_knowledge_base-569"><span class="linenos">569</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modes</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_knowledge_base-570"><a href="#KnowledgeTools.query_knowledge_base-570"><span class="linenos">570</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
</span><span id="KnowledgeTools.query_knowledge_base-571"><a href="#KnowledgeTools.query_knowledge_base-571"><span class="linenos">571</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-572"><a href="#KnowledgeTools.query_knowledge_base-572"><span class="linenos">572</span></a>            <span class="c1"># Handle None limit</span>
</span><span id="KnowledgeTools.query_knowledge_base-573"><a href="#KnowledgeTools.query_knowledge_base-573"><span class="linenos">573</span></a>            <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_knowledge_base-574"><a href="#KnowledgeTools.query_knowledge_base-574"><span class="linenos">574</span></a>                <span class="n">limit</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="KnowledgeTools.query_knowledge_base-575"><a href="#KnowledgeTools.query_knowledge_base-575"><span class="linenos">575</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-576"><a href="#KnowledgeTools.query_knowledge_base-576"><span class="linenos">576</span></a>            <span class="c1"># Initialize knowledge coordinator if not already done</span>
</span><span id="KnowledgeTools.query_knowledge_base-577"><a href="#KnowledgeTools.query_knowledge_base-577"><span class="linenos">577</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_knowledge_base-578"><a href="#KnowledgeTools.query_knowledge_base-578"><span class="linenos">578</span></a>                <span class="c1"># Use the agno_knowledge passed to the constructor</span>
</span><span id="KnowledgeTools.query_knowledge_base-579"><a href="#KnowledgeTools.query_knowledge_base-579"><span class="linenos">579</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span> <span class="o">=</span> <span class="n">create_knowledge_coordinator</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_knowledge_base-580"><a href="#KnowledgeTools.query_knowledge_base-580"><span class="linenos">580</span></a>                    <span class="n">agno_knowledge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agno_knowledge</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-581"><a href="#KnowledgeTools.query_knowledge_base-581"><span class="linenos">581</span></a>                    <span class="n">lightrag_url</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-582"><a href="#KnowledgeTools.query_knowledge_base-582"><span class="linenos">582</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
</span><span id="KnowledgeTools.query_knowledge_base-583"><a href="#KnowledgeTools.query_knowledge_base-583"><span class="linenos">583</span></a>                <span class="p">)</span>
</span><span id="KnowledgeTools.query_knowledge_base-584"><a href="#KnowledgeTools.query_knowledge_base-584"><span class="linenos">584</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-585"><a href="#KnowledgeTools.query_knowledge_base-585"><span class="linenos">585</span></a>            <span class="c1"># Use the knowledge coordinator for unified querying - now properly async</span>
</span><span id="KnowledgeTools.query_knowledge_base-586"><a href="#KnowledgeTools.query_knowledge_base-586"><span class="linenos">586</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledge_coordinator</span><span class="o">.</span><span class="n">query_knowledge_base</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_knowledge_base-587"><a href="#KnowledgeTools.query_knowledge_base-587"><span class="linenos">587</span></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="KnowledgeTools.query_knowledge_base-588"><a href="#KnowledgeTools.query_knowledge_base-588"><span class="linenos">588</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-589"><a href="#KnowledgeTools.query_knowledge_base-589"><span class="linenos">589</span></a>                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_knowledge_base-590"><a href="#KnowledgeTools.query_knowledge_base-590"><span class="linenos">590</span></a>                <span class="n">response_type</span><span class="o">=</span><span class="s2">&quot;Multiple Paragraphs&quot;</span>
</span><span id="KnowledgeTools.query_knowledge_base-591"><a href="#KnowledgeTools.query_knowledge_base-591"><span class="linenos">591</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools.query_knowledge_base-592"><a href="#KnowledgeTools.query_knowledge_base-592"><span class="linenos">592</span></a>            
</span><span id="KnowledgeTools.query_knowledge_base-593"><a href="#KnowledgeTools.query_knowledge_base-593"><span class="linenos">593</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Knowledge query completed: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.query_knowledge_base-594"><a href="#KnowledgeTools.query_knowledge_base-594"><span class="linenos">594</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="KnowledgeTools.query_knowledge_base-595"><a href="#KnowledgeTools.query_knowledge_base-595"><span class="linenos">595</span></a>
</span><span id="KnowledgeTools.query_knowledge_base-596"><a href="#KnowledgeTools.query_knowledge_base-596"><span class="linenos">596</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_knowledge_base-597"><a href="#KnowledgeTools.query_knowledge_base-597"><span class="linenos">597</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.query_knowledge_base-598"><a href="#KnowledgeTools.query_knowledge_base-598"><span class="linenos">598</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Query the unified knowledge base to retrieve stored factual information and documents.</p>

<p>This tool is for SEARCHING existing knowledge, NOT for creative tasks like writing stories,
generating content, or answering general questions. Use this only when you need to find
specific information that was previously stored in the knowledge base.</p>

<p>Args:
    query: The search query for finding existing knowledge/documents
    mode: Query mode - "local" (semantic), "global" (graph), "hybrid", "mix", "auto"
    limit: Maximum number of results to return (defaults to 5 if None)</p>

<p>Returns:
    Search results from the knowledge base, or rejection message for inappropriate requests.</p>
</div>


                            </div>
                            <div id="KnowledgeTools.query_lightrag_knowledge_direct" class="classattr">
                                        <input id="KnowledgeTools.query_lightrag_knowledge_direct-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">query_lightrag_knowledge_direct</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:9621&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KnowledgeTools.query_lightrag_knowledge_direct-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KnowledgeTools.query_lightrag_knowledge_direct"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KnowledgeTools.query_lightrag_knowledge_direct-600"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-600"><span class="linenos">600</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_lightrag_knowledge_direct</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-601"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-601"><span class="linenos">601</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-602"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-602"><span class="linenos">602</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-603"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-603"><span class="linenos">603</span></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-604"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-604"><span class="linenos">604</span></a>        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span><span class="p">,</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-605"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-605"><span class="linenos">605</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-606"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-606"><span class="linenos">606</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Directly query the LightRAG knowledge base and return the raw response.</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-607"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-607"><span class="linenos">607</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-608"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-608"><span class="linenos">608</span></a><span class="sd">        This method provides direct, unfiltered access to the LightRAG knowledge base,</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-609"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-609"><span class="linenos">609</span></a><span class="sd">        bypassing the intelligent filtering and processing of query_knowledge_base().</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-610"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-610"><span class="linenos">610</span></a><span class="sd">        Use this when you need raw access to the knowledge base with custom parameters.</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-611"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-611"><span class="linenos">611</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-612"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-612"><span class="linenos">612</span></a><span class="sd">        Args:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-613"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-613"><span class="linenos">613</span></a><span class="sd">            query: The query string to search in the knowledge base</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-614"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-614"><span class="linenos">614</span></a><span class="sd">            params: A dictionary of query parameters (mode, response_type, top_k, etc.)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-615"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-615"><span class="linenos">615</span></a><span class="sd">            url: LightRAG server URL (defaults to settings.LIGHTRAG_URL)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-616"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-616"><span class="linenos">616</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-617"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-617"><span class="linenos">617</span></a><span class="sd">        Returns:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-618"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-618"><span class="linenos">618</span></a><span class="sd">            String with query results exactly as LightRAG returns them</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-619"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-619"><span class="linenos">619</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-620"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-621"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-621"><span class="linenos">621</span></a>            <span class="k">return</span> <span class="s2">&quot; Error: Query cannot be empty&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-622"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-622"><span class="linenos">622</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-623"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-623"><span class="linenos">623</span></a>        <span class="c1"># Use default parameters if none provided</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-624"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-625"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-625"><span class="linenos">625</span></a>            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-626"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-626"><span class="linenos">626</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-627"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-627"><span class="linenos">627</span></a>        <span class="c1"># Set up the query parameters with defaults</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-628"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-628"><span class="linenos">628</span></a>        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-629"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-629"><span class="linenos">629</span></a>            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-630"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-630"><span class="linenos">630</span></a>            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">),</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-631"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-631"><span class="linenos">631</span></a>            <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;response_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Multiple Paragraphs&quot;</span><span class="p">),</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-632"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-632"><span class="linenos">632</span></a>            <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top_k&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-633"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-633"><span class="linenos">633</span></a>            <span class="s2">&quot;only_need_context&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;only_need_context&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-634"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-634"><span class="linenos">634</span></a>            <span class="s2">&quot;only_need_prompt&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;only_need_prompt&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-635"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-635"><span class="linenos">635</span></a>            <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stream&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-636"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-636"><span class="linenos">636</span></a>        <span class="p">}</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-637"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-637"><span class="linenos">637</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-638"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-638"><span class="linenos">638</span></a>        <span class="c1"># Add optional parameters if provided</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-639"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-639"><span class="linenos">639</span></a>        <span class="k">if</span> <span class="s2">&quot;max_token_for_text_unit&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-640"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-640"><span class="linenos">640</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;max_token_for_text_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_token_for_text_unit&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-641"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-641"><span class="linenos">641</span></a>        <span class="k">if</span> <span class="s2">&quot;max_token_for_global_context&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-642"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-642"><span class="linenos">642</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;max_token_for_global_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-643"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-643"><span class="linenos">643</span></a>                <span class="s2">&quot;max_token_for_global_context&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-644"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-644"><span class="linenos">644</span></a>            <span class="p">]</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-645"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-645"><span class="linenos">645</span></a>        <span class="k">if</span> <span class="s2">&quot;max_token_for_local_context&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-646"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-646"><span class="linenos">646</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;max_token_for_local_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-647"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-647"><span class="linenos">647</span></a>                <span class="s2">&quot;max_token_for_local_context&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-648"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-648"><span class="linenos">648</span></a>            <span class="p">]</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-649"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-649"><span class="linenos">649</span></a>        <span class="k">if</span> <span class="s2">&quot;conversation_history&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-650"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-650"><span class="linenos">650</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;conversation_history&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;conversation_history&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-651"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="s2">&quot;history_turns&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-652"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-652"><span class="linenos">652</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;history_turns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;history_turns&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-653"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="s2">&quot;ids&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-654"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-654"><span class="linenos">654</span></a>            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-655"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-655"><span class="linenos">655</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-656"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-656"><span class="linenos">656</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-657"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-657"><span class="linenos">657</span></a>            <span class="c1"># Use the correct LightRAG URL and endpoint for RAG queries</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-658"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-658"><span class="linenos">658</span></a>            <span class="n">final_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/query&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-659"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-659"><span class="linenos">659</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-660"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-660"><span class="linenos">660</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-661"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-661"><span class="linenos">661</span></a>                <span class="sa">f</span><span class="s2">&quot;Querying KnowledgeBase at </span><span class="si">{</span><span class="n">final_url</span><span class="si">}</span><span class="s2"> with params: </span><span class="si">{</span><span class="n">query_params</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-662"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-662"><span class="linenos">662</span></a>            <span class="p">)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-663"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-663"><span class="linenos">663</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-664"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-664"><span class="linenos">664</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-665"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-665"><span class="linenos">665</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-666"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-666"><span class="linenos">666</span></a>                    <span class="n">final_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-667"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-667"><span class="linenos">667</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-668"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-668"><span class="linenos">668</span></a>                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-669"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-669"><span class="linenos">669</span></a>                        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-670"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-670"><span class="linenos">670</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-671"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-671"><span class="linenos">671</span></a>                        <span class="c1"># Extract the response content</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-672"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-672"><span class="linenos">672</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-673"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-673"><span class="linenos">673</span></a>                            <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-674"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-674"><span class="linenos">674</span></a>                                <span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-675"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-675"><span class="linenos">675</span></a>                            <span class="p">)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-676"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-676"><span class="linenos">676</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-677"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-677"><span class="linenos">677</span></a>                            <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-678"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-678"><span class="linenos">678</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-679"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-679"><span class="linenos">679</span></a>                        <span class="k">if</span> <span class="n">content</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-680"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-680"><span class="linenos">680</span></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KB direct query successful: </span><span class="si">{</span><span class="n">query</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-681"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-681"><span class="linenos">681</span></a>                            <span class="k">return</span> <span class="n">content</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-682"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-682"><span class="linenos">682</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-683"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-683"><span class="linenos">683</span></a>                            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; No relevant knowledge found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;. Try different keywords or add more knowledge to your base.&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-684"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-684"><span class="linenos">684</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-685"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-685"><span class="linenos">685</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-686"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-686"><span class="linenos">686</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-687"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-687"><span class="linenos">687</span></a>                            <span class="sa">f</span><span class="s2">&quot;KnowledgeBase direct query failed with status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-688"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-688"><span class="linenos">688</span></a>                        <span class="p">)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-689"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-689"><span class="linenos">689</span></a>                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base (status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-690"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-690"><span class="linenos">690</span></a>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-691"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-691"><span class="linenos">691</span></a>        <span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-692"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-692"><span class="linenos">692</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error connecting to KnowledgeBase server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-693"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-693"><span class="linenos">693</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error connecting to knowledge base server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-694"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-694"><span class="linenos">694</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-695"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-695"><span class="linenos">695</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error querying KnowledgeBase knowledge base: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="KnowledgeTools.query_lightrag_knowledge_direct-696"><a href="#KnowledgeTools.query_lightrag_knowledge_direct-696"><span class="linenos">696</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; Error querying knowledge base: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Directly query the LightRAG knowledge base and return the raw response.</p>

<p>This method provides direct, unfiltered access to the LightRAG knowledge base,
bypassing the intelligent filtering and processing of query_knowledge_base().
Use this when you need raw access to the knowledge base with custom parameters.</p>

<p>Args:
    query: The query string to search in the knowledge base
    params: A dictionary of query parameters (mode, response_type, top_k, etc.)
    url: LightRAG server URL (defaults to settings.LIGHTRAG_URL)</p>

<p>Returns:
    String with query results exactly as LightRAG returns them</p>
</div>


                            </div>
                </section>
                <section id="mcp_read_file">
                    <div class="attr variable">
            <span class="name">mcp_read_file</span>        =
<input id="mcp_read_file-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="mcp_read_file-view-value"></label><span class="default_value">StructuredTool(name=&#39;mcp_read_file&#39;, description=&#39;Read file content using MCP filesystem server.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.mcp_read_file&#39;&gt;, func=&lt;function mcp_read_file&gt;)</span>

        
    </div>
    <a class="headerlink" href="#mcp_read_file"></a>
    
    

                </section>
                <section id="mcp_write_file">
                    <div class="attr variable">
            <span class="name">mcp_write_file</span>        =
<input id="mcp_write_file-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="mcp_write_file-view-value"></label><span class="default_value">StructuredTool(name=&#39;mcp_write_file&#39;, description=&#39;Write content to file using MCP filesystem server.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.mcp_write_file&#39;&gt;, func=&lt;function mcp_write_file&gt;)</span>

        
    </div>
    <a class="headerlink" href="#mcp_write_file"></a>
    
    

                </section>
                <section id="mcp_list_directory">
                    <div class="attr variable">
            <span class="name">mcp_list_directory</span>        =
<input id="mcp_list_directory-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="mcp_list_directory-view-value"></label><span class="default_value">StructuredTool(name=&#39;mcp_list_directory&#39;, description=&#39;List directory contents using MCP filesystem server.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.mcp_list_directory&#39;&gt;, func=&lt;function mcp_list_directory&gt;)</span>

        
    </div>
    <a class="headerlink" href="#mcp_list_directory"></a>
    
    

                </section>
                <section id="intelligent_file_search">
                    <div class="attr variable">
            <span class="name">intelligent_file_search</span>        =
<input id="intelligent_file_search-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="intelligent_file_search-view-value"></label><span class="default_value">StructuredTool(name=&#39;intelligent_file_search&#39;, description=&#39;Search for files and enhance results with memory context.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.intelligent_file_search&#39;&gt;, func=&lt;function intelligent_file_search&gt;)</span>

        
    </div>
    <a class="headerlink" href="#intelligent_file_search"></a>
    
    

                </section>
                <section id="create_and_save_file">
                    <div class="attr variable">
            <span class="name">create_and_save_file</span>        =
<input id="create_and_save_file-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="create_and_save_file-view-value"></label><span class="default_value">StructuredTool(name=&#39;create_and_save_file&#39;, description=&#39;Create directories if needed and save file content. This is the preferred tool for creating new files.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.create_and_save_file&#39;&gt;, func=&lt;function create_and_save_file&gt;)</span>

        
    </div>
    <a class="headerlink" href="#create_and_save_file"></a>
    
    

                </section>
                <section id="mcp_github_search">
                    <div class="attr variable">
            <span class="name">mcp_github_search</span>        =
<input id="mcp_github_search-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="mcp_github_search-view-value"></label><span class="default_value">StructuredTool(name=&#39;mcp_github_search&#39;, description=&#39;Search GitHub repositories or specific repo for code, issues, or documentation.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.mcp_github_search&#39;&gt;, func=&lt;function mcp_github_search&gt;)</span>

        
    </div>
    <a class="headerlink" href="#mcp_github_search"></a>
    
    

                </section>
                <section id="mcp_brave_search">
                    <div class="attr variable">
            <span class="name">mcp_brave_search</span>        =
<input id="mcp_brave_search-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="mcp_brave_search-view-value"></label><span class="default_value">StructuredTool(name=&#39;mcp_brave_search&#39;, description=&#39;Search the web using Brave Search for research and technical information.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.mcp_brave_search&#39;&gt;, func=&lt;function mcp_brave_search&gt;)</span>

        
    </div>
    <a class="headerlink" href="#mcp_brave_search"></a>
    
    

                </section>
                <section id="mcp_fetch_url">
                    <div class="attr variable">
            <span class="name">mcp_fetch_url</span>        =
<input id="mcp_fetch_url-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="mcp_fetch_url-view-value"></label><span class="default_value">StructuredTool(name=&#39;mcp_fetch_url&#39;, description=&#39;Fetch content from web URLs using MCP puppeteer server for browser automation.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.mcp_fetch_url&#39;&gt;, func=&lt;function mcp_fetch_url&gt;)</span>

        
    </div>
    <a class="headerlink" href="#mcp_fetch_url"></a>
    
    

                </section>
                <section id="mcp_shell_command">
                    <div class="attr variable">
            <span class="name">mcp_shell_command</span>        =
<input id="mcp_shell_command-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="mcp_shell_command-view-value"></label><span class="default_value">StructuredTool(name=&#39;mcp_shell_command&#39;, description=&#39;Execute shell commands safely using subprocess (MCP shell server unavailable).&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.mcp_shell_command&#39;&gt;, func=&lt;function mcp_shell_command&gt;)</span>

        
    </div>
    <a class="headerlink" href="#mcp_shell_command"></a>
    
    

                </section>
                <section id="comprehensive_research">
                    <div class="attr variable">
            <span class="name">comprehensive_research</span>        =
<input id="comprehensive_research-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="comprehensive_research-view-value"></label><span class="default_value">StructuredTool(name=&#39;comprehensive_research&#39;, description=&#39;Perform comprehensive research combining memory, web search, GitHub, and file operations.&#39;, args_schema=&lt;class &#39;langchain_core.utils.pydantic.comprehensive_research&#39;&gt;, func=&lt;function comprehensive_research&gt;)</span>

        
    </div>
    <a class="headerlink" href="#comprehensive_research"></a>
    
    

                </section>
                <section id="LightRAGDocumentManager">
                            <input id="LightRAGDocumentManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LightRAGDocumentManager</span>:

                <label class="view-source-button" for="LightRAGDocumentManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager-35"><a href="#LightRAGDocumentManager-35"><span class="linenos"> 35</span></a><span class="k">class</span><span class="w"> </span><span class="nc">LightRAGDocumentManager</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-36"><a href="#LightRAGDocumentManager-36"><span class="linenos"> 36</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages documents in LightRAG using the server API.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-37"><a href="#LightRAGDocumentManager-37"><span class="linenos"> 37</span></a>
</span><span id="LightRAGDocumentManager-38"><a href="#LightRAGDocumentManager-38"><span class="linenos"> 38</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager-39"><a href="#LightRAGDocumentManager-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="n">server_url</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="LightRAGDocumentManager-40"><a href="#LightRAGDocumentManager-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_STORAGE_DIR</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-41"><a href="#LightRAGDocumentManager-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="s2">&quot;rag_storage&quot;</span> <span class="o">/</span> <span class="s2">&quot;kv_store_doc_status.json&quot;</span>
</span><span id="LightRAGDocumentManager-42"><a href="#LightRAGDocumentManager-42"><span class="linenos"> 42</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Using LightRAG server URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-43"><a href="#LightRAGDocumentManager-43"><span class="linenos"> 43</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Using storage path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-44"><a href="#LightRAGDocumentManager-44"><span class="linenos"> 44</span></a>
</span><span id="LightRAGDocumentManager-45"><a href="#LightRAGDocumentManager-45"><span class="linenos"> 45</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_server_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-46"><a href="#LightRAGDocumentManager-46"><span class="linenos"> 46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if LightRAG server is running.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-47"><a href="#LightRAGDocumentManager-47"><span class="linenos"> 47</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-48"><a href="#LightRAGDocumentManager-48"><span class="linenos"> 48</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-49"><a href="#LightRAGDocumentManager-49"><span class="linenos"> 49</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/health&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-50"><a href="#LightRAGDocumentManager-50"><span class="linenos"> 50</span></a>                    <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
</span><span id="LightRAGDocumentManager-51"><a href="#LightRAGDocumentManager-51"><span class="linenos"> 51</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-52"><a href="#LightRAGDocumentManager-52"><span class="linenos"> 52</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Cannot connect to LightRAG server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-53"><a href="#LightRAGDocumentManager-53"><span class="linenos"> 53</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="LightRAGDocumentManager-54"><a href="#LightRAGDocumentManager-54"><span class="linenos"> 54</span></a>
</span><span id="LightRAGDocumentManager-55"><a href="#LightRAGDocumentManager-55"><span class="linenos"> 55</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-56"><a href="#LightRAGDocumentManager-56"><span class="linenos"> 56</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check server connectivity.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-57"><a href="#LightRAGDocumentManager-57"><span class="linenos"> 57</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_server_status</span><span class="p">():</span>
</span><span id="LightRAGDocumentManager-58"><a href="#LightRAGDocumentManager-58"><span class="linenos"> 58</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; LightRAG server not accessible at: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-59"><a href="#LightRAGDocumentManager-59"><span class="linenos"> 59</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Please ensure the LightRAG server is running.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-60"><a href="#LightRAGDocumentManager-60"><span class="linenos"> 60</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="LightRAGDocumentManager-61"><a href="#LightRAGDocumentManager-61"><span class="linenos"> 61</span></a>        
</span><span id="LightRAGDocumentManager-62"><a href="#LightRAGDocumentManager-62"><span class="linenos"> 62</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; LightRAG server is accessible.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-63"><a href="#LightRAGDocumentManager-63"><span class="linenos"> 63</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="LightRAGDocumentManager-64"><a href="#LightRAGDocumentManager-64"><span class="linenos"> 64</span></a>
</span><span id="LightRAGDocumentManager-65"><a href="#LightRAGDocumentManager-65"><span class="linenos"> 65</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="LightRAGDocumentManager-66"><a href="#LightRAGDocumentManager-66"><span class="linenos"> 66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetches all documents from the LightRAG server.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-67"><a href="#LightRAGDocumentManager-67"><span class="linenos"> 67</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-68"><a href="#LightRAGDocumentManager-68"><span class="linenos"> 68</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-69"><a href="#LightRAGDocumentManager-69"><span class="linenos"> 69</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-70"><a href="#LightRAGDocumentManager-70"><span class="linenos"> 70</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-71"><a href="#LightRAGDocumentManager-71"><span class="linenos"> 71</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager-72"><a href="#LightRAGDocumentManager-72"><span class="linenos"> 72</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Server error </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-73"><a href="#LightRAGDocumentManager-73"><span class="linenos"> 73</span></a>                        <span class="k">return</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager-74"><a href="#LightRAGDocumentManager-74"><span class="linenos"> 74</span></a>                    
</span><span id="LightRAGDocumentManager-75"><a href="#LightRAGDocumentManager-75"><span class="linenos"> 75</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager-76"><a href="#LightRAGDocumentManager-76"><span class="linenos"> 76</span></a>                    <span class="n">all_docs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager-77"><a href="#LightRAGDocumentManager-77"><span class="linenos"> 77</span></a>                    
</span><span id="LightRAGDocumentManager-78"><a href="#LightRAGDocumentManager-78"><span class="linenos"> 78</span></a>                    <span class="c1"># The API returns documents grouped by status in a &quot;statuses&quot; dict</span>
</span><span id="LightRAGDocumentManager-79"><a href="#LightRAGDocumentManager-79"><span class="linenos"> 79</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;statuses&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-80"><a href="#LightRAGDocumentManager-80"><span class="linenos"> 80</span></a>                        <span class="n">statuses</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;statuses&quot;</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager-81"><a href="#LightRAGDocumentManager-81"><span class="linenos"> 81</span></a>                        <span class="c1"># Iterate through all status categories (processed, failed, etc.)</span>
</span><span id="LightRAGDocumentManager-82"><a href="#LightRAGDocumentManager-82"><span class="linenos"> 82</span></a>                        <span class="k">for</span> <span class="n">status_name</span><span class="p">,</span> <span class="n">docs_list</span> <span class="ow">in</span> <span class="n">statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LightRAGDocumentManager-83"><a href="#LightRAGDocumentManager-83"><span class="linenos"> 83</span></a>                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager-84"><a href="#LightRAGDocumentManager-84"><span class="linenos"> 84</span></a>                                <span class="n">all_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs_list</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-85"><a href="#LightRAGDocumentManager-85"><span class="linenos"> 85</span></a>                        <span class="k">return</span> <span class="n">all_docs</span>
</span><span id="LightRAGDocumentManager-86"><a href="#LightRAGDocumentManager-86"><span class="linenos"> 86</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;documents&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-87"><a href="#LightRAGDocumentManager-87"><span class="linenos"> 87</span></a>                        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager-88"><a href="#LightRAGDocumentManager-88"><span class="linenos"> 88</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager-89"><a href="#LightRAGDocumentManager-89"><span class="linenos"> 89</span></a>                        <span class="k">return</span> <span class="n">data</span>
</span><span id="LightRAGDocumentManager-90"><a href="#LightRAGDocumentManager-90"><span class="linenos"> 90</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-91"><a href="#LightRAGDocumentManager-91"><span class="linenos"> 91</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Unexpected response format: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-92"><a href="#LightRAGDocumentManager-92"><span class="linenos"> 92</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response keys: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not a dict&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-93"><a href="#LightRAGDocumentManager-93"><span class="linenos"> 93</span></a>                        <span class="k">return</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager-94"><a href="#LightRAGDocumentManager-94"><span class="linenos"> 94</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-95"><a href="#LightRAGDocumentManager-95"><span class="linenos"> 95</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Error fetching documents: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-96"><a href="#LightRAGDocumentManager-96"><span class="linenos"> 96</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager-97"><a href="#LightRAGDocumentManager-97"><span class="linenos"> 97</span></a>
</span><span id="LightRAGDocumentManager-98"><a href="#LightRAGDocumentManager-98"><span class="linenos"> 98</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_documents</span><span class="p">(</span>
</span><span id="LightRAGDocumentManager-99"><a href="#LightRAGDocumentManager-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">docs_to_delete</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">delete_source</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="LightRAGDocumentManager-100"><a href="#LightRAGDocumentManager-100"><span class="linenos">100</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="LightRAGDocumentManager-101"><a href="#LightRAGDocumentManager-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes a list of documents using the server API.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-102"><a href="#LightRAGDocumentManager-102"><span class="linenos">102</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager-103"><a href="#LightRAGDocumentManager-103"><span class="linenos">103</span></a>            <span class="s2">&quot;total_requested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs_to_delete</span><span class="p">),</span>
</span><span id="LightRAGDocumentManager-104"><a href="#LightRAGDocumentManager-104"><span class="linenos">104</span></a>            <span class="s2">&quot;deleted_successfully&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-105"><a href="#LightRAGDocumentManager-105"><span class="linenos">105</span></a>            <span class="s2">&quot;source_files_deleted&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-106"><a href="#LightRAGDocumentManager-106"><span class="linenos">106</span></a>            <span class="s2">&quot;not_found&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-107"><a href="#LightRAGDocumentManager-107"><span class="linenos">107</span></a>            <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="LightRAGDocumentManager-108"><a href="#LightRAGDocumentManager-108"><span class="linenos">108</span></a>        <span class="p">}</span>
</span><span id="LightRAGDocumentManager-109"><a href="#LightRAGDocumentManager-109"><span class="linenos">109</span></a>
</span><span id="LightRAGDocumentManager-110"><a href="#LightRAGDocumentManager-110"><span class="linenos">110</span></a>        <span class="c1"># Phase 1: Delete source files if requested</span>
</span><span id="LightRAGDocumentManager-111"><a href="#LightRAGDocumentManager-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">delete_source</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-112"><a href="#LightRAGDocumentManager-112"><span class="linenos">112</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 1: Deleting source files&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-113"><a href="#LightRAGDocumentManager-113"><span class="linenos">113</span></a>            <span class="k">for</span> <span class="n">doc_info</span> <span class="ow">in</span> <span class="n">docs_to_delete</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-114"><a href="#LightRAGDocumentManager-114"><span class="linenos">114</span></a>                <span class="n">source_path</span> <span class="o">=</span> <span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-115"><a href="#LightRAGDocumentManager-115"><span class="linenos">115</span></a>                <span class="k">if</span> <span class="n">source_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source_path</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager-116"><a href="#LightRAGDocumentManager-116"><span class="linenos">116</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-117"><a href="#LightRAGDocumentManager-117"><span class="linenos">117</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-118"><a href="#LightRAGDocumentManager-118"><span class="linenos">118</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Deleted source file: </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-119"><a href="#LightRAGDocumentManager-119"><span class="linenos">119</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;source_files_deleted&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager-120"><a href="#LightRAGDocumentManager-120"><span class="linenos">120</span></a>                    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-121"><a href="#LightRAGDocumentManager-121"><span class="linenos">121</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to delete source file </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-122"><a href="#LightRAGDocumentManager-122"><span class="linenos">122</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-123"><a href="#LightRAGDocumentManager-123"><span class="linenos">123</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-124"><a href="#LightRAGDocumentManager-124"><span class="linenos">124</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-125"><a href="#LightRAGDocumentManager-125"><span class="linenos">125</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Source file not found, skipping: </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-126"><a href="#LightRAGDocumentManager-126"><span class="linenos">126</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Source file deletion complete.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-127"><a href="#LightRAGDocumentManager-127"><span class="linenos">127</span></a>
</span><span id="LightRAGDocumentManager-128"><a href="#LightRAGDocumentManager-128"><span class="linenos">128</span></a>        <span class="c1"># Phase 2: Delete documents from LightRAG server</span>
</span><span id="LightRAGDocumentManager-129"><a href="#LightRAGDocumentManager-129"><span class="linenos">129</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 2: Deleting documents from LightRAG server&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-130"><a href="#LightRAGDocumentManager-130"><span class="linenos">130</span></a>        <span class="k">if</span> <span class="n">docs_to_delete</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-131"><a href="#LightRAGDocumentManager-131"><span class="linenos">131</span></a>            <span class="c1"># Collect all document IDs for batch deletion</span>
</span><span id="LightRAGDocumentManager-132"><a href="#LightRAGDocumentManager-132"><span class="linenos">132</span></a>            <span class="n">doc_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc_info</span> <span class="ow">in</span> <span class="n">docs_to_delete</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager-133"><a href="#LightRAGDocumentManager-133"><span class="linenos">133</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Deleting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents in batch...&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-134"><a href="#LightRAGDocumentManager-134"><span class="linenos">134</span></a>            
</span><span id="LightRAGDocumentManager-135"><a href="#LightRAGDocumentManager-135"><span class="linenos">135</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-136"><a href="#LightRAGDocumentManager-136"><span class="linenos">136</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-137"><a href="#LightRAGDocumentManager-137"><span class="linenos">137</span></a>                    <span class="c1"># Use the DELETE /documents/delete_document endpoint with proper format</span>
</span><span id="LightRAGDocumentManager-138"><a href="#LightRAGDocumentManager-138"><span class="linenos">138</span></a>                    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager-139"><a href="#LightRAGDocumentManager-139"><span class="linenos">139</span></a>                        <span class="s2">&quot;doc_ids&quot;</span><span class="p">:</span> <span class="n">doc_ids</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-140"><a href="#LightRAGDocumentManager-140"><span class="linenos">140</span></a>                        <span class="s2">&quot;delete_file&quot;</span><span class="p">:</span> <span class="n">delete_source</span>
</span><span id="LightRAGDocumentManager-141"><a href="#LightRAGDocumentManager-141"><span class="linenos">141</span></a>                    <span class="p">}</span>
</span><span id="LightRAGDocumentManager-142"><a href="#LightRAGDocumentManager-142"><span class="linenos">142</span></a>                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="LightRAGDocumentManager-143"><a href="#LightRAGDocumentManager-143"><span class="linenos">143</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents/delete_document&quot;</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-144"><a href="#LightRAGDocumentManager-144"><span class="linenos">144</span></a>                        <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-145"><a href="#LightRAGDocumentManager-145"><span class="linenos">145</span></a>                        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>  <span class="c1"># Longer timeout for batch operations</span>
</span><span id="LightRAGDocumentManager-146"><a href="#LightRAGDocumentManager-146"><span class="linenos">146</span></a>                    <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-147"><a href="#LightRAGDocumentManager-147"><span class="linenos">147</span></a>                        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-148"><a href="#LightRAGDocumentManager-148"><span class="linenos">148</span></a>                            <span class="n">result_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager-149"><a href="#LightRAGDocumentManager-149"><span class="linenos">149</span></a>                            <span class="n">status</span> <span class="o">=</span> <span class="n">result_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-150"><a href="#LightRAGDocumentManager-150"><span class="linenos">150</span></a>                            <span class="n">message</span> <span class="o">=</span> <span class="n">result_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;No message&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-151"><a href="#LightRAGDocumentManager-151"><span class="linenos">151</span></a>                            
</span><span id="LightRAGDocumentManager-152"><a href="#LightRAGDocumentManager-152"><span class="linenos">152</span></a>                            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;deletion_started&quot;</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-153"><a href="#LightRAGDocumentManager-153"><span class="linenos">153</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Success: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-154"><a href="#LightRAGDocumentManager-154"><span class="linenos">154</span></a>                                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;deleted_successfully&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-155"><a href="#LightRAGDocumentManager-155"><span class="linenos">155</span></a>                            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;busy&quot;</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-156"><a href="#LightRAGDocumentManager-156"><span class="linenos">156</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Server Busy: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-157"><a href="#LightRAGDocumentManager-157"><span class="linenos">157</span></a>                                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server busy: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-158"><a href="#LightRAGDocumentManager-158"><span class="linenos">158</span></a>                            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;not_allowed&quot;</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-159"><a href="#LightRAGDocumentManager-159"><span class="linenos">159</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Not Allowed: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-160"><a href="#LightRAGDocumentManager-160"><span class="linenos">160</span></a>                                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not allowed: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-161"><a href="#LightRAGDocumentManager-161"><span class="linenos">161</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-162"><a href="#LightRAGDocumentManager-162"><span class="linenos">162</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Unknown Status &#39;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-163"><a href="#LightRAGDocumentManager-163"><span class="linenos">163</span></a>                                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown status: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-164"><a href="#LightRAGDocumentManager-164"><span class="linenos">164</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-165"><a href="#LightRAGDocumentManager-165"><span class="linenos">165</span></a>                            <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager-166"><a href="#LightRAGDocumentManager-166"><span class="linenos">166</span></a>                            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Server error </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-167"><a href="#LightRAGDocumentManager-167"><span class="linenos">167</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-168"><a href="#LightRAGDocumentManager-168"><span class="linenos">168</span></a>                            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-169"><a href="#LightRAGDocumentManager-169"><span class="linenos">169</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-170"><a href="#LightRAGDocumentManager-170"><span class="linenos">170</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An exception occurred during batch deletion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-171"><a href="#LightRAGDocumentManager-171"><span class="linenos">171</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-172"><a href="#LightRAGDocumentManager-172"><span class="linenos">172</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-173"><a href="#LightRAGDocumentManager-173"><span class="linenos">173</span></a>
</span><span id="LightRAGDocumentManager-174"><a href="#LightRAGDocumentManager-174"><span class="linenos">174</span></a>        <span class="c1"># Phase 3: Clear cache using the server API</span>
</span><span id="LightRAGDocumentManager-175"><a href="#LightRAGDocumentManager-175"><span class="linenos">175</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 3: Clearing server cache&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-176"><a href="#LightRAGDocumentManager-176"><span class="linenos">176</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-177"><a href="#LightRAGDocumentManager-177"><span class="linenos">177</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-178"><a href="#LightRAGDocumentManager-178"><span class="linenos">178</span></a>                <span class="c1"># Clear all cache modes</span>
</span><span id="LightRAGDocumentManager-179"><a href="#LightRAGDocumentManager-179"><span class="linenos">179</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># None clears all cache</span>
</span><span id="LightRAGDocumentManager-180"><a href="#LightRAGDocumentManager-180"><span class="linenos">180</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="LightRAGDocumentManager-181"><a href="#LightRAGDocumentManager-181"><span class="linenos">181</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents/clear_cache&quot;</span><span class="p">,</span> 
</span><span id="LightRAGDocumentManager-182"><a href="#LightRAGDocumentManager-182"><span class="linenos">182</span></a>                    <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-183"><a href="#LightRAGDocumentManager-183"><span class="linenos">183</span></a>                    <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span>
</span><span id="LightRAGDocumentManager-184"><a href="#LightRAGDocumentManager-184"><span class="linenos">184</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-185"><a href="#LightRAGDocumentManager-185"><span class="linenos">185</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-186"><a href="#LightRAGDocumentManager-186"><span class="linenos">186</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Server cache cleared successfully&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-187"><a href="#LightRAGDocumentManager-187"><span class="linenos">187</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-188"><a href="#LightRAGDocumentManager-188"><span class="linenos">188</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager-189"><a href="#LightRAGDocumentManager-189"><span class="linenos">189</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to clear server cache: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-190"><a href="#LightRAGDocumentManager-190"><span class="linenos">190</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-191"><a href="#LightRAGDocumentManager-191"><span class="linenos">191</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-192"><a href="#LightRAGDocumentManager-192"><span class="linenos">192</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-193"><a href="#LightRAGDocumentManager-193"><span class="linenos">193</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to clear server cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-194"><a href="#LightRAGDocumentManager-194"><span class="linenos">194</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-195"><a href="#LightRAGDocumentManager-195"><span class="linenos">195</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-196"><a href="#LightRAGDocumentManager-196"><span class="linenos">196</span></a>
</span><span id="LightRAGDocumentManager-197"><a href="#LightRAGDocumentManager-197"><span class="linenos">197</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; LightRAG server deletion complete.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-198"><a href="#LightRAGDocumentManager-198"><span class="linenos">198</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="LightRAGDocumentManager-199"><a href="#LightRAGDocumentManager-199"><span class="linenos">199</span></a>
</span><span id="LightRAGDocumentManager-200"><a href="#LightRAGDocumentManager-200"><span class="linenos">200</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">retry_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="LightRAGDocumentManager-201"><a href="#LightRAGDocumentManager-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retries failed documents by deleting their server entry and triggering a new scan.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-202"><a href="#LightRAGDocumentManager-202"><span class="linenos">202</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager-203"><a href="#LightRAGDocumentManager-203"><span class="linenos">203</span></a>            <span class="s2">&quot;total_requested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">),</span>
</span><span id="LightRAGDocumentManager-204"><a href="#LightRAGDocumentManager-204"><span class="linenos">204</span></a>            <span class="s2">&quot;retried_successfully&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-205"><a href="#LightRAGDocumentManager-205"><span class="linenos">205</span></a>            <span class="s2">&quot;not_found&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-206"><a href="#LightRAGDocumentManager-206"><span class="linenos">206</span></a>            <span class="s2">&quot;not_failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-207"><a href="#LightRAGDocumentManager-207"><span class="linenos">207</span></a>            <span class="s2">&quot;source_file_missing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-208"><a href="#LightRAGDocumentManager-208"><span class="linenos">208</span></a>            <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="LightRAGDocumentManager-209"><a href="#LightRAGDocumentManager-209"><span class="linenos">209</span></a>        <span class="p">}</span>
</span><span id="LightRAGDocumentManager-210"><a href="#LightRAGDocumentManager-210"><span class="linenos">210</span></a>
</span><span id="LightRAGDocumentManager-211"><a href="#LightRAGDocumentManager-211"><span class="linenos">211</span></a>        <span class="n">docs_to_retry</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager-212"><a href="#LightRAGDocumentManager-212"><span class="linenos">212</span></a>        <span class="n">docs_by_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span> <span class="n">doc</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">}</span>
</span><span id="LightRAGDocumentManager-213"><a href="#LightRAGDocumentManager-213"><span class="linenos">213</span></a>
</span><span id="LightRAGDocumentManager-214"><a href="#LightRAGDocumentManager-214"><span class="linenos">214</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Phase 1: Identifying documents to retry&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-215"><a href="#LightRAGDocumentManager-215"><span class="linenos">215</span></a>        <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">doc_ids</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-216"><a href="#LightRAGDocumentManager-216"><span class="linenos">216</span></a>            <span class="k">if</span> <span class="n">doc_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">docs_by_id</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-217"><a href="#LightRAGDocumentManager-217"><span class="linenos">217</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Document &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39; not found on server. Skipping.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-218"><a href="#LightRAGDocumentManager-218"><span class="linenos">218</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;not_found&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager-219"><a href="#LightRAGDocumentManager-219"><span class="linenos">219</span></a>                <span class="k">continue</span>
</span><span id="LightRAGDocumentManager-220"><a href="#LightRAGDocumentManager-220"><span class="linenos">220</span></a>
</span><span id="LightRAGDocumentManager-221"><a href="#LightRAGDocumentManager-221"><span class="linenos">221</span></a>            <span class="n">doc_info</span> <span class="o">=</span> <span class="n">docs_by_id</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager-222"><a href="#LightRAGDocumentManager-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-223"><a href="#LightRAGDocumentManager-223"><span class="linenos">223</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Document &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39; is not in &#39;failed&#39; state (status: </span><span class="si">{</span><span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">). Skipping.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-224"><a href="#LightRAGDocumentManager-224"><span class="linenos">224</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;not_failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager-225"><a href="#LightRAGDocumentManager-225"><span class="linenos">225</span></a>                <span class="k">continue</span>
</span><span id="LightRAGDocumentManager-226"><a href="#LightRAGDocumentManager-226"><span class="linenos">226</span></a>            
</span><span id="LightRAGDocumentManager-227"><a href="#LightRAGDocumentManager-227"><span class="linenos">227</span></a>            <span class="n">source_path_relative</span> <span class="o">=</span> <span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-228"><a href="#LightRAGDocumentManager-228"><span class="linenos">228</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">source_path_relative</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-229"><a href="#LightRAGDocumentManager-229"><span class="linenos">229</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Source file path is missing for doc &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39;. Cannot retry.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-230"><a href="#LightRAGDocumentManager-230"><span class="linenos">230</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;source_file_missing&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager-231"><a href="#LightRAGDocumentManager-231"><span class="linenos">231</span></a>                <span class="k">continue</span>
</span><span id="LightRAGDocumentManager-232"><a href="#LightRAGDocumentManager-232"><span class="linenos">232</span></a>
</span><span id="LightRAGDocumentManager-233"><a href="#LightRAGDocumentManager-233"><span class="linenos">233</span></a>            <span class="c1"># The file_path from the server is relative. We construct the full path</span>
</span><span id="LightRAGDocumentManager-234"><a href="#LightRAGDocumentManager-234"><span class="linenos">234</span></a>            <span class="c1"># by assuming it&#39;s within an &#39;inputs&#39; directory inside the main storage path.</span>
</span><span id="LightRAGDocumentManager-235"><a href="#LightRAGDocumentManager-235"><span class="linenos">235</span></a>            <span class="n">full_source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="s2">&quot;inputs&quot;</span> <span class="o">/</span> <span class="n">source_path_relative</span>
</span><span id="LightRAGDocumentManager-236"><a href="#LightRAGDocumentManager-236"><span class="linenos">236</span></a>            
</span><span id="LightRAGDocumentManager-237"><a href="#LightRAGDocumentManager-237"><span class="linenos">237</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     (Checking for source file at: </span><span class="si">{</span><span class="n">full_source_path</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-238"><a href="#LightRAGDocumentManager-238"><span class="linenos">238</span></a>
</span><span id="LightRAGDocumentManager-239"><a href="#LightRAGDocumentManager-239"><span class="linenos">239</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">full_source_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="LightRAGDocumentManager-240"><a href="#LightRAGDocumentManager-240"><span class="linenos">240</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Source file for doc &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-241"><a href="#LightRAGDocumentManager-241"><span class="linenos">241</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;source_file_missing&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager-242"><a href="#LightRAGDocumentManager-242"><span class="linenos">242</span></a>                <span class="k">continue</span>
</span><span id="LightRAGDocumentManager-243"><a href="#LightRAGDocumentManager-243"><span class="linenos">243</span></a>            
</span><span id="LightRAGDocumentManager-244"><a href="#LightRAGDocumentManager-244"><span class="linenos">244</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Document &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">source_path_relative</span><span class="si">}</span><span class="s2">) is eligible for retry.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-245"><a href="#LightRAGDocumentManager-245"><span class="linenos">245</span></a>            <span class="n">docs_to_retry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_info</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-246"><a href="#LightRAGDocumentManager-246"><span class="linenos">246</span></a>
</span><span id="LightRAGDocumentManager-247"><a href="#LightRAGDocumentManager-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">docs_to_retry</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-248"><a href="#LightRAGDocumentManager-248"><span class="linenos">248</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No valid documents to retry.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-249"><a href="#LightRAGDocumentManager-249"><span class="linenos">249</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="LightRAGDocumentManager-250"><a href="#LightRAGDocumentManager-250"><span class="linenos">250</span></a>
</span><span id="LightRAGDocumentManager-251"><a href="#LightRAGDocumentManager-251"><span class="linenos">251</span></a>        <span class="c1"># Phase 2: Delete the failed document entries from LightRAG, one by one.</span>
</span><span id="LightRAGDocumentManager-252"><a href="#LightRAGDocumentManager-252"><span class="linenos">252</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 2: Deleting failed document entries from LightRAG (one by one)&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-253"><a href="#LightRAGDocumentManager-253"><span class="linenos">253</span></a>        <span class="n">deleted_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LightRAGDocumentManager-254"><a href="#LightRAGDocumentManager-254"><span class="linenos">254</span></a>        <span class="k">for</span> <span class="n">doc_info</span> <span class="ow">in</span> <span class="n">docs_to_retry</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-255"><a href="#LightRAGDocumentManager-255"><span class="linenos">255</span></a>            <span class="n">doc_id</span> <span class="o">=</span> <span class="n">doc_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager-256"><a href="#LightRAGDocumentManager-256"><span class="linenos">256</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Deleting document: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_path&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-257"><a href="#LightRAGDocumentManager-257"><span class="linenos">257</span></a>            <span class="n">delete_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;doc_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">doc_id</span><span class="p">]}</span>
</span><span id="LightRAGDocumentManager-258"><a href="#LightRAGDocumentManager-258"><span class="linenos">258</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-259"><a href="#LightRAGDocumentManager-259"><span class="linenos">259</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-260"><a href="#LightRAGDocumentManager-260"><span class="linenos">260</span></a>                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="LightRAGDocumentManager-261"><a href="#LightRAGDocumentManager-261"><span class="linenos">261</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents/delete_document&quot;</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-262"><a href="#LightRAGDocumentManager-262"><span class="linenos">262</span></a>                        <span class="n">json</span><span class="o">=</span><span class="n">delete_payload</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-263"><a href="#LightRAGDocumentManager-263"><span class="linenos">263</span></a>                        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="LightRAGDocumentManager-264"><a href="#LightRAGDocumentManager-264"><span class="linenos">264</span></a>                    <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-265"><a href="#LightRAGDocumentManager-265"><span class="linenos">265</span></a>                        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-266"><a href="#LightRAGDocumentManager-266"><span class="linenos">266</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      Successfully deleted.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-267"><a href="#LightRAGDocumentManager-267"><span class="linenos">267</span></a>                            <span class="n">deleted_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager-268"><a href="#LightRAGDocumentManager-268"><span class="linenos">268</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Waiting 1 second...&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-269"><a href="#LightRAGDocumentManager-269"><span class="linenos">269</span></a>                            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Delay after each deletion</span>
</span><span id="LightRAGDocumentManager-270"><a href="#LightRAGDocumentManager-270"><span class="linenos">270</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-271"><a href="#LightRAGDocumentManager-271"><span class="linenos">271</span></a>                            <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager-272"><a href="#LightRAGDocumentManager-272"><span class="linenos">272</span></a>                            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Server error during deletion of </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-273"><a href="#LightRAGDocumentManager-273"><span class="linenos">273</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-274"><a href="#LightRAGDocumentManager-274"><span class="linenos">274</span></a>                            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-275"><a href="#LightRAGDocumentManager-275"><span class="linenos">275</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-276"><a href="#LightRAGDocumentManager-276"><span class="linenos">276</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An exception occurred during deletion of </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-277"><a href="#LightRAGDocumentManager-277"><span class="linenos">277</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-278"><a href="#LightRAGDocumentManager-278"><span class="linenos">278</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-279"><a href="#LightRAGDocumentManager-279"><span class="linenos">279</span></a>        
</span><span id="LightRAGDocumentManager-280"><a href="#LightRAGDocumentManager-280"><span class="linenos">280</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Deletion phase complete. Successfully deleted </span><span class="si">{</span><span class="n">deleted_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs_to_retry</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-281"><a href="#LightRAGDocumentManager-281"><span class="linenos">281</span></a>
</span><span id="LightRAGDocumentManager-282"><a href="#LightRAGDocumentManager-282"><span class="linenos">282</span></a>        <span class="c1"># Add a delay to give the server time to process the deletions before scanning.</span>
</span><span id="LightRAGDocumentManager-283"><a href="#LightRAGDocumentManager-283"><span class="linenos">283</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Waiting 5 seconds for server to process deletions...&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-284"><a href="#LightRAGDocumentManager-284"><span class="linenos">284</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-285"><a href="#LightRAGDocumentManager-285"><span class="linenos">285</span></a>
</span><span id="LightRAGDocumentManager-286"><a href="#LightRAGDocumentManager-286"><span class="linenos">286</span></a>        <span class="c1"># Phase 3: Trigger a server-side scan to re-discover and process the files</span>
</span><span id="LightRAGDocumentManager-287"><a href="#LightRAGDocumentManager-287"><span class="linenos">287</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 3: Triggering server scan to re-process files&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-288"><a href="#LightRAGDocumentManager-288"><span class="linenos">288</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-289"><a href="#LightRAGDocumentManager-289"><span class="linenos">289</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-290"><a href="#LightRAGDocumentManager-290"><span class="linenos">290</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents/scan&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-291"><a href="#LightRAGDocumentManager-291"><span class="linenos">291</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-292"><a href="#LightRAGDocumentManager-292"><span class="linenos">292</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Server scan initiated successfully.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-293"><a href="#LightRAGDocumentManager-293"><span class="linenos">293</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Documents will be re-processed in the background.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-294"><a href="#LightRAGDocumentManager-294"><span class="linenos">294</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;retried_successfully&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs_to_retry</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-295"><a href="#LightRAGDocumentManager-295"><span class="linenos">295</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-296"><a href="#LightRAGDocumentManager-296"><span class="linenos">296</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager-297"><a href="#LightRAGDocumentManager-297"><span class="linenos">297</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to trigger server scan: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-298"><a href="#LightRAGDocumentManager-298"><span class="linenos">298</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-299"><a href="#LightRAGDocumentManager-299"><span class="linenos">299</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-300"><a href="#LightRAGDocumentManager-300"><span class="linenos">300</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-301"><a href="#LightRAGDocumentManager-301"><span class="linenos">301</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An exception occurred while triggering scan: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager-302"><a href="#LightRAGDocumentManager-302"><span class="linenos">302</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-303"><a href="#LightRAGDocumentManager-303"><span class="linenos">303</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-304"><a href="#LightRAGDocumentManager-304"><span class="linenos">304</span></a>
</span><span id="LightRAGDocumentManager-305"><a href="#LightRAGDocumentManager-305"><span class="linenos">305</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="LightRAGDocumentManager-306"><a href="#LightRAGDocumentManager-306"><span class="linenos">306</span></a>
</span><span id="LightRAGDocumentManager-307"><a href="#LightRAGDocumentManager-307"><span class="linenos">307</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager-308"><a href="#LightRAGDocumentManager-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;No cleanup needed for API-based approach.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-309"><a href="#LightRAGDocumentManager-309"><span class="linenos">309</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Document manager finalized.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-310"><a href="#LightRAGDocumentManager-310"><span class="linenos">310</span></a>
</span><span id="LightRAGDocumentManager-311"><a href="#LightRAGDocumentManager-311"><span class="linenos">311</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_status_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="LightRAGDocumentManager-312"><a href="#LightRAGDocumentManager-312"><span class="linenos">312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a summary of document statuses.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-313"><a href="#LightRAGDocumentManager-313"><span class="linenos">313</span></a>        <span class="n">status_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LightRAGDocumentManager-314"><a href="#LightRAGDocumentManager-314"><span class="linenos">314</span></a>        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager-315"><a href="#LightRAGDocumentManager-315"><span class="linenos">315</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-316"><a href="#LightRAGDocumentManager-316"><span class="linenos">316</span></a>            <span class="n">status_counts</span><span class="p">[</span><span class="n">status</span><span class="p">]</span> <span class="o">=</span> <span class="n">status_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager-317"><a href="#LightRAGDocumentManager-317"><span class="linenos">317</span></a>        
</span><span id="LightRAGDocumentManager-318"><a href="#LightRAGDocumentManager-318"><span class="linenos">318</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager-319"><a href="#LightRAGDocumentManager-319"><span class="linenos">319</span></a>            <span class="s2">&quot;total_documents&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_docs</span><span class="p">),</span>
</span><span id="LightRAGDocumentManager-320"><a href="#LightRAGDocumentManager-320"><span class="linenos">320</span></a>            <span class="s2">&quot;status_breakdown&quot;</span><span class="p">:</span> <span class="n">status_counts</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-321"><a href="#LightRAGDocumentManager-321"><span class="linenos">321</span></a>            <span class="s2">&quot;server_url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-322"><a href="#LightRAGDocumentManager-322"><span class="linenos">322</span></a>            <span class="s2">&quot;storage_dir&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-323"><a href="#LightRAGDocumentManager-323"><span class="linenos">323</span></a>        <span class="p">}</span>
</span><span id="LightRAGDocumentManager-324"><a href="#LightRAGDocumentManager-324"><span class="linenos">324</span></a>
</span><span id="LightRAGDocumentManager-325"><a href="#LightRAGDocumentManager-325"><span class="linenos">325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_documents_by_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="LightRAGDocumentManager-326"><a href="#LightRAGDocumentManager-326"><span class="linenos">326</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter documents by their status.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-327"><a href="#LightRAGDocumentManager-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">all_docs</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="LightRAGDocumentManager-328"><a href="#LightRAGDocumentManager-328"><span class="linenos">328</span></a>
</span><span id="LightRAGDocumentManager-329"><a href="#LightRAGDocumentManager-329"><span class="linenos">329</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_documents_by_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="LightRAGDocumentManager-330"><a href="#LightRAGDocumentManager-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter documents by their IDs.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-331"><a href="#LightRAGDocumentManager-331"><span class="linenos">331</span></a>        <span class="n">docs_by_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span> <span class="n">doc</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">}</span>
</span><span id="LightRAGDocumentManager-332"><a href="#LightRAGDocumentManager-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">docs_by_id</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">doc_ids</span> <span class="k">if</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">docs_by_id</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager-333"><a href="#LightRAGDocumentManager-333"><span class="linenos">333</span></a>
</span><span id="LightRAGDocumentManager-334"><a href="#LightRAGDocumentManager-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_documents_by_name_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="LightRAGDocumentManager-335"><a href="#LightRAGDocumentManager-335"><span class="linenos">335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter documents by file name pattern (glob-style).&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-336"><a href="#LightRAGDocumentManager-336"><span class="linenos">336</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="LightRAGDocumentManager-337"><a href="#LightRAGDocumentManager-337"><span class="linenos">337</span></a>            <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">all_docs</span>
</span><span id="LightRAGDocumentManager-338"><a href="#LightRAGDocumentManager-338"><span class="linenos">338</span></a>            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">],</span> <span class="n">pattern</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-339"><a href="#LightRAGDocumentManager-339"><span class="linenos">339</span></a>        <span class="p">]</span>
</span><span id="LightRAGDocumentManager-340"><a href="#LightRAGDocumentManager-340"><span class="linenos">340</span></a>
</span><span id="LightRAGDocumentManager-341"><a href="#LightRAGDocumentManager-341"><span class="linenos">341</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">verify_deletion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="LightRAGDocumentManager-342"><a href="#LightRAGDocumentManager-342"><span class="linenos">342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that documents have been successfully deleted.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager-343"><a href="#LightRAGDocumentManager-343"><span class="linenos">343</span></a>        <span class="n">remaining_docs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_docs</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager-344"><a href="#LightRAGDocumentManager-344"><span class="linenos">344</span></a>        <span class="n">remaining_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">remaining_docs</span><span class="p">}</span>
</span><span id="LightRAGDocumentManager-345"><a href="#LightRAGDocumentManager-345"><span class="linenos">345</span></a>        <span class="n">deleted_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">original_doc_ids</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-346"><a href="#LightRAGDocumentManager-346"><span class="linenos">346</span></a>
</span><span id="LightRAGDocumentManager-347"><a href="#LightRAGDocumentManager-347"><span class="linenos">347</span></a>        <span class="n">verified_deleted_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deleted_ids</span> <span class="o">-</span> <span class="n">remaining_ids</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-348"><a href="#LightRAGDocumentManager-348"><span class="linenos">348</span></a>        <span class="n">still_present_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deleted_ids</span> <span class="o">&amp;</span> <span class="n">remaining_ids</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager-349"><a href="#LightRAGDocumentManager-349"><span class="linenos">349</span></a>
</span><span id="LightRAGDocumentManager-350"><a href="#LightRAGDocumentManager-350"><span class="linenos">350</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager-351"><a href="#LightRAGDocumentManager-351"><span class="linenos">351</span></a>            <span class="s2">&quot;total_targeted&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_doc_ids</span><span class="p">),</span>
</span><span id="LightRAGDocumentManager-352"><a href="#LightRAGDocumentManager-352"><span class="linenos">352</span></a>            <span class="s2">&quot;verified_deleted&quot;</span><span class="p">:</span> <span class="n">verified_deleted_count</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-353"><a href="#LightRAGDocumentManager-353"><span class="linenos">353</span></a>            <span class="s2">&quot;still_present&quot;</span><span class="p">:</span> <span class="n">still_present_count</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager-354"><a href="#LightRAGDocumentManager-354"><span class="linenos">354</span></a>            <span class="s2">&quot;deletion_successful&quot;</span><span class="p">:</span> <span class="n">still_present_count</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="LightRAGDocumentManager-355"><a href="#LightRAGDocumentManager-355"><span class="linenos">355</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Manages documents in LightRAG using the server API.</p>
</div>


                            <div id="LightRAGDocumentManager.__init__" class="classattr">
                                        <input id="LightRAGDocumentManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LightRAGDocumentManager</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">server_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="LightRAGDocumentManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.__init__-38"><a href="#LightRAGDocumentManager.__init__-38"><span class="linenos">38</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager.__init__-39"><a href="#LightRAGDocumentManager.__init__-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="n">server_url</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">LIGHTRAG_URL</span>
</span><span id="LightRAGDocumentManager.__init__-40"><a href="#LightRAGDocumentManager.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AGNO_STORAGE_DIR</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.__init__-41"><a href="#LightRAGDocumentManager.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="s2">&quot;rag_storage&quot;</span> <span class="o">/</span> <span class="s2">&quot;kv_store_doc_status.json&quot;</span>
</span><span id="LightRAGDocumentManager.__init__-42"><a href="#LightRAGDocumentManager.__init__-42"><span class="linenos">42</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Using LightRAG server URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.__init__-43"><a href="#LightRAGDocumentManager.__init__-43"><span class="linenos">43</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Using storage path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="LightRAGDocumentManager.server_url" class="classattr">
                                <div class="attr variable">
            <span class="name">server_url</span>

        
    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.server_url"></a>
    
    

                            </div>
                            <div id="LightRAGDocumentManager.storage_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">storage_dir</span>

        
    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.storage_dir"></a>
    
    

                            </div>
                            <div id="LightRAGDocumentManager.status_file_path" class="classattr">
                                <div class="attr variable">
            <span class="name">status_file_path</span>

        
    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.status_file_path"></a>
    
    

                            </div>
                            <div id="LightRAGDocumentManager.check_server_status" class="classattr">
                                        <input id="LightRAGDocumentManager.check_server_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">check_server_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.check_server_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.check_server_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.check_server_status-45"><a href="#LightRAGDocumentManager.check_server_status-45"><span class="linenos">45</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_server_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.check_server_status-46"><a href="#LightRAGDocumentManager.check_server_status-46"><span class="linenos">46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if LightRAG server is running.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.check_server_status-47"><a href="#LightRAGDocumentManager.check_server_status-47"><span class="linenos">47</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.check_server_status-48"><a href="#LightRAGDocumentManager.check_server_status-48"><span class="linenos">48</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.check_server_status-49"><a href="#LightRAGDocumentManager.check_server_status-49"><span class="linenos">49</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/health&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.check_server_status-50"><a href="#LightRAGDocumentManager.check_server_status-50"><span class="linenos">50</span></a>                    <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
</span><span id="LightRAGDocumentManager.check_server_status-51"><a href="#LightRAGDocumentManager.check_server_status-51"><span class="linenos">51</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.check_server_status-52"><a href="#LightRAGDocumentManager.check_server_status-52"><span class="linenos">52</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Cannot connect to LightRAG server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.check_server_status-53"><a href="#LightRAGDocumentManager.check_server_status-53"><span class="linenos">53</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check if LightRAG server is running.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.initialize" class="classattr">
                                        <input id="LightRAGDocumentManager.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.initialize-55"><a href="#LightRAGDocumentManager.initialize-55"><span class="linenos">55</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.initialize-56"><a href="#LightRAGDocumentManager.initialize-56"><span class="linenos">56</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check server connectivity.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.initialize-57"><a href="#LightRAGDocumentManager.initialize-57"><span class="linenos">57</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_server_status</span><span class="p">():</span>
</span><span id="LightRAGDocumentManager.initialize-58"><a href="#LightRAGDocumentManager.initialize-58"><span class="linenos">58</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; LightRAG server not accessible at: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.initialize-59"><a href="#LightRAGDocumentManager.initialize-59"><span class="linenos">59</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Please ensure the LightRAG server is running.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.initialize-60"><a href="#LightRAGDocumentManager.initialize-60"><span class="linenos">60</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="LightRAGDocumentManager.initialize-61"><a href="#LightRAGDocumentManager.initialize-61"><span class="linenos">61</span></a>        
</span><span id="LightRAGDocumentManager.initialize-62"><a href="#LightRAGDocumentManager.initialize-62"><span class="linenos">62</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; LightRAG server is accessible.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.initialize-63"><a href="#LightRAGDocumentManager.initialize-63"><span class="linenos">63</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Check server connectivity.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.get_all_docs" class="classattr">
                                        <input id="LightRAGDocumentManager.get_all_docs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_all_docs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.get_all_docs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.get_all_docs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.get_all_docs-65"><a href="#LightRAGDocumentManager.get_all_docs-65"><span class="linenos">65</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-66"><a href="#LightRAGDocumentManager.get_all_docs-66"><span class="linenos">66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetches all documents from the LightRAG server.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.get_all_docs-67"><a href="#LightRAGDocumentManager.get_all_docs-67"><span class="linenos">67</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-68"><a href="#LightRAGDocumentManager.get_all_docs-68"><span class="linenos">68</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-69"><a href="#LightRAGDocumentManager.get_all_docs-69"><span class="linenos">69</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-70"><a href="#LightRAGDocumentManager.get_all_docs-70"><span class="linenos">70</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-71"><a href="#LightRAGDocumentManager.get_all_docs-71"><span class="linenos">71</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager.get_all_docs-72"><a href="#LightRAGDocumentManager.get_all_docs-72"><span class="linenos">72</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Server error </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.get_all_docs-73"><a href="#LightRAGDocumentManager.get_all_docs-73"><span class="linenos">73</span></a>                        <span class="k">return</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager.get_all_docs-74"><a href="#LightRAGDocumentManager.get_all_docs-74"><span class="linenos">74</span></a>                    
</span><span id="LightRAGDocumentManager.get_all_docs-75"><a href="#LightRAGDocumentManager.get_all_docs-75"><span class="linenos">75</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager.get_all_docs-76"><a href="#LightRAGDocumentManager.get_all_docs-76"><span class="linenos">76</span></a>                    <span class="n">all_docs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager.get_all_docs-77"><a href="#LightRAGDocumentManager.get_all_docs-77"><span class="linenos">77</span></a>                    
</span><span id="LightRAGDocumentManager.get_all_docs-78"><a href="#LightRAGDocumentManager.get_all_docs-78"><span class="linenos">78</span></a>                    <span class="c1"># The API returns documents grouped by status in a &quot;statuses&quot; dict</span>
</span><span id="LightRAGDocumentManager.get_all_docs-79"><a href="#LightRAGDocumentManager.get_all_docs-79"><span class="linenos">79</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;statuses&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-80"><a href="#LightRAGDocumentManager.get_all_docs-80"><span class="linenos">80</span></a>                        <span class="n">statuses</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;statuses&quot;</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager.get_all_docs-81"><a href="#LightRAGDocumentManager.get_all_docs-81"><span class="linenos">81</span></a>                        <span class="c1"># Iterate through all status categories (processed, failed, etc.)</span>
</span><span id="LightRAGDocumentManager.get_all_docs-82"><a href="#LightRAGDocumentManager.get_all_docs-82"><span class="linenos">82</span></a>                        <span class="k">for</span> <span class="n">status_name</span><span class="p">,</span> <span class="n">docs_list</span> <span class="ow">in</span> <span class="n">statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LightRAGDocumentManager.get_all_docs-83"><a href="#LightRAGDocumentManager.get_all_docs-83"><span class="linenos">83</span></a>                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager.get_all_docs-84"><a href="#LightRAGDocumentManager.get_all_docs-84"><span class="linenos">84</span></a>                                <span class="n">all_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs_list</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.get_all_docs-85"><a href="#LightRAGDocumentManager.get_all_docs-85"><span class="linenos">85</span></a>                        <span class="k">return</span> <span class="n">all_docs</span>
</span><span id="LightRAGDocumentManager.get_all_docs-86"><a href="#LightRAGDocumentManager.get_all_docs-86"><span class="linenos">86</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;documents&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-87"><a href="#LightRAGDocumentManager.get_all_docs-87"><span class="linenos">87</span></a>                        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager.get_all_docs-88"><a href="#LightRAGDocumentManager.get_all_docs-88"><span class="linenos">88</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager.get_all_docs-89"><a href="#LightRAGDocumentManager.get_all_docs-89"><span class="linenos">89</span></a>                        <span class="k">return</span> <span class="n">data</span>
</span><span id="LightRAGDocumentManager.get_all_docs-90"><a href="#LightRAGDocumentManager.get_all_docs-90"><span class="linenos">90</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-91"><a href="#LightRAGDocumentManager.get_all_docs-91"><span class="linenos">91</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Unexpected response format: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.get_all_docs-92"><a href="#LightRAGDocumentManager.get_all_docs-92"><span class="linenos">92</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response keys: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not a dict&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.get_all_docs-93"><a href="#LightRAGDocumentManager.get_all_docs-93"><span class="linenos">93</span></a>                        <span class="k">return</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager.get_all_docs-94"><a href="#LightRAGDocumentManager.get_all_docs-94"><span class="linenos">94</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_all_docs-95"><a href="#LightRAGDocumentManager.get_all_docs-95"><span class="linenos">95</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Error fetching documents: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.get_all_docs-96"><a href="#LightRAGDocumentManager.get_all_docs-96"><span class="linenos">96</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Fetches all documents from the LightRAG server.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.delete_documents" class="classattr">
                                        <input id="LightRAGDocumentManager.delete_documents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">delete_documents</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">docs_to_delete</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">delete_source</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.delete_documents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.delete_documents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.delete_documents-98"><a href="#LightRAGDocumentManager.delete_documents-98"><span class="linenos"> 98</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_documents</span><span class="p">(</span>
</span><span id="LightRAGDocumentManager.delete_documents-99"><a href="#LightRAGDocumentManager.delete_documents-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">docs_to_delete</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">delete_source</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="LightRAGDocumentManager.delete_documents-100"><a href="#LightRAGDocumentManager.delete_documents-100"><span class="linenos">100</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="LightRAGDocumentManager.delete_documents-101"><a href="#LightRAGDocumentManager.delete_documents-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes a list of documents using the server API.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.delete_documents-102"><a href="#LightRAGDocumentManager.delete_documents-102"><span class="linenos">102</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager.delete_documents-103"><a href="#LightRAGDocumentManager.delete_documents-103"><span class="linenos">103</span></a>            <span class="s2">&quot;total_requested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs_to_delete</span><span class="p">),</span>
</span><span id="LightRAGDocumentManager.delete_documents-104"><a href="#LightRAGDocumentManager.delete_documents-104"><span class="linenos">104</span></a>            <span class="s2">&quot;deleted_successfully&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.delete_documents-105"><a href="#LightRAGDocumentManager.delete_documents-105"><span class="linenos">105</span></a>            <span class="s2">&quot;source_files_deleted&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.delete_documents-106"><a href="#LightRAGDocumentManager.delete_documents-106"><span class="linenos">106</span></a>            <span class="s2">&quot;not_found&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.delete_documents-107"><a href="#LightRAGDocumentManager.delete_documents-107"><span class="linenos">107</span></a>            <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="LightRAGDocumentManager.delete_documents-108"><a href="#LightRAGDocumentManager.delete_documents-108"><span class="linenos">108</span></a>        <span class="p">}</span>
</span><span id="LightRAGDocumentManager.delete_documents-109"><a href="#LightRAGDocumentManager.delete_documents-109"><span class="linenos">109</span></a>
</span><span id="LightRAGDocumentManager.delete_documents-110"><a href="#LightRAGDocumentManager.delete_documents-110"><span class="linenos">110</span></a>        <span class="c1"># Phase 1: Delete source files if requested</span>
</span><span id="LightRAGDocumentManager.delete_documents-111"><a href="#LightRAGDocumentManager.delete_documents-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">delete_source</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-112"><a href="#LightRAGDocumentManager.delete_documents-112"><span class="linenos">112</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 1: Deleting source files&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-113"><a href="#LightRAGDocumentManager.delete_documents-113"><span class="linenos">113</span></a>            <span class="k">for</span> <span class="n">doc_info</span> <span class="ow">in</span> <span class="n">docs_to_delete</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-114"><a href="#LightRAGDocumentManager.delete_documents-114"><span class="linenos">114</span></a>                <span class="n">source_path</span> <span class="o">=</span> <span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-115"><a href="#LightRAGDocumentManager.delete_documents-115"><span class="linenos">115</span></a>                <span class="k">if</span> <span class="n">source_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source_path</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager.delete_documents-116"><a href="#LightRAGDocumentManager.delete_documents-116"><span class="linenos">116</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-117"><a href="#LightRAGDocumentManager.delete_documents-117"><span class="linenos">117</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-118"><a href="#LightRAGDocumentManager.delete_documents-118"><span class="linenos">118</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Deleted source file: </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-119"><a href="#LightRAGDocumentManager.delete_documents-119"><span class="linenos">119</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;source_files_deleted&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager.delete_documents-120"><a href="#LightRAGDocumentManager.delete_documents-120"><span class="linenos">120</span></a>                    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-121"><a href="#LightRAGDocumentManager.delete_documents-121"><span class="linenos">121</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to delete source file </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.delete_documents-122"><a href="#LightRAGDocumentManager.delete_documents-122"><span class="linenos">122</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-123"><a href="#LightRAGDocumentManager.delete_documents-123"><span class="linenos">123</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-124"><a href="#LightRAGDocumentManager.delete_documents-124"><span class="linenos">124</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-125"><a href="#LightRAGDocumentManager.delete_documents-125"><span class="linenos">125</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Source file not found, skipping: </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-126"><a href="#LightRAGDocumentManager.delete_documents-126"><span class="linenos">126</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Source file deletion complete.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-127"><a href="#LightRAGDocumentManager.delete_documents-127"><span class="linenos">127</span></a>
</span><span id="LightRAGDocumentManager.delete_documents-128"><a href="#LightRAGDocumentManager.delete_documents-128"><span class="linenos">128</span></a>        <span class="c1"># Phase 2: Delete documents from LightRAG server</span>
</span><span id="LightRAGDocumentManager.delete_documents-129"><a href="#LightRAGDocumentManager.delete_documents-129"><span class="linenos">129</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 2: Deleting documents from LightRAG server&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-130"><a href="#LightRAGDocumentManager.delete_documents-130"><span class="linenos">130</span></a>        <span class="k">if</span> <span class="n">docs_to_delete</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-131"><a href="#LightRAGDocumentManager.delete_documents-131"><span class="linenos">131</span></a>            <span class="c1"># Collect all document IDs for batch deletion</span>
</span><span id="LightRAGDocumentManager.delete_documents-132"><a href="#LightRAGDocumentManager.delete_documents-132"><span class="linenos">132</span></a>            <span class="n">doc_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc_info</span> <span class="ow">in</span> <span class="n">docs_to_delete</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager.delete_documents-133"><a href="#LightRAGDocumentManager.delete_documents-133"><span class="linenos">133</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Deleting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents in batch...&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-134"><a href="#LightRAGDocumentManager.delete_documents-134"><span class="linenos">134</span></a>            
</span><span id="LightRAGDocumentManager.delete_documents-135"><a href="#LightRAGDocumentManager.delete_documents-135"><span class="linenos">135</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-136"><a href="#LightRAGDocumentManager.delete_documents-136"><span class="linenos">136</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-137"><a href="#LightRAGDocumentManager.delete_documents-137"><span class="linenos">137</span></a>                    <span class="c1"># Use the DELETE /documents/delete_document endpoint with proper format</span>
</span><span id="LightRAGDocumentManager.delete_documents-138"><a href="#LightRAGDocumentManager.delete_documents-138"><span class="linenos">138</span></a>                    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager.delete_documents-139"><a href="#LightRAGDocumentManager.delete_documents-139"><span class="linenos">139</span></a>                        <span class="s2">&quot;doc_ids&quot;</span><span class="p">:</span> <span class="n">doc_ids</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.delete_documents-140"><a href="#LightRAGDocumentManager.delete_documents-140"><span class="linenos">140</span></a>                        <span class="s2">&quot;delete_file&quot;</span><span class="p">:</span> <span class="n">delete_source</span>
</span><span id="LightRAGDocumentManager.delete_documents-141"><a href="#LightRAGDocumentManager.delete_documents-141"><span class="linenos">141</span></a>                    <span class="p">}</span>
</span><span id="LightRAGDocumentManager.delete_documents-142"><a href="#LightRAGDocumentManager.delete_documents-142"><span class="linenos">142</span></a>                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="LightRAGDocumentManager.delete_documents-143"><a href="#LightRAGDocumentManager.delete_documents-143"><span class="linenos">143</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents/delete_document&quot;</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.delete_documents-144"><a href="#LightRAGDocumentManager.delete_documents-144"><span class="linenos">144</span></a>                        <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.delete_documents-145"><a href="#LightRAGDocumentManager.delete_documents-145"><span class="linenos">145</span></a>                        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>  <span class="c1"># Longer timeout for batch operations</span>
</span><span id="LightRAGDocumentManager.delete_documents-146"><a href="#LightRAGDocumentManager.delete_documents-146"><span class="linenos">146</span></a>                    <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-147"><a href="#LightRAGDocumentManager.delete_documents-147"><span class="linenos">147</span></a>                        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-148"><a href="#LightRAGDocumentManager.delete_documents-148"><span class="linenos">148</span></a>                            <span class="n">result_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager.delete_documents-149"><a href="#LightRAGDocumentManager.delete_documents-149"><span class="linenos">149</span></a>                            <span class="n">status</span> <span class="o">=</span> <span class="n">result_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-150"><a href="#LightRAGDocumentManager.delete_documents-150"><span class="linenos">150</span></a>                            <span class="n">message</span> <span class="o">=</span> <span class="n">result_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;No message&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-151"><a href="#LightRAGDocumentManager.delete_documents-151"><span class="linenos">151</span></a>                            
</span><span id="LightRAGDocumentManager.delete_documents-152"><a href="#LightRAGDocumentManager.delete_documents-152"><span class="linenos">152</span></a>                            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;deletion_started&quot;</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-153"><a href="#LightRAGDocumentManager.delete_documents-153"><span class="linenos">153</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Success: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-154"><a href="#LightRAGDocumentManager.delete_documents-154"><span class="linenos">154</span></a>                                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;deleted_successfully&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-155"><a href="#LightRAGDocumentManager.delete_documents-155"><span class="linenos">155</span></a>                            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;busy&quot;</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-156"><a href="#LightRAGDocumentManager.delete_documents-156"><span class="linenos">156</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Server Busy: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-157"><a href="#LightRAGDocumentManager.delete_documents-157"><span class="linenos">157</span></a>                                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server busy: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-158"><a href="#LightRAGDocumentManager.delete_documents-158"><span class="linenos">158</span></a>                            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;not_allowed&quot;</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-159"><a href="#LightRAGDocumentManager.delete_documents-159"><span class="linenos">159</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Not Allowed: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-160"><a href="#LightRAGDocumentManager.delete_documents-160"><span class="linenos">160</span></a>                                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not allowed: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-161"><a href="#LightRAGDocumentManager.delete_documents-161"><span class="linenos">161</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-162"><a href="#LightRAGDocumentManager.delete_documents-162"><span class="linenos">162</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Unknown Status &#39;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-163"><a href="#LightRAGDocumentManager.delete_documents-163"><span class="linenos">163</span></a>                                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown status: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-164"><a href="#LightRAGDocumentManager.delete_documents-164"><span class="linenos">164</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-165"><a href="#LightRAGDocumentManager.delete_documents-165"><span class="linenos">165</span></a>                            <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager.delete_documents-166"><a href="#LightRAGDocumentManager.delete_documents-166"><span class="linenos">166</span></a>                            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Server error </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.delete_documents-167"><a href="#LightRAGDocumentManager.delete_documents-167"><span class="linenos">167</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-168"><a href="#LightRAGDocumentManager.delete_documents-168"><span class="linenos">168</span></a>                            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-169"><a href="#LightRAGDocumentManager.delete_documents-169"><span class="linenos">169</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-170"><a href="#LightRAGDocumentManager.delete_documents-170"><span class="linenos">170</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An exception occurred during batch deletion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.delete_documents-171"><a href="#LightRAGDocumentManager.delete_documents-171"><span class="linenos">171</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-172"><a href="#LightRAGDocumentManager.delete_documents-172"><span class="linenos">172</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-173"><a href="#LightRAGDocumentManager.delete_documents-173"><span class="linenos">173</span></a>
</span><span id="LightRAGDocumentManager.delete_documents-174"><a href="#LightRAGDocumentManager.delete_documents-174"><span class="linenos">174</span></a>        <span class="c1"># Phase 3: Clear cache using the server API</span>
</span><span id="LightRAGDocumentManager.delete_documents-175"><a href="#LightRAGDocumentManager.delete_documents-175"><span class="linenos">175</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 3: Clearing server cache&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-176"><a href="#LightRAGDocumentManager.delete_documents-176"><span class="linenos">176</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-177"><a href="#LightRAGDocumentManager.delete_documents-177"><span class="linenos">177</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-178"><a href="#LightRAGDocumentManager.delete_documents-178"><span class="linenos">178</span></a>                <span class="c1"># Clear all cache modes</span>
</span><span id="LightRAGDocumentManager.delete_documents-179"><a href="#LightRAGDocumentManager.delete_documents-179"><span class="linenos">179</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># None clears all cache</span>
</span><span id="LightRAGDocumentManager.delete_documents-180"><a href="#LightRAGDocumentManager.delete_documents-180"><span class="linenos">180</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="LightRAGDocumentManager.delete_documents-181"><a href="#LightRAGDocumentManager.delete_documents-181"><span class="linenos">181</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents/clear_cache&quot;</span><span class="p">,</span> 
</span><span id="LightRAGDocumentManager.delete_documents-182"><a href="#LightRAGDocumentManager.delete_documents-182"><span class="linenos">182</span></a>                    <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.delete_documents-183"><a href="#LightRAGDocumentManager.delete_documents-183"><span class="linenos">183</span></a>                    <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span>
</span><span id="LightRAGDocumentManager.delete_documents-184"><a href="#LightRAGDocumentManager.delete_documents-184"><span class="linenos">184</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-185"><a href="#LightRAGDocumentManager.delete_documents-185"><span class="linenos">185</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-186"><a href="#LightRAGDocumentManager.delete_documents-186"><span class="linenos">186</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Server cache cleared successfully&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-187"><a href="#LightRAGDocumentManager.delete_documents-187"><span class="linenos">187</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-188"><a href="#LightRAGDocumentManager.delete_documents-188"><span class="linenos">188</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager.delete_documents-189"><a href="#LightRAGDocumentManager.delete_documents-189"><span class="linenos">189</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to clear server cache: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.delete_documents-190"><a href="#LightRAGDocumentManager.delete_documents-190"><span class="linenos">190</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-191"><a href="#LightRAGDocumentManager.delete_documents-191"><span class="linenos">191</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-192"><a href="#LightRAGDocumentManager.delete_documents-192"><span class="linenos">192</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.delete_documents-193"><a href="#LightRAGDocumentManager.delete_documents-193"><span class="linenos">193</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to clear server cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.delete_documents-194"><a href="#LightRAGDocumentManager.delete_documents-194"><span class="linenos">194</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-195"><a href="#LightRAGDocumentManager.delete_documents-195"><span class="linenos">195</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-196"><a href="#LightRAGDocumentManager.delete_documents-196"><span class="linenos">196</span></a>
</span><span id="LightRAGDocumentManager.delete_documents-197"><a href="#LightRAGDocumentManager.delete_documents-197"><span class="linenos">197</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; LightRAG server deletion complete.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.delete_documents-198"><a href="#LightRAGDocumentManager.delete_documents-198"><span class="linenos">198</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Deletes a list of documents using the server API.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.retry_documents" class="classattr">
                                        <input id="LightRAGDocumentManager.retry_documents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">retry_documents</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.retry_documents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.retry_documents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.retry_documents-200"><a href="#LightRAGDocumentManager.retry_documents-200"><span class="linenos">200</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">retry_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="LightRAGDocumentManager.retry_documents-201"><a href="#LightRAGDocumentManager.retry_documents-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retries failed documents by deleting their server entry and triggering a new scan.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.retry_documents-202"><a href="#LightRAGDocumentManager.retry_documents-202"><span class="linenos">202</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager.retry_documents-203"><a href="#LightRAGDocumentManager.retry_documents-203"><span class="linenos">203</span></a>            <span class="s2">&quot;total_requested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">),</span>
</span><span id="LightRAGDocumentManager.retry_documents-204"><a href="#LightRAGDocumentManager.retry_documents-204"><span class="linenos">204</span></a>            <span class="s2">&quot;retried_successfully&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.retry_documents-205"><a href="#LightRAGDocumentManager.retry_documents-205"><span class="linenos">205</span></a>            <span class="s2">&quot;not_found&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.retry_documents-206"><a href="#LightRAGDocumentManager.retry_documents-206"><span class="linenos">206</span></a>            <span class="s2">&quot;not_failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.retry_documents-207"><a href="#LightRAGDocumentManager.retry_documents-207"><span class="linenos">207</span></a>            <span class="s2">&quot;source_file_missing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.retry_documents-208"><a href="#LightRAGDocumentManager.retry_documents-208"><span class="linenos">208</span></a>            <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="LightRAGDocumentManager.retry_documents-209"><a href="#LightRAGDocumentManager.retry_documents-209"><span class="linenos">209</span></a>        <span class="p">}</span>
</span><span id="LightRAGDocumentManager.retry_documents-210"><a href="#LightRAGDocumentManager.retry_documents-210"><span class="linenos">210</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-211"><a href="#LightRAGDocumentManager.retry_documents-211"><span class="linenos">211</span></a>        <span class="n">docs_to_retry</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LightRAGDocumentManager.retry_documents-212"><a href="#LightRAGDocumentManager.retry_documents-212"><span class="linenos">212</span></a>        <span class="n">docs_by_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span> <span class="n">doc</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">}</span>
</span><span id="LightRAGDocumentManager.retry_documents-213"><a href="#LightRAGDocumentManager.retry_documents-213"><span class="linenos">213</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-214"><a href="#LightRAGDocumentManager.retry_documents-214"><span class="linenos">214</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Phase 1: Identifying documents to retry&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-215"><a href="#LightRAGDocumentManager.retry_documents-215"><span class="linenos">215</span></a>        <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">doc_ids</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-216"><a href="#LightRAGDocumentManager.retry_documents-216"><span class="linenos">216</span></a>            <span class="k">if</span> <span class="n">doc_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">docs_by_id</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-217"><a href="#LightRAGDocumentManager.retry_documents-217"><span class="linenos">217</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Document &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39; not found on server. Skipping.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-218"><a href="#LightRAGDocumentManager.retry_documents-218"><span class="linenos">218</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;not_found&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager.retry_documents-219"><a href="#LightRAGDocumentManager.retry_documents-219"><span class="linenos">219</span></a>                <span class="k">continue</span>
</span><span id="LightRAGDocumentManager.retry_documents-220"><a href="#LightRAGDocumentManager.retry_documents-220"><span class="linenos">220</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-221"><a href="#LightRAGDocumentManager.retry_documents-221"><span class="linenos">221</span></a>            <span class="n">doc_info</span> <span class="o">=</span> <span class="n">docs_by_id</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager.retry_documents-222"><a href="#LightRAGDocumentManager.retry_documents-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-223"><a href="#LightRAGDocumentManager.retry_documents-223"><span class="linenos">223</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Document &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39; is not in &#39;failed&#39; state (status: </span><span class="si">{</span><span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">). Skipping.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-224"><a href="#LightRAGDocumentManager.retry_documents-224"><span class="linenos">224</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;not_failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager.retry_documents-225"><a href="#LightRAGDocumentManager.retry_documents-225"><span class="linenos">225</span></a>                <span class="k">continue</span>
</span><span id="LightRAGDocumentManager.retry_documents-226"><a href="#LightRAGDocumentManager.retry_documents-226"><span class="linenos">226</span></a>            
</span><span id="LightRAGDocumentManager.retry_documents-227"><a href="#LightRAGDocumentManager.retry_documents-227"><span class="linenos">227</span></a>            <span class="n">source_path_relative</span> <span class="o">=</span> <span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-228"><a href="#LightRAGDocumentManager.retry_documents-228"><span class="linenos">228</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">source_path_relative</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-229"><a href="#LightRAGDocumentManager.retry_documents-229"><span class="linenos">229</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Source file path is missing for doc &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39;. Cannot retry.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-230"><a href="#LightRAGDocumentManager.retry_documents-230"><span class="linenos">230</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;source_file_missing&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager.retry_documents-231"><a href="#LightRAGDocumentManager.retry_documents-231"><span class="linenos">231</span></a>                <span class="k">continue</span>
</span><span id="LightRAGDocumentManager.retry_documents-232"><a href="#LightRAGDocumentManager.retry_documents-232"><span class="linenos">232</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-233"><a href="#LightRAGDocumentManager.retry_documents-233"><span class="linenos">233</span></a>            <span class="c1"># The file_path from the server is relative. We construct the full path</span>
</span><span id="LightRAGDocumentManager.retry_documents-234"><a href="#LightRAGDocumentManager.retry_documents-234"><span class="linenos">234</span></a>            <span class="c1"># by assuming it&#39;s within an &#39;inputs&#39; directory inside the main storage path.</span>
</span><span id="LightRAGDocumentManager.retry_documents-235"><a href="#LightRAGDocumentManager.retry_documents-235"><span class="linenos">235</span></a>            <span class="n">full_source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="s2">&quot;inputs&quot;</span> <span class="o">/</span> <span class="n">source_path_relative</span>
</span><span id="LightRAGDocumentManager.retry_documents-236"><a href="#LightRAGDocumentManager.retry_documents-236"><span class="linenos">236</span></a>            
</span><span id="LightRAGDocumentManager.retry_documents-237"><a href="#LightRAGDocumentManager.retry_documents-237"><span class="linenos">237</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     (Checking for source file at: </span><span class="si">{</span><span class="n">full_source_path</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-238"><a href="#LightRAGDocumentManager.retry_documents-238"><span class="linenos">238</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-239"><a href="#LightRAGDocumentManager.retry_documents-239"><span class="linenos">239</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">full_source_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="LightRAGDocumentManager.retry_documents-240"><a href="#LightRAGDocumentManager.retry_documents-240"><span class="linenos">240</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Source file for doc &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-241"><a href="#LightRAGDocumentManager.retry_documents-241"><span class="linenos">241</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;source_file_missing&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager.retry_documents-242"><a href="#LightRAGDocumentManager.retry_documents-242"><span class="linenos">242</span></a>                <span class="k">continue</span>
</span><span id="LightRAGDocumentManager.retry_documents-243"><a href="#LightRAGDocumentManager.retry_documents-243"><span class="linenos">243</span></a>            
</span><span id="LightRAGDocumentManager.retry_documents-244"><a href="#LightRAGDocumentManager.retry_documents-244"><span class="linenos">244</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   -  Document &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">source_path_relative</span><span class="si">}</span><span class="s2">) is eligible for retry.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-245"><a href="#LightRAGDocumentManager.retry_documents-245"><span class="linenos">245</span></a>            <span class="n">docs_to_retry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_info</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-246"><a href="#LightRAGDocumentManager.retry_documents-246"><span class="linenos">246</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-247"><a href="#LightRAGDocumentManager.retry_documents-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">docs_to_retry</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-248"><a href="#LightRAGDocumentManager.retry_documents-248"><span class="linenos">248</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No valid documents to retry.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-249"><a href="#LightRAGDocumentManager.retry_documents-249"><span class="linenos">249</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="LightRAGDocumentManager.retry_documents-250"><a href="#LightRAGDocumentManager.retry_documents-250"><span class="linenos">250</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-251"><a href="#LightRAGDocumentManager.retry_documents-251"><span class="linenos">251</span></a>        <span class="c1"># Phase 2: Delete the failed document entries from LightRAG, one by one.</span>
</span><span id="LightRAGDocumentManager.retry_documents-252"><a href="#LightRAGDocumentManager.retry_documents-252"><span class="linenos">252</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 2: Deleting failed document entries from LightRAG (one by one)&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-253"><a href="#LightRAGDocumentManager.retry_documents-253"><span class="linenos">253</span></a>        <span class="n">deleted_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LightRAGDocumentManager.retry_documents-254"><a href="#LightRAGDocumentManager.retry_documents-254"><span class="linenos">254</span></a>        <span class="k">for</span> <span class="n">doc_info</span> <span class="ow">in</span> <span class="n">docs_to_retry</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-255"><a href="#LightRAGDocumentManager.retry_documents-255"><span class="linenos">255</span></a>            <span class="n">doc_id</span> <span class="o">=</span> <span class="n">doc_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
</span><span id="LightRAGDocumentManager.retry_documents-256"><a href="#LightRAGDocumentManager.retry_documents-256"><span class="linenos">256</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Deleting document: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">doc_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_path&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-257"><a href="#LightRAGDocumentManager.retry_documents-257"><span class="linenos">257</span></a>            <span class="n">delete_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;doc_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">doc_id</span><span class="p">]}</span>
</span><span id="LightRAGDocumentManager.retry_documents-258"><a href="#LightRAGDocumentManager.retry_documents-258"><span class="linenos">258</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-259"><a href="#LightRAGDocumentManager.retry_documents-259"><span class="linenos">259</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-260"><a href="#LightRAGDocumentManager.retry_documents-260"><span class="linenos">260</span></a>                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="LightRAGDocumentManager.retry_documents-261"><a href="#LightRAGDocumentManager.retry_documents-261"><span class="linenos">261</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents/delete_document&quot;</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.retry_documents-262"><a href="#LightRAGDocumentManager.retry_documents-262"><span class="linenos">262</span></a>                        <span class="n">json</span><span class="o">=</span><span class="n">delete_payload</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.retry_documents-263"><a href="#LightRAGDocumentManager.retry_documents-263"><span class="linenos">263</span></a>                        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="LightRAGDocumentManager.retry_documents-264"><a href="#LightRAGDocumentManager.retry_documents-264"><span class="linenos">264</span></a>                    <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-265"><a href="#LightRAGDocumentManager.retry_documents-265"><span class="linenos">265</span></a>                        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-266"><a href="#LightRAGDocumentManager.retry_documents-266"><span class="linenos">266</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      Successfully deleted.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-267"><a href="#LightRAGDocumentManager.retry_documents-267"><span class="linenos">267</span></a>                            <span class="n">deleted_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager.retry_documents-268"><a href="#LightRAGDocumentManager.retry_documents-268"><span class="linenos">268</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Waiting 1 second...&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-269"><a href="#LightRAGDocumentManager.retry_documents-269"><span class="linenos">269</span></a>                            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Delay after each deletion</span>
</span><span id="LightRAGDocumentManager.retry_documents-270"><a href="#LightRAGDocumentManager.retry_documents-270"><span class="linenos">270</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-271"><a href="#LightRAGDocumentManager.retry_documents-271"><span class="linenos">271</span></a>                            <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager.retry_documents-272"><a href="#LightRAGDocumentManager.retry_documents-272"><span class="linenos">272</span></a>                            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Server error during deletion of </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.retry_documents-273"><a href="#LightRAGDocumentManager.retry_documents-273"><span class="linenos">273</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-274"><a href="#LightRAGDocumentManager.retry_documents-274"><span class="linenos">274</span></a>                            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-275"><a href="#LightRAGDocumentManager.retry_documents-275"><span class="linenos">275</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-276"><a href="#LightRAGDocumentManager.retry_documents-276"><span class="linenos">276</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An exception occurred during deletion of </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.retry_documents-277"><a href="#LightRAGDocumentManager.retry_documents-277"><span class="linenos">277</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-278"><a href="#LightRAGDocumentManager.retry_documents-278"><span class="linenos">278</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-279"><a href="#LightRAGDocumentManager.retry_documents-279"><span class="linenos">279</span></a>        
</span><span id="LightRAGDocumentManager.retry_documents-280"><a href="#LightRAGDocumentManager.retry_documents-280"><span class="linenos">280</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Deletion phase complete. Successfully deleted </span><span class="si">{</span><span class="n">deleted_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs_to_retry</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-281"><a href="#LightRAGDocumentManager.retry_documents-281"><span class="linenos">281</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-282"><a href="#LightRAGDocumentManager.retry_documents-282"><span class="linenos">282</span></a>        <span class="c1"># Add a delay to give the server time to process the deletions before scanning.</span>
</span><span id="LightRAGDocumentManager.retry_documents-283"><a href="#LightRAGDocumentManager.retry_documents-283"><span class="linenos">283</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Waiting 5 seconds for server to process deletions...&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-284"><a href="#LightRAGDocumentManager.retry_documents-284"><span class="linenos">284</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-285"><a href="#LightRAGDocumentManager.retry_documents-285"><span class="linenos">285</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-286"><a href="#LightRAGDocumentManager.retry_documents-286"><span class="linenos">286</span></a>        <span class="c1"># Phase 3: Trigger a server-side scan to re-discover and process the files</span>
</span><span id="LightRAGDocumentManager.retry_documents-287"><a href="#LightRAGDocumentManager.retry_documents-287"><span class="linenos">287</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Phase 3: Triggering server scan to re-process files&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-288"><a href="#LightRAGDocumentManager.retry_documents-288"><span class="linenos">288</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-289"><a href="#LightRAGDocumentManager.retry_documents-289"><span class="linenos">289</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-290"><a href="#LightRAGDocumentManager.retry_documents-290"><span class="linenos">290</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="si">}</span><span class="s2">/documents/scan&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-291"><a href="#LightRAGDocumentManager.retry_documents-291"><span class="linenos">291</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-292"><a href="#LightRAGDocumentManager.retry_documents-292"><span class="linenos">292</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Server scan initiated successfully.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-293"><a href="#LightRAGDocumentManager.retry_documents-293"><span class="linenos">293</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Documents will be re-processed in the background.&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-294"><a href="#LightRAGDocumentManager.retry_documents-294"><span class="linenos">294</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;retried_successfully&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs_to_retry</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-295"><a href="#LightRAGDocumentManager.retry_documents-295"><span class="linenos">295</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-296"><a href="#LightRAGDocumentManager.retry_documents-296"><span class="linenos">296</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager.retry_documents-297"><a href="#LightRAGDocumentManager.retry_documents-297"><span class="linenos">297</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to trigger server scan: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.retry_documents-298"><a href="#LightRAGDocumentManager.retry_documents-298"><span class="linenos">298</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-299"><a href="#LightRAGDocumentManager.retry_documents-299"><span class="linenos">299</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-300"><a href="#LightRAGDocumentManager.retry_documents-300"><span class="linenos">300</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.retry_documents-301"><a href="#LightRAGDocumentManager.retry_documents-301"><span class="linenos">301</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An exception occurred while triggering scan: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LightRAGDocumentManager.retry_documents-302"><a href="#LightRAGDocumentManager.retry_documents-302"><span class="linenos">302</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-303"><a href="#LightRAGDocumentManager.retry_documents-303"><span class="linenos">303</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.retry_documents-304"><a href="#LightRAGDocumentManager.retry_documents-304"><span class="linenos">304</span></a>
</span><span id="LightRAGDocumentManager.retry_documents-305"><a href="#LightRAGDocumentManager.retry_documents-305"><span class="linenos">305</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Retries failed documents by deleting their server entry and triggering a new scan.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.finalize" class="classattr">
                                        <input id="LightRAGDocumentManager.finalize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">finalize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.finalize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.finalize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.finalize-307"><a href="#LightRAGDocumentManager.finalize-307"><span class="linenos">307</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LightRAGDocumentManager.finalize-308"><a href="#LightRAGDocumentManager.finalize-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;No cleanup needed for API-based approach.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.finalize-309"><a href="#LightRAGDocumentManager.finalize-309"><span class="linenos">309</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Document manager finalized.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>No cleanup needed for API-based approach.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.get_status_summary" class="classattr">
                                        <input id="LightRAGDocumentManager.get_status_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_status_summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.get_status_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.get_status_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.get_status_summary-311"><a href="#LightRAGDocumentManager.get_status_summary-311"><span class="linenos">311</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_status_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="LightRAGDocumentManager.get_status_summary-312"><a href="#LightRAGDocumentManager.get_status_summary-312"><span class="linenos">312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a summary of document statuses.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.get_status_summary-313"><a href="#LightRAGDocumentManager.get_status_summary-313"><span class="linenos">313</span></a>        <span class="n">status_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LightRAGDocumentManager.get_status_summary-314"><a href="#LightRAGDocumentManager.get_status_summary-314"><span class="linenos">314</span></a>        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">:</span>
</span><span id="LightRAGDocumentManager.get_status_summary-315"><a href="#LightRAGDocumentManager.get_status_summary-315"><span class="linenos">315</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.get_status_summary-316"><a href="#LightRAGDocumentManager.get_status_summary-316"><span class="linenos">316</span></a>            <span class="n">status_counts</span><span class="p">[</span><span class="n">status</span><span class="p">]</span> <span class="o">=</span> <span class="n">status_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="LightRAGDocumentManager.get_status_summary-317"><a href="#LightRAGDocumentManager.get_status_summary-317"><span class="linenos">317</span></a>        
</span><span id="LightRAGDocumentManager.get_status_summary-318"><a href="#LightRAGDocumentManager.get_status_summary-318"><span class="linenos">318</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager.get_status_summary-319"><a href="#LightRAGDocumentManager.get_status_summary-319"><span class="linenos">319</span></a>            <span class="s2">&quot;total_documents&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_docs</span><span class="p">),</span>
</span><span id="LightRAGDocumentManager.get_status_summary-320"><a href="#LightRAGDocumentManager.get_status_summary-320"><span class="linenos">320</span></a>            <span class="s2">&quot;status_breakdown&quot;</span><span class="p">:</span> <span class="n">status_counts</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.get_status_summary-321"><a href="#LightRAGDocumentManager.get_status_summary-321"><span class="linenos">321</span></a>            <span class="s2">&quot;server_url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.get_status_summary-322"><a href="#LightRAGDocumentManager.get_status_summary-322"><span class="linenos">322</span></a>            <span class="s2">&quot;storage_dir&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.get_status_summary-323"><a href="#LightRAGDocumentManager.get_status_summary-323"><span class="linenos">323</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get a summary of document statuses.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.filter_documents_by_status" class="classattr">
                                        <input id="LightRAGDocumentManager.filter_documents_by_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_documents_by_status</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">status</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.filter_documents_by_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.filter_documents_by_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.filter_documents_by_status-325"><a href="#LightRAGDocumentManager.filter_documents_by_status-325"><span class="linenos">325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_documents_by_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_status-326"><a href="#LightRAGDocumentManager.filter_documents_by_status-326"><span class="linenos">326</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter documents by their status.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_status-327"><a href="#LightRAGDocumentManager.filter_documents_by_status-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">all_docs</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span></pre></div>


            <div class="docstring"><p>Filter documents by their status.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.filter_documents_by_ids" class="classattr">
                                        <input id="LightRAGDocumentManager.filter_documents_by_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_documents_by_ids</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.filter_documents_by_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.filter_documents_by_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.filter_documents_by_ids-329"><a href="#LightRAGDocumentManager.filter_documents_by_ids-329"><span class="linenos">329</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_documents_by_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_ids-330"><a href="#LightRAGDocumentManager.filter_documents_by_ids-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter documents by their IDs.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_ids-331"><a href="#LightRAGDocumentManager.filter_documents_by_ids-331"><span class="linenos">331</span></a>        <span class="n">docs_by_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span> <span class="n">doc</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">}</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_ids-332"><a href="#LightRAGDocumentManager.filter_documents_by_ids-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">docs_by_id</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">doc_ids</span> <span class="k">if</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">docs_by_id</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Filter documents by their IDs.</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.filter_documents_by_name_pattern" class="classattr">
                                        <input id="LightRAGDocumentManager.filter_documents_by_name_pattern-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_documents_by_name_pattern</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.filter_documents_by_name_pattern-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.filter_documents_by_name_pattern"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.filter_documents_by_name_pattern-334"><a href="#LightRAGDocumentManager.filter_documents_by_name_pattern-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_documents_by_name_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_name_pattern-335"><a href="#LightRAGDocumentManager.filter_documents_by_name_pattern-335"><span class="linenos">335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter documents by file name pattern (glob-style).&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_name_pattern-336"><a href="#LightRAGDocumentManager.filter_documents_by_name_pattern-336"><span class="linenos">336</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_name_pattern-337"><a href="#LightRAGDocumentManager.filter_documents_by_name_pattern-337"><span class="linenos">337</span></a>            <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">all_docs</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_name_pattern-338"><a href="#LightRAGDocumentManager.filter_documents_by_name_pattern-338"><span class="linenos">338</span></a>            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">],</span> <span class="n">pattern</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.filter_documents_by_name_pattern-339"><a href="#LightRAGDocumentManager.filter_documents_by_name_pattern-339"><span class="linenos">339</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Filter documents by file name pattern (glob-style).</p>
</div>


                            </div>
                            <div id="LightRAGDocumentManager.verify_deletion" class="classattr">
                                        <input id="LightRAGDocumentManager.verify_deletion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">verify_deletion</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">original_doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="LightRAGDocumentManager.verify_deletion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LightRAGDocumentManager.verify_deletion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LightRAGDocumentManager.verify_deletion-341"><a href="#LightRAGDocumentManager.verify_deletion-341"><span class="linenos">341</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">verify_deletion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_doc_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="LightRAGDocumentManager.verify_deletion-342"><a href="#LightRAGDocumentManager.verify_deletion-342"><span class="linenos">342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that documents have been successfully deleted.&quot;&quot;&quot;</span>
</span><span id="LightRAGDocumentManager.verify_deletion-343"><a href="#LightRAGDocumentManager.verify_deletion-343"><span class="linenos">343</span></a>        <span class="n">remaining_docs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_docs</span><span class="p">()</span>
</span><span id="LightRAGDocumentManager.verify_deletion-344"><a href="#LightRAGDocumentManager.verify_deletion-344"><span class="linenos">344</span></a>        <span class="n">remaining_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">remaining_docs</span><span class="p">}</span>
</span><span id="LightRAGDocumentManager.verify_deletion-345"><a href="#LightRAGDocumentManager.verify_deletion-345"><span class="linenos">345</span></a>        <span class="n">deleted_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">original_doc_ids</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.verify_deletion-346"><a href="#LightRAGDocumentManager.verify_deletion-346"><span class="linenos">346</span></a>
</span><span id="LightRAGDocumentManager.verify_deletion-347"><a href="#LightRAGDocumentManager.verify_deletion-347"><span class="linenos">347</span></a>        <span class="n">verified_deleted_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deleted_ids</span> <span class="o">-</span> <span class="n">remaining_ids</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.verify_deletion-348"><a href="#LightRAGDocumentManager.verify_deletion-348"><span class="linenos">348</span></a>        <span class="n">still_present_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deleted_ids</span> <span class="o">&amp;</span> <span class="n">remaining_ids</span><span class="p">)</span>
</span><span id="LightRAGDocumentManager.verify_deletion-349"><a href="#LightRAGDocumentManager.verify_deletion-349"><span class="linenos">349</span></a>
</span><span id="LightRAGDocumentManager.verify_deletion-350"><a href="#LightRAGDocumentManager.verify_deletion-350"><span class="linenos">350</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="LightRAGDocumentManager.verify_deletion-351"><a href="#LightRAGDocumentManager.verify_deletion-351"><span class="linenos">351</span></a>            <span class="s2">&quot;total_targeted&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_doc_ids</span><span class="p">),</span>
</span><span id="LightRAGDocumentManager.verify_deletion-352"><a href="#LightRAGDocumentManager.verify_deletion-352"><span class="linenos">352</span></a>            <span class="s2">&quot;verified_deleted&quot;</span><span class="p">:</span> <span class="n">verified_deleted_count</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.verify_deletion-353"><a href="#LightRAGDocumentManager.verify_deletion-353"><span class="linenos">353</span></a>            <span class="s2">&quot;still_present&quot;</span><span class="p">:</span> <span class="n">still_present_count</span><span class="p">,</span>
</span><span id="LightRAGDocumentManager.verify_deletion-354"><a href="#LightRAGDocumentManager.verify_deletion-354"><span class="linenos">354</span></a>            <span class="s2">&quot;deletion_successful&quot;</span><span class="p">:</span> <span class="n">still_present_count</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="LightRAGDocumentManager.verify_deletion-355"><a href="#LightRAGDocumentManager.verify_deletion-355"><span class="linenos">355</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Verify that documents have been successfully deleted.</p>
</div>


                            </div>
                </section>
                <section id="MemoryClearingManager">
                            <input id="MemoryClearingManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MemoryClearingManager</span>:

                <label class="view-source-button" for="MemoryClearingManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryClearingManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryClearingManager-30"><a href="#MemoryClearingManager-30"><span class="linenos"> 30</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MemoryClearingManager</span><span class="p">:</span>
</span><span id="MemoryClearingManager-31"><a href="#MemoryClearingManager-31"><span class="linenos"> 31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages the clearing of both semantic and LightRAG graph memories.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-32"><a href="#MemoryClearingManager-32"><span class="linenos"> 32</span></a>
</span><span id="MemoryClearingManager-33"><a href="#MemoryClearingManager-33"><span class="linenos"> 33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MemoryClearingManager-34"><a href="#MemoryClearingManager-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MemoryClearingManager-35"><a href="#MemoryClearingManager-35"><span class="linenos"> 35</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MemoryClearingManager-36"><a href="#MemoryClearingManager-36"><span class="linenos"> 36</span></a>        <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AGNO_STORAGE_DIR</span><span class="p">,</span>
</span><span id="MemoryClearingManager-37"><a href="#MemoryClearingManager-37"><span class="linenos"> 37</span></a>        <span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">LIGHTRAG_MEMORY_URL</span><span class="p">,</span>
</span><span id="MemoryClearingManager-38"><a href="#MemoryClearingManager-38"><span class="linenos"> 38</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-39"><a href="#MemoryClearingManager-39"><span class="linenos"> 39</span></a>    <span class="p">):</span>
</span><span id="MemoryClearingManager-40"><a href="#MemoryClearingManager-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="MemoryClearingManager-41"><a href="#MemoryClearingManager-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">)</span>
</span><span id="MemoryClearingManager-42"><a href="#MemoryClearingManager-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span> <span class="o">=</span> <span class="n">lightrag_memory_url</span>
</span><span id="MemoryClearingManager-43"><a href="#MemoryClearingManager-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="MemoryClearingManager-44"><a href="#MemoryClearingManager-44"><span class="linenos"> 44</span></a>
</span><span id="MemoryClearingManager-45"><a href="#MemoryClearingManager-45"><span class="linenos"> 45</span></a>        <span class="c1"># Initialize semantic memory components</span>
</span><span id="MemoryClearingManager-46"><a href="#MemoryClearingManager-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">semantic_db_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="s2">&quot;semantic_memory.db&quot;</span>
</span><span id="MemoryClearingManager-47"><a href="#MemoryClearingManager-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MemoryClearingManager-48"><a href="#MemoryClearingManager-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MemoryClearingManager-49"><a href="#MemoryClearingManager-49"><span class="linenos"> 49</span></a>
</span><span id="MemoryClearingManager-50"><a href="#MemoryClearingManager-50"><span class="linenos"> 50</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MemoryClearingManager-51"><a href="#MemoryClearingManager-51"><span class="linenos"> 51</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_userid</span><span class="p">()</span>
</span><span id="MemoryClearingManager-52"><a href="#MemoryClearingManager-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="MemoryClearingManager-53"><a href="#MemoryClearingManager-53"><span class="linenos"> 53</span></a>        
</span><span id="MemoryClearingManager-54"><a href="#MemoryClearingManager-54"><span class="linenos"> 54</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Memory Clearing Manager initialized&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-55"><a href="#MemoryClearingManager-55"><span class="linenos"> 55</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   User ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-56"><a href="#MemoryClearingManager-56"><span class="linenos"> 56</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Storage Directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-57"><a href="#MemoryClearingManager-57"><span class="linenos"> 57</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   LightRAG Memory URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-58"><a href="#MemoryClearingManager-58"><span class="linenos"> 58</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Semantic DB Path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">semantic_db_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-59"><a href="#MemoryClearingManager-59"><span class="linenos"> 59</span></a>
</span><span id="MemoryClearingManager-60"><a href="#MemoryClearingManager-60"><span class="linenos"> 60</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_semantic_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryClearingManager-61"><a href="#MemoryClearingManager-61"><span class="linenos"> 61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize semantic memory components using the EXACT same pattern as the agent.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-62"><a href="#MemoryClearingManager-62"><span class="linenos"> 62</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-63"><a href="#MemoryClearingManager-63"><span class="linenos"> 63</span></a>            <span class="c1"># Ensure storage directory exists</span>
</span><span id="MemoryClearingManager-64"><a href="#MemoryClearingManager-64"><span class="linenos"> 64</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MemoryClearingManager-65"><a href="#MemoryClearingManager-65"><span class="linenos"> 65</span></a>            
</span><span id="MemoryClearingManager-66"><a href="#MemoryClearingManager-66"><span class="linenos"> 66</span></a>            <span class="c1"># Use the EXACT same initialization pattern as create_agno_memory() in agno_storage.py</span>
</span><span id="MemoryClearingManager-67"><a href="#MemoryClearingManager-67"><span class="linenos"> 67</span></a>            <span class="c1"># This ensures we&#39;re working with the same database and table as the actual agent</span>
</span><span id="MemoryClearingManager-68"><a href="#MemoryClearingManager-68"><span class="linenos"> 68</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span> <span class="o">=</span> <span class="n">SqliteMemoryDb</span><span class="p">(</span>
</span><span id="MemoryClearingManager-69"><a href="#MemoryClearingManager-69"><span class="linenos"> 69</span></a>                <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;personal_agent_memory&quot;</span><span class="p">,</span>  <span class="c1"># &lt;-- FIXED: Use the correct table name!</span>
</span><span id="MemoryClearingManager-70"><a href="#MemoryClearingManager-70"><span class="linenos"> 70</span></a>                <span class="n">db_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="s2">&quot;agent_memory.db&quot;</span><span class="p">),</span>  <span class="c1"># &lt;-- FIXED: Use the correct file name!</span>
</span><span id="MemoryClearingManager-71"><a href="#MemoryClearingManager-71"><span class="linenos"> 71</span></a>            <span class="p">)</span>
</span><span id="MemoryClearingManager-72"><a href="#MemoryClearingManager-72"><span class="linenos"> 72</span></a>
</span><span id="MemoryClearingManager-73"><a href="#MemoryClearingManager-73"><span class="linenos"> 73</span></a>            <span class="c1"># Create semantic memory manager with the same configuration as the agent</span>
</span><span id="MemoryClearingManager-74"><a href="#MemoryClearingManager-74"><span class="linenos"> 74</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="n">create_semantic_memory_manager</span><span class="p">(</span>
</span><span id="MemoryClearingManager-75"><a href="#MemoryClearingManager-75"><span class="linenos"> 75</span></a>                <span class="n">similarity_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
</span><span id="MemoryClearingManager-76"><a href="#MemoryClearingManager-76"><span class="linenos"> 76</span></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="MemoryClearingManager-77"><a href="#MemoryClearingManager-77"><span class="linenos"> 77</span></a>            <span class="p">)</span>
</span><span id="MemoryClearingManager-78"><a href="#MemoryClearingManager-78"><span class="linenos"> 78</span></a>
</span><span id="MemoryClearingManager-79"><a href="#MemoryClearingManager-79"><span class="linenos"> 79</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-80"><a href="#MemoryClearingManager-80"><span class="linenos"> 80</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Semantic memory components initialized using agent pattern&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-81"><a href="#MemoryClearingManager-81"><span class="linenos"> 81</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Database file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;agent_memory.db&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-82"><a href="#MemoryClearingManager-82"><span class="linenos"> 82</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Table name: personal_agent_memory&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-83"><a href="#MemoryClearingManager-83"><span class="linenos"> 83</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Database exists: </span><span class="si">{</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;agent_memory.db&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-84"><a href="#MemoryClearingManager-84"><span class="linenos"> 84</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-85"><a href="#MemoryClearingManager-85"><span class="linenos"> 85</span></a>
</span><span id="MemoryClearingManager-86"><a href="#MemoryClearingManager-86"><span class="linenos"> 86</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-87"><a href="#MemoryClearingManager-87"><span class="linenos"> 87</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Failed to initialize semantic memory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-88"><a href="#MemoryClearingManager-88"><span class="linenos"> 88</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="MemoryClearingManager-89"><a href="#MemoryClearingManager-89"><span class="linenos"> 89</span></a>
</span><span id="MemoryClearingManager-90"><a href="#MemoryClearingManager-90"><span class="linenos"> 90</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_lightrag_server_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryClearingManager-91"><a href="#MemoryClearingManager-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if LightRAG memory server is running.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-92"><a href="#MemoryClearingManager-92"><span class="linenos"> 92</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-93"><a href="#MemoryClearingManager-93"><span class="linenos"> 93</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="MemoryClearingManager-94"><a href="#MemoryClearingManager-94"><span class="linenos"> 94</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/health&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="MemoryClearingManager-95"><a href="#MemoryClearingManager-95"><span class="linenos"> 95</span></a>                    <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
</span><span id="MemoryClearingManager-96"><a href="#MemoryClearingManager-96"><span class="linenos"> 96</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-97"><a href="#MemoryClearingManager-97"><span class="linenos"> 97</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-98"><a href="#MemoryClearingManager-98"><span class="linenos"> 98</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Cannot connect to LightRAG memory server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-99"><a href="#MemoryClearingManager-99"><span class="linenos"> 99</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="MemoryClearingManager-100"><a href="#MemoryClearingManager-100"><span class="linenos">100</span></a>
</span><span id="MemoryClearingManager-101"><a href="#MemoryClearingManager-101"><span class="linenos">101</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_lightrag_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="MemoryClearingManager-102"><a href="#MemoryClearingManager-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all documents from LightRAG memory server.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-103"><a href="#MemoryClearingManager-103"><span class="linenos">103</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-104"><a href="#MemoryClearingManager-104"><span class="linenos">104</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="MemoryClearingManager-105"><a href="#MemoryClearingManager-105"><span class="linenos">105</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="MemoryClearingManager-106"><a href="#MemoryClearingManager-106"><span class="linenos">106</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="MemoryClearingManager-107"><a href="#MemoryClearingManager-107"><span class="linenos">107</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="MemoryClearingManager-108"><a href="#MemoryClearingManager-108"><span class="linenos">108</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Server error </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-109"><a href="#MemoryClearingManager-109"><span class="linenos">109</span></a>                        <span class="k">return</span> <span class="p">[]</span>
</span><span id="MemoryClearingManager-110"><a href="#MemoryClearingManager-110"><span class="linenos">110</span></a>
</span><span id="MemoryClearingManager-111"><a href="#MemoryClearingManager-111"><span class="linenos">111</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="MemoryClearingManager-112"><a href="#MemoryClearingManager-112"><span class="linenos">112</span></a>                    <span class="n">all_docs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MemoryClearingManager-113"><a href="#MemoryClearingManager-113"><span class="linenos">113</span></a>
</span><span id="MemoryClearingManager-114"><a href="#MemoryClearingManager-114"><span class="linenos">114</span></a>                    <span class="c1"># The API returns documents grouped by status in a &quot;statuses&quot; dict</span>
</span><span id="MemoryClearingManager-115"><a href="#MemoryClearingManager-115"><span class="linenos">115</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;statuses&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MemoryClearingManager-116"><a href="#MemoryClearingManager-116"><span class="linenos">116</span></a>                        <span class="n">statuses</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;statuses&quot;</span><span class="p">]</span>
</span><span id="MemoryClearingManager-117"><a href="#MemoryClearingManager-117"><span class="linenos">117</span></a>                        <span class="c1"># Iterate through all status categories (processed, failed, etc.)</span>
</span><span id="MemoryClearingManager-118"><a href="#MemoryClearingManager-118"><span class="linenos">118</span></a>                        <span class="k">for</span> <span class="n">status_name</span><span class="p">,</span> <span class="n">docs_list</span> <span class="ow">in</span> <span class="n">statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MemoryClearingManager-119"><a href="#MemoryClearingManager-119"><span class="linenos">119</span></a>                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="MemoryClearingManager-120"><a href="#MemoryClearingManager-120"><span class="linenos">120</span></a>                                <span class="n">all_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs_list</span><span class="p">)</span>
</span><span id="MemoryClearingManager-121"><a href="#MemoryClearingManager-121"><span class="linenos">121</span></a>                        <span class="k">return</span> <span class="n">all_docs</span>
</span><span id="MemoryClearingManager-122"><a href="#MemoryClearingManager-122"><span class="linenos">122</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;documents&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MemoryClearingManager-123"><a href="#MemoryClearingManager-123"><span class="linenos">123</span></a>                        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span>
</span><span id="MemoryClearingManager-124"><a href="#MemoryClearingManager-124"><span class="linenos">124</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="MemoryClearingManager-125"><a href="#MemoryClearingManager-125"><span class="linenos">125</span></a>                        <span class="k">return</span> <span class="n">data</span>
</span><span id="MemoryClearingManager-126"><a href="#MemoryClearingManager-126"><span class="linenos">126</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-127"><a href="#MemoryClearingManager-127"><span class="linenos">127</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-128"><a href="#MemoryClearingManager-128"><span class="linenos">128</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Unexpected response format: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-129"><a href="#MemoryClearingManager-129"><span class="linenos">129</span></a>                        <span class="k">return</span> <span class="p">[]</span>
</span><span id="MemoryClearingManager-130"><a href="#MemoryClearingManager-130"><span class="linenos">130</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-131"><a href="#MemoryClearingManager-131"><span class="linenos">131</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Error fetching LightRAG documents: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-132"><a href="#MemoryClearingManager-132"><span class="linenos">132</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="MemoryClearingManager-133"><a href="#MemoryClearingManager-133"><span class="linenos">133</span></a>
</span><span id="MemoryClearingManager-134"><a href="#MemoryClearingManager-134"><span class="linenos">134</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_clear_lightrag_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-135"><a href="#MemoryClearingManager-135"><span class="linenos">135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear documents from LightRAG memory server.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-136"><a href="#MemoryClearingManager-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
</span><span id="MemoryClearingManager-137"><a href="#MemoryClearingManager-137"><span class="linenos">137</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-138"><a href="#MemoryClearingManager-138"><span class="linenos">138</span></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MemoryClearingManager-139"><a href="#MemoryClearingManager-139"><span class="linenos">139</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;DRY RUN: Would delete </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents from LightRAG&quot;</span><span class="p">,</span>
</span><span id="MemoryClearingManager-140"><a href="#MemoryClearingManager-140"><span class="linenos">140</span></a>                <span class="s2">&quot;deleted_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">),</span>
</span><span id="MemoryClearingManager-141"><a href="#MemoryClearingManager-141"><span class="linenos">141</span></a>            <span class="p">}</span>
</span><span id="MemoryClearingManager-142"><a href="#MemoryClearingManager-142"><span class="linenos">142</span></a>
</span><span id="MemoryClearingManager-143"><a href="#MemoryClearingManager-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">doc_ids</span><span class="p">:</span>
</span><span id="MemoryClearingManager-144"><a href="#MemoryClearingManager-144"><span class="linenos">144</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-145"><a href="#MemoryClearingManager-145"><span class="linenos">145</span></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MemoryClearingManager-146"><a href="#MemoryClearingManager-146"><span class="linenos">146</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;No documents to delete from LightRAG&quot;</span><span class="p">,</span>
</span><span id="MemoryClearingManager-147"><a href="#MemoryClearingManager-147"><span class="linenos">147</span></a>                <span class="s2">&quot;deleted_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MemoryClearingManager-148"><a href="#MemoryClearingManager-148"><span class="linenos">148</span></a>            <span class="p">}</span>
</span><span id="MemoryClearingManager-149"><a href="#MemoryClearingManager-149"><span class="linenos">149</span></a>
</span><span id="MemoryClearingManager-150"><a href="#MemoryClearingManager-150"><span class="linenos">150</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-151"><a href="#MemoryClearingManager-151"><span class="linenos">151</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="MemoryClearingManager-152"><a href="#MemoryClearingManager-152"><span class="linenos">152</span></a>                <span class="c1"># Delete documents using batch deletion</span>
</span><span id="MemoryClearingManager-153"><a href="#MemoryClearingManager-153"><span class="linenos">153</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-154"><a href="#MemoryClearingManager-154"><span class="linenos">154</span></a>                    <span class="s2">&quot;doc_ids&quot;</span><span class="p">:</span> <span class="n">doc_ids</span><span class="p">,</span>
</span><span id="MemoryClearingManager-155"><a href="#MemoryClearingManager-155"><span class="linenos">155</span></a>                    <span class="s2">&quot;delete_file&quot;</span><span class="p">:</span> <span class="kc">True</span>  <span class="c1"># DELETE source files to prevent rescan</span>
</span><span id="MemoryClearingManager-156"><a href="#MemoryClearingManager-156"><span class="linenos">156</span></a>                <span class="p">}</span>
</span><span id="MemoryClearingManager-157"><a href="#MemoryClearingManager-157"><span class="linenos">157</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="MemoryClearingManager-158"><a href="#MemoryClearingManager-158"><span class="linenos">158</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents/delete_document&quot;</span><span class="p">,</span>
</span><span id="MemoryClearingManager-159"><a href="#MemoryClearingManager-159"><span class="linenos">159</span></a>                    <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="MemoryClearingManager-160"><a href="#MemoryClearingManager-160"><span class="linenos">160</span></a>                    <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="MemoryClearingManager-161"><a href="#MemoryClearingManager-161"><span class="linenos">161</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="MemoryClearingManager-162"><a href="#MemoryClearingManager-162"><span class="linenos">162</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="MemoryClearingManager-163"><a href="#MemoryClearingManager-163"><span class="linenos">163</span></a>                        <span class="n">result_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="MemoryClearingManager-164"><a href="#MemoryClearingManager-164"><span class="linenos">164</span></a>                        <span class="n">status</span> <span class="o">=</span> <span class="n">result_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-165"><a href="#MemoryClearingManager-165"><span class="linenos">165</span></a>                        <span class="n">message</span> <span class="o">=</span> <span class="n">result_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;No message&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-166"><a href="#MemoryClearingManager-166"><span class="linenos">166</span></a>
</span><span id="MemoryClearingManager-167"><a href="#MemoryClearingManager-167"><span class="linenos">167</span></a>                        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;deletion_started&quot;</span><span class="p">:</span>
</span><span id="MemoryClearingManager-168"><a href="#MemoryClearingManager-168"><span class="linenos">168</span></a>                            <span class="c1"># Clear cache after deletion</span>
</span><span id="MemoryClearingManager-169"><a href="#MemoryClearingManager-169"><span class="linenos">169</span></a>                            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_lightrag_cache</span><span class="p">()</span>
</span><span id="MemoryClearingManager-170"><a href="#MemoryClearingManager-170"><span class="linenos">170</span></a>                            
</span><span id="MemoryClearingManager-171"><a href="#MemoryClearingManager-171"><span class="linenos">171</span></a>                            <span class="c1"># Also delete the knowledge graph file</span>
</span><span id="MemoryClearingManager-172"><a href="#MemoryClearingManager-172"><span class="linenos">172</span></a>                            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_knowledge_graph_file</span><span class="p">()</span>
</span><span id="MemoryClearingManager-173"><a href="#MemoryClearingManager-173"><span class="linenos">173</span></a>                            
</span><span id="MemoryClearingManager-174"><a href="#MemoryClearingManager-174"><span class="linenos">174</span></a>                            <span class="k">return</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-175"><a href="#MemoryClearingManager-175"><span class="linenos">175</span></a>                                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MemoryClearingManager-176"><a href="#MemoryClearingManager-176"><span class="linenos">176</span></a>                                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Successfully deleted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents from LightRAG&quot;</span><span class="p">,</span>
</span><span id="MemoryClearingManager-177"><a href="#MemoryClearingManager-177"><span class="linenos">177</span></a>                                <span class="s2">&quot;deleted_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">),</span>
</span><span id="MemoryClearingManager-178"><a href="#MemoryClearingManager-178"><span class="linenos">178</span></a>                            <span class="p">}</span>
</span><span id="MemoryClearingManager-179"><a href="#MemoryClearingManager-179"><span class="linenos">179</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-180"><a href="#MemoryClearingManager-180"><span class="linenos">180</span></a>                            <span class="k">return</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-181"><a href="#MemoryClearingManager-181"><span class="linenos">181</span></a>                                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-182"><a href="#MemoryClearingManager-182"><span class="linenos">182</span></a>                                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;LightRAG deletion status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MemoryClearingManager-183"><a href="#MemoryClearingManager-183"><span class="linenos">183</span></a>                                <span class="s2">&quot;deleted_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MemoryClearingManager-184"><a href="#MemoryClearingManager-184"><span class="linenos">184</span></a>                            <span class="p">}</span>
</span><span id="MemoryClearingManager-185"><a href="#MemoryClearingManager-185"><span class="linenos">185</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-186"><a href="#MemoryClearingManager-186"><span class="linenos">186</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="MemoryClearingManager-187"><a href="#MemoryClearingManager-187"><span class="linenos">187</span></a>                        <span class="k">return</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-188"><a href="#MemoryClearingManager-188"><span class="linenos">188</span></a>                            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-189"><a href="#MemoryClearingManager-189"><span class="linenos">189</span></a>                            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Server error </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MemoryClearingManager-190"><a href="#MemoryClearingManager-190"><span class="linenos">190</span></a>                            <span class="s2">&quot;deleted_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MemoryClearingManager-191"><a href="#MemoryClearingManager-191"><span class="linenos">191</span></a>                        <span class="p">}</span>
</span><span id="MemoryClearingManager-192"><a href="#MemoryClearingManager-192"><span class="linenos">192</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-193"><a href="#MemoryClearingManager-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-194"><a href="#MemoryClearingManager-194"><span class="linenos">194</span></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-195"><a href="#MemoryClearingManager-195"><span class="linenos">195</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Error deleting LightRAG documents: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MemoryClearingManager-196"><a href="#MemoryClearingManager-196"><span class="linenos">196</span></a>                <span class="s2">&quot;deleted_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MemoryClearingManager-197"><a href="#MemoryClearingManager-197"><span class="linenos">197</span></a>            <span class="p">}</span>
</span><span id="MemoryClearingManager-198"><a href="#MemoryClearingManager-198"><span class="linenos">198</span></a>
</span><span id="MemoryClearingManager-199"><a href="#MemoryClearingManager-199"><span class="linenos">199</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_clear_lightrag_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryClearingManager-200"><a href="#MemoryClearingManager-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear LightRAG server cache.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-201"><a href="#MemoryClearingManager-201"><span class="linenos">201</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-202"><a href="#MemoryClearingManager-202"><span class="linenos">202</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="MemoryClearingManager-203"><a href="#MemoryClearingManager-203"><span class="linenos">203</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># Clear all cache modes</span>
</span><span id="MemoryClearingManager-204"><a href="#MemoryClearingManager-204"><span class="linenos">204</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="MemoryClearingManager-205"><a href="#MemoryClearingManager-205"><span class="linenos">205</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">/documents/clear_cache&quot;</span><span class="p">,</span>
</span><span id="MemoryClearingManager-206"><a href="#MemoryClearingManager-206"><span class="linenos">206</span></a>                    <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="MemoryClearingManager-207"><a href="#MemoryClearingManager-207"><span class="linenos">207</span></a>                    <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span>
</span><span id="MemoryClearingManager-208"><a href="#MemoryClearingManager-208"><span class="linenos">208</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="MemoryClearingManager-209"><a href="#MemoryClearingManager-209"><span class="linenos">209</span></a>                    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="MemoryClearingManager-210"><a href="#MemoryClearingManager-210"><span class="linenos">210</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-211"><a href="#MemoryClearingManager-211"><span class="linenos">211</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; LightRAG cache cleared successfully&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-212"><a href="#MemoryClearingManager-212"><span class="linenos">212</span></a>                        <span class="k">return</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-213"><a href="#MemoryClearingManager-213"><span class="linenos">213</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-214"><a href="#MemoryClearingManager-214"><span class="linenos">214</span></a>                        <span class="n">error_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="MemoryClearingManager-215"><a href="#MemoryClearingManager-215"><span class="linenos">215</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Failed to clear LightRAG cache: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-216"><a href="#MemoryClearingManager-216"><span class="linenos">216</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="MemoryClearingManager-217"><a href="#MemoryClearingManager-217"><span class="linenos">217</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-218"><a href="#MemoryClearingManager-218"><span class="linenos">218</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Failed to clear LightRAG cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-219"><a href="#MemoryClearingManager-219"><span class="linenos">219</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="MemoryClearingManager-220"><a href="#MemoryClearingManager-220"><span class="linenos">220</span></a>            
</span><span id="MemoryClearingManager-221"><a href="#MemoryClearingManager-221"><span class="linenos">221</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_delete_knowledge_graph_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryClearingManager-222"><a href="#MemoryClearingManager-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the knowledge graph file from LightRAG storage directories.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-223"><a href="#MemoryClearingManager-223"><span class="linenos">223</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">LIGHTRAG_STORAGE_DIR</span><span class="p">,</span> <span class="n">LIGHTRAG_MEMORY_STORAGE_DIR</span>
</span><span id="MemoryClearingManager-224"><a href="#MemoryClearingManager-224"><span class="linenos">224</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="MemoryClearingManager-225"><a href="#MemoryClearingManager-225"><span class="linenos">225</span></a>        
</span><span id="MemoryClearingManager-226"><a href="#MemoryClearingManager-226"><span class="linenos">226</span></a>        <span class="n">graph_file_paths</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MemoryClearingManager-227"><a href="#MemoryClearingManager-227"><span class="linenos">227</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LIGHTRAG_STORAGE_DIR</span><span class="p">,</span> <span class="s2">&quot;graph_chunk_entity_relation.graphml&quot;</span><span class="p">),</span>
</span><span id="MemoryClearingManager-228"><a href="#MemoryClearingManager-228"><span class="linenos">228</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LIGHTRAG_MEMORY_STORAGE_DIR</span><span class="p">,</span> <span class="s2">&quot;graph_chunk_entity_relation.graphml&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-229"><a href="#MemoryClearingManager-229"><span class="linenos">229</span></a>        <span class="p">]</span>
</span><span id="MemoryClearingManager-230"><a href="#MemoryClearingManager-230"><span class="linenos">230</span></a>        
</span><span id="MemoryClearingManager-231"><a href="#MemoryClearingManager-231"><span class="linenos">231</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-232"><a href="#MemoryClearingManager-232"><span class="linenos">232</span></a>        <span class="k">for</span> <span class="n">graph_file_path</span> <span class="ow">in</span> <span class="n">graph_file_paths</span><span class="p">:</span>
</span><span id="MemoryClearingManager-233"><a href="#MemoryClearingManager-233"><span class="linenos">233</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-234"><a href="#MemoryClearingManager-234"><span class="linenos">234</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">graph_file_path</span><span class="p">):</span>
</span><span id="MemoryClearingManager-235"><a href="#MemoryClearingManager-235"><span class="linenos">235</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">graph_file_path</span><span class="p">)</span>
</span><span id="MemoryClearingManager-236"><a href="#MemoryClearingManager-236"><span class="linenos">236</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-237"><a href="#MemoryClearingManager-237"><span class="linenos">237</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Deleted knowledge graph file: </span><span class="si">{</span><span class="n">graph_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-238"><a href="#MemoryClearingManager-238"><span class="linenos">238</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-239"><a href="#MemoryClearingManager-239"><span class="linenos">239</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-240"><a href="#MemoryClearingManager-240"><span class="linenos">240</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Knowledge graph file not found: </span><span class="si">{</span><span class="n">graph_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-241"><a href="#MemoryClearingManager-241"><span class="linenos">241</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-242"><a href="#MemoryClearingManager-242"><span class="linenos">242</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MemoryClearingManager-243"><a href="#MemoryClearingManager-243"><span class="linenos">243</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Failed to delete knowledge graph file </span><span class="si">{</span><span class="n">graph_file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-244"><a href="#MemoryClearingManager-244"><span class="linenos">244</span></a>                
</span><span id="MemoryClearingManager-245"><a href="#MemoryClearingManager-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">success</span>
</span><span id="MemoryClearingManager-246"><a href="#MemoryClearingManager-246"><span class="linenos">246</span></a>
</span><span id="MemoryClearingManager-247"><a href="#MemoryClearingManager-247"><span class="linenos">247</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_vacuum_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MemoryClearingManager-248"><a href="#MemoryClearingManager-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Vacuum the SQLite database to ensure deletions are committed and space is reclaimed.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-249"><a href="#MemoryClearingManager-249"><span class="linenos">249</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-250"><a href="#MemoryClearingManager-250"><span class="linenos">250</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
</span><span id="MemoryClearingManager-251"><a href="#MemoryClearingManager-251"><span class="linenos">251</span></a>            
</span><span id="MemoryClearingManager-252"><a href="#MemoryClearingManager-252"><span class="linenos">252</span></a>            <span class="c1"># Use the correct database file path that matches the agent</span>
</span><span id="MemoryClearingManager-253"><a href="#MemoryClearingManager-253"><span class="linenos">253</span></a>            <span class="n">agent_db_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="s2">&quot;agent_memory.db&quot;</span>
</span><span id="MemoryClearingManager-254"><a href="#MemoryClearingManager-254"><span class="linenos">254</span></a>            
</span><span id="MemoryClearingManager-255"><a href="#MemoryClearingManager-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="n">agent_db_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="MemoryClearingManager-256"><a href="#MemoryClearingManager-256"><span class="linenos">256</span></a>                <span class="c1"># Connect directly to the SQLite database and vacuum it</span>
</span><span id="MemoryClearingManager-257"><a href="#MemoryClearingManager-257"><span class="linenos">257</span></a>                <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">agent_db_path</span><span class="p">))</span>
</span><span id="MemoryClearingManager-258"><a href="#MemoryClearingManager-258"><span class="linenos">258</span></a>                <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;VACUUM&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-259"><a href="#MemoryClearingManager-259"><span class="linenos">259</span></a>                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="MemoryClearingManager-260"><a href="#MemoryClearingManager-260"><span class="linenos">260</span></a>                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="MemoryClearingManager-261"><a href="#MemoryClearingManager-261"><span class="linenos">261</span></a>                
</span><span id="MemoryClearingManager-262"><a href="#MemoryClearingManager-262"><span class="linenos">262</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-263"><a href="#MemoryClearingManager-263"><span class="linenos">263</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Database vacuumed successfully&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-264"><a href="#MemoryClearingManager-264"><span class="linenos">264</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-265"><a href="#MemoryClearingManager-265"><span class="linenos">265</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-266"><a href="#MemoryClearingManager-266"><span class="linenos">266</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-267"><a href="#MemoryClearingManager-267"><span class="linenos">267</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Database file does not exist, skipping vacuum&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-268"><a href="#MemoryClearingManager-268"><span class="linenos">268</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-269"><a href="#MemoryClearingManager-269"><span class="linenos">269</span></a>                
</span><span id="MemoryClearingManager-270"><a href="#MemoryClearingManager-270"><span class="linenos">270</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-271"><a href="#MemoryClearingManager-271"><span class="linenos">271</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-272"><a href="#MemoryClearingManager-272"><span class="linenos">272</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Warning: Could not vacuum database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-273"><a href="#MemoryClearingManager-273"><span class="linenos">273</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="MemoryClearingManager-274"><a href="#MemoryClearingManager-274"><span class="linenos">274</span></a>
</span><span id="MemoryClearingManager-275"><a href="#MemoryClearingManager-275"><span class="linenos">275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_semantic_memory_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-276"><a href="#MemoryClearingManager-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get statistics about semantic memories.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-277"><a href="#MemoryClearingManager-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span><span class="p">:</span>
</span><span id="MemoryClearingManager-278"><a href="#MemoryClearingManager-278"><span class="linenos">278</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Semantic memory not initialized&quot;</span><span class="p">}</span>
</span><span id="MemoryClearingManager-279"><a href="#MemoryClearingManager-279"><span class="linenos">279</span></a>
</span><span id="MemoryClearingManager-280"><a href="#MemoryClearingManager-280"><span class="linenos">280</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-281"><a href="#MemoryClearingManager-281"><span class="linenos">281</span></a>            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_memory_stats</span><span class="p">(</span>
</span><span id="MemoryClearingManager-282"><a href="#MemoryClearingManager-282"><span class="linenos">282</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span><span class="p">,</span>
</span><span id="MemoryClearingManager-283"><a href="#MemoryClearingManager-283"><span class="linenos">283</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="MemoryClearingManager-284"><a href="#MemoryClearingManager-284"><span class="linenos">284</span></a>            <span class="p">)</span>
</span><span id="MemoryClearingManager-285"><a href="#MemoryClearingManager-285"><span class="linenos">285</span></a>            <span class="k">return</span> <span class="n">stats</span>
</span><span id="MemoryClearingManager-286"><a href="#MemoryClearingManager-286"><span class="linenos">286</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-287"><a href="#MemoryClearingManager-287"><span class="linenos">287</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span><span id="MemoryClearingManager-288"><a href="#MemoryClearingManager-288"><span class="linenos">288</span></a>
</span><span id="MemoryClearingManager-289"><a href="#MemoryClearingManager-289"><span class="linenos">289</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_semantic_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-290"><a href="#MemoryClearingManager-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all semantic memories for the user.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-291"><a href="#MemoryClearingManager-291"><span class="linenos">291</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span><span class="p">:</span>
</span><span id="MemoryClearingManager-292"><a href="#MemoryClearingManager-292"><span class="linenos">292</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Semantic memory not initialized&quot;</span>
</span><span id="MemoryClearingManager-293"><a href="#MemoryClearingManager-293"><span class="linenos">293</span></a>
</span><span id="MemoryClearingManager-294"><a href="#MemoryClearingManager-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
</span><span id="MemoryClearingManager-295"><a href="#MemoryClearingManager-295"><span class="linenos">295</span></a>            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_semantic_memory_stats</span><span class="p">()</span>
</span><span id="MemoryClearingManager-296"><a href="#MemoryClearingManager-296"><span class="linenos">296</span></a>            <span class="n">total_memories</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_memories&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="MemoryClearingManager-297"><a href="#MemoryClearingManager-297"><span class="linenos">297</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;DRY RUN: Would clear </span><span class="si">{</span><span class="n">total_memories</span><span class="si">}</span><span class="s2"> semantic memories&quot;</span>
</span><span id="MemoryClearingManager-298"><a href="#MemoryClearingManager-298"><span class="linenos">298</span></a>
</span><span id="MemoryClearingManager-299"><a href="#MemoryClearingManager-299"><span class="linenos">299</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-300"><a href="#MemoryClearingManager-300"><span class="linenos">300</span></a>            <span class="c1"># Get count before clearing for verification</span>
</span><span id="MemoryClearingManager-301"><a href="#MemoryClearingManager-301"><span class="linenos">301</span></a>            <span class="n">pre_clear_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_semantic_memory_stats</span><span class="p">()</span>
</span><span id="MemoryClearingManager-302"><a href="#MemoryClearingManager-302"><span class="linenos">302</span></a>            <span class="n">pre_clear_count</span> <span class="o">=</span> <span class="n">pre_clear_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_memories&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="MemoryClearingManager-303"><a href="#MemoryClearingManager-303"><span class="linenos">303</span></a>            
</span><span id="MemoryClearingManager-304"><a href="#MemoryClearingManager-304"><span class="linenos">304</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-305"><a href="#MemoryClearingManager-305"><span class="linenos">305</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Pre-clear: </span><span class="si">{</span><span class="n">pre_clear_count</span><span class="si">}</span><span class="s2"> memories found&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-306"><a href="#MemoryClearingManager-306"><span class="linenos">306</span></a>            
</span><span id="MemoryClearingManager-307"><a href="#MemoryClearingManager-307"><span class="linenos">307</span></a>            <span class="c1"># Clear memories using the memory manager</span>
</span><span id="MemoryClearingManager-308"><a href="#MemoryClearingManager-308"><span class="linenos">308</span></a>            <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">clear_memories</span><span class="p">(</span>
</span><span id="MemoryClearingManager-309"><a href="#MemoryClearingManager-309"><span class="linenos">309</span></a>                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span><span class="p">,</span>
</span><span id="MemoryClearingManager-310"><a href="#MemoryClearingManager-310"><span class="linenos">310</span></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="MemoryClearingManager-311"><a href="#MemoryClearingManager-311"><span class="linenos">311</span></a>            <span class="p">)</span>
</span><span id="MemoryClearingManager-312"><a href="#MemoryClearingManager-312"><span class="linenos">312</span></a>            
</span><span id="MemoryClearingManager-313"><a href="#MemoryClearingManager-313"><span class="linenos">313</span></a>            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="MemoryClearingManager-314"><a href="#MemoryClearingManager-314"><span class="linenos">314</span></a>                <span class="c1"># Force database connection to flush and close</span>
</span><span id="MemoryClearingManager-315"><a href="#MemoryClearingManager-315"><span class="linenos">315</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MemoryClearingManager-316"><a href="#MemoryClearingManager-316"><span class="linenos">316</span></a>                    <span class="c1"># Try to close the database connection to ensure changes are persisted</span>
</span><span id="MemoryClearingManager-317"><a href="#MemoryClearingManager-317"><span class="linenos">317</span></a>                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
</span><span id="MemoryClearingManager-318"><a href="#MemoryClearingManager-318"><span class="linenos">318</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="MemoryClearingManager-319"><a href="#MemoryClearingManager-319"><span class="linenos">319</span></a>                    
</span><span id="MemoryClearingManager-320"><a href="#MemoryClearingManager-320"><span class="linenos">320</span></a>                    <span class="c1"># Add a small delay to ensure database operations complete</span>
</span><span id="MemoryClearingManager-321"><a href="#MemoryClearingManager-321"><span class="linenos">321</span></a>                    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="MemoryClearingManager-322"><a href="#MemoryClearingManager-322"><span class="linenos">322</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="MemoryClearingManager-323"><a href="#MemoryClearingManager-323"><span class="linenos">323</span></a>                    
</span><span id="MemoryClearingManager-324"><a href="#MemoryClearingManager-324"><span class="linenos">324</span></a>                    <span class="c1"># Vacuum the database to ensure deletions are committed</span>
</span><span id="MemoryClearingManager-325"><a href="#MemoryClearingManager-325"><span class="linenos">325</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_vacuum_database</span><span class="p">()</span>
</span><span id="MemoryClearingManager-326"><a href="#MemoryClearingManager-326"><span class="linenos">326</span></a>                    
</span><span id="MemoryClearingManager-327"><a href="#MemoryClearingManager-327"><span class="linenos">327</span></a>                    <span class="c1"># Reinitialize the database connection for verification</span>
</span><span id="MemoryClearingManager-328"><a href="#MemoryClearingManager-328"><span class="linenos">328</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_semantic_memory</span><span class="p">()</span>
</span><span id="MemoryClearingManager-329"><a href="#MemoryClearingManager-329"><span class="linenos">329</span></a>                    
</span><span id="MemoryClearingManager-330"><a href="#MemoryClearingManager-330"><span class="linenos">330</span></a>                    <span class="c1"># Verify clearing was successful</span>
</span><span id="MemoryClearingManager-331"><a href="#MemoryClearingManager-331"><span class="linenos">331</span></a>                    <span class="n">post_clear_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_semantic_memory_stats</span><span class="p">()</span>
</span><span id="MemoryClearingManager-332"><a href="#MemoryClearingManager-332"><span class="linenos">332</span></a>                    <span class="n">post_clear_count</span> <span class="o">=</span> <span class="n">post_clear_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_memories&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="MemoryClearingManager-333"><a href="#MemoryClearingManager-333"><span class="linenos">333</span></a>                    
</span><span id="MemoryClearingManager-334"><a href="#MemoryClearingManager-334"><span class="linenos">334</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-335"><a href="#MemoryClearingManager-335"><span class="linenos">335</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Post-clear: </span><span class="si">{</span><span class="n">post_clear_count</span><span class="si">}</span><span class="s2"> memories found&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-336"><a href="#MemoryClearingManager-336"><span class="linenos">336</span></a>                    
</span><span id="MemoryClearingManager-337"><a href="#MemoryClearingManager-337"><span class="linenos">337</span></a>                    <span class="k">if</span> <span class="n">post_clear_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MemoryClearingManager-338"><a href="#MemoryClearingManager-338"><span class="linenos">338</span></a>                        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Successfully cleared </span><span class="si">{</span><span class="n">pre_clear_count</span><span class="si">}</span><span class="s2"> semantic memories (verified)&quot;</span>
</span><span id="MemoryClearingManager-339"><a href="#MemoryClearingManager-339"><span class="linenos">339</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-340"><a href="#MemoryClearingManager-340"><span class="linenos">340</span></a>                        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Clearing incomplete: </span><span class="si">{</span><span class="n">post_clear_count</span><span class="si">}</span><span class="s2"> memories still remain after clearing </span><span class="si">{</span><span class="n">pre_clear_count</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MemoryClearingManager-341"><a href="#MemoryClearingManager-341"><span class="linenos">341</span></a>                        
</span><span id="MemoryClearingManager-342"><a href="#MemoryClearingManager-342"><span class="linenos">342</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-343"><a href="#MemoryClearingManager-343"><span class="linenos">343</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MemoryClearingManager-344"><a href="#MemoryClearingManager-344"><span class="linenos">344</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Warning: Could not verify clearing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-345"><a href="#MemoryClearingManager-345"><span class="linenos">345</span></a>                    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2"> (verification failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="MemoryClearingManager-346"><a href="#MemoryClearingManager-346"><span class="linenos">346</span></a>            
</span><span id="MemoryClearingManager-347"><a href="#MemoryClearingManager-347"><span class="linenos">347</span></a>            <span class="k">return</span> <span class="n">success</span><span class="p">,</span> <span class="n">message</span>
</span><span id="MemoryClearingManager-348"><a href="#MemoryClearingManager-348"><span class="linenos">348</span></a>            
</span><span id="MemoryClearingManager-349"><a href="#MemoryClearingManager-349"><span class="linenos">349</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MemoryClearingManager-350"><a href="#MemoryClearingManager-350"><span class="linenos">350</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error clearing semantic memories: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MemoryClearingManager-351"><a href="#MemoryClearingManager-351"><span class="linenos">351</span></a>
</span><span id="MemoryClearingManager-352"><a href="#MemoryClearingManager-352"><span class="linenos">352</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-353"><a href="#MemoryClearingManager-353"><span class="linenos">353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive status of both memory systems.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-354"><a href="#MemoryClearingManager-354"><span class="linenos">354</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-355"><a href="#MemoryClearingManager-355"><span class="linenos">355</span></a>            <span class="s2">&quot;semantic_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="MemoryClearingManager-356"><a href="#MemoryClearingManager-356"><span class="linenos">356</span></a>            <span class="s2">&quot;lightrag_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;documents&quot;</span><span class="p">:</span> <span class="p">[]},</span>
</span><span id="MemoryClearingManager-357"><a href="#MemoryClearingManager-357"><span class="linenos">357</span></a>        <span class="p">}</span>
</span><span id="MemoryClearingManager-358"><a href="#MemoryClearingManager-358"><span class="linenos">358</span></a>
</span><span id="MemoryClearingManager-359"><a href="#MemoryClearingManager-359"><span class="linenos">359</span></a>        <span class="c1"># Check semantic memory</span>
</span><span id="MemoryClearingManager-360"><a href="#MemoryClearingManager-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_semantic_memory</span><span class="p">():</span>
</span><span id="MemoryClearingManager-361"><a href="#MemoryClearingManager-361"><span class="linenos">361</span></a>            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-362"><a href="#MemoryClearingManager-362"><span class="linenos">362</span></a>            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_semantic_memory_stats</span><span class="p">()</span>
</span><span id="MemoryClearingManager-363"><a href="#MemoryClearingManager-363"><span class="linenos">363</span></a>
</span><span id="MemoryClearingManager-364"><a href="#MemoryClearingManager-364"><span class="linenos">364</span></a>        <span class="c1"># Check LightRAG memory</span>
</span><span id="MemoryClearingManager-365"><a href="#MemoryClearingManager-365"><span class="linenos">365</span></a>        <span class="n">lightrag_available</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_lightrag_server_status</span><span class="p">()</span>
</span><span id="MemoryClearingManager-366"><a href="#MemoryClearingManager-366"><span class="linenos">366</span></a>        <span class="n">status</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lightrag_available</span>
</span><span id="MemoryClearingManager-367"><a href="#MemoryClearingManager-367"><span class="linenos">367</span></a>
</span><span id="MemoryClearingManager-368"><a href="#MemoryClearingManager-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="n">lightrag_available</span><span class="p">:</span>
</span><span id="MemoryClearingManager-369"><a href="#MemoryClearingManager-369"><span class="linenos">369</span></a>            <span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lightrag_documents</span><span class="p">()</span>
</span><span id="MemoryClearingManager-370"><a href="#MemoryClearingManager-370"><span class="linenos">370</span></a>            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">documents</span>
</span><span id="MemoryClearingManager-371"><a href="#MemoryClearingManager-371"><span class="linenos">371</span></a>            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;document_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</span><span id="MemoryClearingManager-372"><a href="#MemoryClearingManager-372"><span class="linenos">372</span></a>
</span><span id="MemoryClearingManager-373"><a href="#MemoryClearingManager-373"><span class="linenos">373</span></a>        <span class="k">return</span> <span class="n">status</span>
</span><span id="MemoryClearingManager-374"><a href="#MemoryClearingManager-374"><span class="linenos">374</span></a>
</span><span id="MemoryClearingManager-375"><a href="#MemoryClearingManager-375"><span class="linenos">375</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_all_memories</span><span class="p">(</span>
</span><span id="MemoryClearingManager-376"><a href="#MemoryClearingManager-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MemoryClearingManager-377"><a href="#MemoryClearingManager-377"><span class="linenos">377</span></a>        <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-378"><a href="#MemoryClearingManager-378"><span class="linenos">378</span></a>        <span class="n">semantic_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-379"><a href="#MemoryClearingManager-379"><span class="linenos">379</span></a>        <span class="n">lightrag_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-380"><a href="#MemoryClearingManager-380"><span class="linenos">380</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-381"><a href="#MemoryClearingManager-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear memories from both systems.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-382"><a href="#MemoryClearingManager-382"><span class="linenos">382</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-383"><a href="#MemoryClearingManager-383"><span class="linenos">383</span></a>            <span class="s2">&quot;semantic_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;attempted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
</span><span id="MemoryClearingManager-384"><a href="#MemoryClearingManager-384"><span class="linenos">384</span></a>            <span class="s2">&quot;lightrag_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;attempted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
</span><span id="MemoryClearingManager-385"><a href="#MemoryClearingManager-385"><span class="linenos">385</span></a>            <span class="s2">&quot;overall_success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-386"><a href="#MemoryClearingManager-386"><span class="linenos">386</span></a>        <span class="p">}</span>
</span><span id="MemoryClearingManager-387"><a href="#MemoryClearingManager-387"><span class="linenos">387</span></a>
</span><span id="MemoryClearingManager-388"><a href="#MemoryClearingManager-388"><span class="linenos">388</span></a>        <span class="c1"># Clear semantic memories</span>
</span><span id="MemoryClearingManager-389"><a href="#MemoryClearingManager-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">lightrag_only</span><span class="p">:</span>
</span><span id="MemoryClearingManager-390"><a href="#MemoryClearingManager-390"><span class="linenos">390</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-391"><a href="#MemoryClearingManager-391"><span class="linenos">391</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_semantic_memory</span><span class="p">():</span>
</span><span id="MemoryClearingManager-392"><a href="#MemoryClearingManager-392"><span class="linenos">392</span></a>                <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_semantic_memories</span><span class="p">(</span><span class="n">dry_run</span><span class="p">)</span>
</span><span id="MemoryClearingManager-393"><a href="#MemoryClearingManager-393"><span class="linenos">393</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">success</span>
</span><span id="MemoryClearingManager-394"><a href="#MemoryClearingManager-394"><span class="linenos">394</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
</span><span id="MemoryClearingManager-395"><a href="#MemoryClearingManager-395"><span class="linenos">395</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-396"><a href="#MemoryClearingManager-396"><span class="linenos">396</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Failed to initialize semantic memory&quot;</span>
</span><span id="MemoryClearingManager-397"><a href="#MemoryClearingManager-397"><span class="linenos">397</span></a>
</span><span id="MemoryClearingManager-398"><a href="#MemoryClearingManager-398"><span class="linenos">398</span></a>        <span class="c1"># Clear LightRAG memories</span>
</span><span id="MemoryClearingManager-399"><a href="#MemoryClearingManager-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">semantic_only</span><span class="p">:</span>
</span><span id="MemoryClearingManager-400"><a href="#MemoryClearingManager-400"><span class="linenos">400</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-401"><a href="#MemoryClearingManager-401"><span class="linenos">401</span></a>            <span class="n">lightrag_available</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_lightrag_server_status</span><span class="p">()</span>
</span><span id="MemoryClearingManager-402"><a href="#MemoryClearingManager-402"><span class="linenos">402</span></a>
</span><span id="MemoryClearingManager-403"><a href="#MemoryClearingManager-403"><span class="linenos">403</span></a>            <span class="k">if</span> <span class="n">lightrag_available</span><span class="p">:</span>
</span><span id="MemoryClearingManager-404"><a href="#MemoryClearingManager-404"><span class="linenos">404</span></a>                <span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lightrag_documents</span><span class="p">()</span>
</span><span id="MemoryClearingManager-405"><a href="#MemoryClearingManager-405"><span class="linenos">405</span></a>                <span class="k">if</span> <span class="n">documents</span><span class="p">:</span>
</span><span id="MemoryClearingManager-406"><a href="#MemoryClearingManager-406"><span class="linenos">406</span></a>                    <span class="n">doc_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">]</span>
</span><span id="MemoryClearingManager-407"><a href="#MemoryClearingManager-407"><span class="linenos">407</span></a>                    <span class="n">clear_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_lightrag_documents</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">,</span> <span class="n">dry_run</span><span class="p">)</span>
</span><span id="MemoryClearingManager-408"><a href="#MemoryClearingManager-408"><span class="linenos">408</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clear_result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span>
</span><span id="MemoryClearingManager-409"><a href="#MemoryClearingManager-409"><span class="linenos">409</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clear_result</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
</span><span id="MemoryClearingManager-410"><a href="#MemoryClearingManager-410"><span class="linenos">410</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-411"><a href="#MemoryClearingManager-411"><span class="linenos">411</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager-412"><a href="#MemoryClearingManager-412"><span class="linenos">412</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;No LightRAG documents to clear&quot;</span>
</span><span id="MemoryClearingManager-413"><a href="#MemoryClearingManager-413"><span class="linenos">413</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager-414"><a href="#MemoryClearingManager-414"><span class="linenos">414</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LightRAG memory server not available&quot;</span>
</span><span id="MemoryClearingManager-415"><a href="#MemoryClearingManager-415"><span class="linenos">415</span></a>
</span><span id="MemoryClearingManager-416"><a href="#MemoryClearingManager-416"><span class="linenos">416</span></a>        <span class="c1"># Determine overall success</span>
</span><span id="MemoryClearingManager-417"><a href="#MemoryClearingManager-417"><span class="linenos">417</span></a>        <span class="n">attempted_systems</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MemoryClearingManager-418"><a href="#MemoryClearingManager-418"><span class="linenos">418</span></a>        <span class="n">successful_systems</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MemoryClearingManager-419"><a href="#MemoryClearingManager-419"><span class="linenos">419</span></a>
</span><span id="MemoryClearingManager-420"><a href="#MemoryClearingManager-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-421"><a href="#MemoryClearingManager-421"><span class="linenos">421</span></a>            <span class="n">attempted_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;semantic&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-422"><a href="#MemoryClearingManager-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-423"><a href="#MemoryClearingManager-423"><span class="linenos">423</span></a>                <span class="n">successful_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;semantic&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-424"><a href="#MemoryClearingManager-424"><span class="linenos">424</span></a>
</span><span id="MemoryClearingManager-425"><a href="#MemoryClearingManager-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-426"><a href="#MemoryClearingManager-426"><span class="linenos">426</span></a>            <span class="n">attempted_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lightrag&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-427"><a href="#MemoryClearingManager-427"><span class="linenos">427</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-428"><a href="#MemoryClearingManager-428"><span class="linenos">428</span></a>                <span class="n">successful_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lightrag&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager-429"><a href="#MemoryClearingManager-429"><span class="linenos">429</span></a>
</span><span id="MemoryClearingManager-430"><a href="#MemoryClearingManager-430"><span class="linenos">430</span></a>        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;overall_success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">successful_systems</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">attempted_systems</span><span class="p">)</span>
</span><span id="MemoryClearingManager-431"><a href="#MemoryClearingManager-431"><span class="linenos">431</span></a>
</span><span id="MemoryClearingManager-432"><a href="#MemoryClearingManager-432"><span class="linenos">432</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="MemoryClearingManager-433"><a href="#MemoryClearingManager-433"><span class="linenos">433</span></a>
</span><span id="MemoryClearingManager-434"><a href="#MemoryClearingManager-434"><span class="linenos">434</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">verify_clearing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MemoryClearingManager-435"><a href="#MemoryClearingManager-435"><span class="linenos">435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that memories have been successfully cleared.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager-436"><a href="#MemoryClearingManager-436"><span class="linenos">436</span></a>        <span class="n">verification</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MemoryClearingManager-437"><a href="#MemoryClearingManager-437"><span class="linenos">437</span></a>            <span class="s2">&quot;semantic_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cleared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;remaining_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
</span><span id="MemoryClearingManager-438"><a href="#MemoryClearingManager-438"><span class="linenos">438</span></a>            <span class="s2">&quot;lightrag_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cleared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;remaining_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
</span><span id="MemoryClearingManager-439"><a href="#MemoryClearingManager-439"><span class="linenos">439</span></a>            <span class="s2">&quot;fully_cleared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager-440"><a href="#MemoryClearingManager-440"><span class="linenos">440</span></a>        <span class="p">}</span>
</span><span id="MemoryClearingManager-441"><a href="#MemoryClearingManager-441"><span class="linenos">441</span></a>
</span><span id="MemoryClearingManager-442"><a href="#MemoryClearingManager-442"><span class="linenos">442</span></a>        <span class="c1"># Verify semantic memory clearing</span>
</span><span id="MemoryClearingManager-443"><a href="#MemoryClearingManager-443"><span class="linenos">443</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_semantic_memory</span><span class="p">():</span>
</span><span id="MemoryClearingManager-444"><a href="#MemoryClearingManager-444"><span class="linenos">444</span></a>            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_semantic_memory_stats</span><span class="p">()</span>
</span><span id="MemoryClearingManager-445"><a href="#MemoryClearingManager-445"><span class="linenos">445</span></a>            <span class="n">remaining_semantic</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_memories&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="MemoryClearingManager-446"><a href="#MemoryClearingManager-446"><span class="linenos">446</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;remaining_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining_semantic</span>
</span><span id="MemoryClearingManager-447"><a href="#MemoryClearingManager-447"><span class="linenos">447</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;cleared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining_semantic</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MemoryClearingManager-448"><a href="#MemoryClearingManager-448"><span class="linenos">448</span></a>
</span><span id="MemoryClearingManager-449"><a href="#MemoryClearingManager-449"><span class="linenos">449</span></a>        <span class="c1"># Verify LightRAG memory clearing</span>
</span><span id="MemoryClearingManager-450"><a href="#MemoryClearingManager-450"><span class="linenos">450</span></a>        <span class="n">lightrag_available</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_lightrag_server_status</span><span class="p">()</span>
</span><span id="MemoryClearingManager-451"><a href="#MemoryClearingManager-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="n">lightrag_available</span><span class="p">:</span>
</span><span id="MemoryClearingManager-452"><a href="#MemoryClearingManager-452"><span class="linenos">452</span></a>            <span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lightrag_documents</span><span class="p">()</span>
</span><span id="MemoryClearingManager-453"><a href="#MemoryClearingManager-453"><span class="linenos">453</span></a>            <span class="n">remaining_lightrag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</span><span id="MemoryClearingManager-454"><a href="#MemoryClearingManager-454"><span class="linenos">454</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;remaining_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining_lightrag</span>
</span><span id="MemoryClearingManager-455"><a href="#MemoryClearingManager-455"><span class="linenos">455</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;cleared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining_lightrag</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MemoryClearingManager-456"><a href="#MemoryClearingManager-456"><span class="linenos">456</span></a>
</span><span id="MemoryClearingManager-457"><a href="#MemoryClearingManager-457"><span class="linenos">457</span></a>        <span class="c1"># Overall verification</span>
</span><span id="MemoryClearingManager-458"><a href="#MemoryClearingManager-458"><span class="linenos">458</span></a>        <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;fully_cleared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MemoryClearingManager-459"><a href="#MemoryClearingManager-459"><span class="linenos">459</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;cleared&quot;</span><span class="p">]</span> <span class="ow">and</span>
</span><span id="MemoryClearingManager-460"><a href="#MemoryClearingManager-460"><span class="linenos">460</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;cleared&quot;</span><span class="p">]</span>
</span><span id="MemoryClearingManager-461"><a href="#MemoryClearingManager-461"><span class="linenos">461</span></a>        <span class="p">)</span>
</span><span id="MemoryClearingManager-462"><a href="#MemoryClearingManager-462"><span class="linenos">462</span></a>
</span><span id="MemoryClearingManager-463"><a href="#MemoryClearingManager-463"><span class="linenos">463</span></a>        <span class="k">return</span> <span class="n">verification</span>
</span></pre></div>


            <div class="docstring"><p>Manages the clearing of both semantic and LightRAG graph memories.</p>
</div>


                            <div id="MemoryClearingManager.__init__" class="classattr">
                                        <input id="MemoryClearingManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MemoryClearingManager</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/Shared/personal_agent_data/agno/charlie&#39;</span>,</span><span class="param">	<span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:9622&#39;</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="MemoryClearingManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryClearingManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryClearingManager.__init__-33"><a href="#MemoryClearingManager.__init__-33"><span class="linenos">33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MemoryClearingManager.__init__-34"><a href="#MemoryClearingManager.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MemoryClearingManager.__init__-35"><a href="#MemoryClearingManager.__init__-35"><span class="linenos">35</span></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MemoryClearingManager.__init__-36"><a href="#MemoryClearingManager.__init__-36"><span class="linenos">36</span></a>        <span class="n">storage_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">AGNO_STORAGE_DIR</span><span class="p">,</span>
</span><span id="MemoryClearingManager.__init__-37"><a href="#MemoryClearingManager.__init__-37"><span class="linenos">37</span></a>        <span class="n">lightrag_memory_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">LIGHTRAG_MEMORY_URL</span><span class="p">,</span>
</span><span id="MemoryClearingManager.__init__-38"><a href="#MemoryClearingManager.__init__-38"><span class="linenos">38</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager.__init__-39"><a href="#MemoryClearingManager.__init__-39"><span class="linenos">39</span></a>    <span class="p">):</span>
</span><span id="MemoryClearingManager.__init__-40"><a href="#MemoryClearingManager.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="MemoryClearingManager.__init__-41"><a href="#MemoryClearingManager.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">)</span>
</span><span id="MemoryClearingManager.__init__-42"><a href="#MemoryClearingManager.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span> <span class="o">=</span> <span class="n">lightrag_memory_url</span>
</span><span id="MemoryClearingManager.__init__-43"><a href="#MemoryClearingManager.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="MemoryClearingManager.__init__-44"><a href="#MemoryClearingManager.__init__-44"><span class="linenos">44</span></a>
</span><span id="MemoryClearingManager.__init__-45"><a href="#MemoryClearingManager.__init__-45"><span class="linenos">45</span></a>        <span class="c1"># Initialize semantic memory components</span>
</span><span id="MemoryClearingManager.__init__-46"><a href="#MemoryClearingManager.__init__-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">semantic_db_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="s2">&quot;semantic_memory.db&quot;</span>
</span><span id="MemoryClearingManager.__init__-47"><a href="#MemoryClearingManager.__init__-47"><span class="linenos">47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memory_db</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MemoryClearingManager.__init__-48"><a href="#MemoryClearingManager.__init__-48"><span class="linenos">48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MemoryClearingManager.__init__-49"><a href="#MemoryClearingManager.__init__-49"><span class="linenos">49</span></a>
</span><span id="MemoryClearingManager.__init__-50"><a href="#MemoryClearingManager.__init__-50"><span class="linenos">50</span></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MemoryClearingManager.__init__-51"><a href="#MemoryClearingManager.__init__-51"><span class="linenos">51</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_userid</span><span class="p">()</span>
</span><span id="MemoryClearingManager.__init__-52"><a href="#MemoryClearingManager.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="MemoryClearingManager.__init__-53"><a href="#MemoryClearingManager.__init__-53"><span class="linenos">53</span></a>        
</span><span id="MemoryClearingManager.__init__-54"><a href="#MemoryClearingManager.__init__-54"><span class="linenos">54</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Memory Clearing Manager initialized&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager.__init__-55"><a href="#MemoryClearingManager.__init__-55"><span class="linenos">55</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   User ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager.__init__-56"><a href="#MemoryClearingManager.__init__-56"><span class="linenos">56</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Storage Directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager.__init__-57"><a href="#MemoryClearingManager.__init__-57"><span class="linenos">57</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   LightRAG Memory URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lightrag_memory_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager.__init__-58"><a href="#MemoryClearingManager.__init__-58"><span class="linenos">58</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Semantic DB Path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">semantic_db_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MemoryClearingManager.user_id" class="classattr">
                                <div class="attr variable">
            <span class="name">user_id</span>

        
    </div>
    <a class="headerlink" href="#MemoryClearingManager.user_id"></a>
    
    

                            </div>
                            <div id="MemoryClearingManager.storage_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">storage_dir</span>

        
    </div>
    <a class="headerlink" href="#MemoryClearingManager.storage_dir"></a>
    
    

                            </div>
                            <div id="MemoryClearingManager.lightrag_memory_url" class="classattr">
                                <div class="attr variable">
            <span class="name">lightrag_memory_url</span>

        
    </div>
    <a class="headerlink" href="#MemoryClearingManager.lightrag_memory_url"></a>
    
    

                            </div>
                            <div id="MemoryClearingManager.verbose" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose</span>

        
    </div>
    <a class="headerlink" href="#MemoryClearingManager.verbose"></a>
    
    

                            </div>
                            <div id="MemoryClearingManager.semantic_db_path" class="classattr">
                                <div class="attr variable">
            <span class="name">semantic_db_path</span>

        
    </div>
    <a class="headerlink" href="#MemoryClearingManager.semantic_db_path"></a>
    
    

                            </div>
                            <div id="MemoryClearingManager.memory_db" class="classattr">
                                <div class="attr variable">
            <span class="name">memory_db</span>

        
    </div>
    <a class="headerlink" href="#MemoryClearingManager.memory_db"></a>
    
    

                            </div>
                            <div id="MemoryClearingManager.memory_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">memory_manager</span>

        
    </div>
    <a class="headerlink" href="#MemoryClearingManager.memory_manager"></a>
    
    

                            </div>
                            <div id="MemoryClearingManager.get_memory_status" class="classattr">
                                        <input id="MemoryClearingManager.get_memory_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_memory_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MemoryClearingManager.get_memory_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryClearingManager.get_memory_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryClearingManager.get_memory_status-352"><a href="#MemoryClearingManager.get_memory_status-352"><span class="linenos">352</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MemoryClearingManager.get_memory_status-353"><a href="#MemoryClearingManager.get_memory_status-353"><span class="linenos">353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive status of both memory systems.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager.get_memory_status-354"><a href="#MemoryClearingManager.get_memory_status-354"><span class="linenos">354</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MemoryClearingManager.get_memory_status-355"><a href="#MemoryClearingManager.get_memory_status-355"><span class="linenos">355</span></a>            <span class="s2">&quot;semantic_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="MemoryClearingManager.get_memory_status-356"><a href="#MemoryClearingManager.get_memory_status-356"><span class="linenos">356</span></a>            <span class="s2">&quot;lightrag_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;documents&quot;</span><span class="p">:</span> <span class="p">[]},</span>
</span><span id="MemoryClearingManager.get_memory_status-357"><a href="#MemoryClearingManager.get_memory_status-357"><span class="linenos">357</span></a>        <span class="p">}</span>
</span><span id="MemoryClearingManager.get_memory_status-358"><a href="#MemoryClearingManager.get_memory_status-358"><span class="linenos">358</span></a>
</span><span id="MemoryClearingManager.get_memory_status-359"><a href="#MemoryClearingManager.get_memory_status-359"><span class="linenos">359</span></a>        <span class="c1"># Check semantic memory</span>
</span><span id="MemoryClearingManager.get_memory_status-360"><a href="#MemoryClearingManager.get_memory_status-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_semantic_memory</span><span class="p">():</span>
</span><span id="MemoryClearingManager.get_memory_status-361"><a href="#MemoryClearingManager.get_memory_status-361"><span class="linenos">361</span></a>            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager.get_memory_status-362"><a href="#MemoryClearingManager.get_memory_status-362"><span class="linenos">362</span></a>            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_semantic_memory_stats</span><span class="p">()</span>
</span><span id="MemoryClearingManager.get_memory_status-363"><a href="#MemoryClearingManager.get_memory_status-363"><span class="linenos">363</span></a>
</span><span id="MemoryClearingManager.get_memory_status-364"><a href="#MemoryClearingManager.get_memory_status-364"><span class="linenos">364</span></a>        <span class="c1"># Check LightRAG memory</span>
</span><span id="MemoryClearingManager.get_memory_status-365"><a href="#MemoryClearingManager.get_memory_status-365"><span class="linenos">365</span></a>        <span class="n">lightrag_available</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_lightrag_server_status</span><span class="p">()</span>
</span><span id="MemoryClearingManager.get_memory_status-366"><a href="#MemoryClearingManager.get_memory_status-366"><span class="linenos">366</span></a>        <span class="n">status</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lightrag_available</span>
</span><span id="MemoryClearingManager.get_memory_status-367"><a href="#MemoryClearingManager.get_memory_status-367"><span class="linenos">367</span></a>
</span><span id="MemoryClearingManager.get_memory_status-368"><a href="#MemoryClearingManager.get_memory_status-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="n">lightrag_available</span><span class="p">:</span>
</span><span id="MemoryClearingManager.get_memory_status-369"><a href="#MemoryClearingManager.get_memory_status-369"><span class="linenos">369</span></a>            <span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lightrag_documents</span><span class="p">()</span>
</span><span id="MemoryClearingManager.get_memory_status-370"><a href="#MemoryClearingManager.get_memory_status-370"><span class="linenos">370</span></a>            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">documents</span>
</span><span id="MemoryClearingManager.get_memory_status-371"><a href="#MemoryClearingManager.get_memory_status-371"><span class="linenos">371</span></a>            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;document_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</span><span id="MemoryClearingManager.get_memory_status-372"><a href="#MemoryClearingManager.get_memory_status-372"><span class="linenos">372</span></a>
</span><span id="MemoryClearingManager.get_memory_status-373"><a href="#MemoryClearingManager.get_memory_status-373"><span class="linenos">373</span></a>        <span class="k">return</span> <span class="n">status</span>
</span></pre></div>


            <div class="docstring"><p>Get comprehensive status of both memory systems.</p>
</div>


                            </div>
                            <div id="MemoryClearingManager.clear_all_memories" class="classattr">
                                        <input id="MemoryClearingManager.clear_all_memories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">clear_all_memories</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">semantic_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">lightrag_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MemoryClearingManager.clear_all_memories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryClearingManager.clear_all_memories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryClearingManager.clear_all_memories-375"><a href="#MemoryClearingManager.clear_all_memories-375"><span class="linenos">375</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_all_memories</span><span class="p">(</span>
</span><span id="MemoryClearingManager.clear_all_memories-376"><a href="#MemoryClearingManager.clear_all_memories-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MemoryClearingManager.clear_all_memories-377"><a href="#MemoryClearingManager.clear_all_memories-377"><span class="linenos">377</span></a>        <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager.clear_all_memories-378"><a href="#MemoryClearingManager.clear_all_memories-378"><span class="linenos">378</span></a>        <span class="n">semantic_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager.clear_all_memories-379"><a href="#MemoryClearingManager.clear_all_memories-379"><span class="linenos">379</span></a>        <span class="n">lightrag_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager.clear_all_memories-380"><a href="#MemoryClearingManager.clear_all_memories-380"><span class="linenos">380</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MemoryClearingManager.clear_all_memories-381"><a href="#MemoryClearingManager.clear_all_memories-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear memories from both systems.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager.clear_all_memories-382"><a href="#MemoryClearingManager.clear_all_memories-382"><span class="linenos">382</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MemoryClearingManager.clear_all_memories-383"><a href="#MemoryClearingManager.clear_all_memories-383"><span class="linenos">383</span></a>            <span class="s2">&quot;semantic_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;attempted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
</span><span id="MemoryClearingManager.clear_all_memories-384"><a href="#MemoryClearingManager.clear_all_memories-384"><span class="linenos">384</span></a>            <span class="s2">&quot;lightrag_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;attempted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
</span><span id="MemoryClearingManager.clear_all_memories-385"><a href="#MemoryClearingManager.clear_all_memories-385"><span class="linenos">385</span></a>            <span class="s2">&quot;overall_success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager.clear_all_memories-386"><a href="#MemoryClearingManager.clear_all_memories-386"><span class="linenos">386</span></a>        <span class="p">}</span>
</span><span id="MemoryClearingManager.clear_all_memories-387"><a href="#MemoryClearingManager.clear_all_memories-387"><span class="linenos">387</span></a>
</span><span id="MemoryClearingManager.clear_all_memories-388"><a href="#MemoryClearingManager.clear_all_memories-388"><span class="linenos">388</span></a>        <span class="c1"># Clear semantic memories</span>
</span><span id="MemoryClearingManager.clear_all_memories-389"><a href="#MemoryClearingManager.clear_all_memories-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">lightrag_only</span><span class="p">:</span>
</span><span id="MemoryClearingManager.clear_all_memories-390"><a href="#MemoryClearingManager.clear_all_memories-390"><span class="linenos">390</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager.clear_all_memories-391"><a href="#MemoryClearingManager.clear_all_memories-391"><span class="linenos">391</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_semantic_memory</span><span class="p">():</span>
</span><span id="MemoryClearingManager.clear_all_memories-392"><a href="#MemoryClearingManager.clear_all_memories-392"><span class="linenos">392</span></a>                <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_semantic_memories</span><span class="p">(</span><span class="n">dry_run</span><span class="p">)</span>
</span><span id="MemoryClearingManager.clear_all_memories-393"><a href="#MemoryClearingManager.clear_all_memories-393"><span class="linenos">393</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">success</span>
</span><span id="MemoryClearingManager.clear_all_memories-394"><a href="#MemoryClearingManager.clear_all_memories-394"><span class="linenos">394</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
</span><span id="MemoryClearingManager.clear_all_memories-395"><a href="#MemoryClearingManager.clear_all_memories-395"><span class="linenos">395</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager.clear_all_memories-396"><a href="#MemoryClearingManager.clear_all_memories-396"><span class="linenos">396</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Failed to initialize semantic memory&quot;</span>
</span><span id="MemoryClearingManager.clear_all_memories-397"><a href="#MemoryClearingManager.clear_all_memories-397"><span class="linenos">397</span></a>
</span><span id="MemoryClearingManager.clear_all_memories-398"><a href="#MemoryClearingManager.clear_all_memories-398"><span class="linenos">398</span></a>        <span class="c1"># Clear LightRAG memories</span>
</span><span id="MemoryClearingManager.clear_all_memories-399"><a href="#MemoryClearingManager.clear_all_memories-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">semantic_only</span><span class="p">:</span>
</span><span id="MemoryClearingManager.clear_all_memories-400"><a href="#MemoryClearingManager.clear_all_memories-400"><span class="linenos">400</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager.clear_all_memories-401"><a href="#MemoryClearingManager.clear_all_memories-401"><span class="linenos">401</span></a>            <span class="n">lightrag_available</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_lightrag_server_status</span><span class="p">()</span>
</span><span id="MemoryClearingManager.clear_all_memories-402"><a href="#MemoryClearingManager.clear_all_memories-402"><span class="linenos">402</span></a>
</span><span id="MemoryClearingManager.clear_all_memories-403"><a href="#MemoryClearingManager.clear_all_memories-403"><span class="linenos">403</span></a>            <span class="k">if</span> <span class="n">lightrag_available</span><span class="p">:</span>
</span><span id="MemoryClearingManager.clear_all_memories-404"><a href="#MemoryClearingManager.clear_all_memories-404"><span class="linenos">404</span></a>                <span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lightrag_documents</span><span class="p">()</span>
</span><span id="MemoryClearingManager.clear_all_memories-405"><a href="#MemoryClearingManager.clear_all_memories-405"><span class="linenos">405</span></a>                <span class="k">if</span> <span class="n">documents</span><span class="p">:</span>
</span><span id="MemoryClearingManager.clear_all_memories-406"><a href="#MemoryClearingManager.clear_all_memories-406"><span class="linenos">406</span></a>                    <span class="n">doc_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">]</span>
</span><span id="MemoryClearingManager.clear_all_memories-407"><a href="#MemoryClearingManager.clear_all_memories-407"><span class="linenos">407</span></a>                    <span class="n">clear_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_lightrag_documents</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">,</span> <span class="n">dry_run</span><span class="p">)</span>
</span><span id="MemoryClearingManager.clear_all_memories-408"><a href="#MemoryClearingManager.clear_all_memories-408"><span class="linenos">408</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clear_result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span>
</span><span id="MemoryClearingManager.clear_all_memories-409"><a href="#MemoryClearingManager.clear_all_memories-409"><span class="linenos">409</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clear_result</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
</span><span id="MemoryClearingManager.clear_all_memories-410"><a href="#MemoryClearingManager.clear_all_memories-410"><span class="linenos">410</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager.clear_all_memories-411"><a href="#MemoryClearingManager.clear_all_memories-411"><span class="linenos">411</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MemoryClearingManager.clear_all_memories-412"><a href="#MemoryClearingManager.clear_all_memories-412"><span class="linenos">412</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;No LightRAG documents to clear&quot;</span>
</span><span id="MemoryClearingManager.clear_all_memories-413"><a href="#MemoryClearingManager.clear_all_memories-413"><span class="linenos">413</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MemoryClearingManager.clear_all_memories-414"><a href="#MemoryClearingManager.clear_all_memories-414"><span class="linenos">414</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LightRAG memory server not available&quot;</span>
</span><span id="MemoryClearingManager.clear_all_memories-415"><a href="#MemoryClearingManager.clear_all_memories-415"><span class="linenos">415</span></a>
</span><span id="MemoryClearingManager.clear_all_memories-416"><a href="#MemoryClearingManager.clear_all_memories-416"><span class="linenos">416</span></a>        <span class="c1"># Determine overall success</span>
</span><span id="MemoryClearingManager.clear_all_memories-417"><a href="#MemoryClearingManager.clear_all_memories-417"><span class="linenos">417</span></a>        <span class="n">attempted_systems</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MemoryClearingManager.clear_all_memories-418"><a href="#MemoryClearingManager.clear_all_memories-418"><span class="linenos">418</span></a>        <span class="n">successful_systems</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MemoryClearingManager.clear_all_memories-419"><a href="#MemoryClearingManager.clear_all_memories-419"><span class="linenos">419</span></a>
</span><span id="MemoryClearingManager.clear_all_memories-420"><a href="#MemoryClearingManager.clear_all_memories-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="MemoryClearingManager.clear_all_memories-421"><a href="#MemoryClearingManager.clear_all_memories-421"><span class="linenos">421</span></a>            <span class="n">attempted_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;semantic&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager.clear_all_memories-422"><a href="#MemoryClearingManager.clear_all_memories-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
</span><span id="MemoryClearingManager.clear_all_memories-423"><a href="#MemoryClearingManager.clear_all_memories-423"><span class="linenos">423</span></a>                <span class="n">successful_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;semantic&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager.clear_all_memories-424"><a href="#MemoryClearingManager.clear_all_memories-424"><span class="linenos">424</span></a>
</span><span id="MemoryClearingManager.clear_all_memories-425"><a href="#MemoryClearingManager.clear_all_memories-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;attempted&quot;</span><span class="p">]:</span>
</span><span id="MemoryClearingManager.clear_all_memories-426"><a href="#MemoryClearingManager.clear_all_memories-426"><span class="linenos">426</span></a>            <span class="n">attempted_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lightrag&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager.clear_all_memories-427"><a href="#MemoryClearingManager.clear_all_memories-427"><span class="linenos">427</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
</span><span id="MemoryClearingManager.clear_all_memories-428"><a href="#MemoryClearingManager.clear_all_memories-428"><span class="linenos">428</span></a>                <span class="n">successful_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lightrag&quot;</span><span class="p">)</span>
</span><span id="MemoryClearingManager.clear_all_memories-429"><a href="#MemoryClearingManager.clear_all_memories-429"><span class="linenos">429</span></a>
</span><span id="MemoryClearingManager.clear_all_memories-430"><a href="#MemoryClearingManager.clear_all_memories-430"><span class="linenos">430</span></a>        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;overall_success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">successful_systems</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">attempted_systems</span><span class="p">)</span>
</span><span id="MemoryClearingManager.clear_all_memories-431"><a href="#MemoryClearingManager.clear_all_memories-431"><span class="linenos">431</span></a>
</span><span id="MemoryClearingManager.clear_all_memories-432"><a href="#MemoryClearingManager.clear_all_memories-432"><span class="linenos">432</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Clear memories from both systems.</p>
</div>


                            </div>
                            <div id="MemoryClearingManager.verify_clearing" class="classattr">
                                        <input id="MemoryClearingManager.verify_clearing-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">verify_clearing</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MemoryClearingManager.verify_clearing-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MemoryClearingManager.verify_clearing"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MemoryClearingManager.verify_clearing-434"><a href="#MemoryClearingManager.verify_clearing-434"><span class="linenos">434</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">verify_clearing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MemoryClearingManager.verify_clearing-435"><a href="#MemoryClearingManager.verify_clearing-435"><span class="linenos">435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that memories have been successfully cleared.&quot;&quot;&quot;</span>
</span><span id="MemoryClearingManager.verify_clearing-436"><a href="#MemoryClearingManager.verify_clearing-436"><span class="linenos">436</span></a>        <span class="n">verification</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MemoryClearingManager.verify_clearing-437"><a href="#MemoryClearingManager.verify_clearing-437"><span class="linenos">437</span></a>            <span class="s2">&quot;semantic_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cleared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;remaining_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
</span><span id="MemoryClearingManager.verify_clearing-438"><a href="#MemoryClearingManager.verify_clearing-438"><span class="linenos">438</span></a>            <span class="s2">&quot;lightrag_memory&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cleared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;remaining_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
</span><span id="MemoryClearingManager.verify_clearing-439"><a href="#MemoryClearingManager.verify_clearing-439"><span class="linenos">439</span></a>            <span class="s2">&quot;fully_cleared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MemoryClearingManager.verify_clearing-440"><a href="#MemoryClearingManager.verify_clearing-440"><span class="linenos">440</span></a>        <span class="p">}</span>
</span><span id="MemoryClearingManager.verify_clearing-441"><a href="#MemoryClearingManager.verify_clearing-441"><span class="linenos">441</span></a>
</span><span id="MemoryClearingManager.verify_clearing-442"><a href="#MemoryClearingManager.verify_clearing-442"><span class="linenos">442</span></a>        <span class="c1"># Verify semantic memory clearing</span>
</span><span id="MemoryClearingManager.verify_clearing-443"><a href="#MemoryClearingManager.verify_clearing-443"><span class="linenos">443</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_semantic_memory</span><span class="p">():</span>
</span><span id="MemoryClearingManager.verify_clearing-444"><a href="#MemoryClearingManager.verify_clearing-444"><span class="linenos">444</span></a>            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_semantic_memory_stats</span><span class="p">()</span>
</span><span id="MemoryClearingManager.verify_clearing-445"><a href="#MemoryClearingManager.verify_clearing-445"><span class="linenos">445</span></a>            <span class="n">remaining_semantic</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_memories&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="MemoryClearingManager.verify_clearing-446"><a href="#MemoryClearingManager.verify_clearing-446"><span class="linenos">446</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;remaining_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining_semantic</span>
</span><span id="MemoryClearingManager.verify_clearing-447"><a href="#MemoryClearingManager.verify_clearing-447"><span class="linenos">447</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;cleared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining_semantic</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MemoryClearingManager.verify_clearing-448"><a href="#MemoryClearingManager.verify_clearing-448"><span class="linenos">448</span></a>
</span><span id="MemoryClearingManager.verify_clearing-449"><a href="#MemoryClearingManager.verify_clearing-449"><span class="linenos">449</span></a>        <span class="c1"># Verify LightRAG memory clearing</span>
</span><span id="MemoryClearingManager.verify_clearing-450"><a href="#MemoryClearingManager.verify_clearing-450"><span class="linenos">450</span></a>        <span class="n">lightrag_available</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_lightrag_server_status</span><span class="p">()</span>
</span><span id="MemoryClearingManager.verify_clearing-451"><a href="#MemoryClearingManager.verify_clearing-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="n">lightrag_available</span><span class="p">:</span>
</span><span id="MemoryClearingManager.verify_clearing-452"><a href="#MemoryClearingManager.verify_clearing-452"><span class="linenos">452</span></a>            <span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lightrag_documents</span><span class="p">()</span>
</span><span id="MemoryClearingManager.verify_clearing-453"><a href="#MemoryClearingManager.verify_clearing-453"><span class="linenos">453</span></a>            <span class="n">remaining_lightrag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</span><span id="MemoryClearingManager.verify_clearing-454"><a href="#MemoryClearingManager.verify_clearing-454"><span class="linenos">454</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;remaining_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining_lightrag</span>
</span><span id="MemoryClearingManager.verify_clearing-455"><a href="#MemoryClearingManager.verify_clearing-455"><span class="linenos">455</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;cleared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining_lightrag</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MemoryClearingManager.verify_clearing-456"><a href="#MemoryClearingManager.verify_clearing-456"><span class="linenos">456</span></a>
</span><span id="MemoryClearingManager.verify_clearing-457"><a href="#MemoryClearingManager.verify_clearing-457"><span class="linenos">457</span></a>        <span class="c1"># Overall verification</span>
</span><span id="MemoryClearingManager.verify_clearing-458"><a href="#MemoryClearingManager.verify_clearing-458"><span class="linenos">458</span></a>        <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;fully_cleared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MemoryClearingManager.verify_clearing-459"><a href="#MemoryClearingManager.verify_clearing-459"><span class="linenos">459</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;semantic_memory&quot;</span><span class="p">][</span><span class="s2">&quot;cleared&quot;</span><span class="p">]</span> <span class="ow">and</span>
</span><span id="MemoryClearingManager.verify_clearing-460"><a href="#MemoryClearingManager.verify_clearing-460"><span class="linenos">460</span></a>            <span class="n">verification</span><span class="p">[</span><span class="s2">&quot;lightrag_memory&quot;</span><span class="p">][</span><span class="s2">&quot;cleared&quot;</span><span class="p">]</span>
</span><span id="MemoryClearingManager.verify_clearing-461"><a href="#MemoryClearingManager.verify_clearing-461"><span class="linenos">461</span></a>        <span class="p">)</span>
</span><span id="MemoryClearingManager.verify_clearing-462"><a href="#MemoryClearingManager.verify_clearing-462"><span class="linenos">462</span></a>
</span><span id="MemoryClearingManager.verify_clearing-463"><a href="#MemoryClearingManager.verify_clearing-463"><span class="linenos">463</span></a>        <span class="k">return</span> <span class="n">verification</span>
</span></pre></div>


            <div class="docstring"><p>Verify that memories have been successfully cleared.</p>
</div>


                            </div>
                </section>
                <section id="show_config">
                            <input id="show_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">no_color</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">json_output</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="show_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#show_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="show_config-715"><a href="#show_config-715"><span class="linenos">715</span></a><span class="k">def</span><span class="w"> </span><span class="nf">show_config</span><span class="p">(</span><span class="n">no_color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">json_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="show_config-716"><a href="#show_config-716"><span class="linenos">716</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main function to display configuration.</span>
</span><span id="show_config-717"><a href="#show_config-717"><span class="linenos">717</span></a><span class="sd">    </span>
</span><span id="show_config-718"><a href="#show_config-718"><span class="linenos">718</span></a><span class="sd">    Args:</span>
</span><span id="show_config-719"><a href="#show_config-719"><span class="linenos">719</span></a><span class="sd">        no_color (bool): If True, disable colored output</span>
</span><span id="show_config-720"><a href="#show_config-720"><span class="linenos">720</span></a><span class="sd">        json_output (bool): If True, output as JSON</span>
</span><span id="show_config-721"><a href="#show_config-721"><span class="linenos">721</span></a><span class="sd">        </span>
</span><span id="show_config-722"><a href="#show_config-722"><span class="linenos">722</span></a><span class="sd">    Returns:</span>
</span><span id="show_config-723"><a href="#show_config-723"><span class="linenos">723</span></a><span class="sd">        str: JSON string if json_output=True, otherwise None</span>
</span><span id="show_config-724"><a href="#show_config-724"><span class="linenos">724</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="show_config-725"><a href="#show_config-725"><span class="linenos">725</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="show_config-726"><a href="#show_config-726"><span class="linenos">726</span></a>        <span class="k">if</span> <span class="n">json_output</span><span class="p">:</span>
</span><span id="show_config-727"><a href="#show_config-727"><span class="linenos">727</span></a>            <span class="k">return</span> <span class="n">output_json</span><span class="p">()</span>
</span><span id="show_config-728"><a href="#show_config-728"><span class="linenos">728</span></a>        <span class="k">elif</span> <span class="n">no_color</span><span class="p">:</span>
</span><span id="show_config-729"><a href="#show_config-729"><span class="linenos">729</span></a>            <span class="n">print_config_no_color</span><span class="p">()</span>
</span><span id="show_config-730"><a href="#show_config-730"><span class="linenos">730</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="show_config-731"><a href="#show_config-731"><span class="linenos">731</span></a>            <span class="c1"># Default to colored fancy output</span>
</span><span id="show_config-732"><a href="#show_config-732"><span class="linenos">732</span></a>            <span class="n">print_config_colored</span><span class="p">()</span>
</span><span id="show_config-733"><a href="#show_config-733"><span class="linenos">733</span></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="show_config-734"><a href="#show_config-734"><span class="linenos">734</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Operation cancelled by user.&quot;</span><span class="p">)</span>
</span><span id="show_config-735"><a href="#show_config-735"><span class="linenos">735</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="show_config-736"><a href="#show_config-736"><span class="linenos">736</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="show_config-737"><a href="#show_config-737"><span class="linenos">737</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="show_config-738"><a href="#show_config-738"><span class="linenos">738</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Main function to display configuration.</p>

<p>Args:
    no_color (bool): If True, disable colored output
    json_output (bool): If True, output as JSON</p>

<p>Returns:
    str: JSON string if json_output=True, otherwise None</p>
</div>


                </section>
                <section id="get_all_tools">
                            <input id="get_all_tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_tools</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">mcp_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">weaviate_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vector_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">langchain_core</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseTool</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_all_tools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_all_tools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_all_tools-69"><a href="#get_all_tools-69"><span class="linenos"> 69</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_all_tools</span><span class="p">(</span>
</span><span id="get_all_tools-70"><a href="#get_all_tools-70"><span class="linenos"> 70</span></a>    <span class="n">mcp_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_all_tools-71"><a href="#get_all_tools-71"><span class="linenos"> 71</span></a>    <span class="n">weaviate_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_all_tools-72"><a href="#get_all_tools-72"><span class="linenos"> 72</span></a>    <span class="n">vector_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_all_tools-73"><a href="#get_all_tools-73"><span class="linenos"> 73</span></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_all_tools-74"><a href="#get_all_tools-74"><span class="linenos"> 74</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;BaseTool&quot;</span><span class="p">]:</span>
</span><span id="get_all_tools-75"><a href="#get_all_tools-75"><span class="linenos"> 75</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_all_tools-76"><a href="#get_all_tools-76"><span class="linenos"> 76</span></a><span class="sd">    Get all available tools with injected dependencies.</span>
</span><span id="get_all_tools-77"><a href="#get_all_tools-77"><span class="linenos"> 77</span></a>
</span><span id="get_all_tools-78"><a href="#get_all_tools-78"><span class="linenos"> 78</span></a><span class="sd">    Args:</span>
</span><span id="get_all_tools-79"><a href="#get_all_tools-79"><span class="linenos"> 79</span></a><span class="sd">        mcp_client: MCP client for file operations and external tools</span>
</span><span id="get_all_tools-80"><a href="#get_all_tools-80"><span class="linenos"> 80</span></a><span class="sd">        weaviate_client: Weaviate client for vector operations</span>
</span><span id="get_all_tools-81"><a href="#get_all_tools-81"><span class="linenos"> 81</span></a><span class="sd">        vector_store: Vector store for knowledge base operations</span>
</span><span id="get_all_tools-82"><a href="#get_all_tools-82"><span class="linenos"> 82</span></a><span class="sd">        logger: Logger instance for tool operations</span>
</span><span id="get_all_tools-83"><a href="#get_all_tools-83"><span class="linenos"> 83</span></a>
</span><span id="get_all_tools-84"><a href="#get_all_tools-84"><span class="linenos"> 84</span></a><span class="sd">    Returns:</span>
</span><span id="get_all_tools-85"><a href="#get_all_tools-85"><span class="linenos"> 85</span></a><span class="sd">        List of initialized tools</span>
</span><span id="get_all_tools-86"><a href="#get_all_tools-86"><span class="linenos"> 86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_all_tools-87"><a href="#get_all_tools-87"><span class="linenos"> 87</span></a>    <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="get_all_tools-88"><a href="#get_all_tools-88"><span class="linenos"> 88</span></a>
</span><span id="get_all_tools-89"><a href="#get_all_tools-89"><span class="linenos"> 89</span></a>    <span class="c1"># Import tools modules and inject dependencies</span>
</span><span id="get_all_tools-90"><a href="#get_all_tools-90"><span class="linenos"> 90</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">..config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">ROOT_DIR</span>
</span><span id="get_all_tools-91"><a href="#get_all_tools-91"><span class="linenos"> 91</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span><span class="p">,</span> <span class="n">memory_tools</span><span class="p">,</span> <span class="n">research</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">web</span>
</span><span id="get_all_tools-92"><a href="#get_all_tools-92"><span class="linenos"> 92</span></a>
</span><span id="get_all_tools-93"><a href="#get_all_tools-93"><span class="linenos"> 93</span></a>    <span class="c1"># Inject global dependencies into each module that needs them</span>
</span><span id="get_all_tools-94"><a href="#get_all_tools-94"><span class="linenos"> 94</span></a>    <span class="k">if</span> <span class="n">mcp_client</span><span class="p">:</span>
</span><span id="get_all_tools-95"><a href="#get_all_tools-95"><span class="linenos"> 95</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="get_all_tools-96"><a href="#get_all_tools-96"><span class="linenos"> 96</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-97"><a href="#get_all_tools-97"><span class="linenos"> 97</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">ROOT_DIR</span> <span class="o">=</span> <span class="n">ROOT_DIR</span>
</span><span id="get_all_tools-98"><a href="#get_all_tools-98"><span class="linenos"> 98</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">DATA_DIR</span>
</span><span id="get_all_tools-99"><a href="#get_all_tools-99"><span class="linenos"> 99</span></a>
</span><span id="get_all_tools-100"><a href="#get_all_tools-100"><span class="linenos">100</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="get_all_tools-101"><a href="#get_all_tools-101"><span class="linenos">101</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-102"><a href="#get_all_tools-102"><span class="linenos">102</span></a>
</span><span id="get_all_tools-103"><a href="#get_all_tools-103"><span class="linenos">103</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="get_all_tools-104"><a href="#get_all_tools-104"><span class="linenos">104</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-105"><a href="#get_all_tools-105"><span class="linenos">105</span></a>
</span><span id="get_all_tools-106"><a href="#get_all_tools-106"><span class="linenos">106</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">mcp_client</span> <span class="o">=</span> <span class="n">mcp_client</span>
</span><span id="get_all_tools-107"><a href="#get_all_tools-107"><span class="linenos">107</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">USE_MCP</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-108"><a href="#get_all_tools-108"><span class="linenos">108</span></a>
</span><span id="get_all_tools-109"><a href="#get_all_tools-109"><span class="linenos">109</span></a>    <span class="c1"># Inject logger into all modules</span>
</span><span id="get_all_tools-110"><a href="#get_all_tools-110"><span class="linenos">110</span></a>    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
</span><span id="get_all_tools-111"><a href="#get_all_tools-111"><span class="linenos">111</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-112"><a href="#get_all_tools-112"><span class="linenos">112</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-113"><a href="#get_all_tools-113"><span class="linenos">113</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-114"><a href="#get_all_tools-114"><span class="linenos">114</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-115"><a href="#get_all_tools-115"><span class="linenos">115</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="get_all_tools-116"><a href="#get_all_tools-116"><span class="linenos">116</span></a>
</span><span id="get_all_tools-117"><a href="#get_all_tools-117"><span class="linenos">117</span></a>    <span class="k">if</span> <span class="n">weaviate_client</span> <span class="ow">and</span> <span class="n">vector_store</span><span class="p">:</span>
</span><span id="get_all_tools-118"><a href="#get_all_tools-118"><span class="linenos">118</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">weaviate_client</span> <span class="o">=</span> <span class="n">weaviate_client</span>
</span><span id="get_all_tools-119"><a href="#get_all_tools-119"><span class="linenos">119</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-120"><a href="#get_all_tools-120"><span class="linenos">120</span></a>        <span class="n">memory_tools</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-121"><a href="#get_all_tools-121"><span class="linenos">121</span></a>
</span><span id="get_all_tools-122"><a href="#get_all_tools-122"><span class="linenos">122</span></a>        <span class="c1"># Inject Weaviate dependencies into other modules</span>
</span><span id="get_all_tools-123"><a href="#get_all_tools-123"><span class="linenos">123</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-124"><a href="#get_all_tools-124"><span class="linenos">124</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-125"><a href="#get_all_tools-125"><span class="linenos">125</span></a>        <span class="n">filesystem</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="get_all_tools-126"><a href="#get_all_tools-126"><span class="linenos">126</span></a>
</span><span id="get_all_tools-127"><a href="#get_all_tools-127"><span class="linenos">127</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-128"><a href="#get_all_tools-128"><span class="linenos">128</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-129"><a href="#get_all_tools-129"><span class="linenos">129</span></a>        <span class="n">web</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="get_all_tools-130"><a href="#get_all_tools-130"><span class="linenos">130</span></a>
</span><span id="get_all_tools-131"><a href="#get_all_tools-131"><span class="linenos">131</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-132"><a href="#get_all_tools-132"><span class="linenos">132</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-133"><a href="#get_all_tools-133"><span class="linenos">133</span></a>        <span class="n">system</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="get_all_tools-134"><a href="#get_all_tools-134"><span class="linenos">134</span></a>
</span><span id="get_all_tools-135"><a href="#get_all_tools-135"><span class="linenos">135</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
</span><span id="get_all_tools-136"><a href="#get_all_tools-136"><span class="linenos">136</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">USE_WEAVIATE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_all_tools-137"><a href="#get_all_tools-137"><span class="linenos">137</span></a>        <span class="n">research</span><span class="o">.</span><span class="n">store_interaction</span> <span class="o">=</span> <span class="n">memory_tools</span><span class="o">.</span><span class="n">store_interaction</span>
</span><span id="get_all_tools-138"><a href="#get_all_tools-138"><span class="linenos">138</span></a>
</span><span id="get_all_tools-139"><a href="#get_all_tools-139"><span class="linenos">139</span></a>    <span class="c1"># Memory tools (require Weaviate)</span>
</span><span id="get_all_tools-140"><a href="#get_all_tools-140"><span class="linenos">140</span></a>    <span class="k">if</span> <span class="n">weaviate_client</span> <span class="ow">and</span> <span class="n">vector_store</span><span class="p">:</span>
</span><span id="get_all_tools-141"><a href="#get_all_tools-141"><span class="linenos">141</span></a>        <span class="n">memory_tools_list</span> <span class="o">=</span> <span class="n">create_memory_tools</span><span class="p">(</span><span class="n">weaviate_client</span><span class="p">,</span> <span class="n">vector_store</span><span class="p">)</span>
</span><span id="get_all_tools-142"><a href="#get_all_tools-142"><span class="linenos">142</span></a>        <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">memory_tools_list</span><span class="p">)</span>
</span><span id="get_all_tools-143"><a href="#get_all_tools-143"><span class="linenos">143</span></a>
</span><span id="get_all_tools-144"><a href="#get_all_tools-144"><span class="linenos">144</span></a>    <span class="c1"># MCP-based tools (require MCP client)</span>
</span><span id="get_all_tools-145"><a href="#get_all_tools-145"><span class="linenos">145</span></a>    <span class="k">if</span> <span class="n">mcp_client</span><span class="p">:</span>
</span><span id="get_all_tools-146"><a href="#get_all_tools-146"><span class="linenos">146</span></a>        <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="get_all_tools-147"><a href="#get_all_tools-147"><span class="linenos">147</span></a>            <span class="p">[</span>
</span><span id="get_all_tools-148"><a href="#get_all_tools-148"><span class="linenos">148</span></a>                <span class="c1"># Filesystem tools</span>
</span><span id="get_all_tools-149"><a href="#get_all_tools-149"><span class="linenos">149</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_read_file</span><span class="p">,</span>
</span><span id="get_all_tools-150"><a href="#get_all_tools-150"><span class="linenos">150</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_write_file</span><span class="p">,</span>
</span><span id="get_all_tools-151"><a href="#get_all_tools-151"><span class="linenos">151</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">mcp_list_directory</span><span class="p">,</span>
</span><span id="get_all_tools-152"><a href="#get_all_tools-152"><span class="linenos">152</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">intelligent_file_search</span><span class="p">,</span>
</span><span id="get_all_tools-153"><a href="#get_all_tools-153"><span class="linenos">153</span></a>                <span class="n">filesystem</span><span class="o">.</span><span class="n">create_and_save_file</span><span class="p">,</span>
</span><span id="get_all_tools-154"><a href="#get_all_tools-154"><span class="linenos">154</span></a>                <span class="c1"># Web tools</span>
</span><span id="get_all_tools-155"><a href="#get_all_tools-155"><span class="linenos">155</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_github_search</span><span class="p">,</span>
</span><span id="get_all_tools-156"><a href="#get_all_tools-156"><span class="linenos">156</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_brave_search</span><span class="p">,</span>
</span><span id="get_all_tools-157"><a href="#get_all_tools-157"><span class="linenos">157</span></a>                <span class="n">web</span><span class="o">.</span><span class="n">mcp_fetch_url</span><span class="p">,</span>
</span><span id="get_all_tools-158"><a href="#get_all_tools-158"><span class="linenos">158</span></a>                <span class="c1"># System tools</span>
</span><span id="get_all_tools-159"><a href="#get_all_tools-159"><span class="linenos">159</span></a>                <span class="n">system</span><span class="o">.</span><span class="n">mcp_shell_command</span><span class="p">,</span>
</span><span id="get_all_tools-160"><a href="#get_all_tools-160"><span class="linenos">160</span></a>                <span class="c1"># Research tools</span>
</span><span id="get_all_tools-161"><a href="#get_all_tools-161"><span class="linenos">161</span></a>                <span class="n">research</span><span class="o">.</span><span class="n">comprehensive_research</span><span class="p">,</span>
</span><span id="get_all_tools-162"><a href="#get_all_tools-162"><span class="linenos">162</span></a>            <span class="p">]</span>
</span><span id="get_all_tools-163"><a href="#get_all_tools-163"><span class="linenos">163</span></a>        <span class="p">)</span>
</span><span id="get_all_tools-164"><a href="#get_all_tools-164"><span class="linenos">164</span></a>
</span><span id="get_all_tools-165"><a href="#get_all_tools-165"><span class="linenos">165</span></a>    <span class="k">return</span> <span class="n">tools</span>
</span></pre></div>


            <div class="docstring"><p>Get all available tools with injected dependencies.</p>

<p>Args:
    mcp_client: MCP client for file operations and external tools
    weaviate_client: Weaviate client for vector operations
    vector_store: Vector store for knowledge base operations
    logger: Logger instance for tool operations</p>

<p>Returns:
    List of initialized tools</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>